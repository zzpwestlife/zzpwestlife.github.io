---
title: 高并发大流量解决方案 4 使用 CDN 加速
date: 2018-02-15 16:32:24
tags: 高并发
---

## 使用CDN加速

#### 1. 什么是 CDN

CDN 的全称是 content delivery network，即内容分发网络。

<!-- more -->

尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定。

在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络（相当于真实服务器的镜像）。

CDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。

#### 2. 使用 CDN 的优势

- 本地 cache 加速，提高了企业站点（尤其是含有大量图片和静态页面站点）的访问速度。
- 跨运营商的网络加速（北联通、南电信），保证不同网络的用户都得到良好的访问质量。
- 远程访问用户根据 DNS 负载均衡技术智能自动选择 cache 服务器。
- 自动生成服务器的远程 mirror（镜像）cache 服务器，远程用户访问时从 cache 服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点 web 服务器负载等功能。
- 广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵。

#### 3. CDN 的工作原理

##### 1. 传统访问

用户在浏览器输入域名发起请求 -> 解析域名获取服务器 ip 地址 -> 根据 ip 地址找到对应的服务器 -> 服务器响应并返回数据

##### 2. 使用 CDN 访问

用户发起请求（cname）  -> 智能 DNS 解析（根据ip判断地理位置、接入网类型，选择路由最短和负载最轻的服务器） -> 取得缓存服务器ip -> 把内容返回给用户（如果缓存中有） -> 向源站点发起请求 -> 将结果返回给用户 -> 将结果存入缓存服务器

#### 4. CDN 的适用场景

- 站点或应用中大量静态资源的加速分发，如 css、js、图片、html 等
- 大文件下载
- 直播网站

#### 5. CDN 的实现

- BAT 等都有提供现成的 CDN 服务
- 可用 LVS 做4层负载均衡
- 可用 nginx、varnish、squid、Apache trafficserver 做7层负载均衡和cache
- 使用 squid 反向代理、或者 nginx 反向代理，把源站点的内容缓存