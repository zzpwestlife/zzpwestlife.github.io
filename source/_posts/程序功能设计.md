---
title: 程序功能设计
date: 2018-02-16 17:55:04
tags: 
---

> 真题：编写一个在线留言本，实现用户的在线留言功能，留言信息存储到数据库，要求设计数据表内容以及使用 PHP 编码完成。

考点：

- 数据表设计
- 数据表创建语句
- PHP 连接数据库的方式
- 编码能力

<!-- more -->

#### 1. 分析数据表结构

留言本有哪些信息需要存储

留言信息： ID，留言标题，留言内容，留言时间，留言人

``` mysql
CREATE TABLE message (
`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
`title` VARCHAR(120) NOT NULL DEFAULT '',
`content` VARCHAR(255) NOT NULL DEFAULT '',
`created_at` INT NOT NULL DEFAULT 0,
`user_name` VARCHAR(32) NOT NULL DEFAULT ''
KEY message_user_name(user_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

#### 2. PHP 连接数据库的方式

- PDO：可扩展性更好、支持预处理、面向对象。建议使用，扩展性好，之后切换其他数据库方便，方法完善
- MySQLi：只支持 MySQL 操作、支持预处理、面向对象和过程、效率更高
- mysql：只支持 MySQL 数据库，没有预处理的支持、面向过程


PDO 的基本操作

``` php
<?php
try {
	// 操作数据库的代码
} catch (PDOException $e) {
	echo $e->getMessage();
}
```

操作数据库的代码
``` php
<?php
$pdo = new PDO($dsn, $username, $password, $attr);
$sql = 'SELECT id, title, content FROM message where user_name=:user_name';
$stmt = $pdo->prepare($sql);
$stmt->execute([':user_name' => $user_name]);
$result = $stmt->fetchAll(PDO::FETCH_ASSOC);
```

#### 3. 解题方法

根据考题给出的功能，先分析应该存储哪些信息，设计好数据表，这一步很关键，如果编码时才发现设计有问题，会浪费大量的时间，基本没有时间改，所以要先设计好，然后根据设计好的数据表创建数据表语句，通常建议使用 PDO 来连接 MySQL，最终完成编码，所以一定要熟悉 PDO 的操作。

示例

``` php
<?php
try {
	$dsn = 'mysql:dbname=test;host=localhost';
	$username = 'test';
	$password = 'test';
	$attr = [
		PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION
	];
	$pdo = new PDO($dsn, $username, $password, $attr);
	$sql = 'insert into message(title, content, created_at, user_name) values(:title, :content. :created_at, :user_name)';
	$stmt = $pdo->prepare($sql);
	$data = [
		':title' => $title,
		':content' => $content,
		':created_at' => time(),
		'user_name' => $user_name
	];
	$stmt->execute($data);
	$rows = $stmt->rowCount();
	if ($rows) {
		exit('执行成功');
	} else {
		exit('执行失败');
	}
} catch (PDOException $e) {
	echo $e->getMessage();
}
```

#### 4. 真题：设计一个无限分类表

``` mysql
CREATE TABLE message (
`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
`title` VARCHAR(120) NOT NULL DEFAULT '',
`pid` INT NOT NULL DEFAULT 0,
`path` VARCHAR NOT NULL DEFAULT ''
KEY message_user_name(user_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

![](http://omp48p40q.bkt.clouddn.com/18-2-16/13030217.jpg)


