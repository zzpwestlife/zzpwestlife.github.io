---
title: 高并发大流量解决方案 10 MySQL 数据库层的优化
date: 2018-02-15 16:35:43
tags: 高并发
---

#### MySQL 数据库层优化


##### 1. 数据表数据类型优化

- 字段使用什么样的数据类型更合适
- 字段使用什么样的数据类型性能更快

<!-- more -->

按需选择，如年龄选择 tinyint 无符号即可；smallint 古建筑、古树年龄等；bigint 存储大数据。考虑空间的问题，考虑范围的问题。

char，varchar，手机号码固定 11 位，md5 字符串固定 32 位，宜用 char 类型；用户名等不固定长度的应使用

varchar，需要考虑存储字符串长度是否固定。

enum：特定、固定的分类可以使用 enum 存储，效率更快，扩展性较差。但实际情况中一般不用
ip 地址的存储，一般用字符串存储，但占用空间较大，用整型存储比较合适。ip2long(), long2ip()

##### 2. 索引优化

- 建立合适的索引
- 索引在什么场景下效率最高

索引的创建原则：索引不是越多越好，在合适的字段上创建合适的索引。索引会提升查询操作速度，但是胡影响写入操作的效率，也会占用更多的磁盘空间。

- 注意复合索引的最左前缀原则
- 注意 like 查询的 % 问题， % 在前，该字段的索引将失效
- 注意全表扫描优化
- 注意 or 条件索引使用情况，如果 or 前面的列有索引，or 后面的列没有索引，所以会失效。
- 注意字符串类型索引失效问题：如果字符串内存的是整型数据，查询时直接以整型的形式去查，索引会失效，查询时要加引号。

##### 3. SQL 语句优化

- 优化查询过程中的数据访问
  
  使用 limit， 尽量不用 *
- 优化长难句的查询语句

  变复杂为简单
  
  切分查询
  
  分解关联查询

- 优化特定类型的查询语句

  优化 count()
  
  优化关联查询
  
  优化子查询，尽量使用关联查询替代
  
  优化 group by 和 distinct
  
  优化 limit 和 union

##### 4. 存储引擎优化

尽量使用 InnoDB，支持事务，支持外键，使用独立表空间，使用行级锁

##### 5. 数据表结构设计优化

> 分区操作

通过特定的策略对数据表进行物理拆分
对用户透明，用户无感知
partition by

> 分库分表

水平拆分
垂直拆分

##### 6. 数据库服务器架构优化

> 主从复制

> 读写分离

> 双主热备

> 负载均衡

通过 LVS 的三种基本模式实现负载均衡

mycat 数据库中间件实现负载均衡

