---
title: 【记录】正则表达式学习
date: 2017-05-24 22:28:26
tags: 正则表达式
categories: Linux
---

本文是慕课网 [《实例妙解sed 和 awk 的秘密》](http://www.imooc.com/learn/819) 的学习记录的第一部分：正则表达式。

Linux 三大利器： grep, sed, awk.

<!--more-->

## 1. 准备工作
正则表达式应用场景：查找、取出、匹配符合条件的字符或字符串

学习方法：从小到大、组合的过程。单个字符->字符串->表达式。

grep 搜索命令匹配正则表达式例子

```
$ grep 'root' passwd
root:*:0:0:System Administrator:/var/root:/bin/sh
daemon:*:1:1:System Services:/var/root:/usr/bin/false
_cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false
```

## 2. 正则单个字符的表示方式

### 1. 特定字符

某个具体的字符，如 '1', 'a'

使用 grep 搜索命令进行正则表达式的匹配

```
$ grep '1' passwd
daemon:*:1:1:System Services:/var/root:/usr/bin/false
_taskgated:*:13:13:Task Gate Daemon:/var/empty:/usr/bin/false
_scsd:*:31:31:Service Configuration Service:/var/empty:/usr/bin/false
_eppc:*:71:71:Apple Events User:/var/empty:/usr/bin/false
...
```

匹配结果被标红

![](http://omp48p40q.bkt.clouddn.com/17-5-24/6251408.jpg)

### 2. 范围内字符

- **单个**字符 []

数字字符：[0-9], [278], 表示2/7/8, 注意只匹配一个字符。

```
$ grep '[0-9]' passwd
```

- 小写字符：[a-z]

- 大写字符：[A-Z]

- 大小写：[a-zA-Z]

- 符号： [,:!%-().]

- 反向字符： ^, **必须放在范围之前，[]内部**，如

```
$ grep '[^0-9]' passwd
```

### 3. 任意字符

代表任何一个字符： .

注意 ., \\.,  [.] 的区别，其中后两个的作用是一样的。

### 4. 其他常用字符

- 边界字符/头尾字符

头字符 ^root, 表示以root开头的行，注意与取反字符 [^0-9] 的区别

尾字符 false$, 表示以false结尾的行。

```
$ grep '^root' passwd
root:*:0:0:System Administrator:/var/root:/bin/sh

$ grep 'false$' passwd
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false
daemon:*:1:1:System Services:/var/root:/usr/bin/false
...
```

空行： ^$, 头尾相接。

- 元字符（代表普通字符或特殊字符）

实质上起替代的作用

\w: 匹配任何字类字符，即字母数字下划线 [a-zA-Z0-9_]

\W: 匹配任何非字类字符，即 [^a-zA-Z0-9_]

\b: 代表单词的分隔

```
grep '\btime\b' file
```

只匹配包含单词 time 的行，不匹配 timezone，showtime 等。


## 3. 字符组合

### 1. 字符串

'root', '1000', 'r..t' (r开头，t结束，长度为4的字符串)

'[A-Z][a-z]' (一个大写字母加一个小写字母)

'[0-9][0-9]' (两个连续的数字，**正则为最大化匹配，所以四位数也会匹配，五位数也会匹配前四位**)

### 2. 重复

- \*: 0-n 次匹配前面的字符或表达式

- \+: 1-n 次匹配

- ?: 0-1 次匹配

```
// 可能的匹配结果： s, se, see, seee...
$ grep 'se*' passwd
// 可能的匹配结果： se, see, seee...
$ grep 'se\+' passwd
// 可能的匹配结果： s, se, 只有两种
$ grep 'se\?' passwd
```

后两者注意要进行转义。

```
// 匹配字符串，要加括号 se, sese, sese...
$ grep '\(se\)\+' passwd
```

注意括号也要进行转义。


- 重复特定次数 {n,m}

\*: 相当于 {0,} 

\+: 相当于 {1,}

?: 相当于 {0,1}

```
// 匹配两到三位数字
$ grep '[0-9]\{2,3\}' passwd
```

注意大括号也要转义。

- 任意字符串： .\*
(即任意单字符重复0-n次)
 

如： ^r.\*,  r.\*t

```
$ grep '^r.*' passwd
root:*:0:0:System Administrator:/var/root:/bin/sh
```

**注意**：正则贪婪匹配的规则。

```
$ grep '\bd.*e\b' passwd
```

![](http://omp48p40q.bkt.clouddn.com/17-5-24/65316894.jpg)

多么贪婪，我只想要匹配类似 dislike 这种词。

这时候就不能重复任意字符了。

```
$ grep '\bd[a-z]*e\b' passwd
```

这样改就好了。

尽量去缩小要匹配的范围，才能避免踩这些坑。


### 3. 逻辑

- 逻辑或 \|

```
$ grep 'bin/\(false\|true\)' passwd
```

## 4. 正则案例

### 1. 匹配4-10位QQ号

```
$ grep '^[0-9]\{4,10\}$' file
```

### 2. 匹配15或18位身份证号，包括X

分析：

* 第一位不能为0
* 最后一位的范围要扩大
* 中间为13或16位重复数字

```
// 先写逻辑，最后加头尾和转义
$ grep '^[1-9]\([0-9]\{13\}\|[0-9]\{16\}\)[0-9xX]$' file
```

### 3. 匹配密码

分析：

* 密码保护字母数字下划线，使用元字符 \w
* 可1次或多次重复 \+

```
$ grep '^\w\+$' file
```

![](http://omp48p40q.bkt.clouddn.com/17-5-24/91639479.jpg)




