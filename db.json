{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/algolia-search.js","path":"js/algolia-search.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/bookmark.js","path":"js/bookmark.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/motion.js","path":"js/motion.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/next-boot.js","path":"js/next-boot.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/schedule.js","path":"js/schedule.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"2eda83ac2c1e572112f16ceb493b027b5b196a05","modified":1599786275030},{"_id":"source/categories/index.md","hash":"dc251e3de25130c6501a5f09c6d57767ecfd24ad","modified":1599786275063},{"_id":"source/404/.DS_Store","hash":"64dc80f95f42dbf12ce9ef6d86358c25c2d86d25","modified":1599786275030},{"_id":"source/404/index.md","hash":"edbe3323a21a458ffb2441773242af6ca0d69d65","modified":1599786275030},{"_id":"source/about/.DS_Store","hash":"64dc80f95f42dbf12ce9ef6d86358c25c2d86d25","modified":1599786275062},{"_id":"source/about/index.md","hash":"0b5195a1a8d4eae674b1f6675a38dff0d628de95","modified":1599786275063},{"_id":"source/friends/index.md","hash":"eb92a87ee181e913655fcff9b407265f093d65f5","modified":1599786275063},{"_id":"source/_posts/ 几个小问题 201806.md","hash":"735dd15ca9f44ac05eaee6312c36f95772afee24","modified":1599786275030},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1599786275031},{"_id":"source/tags/.DS_Store","hash":"64dc80f95f42dbf12ce9ef6d86358c25c2d86d25","modified":1599786275064},{"_id":"source/tags/index.md","hash":"171e18fe895279648a04e9176d8a3d21fb14ad80","modified":1599786275064},{"_id":"source/_posts/API 断点调试 -- PHPStorm && XDebug && Postman.md","hash":"f83d76bc9d7d51841ef11e56128bbae3c310ae62","modified":1599786275031},{"_id":"source/_posts/CGI、FastCGI和PHP-FPM关系图解.md","hash":"c4a5b31f589203198588f716cebb9710205fb640","modified":1599786275032},{"_id":"source/_posts/Crontab-学习笔记.md","hash":"38fceb10c8e5525697a218ee90da8d4bacf6c649","modified":1599786275032},{"_id":"source/_posts/DEDECMS-{dede-global-cfg_templets_skin-}-调用多一层目录怎么解决-.md","hash":"cca11ecf6504b92ca5b40a9d6b312514a1e93566","modified":1599786275032},{"_id":"source/_posts/Git-入门指南.md","hash":"b1c033942adcb3a1fa6a4f00f3942a3a22c4fda0","modified":1599786275032},{"_id":"source/_posts/Laravel 后台搜索功能的实现.md","hash":"5b4425dde2dc4ec885b22fab51cadb01c35393ab","modified":1599786275033},{"_id":"source/_posts/Laravel-去重、分组取最大、按时间二次分组、评论盖楼等.md","hash":"ee5bc5eace404d9cc87b58063fa4c3736cc44931","modified":1599786275033},{"_id":"source/_posts/Laravel-项目中-远程把图片下载到本地.md","hash":"b519fbaea7863da066779c8d8a45e828b395610d","modified":1599786275033},{"_id":"source/_posts/Linux-懒人工具---autojump.md","hash":"299a4a8e8e0ba2b3b4412780a3c21e10281fdddf","modified":1599786275035},{"_id":"source/_posts/Linux-软件安装管理.md","hash":"28b08f1b87f8fee12ec2ea15400291324194f5d8","modified":1599786275035},{"_id":"source/_posts/Linux-安装-http2-支持.md","hash":"85f62ffc40535e754f90727cb2fcd714f8925d84","modified":1599786275034},{"_id":"source/_posts/MVC-框架工作原理.md","hash":"d55db2f01e74907fd4d2c14963d865f0cc441217","modified":1599786275035},{"_id":"source/_posts/Mac-下如何快速搭建-PHP-集成环境.md","hash":"35a06b06ac55fbf317ea0c1caeb8452a3264b482","modified":1599786275036},{"_id":"source/_posts/Mac-启动加载文件顺序问题.md","hash":"56bfb4660457d86a94e0a0087ee901c23d1de7d2","modified":1599786275036},{"_id":"source/_posts/Mac-如何让-Finder-显示隐藏文件和文件夹.md","hash":"7748f4f2cb6693779310bfb918e913ac7ad51feb","modified":1599786275036},{"_id":"source/_posts/MarkDown-常用语法.md","hash":"afaf7a4715d9dc5f90d89093bc647c2120e197e5","modified":1599786275038},{"_id":"source/_posts/Mac-平台下配置-Charles-实现抓取手机网络请求.md","hash":"cb5a234679e077c1e5e1db1bcf2ff4cdcfb2849a","modified":1599786275037},{"_id":"source/_posts/MySQL-知识整理.md","hash":"d3f1696b5d816163d08f8a8fae7aa97eb2386c02","modified":1599786275038},{"_id":"source/_posts/MySQL-分区分表.md","hash":"27c94a9d77f4ab48b71b67fc3a6fc87bcec8a82c","modified":1599786275038},{"_id":"source/_posts/PHP 面试.md","hash":"bb2a095d59731815e5337f05c4dd798b744db955","modified":1599786275039},{"_id":"source/_posts/Shadowsocks-配置用法教程.md","hash":"e7f21b34c250d9c1a2944dbc5d4f0064a5339dc1","modified":1599786275039},{"_id":"source/_posts/Vagrant-打造PHP开发环境.md","hash":"35b8d5d5d033f8d442c55ab72b6dbe2eee78e5a9","modified":1599786275040},{"_id":"source/_posts/Yii-框架-开启网页调试功能.md","hash":"ba92ee572a61e1e8d3702bc4c61f60eb1887b961","modified":1599786275040},{"_id":"source/_posts/Shell-脚本学习记录（1）.md","hash":"311997ed43f2a3a72d59aae67a4a85b73720f137","modified":1599786275040},{"_id":"source/_posts/bd：快速返回某级父目录而不用冗余地输入-“cd-”.md","hash":"5c19caec8bb17513e21f27f5ef140559a403306a","modified":1599786275040},{"_id":"source/_posts/git 的几个小问题.md","hash":"da21f0f5b2870fd60871ccec5ad76a9307e62de7","modified":1599786275041},{"_id":"source/_posts/centOS 安装 PHP7.md","hash":"228f6e66342886b5118495e61eef4af478cc35b8","modified":1599786275041},{"_id":"source/_posts/hexo 搭建个人博客的学习记录-Git 自动部署代码到服务器.md","hash":"68da615dd62a13748af487c30d0455f2d3d0e37e","modified":1599786275041},{"_id":"source/_posts/hexo 搭建个人博客的学习记录-yelee 主题设置.md","hash":"f2d6a8b2543da3f4d2a07c42fe98292d3ac0b2e3","modified":1599786275042},{"_id":"source/_posts/linux-权限管理.md","hash":"1f4fca1860bead84f56dfc86e52427655a593a0d","modified":1599786275042},{"_id":"source/_posts/mac-下搭建-laravel-运行环境.md","hash":"2e40aab98f175b45e97728f2d60a2f72ac7d542f","modified":1599786275042},{"_id":"source/_posts/iThoughtX-for-Mac-常用快捷键.md","hash":"40c387370753847e8fe9cd60543f20871a5e6720","modified":1599786275042},{"_id":"source/_posts/mac-中-mamp-pro-的-localhost-显示为-403-Forbidden.md","hash":"0b811fd8eb097a6ea555e43577f9aa79660d0f15","modified":1599786275043},{"_id":"source/_posts/mac-内置与-brew-安装的-openssl-冲突解决方案.md","hash":"e01808e0c52868419fa43cd792b47e3b5336b868","modified":1599786275043},{"_id":"source/_posts/php-artisan-的几个命令.md","hash":"01138c6cc600f99756e1d2bf19c067e15bb03bcd","modified":1599786275044},{"_id":"source/_posts/nginx-入门到实践-慕课网.md","hash":"0c0958b0aa9bc3431fefee0681061c44b708d0d2","modified":1599786275044},{"_id":"source/_posts/php7-安装-mysql-扩展.md","hash":"e7ac3afd797b584357afb57c21a9d7e67538662c","modified":1599786275044},{"_id":"source/_posts/《循序渐进学-Docker》学习-part-1.md","hash":"1c6d71a0b10b11b7afce787ed03d941ae584881c","modified":1599786275045},{"_id":"source/_posts/vagrant-docker-php-env.md","hash":"e3b19259a5e3352a12d316904459b396371965ed","modified":1599786275045},{"_id":"source/_posts/《财经》CMS后台查询功能的实现（基于Laravel-Repository）.md","hash":"53be6f2f8d5afc7b0028c0226612beaf7a808dac","modified":1599786275045},{"_id":"source/_posts/【记录】Linux-开启-php-的-openssl扩展.md","hash":"9e15ac23550c512f64ab9043d6d491a1d024bde9","modified":1599786275046},{"_id":"source/_posts/【记录】PHP项目中使用Openssl加密.md","hash":"7c092fd3fff7296b1f2e257cb8d93293374b8b48","modified":1599786275046},{"_id":"source/_posts/【记录】sed 学习.md","hash":"f2aa48a46c2cf2de420b8f7ad8c5085361368e69","modified":1599786275046},{"_id":"source/_posts/【记录】最近的一些琐碎.md","hash":"5a21687e770ce865861c3037ea8b62974f48c19e","modified":1599786275047},{"_id":"source/_posts/使用-Sublime-替换文本中的换行-回车符等特殊符号.md","hash":"8e06ccfb27659803512a5ca2704d208dd504acb2","modified":1599786275047},{"_id":"source/_posts/使用终端卸载-Ubuntu-应用.md","hash":"0a5889fa0d6f8466737e53e523c540a35c849506","modified":1599786275047},{"_id":"source/_posts/【记录】正则表达式学习.md","hash":"626998a768121f4a7a82af44412fe53313ed5236","modified":1599786275047},{"_id":"source/_posts/全新离线安装Laravel-Homestead-记录.md","hash":"e18e4d405efa91d65e2e9d16d39c4699f51e2fb1","modified":1599786275047},{"_id":"source/_posts/几个PHP数组处理方法.md","hash":"75313094ee77e0040c51c214b6303b4047a5aac3","modified":1599786275048},{"_id":"source/_posts/在iTerm2中使用Zmodem传输文件.md","hash":"c17bd91c3ba9573f244c58291cc1df586142274a","modified":1599786275048},{"_id":"source/_posts/小程序用户登录授权逻辑及踩坑.md","hash":"79fd4b7fe94282202aa0f559ebba65a9e61c93a7","modified":1599786275049},{"_id":"source/_posts/常见算法.md","hash":"a7ff2da01654940ecd08ee6c3bdcf3e7429655b9","modified":1599786275049},{"_id":"source/_posts/快速上手Linux-玩转典型应用-part-1.md","hash":"345174ee15aa4744dba7469e10aba7388e1fb4da","modified":1599786275049},{"_id":"source/_posts/把mac上的默认php修改为MAMP等扩展环境中的php-版本.md","hash":"fcdd4a44e51cb6755c4a69f60fb4f4a1811a5dc4","modified":1599786275050},{"_id":"source/_posts/富文本编辑器-wangEditor-接入方法.md","hash":"4cace7c8ce9f6305a4413c3f1fa9351b88c6ba71","modified":1599786275048},{"_id":"source/_posts/文件上传插件-dropzone-接入方法.md","hash":"5cabaa9a030a0ad7cf8b4726d53c20d6c1e0a7f6","modified":1599786275050},{"_id":"source/_posts/晚霞无限好，只是下班晚.md","hash":"92e30e40c10d0f43a0de7a7dd1bab63a54fdff68","modified":1599786275050},{"_id":"source/_posts/最近遇到的一些小问题-201711.md","hash":"cbe38965e4d1f25885bd130f9b171e1d143b4359","modified":1599786275050},{"_id":"source/_posts/算法、逻辑思维.md","hash":"526ab24022f7d1d2f4ea831f94c90e144004c045","modified":1599786275051},{"_id":"source/_posts/算法、逻辑思维2.md","hash":"b9d3ce3790cf4fa0af2749fef06fd30af14bc775","modified":1599786275051},{"_id":"source/_posts/配置和使用-Xdebug-(Laravel-+-Homestead-+-Xdebug).md","hash":"d945857ba9d35dae272ea14646491dba3ae9accb","modified":1599786275052},{"_id":"source/_posts/程序功能设计.md","hash":"ec93aa513750b64ba4067b1319d6874be431a487","modified":1599786275051},{"_id":"source/_posts/青海湖朝圣之旅-第三季 part2.md","hash":"bdfe783842e5c6d98e6cdebe2726979ce8f8f498","modified":1599786275053},{"_id":"source/_posts/青海湖朝圣之旅-第三季 part3.md","hash":"bb33b62728b2e5b3270d88e30b66ecf8da8d2b9a","modified":1599786275054},{"_id":"source/_posts/配置和使用-Xdebug-方法二.md","hash":"d2ab23d7eab24bbd9d24c802de645f37cc59c6f2","modified":1599786275053},{"_id":"source/_posts/青海湖朝圣之旅-第三季 part1.md","hash":"2fbde00bc4d2357c620c818985fbca212a3b3e35","modified":1599786275053},{"_id":"source/_posts/高并发和大流量解决方案.md","hash":"8a3c19dcd231466ff9a6d8cf3f4c184d08b18c3e","modified":1599786275057},{"_id":"source/_posts/青海湖朝圣之旅-第三季 part4.md","hash":"be9b2742fc3384d50abc1e51d828ba50defc3a09","modified":1599786275054},{"_id":"source/_posts/高并发大流量解决方案-11-web-服务器的负载均衡，请求分发.md","hash":"7a039be8e973e0b6f74399202c53420651dc433a","modified":1599786275060},{"_id":"source/_posts/高并发大流量解决方案-1-web-资源防盗链.md","hash":"d39b7ce56ffb32aa7767e407a1281cf223dd908e","modified":1599786275059},{"_id":"source/_posts/高并发大流量解决方案-3-浏览器缓存和压缩优化技术.md","hash":"b952032f6f05dc0cf329cdd19ea63008591920ce","modified":1599786275061},{"_id":"source/_posts/高并发大流量解决方案-10-MySQL-数据库层的优化.md","hash":"5e77f50fef701b9c426788105274da88203be0ee","modified":1599786275060},{"_id":"source/_posts/高并发大流量解决方案-2-减少-http-请求次数.md","hash":"7dc416509e4b52627573be28cfb761349754d8fb","modified":1599786275060},{"_id":"source/_posts/高并发大流量解决方案-5-建立独立的图片服务器.md","hash":"b9238ffd9030295e65c314b0ad3c8a7142c52e64","modified":1599786275061},{"_id":"source/_posts/高并发大流量解决方案-4-使用-CDN-加速.md","hash":"f14ab335d8fd37a07040edad41cb512bd49ed237","modified":1599786275061},{"_id":"source/_posts/高并发大流量解决方案-6-动态语言静态化.md","hash":"a4ecbd74c507632627bdb7b45256e404d32b0586","modified":1599786275061},{"_id":"source/_posts/高并发大流量解决方案-7-动态语言的并发处理.md","hash":"69dd1bb8a187b6b4701488a719ebb68c931a6bdf","modified":1599786275062},{"_id":"source/_posts/高并发大流量解决方案-9-数据层的优化.md","hash":"9152dbc27d971faefe0c9d48501b0e7856b904c1","modified":1599786275062},{"_id":"source/_posts/高并发大流量解决方案-8-数据库缓存层优化.md","hash":"ac339e90a525255f64b5bd43f9ee38d760e958e1","modified":1599786275062},{"_id":"public/search.xml","hash":"92c33aaeac04bf074e486d03ef409222fe204515","modified":1599786929326},{"_id":"public/404.html","hash":"867633945e97afa36598cd163376e6f1de5b855d","modified":1599787385527},{"_id":"public/categories/index.html","hash":"42e68b87bab6395818ff8b996f0737e9caf3c08a","modified":1599787385527},{"_id":"public/about/index.html","hash":"25d35fdaadb4993eda1f2c97deba743e1baad607","modified":1599787385527},{"_id":"public/friends/index.html","hash":"ef8127a678cc3630d8b0bbad34683767399bf846","modified":1599787385527},{"_id":"public/tags/index.html","hash":"98e01c603b75aa09ea223706c9ef55a142e84920","modified":1599787385527},{"_id":"public/2020/09/11/PHP 面试/index.html","hash":"130b0d0cf88c36286e243ee4898be9598fb7a1f7","modified":1599787385527},{"_id":"public/2020/09/11/Laravel 后台搜索功能的实现/index.html","hash":"df68b8090d2ed9d55b18bc882ecf65fd54bb7fcc","modified":1599787385527},{"_id":"public/2019/02/16/API 断点调试 -- PHPStorm && XDebug && Postman/index.html","hash":"86a2bd7ca7bb57b1a6ac1ed81471a01c4d9285bb","modified":1599787385527},{"_id":"public/2018/06/08/ 几个小问题 201806/index.html","hash":"e4f7ffd43b87aa8d0a791e83bd79e0ff074662c8","modified":1599787385527},{"_id":"public/2018/04/07/vagrant-docker-php-env/index.html","hash":"3426bc6833dbdeea570467a355040b1a15281a83","modified":1599787385527},{"_id":"public/2018/02/26/MySQL-分区分表/index.html","hash":"bd4fcfdda5b3bea920a5660f8d2459bd62f27dd9","modified":1599787385527},{"_id":"public/2018/02/24/MySQL-知识整理/index.html","hash":"9cdd53492ab8a5538be6a1f28441ede442118b0f","modified":1599787385527},{"_id":"public/2018/02/22/linux-权限管理/index.html","hash":"26d0ca9876ac1507945b6e8b198872c13044ccfc","modified":1599787385527},{"_id":"public/2018/02/18/nginx-入门到实践-慕课网/index.html","hash":"7f624cbe079e7d014c3c40f6ba0d0006e3886267","modified":1599787385527},{"_id":"public/2018/02/18/Linux-软件安装管理/index.html","hash":"1ed51a44504633b985e307c3d9f222f9efe24378","modified":1599787385527},{"_id":"public/2018/02/17/算法、逻辑思维2/index.html","hash":"126fdbe8a9435dfb92c19dbe9d8334ab28c0ec82","modified":1599787385527},{"_id":"public/2018/02/17/算法、逻辑思维/index.html","hash":"0f83d1eb9d3ba0583f787dbdeafe3aaf6c6a5969","modified":1599787385527},{"_id":"public/2018/02/16/常见算法/index.html","hash":"da75694ba5e34b1856e88a26727e723f7d919aef","modified":1599787385527},{"_id":"public/2018/02/16/MVC-框架工作原理/index.html","hash":"eb1b8581dbc36cc0a4b3ebfe9161f86634ba97e9","modified":1599787385527},{"_id":"public/2018/02/16/程序功能设计/index.html","hash":"48c8a6e5bf95c1128c8e9a146f51d5f23ba743e4","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-11-web-服务器的负载均衡，请求分发/index.html","hash":"07a4cbe49a509c8f070dd39841d08d47ff74b415","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-10-MySQL-数据库层的优化/index.html","hash":"d76c60a82dc84ed40fd25693d7948ff9d9b1dd9c","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-9-数据层的优化/index.html","hash":"43bc873ace853afcfd0ecfb61e415faf16771ca5","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-8-数据库缓存层优化/index.html","hash":"ccedf45f0b35f610051112335c015ddad61bb82e","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-7-动态语言的并发处理/index.html","hash":"8eb2a9c23e717d23b03b6287bcdfae346dda1ae3","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-6-动态语言静态化/index.html","hash":"b28aac175f55ece43477c2c5efdb289028d1091c","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-5-建立独立的图片服务器/index.html","hash":"220bbf048c62f055990080cb9af8c53d49fe1f92","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-4-使用-CDN-加速/index.html","hash":"f625cc548e4ddb536de55c0f9867b514d509b375","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-3-浏览器缓存和压缩优化技术/index.html","hash":"b6bcd37e81210eff7b5fcaaaf952916b05d68931","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-2-减少-http-请求次数/index.html","hash":"59f50ff1f89e5e9b85b8c11a9d6c10e45f90cc5e","modified":1599787385527},{"_id":"public/2018/02/15/高并发大流量解决方案-1-web-资源防盗链/index.html","hash":"da8e9b555b7044fde2d28646426af867de7c29dc","modified":1599787385527},{"_id":"public/2018/02/15/高并发和大流量解决方案/index.html","hash":"49d1fa30125a3168e803b1dfe04caa7dfc4a8b4b","modified":1599787385527},{"_id":"public/2018/01/18/小程序用户登录授权逻辑及踩坑/index.html","hash":"75cdf2ab7df801614b527e97068204c6c07c5843","modified":1599787385527},{"_id":"public/2017/12/08/Shadowsocks-配置用法教程/index.html","hash":"433bb8bac2a8e1e3548386ab46888531b1f4e846","modified":1599787385527},{"_id":"public/2017/12/05/几个PHP数组处理方法/index.html","hash":"7fbb2f9a06036ab3eebd2e0bed2b919ae4511547","modified":1599787385527},{"_id":"public/2017/11/28/最近遇到的一些小问题-201711/index.html","hash":"32eeb3ca32a088368adfa74201274f36f648ffd2","modified":1599787385527},{"_id":"public/2017/11/18/文件上传插件-dropzone-接入方法/index.html","hash":"b523dc4cf5f5907e4300a503229618b06f7873c6","modified":1599787385527},{"_id":"public/2017/11/18/富文本编辑器-wangEditor-接入方法/index.html","hash":"53d7d6c1f294694edcee84dbf096385a5cf6cf61","modified":1599787385527},{"_id":"public/2017/11/13/快速上手Linux-玩转典型应用-part-1/index.html","hash":"a70dd9bc6086bc6643e59841a633aca00a72baea","modified":1599787385527},{"_id":"public/2017/10/08/【记录】最近的一些琐碎/index.html","hash":"c2079361ceaad8b6669ff0845e4a9cae35e5008e","modified":1599787385527},{"_id":"public/2017/07/15/Laravel-去重、分组取最大、按时间二次分组、评论盖楼等/index.html","hash":"969e46b23a7e612218a79e585d4d1c7be7811bd2","modified":1599787385527},{"_id":"public/2017/07/15/php-artisan-的几个命令/index.html","hash":"e123273a5c133055d492eeca1f9e79ffe5f98b30","modified":1599787385527},{"_id":"public/2017/07/15/CGI、FastCGI和PHP-FPM关系图解/index.html","hash":"2d9d44976e13fdf8a1342bf0011b43d5880965f5","modified":1599787385527},{"_id":"public/2017/07/15/Mac-如何让-Finder-显示隐藏文件和文件夹/index.html","hash":"b853f561e0259226ae208e44ecd5de151c2fcdcb","modified":1599787385527},{"_id":"public/2017/06/26/《循序渐进学-Docker》学习-part-1/index.html","hash":"07365923ae8b5e24950492c48c01ff0284e8b1e4","modified":1599787385527},{"_id":"public/2017/06/04/青海湖朝圣之旅-第三季 part4/index.html","hash":"bacd4d44a9af7601f10d1d01ece21bd899261193","modified":1599787385527},{"_id":"public/2017/06/04/青海湖朝圣之旅-第三季 part3/index.html","hash":"6b9d28d5e49a33df0fd0e7c9d9ad152ddf916893","modified":1599787385527},{"_id":"public/2017/06/04/青海湖朝圣之旅-第三季 part2/index.html","hash":"286999eb9c4f2706876b21a50167d8c6861730ad","modified":1599787385527},{"_id":"public/2017/06/04/青海湖朝圣之旅-第三季 part1/index.html","hash":"3c3979926ddc7dddaddab817ff2e250e0b3f0edd","modified":1599787385527},{"_id":"public/2017/05/27/Mac-平台下配置-Charles-实现抓取手机网络请求/index.html","hash":"30c5afbac04cb065bf2ca93ff1d5604f655aa0ee","modified":1599787385527},{"_id":"public/2017/05/25/【记录】sed 学习/index.html","hash":"49e109c83e549c7ced8d6d0824c92e9e42f8d281","modified":1599787385527},{"_id":"public/2017/05/24/【记录】正则表达式学习/index.html","hash":"3c4d9061d8b0cfe6e8e5c8ee4e937c65bc08aaad","modified":1599787385527},{"_id":"public/2017/05/24/《财经》CMS后台查询功能的实现（基于Laravel-Repository）/index.html","hash":"f04307561210f967804cf8b434fad70b3e65fe43","modified":1599787385527},{"_id":"public/2017/05/23/晚霞无限好，只是下班晚/index.html","hash":"83946c3528525a177d713f721d78f9d4c3e2955c","modified":1599787385527},{"_id":"public/2017/05/20/bd：快速返回某级父目录而不用冗余地输入-“cd-”/index.html","hash":"7fb6c22f76ceed2d414f8aa25876d52d32a2f17b","modified":1599787385527},{"_id":"public/2017/05/15/Laravel-项目中-远程把图片下载到本地/index.html","hash":"92c009198698e3c6b2ef5ea042b6c72396a194af","modified":1599787385527},{"_id":"public/2017/05/12/在iTerm2中使用Zmodem传输文件/index.html","hash":"415414444e71be9f37200c9322d7f0e3566f2b83","modified":1599787385527},{"_id":"public/2017/05/06/centOS 安装 PHP7/index.html","hash":"06fe778dc68a9d0b68d517c726699853f6248b6c","modified":1599787385527},{"_id":"public/2017/04/24/hexo 搭建个人博客的学习记录-yelee 主题设置/index.html","hash":"fc24bd6c5a8db77e8ce84d39e2bdc941ebcff679","modified":1599787385527},{"_id":"public/2017/04/21/Vagrant-打造PHP开发环境/index.html","hash":"a3161c9b59e5fbb942a253e8d8105ddce3028fb4","modified":1599787385527},{"_id":"public/2017/04/18/hexo 搭建个人博客的学习记录-Git 自动部署代码到服务器/index.html","hash":"e9d9709dd55ad316d7b8f8c63c5a20b0c9048fad","modified":1599787385527},{"_id":"public/2017/04/17/【记录】PHP项目中使用Openssl加密/index.html","hash":"a55f6ec67504b5a364c9b196e13777ee3d6beb5f","modified":1599787385527},{"_id":"public/2017/04/11/git 的几个小问题/index.html","hash":"948d90c6eccf1fec28258b9795ef5aa34ec43c64","modified":1599787385527},{"_id":"public/2017/04/10/Linux-懒人工具---autojump/index.html","hash":"8e6d8f8f6cb775ceeb916d2e692b35f136bd50e2","modified":1599787385527},{"_id":"public/2017/04/06/MarkDown-常用语法/index.html","hash":"1fd2c2a2a118526e8fe7eab166d1eb4772620971","modified":1599787385527},{"_id":"public/2017/03/06/php7-安装-mysql-扩展/index.html","hash":"880335d1ae1a44fea705ba54fc10cfa46d92405d","modified":1599787385527},{"_id":"public/2017/03/03/Crontab-学习笔记/index.html","hash":"01f5230aec75c936a268173bed3a49f60a14f21d","modified":1599787385527},{"_id":"public/2017/02/22/Shell-脚本学习记录（1）/index.html","hash":"f5f38d6cdd06cd6e604ee745d30f2839b89534aa","modified":1599787385527},{"_id":"public/2017/02/04/配置和使用-Xdebug-方法二/index.html","hash":"2804eded05e148d83e7fe462815c1d4f455fa6e4","modified":1599787385527},{"_id":"public/2017/02/03/配置和使用-Xdebug-(Laravel-+-Homestead-+-Xdebug)/index.html","hash":"44d284ad0864b55905e5dd80ed58e32028ea13d7","modified":1599787385527},{"_id":"public/2017/01/31/【记录】Linux-开启-php-的-openssl扩展/index.html","hash":"ff92a45add3d8b5a23bc522e70722f66c5351dab","modified":1599787385527},{"_id":"public/2017/01/17/Linux-安装-http2-支持/index.html","hash":"5e03bf3eb6885adc145d4bbe759c3554a92b538e","modified":1599787385527},{"_id":"public/2017/01/12/Mac-启动加载文件顺序问题/index.html","hash":"a6f5f812f9b692e0b4c49f289bb16ec8dbfd286b","modified":1599787385527},{"_id":"public/2017/01/09/使用-Sublime-替换文本中的换行-回车符等特殊符号/index.html","hash":"21517ddf9ac6c650c86e882fc4af31414984a44e","modified":1599787385527},{"_id":"public/2017/01/03/把mac上的默认php修改为MAMP等扩展环境中的php-版本/index.html","hash":"318b76a498e3e5695878974eb33d767b3ec50b39","modified":1599787385527},{"_id":"public/2016/12/30/Yii-框架-开启网页调试功能/index.html","hash":"d4c4408d71fd2a68e6c4ddb8c2340ae3b7d19a50","modified":1599787385527},{"_id":"public/2016/12/23/mac-下搭建-laravel-运行环境/index.html","hash":"d82f62a0d804e4365f67c057f995bb3490bf1fa0","modified":1599787385527},{"_id":"public/2016/12/03/全新离线安装Laravel-Homestead-记录/index.html","hash":"3e99bbec123693fc69af789aeabe8037366d6018","modified":1599787385527},{"_id":"public/2016/11/15/mac-中-mamp-pro-的-localhost-显示为-403-Forbidden/index.html","hash":"833fa2f0f536257957af0f6254bf9da25aed8395","modified":1599787385527},{"_id":"public/2016/11/12/使用终端卸载-Ubuntu-应用/index.html","hash":"4ee3f26e87b2b7c25238a255bf51ea56878709f8","modified":1599787385527},{"_id":"public/2016/11/07/Git-入门指南/index.html","hash":"dfd47ee5089ebeb1e357b3fbc7708f6626b05f8c","modified":1599787385527},{"_id":"public/2016/11/04/Mac-下如何快速搭建-PHP-集成环境/index.html","hash":"5471f8e31c13f80c0d176ee9ebf420aa6f9d08ba","modified":1599787385527},{"_id":"public/2016/10/08/mac-内置与-brew-安装的-openssl-冲突解决方案/index.html","hash":"d65c1e66a53701fc77bd3def5f48d8d8b5f59a47","modified":1599787385527},{"_id":"public/2016/09/03/DEDECMS-{dede-global-cfg_templets_skin-}-调用多一层目录怎么解决-/index.html","hash":"a469fc8a28ebc697d8d8e901bf7c7134d9c37407","modified":1599787385527},{"_id":"public/2016/08/21/iThoughtX-for-Mac-常用快捷键/index.html","hash":"989f9778e17202572cf63aa5ae99fa67609b6446","modified":1599787385527},{"_id":"public/archives/index.html","hash":"76aaac84dc265e04a603c7b5857e29a174568234","modified":1599787385527},{"_id":"public/archives/page/2/index.html","hash":"32b17d0b85edd9da0829307fe2f2abab65063f1e","modified":1599787385527},{"_id":"public/archives/page/3/index.html","hash":"90483259030b5de23f2407eff159501783f58c63","modified":1599787385527},{"_id":"public/archives/page/4/index.html","hash":"fee4e82991a14fb4237dba6c4a03e3a6c41032e3","modified":1599787385527},{"_id":"public/archives/page/5/index.html","hash":"838a1f2782a32636e6d677cba63f4e3c556b507e","modified":1599787385527},{"_id":"public/archives/page/6/index.html","hash":"703651b9b094c7bc7557c05cd8a58bbb3b7960e8","modified":1599787385527},{"_id":"public/archives/page/7/index.html","hash":"9ec5ed6ca102054538f57a9637f39fa328fe2ef9","modified":1599787385527},{"_id":"public/archives/page/8/index.html","hash":"1927b42e4eb997f9dde84cdf53edde80eadbb4b2","modified":1599787385527},{"_id":"public/archives/2016/index.html","hash":"ee082e3f80ea40cc59a3dd8b6e63e6d0bce88264","modified":1599787385527},{"_id":"public/archives/2016/08/index.html","hash":"a6074434f4826d9b1d5980c6cd173ab826223cb1","modified":1599787385527},{"_id":"public/archives/2016/09/index.html","hash":"29ea69fb0d00147c13b90a2b0d720281b00fec21","modified":1599787385527},{"_id":"public/archives/2016/10/index.html","hash":"6db9329988f6f29637cddaa4fd380db44e467c10","modified":1599787385527},{"_id":"public/archives/2016/11/index.html","hash":"0150617f2c0cb866a6f7b2cbe15395242f58c5b3","modified":1599787385527},{"_id":"public/archives/2016/12/index.html","hash":"e3ed147ede76d4878fe86fd9e326951f3d31316d","modified":1599787385527},{"_id":"public/archives/2017/index.html","hash":"36d0e1e17c25c4596773b5c645e2a714f280d0de","modified":1599787385527},{"_id":"public/archives/2017/page/2/index.html","hash":"3ffee423857b137ecd92fb24ec8aed183c946ca0","modified":1599787385527},{"_id":"public/archives/2017/page/3/index.html","hash":"d559627a01b7a2980a1b528a916b77dbd424e734","modified":1599787385527},{"_id":"public/archives/2017/page/4/index.html","hash":"0123853fd7577442c1392297d2ca22268cddc473","modified":1599787385527},{"_id":"public/archives/2017/page/5/index.html","hash":"27988c34c7b849010d37877ba94194005099ebc2","modified":1599787385527},{"_id":"public/archives/2017/01/index.html","hash":"ed7e8ec1f226cb77d9d7a2e9f1375e0abb6da24e","modified":1599787385527},{"_id":"public/archives/2017/02/index.html","hash":"f6790c05343033d5a848379596a5fe127910b1b7","modified":1599787385527},{"_id":"public/archives/2017/03/index.html","hash":"46a788cab461c9b7c7041b16c3ea82369b6f2f56","modified":1599787385527},{"_id":"public/archives/2017/04/index.html","hash":"c90a61facb7c3a022cce2cd083c9d1a0f9f44501","modified":1599787385527},{"_id":"public/archives/2017/05/index.html","hash":"63b62001b6ec3cd3b5db26d5950d72b26ccea886","modified":1599787385527},{"_id":"public/archives/2017/06/index.html","hash":"d170d64b26337e5ddbc6f2e06dd2ef2fd7264e07","modified":1599787385527},{"_id":"public/archives/2017/07/index.html","hash":"c3366a8445d31c90a8a71804bca3244b12b59e6f","modified":1599787385527},{"_id":"public/archives/2017/10/index.html","hash":"aaec4828866e6b068b33d4dc2348f99b0d4431a9","modified":1599787385527},{"_id":"public/archives/2017/11/index.html","hash":"a095cabcb77de77db4ef2fb1dfe669b6dc057a6e","modified":1599787385527},{"_id":"public/archives/2017/12/index.html","hash":"2bd990741d46acc2f14b8927458924c5266b97ed","modified":1599787385527},{"_id":"public/archives/2018/index.html","hash":"b8673a3e1f0af9a2bacf83740e18098aa45007b7","modified":1599787385527},{"_id":"public/archives/2018/page/2/index.html","hash":"7abe4ca36e095ef7b1f8ab3bcc35a01073d5919c","modified":1599787385527},{"_id":"public/archives/2018/page/3/index.html","hash":"1fb83cb944e09e512ba2dd224b9e90b167245cef","modified":1599787385527},{"_id":"public/archives/2018/01/index.html","hash":"12d4e16ae579c148ae44769b7878ea705f485a84","modified":1599787385527},{"_id":"public/archives/2018/02/index.html","hash":"1cf51a16c973fbafa37cd367ae24ff6e07dc0337","modified":1599787385527},{"_id":"public/archives/2018/02/page/2/index.html","hash":"8faa1d6413737c27c1dbe87cae7155a735927638","modified":1599787385527},{"_id":"public/archives/2018/02/page/3/index.html","hash":"b470d44f1e77963baec961d6e8eb13d52e22a61b","modified":1599787385527},{"_id":"public/archives/2018/04/index.html","hash":"b254f09712b0b31f17d9fe0b4d9bd2870d8db27e","modified":1599787385527},{"_id":"public/archives/2018/06/index.html","hash":"7aadee42cba9bd6bf8be8952e617fb1a7cd04a18","modified":1599787385527},{"_id":"public/archives/2019/index.html","hash":"eae25fc64a1512878cb2c2b2f78c1c3c565715ce","modified":1599787385527},{"_id":"public/archives/2019/02/index.html","hash":"11ba379028239ed899fd3e336a68fb26ac04cdfe","modified":1599787385527},{"_id":"public/archives/2020/index.html","hash":"030a4e6de6d2d4510573fd9433ed0f29f092b4db","modified":1599787385527},{"_id":"public/archives/2020/09/index.html","hash":"3f28664400b9551269df1464592227434df78f06","modified":1599787385527},{"_id":"public/index.html","hash":"6d5273a093ff459cd5046f6a21e0d0892d8d1662","modified":1599787385527},{"_id":"public/page/2/index.html","hash":"320371dde94be1e21bec6305a169fb18eae4be5d","modified":1599787385527},{"_id":"public/page/3/index.html","hash":"c3d0fd2c0c13e52b3d75de576fb53a635ada5b22","modified":1599787385527},{"_id":"public/page/4/index.html","hash":"ef7b8d49690f930e7e258f13a1030a2156945ff8","modified":1599787385527},{"_id":"public/page/5/index.html","hash":"30dcaa44cc0c97eea8d0e3c77d84f513b4439592","modified":1599787385527},{"_id":"public/page/6/index.html","hash":"b38ae690d34e0b75622fa835a26d61a4f50d7e85","modified":1599787385527},{"_id":"public/page/7/index.html","hash":"3f2ce03ded84d6934a0e591025d6a64696518c2e","modified":1599787385527},{"_id":"public/page/8/index.html","hash":"5381b4ca790c1c9cd746db57de9c08a714f7ceec","modified":1599787385527},{"_id":"public/categories/PHP/index.html","hash":"c8782264764fcf2a644166ed13c25194627f6fac","modified":1599787385527},{"_id":"public/categories/laravel/index.html","hash":"2e9f3e620a35dc4e36f64ca4430a6985f09b6817","modified":1599787385527},{"_id":"public/categories/Laravel/index.html","hash":"6a7e14a968a7564c846e3e2d1113e5737e1e1c5c","modified":1599787385527},{"_id":"public/categories/linux/index.html","hash":"0609ad86ff8853e34677fb935da1ec3893ba5123","modified":1599787385527},{"_id":"public/categories/Mac/index.html","hash":"83f9b88060205e75132802f6d56a9473028026dd","modified":1599787385527},{"_id":"public/categories/trivia/index.html","hash":"7e7755e2128271c0a0c4e80e32cc31a0b67973fe","modified":1599787385527},{"_id":"public/categories/Liunx/index.html","hash":"7f5f6e0ef50ac58756a55cc4cc66a198f72c6fd3","modified":1599787385527},{"_id":"public/categories/html/index.html","hash":"bc244d5453651538685591dcbdea0e5ed3ebb132","modified":1599787385527},{"_id":"public/categories/图集/index.html","hash":"09c654a423f06e5d80daa22fab0ae878b4be1ed8","modified":1599787385527},{"_id":"public/tags/trivia/index.html","hash":"91326f16aafc7308310e1d9c3287d0c93bb72745","modified":1599787385527},{"_id":"public/tags/xdebug/index.html","hash":"ff72c899ac408c633ee7aa0a3078b1b5296bee8f","modified":1599787385527},{"_id":"public/tags/CGI/index.html","hash":"1d7c05df4255270c4d048bb5275b34dbe4f44f37","modified":1599787385527},{"_id":"public/tags/crontab/index.html","hash":"aafaaa1d9e9dc25b81b1a759490737bd2586b748","modified":1599787385527},{"_id":"public/tags/DEDECMS/index.html","hash":"650043eb04ecb2fac42c185824d3c23622f5d661","modified":1599787385527},{"_id":"public/tags/git/index.html","hash":"f23db99e583c973ef9df4e9aab2412ab00830da7","modified":1599787385527},{"_id":"public/tags/Laravel/index.html","hash":"4fe9240ea1338fcaef9f6b4708813a6f180112dc","modified":1599787385527},{"_id":"public/tags/laravel/index.html","hash":"6c9d7ed5d4561817d313769efef2637c6ea57915","modified":1599787385527},{"_id":"public/tags/http2/index.html","hash":"07bb33c35ef2f75c9f52ce7fddd1ff668528874e","modified":1599787385527},{"_id":"public/tags/Linux/index.html","hash":"12f2bd3b1a0043efe23bcc825e20c05db1183f56","modified":1599787385527},{"_id":"public/tags/MVC/index.html","hash":"30ace2957bfc1fddb9c5f67bdc03b442743288c6","modified":1599787385527},{"_id":"public/tags/mac/index.html","hash":"dc8bc6fd5ea367655bce72a0c0e6b69f6232cfc1","modified":1599787385527},{"_id":"public/tags/Mac/index.html","hash":"ce7e7db36f3cde69b7240c56b63ead312e994990","modified":1599787385527},{"_id":"public/tags/Charles/index.html","hash":"2b1bde761c42dcfc6f1932be6c40bfc8455a5d29","modified":1599787385527},{"_id":"public/tags/MarkDown/index.html","hash":"c7c0bd687a24f119461615b7db33cd6aa37011d7","modified":1599787385527},{"_id":"public/tags/MySQL/index.html","hash":"b65316c373299bf3394b74b36fc80968de9d05ea","modified":1599787385527},{"_id":"public/tags/shadowsocks/index.html","hash":"a6141a5010e17f25220f1d220df8ca6df0c1b92a","modified":1599787385527},{"_id":"public/tags/shell/index.html","hash":"1421702313eb67463ddfbf3a6de8dc65a69fc743","modified":1599787385527},{"_id":"public/tags/Yii/index.html","hash":"990cc09d1da69a9837c7a66dc55a3fe62ccbc0bd","modified":1599787385527},{"_id":"public/tags/PHP/index.html","hash":"01452ce7a060dd36cbb5849305a398cbf974dfa0","modified":1599787385527},{"_id":"public/tags/hexo/index.html","hash":"0644b8e918de40e5eb5183b4cc0add1b5b5f569b","modified":1599787385527},{"_id":"public/tags/openssl/index.html","hash":"3502eb99620c91302672965199de4f53ec726687","modified":1599787385527},{"_id":"public/tags/nginx/index.html","hash":"e13a57a9d016cceeec02c770f142757187319771","modified":1599787385527},{"_id":"public/tags/docker/index.html","hash":"14c8110c862deffa88587d91ffa70e906c564745","modified":1599787385527},{"_id":"public/tags/Docker/index.html","hash":"764049b5bba53cad5f0bcc9bd396af7607e9c014","modified":1599787385527},{"_id":"public/tags/mysql/index.html","hash":"4aef00f867212a09b64a349123184ddf9d51ec28","modified":1599787385527},{"_id":"public/tags/sed/index.html","hash":"51d2aae199a33813539c0aab5203990a98354fd6","modified":1599787385527},{"_id":"public/tags/正则表达式/index.html","hash":"f15ee21513dda5336dacd87dd9969f474b326133","modified":1599787385527},{"_id":"public/tags/ubuntu/index.html","hash":"a4cabd0b80f6e2efb85c09e8dedda033fd1265f1","modified":1599787385527},{"_id":"public/tags/sublime/index.html","hash":"9820b4eb90bdf0c26d50b76a4a6f195a36dbe5cd","modified":1599787385527},{"_id":"public/tags/小程序/index.html","hash":"6114b2f0716f99d25fe73db17e1ea1031346b1d0","modified":1599787385527},{"_id":"public/tags/算法/index.html","hash":"6eb4de55ae4e30e9952526ad2bd5decec8d752fa","modified":1599787385527},{"_id":"public/tags/php/index.html","hash":"df955bcd84b03705f5ef849f5eecbca371a29b51","modified":1599787385527},{"_id":"public/tags/wangEditor/index.html","hash":"7093082e9760b2b2cabfbb3372e9932b37fb80b1","modified":1599787385527},{"_id":"public/tags/dropzone/index.html","hash":"f5f5bd67852af3eebad72a3853431e213d75c551","modified":1599787385527},{"_id":"public/tags/晚霞/index.html","hash":"6041b02d88ca82407f1fb1e24cf679c8315339f1","modified":1599787385527},{"_id":"public/tags/青海湖/index.html","hash":"eb5167b1f00cef3b73a1d782daeaa500f3a51662","modified":1599787385527},{"_id":"public/tags/高并发/index.html","hash":"8ecc8319c511b987d9d661ecd5e01d3386712dfd","modified":1599787385527},{"_id":"public/tags/高并发/page/2/index.html","hash":"3dd37631e85dd3ea5b54eff612f7db3a94c3dba9","modified":1599787385527},{"_id":"node_modules/hexo-theme-next/LICENSE.md","hash":"63ea7df5a8dc1b23cc92ca9de3ed16d53367f360","modified":499162500000},{"_id":"node_modules/hexo-theme-next/README.md","hash":"d5559b6910919a69bbde2e72e504a470d84afbe2","modified":499162500000},{"_id":"node_modules/hexo-theme-next/_vendors.yml","hash":"199c9f4fcf70fc3952a2988bf62e539b68c53cf7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/_config.yml","hash":"f2e57958f119b5c5263626a4ce479a97deeac0dc","modified":499162500000},{"_id":"node_modules/hexo-theme-next/package.json","hash":"d0b607de4fbc22a045eea4a595ee6ebbc77fe332","modified":1599787369004},{"_id":"node_modules/hexo-theme-next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":499162500000},{"_id":"node_modules/hexo-theme-next/docs/LICENSE.txt","hash":"8ef5fc1147c196680b06e1accab80c8d236ab951","modified":499162500000},{"_id":"node_modules/hexo-theme-next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/ar.yml","hash":"7a62243ec54196e3d1bea7364f05aded490bc234","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/de.yml","hash":"dc448f724c7d436233e9567711a09e0d56e60e3b","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/en.yml","hash":"48a76170d70ef7c1fac96720bc5064b43061708d","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/es.yml","hash":"c3506dfaa771e827ae6adb322477c6e835cd0f09","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/fa.yml","hash":"649823297167b902455c0aec8ddebb462df71c7d","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/fr.yml","hash":"8ddfe98e7847ee8f1eaba9119f9fbdc42d7ec120","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/id.yml","hash":"ac018805190bc4bdc06091f5a6444e612fc700b0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/it.yml","hash":"82a93c32b3fcf6517441cdc73f75bc6173beb392","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/ja.yml","hash":"fec1e1c15ad2df7ed1249173cc719ccba6d3b842","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/ko.yml","hash":"8342df2f4190ba4ee004b70d1d6ccd341033dbe7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/nl.yml","hash":"0d3b56613197cb190900311507535db41daec7d4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/pt-BR.yml","hash":"47daeaa23c4db073e77761c9a6f62d3932af06ec","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/pt.yml","hash":"e0e2675261e2e80f7ce7d19c945c08217b068d81","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/ru.yml","hash":"fdf5c623890db24cb56ab5ffe0c49db3542477c8","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/tr.yml","hash":"54de3d8d85e3c7b14b163c3d322411b7301a09b3","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/uk.yml","hash":"1c9a0b8d8160c77cc62064207d57f460f365cae9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/vi.yml","hash":"1f9657b58e11db21f93eb895c90123b8f91751a7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/zh-CN.yml","hash":"6f7c742316c96d5b71da50fddfb060ff7ec1ea99","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/zh-HK.yml","hash":"149fccd0afdbc8db76e372cbc73d7b5f07bb7515","modified":499162500000},{"_id":"node_modules/hexo-theme-next/languages/zh-TW.yml","hash":"d534f321ee0c235e1ebfea383eb1892bbd7d7e95","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_layout.njk","hash":"bf7e6ca826b6c3f85e14da61d56d7b836d2414c4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/archive.njk","hash":"08885f48d5878c92c910f8c41e3209eb07b9b80e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/category.njk","hash":"434fc2b27120ebae91522002eb40e16f2158bd4f","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/index.njk","hash":"d8fa14549fa061e7bdba4ec1472cb45ecea96382","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/page.njk","hash":"4f8f377e4f5511e27de1c2e4a1c13374b6a5d9bd","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/post.njk","hash":"6abeb85fb3e4c382ed4bb6049b12a807e6226e67","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/tag.njk","hash":"09075c80b53b06826e7eb9ce838bca9dc363fac1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/renderer.js","hash":"c53dbede2ad5f68d7349bc5ed8ac7157d723e987","modified":499162500000},{"_id":"node_modules/hexo-theme-next/docs/ru/README.md","hash":"f0255b119e28102aef403609c29a605f15b95b70","modified":499162500000},{"_id":"node_modules/hexo-theme-next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"0e204dde6d21f100cba6ca7751de71848490759e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/docs/zh-CN/CONTRIBUTING.md","hash":"8ee5ca39ac4a372a5c0f16e344bbe578af4aeae4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/docs/zh-CN/README.md","hash":"fc9df0ab84387f0468baa0f4a53c7dd9931dbc6d","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/comments.njk","hash":"334e8d8117a46c8c097788811322a62627952219","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/footer.njk","hash":"9c69b85c9ad86ef5c11d2245f91d98f1be248c40","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/languages.njk","hash":"ba9e272f1065b8f0e8848648caa7dea3f02c6be1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/pagination.njk","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/widgets.njk","hash":"24eb5b683310810f93c1d7f68f8f70f1a29fd217","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_macro/post.njk","hash":"f381d4c485ae484a114040d5654db648e4ac7473","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_macro/sidebar.njk","hash":"3481594d36df9eb5e220a6b981d3e5630376a597","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_scripts/index.njk","hash":"48cbbca0e4f97b8c25f2a5c408071603cd257a65","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_scripts/noscript.njk","hash":"4f250d0bf80be06dd2c95c1d4c2ba2624b59cf2a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_scripts/pjax.njk","hash":"28a3bcb1ce50924a5a48b0f3756ac3a8736867f1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_scripts/vendors.njk","hash":"bada07da2a47ed6de6081796367b19dd9e906cfb","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/baidu-push.njk","hash":"8627c8c8b031ecee16c522433b66fa4d6979b8ea","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/index.njk","hash":"dc4d2dec2f726b8c5c9f5ac7d6dd0eef0814a0d0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/quicklink.njk","hash":"294b7f6a4fa566e369d8be0ce7b28f35b6c14563","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/rating.njk","hash":"2731e262a6b88eaee2a3ca61e6a3583a7f594702","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/events/index.js","hash":"89091bc943cd8b8c63b8af3d26fb0a027048e9ba","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/locals.js","hash":"fa1e558f058f93455acdd553ab1be30b26f137e4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/minify.js","hash":"be0574c64a38210e449c99d38a760452015060a3","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/post.js","hash":"bac5646993153f9f6a630c9f0052bb17fa760a9c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/helpers/engine.js","hash":"2861b738b6f03114b6f922e794fe2b20090d1438","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/helpers/font.js","hash":"9cf01a3cf62d9b5a1a0db8145088774bf94045c8","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-config.js","hash":"3b2261da74c7b33cabfbc82cbb3ce9c8046314d4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-url.js","hash":"577c510374cf9bcfa8d3a1027e42411a9324805e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/helpers/next-vendors.js","hash":"2f4152bb450dc4ca8e802e78a21c1858fae298b9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/group-pictures.js","hash":"9836e3212f889e94ada4c354c7b83f7d7caa9aa7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/link-grid.js","hash":"9e2c58d1a4d1dd84fa86144e5b4576b2fd10a37f","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/mermaid.js","hash":"464effc08e757ce8e1bb094707d06ad829af9d62","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/note.js","hash":"05be417a17385a31e1a021e1a54b15046cfd8408","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/pdf.js","hash":"27129fc4014d723ba93ac77b11342da2ee445d96","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/tabs.js","hash":"2bf00d56b3b289a7dd27e9b5820430a2457a19f3","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/video.js","hash":"911851fb3a56570b761d133a6e1531ebf864ea83","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_colors.styl","hash":"b37f9847d2f95632e911df670b51921a7d748068","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_mixins.styl","hash":"b9c3d3087a917c94cf34ffd6621528d377af8fc9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/main.styl","hash":"a3a3bbb5a973052f0186b3523911cb2539ff7b88","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/algolia-search.js","hash":"a6f78c4cfffa976e4b8043e3486ce99aaba02bda","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/bookmark.js","hash":"e45e1fbb7c6d645e9c410759486216e570d02bef","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/local-search.js","hash":"d57be5b0349610b5b0de303a9574117365d6d554","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/next-boot.js","hash":"da67f3eed604dcdc4e89280c9db69fe1f62818e9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/schedule.js","hash":"ababd67895ce49049271601c6928fce56a1c6bbb","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/utils.js","hash":"eed4ec020dbf499b6479cbe4e1a90b0b4fe4d1e8","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/head/head-unique.njk","hash":"37bdf020591feb0cf72327c9efd755bf78a0afd6","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/head/head.njk","hash":"6b502f9e682d1e0083abe229a2f48523ff852c62","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/brand.njk","hash":"c082a16163d1fb5d7cf858fb7522fca9d18f1ba6","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/index.njk","hash":"53895b3af95667edc5bf5d7356f8a2b4fe091447","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/menu-item.njk","hash":"9440d8a3a181698b80e1fa47f5104f4565d8cdf3","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/menu.njk","hash":"c9390824b57f23b7c8a5c23a9834514123673766","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/header/sub-menu.njk","hash":"75a158a5b54a3a76ee6590f5e0e2dd4a9f0be869","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/breadcrumb.njk","hash":"1b6f08cd884081cc67f02c09ce4696c2df4a9d20","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/page-header.njk","hash":"789915339a6234d6dd7c710cc1f8e728d9b81d35","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/schedule.njk","hash":"9d650333160ad1977fe42d9770869ff1660a95fe","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-followme.njk","hash":"1d1eba50a28518dea5bba34b2737cfb9b0f2cf49","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-footer.njk","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-meta.njk","hash":"fbdb5cdbd80970f201f5c75369eaa00aea369235","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-related.njk","hash":"f79c44692451db26efce704813f7a8872b7e63a0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/post/post-reward.njk","hash":"a9bb52d0537d27cfe670d80e716da6780786ab8a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/search/algolia-search.njk","hash":"c2ccaac9caeea1a43dc31f4f8368f8f548aab0af","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/search/index.njk","hash":"b7a66a465e897c27624f0c441375c95c4cb7a5aa","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/search/localsearch.njk","hash":"90156f42d6e6e326ed38482d6623a0aac0352016","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_partials/sidebar/site-overview.njk","hash":"a27b994ab99c684765895ffebf72ae30dcfa0703","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/baidu-analytics.njk","hash":"4790058691b7d36cf6d2d6b4e93795a7b8d608ad","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/google-analytics.njk","hash":"ad197fd728dd7ac90f910fdf80ce848eab3ff187","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/growingio.njk","hash":"5adea065641e8c55994dd2328ddae53215604928","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/analytics/index.njk","hash":"d87df68dff14cfb4d91a77230cd1ac795c2a22d5","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/chat/chatra.njk","hash":"f910618292c63871ca2e6c6e66c491f344fa7b1f","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/chat/tidio.njk","hash":"cba0e6e0fad08568a9e74ba9a5bee5341cfc04c1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/changyan.njk","hash":"5c2cd9b6f02bcb6248d3f18638a58e329fe8c0d1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/disqus.njk","hash":"cc1450d62d76e59968bdd25836694b8339207384","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/disqusjs.njk","hash":"54eab4840443262432ec7c47e56e9859ace2a902","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/gitalk.njk","hash":"ec0474e23ca122b34858ffb0bb8c99f241749c61","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/livere.njk","hash":"6252b0353c6a36d03c68ebec1073293442221bd1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/comments/valine.njk","hash":"ae2cca696dba96dda7958f0d2b642257599dc11c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/math/index.njk","hash":"b0efe26601037e621b5cb16f0fe2f347ee27acdb","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/math/katex.njk","hash":"b6746dfad32cc8a46ff8f4194a7a16ca41744803","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/math/mathjax.njk","hash":"a8239f99b316e6c060bad8173be3a25c67138697","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/cnzz-analytics.njk","hash":"a17ace37876822327a2f9306a472974442c9005d","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/firestore.njk","hash":"b70157965285a8c1e003c570cfd4b40bcc1fa719","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/index.njk","hash":"8b956fb56284e8fa4a4731b1efd1f25e1b2b4a78","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/statistics/lean-analytics.njk","hash":"7f01be99413143c5158bda6d83d72bfae6ea5864","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/tags/mermaid.njk","hash":"007da98b913a62946c03a87f8fa25b3db856caa1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/tags/pdf.njk","hash":"67d80a57f6b2cf23d56276ca8f30f25e3e8707e9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/config.js","hash":"545ebbd9f5aeb9f7a8e23737664c1f7d701275e1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/injects.js","hash":"7b0ea8d28ced63977dc6539920eb044b1098adcb","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/utils.js","hash":"e227174a8ebab8d5b6e8e26faf4fd66c43f045ca","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/events/lib/vendors.js","hash":"f76c7e13fc4304f86260068c9d83d3477b64ee4b","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/changyan.js","hash":"199fa9a70914d0019cf0e47f55491183d53d1533","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/disqus.js","hash":"a9b18b7447cd5a56cb692c574463a27356eb7fa6","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/disqusjs.js","hash":"7b8ce8e9a71cf083f5337fb7c9586be8f7c316e8","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/gitalk.js","hash":"387e59cd396c62fe095b388c8ff8d4191cfbdeb9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/livere.js","hash":"1198cb63375a53400431c2e65e3361416cdf8eb6","modified":499162500000},{"_id":"node_modules/hexo-theme-next/scripts/filters/comment/valine.js","hash":"c67984fc868d4799b3aa6d3b3cd060e5260b3a98","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Gemini.styl","hash":"f4e694e5db81e57442c7e34505a416d818b3044a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Mist.styl","hash":"f2bd7a213c35b37233c687bd4ce0fc1de37bc988","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_variables/Pisces.styl","hash":"c65536a128b9bc9dbe2fbb1b235a3cded2891002","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_variables/base.styl","hash":"0bda922162bca08b0191e5b54857772e4bdabe3a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/js/schemes/muse.js","hash":"d7a6c12bb534810eb748d0ba28aff67cccf0bb3f","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/search/algolia-search.njk","hash":"97035261aa85c7d39c6ce1211cdefc6248c0446d","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/search/localsearch.njk","hash":"767b6c714c22588bcd26ba70b0fc19b6810cbacd","modified":499162500000},{"_id":"node_modules/hexo-theme-next/layout/_third-party/search/swiftype.njk","hash":"ba0dbc06b9d244073a1c681ff7a722dcbf920b51","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/back-to-top-sidebar.styl","hash":"d4809783ded05625675b1b4bbd9e99d7f5f7d7f9","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/back-to-top.styl","hash":"92915560810c0311dada43ed629b8fc4ff0fc7a4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/components.styl","hash":"1c75a837faae9aa2d0a5f30d2078aa8d2ccc2552","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/reading-progress.styl","hash":"ee8fb8348aa76a9b346927ba4cae5666d8d777f7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/mobile.styl","hash":"28368ac06d04ccf0bbf3dc9e0dfcf341c200b28c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/outline.styl","hash":"0c9f72ad98807521cbdcee7b5bbe2e884311db39","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/base.styl","hash":"ea96e86b6bcb160351c18a7edc4a561918a820cb","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/pagination.styl","hash":"a472fb1afc6486266b85f773501a290e0a80c370","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/scaffolding.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tables.styl","hash":"e1c85ab2831fd7d4bb84aea1850a0160be0023e8","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/toggles.styl","hash":"572a41499391677d84b16d8dbd6a996a3d5ce041","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Gemini/index.styl","hash":"7ad04d5a02a7618ebb09c1d5a435d46c4df2c620","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_header.styl","hash":"06786e1ed8774f8f08cbfc711296cf189aaf1b8c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_layout.styl","hash":"5604ac1e161099a4d3e5657d53507268866dc717","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_menu.styl","hash":"f6d165dae928c12bde3f271d299a93b334116433","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/_posts-expand.styl","hash":"0c4390d3a394c5ba96daec864b118fd0c4a934ff","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_header.styl","hash":"06080fd963c904d96c00eff098a284e337953013","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_layout.styl","hash":"82a29572dd90451f75358a2ee2522b87304a0bb8","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_menu.styl","hash":"c706733f5196776fe2657a9bebe0a727cf8fe8e5","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_sidebar.styl","hash":"e1550114d6f5e828d791831153ef0912a14b4d49","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_header.styl","hash":"be5c46b983df08b9dbac1b4749b1a101b54b6b50","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_layout.styl","hash":"6eee86c8f0175d6c09e434053516cd8556f78d44","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_menu.styl","hash":"c435cfd858bf82726fff2c85d384e2207bea0370","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_sidebar.styl","hash":"826c7f523f1b3a95fedbae7ef3b13ae2f5d41231","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"78f0b6edc296a9ed5144da9f9752c0b96bebfaa5","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/pages.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/schedule.styl","hash":"19fc5ca0784f5d2befddb9d8bc463b916c5c2518","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-body.styl","hash":"5d61dedb3bec1021d52894f9b379e4d0953f6a35","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-collapse.styl","hash":"8998a07acf0dbd10811835c8dfc91d92e680bcae","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-followme.styl","hash":"76d0dfb3a8b873a6180604ac6daecf38b6a963a2","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-footer.styl","hash":"8a2e724df3d5cd14765eb951f0a9e1dba399fd35","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-header.styl","hash":"d6ecc5dfd15c588782ba5e1df9f915b305622aef","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-nav.styl","hash":"cf6540e12c2de5befcfb7e92d915e3b75fd53dfa","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-reward.styl","hash":"27001ad06f69ff035639210ab2f614861b21a4f4","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/post/post.styl","hash":"b3fa752f72ca1413289b76c56fbd33a00e3d25d7","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/gitalk.styl","hash":"8a7fc03a568b95be8d3337195e38bc7ec5ba2b23","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/math.styl","hash":"48ee817d05ddc788423d7f10e9823e23fda81d04","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/related-posts.styl","hash":"2c534d2b2dbc932ad65d335a720a7ba9612bac04","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/search.styl","hash":"2896840ab8ac8ab2a7f76d18df893f290ac31625","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/components/third-party/third-party.styl","hash":"5d8fc91cdb7ee313eb367dcec7d5b2429f98242f","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/footer/footer.styl","hash":"f11dca93e334b68a29e792f7abe682993fab7568","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/bookmark.styl","hash":"8cb89864e8245a356d08ef0fee3133810f646fea","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/github-banner.styl","hash":"254e781e7b25e31a1a589c8b38dc608802f1cc6e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/header.styl","hash":"f1778d2c56974b96dae429456d5c55be325c4946","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/menu.styl","hash":"6d8afd8e23c40bb2b2a2edbe4eb0d2671cd81188","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/site-meta.styl","hash":"57e6b5d82a2d85cabfc7275eb0ac758f3c06991d","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/header/site-nav.styl","hash":"9c8abc55c9d94d384a245013951aba5ecca2f4fe","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"66782e68f1c74a7d0aecef20e2ca16bbe6b52592","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"44487d9ab290dc97871fa8dd4487016deb56e123","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"1f0e7fbe80956f47087c2458ea880acf7a83078b","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"521b36ea7bb3a843029cbfbb6b5e76e91c40a19f","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"55060cade4547779ba5996643d93763373b5127c","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"469855a72d2c2b63a21df8fbcb8cc41d32cb9bde","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"432e73bc4f99322af6af1852e0ea6e674919c31a","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/sidebar.styl","hash":"43f7d37948232553873ee346d625457bfe704e74","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/outline/sidebar/site-state.styl","hash":"77398b426f182823776f38071de3c839e401fbe0","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"83ee4993710fc8daa1c8dbfccd5d5091fd244c30","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/highlight/highlight.styl","hash":"920f21dc03b28f006aef7e9d0fd444c2cd283efc","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"15a5e273a8137550c93c8d2a60f9fcf86e04a89e","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/label.styl","hash":"f09bc97e3681d73c38d7d3c5c271486c2c6537e2","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"acfdec45e56cdd6a5ea61e0154f8a6d1bc068214","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"3c029a003e9bf747e1b9cc7c0c127f6028374876","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/note.styl","hash":"29bef220307d86b1eafbb3714381df32d48b5a60","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/tabs.styl","hash":"dcf426c2a4836386c0c27235de3f9a95c5de67cc","modified":499162500000},{"_id":"node_modules/hexo-theme-next/source/css/_common/scaffolding/tags/tags.styl","hash":"cef4e779473daa3761709958243c6b8a57bbd814","modified":499162500000},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1599787385527},{"_id":"public/images/avatar.gif","hash":"18c53e15eb0c84b139995f9334ed8522b40aeaf6","modified":1599787385527},{"_id":"public/images/cc-by-nc-nd.svg","hash":"c6524ece3f8039a5f612feaf865d21ec8a794564","modified":1599787385527},{"_id":"public/images/cc-by-nc-sa.svg","hash":"3031be41e8753c70508aa88e84ed8f4f653f157e","modified":1599787385527},{"_id":"public/images/cc-by-nd.svg","hash":"c563508ce9ced1e66948024ba1153400ac0e0621","modified":1599787385527},{"_id":"public/images/cc-by-nc.svg","hash":"8d39b39d88f8501c0d27f8df9aae47136ebc59b7","modified":1599787385527},{"_id":"public/images/cc-by-sa.svg","hash":"aa4742d733c8af8d38d4c183b8adbdcab045872e","modified":1599787385527},{"_id":"public/images/cc-by.svg","hash":"28a0a4fe355a974a5e42f68031652b76798d4f7e","modified":1599787385527},{"_id":"public/images/cc-zero.svg","hash":"87669bf8ac268a91d027a0a4802c92a1473e9030","modified":1599787385527},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1599787385527},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1599787385527},{"_id":"public/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1599787385527},{"_id":"public/images/logo.svg","hash":"d29cacbae1bdc4bbccb542107ee0524fe55ad6de","modified":1599787385527},{"_id":"public/css/main.css","hash":"63cdd9d2a6c7cb57e5ab6828913034fb0749f24c","modified":1599787385527},{"_id":"public/js/algolia-search.js","hash":"a6f78c4cfffa976e4b8043e3486ce99aaba02bda","modified":1599787385527},{"_id":"public/js/bookmark.js","hash":"e45e1fbb7c6d645e9c410759486216e570d02bef","modified":1599787385527},{"_id":"public/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":1599787385527},{"_id":"public/js/local-search.js","hash":"d57be5b0349610b5b0de303a9574117365d6d554","modified":1599787385527},{"_id":"public/js/next-boot.js","hash":"da67f3eed604dcdc4e89280c9db69fe1f62818e9","modified":1599787385527},{"_id":"public/js/utils.js","hash":"eed4ec020dbf499b6479cbe4e1a90b0b4fe4d1e8","modified":1599787385527},{"_id":"public/js/schedule.js","hash":"ababd67895ce49049271601c6928fce56a1c6bbb","modified":1599787385527},{"_id":"public/js/schemes/muse.js","hash":"d7a6c12bb534810eb748d0ba28aff67cccf0bb3f","modified":1599787385527}],"Category":[{"name":"PHP","_id":"ckexjtz7r00096wo1fj3d2nde"},{"name":"laravel","_id":"ckexjtz7z000j6wo1g3ge986f"},{"name":"Laravel","_id":"ckexjtz87000v6wo1cwmfdj8y"},{"name":"Linux","_id":"ckexjtz8b00126wo12u61hvvc"},{"name":"Mac","_id":"ckexjtz8i00186wo1a6ne8727"},{"name":"trivia","_id":"ckexjtz8q001n6wo19soh3ave"},{"name":"Liunx","_id":"ckexjtza0003v6wo1cvivfclp"},{"name":"html","_id":"ckexjtza300426wo12uc783bm"},{"name":"图集","_id":"ckexjtza8004f6wo1cani9rs4"}],"Data":[],"Page":[{"title":"404 Not Found：该页无法显示","toc":false,"comments":0,"_content":"<style type=\"text/css\">\n .center {\n        text-align: center;\n        height: 2.5em;\n        font-weight: bold;\n    }\n  .img {\n      display: block;\n      text-align: center;\n      clear: both;\n  }\n</style>\n\n<div class=\"center\" style=\"height:auto;\">\n    <img src=\"http://omp48p40q.bkt.clouddn.com/17-5-5/43408164-file_1493994864854_fae0.jpg\" alt=\"404 Not Found：该页无法显示\">\n</div>\n\n<p class=\"center\">很抱歉，您所访问的地址并不存在: </p>\n\n<p class=\"center\"><a href=\"/\" target=\"_blank\">回主页</a> · <a href=\"/archives\" target=\"_blank\">所有文章</a> · <a href=\"/about\" target=\"_blank\">留言板</a></p>\n\n<p class=\"center\">可在边栏搜索框中对本站进行检索，以获取相关信息。</p>\n\n","source":"404/index.md","raw":"\n---\ntitle: 404 Not Found：该页无法显示\ntoc: false\ncomments: false\npermalink: /404\n---\n<style type=\"text/css\">\n .center {\n        text-align: center;\n        height: 2.5em;\n        font-weight: bold;\n    }\n  .img {\n      display: block;\n      text-align: center;\n      clear: both;\n  }\n</style>\n\n<div class=\"center\" style=\"height:auto;\">\n    <img src=\"http://omp48p40q.bkt.clouddn.com/17-5-5/43408164-file_1493994864854_fae0.jpg\" alt=\"404 Not Found：该页无法显示\">\n</div>\n\n<p class=\"center\">很抱歉，您所访问的地址并不存在: </p>\n\n<p class=\"center\"><a href=\"/\" target=\"_blank\">回主页</a> · <a href=\"/archives\" target=\"_blank\">所有文章</a> · <a href=\"/about\" target=\"_blank\">留言板</a></p>\n\n<p class=\"center\">可在边栏搜索框中对本站进行检索，以获取相关信息。</p>\n\n","date":"2020-09-11T01:04:35.030Z","updated":"2020-09-11T01:04:35.030Z","path":"/404.html","layout":"page","_id":"ckexjtz7b00006wo1f1f1c80p","content":"<style type=\"text/css\">\n .center {\n        text-align: center;\n        height: 2.5em;\n        font-weight: bold;\n    }\n  .img {\n      display: block;\n      text-align: center;\n      clear: both;\n  }\n</style>\n\n<div class=\"center\" style=\"height:auto;\">\n    <img src=\"http://omp48p40q.bkt.clouddn.com/17-5-5/43408164-file_1493994864854_fae0.jpg\" alt=\"404 Not Found：该页无法显示\">\n</div>\n\n<p class=\"center\">很抱歉，您所访问的地址并不存在: </p>\n\n<p class=\"center\"><a href=\"/\" target=\"_blank\">回主页</a> · <a href=\"/archives\" target=\"_blank\">所有文章</a> · <a href=\"/about\" target=\"_blank\">留言板</a></p>\n\n<p class=\"center\">可在边栏搜索框中对本站进行检索，以获取相关信息。</p>\n\n","site":{"data":{}},"excerpt":"","more":"<style type=\"text/css\">\n .center {\n        text-align: center;\n        height: 2.5em;\n        font-weight: bold;\n    }\n  .img {\n      display: block;\n      text-align: center;\n      clear: both;\n  }\n</style>\n\n<div class=\"center\" style=\"height:auto;\">\n    <img src=\"http://omp48p40q.bkt.clouddn.com/17-5-5/43408164-file_1493994864854_fae0.jpg\" alt=\"404 Not Found：该页无法显示\">\n</div>\n\n<p class=\"center\">很抱歉，您所访问的地址并不存在: </p>\n\n<p class=\"center\"><a href=\"/\" target=\"_blank\">回主页</a> · <a href=\"/archives\" target=\"_blank\">所有文章</a> · <a href=\"/about\" target=\"_blank\">留言板</a></p>\n\n<p class=\"center\">可在边栏搜索框中对本站进行检索，以获取相关信息。</p>\n\n"},{"title":"categories","date":"2017-05-20T16:34:53.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2017-05-21 00:34:53\ntype: \"categories\"\n---\n","updated":"2020-09-11T01:04:35.063Z","path":"categories/index.html","comments":1,"layout":"page","_id":"ckexjtz7j00026wo13y9qed2h","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"about","date":"2017-05-05T13:12:27.000Z","_content":"\n本站所有文章，仅代表个人观点，与其他任何个人或组织无关！\n\n### 个人介绍\n\n曾经是一位学霸，也曾是一名前线石油工人，目前是一名奋斗于帝都的码农。\n\n即将步入而立之年，有彷徨，有焦虑，也有期待，有夙愿。\n\n热爱运动，喜欢英超，最爱利物浦的那抹红。\n\n目前专注 PHP 开发，熟悉 Linux 和 mysql，关注科技互联网动态。就职于[《财经》](http://news.caijingmobile.com)杂志。\n\n### 我的联系方式\n\n- zzpwestlife@gmail.com\n- 495043143@qq.com\n- 17600140105\n\n### 版权说明\n\n写本站博客的目的，在于记录博主的学习成长过程。除非单独说明，个人转载本站的原创内容，请遵循[「署名-非商业性使用-相同方式共享」](https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh)的创作共享协议。\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2017-05-05 21:12:27\n---\n\n本站所有文章，仅代表个人观点，与其他任何个人或组织无关！\n\n### 个人介绍\n\n曾经是一位学霸，也曾是一名前线石油工人，目前是一名奋斗于帝都的码农。\n\n即将步入而立之年，有彷徨，有焦虑，也有期待，有夙愿。\n\n热爱运动，喜欢英超，最爱利物浦的那抹红。\n\n目前专注 PHP 开发，熟悉 Linux 和 mysql，关注科技互联网动态。就职于[《财经》](http://news.caijingmobile.com)杂志。\n\n### 我的联系方式\n\n- zzpwestlife@gmail.com\n- 495043143@qq.com\n- 17600140105\n\n### 版权说明\n\n写本站博客的目的，在于记录博主的学习成长过程。除非单独说明，个人转载本站的原创内容，请遵循[「署名-非商业性使用-相同方式共享」](https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh)的创作共享协议。\n","updated":"2020-09-11T01:04:35.063Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckexjtz7o00056wo1a6nf2n78","content":"<p>本站所有文章，仅代表个人观点，与其他任何个人或组织无关！</p>\n<h3 id=\"个人介绍\"><a href=\"#个人介绍\" class=\"headerlink\" title=\"个人介绍\"></a>个人介绍</h3><p>曾经是一位学霸，也曾是一名前线石油工人，目前是一名奋斗于帝都的码农。</p>\n<p>即将步入而立之年，有彷徨，有焦虑，也有期待，有夙愿。</p>\n<p>热爱运动，喜欢英超，最爱利物浦的那抹红。</p>\n<p>目前专注 PHP 开发，熟悉 Linux 和 mysql，关注科技互联网动态。就职于<a href=\"http://news.caijingmobile.com/\">《财经》</a>杂志。</p>\n<h3 id=\"我的联系方式\"><a href=\"#我的联系方式\" class=\"headerlink\" title=\"我的联系方式\"></a>我的联系方式</h3><ul>\n<li><a href=\"mailto:&#x7a;&#x7a;&#112;&#x77;&#x65;&#115;&#x74;&#108;&#x69;&#102;&#101;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;\">&#x7a;&#x7a;&#112;&#x77;&#x65;&#115;&#x74;&#108;&#x69;&#102;&#101;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;</a></li>\n<li><a href=\"mailto:&#52;&#x39;&#53;&#x30;&#52;&#x33;&#x31;&#52;&#51;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#109;\">&#52;&#x39;&#53;&#x30;&#52;&#x33;&#x31;&#52;&#51;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#109;</a></li>\n<li>17600140105</li>\n</ul>\n<h3 id=\"版权说明\"><a href=\"#版权说明\" class=\"headerlink\" title=\"版权说明\"></a>版权说明</h3><p>写本站博客的目的，在于记录博主的学习成长过程。除非单独说明，个人转载本站的原创内容，请遵循<a href=\"https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh\">「署名-非商业性使用-相同方式共享」</a>的创作共享协议。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>本站所有文章，仅代表个人观点，与其他任何个人或组织无关！</p>\n<h3 id=\"个人介绍\"><a href=\"#个人介绍\" class=\"headerlink\" title=\"个人介绍\"></a>个人介绍</h3><p>曾经是一位学霸，也曾是一名前线石油工人，目前是一名奋斗于帝都的码农。</p>\n<p>即将步入而立之年，有彷徨，有焦虑，也有期待，有夙愿。</p>\n<p>热爱运动，喜欢英超，最爱利物浦的那抹红。</p>\n<p>目前专注 PHP 开发，熟悉 Linux 和 mysql，关注科技互联网动态。就职于<a href=\"http://news.caijingmobile.com/\">《财经》</a>杂志。</p>\n<h3 id=\"我的联系方式\"><a href=\"#我的联系方式\" class=\"headerlink\" title=\"我的联系方式\"></a>我的联系方式</h3><ul>\n<li><a href=\"mailto:&#x7a;&#x7a;&#112;&#x77;&#x65;&#115;&#x74;&#108;&#x69;&#102;&#101;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;\">&#x7a;&#x7a;&#112;&#x77;&#x65;&#115;&#x74;&#108;&#x69;&#102;&#101;&#x40;&#103;&#109;&#x61;&#x69;&#108;&#46;&#99;&#111;&#109;</a></li>\n<li><a href=\"mailto:&#52;&#x39;&#53;&#x30;&#52;&#x33;&#x31;&#52;&#51;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#109;\">&#52;&#x39;&#53;&#x30;&#52;&#x33;&#x31;&#52;&#51;&#64;&#113;&#113;&#x2e;&#x63;&#x6f;&#109;</a></li>\n<li>17600140105</li>\n</ul>\n<h3 id=\"版权说明\"><a href=\"#版权说明\" class=\"headerlink\" title=\"版权说明\"></a>版权说明</h3><p>写本站博客的目的，在于记录博主的学习成长过程。除非单独说明，个人转载本站的原创内容，请遵循<a href=\"https://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh\">「署名-非商业性使用-相同方式共享」</a>的创作共享协议。</p>\n"},{"title":"友情链接，感谢各位作者","date":"2017-05-20T11:41:26.000Z","_content":"\n\n1. 邹志鹏的简书: http://www.jianshu.com/u/1c27b5d9981e\n\n2. 赵玉涛的博客: http://aword.net/\n\n2. 樊浩柏的博客: https://www.fanhaobai.com/\n\n3. 徐新的博客：http://www.lcode.cc/\n\n4. 赵泽溥的博客: http://www.zepuer.top/\n\n4. 游渔's Blog: http://youyusan.github.io\n\n5. 廖雪峰的官方网站: http://www.liaoxuefeng.com\n\n6. 令狐葱@前端笔记: https://linghucong.js.org/\n\n7. litten 的博客: http://litten.me/\n\n8. xuanwo 的博客: https://xuanwo.org/\n\n9. hktkdy 的博客: http://hktkdy.com/\n\n10. 王昱森的博客: https://imys.net/","source":"friends/index.md","raw":"---\ntitle: 友情链接，感谢各位作者\ndate: 2017-05-20 19:41:26\n---\n\n\n1. 邹志鹏的简书: http://www.jianshu.com/u/1c27b5d9981e\n\n2. 赵玉涛的博客: http://aword.net/\n\n2. 樊浩柏的博客: https://www.fanhaobai.com/\n\n3. 徐新的博客：http://www.lcode.cc/\n\n4. 赵泽溥的博客: http://www.zepuer.top/\n\n4. 游渔's Blog: http://youyusan.github.io\n\n5. 廖雪峰的官方网站: http://www.liaoxuefeng.com\n\n6. 令狐葱@前端笔记: https://linghucong.js.org/\n\n7. litten 的博客: http://litten.me/\n\n8. xuanwo 的博客: https://xuanwo.org/\n\n9. hktkdy 的博客: http://hktkdy.com/\n\n10. 王昱森的博客: https://imys.net/","updated":"2020-09-11T01:04:35.063Z","path":"friends/index.html","comments":1,"layout":"page","_id":"ckexjtz7p00076wo1dy9o71tm","content":"<ol>\n<li><p>邹志鹏的简书: <a href=\"http://www.jianshu.com/u/1c27b5d9981e\">http://www.jianshu.com/u/1c27b5d9981e</a></p>\n</li>\n<li><p>赵玉涛的博客: <a href=\"http://aword.net/\">http://aword.net/</a></p>\n</li>\n<li><p>樊浩柏的博客: <a href=\"https://www.fanhaobai.com/\">https://www.fanhaobai.com/</a></p>\n</li>\n<li><p>徐新的博客：<a href=\"http://www.lcode.cc/\">http://www.lcode.cc/</a></p>\n</li>\n<li><p>赵泽溥的博客: <a href=\"http://www.zepuer.top/\">http://www.zepuer.top/</a></p>\n</li>\n<li><p>游渔’s Blog: <a href=\"http://youyusan.github.io/\">http://youyusan.github.io</a></p>\n</li>\n<li><p>廖雪峰的官方网站: <a href=\"http://www.liaoxuefeng.com/\">http://www.liaoxuefeng.com</a></p>\n</li>\n<li><p>令狐葱@前端笔记: <a href=\"https://linghucong.js.org/\">https://linghucong.js.org/</a></p>\n</li>\n<li><p>litten 的博客: <a href=\"http://litten.me/\">http://litten.me/</a></p>\n</li>\n<li><p>xuanwo 的博客: <a href=\"https://xuanwo.org/\">https://xuanwo.org/</a></p>\n</li>\n<li><p>hktkdy 的博客: <a href=\"http://hktkdy.com/\">http://hktkdy.com/</a></p>\n</li>\n<li><p>王昱森的博客: <a href=\"https://imys.net/\">https://imys.net/</a></p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li><p>邹志鹏的简书: <a href=\"http://www.jianshu.com/u/1c27b5d9981e\">http://www.jianshu.com/u/1c27b5d9981e</a></p>\n</li>\n<li><p>赵玉涛的博客: <a href=\"http://aword.net/\">http://aword.net/</a></p>\n</li>\n<li><p>樊浩柏的博客: <a href=\"https://www.fanhaobai.com/\">https://www.fanhaobai.com/</a></p>\n</li>\n<li><p>徐新的博客：<a href=\"http://www.lcode.cc/\">http://www.lcode.cc/</a></p>\n</li>\n<li><p>赵泽溥的博客: <a href=\"http://www.zepuer.top/\">http://www.zepuer.top/</a></p>\n</li>\n<li><p>游渔’s Blog: <a href=\"http://youyusan.github.io/\">http://youyusan.github.io</a></p>\n</li>\n<li><p>廖雪峰的官方网站: <a href=\"http://www.liaoxuefeng.com/\">http://www.liaoxuefeng.com</a></p>\n</li>\n<li><p>令狐葱@前端笔记: <a href=\"https://linghucong.js.org/\">https://linghucong.js.org/</a></p>\n</li>\n<li><p>litten 的博客: <a href=\"http://litten.me/\">http://litten.me/</a></p>\n</li>\n<li><p>xuanwo 的博客: <a href=\"https://xuanwo.org/\">https://xuanwo.org/</a></p>\n</li>\n<li><p>hktkdy 的博客: <a href=\"http://hktkdy.com/\">http://hktkdy.com/</a></p>\n</li>\n<li><p>王昱森的博客: <a href=\"https://imys.net/\">https://imys.net/</a></p>\n</li>\n</ol>\n"},{"title":"友情链接","date":"2017-05-05T13:00:34.000Z","_content":"\n","source":"tags/index.md","raw":"---\ntitle: 友情链接\ndate: 2017-05-05 21:00:34\n---\n\n","updated":"2020-09-11T01:04:35.064Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckexjtz7s000a6wo19jq1ch7q","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"几个小问题 201806","date":"2018-06-08T02:26:57.000Z","_content":"\n## Linux warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory\n\n这个问题经常遇到，记录一下，解决方法也很简单\n\n```\nvi /etc/environment\n\n# add these lines...\n\nLANG=en_US.utf-8\nLC_ALL=en_US.utf-8\n```\n\n## mac ssh 连接服务器，vim 文件内的中文为乱码\n \niterm 配置utf8编码，本地终端中文不乱码，ssh远程中文乱码\n\n遇到了同样的问题，主要是远程服务器的语言编码与终端的编码不一致。\n在远程服务器端的  `~/.bashrc` 文件里面加入以下代码：\n`export LANG='UTC-8'export LC_ALL='en_US.UTF-8'`\n然后source一下，中文就可以正常显示。\n下次登录 `.bashrc` 文件自动运行，中文照样正常显示。\n\n## nginx access_log\n\n其实网上说的 access_log /dev/null; 只是针对nginx的error_log而言的。如果想关闭error_log，那么就用error_log /dev/null（看老外是这么做的）。\n\n但是想关闭access_log的话，直接在nginx.conf的http模块中配置`access_log off`;即可。\n\n需要注意的是，已经继承了http模块的那些模块不要再设置access_log off;了。 \n\n比如，我已经在http模块中设置了access_log off;，那么就不要在http模块所包含的server模块或location模块中设置access_log off;，以及虚拟主机目录(vhost)下的配置文件也不要添加access_log off;。\n\n\n## composer 内存限制解除\n\n`php -d memory_limit=-1 composer.phar install`\n\n## mac 允许安装 app\n\n`sudo spctl --master-disable`\n\n## 搬瓦工 ss 面板\n\n`main-exec.php?mode=extras_shadowsocks`\n\n## mac 微信动图目录\n\n`/Users/ZouZhipeng/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/a3ac8c8fd9e2cbceb1e690f6bcbf8741/Stickers/File`\n\n## vim 统计字符串个数\n\n`:%s/字符串/&/gn`\n\n## vim 未使用 root 用户时， sudo 保存退出\n\n`:w !sudo tee %`\n\n## mac text 文件乱码问题\n\n`iconv -c -f GB2312 -t UTF-8 [你要看的文件] >> [新文件的名称]`\n\n## MySQL密码的恢复方法\n\n- 修改MySQL的登录设置： `# sudo vi /etc/my.cnf` 在[mysqld]的段中加上一句：`skip-grant-tables` 保存并且退出vi。\n- 重新启动mysqld `# /etc/init.d/mysqld restart  ( sudo service mysqld restart )`\n- 用以下命令启动MySQL，以不检查权限的方式启动； `mysqld --skip-grant-tables &`\n- 然后用空密码方式使用root用户登录 MySQL； `mysql -u root`\n\n`mysql> USE mysql;`\n\n> 注意： mysql 5.7 用户密码字段改为了 `authentication_string`  \n```\nmysql> update user set authentication_string=PASSWORD('zzp123456') where User='root';\nmysql> flush privileges;\nmysql> quit\n```\n\n- 将MySQL的登录设置修改回来 `# vi /etc/my.cnf` 将刚才在[mysqld]的段中加上的 `skip-grant-tables` 删除 保存并且退出vi。\n- 重新启动mysqld `# /etc/init.d/mysqld restart   ( service mysqld restart )`\n- 恢复服务器的正常工作状态\n\n将步骤一中的操作逆向操作。恢复服务器的工作状态。\n\n\n## mysql 密码过于简单的问题\n\nBuilding on the answer from Sharfi, edit the `/etc/my.cnf` file and add just this one line:\n`validate_password_policy=LOW`\n\nThat should sufficiently neuter the validation as requested by the OP. You will probably want to restart mysqld after this change. Depending on your OS, it would look something like:\n`sudo service mysqld restart`\n\n`mysql> SET PASSWORD = PASSWORD('your_new_password');`\n\n\n\n## vagrant up 的问题\n\n```\nVagrant was unable to mount VirtualBox shared folders. This is usually\nbecause the filesystem \"vboxsf\" is not available. This filesystem is\nmade available via the VirtualBox Guest Additions and kernel module.\nPlease verify that these guest additions are properly installed in the\nguest. This is not a bug in Vagrant and is usually caused by a faulty\nVagrant box. For context, the command attempted was:\n\nmount -t vboxsf -o uid=1000,gid=1000 home_vagrant_www /home/vagrant/www\n\nThe error output from the command was:\n\n/sbin/mount.vboxsf: mounting failed with the error: No such device\n```\n\nI have been able to workaround this by logging on with with `vagrant ssh` and running a`sudo yum update -y`\n\n\nThen once that completed I disconnected from ssh `vagrant halt` and re-ran `vagrant reload --provision`\nThe guest-additions were then showing as running OK `vagrant up`.\n\n\n## 删除 time machine 备份\n\n所有： `sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb`\n时间很长，慢慢等\n\n指定：`sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb/志鹏’s MacBook Pro/2017-01-07-002750`\n\nTotal deleted: 431.3G 用时 20小时左右\n\n\n## 允许mysql远程访问\n\n在安装mysql的机器上运行：\n\n进入MySQL服务器\n`mysql -h localhost -u root`\n\n赋予任何主机访问数据的权限\n`mysql>GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION`\n\n使修改生效\n`mysql>FLUSH PRIVILEGES`\n\n退出MySQL服务器\n`mysql>exit`\n","source":"_posts/ 几个小问题 201806.md","raw":"---\ntitle: 几个小问题 201806\ndate: 2018-06-08 10:26:57\ntags: trivia\n---\n\n## Linux warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory\n\n这个问题经常遇到，记录一下，解决方法也很简单\n\n```\nvi /etc/environment\n\n# add these lines...\n\nLANG=en_US.utf-8\nLC_ALL=en_US.utf-8\n```\n\n## mac ssh 连接服务器，vim 文件内的中文为乱码\n \niterm 配置utf8编码，本地终端中文不乱码，ssh远程中文乱码\n\n遇到了同样的问题，主要是远程服务器的语言编码与终端的编码不一致。\n在远程服务器端的  `~/.bashrc` 文件里面加入以下代码：\n`export LANG='UTC-8'export LC_ALL='en_US.UTF-8'`\n然后source一下，中文就可以正常显示。\n下次登录 `.bashrc` 文件自动运行，中文照样正常显示。\n\n## nginx access_log\n\n其实网上说的 access_log /dev/null; 只是针对nginx的error_log而言的。如果想关闭error_log，那么就用error_log /dev/null（看老外是这么做的）。\n\n但是想关闭access_log的话，直接在nginx.conf的http模块中配置`access_log off`;即可。\n\n需要注意的是，已经继承了http模块的那些模块不要再设置access_log off;了。 \n\n比如，我已经在http模块中设置了access_log off;，那么就不要在http模块所包含的server模块或location模块中设置access_log off;，以及虚拟主机目录(vhost)下的配置文件也不要添加access_log off;。\n\n\n## composer 内存限制解除\n\n`php -d memory_limit=-1 composer.phar install`\n\n## mac 允许安装 app\n\n`sudo spctl --master-disable`\n\n## 搬瓦工 ss 面板\n\n`main-exec.php?mode=extras_shadowsocks`\n\n## mac 微信动图目录\n\n`/Users/ZouZhipeng/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/a3ac8c8fd9e2cbceb1e690f6bcbf8741/Stickers/File`\n\n## vim 统计字符串个数\n\n`:%s/字符串/&/gn`\n\n## vim 未使用 root 用户时， sudo 保存退出\n\n`:w !sudo tee %`\n\n## mac text 文件乱码问题\n\n`iconv -c -f GB2312 -t UTF-8 [你要看的文件] >> [新文件的名称]`\n\n## MySQL密码的恢复方法\n\n- 修改MySQL的登录设置： `# sudo vi /etc/my.cnf` 在[mysqld]的段中加上一句：`skip-grant-tables` 保存并且退出vi。\n- 重新启动mysqld `# /etc/init.d/mysqld restart  ( sudo service mysqld restart )`\n- 用以下命令启动MySQL，以不检查权限的方式启动； `mysqld --skip-grant-tables &`\n- 然后用空密码方式使用root用户登录 MySQL； `mysql -u root`\n\n`mysql> USE mysql;`\n\n> 注意： mysql 5.7 用户密码字段改为了 `authentication_string`  \n```\nmysql> update user set authentication_string=PASSWORD('zzp123456') where User='root';\nmysql> flush privileges;\nmysql> quit\n```\n\n- 将MySQL的登录设置修改回来 `# vi /etc/my.cnf` 将刚才在[mysqld]的段中加上的 `skip-grant-tables` 删除 保存并且退出vi。\n- 重新启动mysqld `# /etc/init.d/mysqld restart   ( service mysqld restart )`\n- 恢复服务器的正常工作状态\n\n将步骤一中的操作逆向操作。恢复服务器的工作状态。\n\n\n## mysql 密码过于简单的问题\n\nBuilding on the answer from Sharfi, edit the `/etc/my.cnf` file and add just this one line:\n`validate_password_policy=LOW`\n\nThat should sufficiently neuter the validation as requested by the OP. You will probably want to restart mysqld after this change. Depending on your OS, it would look something like:\n`sudo service mysqld restart`\n\n`mysql> SET PASSWORD = PASSWORD('your_new_password');`\n\n\n\n## vagrant up 的问题\n\n```\nVagrant was unable to mount VirtualBox shared folders. This is usually\nbecause the filesystem \"vboxsf\" is not available. This filesystem is\nmade available via the VirtualBox Guest Additions and kernel module.\nPlease verify that these guest additions are properly installed in the\nguest. This is not a bug in Vagrant and is usually caused by a faulty\nVagrant box. For context, the command attempted was:\n\nmount -t vboxsf -o uid=1000,gid=1000 home_vagrant_www /home/vagrant/www\n\nThe error output from the command was:\n\n/sbin/mount.vboxsf: mounting failed with the error: No such device\n```\n\nI have been able to workaround this by logging on with with `vagrant ssh` and running a`sudo yum update -y`\n\n\nThen once that completed I disconnected from ssh `vagrant halt` and re-ran `vagrant reload --provision`\nThe guest-additions were then showing as running OK `vagrant up`.\n\n\n## 删除 time machine 备份\n\n所有： `sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb`\n时间很长，慢慢等\n\n指定：`sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb/志鹏’s MacBook Pro/2017-01-07-002750`\n\nTotal deleted: 431.3G 用时 20小时左右\n\n\n## 允许mysql远程访问\n\n在安装mysql的机器上运行：\n\n进入MySQL服务器\n`mysql -h localhost -u root`\n\n赋予任何主机访问数据的权限\n`mysql>GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION`\n\n使修改生效\n`mysql>FLUSH PRIVILEGES`\n\n退出MySQL服务器\n`mysql>exit`\n","slug":" 几个小问题 201806","published":1,"updated":"2020-09-11T01:04:35.030Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7g00016wo17z8h1i3y","content":"<h2 id=\"Linux-warning-setlocale-LC-CTYPE-cannot-change-locale-UTF-8-No-such-file-or-directory\"><a href=\"#Linux-warning-setlocale-LC-CTYPE-cannot-change-locale-UTF-8-No-such-file-or-directory\" class=\"headerlink\" title=\"Linux warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory\"></a>Linux warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory</h2><p>这个问题经常遇到，记录一下，解决方法也很简单</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;environment</span><br><span class=\"line\"></span><br><span class=\"line\"># add these lines...</span><br><span class=\"line\"></span><br><span class=\"line\">LANG&#x3D;en_US.utf-8</span><br><span class=\"line\">LC_ALL&#x3D;en_US.utf-8</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"mac-ssh-连接服务器，vim-文件内的中文为乱码\"><a href=\"#mac-ssh-连接服务器，vim-文件内的中文为乱码\" class=\"headerlink\" title=\"mac ssh 连接服务器，vim 文件内的中文为乱码\"></a>mac ssh 连接服务器，vim 文件内的中文为乱码</h2><p>iterm 配置utf8编码，本地终端中文不乱码，ssh远程中文乱码</p>\n<p>遇到了同样的问题，主要是远程服务器的语言编码与终端的编码不一致。<br>在远程服务器端的  <code>~/.bashrc</code> 文件里面加入以下代码：<br><code>export LANG=&#39;UTC-8&#39;export LC_ALL=&#39;en_US.UTF-8&#39;</code><br>然后source一下，中文就可以正常显示。<br>下次登录 <code>.bashrc</code> 文件自动运行，中文照样正常显示。</p>\n<h2 id=\"nginx-access-log\"><a href=\"#nginx-access-log\" class=\"headerlink\" title=\"nginx access_log\"></a>nginx access_log</h2><p>其实网上说的 access_log /dev/null; 只是针对nginx的error_log而言的。如果想关闭error_log，那么就用error_log /dev/null（看老外是这么做的）。</p>\n<p>但是想关闭access_log的话，直接在nginx.conf的http模块中配置<code>access_log off</code>;即可。</p>\n<p>需要注意的是，已经继承了http模块的那些模块不要再设置access_log off;了。 </p>\n<p>比如，我已经在http模块中设置了access_log off;，那么就不要在http模块所包含的server模块或location模块中设置access_log off;，以及虚拟主机目录(vhost)下的配置文件也不要添加access_log off;。</p>\n<h2 id=\"composer-内存限制解除\"><a href=\"#composer-内存限制解除\" class=\"headerlink\" title=\"composer 内存限制解除\"></a>composer 内存限制解除</h2><p><code>php -d memory_limit=-1 composer.phar install</code></p>\n<h2 id=\"mac-允许安装-app\"><a href=\"#mac-允许安装-app\" class=\"headerlink\" title=\"mac 允许安装 app\"></a>mac 允许安装 app</h2><p><code>sudo spctl --master-disable</code></p>\n<h2 id=\"搬瓦工-ss-面板\"><a href=\"#搬瓦工-ss-面板\" class=\"headerlink\" title=\"搬瓦工 ss 面板\"></a>搬瓦工 ss 面板</h2><p><code>main-exec.php?mode=extras_shadowsocks</code></p>\n<h2 id=\"mac-微信动图目录\"><a href=\"#mac-微信动图目录\" class=\"headerlink\" title=\"mac 微信动图目录\"></a>mac 微信动图目录</h2><p><code>/Users/ZouZhipeng/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/a3ac8c8fd9e2cbceb1e690f6bcbf8741/Stickers/File</code></p>\n<h2 id=\"vim-统计字符串个数\"><a href=\"#vim-统计字符串个数\" class=\"headerlink\" title=\"vim 统计字符串个数\"></a>vim 统计字符串个数</h2><p><code>:%s/字符串/&amp;/gn</code></p>\n<h2 id=\"vim-未使用-root-用户时，-sudo-保存退出\"><a href=\"#vim-未使用-root-用户时，-sudo-保存退出\" class=\"headerlink\" title=\"vim 未使用 root 用户时， sudo 保存退出\"></a>vim 未使用 root 用户时， sudo 保存退出</h2><p><code>:w !sudo tee %</code></p>\n<h2 id=\"mac-text-文件乱码问题\"><a href=\"#mac-text-文件乱码问题\" class=\"headerlink\" title=\"mac text 文件乱码问题\"></a>mac text 文件乱码问题</h2><p><code>iconv -c -f GB2312 -t UTF-8 [你要看的文件] &gt;&gt; [新文件的名称]</code></p>\n<h2 id=\"MySQL密码的恢复方法\"><a href=\"#MySQL密码的恢复方法\" class=\"headerlink\" title=\"MySQL密码的恢复方法\"></a>MySQL密码的恢复方法</h2><ul>\n<li>修改MySQL的登录设置： <code># sudo vi /etc/my.cnf</code> 在[mysqld]的段中加上一句：<code>skip-grant-tables</code> 保存并且退出vi。</li>\n<li>重新启动mysqld <code># /etc/init.d/mysqld restart  ( sudo service mysqld restart )</code></li>\n<li>用以下命令启动MySQL，以不检查权限的方式启动； <code>mysqld --skip-grant-tables &amp;</code></li>\n<li>然后用空密码方式使用root用户登录 MySQL； <code>mysql -u root</code></li>\n</ul>\n<p><code>mysql&gt; USE mysql;</code></p>\n<blockquote>\n<p>注意： mysql 5.7 用户密码字段改为了 <code>authentication_string</code>  </p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; update user set authentication_string&#x3D;PASSWORD(&#39;zzp123456&#39;) where User&#x3D;&#39;root&#39;;</span><br><span class=\"line\">mysql&gt; flush privileges;</span><br><span class=\"line\">mysql&gt; quit</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将MySQL的登录设置修改回来 <code># vi /etc/my.cnf</code> 将刚才在[mysqld]的段中加上的 <code>skip-grant-tables</code> 删除 保存并且退出vi。</li>\n<li>重新启动mysqld <code># /etc/init.d/mysqld restart   ( service mysqld restart )</code></li>\n<li>恢复服务器的正常工作状态</li>\n</ul>\n<p>将步骤一中的操作逆向操作。恢复服务器的工作状态。</p>\n<h2 id=\"mysql-密码过于简单的问题\"><a href=\"#mysql-密码过于简单的问题\" class=\"headerlink\" title=\"mysql 密码过于简单的问题\"></a>mysql 密码过于简单的问题</h2><p>Building on the answer from Sharfi, edit the <code>/etc/my.cnf</code> file and add just this one line:<br><code>validate_password_policy=LOW</code></p>\n<p>That should sufficiently neuter the validation as requested by the OP. You will probably want to restart mysqld after this change. Depending on your OS, it would look something like:<br><code>sudo service mysqld restart</code></p>\n<p><code>mysql&gt; SET PASSWORD = PASSWORD(&#39;your_new_password&#39;);</code></p>\n<h2 id=\"vagrant-up-的问题\"><a href=\"#vagrant-up-的问题\" class=\"headerlink\" title=\"vagrant up 的问题\"></a>vagrant up 的问题</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Vagrant was unable to mount VirtualBox shared folders. This is usually</span><br><span class=\"line\">because the filesystem &quot;vboxsf&quot; is not available. This filesystem is</span><br><span class=\"line\">made available via the VirtualBox Guest Additions and kernel module.</span><br><span class=\"line\">Please verify that these guest additions are properly installed in the</span><br><span class=\"line\">guest. This is not a bug in Vagrant and is usually caused by a faulty</span><br><span class=\"line\">Vagrant box. For context, the command attempted was:</span><br><span class=\"line\"></span><br><span class=\"line\">mount -t vboxsf -o uid&#x3D;1000,gid&#x3D;1000 home_vagrant_www &#x2F;home&#x2F;vagrant&#x2F;www</span><br><span class=\"line\"></span><br><span class=\"line\">The error output from the command was:</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;sbin&#x2F;mount.vboxsf: mounting failed with the error: No such device</span><br></pre></td></tr></table></figure>\n\n<p>I have been able to workaround this by logging on with with <code>vagrant ssh</code> and running a<code>sudo yum update -y</code></p>\n<p>Then once that completed I disconnected from ssh <code>vagrant halt</code> and re-ran <code>vagrant reload --provision</code><br>The guest-additions were then showing as running OK <code>vagrant up</code>.</p>\n<h2 id=\"删除-time-machine-备份\"><a href=\"#删除-time-machine-备份\" class=\"headerlink\" title=\"删除 time machine 备份\"></a>删除 time machine 备份</h2><p>所有： <code>sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb</code><br>时间很长，慢慢等</p>\n<p>指定：<code>sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb/志鹏’s MacBook Pro/2017-01-07-002750</code></p>\n<p>Total deleted: 431.3G 用时 20小时左右</p>\n<h2 id=\"允许mysql远程访问\"><a href=\"#允许mysql远程访问\" class=\"headerlink\" title=\"允许mysql远程访问\"></a>允许mysql远程访问</h2><p>在安装mysql的机器上运行：</p>\n<p>进入MySQL服务器<br><code>mysql -h localhost -u root</code></p>\n<p>赋予任何主机访问数据的权限<br><code>mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; WITH GRANT OPTION</code></p>\n<p>使修改生效<br><code>mysql&gt;FLUSH PRIVILEGES</code></p>\n<p>退出MySQL服务器<br><code>mysql&gt;exit</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux-warning-setlocale-LC-CTYPE-cannot-change-locale-UTF-8-No-such-file-or-directory\"><a href=\"#Linux-warning-setlocale-LC-CTYPE-cannot-change-locale-UTF-8-No-such-file-or-directory\" class=\"headerlink\" title=\"Linux warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory\"></a>Linux warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory</h2><p>这个问题经常遇到，记录一下，解决方法也很简单</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi &#x2F;etc&#x2F;environment</span><br><span class=\"line\"></span><br><span class=\"line\"># add these lines...</span><br><span class=\"line\"></span><br><span class=\"line\">LANG&#x3D;en_US.utf-8</span><br><span class=\"line\">LC_ALL&#x3D;en_US.utf-8</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"mac-ssh-连接服务器，vim-文件内的中文为乱码\"><a href=\"#mac-ssh-连接服务器，vim-文件内的中文为乱码\" class=\"headerlink\" title=\"mac ssh 连接服务器，vim 文件内的中文为乱码\"></a>mac ssh 连接服务器，vim 文件内的中文为乱码</h2><p>iterm 配置utf8编码，本地终端中文不乱码，ssh远程中文乱码</p>\n<p>遇到了同样的问题，主要是远程服务器的语言编码与终端的编码不一致。<br>在远程服务器端的  <code>~/.bashrc</code> 文件里面加入以下代码：<br><code>export LANG=&#39;UTC-8&#39;export LC_ALL=&#39;en_US.UTF-8&#39;</code><br>然后source一下，中文就可以正常显示。<br>下次登录 <code>.bashrc</code> 文件自动运行，中文照样正常显示。</p>\n<h2 id=\"nginx-access-log\"><a href=\"#nginx-access-log\" class=\"headerlink\" title=\"nginx access_log\"></a>nginx access_log</h2><p>其实网上说的 access_log /dev/null; 只是针对nginx的error_log而言的。如果想关闭error_log，那么就用error_log /dev/null（看老外是这么做的）。</p>\n<p>但是想关闭access_log的话，直接在nginx.conf的http模块中配置<code>access_log off</code>;即可。</p>\n<p>需要注意的是，已经继承了http模块的那些模块不要再设置access_log off;了。 </p>\n<p>比如，我已经在http模块中设置了access_log off;，那么就不要在http模块所包含的server模块或location模块中设置access_log off;，以及虚拟主机目录(vhost)下的配置文件也不要添加access_log off;。</p>\n<h2 id=\"composer-内存限制解除\"><a href=\"#composer-内存限制解除\" class=\"headerlink\" title=\"composer 内存限制解除\"></a>composer 内存限制解除</h2><p><code>php -d memory_limit=-1 composer.phar install</code></p>\n<h2 id=\"mac-允许安装-app\"><a href=\"#mac-允许安装-app\" class=\"headerlink\" title=\"mac 允许安装 app\"></a>mac 允许安装 app</h2><p><code>sudo spctl --master-disable</code></p>\n<h2 id=\"搬瓦工-ss-面板\"><a href=\"#搬瓦工-ss-面板\" class=\"headerlink\" title=\"搬瓦工 ss 面板\"></a>搬瓦工 ss 面板</h2><p><code>main-exec.php?mode=extras_shadowsocks</code></p>\n<h2 id=\"mac-微信动图目录\"><a href=\"#mac-微信动图目录\" class=\"headerlink\" title=\"mac 微信动图目录\"></a>mac 微信动图目录</h2><p><code>/Users/ZouZhipeng/Library/Containers/com.tencent.xinWeChat/Data/Library/Application Support/com.tencent.xinWeChat/2.0b4.0.9/a3ac8c8fd9e2cbceb1e690f6bcbf8741/Stickers/File</code></p>\n<h2 id=\"vim-统计字符串个数\"><a href=\"#vim-统计字符串个数\" class=\"headerlink\" title=\"vim 统计字符串个数\"></a>vim 统计字符串个数</h2><p><code>:%s/字符串/&amp;/gn</code></p>\n<h2 id=\"vim-未使用-root-用户时，-sudo-保存退出\"><a href=\"#vim-未使用-root-用户时，-sudo-保存退出\" class=\"headerlink\" title=\"vim 未使用 root 用户时， sudo 保存退出\"></a>vim 未使用 root 用户时， sudo 保存退出</h2><p><code>:w !sudo tee %</code></p>\n<h2 id=\"mac-text-文件乱码问题\"><a href=\"#mac-text-文件乱码问题\" class=\"headerlink\" title=\"mac text 文件乱码问题\"></a>mac text 文件乱码问题</h2><p><code>iconv -c -f GB2312 -t UTF-8 [你要看的文件] &gt;&gt; [新文件的名称]</code></p>\n<h2 id=\"MySQL密码的恢复方法\"><a href=\"#MySQL密码的恢复方法\" class=\"headerlink\" title=\"MySQL密码的恢复方法\"></a>MySQL密码的恢复方法</h2><ul>\n<li>修改MySQL的登录设置： <code># sudo vi /etc/my.cnf</code> 在[mysqld]的段中加上一句：<code>skip-grant-tables</code> 保存并且退出vi。</li>\n<li>重新启动mysqld <code># /etc/init.d/mysqld restart  ( sudo service mysqld restart )</code></li>\n<li>用以下命令启动MySQL，以不检查权限的方式启动； <code>mysqld --skip-grant-tables &amp;</code></li>\n<li>然后用空密码方式使用root用户登录 MySQL； <code>mysql -u root</code></li>\n</ul>\n<p><code>mysql&gt; USE mysql;</code></p>\n<blockquote>\n<p>注意： mysql 5.7 用户密码字段改为了 <code>authentication_string</code>  </p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; update user set authentication_string&#x3D;PASSWORD(&#39;zzp123456&#39;) where User&#x3D;&#39;root&#39;;</span><br><span class=\"line\">mysql&gt; flush privileges;</span><br><span class=\"line\">mysql&gt; quit</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>将MySQL的登录设置修改回来 <code># vi /etc/my.cnf</code> 将刚才在[mysqld]的段中加上的 <code>skip-grant-tables</code> 删除 保存并且退出vi。</li>\n<li>重新启动mysqld <code># /etc/init.d/mysqld restart   ( service mysqld restart )</code></li>\n<li>恢复服务器的正常工作状态</li>\n</ul>\n<p>将步骤一中的操作逆向操作。恢复服务器的工作状态。</p>\n<h2 id=\"mysql-密码过于简单的问题\"><a href=\"#mysql-密码过于简单的问题\" class=\"headerlink\" title=\"mysql 密码过于简单的问题\"></a>mysql 密码过于简单的问题</h2><p>Building on the answer from Sharfi, edit the <code>/etc/my.cnf</code> file and add just this one line:<br><code>validate_password_policy=LOW</code></p>\n<p>That should sufficiently neuter the validation as requested by the OP. You will probably want to restart mysqld after this change. Depending on your OS, it would look something like:<br><code>sudo service mysqld restart</code></p>\n<p><code>mysql&gt; SET PASSWORD = PASSWORD(&#39;your_new_password&#39;);</code></p>\n<h2 id=\"vagrant-up-的问题\"><a href=\"#vagrant-up-的问题\" class=\"headerlink\" title=\"vagrant up 的问题\"></a>vagrant up 的问题</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Vagrant was unable to mount VirtualBox shared folders. This is usually</span><br><span class=\"line\">because the filesystem &quot;vboxsf&quot; is not available. This filesystem is</span><br><span class=\"line\">made available via the VirtualBox Guest Additions and kernel module.</span><br><span class=\"line\">Please verify that these guest additions are properly installed in the</span><br><span class=\"line\">guest. This is not a bug in Vagrant and is usually caused by a faulty</span><br><span class=\"line\">Vagrant box. For context, the command attempted was:</span><br><span class=\"line\"></span><br><span class=\"line\">mount -t vboxsf -o uid&#x3D;1000,gid&#x3D;1000 home_vagrant_www &#x2F;home&#x2F;vagrant&#x2F;www</span><br><span class=\"line\"></span><br><span class=\"line\">The error output from the command was:</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;sbin&#x2F;mount.vboxsf: mounting failed with the error: No such device</span><br></pre></td></tr></table></figure>\n\n<p>I have been able to workaround this by logging on with with <code>vagrant ssh</code> and running a<code>sudo yum update -y</code></p>\n<p>Then once that completed I disconnected from ssh <code>vagrant halt</code> and re-ran <code>vagrant reload --provision</code><br>The guest-additions were then showing as running OK <code>vagrant up</code>.</p>\n<h2 id=\"删除-time-machine-备份\"><a href=\"#删除-time-machine-备份\" class=\"headerlink\" title=\"删除 time machine 备份\"></a>删除 time machine 备份</h2><p>所有： <code>sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb</code><br>时间很长，慢慢等</p>\n<p>指定：<code>sudo tmutil delete /Volumes/17702250105T2/Backups.backupdb/志鹏’s MacBook Pro/2017-01-07-002750</code></p>\n<p>Total deleted: 431.3G 用时 20小时左右</p>\n<h2 id=\"允许mysql远程访问\"><a href=\"#允许mysql远程访问\" class=\"headerlink\" title=\"允许mysql远程访问\"></a>允许mysql远程访问</h2><p>在安装mysql的机器上运行：</p>\n<p>进入MySQL服务器<br><code>mysql -h localhost -u root</code></p>\n<p>赋予任何主机访问数据的权限<br><code>mysql&gt;GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; WITH GRANT OPTION</code></p>\n<p>使修改生效<br><code>mysql&gt;FLUSH PRIVILEGES</code></p>\n<p>退出MySQL服务器<br><code>mysql&gt;exit</code></p>\n"},{"title":"API 断点调试 -- PHPStorm && XDebug && Postman","date":"2019-02-16T04:45:02.000Z","_content":"\n折腾了好久，记录一下，方便以后查阅。\n\n### 环境\n- MacOS Majave version 10.14.2\n- phpstorm 2018.2.2\n- Docker version 18.09.1, build 4c52b90\n- docker-compose version 1.23.2, build 1110ad01\n- postman 6.6.1\n- php 7.1.23\n- xdebug v2.6.1\n\n### 安装\n#### 1. 配置文件\n\n> docker-compose.yml\n\n```\n# 本机 80 端口被占用，随便改一个其他未使用端口\nversion: '3'\nservices:\n  fpm:\n    build: .\n    ports:\n    - \"9111:80\"\n    stdin_open: true\n    tty: true\n    volumes:\n    - .:/var/www/html\n    restart: always\n    command: \"sh -c 'nginx && php-fpm'\"\n```\n \n> Dockerfile\n\n```\nFROM php:7.1-fpm\n\nRUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' >/etc/timezone\n\nRUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\n\nRUN echo 'date.timezone=PRC' > /usr/local/etc/php/conf.d/timezone.ini\n\n# Install modules\nRUN apt-get update && apt-get install -y \\\n        git \\\n        curl \\\n        openssl \\\n        wget \\\n        vim \\\n        procps \\\n        libssl-dev \\\n        libfreetype6-dev \\\n        libjpeg62-turbo-dev \\\n        libmcrypt-dev \\\n        libpng-dev \\\n        libicu-dev \\\n        libpcre3 libpcre3-dev \\\n        zlib1g-dev \\\n        gnupg2 \\\n             --no-install-recommends\n\n# ########### nginx ################\nRUN wget http://nginx.org/download/nginx-1.12.0.tar.gz -O nginx.tar.gz \\\n    && mkdir -p nginx \\\n    && tar -xf nginx.tar.gz -C nginx --strip-components=1 \\\n    && rm nginx.tar.gz\n\nRUN cd nginx && ./configure \\\n    --prefix=/etc/nginx \\\n    --sbin-path=/usr/sbin/nginx \\\n    --modules-path=/usr/lib/nginx/modules \\\n    --conf-path=/etc/nginx/nginx.conf \\\n    --error-log-path=/var/log/nginx/error.log \\\n    --http-log-path=/var/log/nginx/access.log \\\n    --pid-path=/var/run/nginx.pid \\\n    --lock-path=/var/run/nginx.lock \\\n    --http-client-body-temp-path=/var/cache/nginx/client_temp \\\n    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \\\n    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \\\n    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \\\n    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \\\n    --user=www-data \\\n    --group=www-data \\\n    --with-compat \\\n    --with-file-aio \\\n    --with-threads \\\n    --with-http_addition_module \\\n    --with-http_auth_request_module \\\n    --with-http_dav_module \\\n    --with-http_flv_module \\\n    --with-http_gunzip_module \\\n    --with-http_gzip_static_module \\\n    --with-http_mp4_module \\\n    --with-http_random_index_module \\\n    --with-http_realip_module \\\n    --with-http_secure_link_module \\\n    --with-http_slice_module \\\n    --with-http_ssl_module \\\n    --with-http_stub_status_module \\\n    --with-http_sub_module \\\n    --with-http_v2_module \\\n    --with-mail \\\n    --with-mail_ssl_module \\\n    --with-stream \\\n    --with-stream_realip_module \\\n    --with-stream_ssl_module \\\n    --with-stream_ssl_preread_module \\\n    --with-cc-opt='-g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fPIC' \\\n    --with-ld-opt='-Wl,-z,relro -Wl,-z,now -Wl,--as-needed -pie' \\\n    && make \\\n    && make install \\\n    && mkdir -p /var/cache/nginx/\n\n\n# Install composer && global asset plugin\nENV COMPOSER_HOME /root/.composer\nENV PATH /root/.composer/vendor/bin:$PATH\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n    && composer config -g repo.packagist composer https://packagist.phpcomposer.com\n\n#install extension\nRUN docker-php-ext-install zip \\\n    && docker-php-ext-install mcrypt \\\n    && docker-php-ext-install intl \\\n    && docker-php-ext-install mbstring \\\n    && docker-php-ext-install pdo_mysql \\\n    && docker-php-ext-install pcntl \\\n    && docker-php-ext-install bcmath\n\n#install gd\nRUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n    && docker-php-ext-install gd\n\n# redis\nRUN wget http://pecl.php.net/get/redis-3.1.6.tgz \\\n    && pecl install redis-3.1.6.tgz \\\n    && rm -f redis-3.1.6.tgz \\\n    && docker-php-ext-enable redis\n\n# amqp\nRUN apt install librabbitmq-dev -y\n\nRUN wget https://github.com/alanxz/rabbitmq-c/releases/download/v0.8.0/rabbitmq-c-0.8.0.tar.gz -O rabbitmq.tar.gz \\\n    && mkdir -p rabbitmq \\\n    && tar -xf rabbitmq.tar.gz -C rabbitmq --strip-components=1 \\\n    && rm rabbitmq.tar.gz \\\n    && cd rabbitmq \\\n    && ./configure --prefix=/usr/local/rabbitmq-dev \\\n    && make \\\n    && make install \\\n    && cd .. \\\n    && rm -rf rabbitmq\n\nRUN wget http://pecl.php.net/get/amqp-1.9.3.tgz -O amqp.tar.gz \\\n    && mkdir -p amqp \\\n    && tar -xf amqp.tar.gz -C amqp --strip-components=1 \\\n    && rm amqp.tar.gz \\\n    && cd amqp \\\n    && phpize \\\n    && ./configure --with-php-config=/usr/local/bin/php-config  --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-dev \\\n    && make -j$(nproc) \\\n    && make install \\\n    && docker-php-ext-enable amqp\n\n# tideways\nRUN git clone https://github.com/tideways/php-profiler-extension.git \\\n        && cd php-profiler-extension \\ tideways_xhprof --strip-components=1 \\\n        && phpize \\\n        && ./configure \\\n        && make \\\n        && make install\n\n# xdebug 重点看这里即可\nRUN yes | pecl install xdebug \\\n    && echo \"zend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)\" > /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_enable=on\" >> /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_autostart=on\" >> /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_port=9211\" >> /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_host=192.168.0.103\" >> /usr/local/etc/php/conf.d/xdebug.ini\n\nRUN apt-get purge -y g++ \\\n    && apt-get autoremove -y \\\n    && rm -r /var/lib/apt/lists/* \\\n    && rm -rf /tmp/*\n\n\nWORKDIR /var/www/html\nCOPY ./nginx.conf /etc/nginx/nginx.conf\nCOPY ./local.ini /usr/local/php/conf/\n\nRUN echo 'date.timezone=PRC' > /usr/local/etc/php/conf.d/timezone.ini\n\nRUN usermod -u 1000 www-data\n\nEXPOSE 80 443\nCMD [\"sh\", '-c', 'nginx && php-fpm']\n```\n\n> <font color='red'>重点关注 xdebug 一段的安装及配置</font>，相当于\n\n```\n; Enable xdebug extension module\nzend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)\nxdebug.idekey = \"PHPSTORM\"\n; 因为DBGp调试代理是可以做调试分发的，所以，定义一个IDEKEY，目的是让调试器知道，是不是发给自己的请求\n\nxdebug.remote_enable = 1\n; 设置为1的时候，会先参数链接到remote_host和remote_port指定的调试器端口，如果连接不上，就继续执行，类似设置>了0\n\nxdebug.remote_mode = \"req\"\nxdebug.remote_handler = \"dbgp\"\n; 也就是调试走哪种协议，有老的PHP3协议，也有GDB协议，DBGP是当前的默认协议，也是当前主流支持的协议\n\nxdebug.remote_connect_back = 0\n; 如果为1，xdebug会通过$_SERVER[‘REMOTE_ADDR’]变量，向发起HTTP请求的客户端发起链接，和remote_host功能类似>，但是优先级比remote_host高，所以，设置了这个选项就会忽略remote_host，由于我的运行时服务器不能主动链接IDE所>在PC，所以不能开启自动回连模式(内网访问外网的网页，也不能开启)\n\n# 刚开始这里配置错了，怎么样都不行。。。\nxdebug.remote_host = \"192.168.0.103\"\n; 默认是主机，如果服务器可以直接你的本地电脑，可以直接填写本机ip，我这里使用xshell做tcp转发\n\nxdebug.remote_port = 9211\n; 默认端口是9000，由于端口被fpm占用，我修改为9211，建议没有端口冲突时不修改\n\nxdebug.remote_autostart = 0\n; 这个为1，会忽略COOKIE或者POST/GET中带的XDEBUG_SESSION参数，不管有没有，都会启动调试，所以，还是设置为0比较好，默认0\n```\n\n> local.ini\n\n```\npost_max_size = 256m\nupload_max_filesize = 256m\n```\n\n> nginx.conf\n\n```\nuser  www-data;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/json;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    gzip  on;\n\n    ## PHP-FPM Servers ##\n    upstream php-fpm {\n        server localhost:9000;\n    }\n\n    server {\n        listen       80;\n        server_name  localhost;\n        root   \"/var/www/html/\";\n\n        client_max_body_size 32m;\n\n        location / {\n            index  index.php;\n            if (!-e $request_filename){\n                rewrite ^/(.*) /index.php last;\n            }\n        }\n\n        location ~ ^(.+\\.php)(.*)$ {\n            fastcgi_index        index.php;\n            fastcgi_split_path_info ^(.+\\.php)(.*)$;\n            fastcgi_param        SCRIPT_FILENAME        $document_root$fastcgi_script_name;\n            fastcgi_param        PATH_INFO              $fastcgi_path_info;\n            fastcgi_param        PATH_TRANSLATED        $document_root$fastcgi_path_info;\n            fastcgi_pass php-fpm;\n            client_max_body_size 100m;\n            include        fastcgi_params;\n            add_header Access-Control-Allow-Origin \"*\";\n        }\n    }\n}\n```\n\n#### 2. 安装及验证\n\n> docker 环境\n\n```\n# 安装\ndocker-compose build\n# 启动\ndocker-compose up -d\n# 查看容器状态\ndocker-compose ps\n# 进入容器\ndocker-compose exec fpm bash\n\n# 查看\nphp -v\nPHP 7.1.23 (cli) (built: Oct 16 2018 01:08:49) ( NTS )\nCopyright (c) 1997-2018 The PHP Group\nZend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies\n    with Xdebug v2.6.1, Copyright (c) 2002-2018, by Derick Rethans\n# 可以看到PHP已正确安装，且 xdebug 扩展已开启\n\n# 新建 index.php 文件，在宿主机浏览器直接访问，得到结果，表示 nginx 已正确配置\n# 我这里 docker 虚拟机配置的端口为 9111\ncurl http://localhost:9111\n```\n\n> 配置 PHPstorm\n\n首先配置 PHPstorm 使用的 CLI 解释器为 docker 虚拟机内的 PHP\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195714.jpg)\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195838.jpg)\n\n配置 xdebug 端口\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-200745.jpg)\n    \nRun -> Edit Configuration 或者 或者点击 PHPstorm 右上角的 Edit Configuration\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201139.jpg)\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201423.jpg)\n\n> 浏览器调试，安装对应的扩展即可，略\n\n> postman 断点调试\n\n1. 选择刚才的配置，设置断点，开启小电话\n    ![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201724.jpg)\n2. 在指定域名（如 localhost）的 cookie 中添加一次 XDEBUG_SESSION=PHPSTORM\n    ![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201904.jpg)\n    ![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201952.jpg)\n3. 访问，即可自动跳回至 PHPstorm 的断点处，可以愉快地调试了。\n\n下一步，记录调试的流程、快捷键、技巧等，敬请期待。\n\n\n","source":"_posts/API 断点调试 -- PHPStorm && XDebug && Postman.md","raw":"---\ntitle: API 断点调试 -- PHPStorm && XDebug && Postman\ndate: 2019-02-16 12:45:02\ntags: xdebug\n---\n\n折腾了好久，记录一下，方便以后查阅。\n\n### 环境\n- MacOS Majave version 10.14.2\n- phpstorm 2018.2.2\n- Docker version 18.09.1, build 4c52b90\n- docker-compose version 1.23.2, build 1110ad01\n- postman 6.6.1\n- php 7.1.23\n- xdebug v2.6.1\n\n### 安装\n#### 1. 配置文件\n\n> docker-compose.yml\n\n```\n# 本机 80 端口被占用，随便改一个其他未使用端口\nversion: '3'\nservices:\n  fpm:\n    build: .\n    ports:\n    - \"9111:80\"\n    stdin_open: true\n    tty: true\n    volumes:\n    - .:/var/www/html\n    restart: always\n    command: \"sh -c 'nginx && php-fpm'\"\n```\n \n> Dockerfile\n\n```\nFROM php:7.1-fpm\n\nRUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' >/etc/timezone\n\nRUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list\n\nRUN echo 'date.timezone=PRC' > /usr/local/etc/php/conf.d/timezone.ini\n\n# Install modules\nRUN apt-get update && apt-get install -y \\\n        git \\\n        curl \\\n        openssl \\\n        wget \\\n        vim \\\n        procps \\\n        libssl-dev \\\n        libfreetype6-dev \\\n        libjpeg62-turbo-dev \\\n        libmcrypt-dev \\\n        libpng-dev \\\n        libicu-dev \\\n        libpcre3 libpcre3-dev \\\n        zlib1g-dev \\\n        gnupg2 \\\n             --no-install-recommends\n\n# ########### nginx ################\nRUN wget http://nginx.org/download/nginx-1.12.0.tar.gz -O nginx.tar.gz \\\n    && mkdir -p nginx \\\n    && tar -xf nginx.tar.gz -C nginx --strip-components=1 \\\n    && rm nginx.tar.gz\n\nRUN cd nginx && ./configure \\\n    --prefix=/etc/nginx \\\n    --sbin-path=/usr/sbin/nginx \\\n    --modules-path=/usr/lib/nginx/modules \\\n    --conf-path=/etc/nginx/nginx.conf \\\n    --error-log-path=/var/log/nginx/error.log \\\n    --http-log-path=/var/log/nginx/access.log \\\n    --pid-path=/var/run/nginx.pid \\\n    --lock-path=/var/run/nginx.lock \\\n    --http-client-body-temp-path=/var/cache/nginx/client_temp \\\n    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \\\n    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \\\n    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \\\n    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \\\n    --user=www-data \\\n    --group=www-data \\\n    --with-compat \\\n    --with-file-aio \\\n    --with-threads \\\n    --with-http_addition_module \\\n    --with-http_auth_request_module \\\n    --with-http_dav_module \\\n    --with-http_flv_module \\\n    --with-http_gunzip_module \\\n    --with-http_gzip_static_module \\\n    --with-http_mp4_module \\\n    --with-http_random_index_module \\\n    --with-http_realip_module \\\n    --with-http_secure_link_module \\\n    --with-http_slice_module \\\n    --with-http_ssl_module \\\n    --with-http_stub_status_module \\\n    --with-http_sub_module \\\n    --with-http_v2_module \\\n    --with-mail \\\n    --with-mail_ssl_module \\\n    --with-stream \\\n    --with-stream_realip_module \\\n    --with-stream_ssl_module \\\n    --with-stream_ssl_preread_module \\\n    --with-cc-opt='-g -O2 -fstack-protector-strong -Wformat -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fPIC' \\\n    --with-ld-opt='-Wl,-z,relro -Wl,-z,now -Wl,--as-needed -pie' \\\n    && make \\\n    && make install \\\n    && mkdir -p /var/cache/nginx/\n\n\n# Install composer && global asset plugin\nENV COMPOSER_HOME /root/.composer\nENV PATH /root/.composer/vendor/bin:$PATH\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \\\n    && composer config -g repo.packagist composer https://packagist.phpcomposer.com\n\n#install extension\nRUN docker-php-ext-install zip \\\n    && docker-php-ext-install mcrypt \\\n    && docker-php-ext-install intl \\\n    && docker-php-ext-install mbstring \\\n    && docker-php-ext-install pdo_mysql \\\n    && docker-php-ext-install pcntl \\\n    && docker-php-ext-install bcmath\n\n#install gd\nRUN docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \\\n    && docker-php-ext-install gd\n\n# redis\nRUN wget http://pecl.php.net/get/redis-3.1.6.tgz \\\n    && pecl install redis-3.1.6.tgz \\\n    && rm -f redis-3.1.6.tgz \\\n    && docker-php-ext-enable redis\n\n# amqp\nRUN apt install librabbitmq-dev -y\n\nRUN wget https://github.com/alanxz/rabbitmq-c/releases/download/v0.8.0/rabbitmq-c-0.8.0.tar.gz -O rabbitmq.tar.gz \\\n    && mkdir -p rabbitmq \\\n    && tar -xf rabbitmq.tar.gz -C rabbitmq --strip-components=1 \\\n    && rm rabbitmq.tar.gz \\\n    && cd rabbitmq \\\n    && ./configure --prefix=/usr/local/rabbitmq-dev \\\n    && make \\\n    && make install \\\n    && cd .. \\\n    && rm -rf rabbitmq\n\nRUN wget http://pecl.php.net/get/amqp-1.9.3.tgz -O amqp.tar.gz \\\n    && mkdir -p amqp \\\n    && tar -xf amqp.tar.gz -C amqp --strip-components=1 \\\n    && rm amqp.tar.gz \\\n    && cd amqp \\\n    && phpize \\\n    && ./configure --with-php-config=/usr/local/bin/php-config  --with-amqp --with-librabbitmq-dir=/usr/local/rabbitmq-dev \\\n    && make -j$(nproc) \\\n    && make install \\\n    && docker-php-ext-enable amqp\n\n# tideways\nRUN git clone https://github.com/tideways/php-profiler-extension.git \\\n        && cd php-profiler-extension \\ tideways_xhprof --strip-components=1 \\\n        && phpize \\\n        && ./configure \\\n        && make \\\n        && make install\n\n# xdebug 重点看这里即可\nRUN yes | pecl install xdebug \\\n    && echo \"zend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)\" > /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_enable=on\" >> /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_autostart=on\" >> /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_port=9211\" >> /usr/local/etc/php/conf.d/xdebug.ini \\\n    && echo \"xdebug.remote_host=192.168.0.103\" >> /usr/local/etc/php/conf.d/xdebug.ini\n\nRUN apt-get purge -y g++ \\\n    && apt-get autoremove -y \\\n    && rm -r /var/lib/apt/lists/* \\\n    && rm -rf /tmp/*\n\n\nWORKDIR /var/www/html\nCOPY ./nginx.conf /etc/nginx/nginx.conf\nCOPY ./local.ini /usr/local/php/conf/\n\nRUN echo 'date.timezone=PRC' > /usr/local/etc/php/conf.d/timezone.ini\n\nRUN usermod -u 1000 www-data\n\nEXPOSE 80 443\nCMD [\"sh\", '-c', 'nginx && php-fpm']\n```\n\n> <font color='red'>重点关注 xdebug 一段的安装及配置</font>，相当于\n\n```\n; Enable xdebug extension module\nzend_extension=$(find /usr/local/lib/php/extensions/ -name xdebug.so)\nxdebug.idekey = \"PHPSTORM\"\n; 因为DBGp调试代理是可以做调试分发的，所以，定义一个IDEKEY，目的是让调试器知道，是不是发给自己的请求\n\nxdebug.remote_enable = 1\n; 设置为1的时候，会先参数链接到remote_host和remote_port指定的调试器端口，如果连接不上，就继续执行，类似设置>了0\n\nxdebug.remote_mode = \"req\"\nxdebug.remote_handler = \"dbgp\"\n; 也就是调试走哪种协议，有老的PHP3协议，也有GDB协议，DBGP是当前的默认协议，也是当前主流支持的协议\n\nxdebug.remote_connect_back = 0\n; 如果为1，xdebug会通过$_SERVER[‘REMOTE_ADDR’]变量，向发起HTTP请求的客户端发起链接，和remote_host功能类似>，但是优先级比remote_host高，所以，设置了这个选项就会忽略remote_host，由于我的运行时服务器不能主动链接IDE所>在PC，所以不能开启自动回连模式(内网访问外网的网页，也不能开启)\n\n# 刚开始这里配置错了，怎么样都不行。。。\nxdebug.remote_host = \"192.168.0.103\"\n; 默认是主机，如果服务器可以直接你的本地电脑，可以直接填写本机ip，我这里使用xshell做tcp转发\n\nxdebug.remote_port = 9211\n; 默认端口是9000，由于端口被fpm占用，我修改为9211，建议没有端口冲突时不修改\n\nxdebug.remote_autostart = 0\n; 这个为1，会忽略COOKIE或者POST/GET中带的XDEBUG_SESSION参数，不管有没有，都会启动调试，所以，还是设置为0比较好，默认0\n```\n\n> local.ini\n\n```\npost_max_size = 256m\nupload_max_filesize = 256m\n```\n\n> nginx.conf\n\n```\nuser  www-data;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/json;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    gzip  on;\n\n    ## PHP-FPM Servers ##\n    upstream php-fpm {\n        server localhost:9000;\n    }\n\n    server {\n        listen       80;\n        server_name  localhost;\n        root   \"/var/www/html/\";\n\n        client_max_body_size 32m;\n\n        location / {\n            index  index.php;\n            if (!-e $request_filename){\n                rewrite ^/(.*) /index.php last;\n            }\n        }\n\n        location ~ ^(.+\\.php)(.*)$ {\n            fastcgi_index        index.php;\n            fastcgi_split_path_info ^(.+\\.php)(.*)$;\n            fastcgi_param        SCRIPT_FILENAME        $document_root$fastcgi_script_name;\n            fastcgi_param        PATH_INFO              $fastcgi_path_info;\n            fastcgi_param        PATH_TRANSLATED        $document_root$fastcgi_path_info;\n            fastcgi_pass php-fpm;\n            client_max_body_size 100m;\n            include        fastcgi_params;\n            add_header Access-Control-Allow-Origin \"*\";\n        }\n    }\n}\n```\n\n#### 2. 安装及验证\n\n> docker 环境\n\n```\n# 安装\ndocker-compose build\n# 启动\ndocker-compose up -d\n# 查看容器状态\ndocker-compose ps\n# 进入容器\ndocker-compose exec fpm bash\n\n# 查看\nphp -v\nPHP 7.1.23 (cli) (built: Oct 16 2018 01:08:49) ( NTS )\nCopyright (c) 1997-2018 The PHP Group\nZend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies\n    with Xdebug v2.6.1, Copyright (c) 2002-2018, by Derick Rethans\n# 可以看到PHP已正确安装，且 xdebug 扩展已开启\n\n# 新建 index.php 文件，在宿主机浏览器直接访问，得到结果，表示 nginx 已正确配置\n# 我这里 docker 虚拟机配置的端口为 9111\ncurl http://localhost:9111\n```\n\n> 配置 PHPstorm\n\n首先配置 PHPstorm 使用的 CLI 解释器为 docker 虚拟机内的 PHP\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195714.jpg)\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195838.jpg)\n\n配置 xdebug 端口\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-200745.jpg)\n    \nRun -> Edit Configuration 或者 或者点击 PHPstorm 右上角的 Edit Configuration\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201139.jpg)\n\n![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201423.jpg)\n\n> 浏览器调试，安装对应的扩展即可，略\n\n> postman 断点调试\n\n1. 选择刚才的配置，设置断点，开启小电话\n    ![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201724.jpg)\n2. 在指定域名（如 localhost）的 cookie 中添加一次 XDEBUG_SESSION=PHPSTORM\n    ![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201904.jpg)\n    ![](https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201952.jpg)\n3. 访问，即可自动跳回至 PHPstorm 的断点处，可以愉快地调试了。\n\n下一步，记录调试的流程、快捷键、技巧等，敬请期待。\n\n\n","slug":"API 断点调试 -- PHPStorm && XDebug && Postman","published":1,"updated":"2020-09-11T01:04:35.031Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7k00036wo1dye05s8m","content":"<p>折腾了好久，记录一下，方便以后查阅。</p>\n<h3 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h3><ul>\n<li>MacOS Majave version 10.14.2</li>\n<li>phpstorm 2018.2.2</li>\n<li>Docker version 18.09.1, build 4c52b90</li>\n<li>docker-compose version 1.23.2, build 1110ad01</li>\n<li>postman 6.6.1</li>\n<li>php 7.1.23</li>\n<li>xdebug v2.6.1</li>\n</ul>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><h4 id=\"1-配置文件\"><a href=\"#1-配置文件\" class=\"headerlink\" title=\"1. 配置文件\"></a>1. 配置文件</h4><blockquote>\n<p>docker-compose.yml</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 本机 80 端口被占用，随便改一个其他未使用端口</span><br><span class=\"line\">version: &#39;3&#39;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  fpm:</span><br><span class=\"line\">    build: .</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">    - &quot;9111:80&quot;</span><br><span class=\"line\">    stdin_open: true</span><br><span class=\"line\">    tty: true</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">    - .:&#x2F;var&#x2F;www&#x2F;html</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    command: &quot;sh -c &#39;nginx &amp;&amp; php-fpm&#39;&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Dockerfile</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM php:7.1-fpm</span><br><span class=\"line\"></span><br><span class=\"line\">RUN cp &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime &amp;&amp; echo &#39;Asia&#x2F;Shanghai&#39; &gt;&#x2F;etc&#x2F;timezone</span><br><span class=\"line\"></span><br><span class=\"line\">RUN sed -i &#39;s&#x2F;deb.debian.org&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class=\"line\"></span><br><span class=\"line\">RUN echo &#39;date.timezone&#x3D;PRC&#39; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;timezone.ini</span><br><span class=\"line\"></span><br><span class=\"line\"># Install modules</span><br><span class=\"line\">RUN apt-get update &amp;&amp; apt-get install -y \\</span><br><span class=\"line\">        git \\</span><br><span class=\"line\">        curl \\</span><br><span class=\"line\">        openssl \\</span><br><span class=\"line\">        wget \\</span><br><span class=\"line\">        vim \\</span><br><span class=\"line\">        procps \\</span><br><span class=\"line\">        libssl-dev \\</span><br><span class=\"line\">        libfreetype6-dev \\</span><br><span class=\"line\">        libjpeg62-turbo-dev \\</span><br><span class=\"line\">        libmcrypt-dev \\</span><br><span class=\"line\">        libpng-dev \\</span><br><span class=\"line\">        libicu-dev \\</span><br><span class=\"line\">        libpcre3 libpcre3-dev \\</span><br><span class=\"line\">        zlib1g-dev \\</span><br><span class=\"line\">        gnupg2 \\</span><br><span class=\"line\">             --no-install-recommends</span><br><span class=\"line\"></span><br><span class=\"line\"># ########### nginx ################</span><br><span class=\"line\">RUN wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.12.0.tar.gz -O nginx.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p nginx \\</span><br><span class=\"line\">    &amp;&amp; tar -xf nginx.tar.gz -C nginx --strip-components&#x3D;1 \\</span><br><span class=\"line\">    &amp;&amp; rm nginx.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">RUN cd nginx &amp;&amp; .&#x2F;configure \\</span><br><span class=\"line\">    --prefix&#x3D;&#x2F;etc&#x2F;nginx \\</span><br><span class=\"line\">    --sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx \\</span><br><span class=\"line\">    --modules-path&#x3D;&#x2F;usr&#x2F;lib&#x2F;nginx&#x2F;modules \\</span><br><span class=\"line\">    --conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf \\</span><br><span class=\"line\">    --error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log \\</span><br><span class=\"line\">    --http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log \\</span><br><span class=\"line\">    --pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.pid \\</span><br><span class=\"line\">    --lock-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.lock \\</span><br><span class=\"line\">    --http-client-body-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;client_temp \\</span><br><span class=\"line\">    --http-proxy-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;proxy_temp \\</span><br><span class=\"line\">    --http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;fastcgi_temp \\</span><br><span class=\"line\">    --http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;uwsgi_temp \\</span><br><span class=\"line\">    --http-scgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;scgi_temp \\</span><br><span class=\"line\">    --user&#x3D;www-data \\</span><br><span class=\"line\">    --group&#x3D;www-data \\</span><br><span class=\"line\">    --with-compat \\</span><br><span class=\"line\">    --with-file-aio \\</span><br><span class=\"line\">    --with-threads \\</span><br><span class=\"line\">    --with-http_addition_module \\</span><br><span class=\"line\">    --with-http_auth_request_module \\</span><br><span class=\"line\">    --with-http_dav_module \\</span><br><span class=\"line\">    --with-http_flv_module \\</span><br><span class=\"line\">    --with-http_gunzip_module \\</span><br><span class=\"line\">    --with-http_gzip_static_module \\</span><br><span class=\"line\">    --with-http_mp4_module \\</span><br><span class=\"line\">    --with-http_random_index_module \\</span><br><span class=\"line\">    --with-http_realip_module \\</span><br><span class=\"line\">    --with-http_secure_link_module \\</span><br><span class=\"line\">    --with-http_slice_module \\</span><br><span class=\"line\">    --with-http_ssl_module \\</span><br><span class=\"line\">    --with-http_stub_status_module \\</span><br><span class=\"line\">    --with-http_sub_module \\</span><br><span class=\"line\">    --with-http_v2_module \\</span><br><span class=\"line\">    --with-mail \\</span><br><span class=\"line\">    --with-mail_ssl_module \\</span><br><span class=\"line\">    --with-stream \\</span><br><span class=\"line\">    --with-stream_realip_module \\</span><br><span class=\"line\">    --with-stream_ssl_module \\</span><br><span class=\"line\">    --with-stream_ssl_preread_module \\</span><br><span class=\"line\">    --with-cc-opt&#x3D;&#39;-g -O2 -fstack-protector-strong -Wformat -Werror&#x3D;format-security -Wp,-D_FORTIFY_SOURCE&#x3D;2 -fPIC&#39; \\</span><br><span class=\"line\">    --with-ld-opt&#x3D;&#39;-Wl,-z,relro -Wl,-z,now -Wl,--as-needed -pie&#39; \\</span><br><span class=\"line\">    &amp;&amp; make \\</span><br><span class=\"line\">    &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Install composer &amp;&amp; global asset plugin</span><br><span class=\"line\">ENV COMPOSER_HOME &#x2F;root&#x2F;.composer</span><br><span class=\"line\">ENV PATH &#x2F;root&#x2F;.composer&#x2F;vendor&#x2F;bin:$PATH</span><br><span class=\"line\">RUN curl -sS https:&#x2F;&#x2F;getcomposer.org&#x2F;installer | php -- --install-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;bin --filename&#x3D;composer \\</span><br><span class=\"line\">    &amp;&amp; composer config -g repo.packagist composer https:&#x2F;&#x2F;packagist.phpcomposer.com</span><br><span class=\"line\"></span><br><span class=\"line\">#install extension</span><br><span class=\"line\">RUN docker-php-ext-install zip \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install mcrypt \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install intl \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install mbstring \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install pdo_mysql \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install pcntl \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install bcmath</span><br><span class=\"line\"></span><br><span class=\"line\">#install gd</span><br><span class=\"line\">RUN docker-php-ext-configure gd --with-freetype-dir&#x3D;&#x2F;usr&#x2F;include&#x2F; --with-jpeg-dir&#x3D;&#x2F;usr&#x2F;include&#x2F; \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install gd</span><br><span class=\"line\"></span><br><span class=\"line\"># redis</span><br><span class=\"line\">RUN wget http:&#x2F;&#x2F;pecl.php.net&#x2F;get&#x2F;redis-3.1.6.tgz \\</span><br><span class=\"line\">    &amp;&amp; pecl install redis-3.1.6.tgz \\</span><br><span class=\"line\">    &amp;&amp; rm -f redis-3.1.6.tgz \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-enable redis</span><br><span class=\"line\"></span><br><span class=\"line\"># amqp</span><br><span class=\"line\">RUN apt install librabbitmq-dev -y</span><br><span class=\"line\"></span><br><span class=\"line\">RUN wget https:&#x2F;&#x2F;github.com&#x2F;alanxz&#x2F;rabbitmq-c&#x2F;releases&#x2F;download&#x2F;v0.8.0&#x2F;rabbitmq-c-0.8.0.tar.gz -O rabbitmq.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p rabbitmq \\</span><br><span class=\"line\">    &amp;&amp; tar -xf rabbitmq.tar.gz -C rabbitmq --strip-components&#x3D;1 \\</span><br><span class=\"line\">    &amp;&amp; rm rabbitmq.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; cd rabbitmq \\</span><br><span class=\"line\">    &amp;&amp; .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;rabbitmq-dev \\</span><br><span class=\"line\">    &amp;&amp; make \\</span><br><span class=\"line\">    &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; cd .. \\</span><br><span class=\"line\">    &amp;&amp; rm -rf rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\">RUN wget http:&#x2F;&#x2F;pecl.php.net&#x2F;get&#x2F;amqp-1.9.3.tgz -O amqp.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p amqp \\</span><br><span class=\"line\">    &amp;&amp; tar -xf amqp.tar.gz -C amqp --strip-components&#x3D;1 \\</span><br><span class=\"line\">    &amp;&amp; rm amqp.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; cd amqp \\</span><br><span class=\"line\">    &amp;&amp; phpize \\</span><br><span class=\"line\">    &amp;&amp; .&#x2F;configure --with-php-config&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php-config  --with-amqp --with-librabbitmq-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;rabbitmq-dev \\</span><br><span class=\"line\">    &amp;&amp; make -j$(nproc) \\</span><br><span class=\"line\">    &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-enable amqp</span><br><span class=\"line\"></span><br><span class=\"line\"># tideways</span><br><span class=\"line\">RUN git clone https:&#x2F;&#x2F;github.com&#x2F;tideways&#x2F;php-profiler-extension.git \\</span><br><span class=\"line\">        &amp;&amp; cd php-profiler-extension \\ tideways_xhprof --strip-components&#x3D;1 \\</span><br><span class=\"line\">        &amp;&amp; phpize \\</span><br><span class=\"line\">        &amp;&amp; .&#x2F;configure \\</span><br><span class=\"line\">        &amp;&amp; make \\</span><br><span class=\"line\">        &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"># xdebug 重点看这里即可</span><br><span class=\"line\">RUN yes | pecl install xdebug \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;zend_extension&#x3D;$(find &#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;extensions&#x2F; -name xdebug.so)&quot; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_enable&#x3D;on&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_autostart&#x3D;on&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_port&#x3D;9211&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_host&#x3D;192.168.0.103&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini</span><br><span class=\"line\"></span><br><span class=\"line\">RUN apt-get purge -y g++ \\</span><br><span class=\"line\">    &amp;&amp; apt-get autoremove -y \\</span><br><span class=\"line\">    &amp;&amp; rm -r &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;* \\</span><br><span class=\"line\">    &amp;&amp; rm -rf &#x2F;tmp&#x2F;*</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">WORKDIR &#x2F;var&#x2F;www&#x2F;html</span><br><span class=\"line\">COPY .&#x2F;nginx.conf &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class=\"line\">COPY .&#x2F;local.ini &#x2F;usr&#x2F;local&#x2F;php&#x2F;conf&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">RUN echo &#39;date.timezone&#x3D;PRC&#39; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;timezone.ini</span><br><span class=\"line\"></span><br><span class=\"line\">RUN usermod -u 1000 www-data</span><br><span class=\"line\"></span><br><span class=\"line\">EXPOSE 80 443</span><br><span class=\"line\">CMD [&quot;sh&quot;, &#39;-c&#39;, &#39;nginx &amp;&amp; php-fpm&#39;]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><font color='red'>重点关注 xdebug 一段的安装及配置</font>，相当于</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; Enable xdebug extension module</span><br><span class=\"line\">zend_extension&#x3D;$(find &#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;extensions&#x2F; -name xdebug.so)</span><br><span class=\"line\">xdebug.idekey &#x3D; &quot;PHPSTORM&quot;</span><br><span class=\"line\">; 因为DBGp调试代理是可以做调试分发的，所以，定义一个IDEKEY，目的是让调试器知道，是不是发给自己的请求</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_enable &#x3D; 1</span><br><span class=\"line\">; 设置为1的时候，会先参数链接到remote_host和remote_port指定的调试器端口，如果连接不上，就继续执行，类似设置&gt;了0</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_mode &#x3D; &quot;req&quot;</span><br><span class=\"line\">xdebug.remote_handler &#x3D; &quot;dbgp&quot;</span><br><span class=\"line\">; 也就是调试走哪种协议，有老的PHP3协议，也有GDB协议，DBGP是当前的默认协议，也是当前主流支持的协议</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_connect_back &#x3D; 0</span><br><span class=\"line\">; 如果为1，xdebug会通过$_SERVER[‘REMOTE_ADDR’]变量，向发起HTTP请求的客户端发起链接，和remote_host功能类似&gt;，但是优先级比remote_host高，所以，设置了这个选项就会忽略remote_host，由于我的运行时服务器不能主动链接IDE所&gt;在PC，所以不能开启自动回连模式(内网访问外网的网页，也不能开启)</span><br><span class=\"line\"></span><br><span class=\"line\"># 刚开始这里配置错了，怎么样都不行。。。</span><br><span class=\"line\">xdebug.remote_host &#x3D; &quot;192.168.0.103&quot;</span><br><span class=\"line\">; 默认是主机，如果服务器可以直接你的本地电脑，可以直接填写本机ip，我这里使用xshell做tcp转发</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_port &#x3D; 9211</span><br><span class=\"line\">; 默认端口是9000，由于端口被fpm占用，我修改为9211，建议没有端口冲突时不修改</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_autostart &#x3D; 0</span><br><span class=\"line\">; 这个为1，会忽略COOKIE或者POST&#x2F;GET中带的XDEBUG_SESSION参数，不管有没有，都会启动调试，所以，还是设置为0比较好，默认0</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>local.ini</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">post_max_size &#x3D; 256m</span><br><span class=\"line\">upload_max_filesize &#x3D; 256m</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>nginx.conf</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user  www-data;</span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"></span><br><span class=\"line\">error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;</span><br><span class=\"line\">pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class=\"line\">    default_type  application&#x2F;json;</span><br><span class=\"line\"></span><br><span class=\"line\">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class=\"line\">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class=\"line\">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    ## PHP-FPM Servers ##</span><br><span class=\"line\">    upstream php-fpm &#123;</span><br><span class=\"line\">        server localhost:9000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\">        root   &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">        client_max_body_size 32m;</span><br><span class=\"line\"></span><br><span class=\"line\">        location &#x2F; &#123;</span><br><span class=\"line\">            index  index.php;</span><br><span class=\"line\">            if (!-e $request_filename)&#123;</span><br><span class=\"line\">                rewrite ^&#x2F;(.*) &#x2F;index.php last;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ ^(.+\\.php)(.*)$ &#123;</span><br><span class=\"line\">            fastcgi_index        index.php;</span><br><span class=\"line\">            fastcgi_split_path_info ^(.+\\.php)(.*)$;</span><br><span class=\"line\">            fastcgi_param        SCRIPT_FILENAME        $document_root$fastcgi_script_name;</span><br><span class=\"line\">            fastcgi_param        PATH_INFO              $fastcgi_path_info;</span><br><span class=\"line\">            fastcgi_param        PATH_TRANSLATED        $document_root$fastcgi_path_info;</span><br><span class=\"line\">            fastcgi_pass php-fpm;</span><br><span class=\"line\">            client_max_body_size 100m;</span><br><span class=\"line\">            include        fastcgi_params;</span><br><span class=\"line\">            add_header Access-Control-Allow-Origin &quot;*&quot;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-安装及验证\"><a href=\"#2-安装及验证\" class=\"headerlink\" title=\"2. 安装及验证\"></a>2. 安装及验证</h4><blockquote>\n<p>docker 环境</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装</span><br><span class=\"line\">docker-compose build</span><br><span class=\"line\"># 启动</span><br><span class=\"line\">docker-compose up -d</span><br><span class=\"line\"># 查看容器状态</span><br><span class=\"line\">docker-compose ps</span><br><span class=\"line\"># 进入容器</span><br><span class=\"line\">docker-compose exec fpm bash</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看</span><br><span class=\"line\">php -v</span><br><span class=\"line\">PHP 7.1.23 (cli) (built: Oct 16 2018 01:08:49) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2018 The PHP Group</span><br><span class=\"line\">Zend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies</span><br><span class=\"line\">    with Xdebug v2.6.1, Copyright (c) 2002-2018, by Derick Rethans</span><br><span class=\"line\"># 可以看到PHP已正确安装，且 xdebug 扩展已开启</span><br><span class=\"line\"></span><br><span class=\"line\"># 新建 index.php 文件，在宿主机浏览器直接访问，得到结果，表示 nginx 已正确配置</span><br><span class=\"line\"># 我这里 docker 虚拟机配置的端口为 9111</span><br><span class=\"line\">curl http:&#x2F;&#x2F;localhost:9111</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>配置 PHPstorm</p>\n</blockquote>\n<p>首先配置 PHPstorm 使用的 CLI 解释器为 docker 虚拟机内的 PHP</p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195714.jpg\"></p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195838.jpg\"></p>\n<p>配置 xdebug 端口<br><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-200745.jpg\"></p>\n<p>Run -&gt; Edit Configuration 或者 或者点击 PHPstorm 右上角的 Edit Configuration</p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201139.jpg\"></p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201423.jpg\"></p>\n<blockquote>\n<p>浏览器调试，安装对应的扩展即可，略</p>\n</blockquote>\n<blockquote>\n<p>postman 断点调试</p>\n</blockquote>\n<ol>\n<li>选择刚才的配置，设置断点，开启小电话<br> <img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201724.jpg\"></li>\n<li>在指定域名（如 localhost）的 cookie 中添加一次 XDEBUG_SESSION=PHPSTORM<br> <img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201904.jpg\"><br> <img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201952.jpg\"></li>\n<li>访问，即可自动跳回至 PHPstorm 的断点处，可以愉快地调试了。</li>\n</ol>\n<p>下一步，记录调试的流程、快捷键、技巧等，敬请期待。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>折腾了好久，记录一下，方便以后查阅。</p>\n<h3 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h3><ul>\n<li>MacOS Majave version 10.14.2</li>\n<li>phpstorm 2018.2.2</li>\n<li>Docker version 18.09.1, build 4c52b90</li>\n<li>docker-compose version 1.23.2, build 1110ad01</li>\n<li>postman 6.6.1</li>\n<li>php 7.1.23</li>\n<li>xdebug v2.6.1</li>\n</ul>\n<h3 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h3><h4 id=\"1-配置文件\"><a href=\"#1-配置文件\" class=\"headerlink\" title=\"1. 配置文件\"></a>1. 配置文件</h4><blockquote>\n<p>docker-compose.yml</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 本机 80 端口被占用，随便改一个其他未使用端口</span><br><span class=\"line\">version: &#39;3&#39;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  fpm:</span><br><span class=\"line\">    build: .</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">    - &quot;9111:80&quot;</span><br><span class=\"line\">    stdin_open: true</span><br><span class=\"line\">    tty: true</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">    - .:&#x2F;var&#x2F;www&#x2F;html</span><br><span class=\"line\">    restart: always</span><br><span class=\"line\">    command: &quot;sh -c &#39;nginx &amp;&amp; php-fpm&#39;&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Dockerfile</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FROM php:7.1-fpm</span><br><span class=\"line\"></span><br><span class=\"line\">RUN cp &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime &amp;&amp; echo &#39;Asia&#x2F;Shanghai&#39; &gt;&#x2F;etc&#x2F;timezone</span><br><span class=\"line\"></span><br><span class=\"line\">RUN sed -i &#39;s&#x2F;deb.debian.org&#x2F;mirrors.ustc.edu.cn&#x2F;g&#39; &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class=\"line\"></span><br><span class=\"line\">RUN echo &#39;date.timezone&#x3D;PRC&#39; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;timezone.ini</span><br><span class=\"line\"></span><br><span class=\"line\"># Install modules</span><br><span class=\"line\">RUN apt-get update &amp;&amp; apt-get install -y \\</span><br><span class=\"line\">        git \\</span><br><span class=\"line\">        curl \\</span><br><span class=\"line\">        openssl \\</span><br><span class=\"line\">        wget \\</span><br><span class=\"line\">        vim \\</span><br><span class=\"line\">        procps \\</span><br><span class=\"line\">        libssl-dev \\</span><br><span class=\"line\">        libfreetype6-dev \\</span><br><span class=\"line\">        libjpeg62-turbo-dev \\</span><br><span class=\"line\">        libmcrypt-dev \\</span><br><span class=\"line\">        libpng-dev \\</span><br><span class=\"line\">        libicu-dev \\</span><br><span class=\"line\">        libpcre3 libpcre3-dev \\</span><br><span class=\"line\">        zlib1g-dev \\</span><br><span class=\"line\">        gnupg2 \\</span><br><span class=\"line\">             --no-install-recommends</span><br><span class=\"line\"></span><br><span class=\"line\"># ########### nginx ################</span><br><span class=\"line\">RUN wget http:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.12.0.tar.gz -O nginx.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p nginx \\</span><br><span class=\"line\">    &amp;&amp; tar -xf nginx.tar.gz -C nginx --strip-components&#x3D;1 \\</span><br><span class=\"line\">    &amp;&amp; rm nginx.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">RUN cd nginx &amp;&amp; .&#x2F;configure \\</span><br><span class=\"line\">    --prefix&#x3D;&#x2F;etc&#x2F;nginx \\</span><br><span class=\"line\">    --sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx \\</span><br><span class=\"line\">    --modules-path&#x3D;&#x2F;usr&#x2F;lib&#x2F;nginx&#x2F;modules \\</span><br><span class=\"line\">    --conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf \\</span><br><span class=\"line\">    --error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log \\</span><br><span class=\"line\">    --http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log \\</span><br><span class=\"line\">    --pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.pid \\</span><br><span class=\"line\">    --lock-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.lock \\</span><br><span class=\"line\">    --http-client-body-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;client_temp \\</span><br><span class=\"line\">    --http-proxy-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;proxy_temp \\</span><br><span class=\"line\">    --http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;fastcgi_temp \\</span><br><span class=\"line\">    --http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;uwsgi_temp \\</span><br><span class=\"line\">    --http-scgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;scgi_temp \\</span><br><span class=\"line\">    --user&#x3D;www-data \\</span><br><span class=\"line\">    --group&#x3D;www-data \\</span><br><span class=\"line\">    --with-compat \\</span><br><span class=\"line\">    --with-file-aio \\</span><br><span class=\"line\">    --with-threads \\</span><br><span class=\"line\">    --with-http_addition_module \\</span><br><span class=\"line\">    --with-http_auth_request_module \\</span><br><span class=\"line\">    --with-http_dav_module \\</span><br><span class=\"line\">    --with-http_flv_module \\</span><br><span class=\"line\">    --with-http_gunzip_module \\</span><br><span class=\"line\">    --with-http_gzip_static_module \\</span><br><span class=\"line\">    --with-http_mp4_module \\</span><br><span class=\"line\">    --with-http_random_index_module \\</span><br><span class=\"line\">    --with-http_realip_module \\</span><br><span class=\"line\">    --with-http_secure_link_module \\</span><br><span class=\"line\">    --with-http_slice_module \\</span><br><span class=\"line\">    --with-http_ssl_module \\</span><br><span class=\"line\">    --with-http_stub_status_module \\</span><br><span class=\"line\">    --with-http_sub_module \\</span><br><span class=\"line\">    --with-http_v2_module \\</span><br><span class=\"line\">    --with-mail \\</span><br><span class=\"line\">    --with-mail_ssl_module \\</span><br><span class=\"line\">    --with-stream \\</span><br><span class=\"line\">    --with-stream_realip_module \\</span><br><span class=\"line\">    --with-stream_ssl_module \\</span><br><span class=\"line\">    --with-stream_ssl_preread_module \\</span><br><span class=\"line\">    --with-cc-opt&#x3D;&#39;-g -O2 -fstack-protector-strong -Wformat -Werror&#x3D;format-security -Wp,-D_FORTIFY_SOURCE&#x3D;2 -fPIC&#39; \\</span><br><span class=\"line\">    --with-ld-opt&#x3D;&#39;-Wl,-z,relro -Wl,-z,now -Wl,--as-needed -pie&#39; \\</span><br><span class=\"line\">    &amp;&amp; make \\</span><br><span class=\"line\">    &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p &#x2F;var&#x2F;cache&#x2F;nginx&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># Install composer &amp;&amp; global asset plugin</span><br><span class=\"line\">ENV COMPOSER_HOME &#x2F;root&#x2F;.composer</span><br><span class=\"line\">ENV PATH &#x2F;root&#x2F;.composer&#x2F;vendor&#x2F;bin:$PATH</span><br><span class=\"line\">RUN curl -sS https:&#x2F;&#x2F;getcomposer.org&#x2F;installer | php -- --install-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;bin --filename&#x3D;composer \\</span><br><span class=\"line\">    &amp;&amp; composer config -g repo.packagist composer https:&#x2F;&#x2F;packagist.phpcomposer.com</span><br><span class=\"line\"></span><br><span class=\"line\">#install extension</span><br><span class=\"line\">RUN docker-php-ext-install zip \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install mcrypt \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install intl \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install mbstring \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install pdo_mysql \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install pcntl \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install bcmath</span><br><span class=\"line\"></span><br><span class=\"line\">#install gd</span><br><span class=\"line\">RUN docker-php-ext-configure gd --with-freetype-dir&#x3D;&#x2F;usr&#x2F;include&#x2F; --with-jpeg-dir&#x3D;&#x2F;usr&#x2F;include&#x2F; \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-install gd</span><br><span class=\"line\"></span><br><span class=\"line\"># redis</span><br><span class=\"line\">RUN wget http:&#x2F;&#x2F;pecl.php.net&#x2F;get&#x2F;redis-3.1.6.tgz \\</span><br><span class=\"line\">    &amp;&amp; pecl install redis-3.1.6.tgz \\</span><br><span class=\"line\">    &amp;&amp; rm -f redis-3.1.6.tgz \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-enable redis</span><br><span class=\"line\"></span><br><span class=\"line\"># amqp</span><br><span class=\"line\">RUN apt install librabbitmq-dev -y</span><br><span class=\"line\"></span><br><span class=\"line\">RUN wget https:&#x2F;&#x2F;github.com&#x2F;alanxz&#x2F;rabbitmq-c&#x2F;releases&#x2F;download&#x2F;v0.8.0&#x2F;rabbitmq-c-0.8.0.tar.gz -O rabbitmq.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p rabbitmq \\</span><br><span class=\"line\">    &amp;&amp; tar -xf rabbitmq.tar.gz -C rabbitmq --strip-components&#x3D;1 \\</span><br><span class=\"line\">    &amp;&amp; rm rabbitmq.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; cd rabbitmq \\</span><br><span class=\"line\">    &amp;&amp; .&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;rabbitmq-dev \\</span><br><span class=\"line\">    &amp;&amp; make \\</span><br><span class=\"line\">    &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; cd .. \\</span><br><span class=\"line\">    &amp;&amp; rm -rf rabbitmq</span><br><span class=\"line\"></span><br><span class=\"line\">RUN wget http:&#x2F;&#x2F;pecl.php.net&#x2F;get&#x2F;amqp-1.9.3.tgz -O amqp.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; mkdir -p amqp \\</span><br><span class=\"line\">    &amp;&amp; tar -xf amqp.tar.gz -C amqp --strip-components&#x3D;1 \\</span><br><span class=\"line\">    &amp;&amp; rm amqp.tar.gz \\</span><br><span class=\"line\">    &amp;&amp; cd amqp \\</span><br><span class=\"line\">    &amp;&amp; phpize \\</span><br><span class=\"line\">    &amp;&amp; .&#x2F;configure --with-php-config&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php-config  --with-amqp --with-librabbitmq-dir&#x3D;&#x2F;usr&#x2F;local&#x2F;rabbitmq-dev \\</span><br><span class=\"line\">    &amp;&amp; make -j$(nproc) \\</span><br><span class=\"line\">    &amp;&amp; make install \\</span><br><span class=\"line\">    &amp;&amp; docker-php-ext-enable amqp</span><br><span class=\"line\"></span><br><span class=\"line\"># tideways</span><br><span class=\"line\">RUN git clone https:&#x2F;&#x2F;github.com&#x2F;tideways&#x2F;php-profiler-extension.git \\</span><br><span class=\"line\">        &amp;&amp; cd php-profiler-extension \\ tideways_xhprof --strip-components&#x3D;1 \\</span><br><span class=\"line\">        &amp;&amp; phpize \\</span><br><span class=\"line\">        &amp;&amp; .&#x2F;configure \\</span><br><span class=\"line\">        &amp;&amp; make \\</span><br><span class=\"line\">        &amp;&amp; make install</span><br><span class=\"line\"></span><br><span class=\"line\"># xdebug 重点看这里即可</span><br><span class=\"line\">RUN yes | pecl install xdebug \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;zend_extension&#x3D;$(find &#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;extensions&#x2F; -name xdebug.so)&quot; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_enable&#x3D;on&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_autostart&#x3D;on&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_port&#x3D;9211&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini \\</span><br><span class=\"line\">    &amp;&amp; echo &quot;xdebug.remote_host&#x3D;192.168.0.103&quot; &gt;&gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;xdebug.ini</span><br><span class=\"line\"></span><br><span class=\"line\">RUN apt-get purge -y g++ \\</span><br><span class=\"line\">    &amp;&amp; apt-get autoremove -y \\</span><br><span class=\"line\">    &amp;&amp; rm -r &#x2F;var&#x2F;lib&#x2F;apt&#x2F;lists&#x2F;* \\</span><br><span class=\"line\">    &amp;&amp; rm -rf &#x2F;tmp&#x2F;*</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">WORKDIR &#x2F;var&#x2F;www&#x2F;html</span><br><span class=\"line\">COPY .&#x2F;nginx.conf &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class=\"line\">COPY .&#x2F;local.ini &#x2F;usr&#x2F;local&#x2F;php&#x2F;conf&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">RUN echo &#39;date.timezone&#x3D;PRC&#39; &gt; &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;timezone.ini</span><br><span class=\"line\"></span><br><span class=\"line\">RUN usermod -u 1000 www-data</span><br><span class=\"line\"></span><br><span class=\"line\">EXPOSE 80 443</span><br><span class=\"line\">CMD [&quot;sh&quot;, &#39;-c&#39;, &#39;nginx &amp;&amp; php-fpm&#39;]</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><font color='red'>重点关注 xdebug 一段的安装及配置</font>，相当于</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; Enable xdebug extension module</span><br><span class=\"line\">zend_extension&#x3D;$(find &#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;extensions&#x2F; -name xdebug.so)</span><br><span class=\"line\">xdebug.idekey &#x3D; &quot;PHPSTORM&quot;</span><br><span class=\"line\">; 因为DBGp调试代理是可以做调试分发的，所以，定义一个IDEKEY，目的是让调试器知道，是不是发给自己的请求</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_enable &#x3D; 1</span><br><span class=\"line\">; 设置为1的时候，会先参数链接到remote_host和remote_port指定的调试器端口，如果连接不上，就继续执行，类似设置&gt;了0</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_mode &#x3D; &quot;req&quot;</span><br><span class=\"line\">xdebug.remote_handler &#x3D; &quot;dbgp&quot;</span><br><span class=\"line\">; 也就是调试走哪种协议，有老的PHP3协议，也有GDB协议，DBGP是当前的默认协议，也是当前主流支持的协议</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_connect_back &#x3D; 0</span><br><span class=\"line\">; 如果为1，xdebug会通过$_SERVER[‘REMOTE_ADDR’]变量，向发起HTTP请求的客户端发起链接，和remote_host功能类似&gt;，但是优先级比remote_host高，所以，设置了这个选项就会忽略remote_host，由于我的运行时服务器不能主动链接IDE所&gt;在PC，所以不能开启自动回连模式(内网访问外网的网页，也不能开启)</span><br><span class=\"line\"></span><br><span class=\"line\"># 刚开始这里配置错了，怎么样都不行。。。</span><br><span class=\"line\">xdebug.remote_host &#x3D; &quot;192.168.0.103&quot;</span><br><span class=\"line\">; 默认是主机，如果服务器可以直接你的本地电脑，可以直接填写本机ip，我这里使用xshell做tcp转发</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_port &#x3D; 9211</span><br><span class=\"line\">; 默认端口是9000，由于端口被fpm占用，我修改为9211，建议没有端口冲突时不修改</span><br><span class=\"line\"></span><br><span class=\"line\">xdebug.remote_autostart &#x3D; 0</span><br><span class=\"line\">; 这个为1，会忽略COOKIE或者POST&#x2F;GET中带的XDEBUG_SESSION参数，不管有没有，都会启动调试，所以，还是设置为0比较好，默认0</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>local.ini</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">post_max_size &#x3D; 256m</span><br><span class=\"line\">upload_max_filesize &#x3D; 256m</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>nginx.conf</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">user  www-data;</span><br><span class=\"line\">worker_processes  1;</span><br><span class=\"line\"></span><br><span class=\"line\">error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;</span><br><span class=\"line\">pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class=\"line\"></span><br><span class=\"line\">events &#123;</span><br><span class=\"line\">    worker_connections  1024;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class=\"line\">    default_type  application&#x2F;json;</span><br><span class=\"line\"></span><br><span class=\"line\">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class=\"line\">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class=\"line\">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class=\"line\"></span><br><span class=\"line\">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    sendfile        on;</span><br><span class=\"line\">    #tcp_nopush     on;</span><br><span class=\"line\"></span><br><span class=\"line\">    keepalive_timeout  65;</span><br><span class=\"line\"></span><br><span class=\"line\">    gzip  on;</span><br><span class=\"line\"></span><br><span class=\"line\">    ## PHP-FPM Servers ##</span><br><span class=\"line\">    upstream php-fpm &#123;</span><br><span class=\"line\">        server localhost:9000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       80;</span><br><span class=\"line\">        server_name  localhost;</span><br><span class=\"line\">        root   &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">        client_max_body_size 32m;</span><br><span class=\"line\"></span><br><span class=\"line\">        location &#x2F; &#123;</span><br><span class=\"line\">            index  index.php;</span><br><span class=\"line\">            if (!-e $request_filename)&#123;</span><br><span class=\"line\">                rewrite ^&#x2F;(.*) &#x2F;index.php last;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location ~ ^(.+\\.php)(.*)$ &#123;</span><br><span class=\"line\">            fastcgi_index        index.php;</span><br><span class=\"line\">            fastcgi_split_path_info ^(.+\\.php)(.*)$;</span><br><span class=\"line\">            fastcgi_param        SCRIPT_FILENAME        $document_root$fastcgi_script_name;</span><br><span class=\"line\">            fastcgi_param        PATH_INFO              $fastcgi_path_info;</span><br><span class=\"line\">            fastcgi_param        PATH_TRANSLATED        $document_root$fastcgi_path_info;</span><br><span class=\"line\">            fastcgi_pass php-fpm;</span><br><span class=\"line\">            client_max_body_size 100m;</span><br><span class=\"line\">            include        fastcgi_params;</span><br><span class=\"line\">            add_header Access-Control-Allow-Origin &quot;*&quot;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-安装及验证\"><a href=\"#2-安装及验证\" class=\"headerlink\" title=\"2. 安装及验证\"></a>2. 安装及验证</h4><blockquote>\n<p>docker 环境</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 安装</span><br><span class=\"line\">docker-compose build</span><br><span class=\"line\"># 启动</span><br><span class=\"line\">docker-compose up -d</span><br><span class=\"line\"># 查看容器状态</span><br><span class=\"line\">docker-compose ps</span><br><span class=\"line\"># 进入容器</span><br><span class=\"line\">docker-compose exec fpm bash</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看</span><br><span class=\"line\">php -v</span><br><span class=\"line\">PHP 7.1.23 (cli) (built: Oct 16 2018 01:08:49) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2018 The PHP Group</span><br><span class=\"line\">Zend Engine v3.1.0, Copyright (c) 1998-2018 Zend Technologies</span><br><span class=\"line\">    with Xdebug v2.6.1, Copyright (c) 2002-2018, by Derick Rethans</span><br><span class=\"line\"># 可以看到PHP已正确安装，且 xdebug 扩展已开启</span><br><span class=\"line\"></span><br><span class=\"line\"># 新建 index.php 文件，在宿主机浏览器直接访问，得到结果，表示 nginx 已正确配置</span><br><span class=\"line\"># 我这里 docker 虚拟机配置的端口为 9111</span><br><span class=\"line\">curl http:&#x2F;&#x2F;localhost:9111</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>配置 PHPstorm</p>\n</blockquote>\n<p>首先配置 PHPstorm 使用的 CLI 解释器为 docker 虚拟机内的 PHP</p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195714.jpg\"></p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-195838.jpg\"></p>\n<p>配置 xdebug 端口<br><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-200745.jpg\"></p>\n<p>Run -&gt; Edit Configuration 或者 或者点击 PHPstorm 右上角的 Edit Configuration</p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201139.jpg\"></p>\n<p><img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201423.jpg\"></p>\n<blockquote>\n<p>浏览器调试，安装对应的扩展即可，略</p>\n</blockquote>\n<blockquote>\n<p>postman 断点调试</p>\n</blockquote>\n<ol>\n<li>选择刚才的配置，设置断点，开启小电话<br> <img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201724.jpg\"></li>\n<li>在指定域名（如 localhost）的 cookie 中添加一次 XDEBUG_SESSION=PHPSTORM<br> <img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201904.jpg\"><br> <img src=\"https://zzpwestlife.oss-cn-beijing.aliyuncs.com/blog/Jietu20190216-201952.jpg\"></li>\n<li>访问，即可自动跳回至 PHPstorm 的断点处，可以愉快地调试了。</li>\n</ol>\n<p>下一步，记录调试的流程、快捷键、技巧等，敬请期待。</p>\n"},{"title":"CGI、FastCGI和PHP-FPM关系图解","date":"2017-07-15T12:57:13.000Z","_content":"\n> 原文链接  http://www.awaimai.com/371.html\n\n在搭建 LAMP/LNMP 服务器时，会经常遇到 PHP-FPM、FastCGI和CGI 这几个概念。如果对它们一知半解，很难搭建出高性能的服务器。接下来我们就以图形方式，解释这些概念之间的关系。\n\n<!-- more -->\n\n## 1. 基础\n\n在整个网站架构中，Web Server（如Apache）只是内容的分发者。举个栗子，如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/20096772.jpg)\n\n如果请求的是 index.php，根据配置文件，Web Server知道这个不是静态文件，需要去找 PHP 解析器来处理，那么他会把这个请求简单处理，然后交给PHP解析器。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/72072671.jpg)\n\n当Web Server收到 index.php 这个请求后，会启动对应的 CGI 程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。这就是一个完整的动态PHP Web访问流程，接下来再引出这些概念，就好理解多了。\n\n- CGI：是 Web Server 与 Web Application 之间数据交换的一种协议。\n- FastCGI：同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化（升级版的CGI）。同样，SCGI 协议与 FastCGI 类似。\n- 以上两者都是协议，不是具体实现。\n- PHP-CGI：是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。\n- PHP-FPM：是 PHP（Web Application）对 Web Server 提供的 FastCGI 协议的接口程序，额外还提供了相对智能一些任务管理。\n- 这两者是对前两个协议的具体实现。\n\nWEB 中，\n- Web Server 一般指Apache、nginx、IIS、Lighttpd、Tomcat等服务器，\n- Web Application 一般指PHP、Java、Asp.net等应用程序。\n\n## Module方式\n\n在了解 CGI 之前，我们先了解一下Web server 传递数据的另外一种方法：PHP Module加载方式。以 Apache 为例，在PHP Module方式中，是不是在 Apache 的配置文件 httpd.conf 中加上这样几句：\n\n```\n# 加入以下2句\nLoadModule php5_module D:/php/php5apache2_2.dll\nAddType application/x-httpd-php .php\n```\n```\n# 修改如下内容\n<IfModule dir_module>\n    DirectoryIndex index.php index.html\n</IfModule>\n```\n\n上面是 Windows 下安装php和apache环境后手动配置，在linux下源码安装大致是这样配置的：\n\n```\n# ./configure --with-mysql=/usr/local --with-apache=/usr/local/apache --enable-track-vars\n```\n\n所以，这种方式，他们的共同本质都是用 LoadModule 来加载 php5_module，就是把php作为apache的一个子模块来运行。当通过web访问php文件时，apache就会调用php5_module来解析php代码。\n\n那么php5_module是怎么来将数据传给php解析器来解析php代码的呢？答案是通过sapi。\n\n我们再来看一张图，详细的说说apache 与 php 与 sapi的关系：\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/81569642.jpg)\n\n从上面图中，我们看出了sapi就是这样的一个中间过程，SAPI提供了一个和外部通信的接口，有点类似于socket，使得PHP可以和其他应用进行交互数据（apache，nginx等）。php默认提供了很多种SAPI，常见的提供给apache和nginx的php5_module、CGI、FastCGI，给IIS的ISAPI，以及Shell的CLI。\n\n所以，以上的apache调用php执行的过程如下：\n\napache -> httpd -> php5_module -> sapi -> php\n\n好了。apache与php通过php5_module的方式就搞清楚了吧！\n这种模式将php模块安装到apache中，所以每一次apache结束请求，都会产生一条进程，这个进程就完整的包括php的各种运算计算等操作。\n\n在上图中，我们很清晰的可以看到，apache每接收一个请求，都会产生一个进程来连接php通过sapi来完成请求，可想而知，如果一旦用户过多，并发数过多，服务器就会承受不住了。\n\n而且，把mod_php编进apache时，出问题时很难定位是php的问题还是apache的问题。\n\n## CGI\n\nCGI（Common Gateway Interface）全称是“通用网关接口”，WEB 服务器与PHP应用进行“交谈”的一种工具，其程序须运行在网络服务器上。CGI可以用任何一种语言编写，只要这种语言具有标准输入、输出和环境变量。如php、perl、tcl等。\n\nWEB服务器会传哪些数据给PHP解析器呢？URL、查询字符串、POST数据、HTTP header都会有。所以，CGI就是规定要传哪些数据，以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。\n\n也就是说，CGI就是专门用来和 web 服务器打交道的。web服务器收到用户请求，就会把请求提交给cgi程序（如php-cgi），cgi程序根据请求提交的参数作处理（解析php），然后输出标准的html语句，返回给web服务器，WEB服务器再返回给客户端，这就是普通cgi的工作原理。\n\nCGI的好处就是完全独立于任何服务器，仅仅是做为中间分子。提供接口给apache和php。他们通过cgi搭线来完成数据传递。这样做的好处了尽量减少2个的关联，使他们2变得更独立。\n\n但是CGI有个蛋疼的地方，就是每一次web请求都会有启动和退出过程，也就是最为人诟病的fork-and-execute模式，这样一在大规模并发下，就死翘翘了。\n\n## FastCGI介绍\n\n### FastCGI简单介绍\n\n从根本上来说，FastCGI是用来提高CGI程序性能的。类似于CGI，FastCGI也可以说是一种协议。\n\nFastCGI像是一个常驻(long-live)型的CGI，它可以一直执行着，只要激活后，不会每次都要花费时间去fork一次。它还支持分布式的运算, 即 FastCGI \n程序可以在网站服务器以外的主机上执行，并且接受来自其它网站服务器来的请求。\n\nFastCGI是语言无关的、可伸缩架构的CGI开放扩展，其主要行为是将CGI解释器进程保持在内存中，并因此获得较高的性能。众所周知，CGI解释器的反复加载是CGI性能低下的主要原因，如果CGI解释器保持在内存中，并接受FastCGI进程管理器调度，则可以提供良好的性能、伸缩性、Fail- Over特性等等。\n\n### FastCGI的工作原理\n\nFastCGI接口方式采用C/S结构，可以将HTTP服务器和脚本解析服务器分开，同时在脚本解析服务器上启动一个或者多个脚本解析守护进程。当HTTP服务器每次遇到动态程序时，可以将其直接交付给FastCGI进程来执行，然后将得到的结果返回给浏览器。这种方式可以让HTTP服务器专一地处理静态请求，或者将动态脚本服务器的结果返回给客户端，这在很大程度上提高了整个应用系统的性能。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/86877288.jpg)\n\n1. Web Server启动时载入FastCGI进程管理器（Apache Module或IIS ISAPI等)\n2. FastCGI进程管理器自身初始化，启动多个CGI解释器进程(可建多个php-cgi)，并等待来自Web Server的连接。\n3. 当客户端请求到达Web Server时，FastCGI进程管理器选择并连接到一个CGI解释器。Web server将CGI环境变量和标准输入发送到FastCGI子进程php-cgi。\n4. FastCGI子进程完成处理后，将标准输出和错误信息从同一连接返回Web Server。当FastCGI子进程关闭连接时，请求便告处理完成。FastCGI子进程接着等待，并处理来自FastCGI进程管理器(运行在Web Server中)的下一个连接。 在CGI模式中，php-cgi在此便退出了。\n\nFastCGI与CGI特点：\n\n1. 对于CGI来说，每一个Web请求PHP都必须重新解析php.ini、重新载入全部扩展，并重初始化全部数据结构。而使用FastCGI，所有这些都只在进程启动时发生一次。一个额外的好处是，持续数据库连接(Persistent database connection)可以工作。\n2. 由于FastCGI是多进程，所以比CGI多线程消耗更多的服务器内存，php-cgi解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。\n\n## PHP-FPM介绍\n\n要了解PHP-FPM，就得先说说PHP-CGI。\n\nPHP-CGI就是PHP实现的自带的CGI管理器。 \n\n虽然是php官方出品，但是这丫的却一点也不给力，性能太差，而且也很麻烦不人性化，主要体现在：\n\n1. php-cgi变更php.ini配置后，需重启php-cgi才能让新的php-ini生效，不可以平滑重启。\n2. 直接杀死php-cgi进程，php就不能运行了。\n\n上面2个问题，一直让很多人诟病了很久，所以很多人一直还是在用 Module 方式。 直到 2004年一个叫 Andrei Nigmatulin的屌丝发明了PHP-FPM ，这神器的出现就彻底打破了这种局面，这是一个PHP专用的 fastcgi 管理器，它很爽的克服了上面2个问题，而且，还表现在其他方面更表现强劲。\n\n也就是说，PHP-FPM 是对于 FastCGI 协议的具体实现，他负责管理一个进程池，来处理来自Web服务器的请求。目前，PHP5.3版本之后，PHP-FPM是内置于PHP的。\n因为PHP-CGI只是个CGI程序，他自己本身只能解析请求，返回结果，不会进程管理。所以就出现了一些能够调度 php-cgi 进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。同样，PHP-FPM也是用于调度管理PHP解析器php-cgi的管理程序。\nPHP-FPM通过生成新的子进程可以实现php.ini修改后的平滑重启。\n\n## 总结\n\n最后，我们来总结一下，这些技术经过不断的升级，可以解决什么问题（不然也不会升级嘛）。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/42688749.jpg)\n\n所以，如果要搭建一个高性能的PHP WEB服务器，目前最佳的方式是Apache/Nginx + FastCGI + PHP-FPM(+PHP-CGI)方式了，不要再使用 Module加载或者 CGI 方式啦：）\n\n本文章图片用Visio制作，源文件：php-fpm\n\n## 参考资料\n1. 概念了解：CGI，FastCGI，PHP-CGI与PHP-FPM：http://www.nowamagic.net/librarys/veda/detail/1319\n2. php中fastcgi和php-fpm是什么东西：https://www.zybuluo.com/phper/note/50231\n3. 请问CGI、PHP-CGI、PHP-FPM之间是什么关系？https://groups.google.com/forum/?fromgroups=#!topic/shlug/d5hJKyFzI-g\n4. FastCGI 进程管理器（FPM）：http://php.net/manual/zh/install.fpm.php\n\n\n## 知乎里的解答\n\n> 你(PHP)去和爱斯基摩人(web服务器，如 Apache、nginx)谈生意\n你说中文(PHP代码)，他说爱斯基摩语(C代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(FastCGI 协议)吧。\n怎么转换呢？你就要使用一个翻译机(PHP-FPM) (当然对方也有一个翻译机，那个是他自带的)\n我们这个翻译机是最新型的，老式的那个（PHP-CGI）被淘汰了。不过它(PHP-FPM)只有年轻人（Linux系统）会用，老头子们（Windows系统）不会摆弄它，只好继续用老式的那个。\n\n\n","source":"_posts/CGI、FastCGI和PHP-FPM关系图解.md","raw":"---\ntitle: CGI、FastCGI和PHP-FPM关系图解\ndate: 2017-07-15 20:57:13\ntags: CGI\ncategories: PHP\n---\n\n> 原文链接  http://www.awaimai.com/371.html\n\n在搭建 LAMP/LNMP 服务器时，会经常遇到 PHP-FPM、FastCGI和CGI 这几个概念。如果对它们一知半解，很难搭建出高性能的服务器。接下来我们就以图形方式，解释这些概念之间的关系。\n\n<!-- more -->\n\n## 1. 基础\n\n在整个网站架构中，Web Server（如Apache）只是内容的分发者。举个栗子，如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/20096772.jpg)\n\n如果请求的是 index.php，根据配置文件，Web Server知道这个不是静态文件，需要去找 PHP 解析器来处理，那么他会把这个请求简单处理，然后交给PHP解析器。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/72072671.jpg)\n\n当Web Server收到 index.php 这个请求后，会启动对应的 CGI 程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。这就是一个完整的动态PHP Web访问流程，接下来再引出这些概念，就好理解多了。\n\n- CGI：是 Web Server 与 Web Application 之间数据交换的一种协议。\n- FastCGI：同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化（升级版的CGI）。同样，SCGI 协议与 FastCGI 类似。\n- 以上两者都是协议，不是具体实现。\n- PHP-CGI：是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。\n- PHP-FPM：是 PHP（Web Application）对 Web Server 提供的 FastCGI 协议的接口程序，额外还提供了相对智能一些任务管理。\n- 这两者是对前两个协议的具体实现。\n\nWEB 中，\n- Web Server 一般指Apache、nginx、IIS、Lighttpd、Tomcat等服务器，\n- Web Application 一般指PHP、Java、Asp.net等应用程序。\n\n## Module方式\n\n在了解 CGI 之前，我们先了解一下Web server 传递数据的另外一种方法：PHP Module加载方式。以 Apache 为例，在PHP Module方式中，是不是在 Apache 的配置文件 httpd.conf 中加上这样几句：\n\n```\n# 加入以下2句\nLoadModule php5_module D:/php/php5apache2_2.dll\nAddType application/x-httpd-php .php\n```\n```\n# 修改如下内容\n<IfModule dir_module>\n    DirectoryIndex index.php index.html\n</IfModule>\n```\n\n上面是 Windows 下安装php和apache环境后手动配置，在linux下源码安装大致是这样配置的：\n\n```\n# ./configure --with-mysql=/usr/local --with-apache=/usr/local/apache --enable-track-vars\n```\n\n所以，这种方式，他们的共同本质都是用 LoadModule 来加载 php5_module，就是把php作为apache的一个子模块来运行。当通过web访问php文件时，apache就会调用php5_module来解析php代码。\n\n那么php5_module是怎么来将数据传给php解析器来解析php代码的呢？答案是通过sapi。\n\n我们再来看一张图，详细的说说apache 与 php 与 sapi的关系：\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/81569642.jpg)\n\n从上面图中，我们看出了sapi就是这样的一个中间过程，SAPI提供了一个和外部通信的接口，有点类似于socket，使得PHP可以和其他应用进行交互数据（apache，nginx等）。php默认提供了很多种SAPI，常见的提供给apache和nginx的php5_module、CGI、FastCGI，给IIS的ISAPI，以及Shell的CLI。\n\n所以，以上的apache调用php执行的过程如下：\n\napache -> httpd -> php5_module -> sapi -> php\n\n好了。apache与php通过php5_module的方式就搞清楚了吧！\n这种模式将php模块安装到apache中，所以每一次apache结束请求，都会产生一条进程，这个进程就完整的包括php的各种运算计算等操作。\n\n在上图中，我们很清晰的可以看到，apache每接收一个请求，都会产生一个进程来连接php通过sapi来完成请求，可想而知，如果一旦用户过多，并发数过多，服务器就会承受不住了。\n\n而且，把mod_php编进apache时，出问题时很难定位是php的问题还是apache的问题。\n\n## CGI\n\nCGI（Common Gateway Interface）全称是“通用网关接口”，WEB 服务器与PHP应用进行“交谈”的一种工具，其程序须运行在网络服务器上。CGI可以用任何一种语言编写，只要这种语言具有标准输入、输出和环境变量。如php、perl、tcl等。\n\nWEB服务器会传哪些数据给PHP解析器呢？URL、查询字符串、POST数据、HTTP header都会有。所以，CGI就是规定要传哪些数据，以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。\n\n也就是说，CGI就是专门用来和 web 服务器打交道的。web服务器收到用户请求，就会把请求提交给cgi程序（如php-cgi），cgi程序根据请求提交的参数作处理（解析php），然后输出标准的html语句，返回给web服务器，WEB服务器再返回给客户端，这就是普通cgi的工作原理。\n\nCGI的好处就是完全独立于任何服务器，仅仅是做为中间分子。提供接口给apache和php。他们通过cgi搭线来完成数据传递。这样做的好处了尽量减少2个的关联，使他们2变得更独立。\n\n但是CGI有个蛋疼的地方，就是每一次web请求都会有启动和退出过程，也就是最为人诟病的fork-and-execute模式，这样一在大规模并发下，就死翘翘了。\n\n## FastCGI介绍\n\n### FastCGI简单介绍\n\n从根本上来说，FastCGI是用来提高CGI程序性能的。类似于CGI，FastCGI也可以说是一种协议。\n\nFastCGI像是一个常驻(long-live)型的CGI，它可以一直执行着，只要激活后，不会每次都要花费时间去fork一次。它还支持分布式的运算, 即 FastCGI \n程序可以在网站服务器以外的主机上执行，并且接受来自其它网站服务器来的请求。\n\nFastCGI是语言无关的、可伸缩架构的CGI开放扩展，其主要行为是将CGI解释器进程保持在内存中，并因此获得较高的性能。众所周知，CGI解释器的反复加载是CGI性能低下的主要原因，如果CGI解释器保持在内存中，并接受FastCGI进程管理器调度，则可以提供良好的性能、伸缩性、Fail- Over特性等等。\n\n### FastCGI的工作原理\n\nFastCGI接口方式采用C/S结构，可以将HTTP服务器和脚本解析服务器分开，同时在脚本解析服务器上启动一个或者多个脚本解析守护进程。当HTTP服务器每次遇到动态程序时，可以将其直接交付给FastCGI进程来执行，然后将得到的结果返回给浏览器。这种方式可以让HTTP服务器专一地处理静态请求，或者将动态脚本服务器的结果返回给客户端，这在很大程度上提高了整个应用系统的性能。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/86877288.jpg)\n\n1. Web Server启动时载入FastCGI进程管理器（Apache Module或IIS ISAPI等)\n2. FastCGI进程管理器自身初始化，启动多个CGI解释器进程(可建多个php-cgi)，并等待来自Web Server的连接。\n3. 当客户端请求到达Web Server时，FastCGI进程管理器选择并连接到一个CGI解释器。Web server将CGI环境变量和标准输入发送到FastCGI子进程php-cgi。\n4. FastCGI子进程完成处理后，将标准输出和错误信息从同一连接返回Web Server。当FastCGI子进程关闭连接时，请求便告处理完成。FastCGI子进程接着等待，并处理来自FastCGI进程管理器(运行在Web Server中)的下一个连接。 在CGI模式中，php-cgi在此便退出了。\n\nFastCGI与CGI特点：\n\n1. 对于CGI来说，每一个Web请求PHP都必须重新解析php.ini、重新载入全部扩展，并重初始化全部数据结构。而使用FastCGI，所有这些都只在进程启动时发生一次。一个额外的好处是，持续数据库连接(Persistent database connection)可以工作。\n2. 由于FastCGI是多进程，所以比CGI多线程消耗更多的服务器内存，php-cgi解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。\n\n## PHP-FPM介绍\n\n要了解PHP-FPM，就得先说说PHP-CGI。\n\nPHP-CGI就是PHP实现的自带的CGI管理器。 \n\n虽然是php官方出品，但是这丫的却一点也不给力，性能太差，而且也很麻烦不人性化，主要体现在：\n\n1. php-cgi变更php.ini配置后，需重启php-cgi才能让新的php-ini生效，不可以平滑重启。\n2. 直接杀死php-cgi进程，php就不能运行了。\n\n上面2个问题，一直让很多人诟病了很久，所以很多人一直还是在用 Module 方式。 直到 2004年一个叫 Andrei Nigmatulin的屌丝发明了PHP-FPM ，这神器的出现就彻底打破了这种局面，这是一个PHP专用的 fastcgi 管理器，它很爽的克服了上面2个问题，而且，还表现在其他方面更表现强劲。\n\n也就是说，PHP-FPM 是对于 FastCGI 协议的具体实现，他负责管理一个进程池，来处理来自Web服务器的请求。目前，PHP5.3版本之后，PHP-FPM是内置于PHP的。\n因为PHP-CGI只是个CGI程序，他自己本身只能解析请求，返回结果，不会进程管理。所以就出现了一些能够调度 php-cgi 进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。同样，PHP-FPM也是用于调度管理PHP解析器php-cgi的管理程序。\nPHP-FPM通过生成新的子进程可以实现php.ini修改后的平滑重启。\n\n## 总结\n\n最后，我们来总结一下，这些技术经过不断的升级，可以解决什么问题（不然也不会升级嘛）。\n\n![](http://omp48p40q.bkt.clouddn.com/17-7-15/42688749.jpg)\n\n所以，如果要搭建一个高性能的PHP WEB服务器，目前最佳的方式是Apache/Nginx + FastCGI + PHP-FPM(+PHP-CGI)方式了，不要再使用 Module加载或者 CGI 方式啦：）\n\n本文章图片用Visio制作，源文件：php-fpm\n\n## 参考资料\n1. 概念了解：CGI，FastCGI，PHP-CGI与PHP-FPM：http://www.nowamagic.net/librarys/veda/detail/1319\n2. php中fastcgi和php-fpm是什么东西：https://www.zybuluo.com/phper/note/50231\n3. 请问CGI、PHP-CGI、PHP-FPM之间是什么关系？https://groups.google.com/forum/?fromgroups=#!topic/shlug/d5hJKyFzI-g\n4. FastCGI 进程管理器（FPM）：http://php.net/manual/zh/install.fpm.php\n\n\n## 知乎里的解答\n\n> 你(PHP)去和爱斯基摩人(web服务器，如 Apache、nginx)谈生意\n你说中文(PHP代码)，他说爱斯基摩语(C代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(FastCGI 协议)吧。\n怎么转换呢？你就要使用一个翻译机(PHP-FPM) (当然对方也有一个翻译机，那个是他自带的)\n我们这个翻译机是最新型的，老式的那个（PHP-CGI）被淘汰了。不过它(PHP-FPM)只有年轻人（Linux系统）会用，老头子们（Windows系统）不会摆弄它，只好继续用老式的那个。\n\n\n","slug":"CGI、FastCGI和PHP-FPM关系图解","published":1,"updated":"2020-09-11T01:04:35.032Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7o00066wo12yc606x8","content":"<blockquote>\n<p>原文链接  <a href=\"http://www.awaimai.com/371.html\">http://www.awaimai.com/371.html</a></p>\n</blockquote>\n<p>在搭建 LAMP/LNMP 服务器时，会经常遇到 PHP-FPM、FastCGI和CGI 这几个概念。如果对它们一知半解，很难搭建出高性能的服务器。接下来我们就以图形方式，解释这些概念之间的关系。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"1-基础\"><a href=\"#1-基础\" class=\"headerlink\" title=\"1. 基础\"></a>1. 基础</h2><p>在整个网站架构中，Web Server（如Apache）只是内容的分发者。举个栗子，如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/20096772.jpg\"></p>\n<p>如果请求的是 index.php，根据配置文件，Web Server知道这个不是静态文件，需要去找 PHP 解析器来处理，那么他会把这个请求简单处理，然后交给PHP解析器。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/72072671.jpg\"></p>\n<p>当Web Server收到 index.php 这个请求后，会启动对应的 CGI 程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。这就是一个完整的动态PHP Web访问流程，接下来再引出这些概念，就好理解多了。</p>\n<ul>\n<li>CGI：是 Web Server 与 Web Application 之间数据交换的一种协议。</li>\n<li>FastCGI：同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化（升级版的CGI）。同样，SCGI 协议与 FastCGI 类似。</li>\n<li>以上两者都是协议，不是具体实现。</li>\n<li>PHP-CGI：是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。</li>\n<li>PHP-FPM：是 PHP（Web Application）对 Web Server 提供的 FastCGI 协议的接口程序，额外还提供了相对智能一些任务管理。</li>\n<li>这两者是对前两个协议的具体实现。</li>\n</ul>\n<p>WEB 中，</p>\n<ul>\n<li>Web Server 一般指Apache、nginx、IIS、Lighttpd、Tomcat等服务器，</li>\n<li>Web Application 一般指PHP、Java、Asp.net等应用程序。</li>\n</ul>\n<h2 id=\"Module方式\"><a href=\"#Module方式\" class=\"headerlink\" title=\"Module方式\"></a>Module方式</h2><p>在了解 CGI 之前，我们先了解一下Web server 传递数据的另外一种方法：PHP Module加载方式。以 Apache 为例，在PHP Module方式中，是不是在 Apache 的配置文件 httpd.conf 中加上这样几句：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 加入以下2句</span><br><span class=\"line\">LoadModule php5_module D:&#x2F;php&#x2F;php5apache2_2.dll</span><br><span class=\"line\">AddType application&#x2F;x-httpd-php .php</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改如下内容</span><br><span class=\"line\">&lt;IfModule dir_module&gt;</span><br><span class=\"line\">    DirectoryIndex index.php index.html</span><br><span class=\"line\">&lt;&#x2F;IfModule&gt;</span><br></pre></td></tr></table></figure>\n\n<p>上面是 Windows 下安装php和apache环境后手动配置，在linux下源码安装大致是这样配置的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># .&#x2F;configure --with-mysql&#x3D;&#x2F;usr&#x2F;local --with-apache&#x3D;&#x2F;usr&#x2F;local&#x2F;apache --enable-track-vars</span><br></pre></td></tr></table></figure>\n\n<p>所以，这种方式，他们的共同本质都是用 LoadModule 来加载 php5_module，就是把php作为apache的一个子模块来运行。当通过web访问php文件时，apache就会调用php5_module来解析php代码。</p>\n<p>那么php5_module是怎么来将数据传给php解析器来解析php代码的呢？答案是通过sapi。</p>\n<p>我们再来看一张图，详细的说说apache 与 php 与 sapi的关系：</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/81569642.jpg\"></p>\n<p>从上面图中，我们看出了sapi就是这样的一个中间过程，SAPI提供了一个和外部通信的接口，有点类似于socket，使得PHP可以和其他应用进行交互数据（apache，nginx等）。php默认提供了很多种SAPI，常见的提供给apache和nginx的php5_module、CGI、FastCGI，给IIS的ISAPI，以及Shell的CLI。</p>\n<p>所以，以上的apache调用php执行的过程如下：</p>\n<p>apache -&gt; httpd -&gt; php5_module -&gt; sapi -&gt; php</p>\n<p>好了。apache与php通过php5_module的方式就搞清楚了吧！<br>这种模式将php模块安装到apache中，所以每一次apache结束请求，都会产生一条进程，这个进程就完整的包括php的各种运算计算等操作。</p>\n<p>在上图中，我们很清晰的可以看到，apache每接收一个请求，都会产生一个进程来连接php通过sapi来完成请求，可想而知，如果一旦用户过多，并发数过多，服务器就会承受不住了。</p>\n<p>而且，把mod_php编进apache时，出问题时很难定位是php的问题还是apache的问题。</p>\n<h2 id=\"CGI\"><a href=\"#CGI\" class=\"headerlink\" title=\"CGI\"></a>CGI</h2><p>CGI（Common Gateway Interface）全称是“通用网关接口”，WEB 服务器与PHP应用进行“交谈”的一种工具，其程序须运行在网络服务器上。CGI可以用任何一种语言编写，只要这种语言具有标准输入、输出和环境变量。如php、perl、tcl等。</p>\n<p>WEB服务器会传哪些数据给PHP解析器呢？URL、查询字符串、POST数据、HTTP header都会有。所以，CGI就是规定要传哪些数据，以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。</p>\n<p>也就是说，CGI就是专门用来和 web 服务器打交道的。web服务器收到用户请求，就会把请求提交给cgi程序（如php-cgi），cgi程序根据请求提交的参数作处理（解析php），然后输出标准的html语句，返回给web服务器，WEB服务器再返回给客户端，这就是普通cgi的工作原理。</p>\n<p>CGI的好处就是完全独立于任何服务器，仅仅是做为中间分子。提供接口给apache和php。他们通过cgi搭线来完成数据传递。这样做的好处了尽量减少2个的关联，使他们2变得更独立。</p>\n<p>但是CGI有个蛋疼的地方，就是每一次web请求都会有启动和退出过程，也就是最为人诟病的fork-and-execute模式，这样一在大规模并发下，就死翘翘了。</p>\n<h2 id=\"FastCGI介绍\"><a href=\"#FastCGI介绍\" class=\"headerlink\" title=\"FastCGI介绍\"></a>FastCGI介绍</h2><h3 id=\"FastCGI简单介绍\"><a href=\"#FastCGI简单介绍\" class=\"headerlink\" title=\"FastCGI简单介绍\"></a>FastCGI简单介绍</h3><p>从根本上来说，FastCGI是用来提高CGI程序性能的。类似于CGI，FastCGI也可以说是一种协议。</p>\n<p>FastCGI像是一个常驻(long-live)型的CGI，它可以一直执行着，只要激活后，不会每次都要花费时间去fork一次。它还支持分布式的运算, 即 FastCGI<br>程序可以在网站服务器以外的主机上执行，并且接受来自其它网站服务器来的请求。</p>\n<p>FastCGI是语言无关的、可伸缩架构的CGI开放扩展，其主要行为是将CGI解释器进程保持在内存中，并因此获得较高的性能。众所周知，CGI解释器的反复加载是CGI性能低下的主要原因，如果CGI解释器保持在内存中，并接受FastCGI进程管理器调度，则可以提供良好的性能、伸缩性、Fail- Over特性等等。</p>\n<h3 id=\"FastCGI的工作原理\"><a href=\"#FastCGI的工作原理\" class=\"headerlink\" title=\"FastCGI的工作原理\"></a>FastCGI的工作原理</h3><p>FastCGI接口方式采用C/S结构，可以将HTTP服务器和脚本解析服务器分开，同时在脚本解析服务器上启动一个或者多个脚本解析守护进程。当HTTP服务器每次遇到动态程序时，可以将其直接交付给FastCGI进程来执行，然后将得到的结果返回给浏览器。这种方式可以让HTTP服务器专一地处理静态请求，或者将动态脚本服务器的结果返回给客户端，这在很大程度上提高了整个应用系统的性能。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/86877288.jpg\"></p>\n<ol>\n<li>Web Server启动时载入FastCGI进程管理器（Apache Module或IIS ISAPI等)</li>\n<li>FastCGI进程管理器自身初始化，启动多个CGI解释器进程(可建多个php-cgi)，并等待来自Web Server的连接。</li>\n<li>当客户端请求到达Web Server时，FastCGI进程管理器选择并连接到一个CGI解释器。Web server将CGI环境变量和标准输入发送到FastCGI子进程php-cgi。</li>\n<li>FastCGI子进程完成处理后，将标准输出和错误信息从同一连接返回Web Server。当FastCGI子进程关闭连接时，请求便告处理完成。FastCGI子进程接着等待，并处理来自FastCGI进程管理器(运行在Web Server中)的下一个连接。 在CGI模式中，php-cgi在此便退出了。</li>\n</ol>\n<p>FastCGI与CGI特点：</p>\n<ol>\n<li>对于CGI来说，每一个Web请求PHP都必须重新解析php.ini、重新载入全部扩展，并重初始化全部数据结构。而使用FastCGI，所有这些都只在进程启动时发生一次。一个额外的好处是，持续数据库连接(Persistent database connection)可以工作。</li>\n<li>由于FastCGI是多进程，所以比CGI多线程消耗更多的服务器内存，php-cgi解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。</li>\n</ol>\n<h2 id=\"PHP-FPM介绍\"><a href=\"#PHP-FPM介绍\" class=\"headerlink\" title=\"PHP-FPM介绍\"></a>PHP-FPM介绍</h2><p>要了解PHP-FPM，就得先说说PHP-CGI。</p>\n<p>PHP-CGI就是PHP实现的自带的CGI管理器。 </p>\n<p>虽然是php官方出品，但是这丫的却一点也不给力，性能太差，而且也很麻烦不人性化，主要体现在：</p>\n<ol>\n<li>php-cgi变更php.ini配置后，需重启php-cgi才能让新的php-ini生效，不可以平滑重启。</li>\n<li>直接杀死php-cgi进程，php就不能运行了。</li>\n</ol>\n<p>上面2个问题，一直让很多人诟病了很久，所以很多人一直还是在用 Module 方式。 直到 2004年一个叫 Andrei Nigmatulin的屌丝发明了PHP-FPM ，这神器的出现就彻底打破了这种局面，这是一个PHP专用的 fastcgi 管理器，它很爽的克服了上面2个问题，而且，还表现在其他方面更表现强劲。</p>\n<p>也就是说，PHP-FPM 是对于 FastCGI 协议的具体实现，他负责管理一个进程池，来处理来自Web服务器的请求。目前，PHP5.3版本之后，PHP-FPM是内置于PHP的。<br>因为PHP-CGI只是个CGI程序，他自己本身只能解析请求，返回结果，不会进程管理。所以就出现了一些能够调度 php-cgi 进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。同样，PHP-FPM也是用于调度管理PHP解析器php-cgi的管理程序。<br>PHP-FPM通过生成新的子进程可以实现php.ini修改后的平滑重启。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>最后，我们来总结一下，这些技术经过不断的升级，可以解决什么问题（不然也不会升级嘛）。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/42688749.jpg\"></p>\n<p>所以，如果要搭建一个高性能的PHP WEB服务器，目前最佳的方式是Apache/Nginx + FastCGI + PHP-FPM(+PHP-CGI)方式了，不要再使用 Module加载或者 CGI 方式啦：）</p>\n<p>本文章图片用Visio制作，源文件：php-fpm</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li>概念了解：CGI，FastCGI，PHP-CGI与PHP-FPM：<a href=\"http://www.nowamagic.net/librarys/veda/detail/1319\">http://www.nowamagic.net/librarys/veda/detail/1319</a></li>\n<li>php中fastcgi和php-fpm是什么东西：<a href=\"https://www.zybuluo.com/phper/note/50231\">https://www.zybuluo.com/phper/note/50231</a></li>\n<li>请问CGI、PHP-CGI、PHP-FPM之间是什么关系？<a href=\"https://groups.google.com/forum/?fromgroups=#!topic/shlug/d5hJKyFzI-g\">https://groups.google.com/forum/?fromgroups=#!topic/shlug/d5hJKyFzI-g</a></li>\n<li>FastCGI 进程管理器（FPM）：<a href=\"http://php.net/manual/zh/install.fpm.php\">http://php.net/manual/zh/install.fpm.php</a></li>\n</ol>\n<h2 id=\"知乎里的解答\"><a href=\"#知乎里的解答\" class=\"headerlink\" title=\"知乎里的解答\"></a>知乎里的解答</h2><blockquote>\n<p>你(PHP)去和爱斯基摩人(web服务器，如 Apache、nginx)谈生意<br>你说中文(PHP代码)，他说爱斯基摩语(C代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(FastCGI 协议)吧。<br>怎么转换呢？你就要使用一个翻译机(PHP-FPM) (当然对方也有一个翻译机，那个是他自带的)<br>我们这个翻译机是最新型的，老式的那个（PHP-CGI）被淘汰了。不过它(PHP-FPM)只有年轻人（Linux系统）会用，老头子们（Windows系统）不会摆弄它，只好继续用老式的那个。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>原文链接  <a href=\"http://www.awaimai.com/371.html\">http://www.awaimai.com/371.html</a></p>\n</blockquote>\n<p>在搭建 LAMP/LNMP 服务器时，会经常遇到 PHP-FPM、FastCGI和CGI 这几个概念。如果对它们一知半解，很难搭建出高性能的服务器。接下来我们就以图形方式，解释这些概念之间的关系。</p>","more":"<h2 id=\"1-基础\"><a href=\"#1-基础\" class=\"headerlink\" title=\"1. 基础\"></a>1. 基础</h2><p>在整个网站架构中，Web Server（如Apache）只是内容的分发者。举个栗子，如果客户端请求的是 index.html，那么Web Server会去文件系统中找到这个文件，发送给浏览器，这里分发的是静态数据。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/20096772.jpg\"></p>\n<p>如果请求的是 index.php，根据配置文件，Web Server知道这个不是静态文件，需要去找 PHP 解析器来处理，那么他会把这个请求简单处理，然后交给PHP解析器。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/72072671.jpg\"></p>\n<p>当Web Server收到 index.php 这个请求后，会启动对应的 CGI 程序，这里就是PHP的解析器。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。这就是一个完整的动态PHP Web访问流程，接下来再引出这些概念，就好理解多了。</p>\n<ul>\n<li>CGI：是 Web Server 与 Web Application 之间数据交换的一种协议。</li>\n<li>FastCGI：同 CGI，是一种通信协议，但比 CGI 在效率上做了一些优化（升级版的CGI）。同样，SCGI 协议与 FastCGI 类似。</li>\n<li>以上两者都是协议，不是具体实现。</li>\n<li>PHP-CGI：是 PHP （Web Application）对 Web Server 提供的 CGI 协议的接口程序。</li>\n<li>PHP-FPM：是 PHP（Web Application）对 Web Server 提供的 FastCGI 协议的接口程序，额外还提供了相对智能一些任务管理。</li>\n<li>这两者是对前两个协议的具体实现。</li>\n</ul>\n<p>WEB 中，</p>\n<ul>\n<li>Web Server 一般指Apache、nginx、IIS、Lighttpd、Tomcat等服务器，</li>\n<li>Web Application 一般指PHP、Java、Asp.net等应用程序。</li>\n</ul>\n<h2 id=\"Module方式\"><a href=\"#Module方式\" class=\"headerlink\" title=\"Module方式\"></a>Module方式</h2><p>在了解 CGI 之前，我们先了解一下Web server 传递数据的另外一种方法：PHP Module加载方式。以 Apache 为例，在PHP Module方式中，是不是在 Apache 的配置文件 httpd.conf 中加上这样几句：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 加入以下2句</span><br><span class=\"line\">LoadModule php5_module D:&#x2F;php&#x2F;php5apache2_2.dll</span><br><span class=\"line\">AddType application&#x2F;x-httpd-php .php</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改如下内容</span><br><span class=\"line\">&lt;IfModule dir_module&gt;</span><br><span class=\"line\">    DirectoryIndex index.php index.html</span><br><span class=\"line\">&lt;&#x2F;IfModule&gt;</span><br></pre></td></tr></table></figure>\n\n<p>上面是 Windows 下安装php和apache环境后手动配置，在linux下源码安装大致是这样配置的：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># .&#x2F;configure --with-mysql&#x3D;&#x2F;usr&#x2F;local --with-apache&#x3D;&#x2F;usr&#x2F;local&#x2F;apache --enable-track-vars</span><br></pre></td></tr></table></figure>\n\n<p>所以，这种方式，他们的共同本质都是用 LoadModule 来加载 php5_module，就是把php作为apache的一个子模块来运行。当通过web访问php文件时，apache就会调用php5_module来解析php代码。</p>\n<p>那么php5_module是怎么来将数据传给php解析器来解析php代码的呢？答案是通过sapi。</p>\n<p>我们再来看一张图，详细的说说apache 与 php 与 sapi的关系：</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/81569642.jpg\"></p>\n<p>从上面图中，我们看出了sapi就是这样的一个中间过程，SAPI提供了一个和外部通信的接口，有点类似于socket，使得PHP可以和其他应用进行交互数据（apache，nginx等）。php默认提供了很多种SAPI，常见的提供给apache和nginx的php5_module、CGI、FastCGI，给IIS的ISAPI，以及Shell的CLI。</p>\n<p>所以，以上的apache调用php执行的过程如下：</p>\n<p>apache -&gt; httpd -&gt; php5_module -&gt; sapi -&gt; php</p>\n<p>好了。apache与php通过php5_module的方式就搞清楚了吧！<br>这种模式将php模块安装到apache中，所以每一次apache结束请求，都会产生一条进程，这个进程就完整的包括php的各种运算计算等操作。</p>\n<p>在上图中，我们很清晰的可以看到，apache每接收一个请求，都会产生一个进程来连接php通过sapi来完成请求，可想而知，如果一旦用户过多，并发数过多，服务器就会承受不住了。</p>\n<p>而且，把mod_php编进apache时，出问题时很难定位是php的问题还是apache的问题。</p>\n<h2 id=\"CGI\"><a href=\"#CGI\" class=\"headerlink\" title=\"CGI\"></a>CGI</h2><p>CGI（Common Gateway Interface）全称是“通用网关接口”，WEB 服务器与PHP应用进行“交谈”的一种工具，其程序须运行在网络服务器上。CGI可以用任何一种语言编写，只要这种语言具有标准输入、输出和环境变量。如php、perl、tcl等。</p>\n<p>WEB服务器会传哪些数据给PHP解析器呢？URL、查询字符串、POST数据、HTTP header都会有。所以，CGI就是规定要传哪些数据，以什么样的格式传递给后方处理这个请求的协议。仔细想想，你在PHP代码中使用的用户从哪里来的。</p>\n<p>也就是说，CGI就是专门用来和 web 服务器打交道的。web服务器收到用户请求，就会把请求提交给cgi程序（如php-cgi），cgi程序根据请求提交的参数作处理（解析php），然后输出标准的html语句，返回给web服务器，WEB服务器再返回给客户端，这就是普通cgi的工作原理。</p>\n<p>CGI的好处就是完全独立于任何服务器，仅仅是做为中间分子。提供接口给apache和php。他们通过cgi搭线来完成数据传递。这样做的好处了尽量减少2个的关联，使他们2变得更独立。</p>\n<p>但是CGI有个蛋疼的地方，就是每一次web请求都会有启动和退出过程，也就是最为人诟病的fork-and-execute模式，这样一在大规模并发下，就死翘翘了。</p>\n<h2 id=\"FastCGI介绍\"><a href=\"#FastCGI介绍\" class=\"headerlink\" title=\"FastCGI介绍\"></a>FastCGI介绍</h2><h3 id=\"FastCGI简单介绍\"><a href=\"#FastCGI简单介绍\" class=\"headerlink\" title=\"FastCGI简单介绍\"></a>FastCGI简单介绍</h3><p>从根本上来说，FastCGI是用来提高CGI程序性能的。类似于CGI，FastCGI也可以说是一种协议。</p>\n<p>FastCGI像是一个常驻(long-live)型的CGI，它可以一直执行着，只要激活后，不会每次都要花费时间去fork一次。它还支持分布式的运算, 即 FastCGI<br>程序可以在网站服务器以外的主机上执行，并且接受来自其它网站服务器来的请求。</p>\n<p>FastCGI是语言无关的、可伸缩架构的CGI开放扩展，其主要行为是将CGI解释器进程保持在内存中，并因此获得较高的性能。众所周知，CGI解释器的反复加载是CGI性能低下的主要原因，如果CGI解释器保持在内存中，并接受FastCGI进程管理器调度，则可以提供良好的性能、伸缩性、Fail- Over特性等等。</p>\n<h3 id=\"FastCGI的工作原理\"><a href=\"#FastCGI的工作原理\" class=\"headerlink\" title=\"FastCGI的工作原理\"></a>FastCGI的工作原理</h3><p>FastCGI接口方式采用C/S结构，可以将HTTP服务器和脚本解析服务器分开，同时在脚本解析服务器上启动一个或者多个脚本解析守护进程。当HTTP服务器每次遇到动态程序时，可以将其直接交付给FastCGI进程来执行，然后将得到的结果返回给浏览器。这种方式可以让HTTP服务器专一地处理静态请求，或者将动态脚本服务器的结果返回给客户端，这在很大程度上提高了整个应用系统的性能。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/86877288.jpg\"></p>\n<ol>\n<li>Web Server启动时载入FastCGI进程管理器（Apache Module或IIS ISAPI等)</li>\n<li>FastCGI进程管理器自身初始化，启动多个CGI解释器进程(可建多个php-cgi)，并等待来自Web Server的连接。</li>\n<li>当客户端请求到达Web Server时，FastCGI进程管理器选择并连接到一个CGI解释器。Web server将CGI环境变量和标准输入发送到FastCGI子进程php-cgi。</li>\n<li>FastCGI子进程完成处理后，将标准输出和错误信息从同一连接返回Web Server。当FastCGI子进程关闭连接时，请求便告处理完成。FastCGI子进程接着等待，并处理来自FastCGI进程管理器(运行在Web Server中)的下一个连接。 在CGI模式中，php-cgi在此便退出了。</li>\n</ol>\n<p>FastCGI与CGI特点：</p>\n<ol>\n<li>对于CGI来说，每一个Web请求PHP都必须重新解析php.ini、重新载入全部扩展，并重初始化全部数据结构。而使用FastCGI，所有这些都只在进程启动时发生一次。一个额外的好处是，持续数据库连接(Persistent database connection)可以工作。</li>\n<li>由于FastCGI是多进程，所以比CGI多线程消耗更多的服务器内存，php-cgi解释器每进程消耗7至25兆内存，将这个数字乘以50或100就是很大的内存数。</li>\n</ol>\n<h2 id=\"PHP-FPM介绍\"><a href=\"#PHP-FPM介绍\" class=\"headerlink\" title=\"PHP-FPM介绍\"></a>PHP-FPM介绍</h2><p>要了解PHP-FPM，就得先说说PHP-CGI。</p>\n<p>PHP-CGI就是PHP实现的自带的CGI管理器。 </p>\n<p>虽然是php官方出品，但是这丫的却一点也不给力，性能太差，而且也很麻烦不人性化，主要体现在：</p>\n<ol>\n<li>php-cgi变更php.ini配置后，需重启php-cgi才能让新的php-ini生效，不可以平滑重启。</li>\n<li>直接杀死php-cgi进程，php就不能运行了。</li>\n</ol>\n<p>上面2个问题，一直让很多人诟病了很久，所以很多人一直还是在用 Module 方式。 直到 2004年一个叫 Andrei Nigmatulin的屌丝发明了PHP-FPM ，这神器的出现就彻底打破了这种局面，这是一个PHP专用的 fastcgi 管理器，它很爽的克服了上面2个问题，而且，还表现在其他方面更表现强劲。</p>\n<p>也就是说，PHP-FPM 是对于 FastCGI 协议的具体实现，他负责管理一个进程池，来处理来自Web服务器的请求。目前，PHP5.3版本之后，PHP-FPM是内置于PHP的。<br>因为PHP-CGI只是个CGI程序，他自己本身只能解析请求，返回结果，不会进程管理。所以就出现了一些能够调度 php-cgi 进程的程序，比如说由lighthttpd分离出来的spawn-fcgi。同样，PHP-FPM也是用于调度管理PHP解析器php-cgi的管理程序。<br>PHP-FPM通过生成新的子进程可以实现php.ini修改后的平滑重启。</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>最后，我们来总结一下，这些技术经过不断的升级，可以解决什么问题（不然也不会升级嘛）。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-7-15/42688749.jpg\"></p>\n<p>所以，如果要搭建一个高性能的PHP WEB服务器，目前最佳的方式是Apache/Nginx + FastCGI + PHP-FPM(+PHP-CGI)方式了，不要再使用 Module加载或者 CGI 方式啦：）</p>\n<p>本文章图片用Visio制作，源文件：php-fpm</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><ol>\n<li>概念了解：CGI，FastCGI，PHP-CGI与PHP-FPM：<a href=\"http://www.nowamagic.net/librarys/veda/detail/1319\">http://www.nowamagic.net/librarys/veda/detail/1319</a></li>\n<li>php中fastcgi和php-fpm是什么东西：<a href=\"https://www.zybuluo.com/phper/note/50231\">https://www.zybuluo.com/phper/note/50231</a></li>\n<li>请问CGI、PHP-CGI、PHP-FPM之间是什么关系？<a href=\"https://groups.google.com/forum/?fromgroups=#!topic/shlug/d5hJKyFzI-g\">https://groups.google.com/forum/?fromgroups=#!topic/shlug/d5hJKyFzI-g</a></li>\n<li>FastCGI 进程管理器（FPM）：<a href=\"http://php.net/manual/zh/install.fpm.php\">http://php.net/manual/zh/install.fpm.php</a></li>\n</ol>\n<h2 id=\"知乎里的解答\"><a href=\"#知乎里的解答\" class=\"headerlink\" title=\"知乎里的解答\"></a>知乎里的解答</h2><blockquote>\n<p>你(PHP)去和爱斯基摩人(web服务器，如 Apache、nginx)谈生意<br>你说中文(PHP代码)，他说爱斯基摩语(C代码)，互相听不懂，怎么办？那就都把各自说的话转换成英语(FastCGI 协议)吧。<br>怎么转换呢？你就要使用一个翻译机(PHP-FPM) (当然对方也有一个翻译机，那个是他自带的)<br>我们这个翻译机是最新型的，老式的那个（PHP-CGI）被淘汰了。不过它(PHP-FPM)只有年轻人（Linux系统）会用，老头子们（Windows系统）不会摆弄它，只好继续用老式的那个。</p>\n</blockquote>"},{"title":"Crontab 学习笔记","date":"2017-03-02T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-b997419bb7de3810.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n这是慕课网[《Linux中的计划任务之Crontab》](http://www.imooc.com/learn/216)的学习记录，方便以后查阅。\n\n> 从定时重复的工作中解脱出来\n\n<!--more-->\n\n## 1. Crontab 是什么？\nCrontab 是一个用于设置**周期性**被执行的任务的工具。\n\n1. Cron Job：被周期性执行的任务\n2. Cron Table：周期性执行的任务列表\n\n![](http://upload-images.jianshu.io/upload_images/693141-b859093fa8a16912.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 2. 安装并检查Crontab服务\n1. 检查Crontab工具是否安装：```crontab -l``` \n2. 检查crond 服务是否启动：```service crond status```\n3. 安装cron\n```\nCentOS\nyum install vixie-cron\nyum install crontabs\nUbuntu\nsudo apt-get update\nsudo apt-get install cron\n```\n\n## 3. 简单示例\n```\ncrontab -e 进入编辑模式\n\n添加一行\n\n*/1 * * * * date >> /tmp/date.log\n每分钟将当前日期时间写入日志文件\n\ntail -f /tmp/date.log （动态刷新）\ntail -3 /tmp/date.log (显示最后3行)\n```\n\n## 4. Crontab 的基本组成\n1. 配置文件：文件方式设置定时任务\n2. 系统服务CROND：每分钟都会从配置文件刷新定时任务、执行定时任务\n3. 配置工具crontab：调整定时任务\n\n### 1. 配置文件格式\n\n> 分钟0-59\n\n> 小时0-23\n\n> 日期1-31\n\n> 月份1-12\n\n> 星期0-7（0和7都表示星期日）\n\n![](http://upload-images.jianshu.io/upload_images/693141-a1d1e4b3b0a62fb5.gif?imageMogr2/auto-orient/strip)\n\n示例：\n\n每晚21：30重启apache\n```\n30 21 * * * service httpd restart\n```\n每月1、10、22号4：34重启apache（离散）\n```\n34 4 1,10,22 * * service httpd restart\n```\n\n每月1-10号4：34重启apache （连续）\n```\n34 4 1-22 * * service httpd restart\n```\n每2分钟重启apache\n```\n*/2 * * * * service httpd restart (偶数分钟)\n1-59/2 * * * * service httpd restart （奇数分钟）\n```\n晚上11点到早晨7点重启apache\n```\n0 23-7/1 * * * service httpd restart (分钟要指定)\n```\n\n晚上11点到早晨7点每隔30分钟重启apache\n```\n0,30 23-7/1 * * * service httpd restart\n0-59/30 23-7/1 * * * service httpd restart\n```\n小结：\n\n1. \\* 表示任何时候都匹配。\n2. 可以用\"A,B,C\" 表示A或者B或者C时执行命令\n3. 可以用\"A-B\"表示A到B之间时执行命令\n4. 可以用\"*/A\"表示每A分钟（小时等）执行一次命令\n\n\n## 5. Crontab 工具的使用\n\n```\ncrontab -help\ncrontab -l\ncrontab -e\ncrontab -e -u cron\ntail -f /var/log/cron 查看计划任务的执行情况\n```\n如果没有指定用户，显示的就是当前登录用户自己的计划任务。\n\n\n## 6. Crontab 配置文件\n位于 ```/etc/crontab``` 目录下\n![](http://upload-images.jianshu.io/upload_images/693141-1423dc95ddf1a9e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\ncrontab 在载入配置文件的时候，会把cron.d 下面的sysstat文件里面的配置信息载入成为root用户的计划任务。\n\ncrontab -l/-e 不能查看和编辑系统级的计划任务，即 cron.d 目录下的文件，需要 cd 到该目录使用vi编辑。\n\ncrontab -l/-e 其实是操作的 /var/spool/cron/username 文件\n\n\n\n## 7. 修改Crontab的默认编辑器为vi\n在root的配置文件 .profile (/root/.profile)添加以下代码\n```\nEDITOR=vi; export EDITOR\n```\n然后，载入这个文件即可\n```\nsource .profile\n```\n\n## 8. 几个坑\n### 1. 环境变量\n.bash_profile 中设置的环境变量并不会被Crontab捕获。\n\n### 2. 第三和第五个域之间执行的是“或”操作\n如四月第一个星期日早晨6：30执行脚本\n```\n30 6 1-7 4 0 /root/a.sh\n```\n上面写法的结果是：四月第一个星期的周一到周日（7次）或周日（一个月最少4次）早晨执行，总执行次数为10或11，并不是我们希望的结果。\n```\n30 6 1-7 4 * test `date +\\%w` -eq 0 && /root/a.sh\n```\n\n```\ndate +%w 输出当前的星期，0-6\ntest 表示是否成功\necho $? 输出上一个命令成功与否，1表示失败，0表示成功\n避免使用等号（用的话前后都加空格）进行判断，使用 -eq\n&& 表示前面成功（0）后面才执行\n% 在计划任务中要进行转义\n```\n\n### 3. 分钟设置\n\\* 表示所有都匹配，所以每小时，每天这样的情况要给小一级的单位设置一个默认值。\n```\n0 */2 * * * date\n```\n\n## 9. 综合案例\n每30s执行一次\n```\n*/1 * * * * echo \"1111\"\n*/1 * * * * sleep 30s; echo \"1111\" (分号表示无论前面的命令是否成功，后面都会执行)\n```\n\n\n","source":"_posts/Crontab-学习笔记.md","raw":"---\ntitle: Crontab 学习笔记\ndate: 2017-03-03\ntags: crontab\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-b997419bb7de3810.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n这是慕课网[《Linux中的计划任务之Crontab》](http://www.imooc.com/learn/216)的学习记录，方便以后查阅。\n\n> 从定时重复的工作中解脱出来\n\n<!--more-->\n\n## 1. Crontab 是什么？\nCrontab 是一个用于设置**周期性**被执行的任务的工具。\n\n1. Cron Job：被周期性执行的任务\n2. Cron Table：周期性执行的任务列表\n\n![](http://upload-images.jianshu.io/upload_images/693141-b859093fa8a16912.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 2. 安装并检查Crontab服务\n1. 检查Crontab工具是否安装：```crontab -l``` \n2. 检查crond 服务是否启动：```service crond status```\n3. 安装cron\n```\nCentOS\nyum install vixie-cron\nyum install crontabs\nUbuntu\nsudo apt-get update\nsudo apt-get install cron\n```\n\n## 3. 简单示例\n```\ncrontab -e 进入编辑模式\n\n添加一行\n\n*/1 * * * * date >> /tmp/date.log\n每分钟将当前日期时间写入日志文件\n\ntail -f /tmp/date.log （动态刷新）\ntail -3 /tmp/date.log (显示最后3行)\n```\n\n## 4. Crontab 的基本组成\n1. 配置文件：文件方式设置定时任务\n2. 系统服务CROND：每分钟都会从配置文件刷新定时任务、执行定时任务\n3. 配置工具crontab：调整定时任务\n\n### 1. 配置文件格式\n\n> 分钟0-59\n\n> 小时0-23\n\n> 日期1-31\n\n> 月份1-12\n\n> 星期0-7（0和7都表示星期日）\n\n![](http://upload-images.jianshu.io/upload_images/693141-a1d1e4b3b0a62fb5.gif?imageMogr2/auto-orient/strip)\n\n示例：\n\n每晚21：30重启apache\n```\n30 21 * * * service httpd restart\n```\n每月1、10、22号4：34重启apache（离散）\n```\n34 4 1,10,22 * * service httpd restart\n```\n\n每月1-10号4：34重启apache （连续）\n```\n34 4 1-22 * * service httpd restart\n```\n每2分钟重启apache\n```\n*/2 * * * * service httpd restart (偶数分钟)\n1-59/2 * * * * service httpd restart （奇数分钟）\n```\n晚上11点到早晨7点重启apache\n```\n0 23-7/1 * * * service httpd restart (分钟要指定)\n```\n\n晚上11点到早晨7点每隔30分钟重启apache\n```\n0,30 23-7/1 * * * service httpd restart\n0-59/30 23-7/1 * * * service httpd restart\n```\n小结：\n\n1. \\* 表示任何时候都匹配。\n2. 可以用\"A,B,C\" 表示A或者B或者C时执行命令\n3. 可以用\"A-B\"表示A到B之间时执行命令\n4. 可以用\"*/A\"表示每A分钟（小时等）执行一次命令\n\n\n## 5. Crontab 工具的使用\n\n```\ncrontab -help\ncrontab -l\ncrontab -e\ncrontab -e -u cron\ntail -f /var/log/cron 查看计划任务的执行情况\n```\n如果没有指定用户，显示的就是当前登录用户自己的计划任务。\n\n\n## 6. Crontab 配置文件\n位于 ```/etc/crontab``` 目录下\n![](http://upload-images.jianshu.io/upload_images/693141-1423dc95ddf1a9e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\ncrontab 在载入配置文件的时候，会把cron.d 下面的sysstat文件里面的配置信息载入成为root用户的计划任务。\n\ncrontab -l/-e 不能查看和编辑系统级的计划任务，即 cron.d 目录下的文件，需要 cd 到该目录使用vi编辑。\n\ncrontab -l/-e 其实是操作的 /var/spool/cron/username 文件\n\n\n\n## 7. 修改Crontab的默认编辑器为vi\n在root的配置文件 .profile (/root/.profile)添加以下代码\n```\nEDITOR=vi; export EDITOR\n```\n然后，载入这个文件即可\n```\nsource .profile\n```\n\n## 8. 几个坑\n### 1. 环境变量\n.bash_profile 中设置的环境变量并不会被Crontab捕获。\n\n### 2. 第三和第五个域之间执行的是“或”操作\n如四月第一个星期日早晨6：30执行脚本\n```\n30 6 1-7 4 0 /root/a.sh\n```\n上面写法的结果是：四月第一个星期的周一到周日（7次）或周日（一个月最少4次）早晨执行，总执行次数为10或11，并不是我们希望的结果。\n```\n30 6 1-7 4 * test `date +\\%w` -eq 0 && /root/a.sh\n```\n\n```\ndate +%w 输出当前的星期，0-6\ntest 表示是否成功\necho $? 输出上一个命令成功与否，1表示失败，0表示成功\n避免使用等号（用的话前后都加空格）进行判断，使用 -eq\n&& 表示前面成功（0）后面才执行\n% 在计划任务中要进行转义\n```\n\n### 3. 分钟设置\n\\* 表示所有都匹配，所以每小时，每天这样的情况要给小一级的单位设置一个默认值。\n```\n0 */2 * * * date\n```\n\n## 9. 综合案例\n每30s执行一次\n```\n*/1 * * * * echo \"1111\"\n*/1 * * * * sleep 30s; echo \"1111\" (分号表示无论前面的命令是否成功，后面都会执行)\n```\n\n\n","slug":"Crontab-学习笔记","published":1,"updated":"2020-09-11T01:04:35.032Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7q00086wo16xyg1bty","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b997419bb7de3810.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>这是慕课网<a href=\"http://www.imooc.com/learn/216\">《Linux中的计划任务之Crontab》</a>的学习记录，方便以后查阅。</p>\n<blockquote>\n<p>从定时重复的工作中解脱出来</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h2 id=\"1-Crontab-是什么？\"><a href=\"#1-Crontab-是什么？\" class=\"headerlink\" title=\"1. Crontab 是什么？\"></a>1. Crontab 是什么？</h2><p>Crontab 是一个用于设置<strong>周期性</strong>被执行的任务的工具。</p>\n<ol>\n<li>Cron Job：被周期性执行的任务</li>\n<li>Cron Table：周期性执行的任务列表</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b859093fa8a16912.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"2-安装并检查Crontab服务\"><a href=\"#2-安装并检查Crontab服务\" class=\"headerlink\" title=\"2. 安装并检查Crontab服务\"></a>2. 安装并检查Crontab服务</h2><ol>\n<li>检查Crontab工具是否安装：<code>crontab -l</code> </li>\n<li>检查crond 服务是否启动：<code>service crond status</code></li>\n<li>安装cron<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CentOS</span><br><span class=\"line\">yum install vixie-cron</span><br><span class=\"line\">yum install crontabs</span><br><span class=\"line\">Ubuntu</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install cron</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"3-简单示例\"><a href=\"#3-简单示例\" class=\"headerlink\" title=\"3. 简单示例\"></a>3. 简单示例</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e 进入编辑模式</span><br><span class=\"line\"></span><br><span class=\"line\">添加一行</span><br><span class=\"line\"></span><br><span class=\"line\">*&#x2F;1 * * * * date &gt;&gt; &#x2F;tmp&#x2F;date.log</span><br><span class=\"line\">每分钟将当前日期时间写入日志文件</span><br><span class=\"line\"></span><br><span class=\"line\">tail -f &#x2F;tmp&#x2F;date.log （动态刷新）</span><br><span class=\"line\">tail -3 &#x2F;tmp&#x2F;date.log (显示最后3行)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Crontab-的基本组成\"><a href=\"#4-Crontab-的基本组成\" class=\"headerlink\" title=\"4. Crontab 的基本组成\"></a>4. Crontab 的基本组成</h2><ol>\n<li>配置文件：文件方式设置定时任务</li>\n<li>系统服务CROND：每分钟都会从配置文件刷新定时任务、执行定时任务</li>\n<li>配置工具crontab：调整定时任务</li>\n</ol>\n<h3 id=\"1-配置文件格式\"><a href=\"#1-配置文件格式\" class=\"headerlink\" title=\"1. 配置文件格式\"></a>1. 配置文件格式</h3><blockquote>\n<p>分钟0-59</p>\n</blockquote>\n<blockquote>\n<p>小时0-23</p>\n</blockquote>\n<blockquote>\n<p>日期1-31</p>\n</blockquote>\n<blockquote>\n<p>月份1-12</p>\n</blockquote>\n<blockquote>\n<p>星期0-7（0和7都表示星期日）</p>\n</blockquote>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-a1d1e4b3b0a62fb5.gif?imageMogr2/auto-orient/strip\"></p>\n<p>示例：</p>\n<p>每晚21：30重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 21 * * * service httpd restart</span><br></pre></td></tr></table></figure>\n<p>每月1、10、22号4：34重启apache（离散）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">34 4 1,10,22 * * service httpd restart</span><br></pre></td></tr></table></figure>\n\n<p>每月1-10号4：34重启apache （连续）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">34 4 1-22 * * service httpd restart</span><br></pre></td></tr></table></figure>\n<p>每2分钟重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*&#x2F;2 * * * * service httpd restart (偶数分钟)</span><br><span class=\"line\">1-59&#x2F;2 * * * * service httpd restart （奇数分钟）</span><br></pre></td></tr></table></figure>\n<p>晚上11点到早晨7点重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 23-7&#x2F;1 * * * service httpd restart (分钟要指定)</span><br></pre></td></tr></table></figure>\n\n<p>晚上11点到早晨7点每隔30分钟重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0,30 23-7&#x2F;1 * * * service httpd restart</span><br><span class=\"line\">0-59&#x2F;30 23-7&#x2F;1 * * * service httpd restart</span><br></pre></td></tr></table></figure>\n<p>小结：</p>\n<ol>\n<li>* 表示任何时候都匹配。</li>\n<li>可以用”A,B,C” 表示A或者B或者C时执行命令</li>\n<li>可以用”A-B”表示A到B之间时执行命令</li>\n<li>可以用”*/A”表示每A分钟（小时等）执行一次命令</li>\n</ol>\n<h2 id=\"5-Crontab-工具的使用\"><a href=\"#5-Crontab-工具的使用\" class=\"headerlink\" title=\"5. Crontab 工具的使用\"></a>5. Crontab 工具的使用</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -help</span><br><span class=\"line\">crontab -l</span><br><span class=\"line\">crontab -e</span><br><span class=\"line\">crontab -e -u cron</span><br><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;cron 查看计划任务的执行情况</span><br></pre></td></tr></table></figure>\n<p>如果没有指定用户，显示的就是当前登录用户自己的计划任务。</p>\n<h2 id=\"6-Crontab-配置文件\"><a href=\"#6-Crontab-配置文件\" class=\"headerlink\" title=\"6. Crontab 配置文件\"></a>6. Crontab 配置文件</h2><p>位于 <code>/etc/crontab</code> 目录下<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-1423dc95ddf1a9e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>crontab 在载入配置文件的时候，会把cron.d 下面的sysstat文件里面的配置信息载入成为root用户的计划任务。</p>\n<p>crontab -l/-e 不能查看和编辑系统级的计划任务，即 cron.d 目录下的文件，需要 cd 到该目录使用vi编辑。</p>\n<p>crontab -l/-e 其实是操作的 /var/spool/cron/username 文件</p>\n<h2 id=\"7-修改Crontab的默认编辑器为vi\"><a href=\"#7-修改Crontab的默认编辑器为vi\" class=\"headerlink\" title=\"7. 修改Crontab的默认编辑器为vi\"></a>7. 修改Crontab的默认编辑器为vi</h2><p>在root的配置文件 .profile (/root/.profile)添加以下代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EDITOR&#x3D;vi; export EDITOR</span><br></pre></td></tr></table></figure>\n<p>然后，载入这个文件即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source .profile</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-几个坑\"><a href=\"#8-几个坑\" class=\"headerlink\" title=\"8. 几个坑\"></a>8. 几个坑</h2><h3 id=\"1-环境变量\"><a href=\"#1-环境变量\" class=\"headerlink\" title=\"1. 环境变量\"></a>1. 环境变量</h3><p>.bash_profile 中设置的环境变量并不会被Crontab捕获。</p>\n<h3 id=\"2-第三和第五个域之间执行的是“或”操作\"><a href=\"#2-第三和第五个域之间执行的是“或”操作\" class=\"headerlink\" title=\"2. 第三和第五个域之间执行的是“或”操作\"></a>2. 第三和第五个域之间执行的是“或”操作</h3><p>如四月第一个星期日早晨6：30执行脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 6 1-7 4 0 &#x2F;root&#x2F;a.sh</span><br></pre></td></tr></table></figure>\n<p>上面写法的结果是：四月第一个星期的周一到周日（7次）或周日（一个月最少4次）早晨执行，总执行次数为10或11，并不是我们希望的结果。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 6 1-7 4 * test &#96;date +\\%w&#96; -eq 0 &amp;&amp; &#x2F;root&#x2F;a.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">date +%w 输出当前的星期，0-6</span><br><span class=\"line\">test 表示是否成功</span><br><span class=\"line\">echo $? 输出上一个命令成功与否，1表示失败，0表示成功</span><br><span class=\"line\">避免使用等号（用的话前后都加空格）进行判断，使用 -eq</span><br><span class=\"line\">&amp;&amp; 表示前面成功（0）后面才执行</span><br><span class=\"line\">% 在计划任务中要进行转义</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-分钟设置\"><a href=\"#3-分钟设置\" class=\"headerlink\" title=\"3. 分钟设置\"></a>3. 分钟设置</h3><p>* 表示所有都匹配，所以每小时，每天这样的情况要给小一级的单位设置一个默认值。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 *&#x2F;2 * * * date</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-综合案例\"><a href=\"#9-综合案例\" class=\"headerlink\" title=\"9. 综合案例\"></a>9. 综合案例</h2><p>每30s执行一次</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*&#x2F;1 * * * * echo &quot;1111&quot;</span><br><span class=\"line\">*&#x2F;1 * * * * sleep 30s; echo &quot;1111&quot; (分号表示无论前面的命令是否成功，后面都会执行)</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b997419bb7de3810.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>这是慕课网<a href=\"http://www.imooc.com/learn/216\">《Linux中的计划任务之Crontab》</a>的学习记录，方便以后查阅。</p>\n<blockquote>\n<p>从定时重复的工作中解脱出来</p>\n</blockquote>","more":"<h2 id=\"1-Crontab-是什么？\"><a href=\"#1-Crontab-是什么？\" class=\"headerlink\" title=\"1. Crontab 是什么？\"></a>1. Crontab 是什么？</h2><p>Crontab 是一个用于设置<strong>周期性</strong>被执行的任务的工具。</p>\n<ol>\n<li>Cron Job：被周期性执行的任务</li>\n<li>Cron Table：周期性执行的任务列表</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b859093fa8a16912.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"2-安装并检查Crontab服务\"><a href=\"#2-安装并检查Crontab服务\" class=\"headerlink\" title=\"2. 安装并检查Crontab服务\"></a>2. 安装并检查Crontab服务</h2><ol>\n<li>检查Crontab工具是否安装：<code>crontab -l</code> </li>\n<li>检查crond 服务是否启动：<code>service crond status</code></li>\n<li>安装cron<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CentOS</span><br><span class=\"line\">yum install vixie-cron</span><br><span class=\"line\">yum install crontabs</span><br><span class=\"line\">Ubuntu</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install cron</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h2 id=\"3-简单示例\"><a href=\"#3-简单示例\" class=\"headerlink\" title=\"3. 简单示例\"></a>3. 简单示例</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -e 进入编辑模式</span><br><span class=\"line\"></span><br><span class=\"line\">添加一行</span><br><span class=\"line\"></span><br><span class=\"line\">*&#x2F;1 * * * * date &gt;&gt; &#x2F;tmp&#x2F;date.log</span><br><span class=\"line\">每分钟将当前日期时间写入日志文件</span><br><span class=\"line\"></span><br><span class=\"line\">tail -f &#x2F;tmp&#x2F;date.log （动态刷新）</span><br><span class=\"line\">tail -3 &#x2F;tmp&#x2F;date.log (显示最后3行)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Crontab-的基本组成\"><a href=\"#4-Crontab-的基本组成\" class=\"headerlink\" title=\"4. Crontab 的基本组成\"></a>4. Crontab 的基本组成</h2><ol>\n<li>配置文件：文件方式设置定时任务</li>\n<li>系统服务CROND：每分钟都会从配置文件刷新定时任务、执行定时任务</li>\n<li>配置工具crontab：调整定时任务</li>\n</ol>\n<h3 id=\"1-配置文件格式\"><a href=\"#1-配置文件格式\" class=\"headerlink\" title=\"1. 配置文件格式\"></a>1. 配置文件格式</h3><blockquote>\n<p>分钟0-59</p>\n</blockquote>\n<blockquote>\n<p>小时0-23</p>\n</blockquote>\n<blockquote>\n<p>日期1-31</p>\n</blockquote>\n<blockquote>\n<p>月份1-12</p>\n</blockquote>\n<blockquote>\n<p>星期0-7（0和7都表示星期日）</p>\n</blockquote>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-a1d1e4b3b0a62fb5.gif?imageMogr2/auto-orient/strip\"></p>\n<p>示例：</p>\n<p>每晚21：30重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 21 * * * service httpd restart</span><br></pre></td></tr></table></figure>\n<p>每月1、10、22号4：34重启apache（离散）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">34 4 1,10,22 * * service httpd restart</span><br></pre></td></tr></table></figure>\n\n<p>每月1-10号4：34重启apache （连续）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">34 4 1-22 * * service httpd restart</span><br></pre></td></tr></table></figure>\n<p>每2分钟重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*&#x2F;2 * * * * service httpd restart (偶数分钟)</span><br><span class=\"line\">1-59&#x2F;2 * * * * service httpd restart （奇数分钟）</span><br></pre></td></tr></table></figure>\n<p>晚上11点到早晨7点重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 23-7&#x2F;1 * * * service httpd restart (分钟要指定)</span><br></pre></td></tr></table></figure>\n\n<p>晚上11点到早晨7点每隔30分钟重启apache</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0,30 23-7&#x2F;1 * * * service httpd restart</span><br><span class=\"line\">0-59&#x2F;30 23-7&#x2F;1 * * * service httpd restart</span><br></pre></td></tr></table></figure>\n<p>小结：</p>\n<ol>\n<li>* 表示任何时候都匹配。</li>\n<li>可以用”A,B,C” 表示A或者B或者C时执行命令</li>\n<li>可以用”A-B”表示A到B之间时执行命令</li>\n<li>可以用”*/A”表示每A分钟（小时等）执行一次命令</li>\n</ol>\n<h2 id=\"5-Crontab-工具的使用\"><a href=\"#5-Crontab-工具的使用\" class=\"headerlink\" title=\"5. Crontab 工具的使用\"></a>5. Crontab 工具的使用</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">crontab -help</span><br><span class=\"line\">crontab -l</span><br><span class=\"line\">crontab -e</span><br><span class=\"line\">crontab -e -u cron</span><br><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;cron 查看计划任务的执行情况</span><br></pre></td></tr></table></figure>\n<p>如果没有指定用户，显示的就是当前登录用户自己的计划任务。</p>\n<h2 id=\"6-Crontab-配置文件\"><a href=\"#6-Crontab-配置文件\" class=\"headerlink\" title=\"6. Crontab 配置文件\"></a>6. Crontab 配置文件</h2><p>位于 <code>/etc/crontab</code> 目录下<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-1423dc95ddf1a9e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>crontab 在载入配置文件的时候，会把cron.d 下面的sysstat文件里面的配置信息载入成为root用户的计划任务。</p>\n<p>crontab -l/-e 不能查看和编辑系统级的计划任务，即 cron.d 目录下的文件，需要 cd 到该目录使用vi编辑。</p>\n<p>crontab -l/-e 其实是操作的 /var/spool/cron/username 文件</p>\n<h2 id=\"7-修改Crontab的默认编辑器为vi\"><a href=\"#7-修改Crontab的默认编辑器为vi\" class=\"headerlink\" title=\"7. 修改Crontab的默认编辑器为vi\"></a>7. 修改Crontab的默认编辑器为vi</h2><p>在root的配置文件 .profile (/root/.profile)添加以下代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EDITOR&#x3D;vi; export EDITOR</span><br></pre></td></tr></table></figure>\n<p>然后，载入这个文件即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source .profile</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-几个坑\"><a href=\"#8-几个坑\" class=\"headerlink\" title=\"8. 几个坑\"></a>8. 几个坑</h2><h3 id=\"1-环境变量\"><a href=\"#1-环境变量\" class=\"headerlink\" title=\"1. 环境变量\"></a>1. 环境变量</h3><p>.bash_profile 中设置的环境变量并不会被Crontab捕获。</p>\n<h3 id=\"2-第三和第五个域之间执行的是“或”操作\"><a href=\"#2-第三和第五个域之间执行的是“或”操作\" class=\"headerlink\" title=\"2. 第三和第五个域之间执行的是“或”操作\"></a>2. 第三和第五个域之间执行的是“或”操作</h3><p>如四月第一个星期日早晨6：30执行脚本</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 6 1-7 4 0 &#x2F;root&#x2F;a.sh</span><br></pre></td></tr></table></figure>\n<p>上面写法的结果是：四月第一个星期的周一到周日（7次）或周日（一个月最少4次）早晨执行，总执行次数为10或11，并不是我们希望的结果。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">30 6 1-7 4 * test &#96;date +\\%w&#96; -eq 0 &amp;&amp; &#x2F;root&#x2F;a.sh</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">date +%w 输出当前的星期，0-6</span><br><span class=\"line\">test 表示是否成功</span><br><span class=\"line\">echo $? 输出上一个命令成功与否，1表示失败，0表示成功</span><br><span class=\"line\">避免使用等号（用的话前后都加空格）进行判断，使用 -eq</span><br><span class=\"line\">&amp;&amp; 表示前面成功（0）后面才执行</span><br><span class=\"line\">% 在计划任务中要进行转义</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-分钟设置\"><a href=\"#3-分钟设置\" class=\"headerlink\" title=\"3. 分钟设置\"></a>3. 分钟设置</h3><p>* 表示所有都匹配，所以每小时，每天这样的情况要给小一级的单位设置一个默认值。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0 *&#x2F;2 * * * date</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-综合案例\"><a href=\"#9-综合案例\" class=\"headerlink\" title=\"9. 综合案例\"></a>9. 综合案例</h2><p>每30s执行一次</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*&#x2F;1 * * * * echo &quot;1111&quot;</span><br><span class=\"line\">*&#x2F;1 * * * * sleep 30s; echo &quot;1111&quot; (分号表示无论前面的命令是否成功，后面都会执行)</span><br></pre></td></tr></table></figure>"},{"title":"DEDECMS 调用多一层目录怎么解决","date":"2016-09-02T16:00:00.000Z","description":"在织梦后台里设置“系统基本参数”在“站点设置”选项里有站点根网址和网页主页链接的设置，看是否正确。","_content":"\n{dede:global.cfg_templets_skin/}的作用是调用默认模版的目录，如果刚开始安装织梦的时候不是在根目录下，而是在根目录的一个文件夹下，那么把织梦从文件夹下移动到根目录后会发现{dede:global.cfg_templets_skin/}调用出来的文件路径是错误了，多了一层目录。这种情况多发生在在本地搭建好织梦环境，调试好网站上传到服务器的时候。想要解决这个问题可以按照下面几个步骤。\n\n<!--more-->\n\n一、在织梦后台里设置“系统基本参数”在“站点设置”选项里有站点根网址和网页主页链接的设置，看是否正确。\n\n二、在织梦后台里设置“系统基本参数”在“核心设置”选项卡里有Dedecms安装目录设置，看是否正确。\n我的问题就出现在这里：\n\n![核心设置出错](http://upload-images.jianshu.io/upload_images/693141-16f2e9b31584805e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n删掉安装目录里面的所有内容就可以了。\n\n然后更新缓存后重新生成看时候解决问题。\n\n如果还没有解决问题，可以用phpmyadmin查看数据库中的“dede_sysconfig”表中的“table_results    DedeCMS安装目录”后的参数是否正确，修改这个参数后，跟新缓存，重新生成网站看是否解决问题。\n\n如果还没有解决问题，那就在织梦后台“系统”->“数据库备份/还原”里找到“dede_sysconfig”表，点击后面的修复工具，这下这个问题应该就能解决了。\n\n\n","source":"_posts/DEDECMS-{dede-global-cfg_templets_skin-}-调用多一层目录怎么解决-.md","raw":"\n---\ntitle: DEDECMS 调用多一层目录怎么解决\ndate: 2016-09-03\ntags: DEDECMS\ndescription: 在织梦后台里设置“系统基本参数”在“站点设置”选项里有站点根网址和网页主页链接的设置，看是否正确。\n---\n\n{dede:global.cfg_templets_skin/}的作用是调用默认模版的目录，如果刚开始安装织梦的时候不是在根目录下，而是在根目录的一个文件夹下，那么把织梦从文件夹下移动到根目录后会发现{dede:global.cfg_templets_skin/}调用出来的文件路径是错误了，多了一层目录。这种情况多发生在在本地搭建好织梦环境，调试好网站上传到服务器的时候。想要解决这个问题可以按照下面几个步骤。\n\n<!--more-->\n\n一、在织梦后台里设置“系统基本参数”在“站点设置”选项里有站点根网址和网页主页链接的设置，看是否正确。\n\n二、在织梦后台里设置“系统基本参数”在“核心设置”选项卡里有Dedecms安装目录设置，看是否正确。\n我的问题就出现在这里：\n\n![核心设置出错](http://upload-images.jianshu.io/upload_images/693141-16f2e9b31584805e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n删掉安装目录里面的所有内容就可以了。\n\n然后更新缓存后重新生成看时候解决问题。\n\n如果还没有解决问题，可以用phpmyadmin查看数据库中的“dede_sysconfig”表中的“table_results    DedeCMS安装目录”后的参数是否正确，修改这个参数后，跟新缓存，重新生成网站看是否解决问题。\n\n如果还没有解决问题，那就在织梦后台“系统”->“数据库备份/还原”里找到“dede_sysconfig”表，点击后面的修复工具，这下这个问题应该就能解决了。\n\n\n","slug":"DEDECMS-{dede-global-cfg_templets_skin-}-调用多一层目录怎么解决-","published":1,"updated":"2020-09-11T01:04:35.032Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7t000b6wo15pls0yb6","content":"<p>{dede:global.cfg_templets_skin/}的作用是调用默认模版的目录，如果刚开始安装织梦的时候不是在根目录下，而是在根目录的一个文件夹下，那么把织梦从文件夹下移动到根目录后会发现{dede:global.cfg_templets_skin/}调用出来的文件路径是错误了，多了一层目录。这种情况多发生在在本地搭建好织梦环境，调试好网站上传到服务器的时候。想要解决这个问题可以按照下面几个步骤。</p>\n<a id=\"more\"></a>\n\n<p>一、在织梦后台里设置“系统基本参数”在“站点设置”选项里有站点根网址和网页主页链接的设置，看是否正确。</p>\n<p>二、在织梦后台里设置“系统基本参数”在“核心设置”选项卡里有Dedecms安装目录设置，看是否正确。<br>我的问题就出现在这里：</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-16f2e9b31584805e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"核心设置出错\"></p>\n<p>删掉安装目录里面的所有内容就可以了。</p>\n<p>然后更新缓存后重新生成看时候解决问题。</p>\n<p>如果还没有解决问题，可以用phpmyadmin查看数据库中的“dede_sysconfig”表中的“table_results    DedeCMS安装目录”后的参数是否正确，修改这个参数后，跟新缓存，重新生成网站看是否解决问题。</p>\n<p>如果还没有解决问题，那就在织梦后台“系统”-&gt;“数据库备份/还原”里找到“dede_sysconfig”表，点击后面的修复工具，这下这个问题应该就能解决了。</p>\n","site":{"data":{}},"excerpt":"<p>{dede:global.cfg_templets_skin/}的作用是调用默认模版的目录，如果刚开始安装织梦的时候不是在根目录下，而是在根目录的一个文件夹下，那么把织梦从文件夹下移动到根目录后会发现{dede:global.cfg_templets_skin/}调用出来的文件路径是错误了，多了一层目录。这种情况多发生在在本地搭建好织梦环境，调试好网站上传到服务器的时候。想要解决这个问题可以按照下面几个步骤。</p>","more":"<p>一、在织梦后台里设置“系统基本参数”在“站点设置”选项里有站点根网址和网页主页链接的设置，看是否正确。</p>\n<p>二、在织梦后台里设置“系统基本参数”在“核心设置”选项卡里有Dedecms安装目录设置，看是否正确。<br>我的问题就出现在这里：</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-16f2e9b31584805e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"核心设置出错\"></p>\n<p>删掉安装目录里面的所有内容就可以了。</p>\n<p>然后更新缓存后重新生成看时候解决问题。</p>\n<p>如果还没有解决问题，可以用phpmyadmin查看数据库中的“dede_sysconfig”表中的“table_results    DedeCMS安装目录”后的参数是否正确，修改这个参数后，跟新缓存，重新生成网站看是否解决问题。</p>\n<p>如果还没有解决问题，那就在织梦后台“系统”-&gt;“数据库备份/还原”里找到“dede_sysconfig”表，点击后面的修复工具，这下这个问题应该就能解决了。</p>"},{"title":"Git 常用命令","date":"2016-11-06T16:00:00.000Z","description":"创建版本库：新建一个空目录，cd 到该目录，输入```git init```即可把该目录变为 git 可以管理的仓库。","_content":"\n1. 创建版本库：新建一个空目录，cd 到该目录，输入```git init```即可把该目录变为 git 可以管理的仓库。\n\n<!--more-->\n\n2. 上一步会自动生成```.git```的目录，默认是隐藏的，可以通过``` ls -ah```显示，但里面的东西最好不要动。\n3. 把文件添加到版本库：```git add yourfile.txt```\n4. 把文件提交到仓库： ```git commit -m 'your message'```\n5. 查看当前版本库状态：```git status```\n6. 查看修改内容：```git diff```，没有问题后， ```add & commit```\n7. 查看日志：时间由近至远 ```git log```\n```git log --pretty=oneline```使版本 ID 和每次修改输入的内容在一行显示\n8. git 中，```HEAD```指向当前版本，```HEAD^```指向上一个版本，```HEAD^^```指向上两个版本， ```HEAD-100```指向往上100个版本。\n想要恢复到某一个版本：```git reset --hard HEAD-3```\n后悔药：在命令行窗口中找到 commit id，```git reset --hard 3564223```，版本号没必要写全，前几位就可以了，Git会自动去找。这样就回退了版本，如果 add 了而没有 commit，用命令```git reset HEAD file```可以把暂存区的修改撤销掉（unstage），重新放回工作区。\n如果已经关闭命令行窗口，commit id 可以通过```git reflog```找回。\n9. 放弃本地工作区的修改，恢复到版本库或暂存区的状态。```git checkout -- yourfile.txt```，注意这里两个横向前后都要有空格。\n\n\n","source":"_posts/Git-入门指南.md","raw":"---\ntitle: Git 常用命令\ndate: 2016-11-07\ntags: git\ndescription: 创建版本库：新建一个空目录，cd 到该目录，输入```git init```即可把该目录变为 git 可以管理的仓库。\n---\n\n1. 创建版本库：新建一个空目录，cd 到该目录，输入```git init```即可把该目录变为 git 可以管理的仓库。\n\n<!--more-->\n\n2. 上一步会自动生成```.git```的目录，默认是隐藏的，可以通过``` ls -ah```显示，但里面的东西最好不要动。\n3. 把文件添加到版本库：```git add yourfile.txt```\n4. 把文件提交到仓库： ```git commit -m 'your message'```\n5. 查看当前版本库状态：```git status```\n6. 查看修改内容：```git diff```，没有问题后， ```add & commit```\n7. 查看日志：时间由近至远 ```git log```\n```git log --pretty=oneline```使版本 ID 和每次修改输入的内容在一行显示\n8. git 中，```HEAD```指向当前版本，```HEAD^```指向上一个版本，```HEAD^^```指向上两个版本， ```HEAD-100```指向往上100个版本。\n想要恢复到某一个版本：```git reset --hard HEAD-3```\n后悔药：在命令行窗口中找到 commit id，```git reset --hard 3564223```，版本号没必要写全，前几位就可以了，Git会自动去找。这样就回退了版本，如果 add 了而没有 commit，用命令```git reset HEAD file```可以把暂存区的修改撤销掉（unstage），重新放回工作区。\n如果已经关闭命令行窗口，commit id 可以通过```git reflog```找回。\n9. 放弃本地工作区的修改，恢复到版本库或暂存区的状态。```git checkout -- yourfile.txt```，注意这里两个横向前后都要有空格。\n\n\n","slug":"Git-入门指南","published":1,"updated":"2020-09-11T01:04:35.032Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7v000e6wo18bh7d9m2","content":"<ol>\n<li>创建版本库：新建一个空目录，cd 到该目录，输入<code>git init</code>即可把该目录变为 git 可以管理的仓库。</li>\n</ol>\n<a id=\"more\"></a>\n\n<ol start=\"2\">\n<li>上一步会自动生成<code>.git</code>的目录，默认是隐藏的，可以通过<code> ls -ah</code>显示，但里面的东西最好不要动。</li>\n<li>把文件添加到版本库：<code>git add yourfile.txt</code></li>\n<li>把文件提交到仓库： <code>git commit -m &#39;your message&#39;</code></li>\n<li>查看当前版本库状态：<code>git status</code></li>\n<li>查看修改内容：<code>git diff</code>，没有问题后， <code>add &amp; commit</code></li>\n<li>查看日志：时间由近至远 <code>git log</code><br><code>git log --pretty=oneline</code>使版本 ID 和每次修改输入的内容在一行显示</li>\n<li>git 中，<code>HEAD</code>指向当前版本，<code>HEAD^</code>指向上一个版本，<code>HEAD^^</code>指向上两个版本， <code>HEAD-100</code>指向往上100个版本。<br>想要恢复到某一个版本：<code>git reset --hard HEAD-3</code><br>后悔药：在命令行窗口中找到 commit id，<code>git reset --hard 3564223</code>，版本号没必要写全，前几位就可以了，Git会自动去找。这样就回退了版本，如果 add 了而没有 commit，用命令<code>git reset HEAD file</code>可以把暂存区的修改撤销掉（unstage），重新放回工作区。<br>如果已经关闭命令行窗口，commit id 可以通过<code>git reflog</code>找回。</li>\n<li>放弃本地工作区的修改，恢复到版本库或暂存区的状态。<code>git checkout -- yourfile.txt</code>，注意这里两个横向前后都要有空格。</li>\n</ol>\n","site":{"data":{}},"excerpt":"<ol>\n<li>创建版本库：新建一个空目录，cd 到该目录，输入<code>git init</code>即可把该目录变为 git 可以管理的仓库。</li>\n</ol>","more":"<ol start=\"2\">\n<li>上一步会自动生成<code>.git</code>的目录，默认是隐藏的，可以通过<code> ls -ah</code>显示，但里面的东西最好不要动。</li>\n<li>把文件添加到版本库：<code>git add yourfile.txt</code></li>\n<li>把文件提交到仓库： <code>git commit -m &#39;your message&#39;</code></li>\n<li>查看当前版本库状态：<code>git status</code></li>\n<li>查看修改内容：<code>git diff</code>，没有问题后， <code>add &amp; commit</code></li>\n<li>查看日志：时间由近至远 <code>git log</code><br><code>git log --pretty=oneline</code>使版本 ID 和每次修改输入的内容在一行显示</li>\n<li>git 中，<code>HEAD</code>指向当前版本，<code>HEAD^</code>指向上一个版本，<code>HEAD^^</code>指向上两个版本， <code>HEAD-100</code>指向往上100个版本。<br>想要恢复到某一个版本：<code>git reset --hard HEAD-3</code><br>后悔药：在命令行窗口中找到 commit id，<code>git reset --hard 3564223</code>，版本号没必要写全，前几位就可以了，Git会自动去找。这样就回退了版本，如果 add 了而没有 commit，用命令<code>git reset HEAD file</code>可以把暂存区的修改撤销掉（unstage），重新放回工作区。<br>如果已经关闭命令行窗口，commit id 可以通过<code>git reflog</code>找回。</li>\n<li>放弃本地工作区的修改，恢复到版本库或暂存区的状态。<code>git checkout -- yourfile.txt</code>，注意这里两个横向前后都要有空格。</li>\n</ol>"},{"title":"Laravel 后台搜索功能的实现","date":"2020-09-11T01:04:35.032Z","_content":"\n目标:\n1. 实现根据多个条件的搜索功能，在结果页展示搜索结果\n2. 不同的搜索条件，匹配方式不同，如时间为时间段，名字为模糊搜索等\n3. 搜索结果也要分页，并且所有页展示的都是搜索结果\n4. 搜索条件保留在搜索框中\n5. 一键清空所有搜索条件\n\n<!-- more -->\n\n## 1. list 的 blade 模板页面\n\n### 1. 在列表之前，添加搜索框选项的html代码\n\n```\n<div class=\"row\" id=\"frm_search_info\" style=\"margin-bottom: 30px\">\n    <div class=\"col-sm-12\">\n        <div class=\"col-sm-4\">\n            用户：\n            <select id=\"user_id\" name=\"user_id\" class=\"form-control select2\">\n                <option value=\"0\">请选择</option>\n                @foreach($users as $key => $value)\n                    <option value=\"{{$value->id}}\" @if($value->id == $searchParams['user_id']) selected\n                            @endif>{{$value->name}}</option>\n                @endforeach\n            </select>\n        </div>\n        <div class=\"col-sm-4\">\n            论坛：\n            <select id=\"forum_id\" name=\"forum_id\" class=\"form-control select2\">\n                <option value=\"0\">请选择</option>\n                @foreach($forums as $key => $value)\n                    <option value=\"{{$value->id}}\"\n                            @if($value->id == $searchParams['forum_id']) selected\n                            @endif>{{$value->name}}</option>\n                @endforeach\n            </select>\n        </div>\n        <div class=\"col-sm-4\">\n            修改日期：<input type='text' class=\"form-control\" id=\"start_time\" name=\"start_time\"\n                        value=\"{{$searchParams['startTime']}}\"\n                        placeholder=\"开始时间\"/>\n\n            - <input type='text' class=\"form-control\" id=\"end_time\" name=\"end_time\"\n                     value=\"{{$searchParams['endTime']}}\"\n                     placeholder=\"结束时间\"/>\n        </div>\n        <div class=\"col-sm-4\">\n            <input type=\"text\" name=\"name\" id=\"\" class=\"form-control\" placeholder=\"文件名\"\n                   value=\"{{$searchParams['name']}}\">\n            <button name=\"\" id=\"btn_clear\" class=\"btn btn-default\" type=\"submit\">\n                清空\n            </button>\n            <button name=\"\" id=\"btn_search\" class=\"btn btn-success\" type=\"submit\">\n                搜索\n            </button>\n        </div>\n    </div>\n</div>\n```\n\n### 2. 同时添加处理选项的js代码，用于拼接跳转url\n\n```\n$(document).ready(function () {\n    $(\".select2\").select2({language: \"zh-CN\"});\n    // 搜索\n    searchWithParams('/files/?page=1');\n});\n```\n\n### 3. js 方法在单独的文件中， blade 模板中引入\n\n```\n/**\n * 搜索按钮\n * @param url\n */\nfunction searchWithParams(url) {\n    $(\"#btn_search\").click(function () {\n        var params = {};\n        $(\"#frm_search_info select, #frm_search_info input[type=text], #frm_search_info input[type=hidden]\").each(function () {\n            var value = $(this).val();\n            if ('' != value) {\n                params[$(this).attr('name')] = value;\n            }\n        });\n\n        if (!$.isEmptyObject(params)) {\n            url += \"&\" + parserParams2Url(params);\n        }\n        location.href = url;\n    });\n}\n\nparserParams2Url = function (params) {\n    var url = '';\n    $.each(params, function (index, item) {\n        if (url) {\n            url += '&';\n        }\n        url += index + '=' + item;\n    });\n    return url;\n};\n// 清空搜索条件\n$(\"#btn_clear\").click(function () {\n    $('#frm_search_info').find('select').each(function () {\n        $(this).find('option:first').prop(\"selected\", true);\n        $(this).change();\n    });\n    $(\"#frm_search_info input[type=text]\").each(function () {\n        $(this).val(\"\");\n    });\n    $(\"#frm_search_info input[type=number]\").each(function () {\n        $(this).val(\"\");\n    });\n});\n```\n\n### 4. 同时，分页部分也要带上搜索参数 appends\n\n```\n<div class=\"row\">\n    <div class=\"col-sm-12\">\n        {{$files->appends($searchParams)->links()}}\n    </div>\n</div>\n```\n\n## 2. 控制器\n\n### 1. 首先接收所有的请求参数，包括搜索参数\n\n```\n$userId = intval($request->input('user_id', 0));\n$forumId = intval($request->input('forum_id', 0));\n$startTime = trim($request->input('start_time', ''));\n$endTime = trim($request->input('end_time', ''));\n$name = trim($request->input('name', ''));\n```\n\n### 2. 拼接搜索的query\n\n```\n$query = File::with('forum')->with('user')->orderBy('updated_at', 'desc');\nif (!empty($name)) {\n        $query->where('filename', 'like', '%' . $name . '%');\n}\nif (!empty($startTime) && !empty($endTime) && ($endTime > $startTime)) {\n    $query->where('updated_at', '>', $startTime);\n    $query->where('updated_at', '<', $endTime);\n}\nif (!empty($userId)) {\n    $query->where('user_id', $userId);\n}\nif (!empty($forumId)) {\n    $query->where('forum_id', $forumId);\n}\n$query = $query->paginate();\n```\n\n### 3. 如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\n\n```\nif (!empty($name)) {\n    $query->where(function ($query) use ($name) {\n        $query->where('name', 'like', '%' . $name . '%')\n            ->orWhere('alias', 'like', '%' . $name . '%')\n            ->orWhere('alias_abbr', 'like', '%' . $name . '%');\n    });\n}\n```\n\n### 4. 最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\n\n```\n$returnData = [\n    'files' => $query,\n    'searchParams' => [\n        'startTime' => $startTime,\n        'endTime' => $endTime,\n        'name' => $name,\n        'user_id' => $userId,\n        'forum_id' => $forumId,\n    ],\n    'forums' => $forums,\n    'users' => $users\n];\nreturn view('/file/index', $returnData);\n```\n","source":"_posts/Laravel 后台搜索功能的实现.md","raw":"---\ntitle: Laravel 后台搜索功能的实现\ndate: 2017-12-22 22：28：12\ntags: Laravel\ncategories: laravel\n---\n\n目标:\n1. 实现根据多个条件的搜索功能，在结果页展示搜索结果\n2. 不同的搜索条件，匹配方式不同，如时间为时间段，名字为模糊搜索等\n3. 搜索结果也要分页，并且所有页展示的都是搜索结果\n4. 搜索条件保留在搜索框中\n5. 一键清空所有搜索条件\n\n<!-- more -->\n\n## 1. list 的 blade 模板页面\n\n### 1. 在列表之前，添加搜索框选项的html代码\n\n```\n<div class=\"row\" id=\"frm_search_info\" style=\"margin-bottom: 30px\">\n    <div class=\"col-sm-12\">\n        <div class=\"col-sm-4\">\n            用户：\n            <select id=\"user_id\" name=\"user_id\" class=\"form-control select2\">\n                <option value=\"0\">请选择</option>\n                @foreach($users as $key => $value)\n                    <option value=\"{{$value->id}}\" @if($value->id == $searchParams['user_id']) selected\n                            @endif>{{$value->name}}</option>\n                @endforeach\n            </select>\n        </div>\n        <div class=\"col-sm-4\">\n            论坛：\n            <select id=\"forum_id\" name=\"forum_id\" class=\"form-control select2\">\n                <option value=\"0\">请选择</option>\n                @foreach($forums as $key => $value)\n                    <option value=\"{{$value->id}}\"\n                            @if($value->id == $searchParams['forum_id']) selected\n                            @endif>{{$value->name}}</option>\n                @endforeach\n            </select>\n        </div>\n        <div class=\"col-sm-4\">\n            修改日期：<input type='text' class=\"form-control\" id=\"start_time\" name=\"start_time\"\n                        value=\"{{$searchParams['startTime']}}\"\n                        placeholder=\"开始时间\"/>\n\n            - <input type='text' class=\"form-control\" id=\"end_time\" name=\"end_time\"\n                     value=\"{{$searchParams['endTime']}}\"\n                     placeholder=\"结束时间\"/>\n        </div>\n        <div class=\"col-sm-4\">\n            <input type=\"text\" name=\"name\" id=\"\" class=\"form-control\" placeholder=\"文件名\"\n                   value=\"{{$searchParams['name']}}\">\n            <button name=\"\" id=\"btn_clear\" class=\"btn btn-default\" type=\"submit\">\n                清空\n            </button>\n            <button name=\"\" id=\"btn_search\" class=\"btn btn-success\" type=\"submit\">\n                搜索\n            </button>\n        </div>\n    </div>\n</div>\n```\n\n### 2. 同时添加处理选项的js代码，用于拼接跳转url\n\n```\n$(document).ready(function () {\n    $(\".select2\").select2({language: \"zh-CN\"});\n    // 搜索\n    searchWithParams('/files/?page=1');\n});\n```\n\n### 3. js 方法在单独的文件中， blade 模板中引入\n\n```\n/**\n * 搜索按钮\n * @param url\n */\nfunction searchWithParams(url) {\n    $(\"#btn_search\").click(function () {\n        var params = {};\n        $(\"#frm_search_info select, #frm_search_info input[type=text], #frm_search_info input[type=hidden]\").each(function () {\n            var value = $(this).val();\n            if ('' != value) {\n                params[$(this).attr('name')] = value;\n            }\n        });\n\n        if (!$.isEmptyObject(params)) {\n            url += \"&\" + parserParams2Url(params);\n        }\n        location.href = url;\n    });\n}\n\nparserParams2Url = function (params) {\n    var url = '';\n    $.each(params, function (index, item) {\n        if (url) {\n            url += '&';\n        }\n        url += index + '=' + item;\n    });\n    return url;\n};\n// 清空搜索条件\n$(\"#btn_clear\").click(function () {\n    $('#frm_search_info').find('select').each(function () {\n        $(this).find('option:first').prop(\"selected\", true);\n        $(this).change();\n    });\n    $(\"#frm_search_info input[type=text]\").each(function () {\n        $(this).val(\"\");\n    });\n    $(\"#frm_search_info input[type=number]\").each(function () {\n        $(this).val(\"\");\n    });\n});\n```\n\n### 4. 同时，分页部分也要带上搜索参数 appends\n\n```\n<div class=\"row\">\n    <div class=\"col-sm-12\">\n        {{$files->appends($searchParams)->links()}}\n    </div>\n</div>\n```\n\n## 2. 控制器\n\n### 1. 首先接收所有的请求参数，包括搜索参数\n\n```\n$userId = intval($request->input('user_id', 0));\n$forumId = intval($request->input('forum_id', 0));\n$startTime = trim($request->input('start_time', ''));\n$endTime = trim($request->input('end_time', ''));\n$name = trim($request->input('name', ''));\n```\n\n### 2. 拼接搜索的query\n\n```\n$query = File::with('forum')->with('user')->orderBy('updated_at', 'desc');\nif (!empty($name)) {\n        $query->where('filename', 'like', '%' . $name . '%');\n}\nif (!empty($startTime) && !empty($endTime) && ($endTime > $startTime)) {\n    $query->where('updated_at', '>', $startTime);\n    $query->where('updated_at', '<', $endTime);\n}\nif (!empty($userId)) {\n    $query->where('user_id', $userId);\n}\nif (!empty($forumId)) {\n    $query->where('forum_id', $forumId);\n}\n$query = $query->paginate();\n```\n\n### 3. 如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\n\n```\nif (!empty($name)) {\n    $query->where(function ($query) use ($name) {\n        $query->where('name', 'like', '%' . $name . '%')\n            ->orWhere('alias', 'like', '%' . $name . '%')\n            ->orWhere('alias_abbr', 'like', '%' . $name . '%');\n    });\n}\n```\n\n### 4. 最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\n\n```\n$returnData = [\n    'files' => $query,\n    'searchParams' => [\n        'startTime' => $startTime,\n        'endTime' => $endTime,\n        'name' => $name,\n        'user_id' => $userId,\n        'forum_id' => $forumId,\n    ],\n    'forums' => $forums,\n    'users' => $users\n];\nreturn view('/file/index', $returnData);\n```\n","slug":"Laravel 后台搜索功能的实现","published":1,"updated":"2020-09-11T01:04:35.033Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7w000f6wo160w610m8","content":"<p>目标:</p>\n<ol>\n<li>实现根据多个条件的搜索功能，在结果页展示搜索结果</li>\n<li>不同的搜索条件，匹配方式不同，如时间为时间段，名字为模糊搜索等</li>\n<li>搜索结果也要分页，并且所有页展示的都是搜索结果</li>\n<li>搜索条件保留在搜索框中</li>\n<li>一键清空所有搜索条件</li>\n</ol>\n<a id=\"more\"></a>\n\n<h2 id=\"1-list-的-blade-模板页面\"><a href=\"#1-list-的-blade-模板页面\" class=\"headerlink\" title=\"1. list 的 blade 模板页面\"></a>1. list 的 blade 模板页面</h2><h3 id=\"1-在列表之前，添加搜索框选项的html代码\"><a href=\"#1-在列表之前，添加搜索框选项的html代码\" class=\"headerlink\" title=\"1. 在列表之前，添加搜索框选项的html代码\"></a>1. 在列表之前，添加搜索框选项的html代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;row&quot; id&#x3D;&quot;frm_search_info&quot; style&#x3D;&quot;margin-bottom: 30px&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;col-sm-12&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            用户：</span><br><span class=\"line\">            &lt;select id&#x3D;&quot;user_id&quot; name&#x3D;&quot;user_id&quot; class&#x3D;&quot;form-control select2&quot;&gt;</span><br><span class=\"line\">                &lt;option value&#x3D;&quot;0&quot;&gt;请选择&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @foreach($users as $key &#x3D;&gt; $value)</span><br><span class=\"line\">                    &lt;option value&#x3D;&quot;&#123;&#123;$value-&gt;id&#125;&#125;&quot; @if($value-&gt;id &#x3D;&#x3D; $searchParams[&#39;user_id&#39;]) selected</span><br><span class=\"line\">                            @endif&gt;&#123;&#123;$value-&gt;name&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @endforeach</span><br><span class=\"line\">            &lt;&#x2F;select&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            论坛：</span><br><span class=\"line\">            &lt;select id&#x3D;&quot;forum_id&quot; name&#x3D;&quot;forum_id&quot; class&#x3D;&quot;form-control select2&quot;&gt;</span><br><span class=\"line\">                &lt;option value&#x3D;&quot;0&quot;&gt;请选择&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @foreach($forums as $key &#x3D;&gt; $value)</span><br><span class=\"line\">                    &lt;option value&#x3D;&quot;&#123;&#123;$value-&gt;id&#125;&#125;&quot;</span><br><span class=\"line\">                            @if($value-&gt;id &#x3D;&#x3D; $searchParams[&#39;forum_id&#39;]) selected</span><br><span class=\"line\">                            @endif&gt;&#123;&#123;$value-&gt;name&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @endforeach</span><br><span class=\"line\">            &lt;&#x2F;select&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            修改日期：&lt;input type&#x3D;&#39;text&#39; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;start_time&quot; name&#x3D;&quot;start_time&quot;</span><br><span class=\"line\">                        value&#x3D;&quot;&#123;&#123;$searchParams[&#39;startTime&#39;]&#125;&#125;&quot;</span><br><span class=\"line\">                        placeholder&#x3D;&quot;开始时间&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            - &lt;input type&#x3D;&#39;text&#39; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;end_time&quot; name&#x3D;&quot;end_time&quot;</span><br><span class=\"line\">                     value&#x3D;&quot;&#123;&#123;$searchParams[&#39;endTime&#39;]&#125;&#125;&quot;</span><br><span class=\"line\">                     placeholder&#x3D;&quot;结束时间&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;name&quot; id&#x3D;&quot;&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;文件名&quot;</span><br><span class=\"line\">                   value&#x3D;&quot;&#123;&#123;$searchParams[&#39;name&#39;]&#125;&#125;&quot;&gt;</span><br><span class=\"line\">            &lt;button name&#x3D;&quot;&quot; id&#x3D;&quot;btn_clear&quot; class&#x3D;&quot;btn btn-default&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class=\"line\">                清空</span><br><span class=\"line\">            &lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;button name&#x3D;&quot;&quot; id&#x3D;&quot;btn_search&quot; class&#x3D;&quot;btn btn-success&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class=\"line\">                搜索</span><br><span class=\"line\">            &lt;&#x2F;button&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-同时添加处理选项的js代码，用于拼接跳转url\"><a href=\"#2-同时添加处理选项的js代码，用于拼接跳转url\" class=\"headerlink\" title=\"2. 同时添加处理选项的js代码，用于拼接跳转url\"></a>2. 同时添加处理选项的js代码，用于拼接跳转url</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(document).ready(function () &#123;</span><br><span class=\"line\">    $(&quot;.select2&quot;).select2(&#123;language: &quot;zh-CN&quot;&#125;);</span><br><span class=\"line\">    &#x2F;&#x2F; 搜索</span><br><span class=\"line\">    searchWithParams(&#39;&#x2F;files&#x2F;?page&#x3D;1&#39;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-js-方法在单独的文件中，-blade-模板中引入\"><a href=\"#3-js-方法在单独的文件中，-blade-模板中引入\" class=\"headerlink\" title=\"3. js 方法在单独的文件中， blade 模板中引入\"></a>3. js 方法在单独的文件中， blade 模板中引入</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 搜索按钮</span><br><span class=\"line\"> * @param url</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function searchWithParams(url) &#123;</span><br><span class=\"line\">    $(&quot;#btn_search&quot;).click(function () &#123;</span><br><span class=\"line\">        var params &#x3D; &#123;&#125;;</span><br><span class=\"line\">        $(&quot;#frm_search_info select, #frm_search_info input[type&#x3D;text], #frm_search_info input[type&#x3D;hidden]&quot;).each(function () &#123;</span><br><span class=\"line\">            var value &#x3D; $(this).val();</span><br><span class=\"line\">            if (&#39;&#39; !&#x3D; value) &#123;</span><br><span class=\"line\">                params[$(this).attr(&#39;name&#39;)] &#x3D; value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (!$.isEmptyObject(params)) &#123;</span><br><span class=\"line\">            url +&#x3D; &quot;&amp;&quot; + parserParams2Url(params);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location.href &#x3D; url;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">parserParams2Url &#x3D; function (params) &#123;</span><br><span class=\"line\">    var url &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $.each(params, function (index, item) &#123;</span><br><span class=\"line\">        if (url) &#123;</span><br><span class=\"line\">            url +&#x3D; &#39;&amp;&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        url +&#x3D; index + &#39;&#x3D;&#39; + item;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    return url;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&#x2F;&#x2F; 清空搜索条件</span><br><span class=\"line\">$(&quot;#btn_clear&quot;).click(function () &#123;</span><br><span class=\"line\">    $(&#39;#frm_search_info&#39;).find(&#39;select&#39;).each(function () &#123;</span><br><span class=\"line\">        $(this).find(&#39;option:first&#39;).prop(&quot;selected&quot;, true);</span><br><span class=\"line\">        $(this).change();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    $(&quot;#frm_search_info input[type&#x3D;text]&quot;).each(function () &#123;</span><br><span class=\"line\">        $(this).val(&quot;&quot;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    $(&quot;#frm_search_info input[type&#x3D;number]&quot;).each(function () &#123;</span><br><span class=\"line\">        $(this).val(&quot;&quot;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-同时，分页部分也要带上搜索参数-appends\"><a href=\"#4-同时，分页部分也要带上搜索参数-appends\" class=\"headerlink\" title=\"4. 同时，分页部分也要带上搜索参数 appends\"></a>4. 同时，分页部分也要带上搜索参数 appends</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;col-sm-12&quot;&gt;</span><br><span class=\"line\">        &#123;&#123;$files-&gt;appends($searchParams)-&gt;links()&#125;&#125;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-控制器\"><a href=\"#2-控制器\" class=\"headerlink\" title=\"2. 控制器\"></a>2. 控制器</h2><h3 id=\"1-首先接收所有的请求参数，包括搜索参数\"><a href=\"#1-首先接收所有的请求参数，包括搜索参数\" class=\"headerlink\" title=\"1. 首先接收所有的请求参数，包括搜索参数\"></a>1. 首先接收所有的请求参数，包括搜索参数</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$userId &#x3D; intval($request-&gt;input(&#39;user_id&#39;, 0));</span><br><span class=\"line\">$forumId &#x3D; intval($request-&gt;input(&#39;forum_id&#39;, 0));</span><br><span class=\"line\">$startTime &#x3D; trim($request-&gt;input(&#39;start_time&#39;, &#39;&#39;));</span><br><span class=\"line\">$endTime &#x3D; trim($request-&gt;input(&#39;end_time&#39;, &#39;&#39;));</span><br><span class=\"line\">$name &#x3D; trim($request-&gt;input(&#39;name&#39;, &#39;&#39;));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-拼接搜索的query\"><a href=\"#2-拼接搜索的query\" class=\"headerlink\" title=\"2. 拼接搜索的query\"></a>2. 拼接搜索的query</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$query &#x3D; File::with(&#39;forum&#39;)-&gt;with(&#39;user&#39;)-&gt;orderBy(&#39;updated_at&#39;, &#39;desc&#39;);</span><br><span class=\"line\">if (!empty($name)) &#123;</span><br><span class=\"line\">        $query-&gt;where(&#39;filename&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (!empty($startTime) &amp;&amp; !empty($endTime) &amp;&amp; ($endTime &gt; $startTime)) &#123;</span><br><span class=\"line\">    $query-&gt;where(&#39;updated_at&#39;, &#39;&gt;&#39;, $startTime);</span><br><span class=\"line\">    $query-&gt;where(&#39;updated_at&#39;, &#39;&lt;&#39;, $endTime);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (!empty($userId)) &#123;</span><br><span class=\"line\">    $query-&gt;where(&#39;user_id&#39;, $userId);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (!empty($forumId)) &#123;</span><br><span class=\"line\">    $query-&gt;where(&#39;forum_id&#39;, $forumId);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$query &#x3D; $query-&gt;paginate();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\"><a href=\"#3-如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\" class=\"headerlink\" title=\"3. 如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\"></a>3. 如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!empty($name)) &#123;</span><br><span class=\"line\">    $query-&gt;where(function ($query) use ($name) &#123;</span><br><span class=\"line\">        $query-&gt;where(&#39;name&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;)</span><br><span class=\"line\">            -&gt;orWhere(&#39;alias&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;)</span><br><span class=\"line\">            -&gt;orWhere(&#39;alias_abbr&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\"><a href=\"#4-最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\" class=\"headerlink\" title=\"4. 最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\"></a>4. 最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$returnData &#x3D; [</span><br><span class=\"line\">    &#39;files&#39; &#x3D;&gt; $query,</span><br><span class=\"line\">    &#39;searchParams&#39; &#x3D;&gt; [</span><br><span class=\"line\">        &#39;startTime&#39; &#x3D;&gt; $startTime,</span><br><span class=\"line\">        &#39;endTime&#39; &#x3D;&gt; $endTime,</span><br><span class=\"line\">        &#39;name&#39; &#x3D;&gt; $name,</span><br><span class=\"line\">        &#39;user_id&#39; &#x3D;&gt; $userId,</span><br><span class=\"line\">        &#39;forum_id&#39; &#x3D;&gt; $forumId,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#39;forums&#39; &#x3D;&gt; $forums,</span><br><span class=\"line\">    &#39;users&#39; &#x3D;&gt; $users</span><br><span class=\"line\">];</span><br><span class=\"line\">return view(&#39;&#x2F;file&#x2F;index&#39;, $returnData);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>目标:</p>\n<ol>\n<li>实现根据多个条件的搜索功能，在结果页展示搜索结果</li>\n<li>不同的搜索条件，匹配方式不同，如时间为时间段，名字为模糊搜索等</li>\n<li>搜索结果也要分页，并且所有页展示的都是搜索结果</li>\n<li>搜索条件保留在搜索框中</li>\n<li>一键清空所有搜索条件</li>\n</ol>","more":"<h2 id=\"1-list-的-blade-模板页面\"><a href=\"#1-list-的-blade-模板页面\" class=\"headerlink\" title=\"1. list 的 blade 模板页面\"></a>1. list 的 blade 模板页面</h2><h3 id=\"1-在列表之前，添加搜索框选项的html代码\"><a href=\"#1-在列表之前，添加搜索框选项的html代码\" class=\"headerlink\" title=\"1. 在列表之前，添加搜索框选项的html代码\"></a>1. 在列表之前，添加搜索框选项的html代码</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;row&quot; id&#x3D;&quot;frm_search_info&quot; style&#x3D;&quot;margin-bottom: 30px&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;col-sm-12&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            用户：</span><br><span class=\"line\">            &lt;select id&#x3D;&quot;user_id&quot; name&#x3D;&quot;user_id&quot; class&#x3D;&quot;form-control select2&quot;&gt;</span><br><span class=\"line\">                &lt;option value&#x3D;&quot;0&quot;&gt;请选择&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @foreach($users as $key &#x3D;&gt; $value)</span><br><span class=\"line\">                    &lt;option value&#x3D;&quot;&#123;&#123;$value-&gt;id&#125;&#125;&quot; @if($value-&gt;id &#x3D;&#x3D; $searchParams[&#39;user_id&#39;]) selected</span><br><span class=\"line\">                            @endif&gt;&#123;&#123;$value-&gt;name&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @endforeach</span><br><span class=\"line\">            &lt;&#x2F;select&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            论坛：</span><br><span class=\"line\">            &lt;select id&#x3D;&quot;forum_id&quot; name&#x3D;&quot;forum_id&quot; class&#x3D;&quot;form-control select2&quot;&gt;</span><br><span class=\"line\">                &lt;option value&#x3D;&quot;0&quot;&gt;请选择&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @foreach($forums as $key &#x3D;&gt; $value)</span><br><span class=\"line\">                    &lt;option value&#x3D;&quot;&#123;&#123;$value-&gt;id&#125;&#125;&quot;</span><br><span class=\"line\">                            @if($value-&gt;id &#x3D;&#x3D; $searchParams[&#39;forum_id&#39;]) selected</span><br><span class=\"line\">                            @endif&gt;&#123;&#123;$value-&gt;name&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @endforeach</span><br><span class=\"line\">            &lt;&#x2F;select&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            修改日期：&lt;input type&#x3D;&#39;text&#39; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;start_time&quot; name&#x3D;&quot;start_time&quot;</span><br><span class=\"line\">                        value&#x3D;&quot;&#123;&#123;$searchParams[&#39;startTime&#39;]&#125;&#125;&quot;</span><br><span class=\"line\">                        placeholder&#x3D;&quot;开始时间&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">            - &lt;input type&#x3D;&#39;text&#39; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;end_time&quot; name&#x3D;&quot;end_time&quot;</span><br><span class=\"line\">                     value&#x3D;&quot;&#123;&#123;$searchParams[&#39;endTime&#39;]&#125;&#125;&quot;</span><br><span class=\"line\">                     placeholder&#x3D;&quot;结束时间&quot;&#x2F;&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;col-sm-4&quot;&gt;</span><br><span class=\"line\">            &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;name&quot; id&#x3D;&quot;&quot; class&#x3D;&quot;form-control&quot; placeholder&#x3D;&quot;文件名&quot;</span><br><span class=\"line\">                   value&#x3D;&quot;&#123;&#123;$searchParams[&#39;name&#39;]&#125;&#125;&quot;&gt;</span><br><span class=\"line\">            &lt;button name&#x3D;&quot;&quot; id&#x3D;&quot;btn_clear&quot; class&#x3D;&quot;btn btn-default&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class=\"line\">                清空</span><br><span class=\"line\">            &lt;&#x2F;button&gt;</span><br><span class=\"line\">            &lt;button name&#x3D;&quot;&quot; id&#x3D;&quot;btn_search&quot; class&#x3D;&quot;btn btn-success&quot; type&#x3D;&quot;submit&quot;&gt;</span><br><span class=\"line\">                搜索</span><br><span class=\"line\">            &lt;&#x2F;button&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-同时添加处理选项的js代码，用于拼接跳转url\"><a href=\"#2-同时添加处理选项的js代码，用于拼接跳转url\" class=\"headerlink\" title=\"2. 同时添加处理选项的js代码，用于拼接跳转url\"></a>2. 同时添加处理选项的js代码，用于拼接跳转url</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$(document).ready(function () &#123;</span><br><span class=\"line\">    $(&quot;.select2&quot;).select2(&#123;language: &quot;zh-CN&quot;&#125;);</span><br><span class=\"line\">    &#x2F;&#x2F; 搜索</span><br><span class=\"line\">    searchWithParams(&#39;&#x2F;files&#x2F;?page&#x3D;1&#39;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-js-方法在单独的文件中，-blade-模板中引入\"><a href=\"#3-js-方法在单独的文件中，-blade-模板中引入\" class=\"headerlink\" title=\"3. js 方法在单独的文件中， blade 模板中引入\"></a>3. js 方法在单独的文件中， blade 模板中引入</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 搜索按钮</span><br><span class=\"line\"> * @param url</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function searchWithParams(url) &#123;</span><br><span class=\"line\">    $(&quot;#btn_search&quot;).click(function () &#123;</span><br><span class=\"line\">        var params &#x3D; &#123;&#125;;</span><br><span class=\"line\">        $(&quot;#frm_search_info select, #frm_search_info input[type&#x3D;text], #frm_search_info input[type&#x3D;hidden]&quot;).each(function () &#123;</span><br><span class=\"line\">            var value &#x3D; $(this).val();</span><br><span class=\"line\">            if (&#39;&#39; !&#x3D; value) &#123;</span><br><span class=\"line\">                params[$(this).attr(&#39;name&#39;)] &#x3D; value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (!$.isEmptyObject(params)) &#123;</span><br><span class=\"line\">            url +&#x3D; &quot;&amp;&quot; + parserParams2Url(params);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        location.href &#x3D; url;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">parserParams2Url &#x3D; function (params) &#123;</span><br><span class=\"line\">    var url &#x3D; &#39;&#39;;</span><br><span class=\"line\">    $.each(params, function (index, item) &#123;</span><br><span class=\"line\">        if (url) &#123;</span><br><span class=\"line\">            url +&#x3D; &#39;&amp;&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        url +&#x3D; index + &#39;&#x3D;&#39; + item;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    return url;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&#x2F;&#x2F; 清空搜索条件</span><br><span class=\"line\">$(&quot;#btn_clear&quot;).click(function () &#123;</span><br><span class=\"line\">    $(&#39;#frm_search_info&#39;).find(&#39;select&#39;).each(function () &#123;</span><br><span class=\"line\">        $(this).find(&#39;option:first&#39;).prop(&quot;selected&quot;, true);</span><br><span class=\"line\">        $(this).change();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    $(&quot;#frm_search_info input[type&#x3D;text]&quot;).each(function () &#123;</span><br><span class=\"line\">        $(this).val(&quot;&quot;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    $(&quot;#frm_search_info input[type&#x3D;number]&quot;).each(function () &#123;</span><br><span class=\"line\">        $(this).val(&quot;&quot;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-同时，分页部分也要带上搜索参数-appends\"><a href=\"#4-同时，分页部分也要带上搜索参数-appends\" class=\"headerlink\" title=\"4. 同时，分页部分也要带上搜索参数 appends\"></a>4. 同时，分页部分也要带上搜索参数 appends</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;col-sm-12&quot;&gt;</span><br><span class=\"line\">        &#123;&#123;$files-&gt;appends($searchParams)-&gt;links()&#125;&#125;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-控制器\"><a href=\"#2-控制器\" class=\"headerlink\" title=\"2. 控制器\"></a>2. 控制器</h2><h3 id=\"1-首先接收所有的请求参数，包括搜索参数\"><a href=\"#1-首先接收所有的请求参数，包括搜索参数\" class=\"headerlink\" title=\"1. 首先接收所有的请求参数，包括搜索参数\"></a>1. 首先接收所有的请求参数，包括搜索参数</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$userId &#x3D; intval($request-&gt;input(&#39;user_id&#39;, 0));</span><br><span class=\"line\">$forumId &#x3D; intval($request-&gt;input(&#39;forum_id&#39;, 0));</span><br><span class=\"line\">$startTime &#x3D; trim($request-&gt;input(&#39;start_time&#39;, &#39;&#39;));</span><br><span class=\"line\">$endTime &#x3D; trim($request-&gt;input(&#39;end_time&#39;, &#39;&#39;));</span><br><span class=\"line\">$name &#x3D; trim($request-&gt;input(&#39;name&#39;, &#39;&#39;));</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-拼接搜索的query\"><a href=\"#2-拼接搜索的query\" class=\"headerlink\" title=\"2. 拼接搜索的query\"></a>2. 拼接搜索的query</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$query &#x3D; File::with(&#39;forum&#39;)-&gt;with(&#39;user&#39;)-&gt;orderBy(&#39;updated_at&#39;, &#39;desc&#39;);</span><br><span class=\"line\">if (!empty($name)) &#123;</span><br><span class=\"line\">        $query-&gt;where(&#39;filename&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (!empty($startTime) &amp;&amp; !empty($endTime) &amp;&amp; ($endTime &gt; $startTime)) &#123;</span><br><span class=\"line\">    $query-&gt;where(&#39;updated_at&#39;, &#39;&gt;&#39;, $startTime);</span><br><span class=\"line\">    $query-&gt;where(&#39;updated_at&#39;, &#39;&lt;&#39;, $endTime);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (!empty($userId)) &#123;</span><br><span class=\"line\">    $query-&gt;where(&#39;user_id&#39;, $userId);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if (!empty($forumId)) &#123;</span><br><span class=\"line\">    $query-&gt;where(&#39;forum_id&#39;, $forumId);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$query &#x3D; $query-&gt;paginate();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\"><a href=\"#3-如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\" class=\"headerlink\" title=\"3. 如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包\"></a>3. 如果搜索query中包含多个orWhere条件，并且需要以括号的形式处理时，需要使用闭包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!empty($name)) &#123;</span><br><span class=\"line\">    $query-&gt;where(function ($query) use ($name) &#123;</span><br><span class=\"line\">        $query-&gt;where(&#39;name&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;)</span><br><span class=\"line\">            -&gt;orWhere(&#39;alias&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;)</span><br><span class=\"line\">            -&gt;orWhere(&#39;alias_abbr&#39;, &#39;like&#39;, &#39;%&#39; . $name . &#39;%&#39;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\"><a href=\"#4-最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\" class=\"headerlink\" title=\"4. 最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中\"></a>4. 最后，给模板文件返回所需参数，搜索条件以数组的形式返回，便于appends到分页语句中</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$returnData &#x3D; [</span><br><span class=\"line\">    &#39;files&#39; &#x3D;&gt; $query,</span><br><span class=\"line\">    &#39;searchParams&#39; &#x3D;&gt; [</span><br><span class=\"line\">        &#39;startTime&#39; &#x3D;&gt; $startTime,</span><br><span class=\"line\">        &#39;endTime&#39; &#x3D;&gt; $endTime,</span><br><span class=\"line\">        &#39;name&#39; &#x3D;&gt; $name,</span><br><span class=\"line\">        &#39;user_id&#39; &#x3D;&gt; $userId,</span><br><span class=\"line\">        &#39;forum_id&#39; &#x3D;&gt; $forumId,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#39;forums&#39; &#x3D;&gt; $forums,</span><br><span class=\"line\">    &#39;users&#39; &#x3D;&gt; $users</span><br><span class=\"line\">];</span><br><span class=\"line\">return view(&#39;&#x2F;file&#x2F;index&#39;, $returnData);</span><br></pre></td></tr></table></figure>"},{"title":"Laravel 去重、分组取最大、按时间二次分组、评论盖楼等","date":"2017-07-15T13:02:05.000Z","_content":"\n最近公司项目中遇到的几个问题，记录一下\n\n## 1. 去重\n\n业务：从数据库中取出用户的阅读足迹，由于用户在一天之内可能多次阅读同一篇文章，数据表中对于同一天同一用户同一文章可能有多条记录，只是打开时间和关闭时间不同。取出用户阅读足迹的时间，需要对当天的阅读足迹去重。\n\n<!--more-->\n\n```\n阅读足迹表\nCREATE TABLE `reading_footprints` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',\n  `user_id` int(11) NOT NULL COMMENT 'acct.member.id',\n  `udid` varchar(255) COLLATE utf8_unicode_ci NOT NULL COMMENT '设备ID iOS IDFA， Android IMEI',\n  `source_id` int(11) DEFAULT NULL COMMENT '数据源ID',\n  `column_id` int(11) DEFAULT NULL COMMENT '栏目ID',\n  `object_id` int(11) NOT NULL COMMENT '目前只记录文章的阅读记录， article_id',\n  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '类型 0 文章',\n  `open_time` int(11) NOT NULL COMMENT '文章打开时间',\n  `close_time` int(11) NOT NULL COMMENT '文章关闭时间',\n  `non_breaking_days` int(11) NOT NULL DEFAULT '1' COMMENT '连续阅读天数',\n  `accumulated_reading_time` int(11) NOT NULL COMMENT '累计阅读时间，秒',\n  `created_at` timestamp NULL DEFAULT NULL,\n  `updated_at` timestamp NULL DEFAULT NULL,\n  `deleted_at` timestamp NULL DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=36 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='阅读足迹表';\n```\n\n例如：需要显示的一个数据是用户今天阅读了几篇文章，原生sql 语句是这样的\n\n```\nselect distinct object_id from reading_footprints where user_id=237475 and open_time between 1499356800 and 1499443200\n\n// 或者\nselect object_id from reading_footprints where user_id=237475 and open_time between 1489356800 and 1499443200 group by object_id\n```\n\n其中，时间戳在[这里](https://unixtime.51240.com/)查询。项目中，使用 Carbon 类获取。\n\n```\n$todayStart = Carbon::today()->timestamp;\n$todayEnd = Carbon::tomorrow()->timestamp;\n```\n\n但这样的sql 语句只能获取到其中一个字段，或者时聚合函数的结果。\n\nLaravel 中 ORM 方式写法见下一个问题。\n\n\n## 2. 分组取最大\n\n还是上面的阅读足迹问题，其中每一条记录中都有累计阅读天数和累计阅读时间的字段，所以对于文章去重的时候需要取出每篇文章的最后一条，即按文章id分组后还要取出每个分组中累计阅读时间最大的一条。\n\n实现方法有好几种，基本思路都是先按文章id分组并取出最大的记录id或累计阅读时间等有限个字段（分组或去重时不能取出无关字段），然后再进行自连接关联查询或子查询。\n\n```\n原生sql\nselect a.* from reading_footprints a inner join\n(select object_id, max(accumulated_reading_time) accumulated_reading_time from reading_footprints group by object_id) b \non a.object_id = b.object_id and a.accumulated_reading_time = b.accumulated_reading_time order by close_time desc\n```\n\nLaravel ORM 中，先分组，后内连接\n\n```\n$sub = DB::table('reading_footprints')\n    ->select(DB::raw('max(accumulated_reading_time) accumulated_reading_time'), 'object_id')\n    ->groupBy('object_id');\n\n$readingFootprints = DB::table('reading_footprints as a')\n    ->select('a.*')\n    ->join(DB::raw(\"({$sub->toSql()}) as b\"), function ($join) {\n        $join->on('a.accumulated_reading_time', '=', 'b.accumulated_reading_time');\n        $join->on('a.object_id', '=', 'b.object_id');\n    })\n    ->orderBy('close_time', 'desc')->get();\n```\n\n抽象到 BaseRepositoryEloquent.php 中\n\n```\n/**\n * 单表分组取最大或最小 的数据\n * @param string $group_field\n * @param array $where\n * @param string $operate\n * @param string $operate_field\n * @param null $columns\n * User: Howard\n * Date: 2017-07-07\n * @return Collection|null\n */\npublic function getDataByGroup($group_field, $where = [], $operate = 'max', $operate_field = 'id', $columns = null)\n{\n\n    $data = null;\n    $ids = $this->getIdByGroup($group_field, $where, $operate, $operate_field);\n    if (!empty($ids)) {\n        $data = $this->findWhereIn($operate_field, $ids, $columns)->keyBy($group_field);\n    }\n    return $data;\n}\n\n\n/**\n * 单表分组取最大或最小 的ID\n * @param $group_field\n * @param array $where\n * @param string $operate\n * @param string $operate_field\n * User: Howard\n * Date: 2017-07-07\n * @return array\n */\npublic function getIdByGroup($group_field, $where = [], $operate = 'max', $operate_field = 'id')\n{\n    $ids = [];\n    if (empty($where)) {\n        $self = $this;\n    } else {\n        $self = $this->whereWithParams($where);\n    }\n    $selfModel = $self->model->groupBy($group_field);\n    $select = sprintf('%s(`%s`) as `%s`', strtolower($operate), $operate_field, $operate_field);\n    $selfModel = $selfModel->select(DB::raw($select));\n    $result = $selfModel->get();\n\n    $this->resetModel();\n    $this->resetCriteria();\n    $this->resetScope();\n\n    if (!is_empty($result)) {\n        $ids = array_pluck($result, $operate_field);\n    }\n\n    return $ids;\n}\n```\n\n\n## 3. 按时间二次分组\n\n阅读足迹显示规则：日期1：[文章1；文章2]；日期2：[文章3；]... 即数据取出后为一维数组，再按关闭日期包成二维数组。\n\n```\nforeach ($footprints as $item) {\n    if (isset($returnFootprints[$item->close_date])) {\n        array_push($returnFootprints[$item->close_date], $footprint);\n    } else {\n        $returnFootprints[$item->close_date] = [$footprint];\n    }\n}\n```\n\n\n## 4. 评论盖楼\n\n首先取出所有符合条件的评论，形成一个一维数组，然后进行处理（慢慢理解）\n\n```\n/**\n * 转换评论数据\n * @param $comment_info\n * @param $recursion\n * User: Howard\n * Date: 2017-06-08\n * @return array|map\n */\npublic function convertData4List($comment_info, $recursion = false)\n{\n    if ($comment_info instanceof Comment) {\n        if (!is_empty($comment_info)) {\n            $sc = new \\stdClass();\n        } else {\n            $sc = $this->dealSingle($comment_info, $recursion);\n        }\n    } else {\n        if (!is_empty($comment_info)) {\n            $sc = [];\n        }\n        foreach ($comment_info as $index => $item) {\n            $sc[] = $this->dealSingle($item, $recursion);\n        }\n    }\n    return $sc;\n}\n\n/**\n * 处理单个评论 递归\n * @param $comment\n * @param $recursion\n * User: Howard\n * Date: 2017-06-08\n * @return array\n */\nprotected function dealSingle($comment, $recursion = false)\n{\n    $commentData = [\n        'id' => $comment->id,\n        'user_id' => $comment->uid,\n\n        'username' => empty($comment->uname) ? '财经网友' : $comment->uname,\n        'avatar' => '',\n        'article_id' => $comment->articleid,\n        'content' => $comment->content,\n        'create_time' => $comment->ctime,\n        'star_number' => rand(100,1000),\n        'parent' => new \\stdClass(),\n    ];\n//        dd($commentData);\n    if ($recursion && !empty($comment->parent)) {\n        // 递归调用\n        $commentData['parent'] = $this->dealSingle($comment->parent, $recursion);\n    }\n    return $commentData;\n}\n```\n\n\n","source":"_posts/Laravel-去重、分组取最大、按时间二次分组、评论盖楼等.md","raw":"---\ntitle: Laravel 去重、分组取最大、按时间二次分组、评论盖楼等\ndate: 2017-07-15 21:02:05\ntags: laravel\ncategories: laravel\n---\n\n最近公司项目中遇到的几个问题，记录一下\n\n## 1. 去重\n\n业务：从数据库中取出用户的阅读足迹，由于用户在一天之内可能多次阅读同一篇文章，数据表中对于同一天同一用户同一文章可能有多条记录，只是打开时间和关闭时间不同。取出用户阅读足迹的时间，需要对当天的阅读足迹去重。\n\n<!--more-->\n\n```\n阅读足迹表\nCREATE TABLE `reading_footprints` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'ID',\n  `user_id` int(11) NOT NULL COMMENT 'acct.member.id',\n  `udid` varchar(255) COLLATE utf8_unicode_ci NOT NULL COMMENT '设备ID iOS IDFA， Android IMEI',\n  `source_id` int(11) DEFAULT NULL COMMENT '数据源ID',\n  `column_id` int(11) DEFAULT NULL COMMENT '栏目ID',\n  `object_id` int(11) NOT NULL COMMENT '目前只记录文章的阅读记录， article_id',\n  `type` tinyint(4) NOT NULL DEFAULT '0' COMMENT '类型 0 文章',\n  `open_time` int(11) NOT NULL COMMENT '文章打开时间',\n  `close_time` int(11) NOT NULL COMMENT '文章关闭时间',\n  `non_breaking_days` int(11) NOT NULL DEFAULT '1' COMMENT '连续阅读天数',\n  `accumulated_reading_time` int(11) NOT NULL COMMENT '累计阅读时间，秒',\n  `created_at` timestamp NULL DEFAULT NULL,\n  `updated_at` timestamp NULL DEFAULT NULL,\n  `deleted_at` timestamp NULL DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=36 DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT='阅读足迹表';\n```\n\n例如：需要显示的一个数据是用户今天阅读了几篇文章，原生sql 语句是这样的\n\n```\nselect distinct object_id from reading_footprints where user_id=237475 and open_time between 1499356800 and 1499443200\n\n// 或者\nselect object_id from reading_footprints where user_id=237475 and open_time between 1489356800 and 1499443200 group by object_id\n```\n\n其中，时间戳在[这里](https://unixtime.51240.com/)查询。项目中，使用 Carbon 类获取。\n\n```\n$todayStart = Carbon::today()->timestamp;\n$todayEnd = Carbon::tomorrow()->timestamp;\n```\n\n但这样的sql 语句只能获取到其中一个字段，或者时聚合函数的结果。\n\nLaravel 中 ORM 方式写法见下一个问题。\n\n\n## 2. 分组取最大\n\n还是上面的阅读足迹问题，其中每一条记录中都有累计阅读天数和累计阅读时间的字段，所以对于文章去重的时候需要取出每篇文章的最后一条，即按文章id分组后还要取出每个分组中累计阅读时间最大的一条。\n\n实现方法有好几种，基本思路都是先按文章id分组并取出最大的记录id或累计阅读时间等有限个字段（分组或去重时不能取出无关字段），然后再进行自连接关联查询或子查询。\n\n```\n原生sql\nselect a.* from reading_footprints a inner join\n(select object_id, max(accumulated_reading_time) accumulated_reading_time from reading_footprints group by object_id) b \non a.object_id = b.object_id and a.accumulated_reading_time = b.accumulated_reading_time order by close_time desc\n```\n\nLaravel ORM 中，先分组，后内连接\n\n```\n$sub = DB::table('reading_footprints')\n    ->select(DB::raw('max(accumulated_reading_time) accumulated_reading_time'), 'object_id')\n    ->groupBy('object_id');\n\n$readingFootprints = DB::table('reading_footprints as a')\n    ->select('a.*')\n    ->join(DB::raw(\"({$sub->toSql()}) as b\"), function ($join) {\n        $join->on('a.accumulated_reading_time', '=', 'b.accumulated_reading_time');\n        $join->on('a.object_id', '=', 'b.object_id');\n    })\n    ->orderBy('close_time', 'desc')->get();\n```\n\n抽象到 BaseRepositoryEloquent.php 中\n\n```\n/**\n * 单表分组取最大或最小 的数据\n * @param string $group_field\n * @param array $where\n * @param string $operate\n * @param string $operate_field\n * @param null $columns\n * User: Howard\n * Date: 2017-07-07\n * @return Collection|null\n */\npublic function getDataByGroup($group_field, $where = [], $operate = 'max', $operate_field = 'id', $columns = null)\n{\n\n    $data = null;\n    $ids = $this->getIdByGroup($group_field, $where, $operate, $operate_field);\n    if (!empty($ids)) {\n        $data = $this->findWhereIn($operate_field, $ids, $columns)->keyBy($group_field);\n    }\n    return $data;\n}\n\n\n/**\n * 单表分组取最大或最小 的ID\n * @param $group_field\n * @param array $where\n * @param string $operate\n * @param string $operate_field\n * User: Howard\n * Date: 2017-07-07\n * @return array\n */\npublic function getIdByGroup($group_field, $where = [], $operate = 'max', $operate_field = 'id')\n{\n    $ids = [];\n    if (empty($where)) {\n        $self = $this;\n    } else {\n        $self = $this->whereWithParams($where);\n    }\n    $selfModel = $self->model->groupBy($group_field);\n    $select = sprintf('%s(`%s`) as `%s`', strtolower($operate), $operate_field, $operate_field);\n    $selfModel = $selfModel->select(DB::raw($select));\n    $result = $selfModel->get();\n\n    $this->resetModel();\n    $this->resetCriteria();\n    $this->resetScope();\n\n    if (!is_empty($result)) {\n        $ids = array_pluck($result, $operate_field);\n    }\n\n    return $ids;\n}\n```\n\n\n## 3. 按时间二次分组\n\n阅读足迹显示规则：日期1：[文章1；文章2]；日期2：[文章3；]... 即数据取出后为一维数组，再按关闭日期包成二维数组。\n\n```\nforeach ($footprints as $item) {\n    if (isset($returnFootprints[$item->close_date])) {\n        array_push($returnFootprints[$item->close_date], $footprint);\n    } else {\n        $returnFootprints[$item->close_date] = [$footprint];\n    }\n}\n```\n\n\n## 4. 评论盖楼\n\n首先取出所有符合条件的评论，形成一个一维数组，然后进行处理（慢慢理解）\n\n```\n/**\n * 转换评论数据\n * @param $comment_info\n * @param $recursion\n * User: Howard\n * Date: 2017-06-08\n * @return array|map\n */\npublic function convertData4List($comment_info, $recursion = false)\n{\n    if ($comment_info instanceof Comment) {\n        if (!is_empty($comment_info)) {\n            $sc = new \\stdClass();\n        } else {\n            $sc = $this->dealSingle($comment_info, $recursion);\n        }\n    } else {\n        if (!is_empty($comment_info)) {\n            $sc = [];\n        }\n        foreach ($comment_info as $index => $item) {\n            $sc[] = $this->dealSingle($item, $recursion);\n        }\n    }\n    return $sc;\n}\n\n/**\n * 处理单个评论 递归\n * @param $comment\n * @param $recursion\n * User: Howard\n * Date: 2017-06-08\n * @return array\n */\nprotected function dealSingle($comment, $recursion = false)\n{\n    $commentData = [\n        'id' => $comment->id,\n        'user_id' => $comment->uid,\n\n        'username' => empty($comment->uname) ? '财经网友' : $comment->uname,\n        'avatar' => '',\n        'article_id' => $comment->articleid,\n        'content' => $comment->content,\n        'create_time' => $comment->ctime,\n        'star_number' => rand(100,1000),\n        'parent' => new \\stdClass(),\n    ];\n//        dd($commentData);\n    if ($recursion && !empty($comment->parent)) {\n        // 递归调用\n        $commentData['parent'] = $this->dealSingle($comment->parent, $recursion);\n    }\n    return $commentData;\n}\n```\n\n\n","slug":"Laravel-去重、分组取最大、按时间二次分组、评论盖楼等","published":1,"updated":"2020-09-11T01:04:35.033Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7x000h6wo15yjwa0sr","content":"<p>最近公司项目中遇到的几个问题，记录一下</p>\n<h2 id=\"1-去重\"><a href=\"#1-去重\" class=\"headerlink\" title=\"1. 去重\"></a>1. 去重</h2><p>业务：从数据库中取出用户的阅读足迹，由于用户在一天之内可能多次阅读同一篇文章，数据表中对于同一天同一用户同一文章可能有多条记录，只是打开时间和关闭时间不同。取出用户阅读足迹的时间，需要对当天的阅读足迹去重。</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">阅读足迹表</span><br><span class=\"line\">CREATE TABLE &#96;reading_footprints&#96; (</span><br><span class=\"line\">  &#96;id&#96; int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ID&#39;,</span><br><span class=\"line\">  &#96;user_id&#96; int(11) NOT NULL COMMENT &#39;acct.member.id&#39;,</span><br><span class=\"line\">  &#96;udid&#96; varchar(255) COLLATE utf8_unicode_ci NOT NULL COMMENT &#39;设备ID iOS IDFA， Android IMEI&#39;,</span><br><span class=\"line\">  &#96;source_id&#96; int(11) DEFAULT NULL COMMENT &#39;数据源ID&#39;,</span><br><span class=\"line\">  &#96;column_id&#96; int(11) DEFAULT NULL COMMENT &#39;栏目ID&#39;,</span><br><span class=\"line\">  &#96;object_id&#96; int(11) NOT NULL COMMENT &#39;目前只记录文章的阅读记录， article_id&#39;,</span><br><span class=\"line\">  &#96;type&#96; tinyint(4) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;类型 0 文章&#39;,</span><br><span class=\"line\">  &#96;open_time&#96; int(11) NOT NULL COMMENT &#39;文章打开时间&#39;,</span><br><span class=\"line\">  &#96;close_time&#96; int(11) NOT NULL COMMENT &#39;文章关闭时间&#39;,</span><br><span class=\"line\">  &#96;non_breaking_days&#96; int(11) NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;连续阅读天数&#39;,</span><br><span class=\"line\">  &#96;accumulated_reading_time&#96; int(11) NOT NULL COMMENT &#39;累计阅读时间，秒&#39;,</span><br><span class=\"line\">  &#96;created_at&#96; timestamp NULL DEFAULT NULL,</span><br><span class=\"line\">  &#96;updated_at&#96; timestamp NULL DEFAULT NULL,</span><br><span class=\"line\">  &#96;deleted_at&#96; timestamp NULL DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (&#96;id&#96;)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;36 DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_unicode_ci COMMENT&#x3D;&#39;阅读足迹表&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>例如：需要显示的一个数据是用户今天阅读了几篇文章，原生sql 语句是这样的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select distinct object_id from reading_footprints where user_id&#x3D;237475 and open_time between 1499356800 and 1499443200</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 或者</span><br><span class=\"line\">select object_id from reading_footprints where user_id&#x3D;237475 and open_time between 1489356800 and 1499443200 group by object_id</span><br></pre></td></tr></table></figure>\n\n<p>其中，时间戳在<a href=\"https://unixtime.51240.com/\">这里</a>查询。项目中，使用 Carbon 类获取。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$todayStart &#x3D; Carbon::today()-&gt;timestamp;</span><br><span class=\"line\">$todayEnd &#x3D; Carbon::tomorrow()-&gt;timestamp;</span><br></pre></td></tr></table></figure>\n\n<p>但这样的sql 语句只能获取到其中一个字段，或者时聚合函数的结果。</p>\n<p>Laravel 中 ORM 方式写法见下一个问题。</p>\n<h2 id=\"2-分组取最大\"><a href=\"#2-分组取最大\" class=\"headerlink\" title=\"2. 分组取最大\"></a>2. 分组取最大</h2><p>还是上面的阅读足迹问题，其中每一条记录中都有累计阅读天数和累计阅读时间的字段，所以对于文章去重的时候需要取出每篇文章的最后一条，即按文章id分组后还要取出每个分组中累计阅读时间最大的一条。</p>\n<p>实现方法有好几种，基本思路都是先按文章id分组并取出最大的记录id或累计阅读时间等有限个字段（分组或去重时不能取出无关字段），然后再进行自连接关联查询或子查询。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">原生sql</span><br><span class=\"line\">select a.* from reading_footprints a inner join</span><br><span class=\"line\">(select object_id, max(accumulated_reading_time) accumulated_reading_time from reading_footprints group by object_id) b </span><br><span class=\"line\">on a.object_id &#x3D; b.object_id and a.accumulated_reading_time &#x3D; b.accumulated_reading_time order by close_time desc</span><br></pre></td></tr></table></figure>\n\n<p>Laravel ORM 中，先分组，后内连接</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sub &#x3D; DB::table(&#39;reading_footprints&#39;)</span><br><span class=\"line\">    -&gt;select(DB::raw(&#39;max(accumulated_reading_time) accumulated_reading_time&#39;), &#39;object_id&#39;)</span><br><span class=\"line\">    -&gt;groupBy(&#39;object_id&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">$readingFootprints &#x3D; DB::table(&#39;reading_footprints as a&#39;)</span><br><span class=\"line\">    -&gt;select(&#39;a.*&#39;)</span><br><span class=\"line\">    -&gt;join(DB::raw(&quot;(&#123;$sub-&gt;toSql()&#125;) as b&quot;), function ($join) &#123;</span><br><span class=\"line\">        $join-&gt;on(&#39;a.accumulated_reading_time&#39;, &#39;&#x3D;&#39;, &#39;b.accumulated_reading_time&#39;);</span><br><span class=\"line\">        $join-&gt;on(&#39;a.object_id&#39;, &#39;&#x3D;&#39;, &#39;b.object_id&#39;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    -&gt;orderBy(&#39;close_time&#39;, &#39;desc&#39;)-&gt;get();</span><br></pre></td></tr></table></figure>\n\n<p>抽象到 BaseRepositoryEloquent.php 中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 单表分组取最大或最小 的数据</span><br><span class=\"line\"> * @param string $group_field</span><br><span class=\"line\"> * @param array $where</span><br><span class=\"line\"> * @param string $operate</span><br><span class=\"line\"> * @param string $operate_field</span><br><span class=\"line\"> * @param null $columns</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-07-07</span><br><span class=\"line\"> * @return Collection|null</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function getDataByGroup($group_field, $where &#x3D; [], $operate &#x3D; &#39;max&#39;, $operate_field &#x3D; &#39;id&#39;, $columns &#x3D; null)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $data &#x3D; null;</span><br><span class=\"line\">    $ids &#x3D; $this-&gt;getIdByGroup($group_field, $where, $operate, $operate_field);</span><br><span class=\"line\">    if (!empty($ids)) &#123;</span><br><span class=\"line\">        $data &#x3D; $this-&gt;findWhereIn($operate_field, $ids, $columns)-&gt;keyBy($group_field);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $data;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 单表分组取最大或最小 的ID</span><br><span class=\"line\"> * @param $group_field</span><br><span class=\"line\"> * @param array $where</span><br><span class=\"line\"> * @param string $operate</span><br><span class=\"line\"> * @param string $operate_field</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-07-07</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function getIdByGroup($group_field, $where &#x3D; [], $operate &#x3D; &#39;max&#39;, $operate_field &#x3D; &#39;id&#39;)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $ids &#x3D; [];</span><br><span class=\"line\">    if (empty($where)) &#123;</span><br><span class=\"line\">        $self &#x3D; $this;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $self &#x3D; $this-&gt;whereWithParams($where);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $selfModel &#x3D; $self-&gt;model-&gt;groupBy($group_field);</span><br><span class=\"line\">    $select &#x3D; sprintf(&#39;%s(&#96;%s&#96;) as &#96;%s&#96;&#39;, strtolower($operate), $operate_field, $operate_field);</span><br><span class=\"line\">    $selfModel &#x3D; $selfModel-&gt;select(DB::raw($select));</span><br><span class=\"line\">    $result &#x3D; $selfModel-&gt;get();</span><br><span class=\"line\"></span><br><span class=\"line\">    $this-&gt;resetModel();</span><br><span class=\"line\">    $this-&gt;resetCriteria();</span><br><span class=\"line\">    $this-&gt;resetScope();</span><br><span class=\"line\"></span><br><span class=\"line\">    if (!is_empty($result)) &#123;</span><br><span class=\"line\">        $ids &#x3D; array_pluck($result, $operate_field);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $ids;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"3-按时间二次分组\"><a href=\"#3-按时间二次分组\" class=\"headerlink\" title=\"3. 按时间二次分组\"></a>3. 按时间二次分组</h2><p>阅读足迹显示规则：日期1：[文章1；文章2]；日期2：[文章3；]… 即数据取出后为一维数组，再按关闭日期包成二维数组。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">foreach ($footprints as $item) &#123;</span><br><span class=\"line\">    if (isset($returnFootprints[$item-&gt;close_date])) &#123;</span><br><span class=\"line\">        array_push($returnFootprints[$item-&gt;close_date], $footprint);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $returnFootprints[$item-&gt;close_date] &#x3D; [$footprint];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"4-评论盖楼\"><a href=\"#4-评论盖楼\" class=\"headerlink\" title=\"4. 评论盖楼\"></a>4. 评论盖楼</h2><p>首先取出所有符合条件的评论，形成一个一维数组，然后进行处理（慢慢理解）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 转换评论数据</span><br><span class=\"line\"> * @param $comment_info</span><br><span class=\"line\"> * @param $recursion</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-06-08</span><br><span class=\"line\"> * @return array|map</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function convertData4List($comment_info, $recursion &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if ($comment_info instanceof Comment) &#123;</span><br><span class=\"line\">        if (!is_empty($comment_info)) &#123;</span><br><span class=\"line\">            $sc &#x3D; new \\stdClass();</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $sc &#x3D; $this-&gt;dealSingle($comment_info, $recursion);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        if (!is_empty($comment_info)) &#123;</span><br><span class=\"line\">            $sc &#x3D; [];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        foreach ($comment_info as $index &#x3D;&gt; $item) &#123;</span><br><span class=\"line\">            $sc[] &#x3D; $this-&gt;dealSingle($item, $recursion);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $sc;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 处理单个评论 递归</span><br><span class=\"line\"> * @param $comment</span><br><span class=\"line\"> * @param $recursion</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-06-08</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">protected function dealSingle($comment, $recursion &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $commentData &#x3D; [</span><br><span class=\"line\">        &#39;id&#39; &#x3D;&gt; $comment-&gt;id,</span><br><span class=\"line\">        &#39;user_id&#39; &#x3D;&gt; $comment-&gt;uid,</span><br><span class=\"line\"></span><br><span class=\"line\">        &#39;username&#39; &#x3D;&gt; empty($comment-&gt;uname) ? &#39;财经网友&#39; : $comment-&gt;uname,</span><br><span class=\"line\">        &#39;avatar&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">        &#39;article_id&#39; &#x3D;&gt; $comment-&gt;articleid,</span><br><span class=\"line\">        &#39;content&#39; &#x3D;&gt; $comment-&gt;content,</span><br><span class=\"line\">        &#39;create_time&#39; &#x3D;&gt; $comment-&gt;ctime,</span><br><span class=\"line\">        &#39;star_number&#39; &#x3D;&gt; rand(100,1000),</span><br><span class=\"line\">        &#39;parent&#39; &#x3D;&gt; new \\stdClass(),</span><br><span class=\"line\">    ];</span><br><span class=\"line\">&#x2F;&#x2F;        dd($commentData);</span><br><span class=\"line\">    if ($recursion &amp;&amp; !empty($comment-&gt;parent)) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; 递归调用</span><br><span class=\"line\">        $commentData[&#39;parent&#39;] &#x3D; $this-&gt;dealSingle($comment-&gt;parent, $recursion);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $commentData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p>最近公司项目中遇到的几个问题，记录一下</p>\n<h2 id=\"1-去重\"><a href=\"#1-去重\" class=\"headerlink\" title=\"1. 去重\"></a>1. 去重</h2><p>业务：从数据库中取出用户的阅读足迹，由于用户在一天之内可能多次阅读同一篇文章，数据表中对于同一天同一用户同一文章可能有多条记录，只是打开时间和关闭时间不同。取出用户阅读足迹的时间，需要对当天的阅读足迹去重。</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">阅读足迹表</span><br><span class=\"line\">CREATE TABLE &#96;reading_footprints&#96; (</span><br><span class=\"line\">  &#96;id&#96; int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;ID&#39;,</span><br><span class=\"line\">  &#96;user_id&#96; int(11) NOT NULL COMMENT &#39;acct.member.id&#39;,</span><br><span class=\"line\">  &#96;udid&#96; varchar(255) COLLATE utf8_unicode_ci NOT NULL COMMENT &#39;设备ID iOS IDFA， Android IMEI&#39;,</span><br><span class=\"line\">  &#96;source_id&#96; int(11) DEFAULT NULL COMMENT &#39;数据源ID&#39;,</span><br><span class=\"line\">  &#96;column_id&#96; int(11) DEFAULT NULL COMMENT &#39;栏目ID&#39;,</span><br><span class=\"line\">  &#96;object_id&#96; int(11) NOT NULL COMMENT &#39;目前只记录文章的阅读记录， article_id&#39;,</span><br><span class=\"line\">  &#96;type&#96; tinyint(4) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;类型 0 文章&#39;,</span><br><span class=\"line\">  &#96;open_time&#96; int(11) NOT NULL COMMENT &#39;文章打开时间&#39;,</span><br><span class=\"line\">  &#96;close_time&#96; int(11) NOT NULL COMMENT &#39;文章关闭时间&#39;,</span><br><span class=\"line\">  &#96;non_breaking_days&#96; int(11) NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;连续阅读天数&#39;,</span><br><span class=\"line\">  &#96;accumulated_reading_time&#96; int(11) NOT NULL COMMENT &#39;累计阅读时间，秒&#39;,</span><br><span class=\"line\">  &#96;created_at&#96; timestamp NULL DEFAULT NULL,</span><br><span class=\"line\">  &#96;updated_at&#96; timestamp NULL DEFAULT NULL,</span><br><span class=\"line\">  &#96;deleted_at&#96; timestamp NULL DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (&#96;id&#96;)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;36 DEFAULT CHARSET&#x3D;utf8 COLLATE&#x3D;utf8_unicode_ci COMMENT&#x3D;&#39;阅读足迹表&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>例如：需要显示的一个数据是用户今天阅读了几篇文章，原生sql 语句是这样的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select distinct object_id from reading_footprints where user_id&#x3D;237475 and open_time between 1499356800 and 1499443200</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; 或者</span><br><span class=\"line\">select object_id from reading_footprints where user_id&#x3D;237475 and open_time between 1489356800 and 1499443200 group by object_id</span><br></pre></td></tr></table></figure>\n\n<p>其中，时间戳在<a href=\"https://unixtime.51240.com/\">这里</a>查询。项目中，使用 Carbon 类获取。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$todayStart &#x3D; Carbon::today()-&gt;timestamp;</span><br><span class=\"line\">$todayEnd &#x3D; Carbon::tomorrow()-&gt;timestamp;</span><br></pre></td></tr></table></figure>\n\n<p>但这样的sql 语句只能获取到其中一个字段，或者时聚合函数的结果。</p>\n<p>Laravel 中 ORM 方式写法见下一个问题。</p>\n<h2 id=\"2-分组取最大\"><a href=\"#2-分组取最大\" class=\"headerlink\" title=\"2. 分组取最大\"></a>2. 分组取最大</h2><p>还是上面的阅读足迹问题，其中每一条记录中都有累计阅读天数和累计阅读时间的字段，所以对于文章去重的时候需要取出每篇文章的最后一条，即按文章id分组后还要取出每个分组中累计阅读时间最大的一条。</p>\n<p>实现方法有好几种，基本思路都是先按文章id分组并取出最大的记录id或累计阅读时间等有限个字段（分组或去重时不能取出无关字段），然后再进行自连接关联查询或子查询。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">原生sql</span><br><span class=\"line\">select a.* from reading_footprints a inner join</span><br><span class=\"line\">(select object_id, max(accumulated_reading_time) accumulated_reading_time from reading_footprints group by object_id) b </span><br><span class=\"line\">on a.object_id &#x3D; b.object_id and a.accumulated_reading_time &#x3D; b.accumulated_reading_time order by close_time desc</span><br></pre></td></tr></table></figure>\n\n<p>Laravel ORM 中，先分组，后内连接</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$sub &#x3D; DB::table(&#39;reading_footprints&#39;)</span><br><span class=\"line\">    -&gt;select(DB::raw(&#39;max(accumulated_reading_time) accumulated_reading_time&#39;), &#39;object_id&#39;)</span><br><span class=\"line\">    -&gt;groupBy(&#39;object_id&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">$readingFootprints &#x3D; DB::table(&#39;reading_footprints as a&#39;)</span><br><span class=\"line\">    -&gt;select(&#39;a.*&#39;)</span><br><span class=\"line\">    -&gt;join(DB::raw(&quot;(&#123;$sub-&gt;toSql()&#125;) as b&quot;), function ($join) &#123;</span><br><span class=\"line\">        $join-&gt;on(&#39;a.accumulated_reading_time&#39;, &#39;&#x3D;&#39;, &#39;b.accumulated_reading_time&#39;);</span><br><span class=\"line\">        $join-&gt;on(&#39;a.object_id&#39;, &#39;&#x3D;&#39;, &#39;b.object_id&#39;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    -&gt;orderBy(&#39;close_time&#39;, &#39;desc&#39;)-&gt;get();</span><br></pre></td></tr></table></figure>\n\n<p>抽象到 BaseRepositoryEloquent.php 中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 单表分组取最大或最小 的数据</span><br><span class=\"line\"> * @param string $group_field</span><br><span class=\"line\"> * @param array $where</span><br><span class=\"line\"> * @param string $operate</span><br><span class=\"line\"> * @param string $operate_field</span><br><span class=\"line\"> * @param null $columns</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-07-07</span><br><span class=\"line\"> * @return Collection|null</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function getDataByGroup($group_field, $where &#x3D; [], $operate &#x3D; &#39;max&#39;, $operate_field &#x3D; &#39;id&#39;, $columns &#x3D; null)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    $data &#x3D; null;</span><br><span class=\"line\">    $ids &#x3D; $this-&gt;getIdByGroup($group_field, $where, $operate, $operate_field);</span><br><span class=\"line\">    if (!empty($ids)) &#123;</span><br><span class=\"line\">        $data &#x3D; $this-&gt;findWhereIn($operate_field, $ids, $columns)-&gt;keyBy($group_field);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $data;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 单表分组取最大或最小 的ID</span><br><span class=\"line\"> * @param $group_field</span><br><span class=\"line\"> * @param array $where</span><br><span class=\"line\"> * @param string $operate</span><br><span class=\"line\"> * @param string $operate_field</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-07-07</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function getIdByGroup($group_field, $where &#x3D; [], $operate &#x3D; &#39;max&#39;, $operate_field &#x3D; &#39;id&#39;)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $ids &#x3D; [];</span><br><span class=\"line\">    if (empty($where)) &#123;</span><br><span class=\"line\">        $self &#x3D; $this;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $self &#x3D; $this-&gt;whereWithParams($where);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $selfModel &#x3D; $self-&gt;model-&gt;groupBy($group_field);</span><br><span class=\"line\">    $select &#x3D; sprintf(&#39;%s(&#96;%s&#96;) as &#96;%s&#96;&#39;, strtolower($operate), $operate_field, $operate_field);</span><br><span class=\"line\">    $selfModel &#x3D; $selfModel-&gt;select(DB::raw($select));</span><br><span class=\"line\">    $result &#x3D; $selfModel-&gt;get();</span><br><span class=\"line\"></span><br><span class=\"line\">    $this-&gt;resetModel();</span><br><span class=\"line\">    $this-&gt;resetCriteria();</span><br><span class=\"line\">    $this-&gt;resetScope();</span><br><span class=\"line\"></span><br><span class=\"line\">    if (!is_empty($result)) &#123;</span><br><span class=\"line\">        $ids &#x3D; array_pluck($result, $operate_field);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $ids;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"3-按时间二次分组\"><a href=\"#3-按时间二次分组\" class=\"headerlink\" title=\"3. 按时间二次分组\"></a>3. 按时间二次分组</h2><p>阅读足迹显示规则：日期1：[文章1；文章2]；日期2：[文章3；]… 即数据取出后为一维数组，再按关闭日期包成二维数组。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">foreach ($footprints as $item) &#123;</span><br><span class=\"line\">    if (isset($returnFootprints[$item-&gt;close_date])) &#123;</span><br><span class=\"line\">        array_push($returnFootprints[$item-&gt;close_date], $footprint);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $returnFootprints[$item-&gt;close_date] &#x3D; [$footprint];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"4-评论盖楼\"><a href=\"#4-评论盖楼\" class=\"headerlink\" title=\"4. 评论盖楼\"></a>4. 评论盖楼</h2><p>首先取出所有符合条件的评论，形成一个一维数组，然后进行处理（慢慢理解）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 转换评论数据</span><br><span class=\"line\"> * @param $comment_info</span><br><span class=\"line\"> * @param $recursion</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-06-08</span><br><span class=\"line\"> * @return array|map</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function convertData4List($comment_info, $recursion &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if ($comment_info instanceof Comment) &#123;</span><br><span class=\"line\">        if (!is_empty($comment_info)) &#123;</span><br><span class=\"line\">            $sc &#x3D; new \\stdClass();</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $sc &#x3D; $this-&gt;dealSingle($comment_info, $recursion);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        if (!is_empty($comment_info)) &#123;</span><br><span class=\"line\">            $sc &#x3D; [];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        foreach ($comment_info as $index &#x3D;&gt; $item) &#123;</span><br><span class=\"line\">            $sc[] &#x3D; $this-&gt;dealSingle($item, $recursion);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $sc;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 处理单个评论 递归</span><br><span class=\"line\"> * @param $comment</span><br><span class=\"line\"> * @param $recursion</span><br><span class=\"line\"> * User: Howard</span><br><span class=\"line\"> * Date: 2017-06-08</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">protected function dealSingle($comment, $recursion &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $commentData &#x3D; [</span><br><span class=\"line\">        &#39;id&#39; &#x3D;&gt; $comment-&gt;id,</span><br><span class=\"line\">        &#39;user_id&#39; &#x3D;&gt; $comment-&gt;uid,</span><br><span class=\"line\"></span><br><span class=\"line\">        &#39;username&#39; &#x3D;&gt; empty($comment-&gt;uname) ? &#39;财经网友&#39; : $comment-&gt;uname,</span><br><span class=\"line\">        &#39;avatar&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">        &#39;article_id&#39; &#x3D;&gt; $comment-&gt;articleid,</span><br><span class=\"line\">        &#39;content&#39; &#x3D;&gt; $comment-&gt;content,</span><br><span class=\"line\">        &#39;create_time&#39; &#x3D;&gt; $comment-&gt;ctime,</span><br><span class=\"line\">        &#39;star_number&#39; &#x3D;&gt; rand(100,1000),</span><br><span class=\"line\">        &#39;parent&#39; &#x3D;&gt; new \\stdClass(),</span><br><span class=\"line\">    ];</span><br><span class=\"line\">&#x2F;&#x2F;        dd($commentData);</span><br><span class=\"line\">    if ($recursion &amp;&amp; !empty($comment-&gt;parent)) &#123;</span><br><span class=\"line\">        &#x2F;&#x2F; 递归调用</span><br><span class=\"line\">        $commentData[&#39;parent&#39;] &#x3D; $this-&gt;dealSingle($comment-&gt;parent, $recursion);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $commentData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Laravel 项目中 远程把图片下载到本地","date":"2017-05-14T16:00:00.000Z","_content":"\n>如今，开发应用时，我们会从不断增多的大量专用组件中选择合适的。既然已经有了 [`guzzlehttp/guzzle` 组件](https://github.com/guzzle/guzzle)，为什么还要浪费时间自己编写处理HTTP请求和响应库呢？\n\n<!--more-->\n\n最近在做第三方登录，用户的头像处理成了一个问题。原来用户系统中的头像都是以文件的形式保存在我们自己的服务器中。\n\n第三方账号的头像是以 url 的形式传入后台，考虑先通过后台将图片下载在服务器，重命名后存表。这样就与之前的用户系统一致，不用改代码。\n\n\n## 安装 guzzle 组件\n\n安装 guzzle 组件需要先安装 composer\n\n```\n# Install Composer\ncurl -sS https://getcomposer.org/installer | php\n```\n使用 composer 安装 guzzle\n\n```\nphp composer.phar require guzzlehttp/guzzle\n# 或者\n composer require guzzlehttp/guzzle\n```\n\n## 用法\n\n[guzzle 文档](http://docs.guzzlephp.org/en/latest/#)\n\n命名空间中引入 guzzle 依赖\n\n```\nuse GuzzleHttp\\Client;\nuse GuzzleHttp\\Exception\\GuzzleException;\n```\n\n保存头像，这里使用 md5 加密 url 作为文件名，基本可以保证唯一性。后缀选择 jpg，不知道会不会引起问题，暂时先这么处理了。\n\n```\nif (!empty($avatar)) {\n    if (strpos($avatar, 'http://') === 0 || strpos($avatar, 'https://') === 0) {\n        $client = new Client(['verify' => false]);  //忽略SSL错误\n        $path = APP_ROOT . config('common.picture_path.user_avatar_path') . md5($avatar) . '.jpg';\n        $response = $client->get($avatar, ['save_to' => $path]);  //保存远程url到文件\n        if ($response->getStatusCode() == 200) {\n            $avatar = md5($avatar) . '.jpg';\n        }\n    }\n}\n```\n\n将生成后的文件名入库即可。\n\n\n\n\n","source":"_posts/Laravel-项目中-远程把图片下载到本地.md","raw":"---\ntitle: Laravel 项目中 远程把图片下载到本地\ndate: 2017-05-15\ntags: Laravel\ncategories: Laravel\n---\n\n>如今，开发应用时，我们会从不断增多的大量专用组件中选择合适的。既然已经有了 [`guzzlehttp/guzzle` 组件](https://github.com/guzzle/guzzle)，为什么还要浪费时间自己编写处理HTTP请求和响应库呢？\n\n<!--more-->\n\n最近在做第三方登录，用户的头像处理成了一个问题。原来用户系统中的头像都是以文件的形式保存在我们自己的服务器中。\n\n第三方账号的头像是以 url 的形式传入后台，考虑先通过后台将图片下载在服务器，重命名后存表。这样就与之前的用户系统一致，不用改代码。\n\n\n## 安装 guzzle 组件\n\n安装 guzzle 组件需要先安装 composer\n\n```\n# Install Composer\ncurl -sS https://getcomposer.org/installer | php\n```\n使用 composer 安装 guzzle\n\n```\nphp composer.phar require guzzlehttp/guzzle\n# 或者\n composer require guzzlehttp/guzzle\n```\n\n## 用法\n\n[guzzle 文档](http://docs.guzzlephp.org/en/latest/#)\n\n命名空间中引入 guzzle 依赖\n\n```\nuse GuzzleHttp\\Client;\nuse GuzzleHttp\\Exception\\GuzzleException;\n```\n\n保存头像，这里使用 md5 加密 url 作为文件名，基本可以保证唯一性。后缀选择 jpg，不知道会不会引起问题，暂时先这么处理了。\n\n```\nif (!empty($avatar)) {\n    if (strpos($avatar, 'http://') === 0 || strpos($avatar, 'https://') === 0) {\n        $client = new Client(['verify' => false]);  //忽略SSL错误\n        $path = APP_ROOT . config('common.picture_path.user_avatar_path') . md5($avatar) . '.jpg';\n        $response = $client->get($avatar, ['save_to' => $path]);  //保存远程url到文件\n        if ($response->getStatusCode() == 200) {\n            $avatar = md5($avatar) . '.jpg';\n        }\n    }\n}\n```\n\n将生成后的文件名入库即可。\n\n\n\n\n","slug":"Laravel-项目中-远程把图片下载到本地","published":1,"updated":"2020-09-11T01:04:35.033Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz7z000k6wo1hdu9awrq","content":"<blockquote>\n<p>如今，开发应用时，我们会从不断增多的大量专用组件中选择合适的。既然已经有了 <a href=\"https://github.com/guzzle/guzzle\"><code>guzzlehttp/guzzle</code> 组件</a>，为什么还要浪费时间自己编写处理HTTP请求和响应库呢？</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p>最近在做第三方登录，用户的头像处理成了一个问题。原来用户系统中的头像都是以文件的形式保存在我们自己的服务器中。</p>\n<p>第三方账号的头像是以 url 的形式传入后台，考虑先通过后台将图片下载在服务器，重命名后存表。这样就与之前的用户系统一致，不用改代码。</p>\n<h2 id=\"安装-guzzle-组件\"><a href=\"#安装-guzzle-组件\" class=\"headerlink\" title=\"安装 guzzle 组件\"></a>安装 guzzle 组件</h2><p>安装 guzzle 组件需要先安装 composer</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Install Composer</span><br><span class=\"line\">curl -sS https:&#x2F;&#x2F;getcomposer.org&#x2F;installer | php</span><br></pre></td></tr></table></figure>\n<p>使用 composer 安装 guzzle</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php composer.phar require guzzlehttp&#x2F;guzzle</span><br><span class=\"line\"># 或者</span><br><span class=\"line\"> composer require guzzlehttp&#x2F;guzzle</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h2><p><a href=\"http://docs.guzzlephp.org/en/latest/#\">guzzle 文档</a></p>\n<p>命名空间中引入 guzzle 依赖</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use GuzzleHttp\\Client;</span><br><span class=\"line\">use GuzzleHttp\\Exception\\GuzzleException;</span><br></pre></td></tr></table></figure>\n\n<p>保存头像，这里使用 md5 加密 url 作为文件名，基本可以保证唯一性。后缀选择 jpg，不知道会不会引起问题，暂时先这么处理了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!empty($avatar)) &#123;</span><br><span class=\"line\">    if (strpos($avatar, &#39;http:&#x2F;&#x2F;&#39;) &#x3D;&#x3D;&#x3D; 0 || strpos($avatar, &#39;https:&#x2F;&#x2F;&#39;) &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">        $client &#x3D; new Client([&#39;verify&#39; &#x3D;&gt; false]);  &#x2F;&#x2F;忽略SSL错误</span><br><span class=\"line\">        $path &#x3D; APP_ROOT . config(&#39;common.picture_path.user_avatar_path&#39;) . md5($avatar) . &#39;.jpg&#39;;</span><br><span class=\"line\">        $response &#x3D; $client-&gt;get($avatar, [&#39;save_to&#39; &#x3D;&gt; $path]);  &#x2F;&#x2F;保存远程url到文件</span><br><span class=\"line\">        if ($response-&gt;getStatusCode() &#x3D;&#x3D; 200) &#123;</span><br><span class=\"line\">            $avatar &#x3D; md5($avatar) . &#39;.jpg&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将生成后的文件名入库即可。</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>如今，开发应用时，我们会从不断增多的大量专用组件中选择合适的。既然已经有了 <a href=\"https://github.com/guzzle/guzzle\"><code>guzzlehttp/guzzle</code> 组件</a>，为什么还要浪费时间自己编写处理HTTP请求和响应库呢？</p>\n</blockquote>","more":"<p>最近在做第三方登录，用户的头像处理成了一个问题。原来用户系统中的头像都是以文件的形式保存在我们自己的服务器中。</p>\n<p>第三方账号的头像是以 url 的形式传入后台，考虑先通过后台将图片下载在服务器，重命名后存表。这样就与之前的用户系统一致，不用改代码。</p>\n<h2 id=\"安装-guzzle-组件\"><a href=\"#安装-guzzle-组件\" class=\"headerlink\" title=\"安装 guzzle 组件\"></a>安装 guzzle 组件</h2><p>安装 guzzle 组件需要先安装 composer</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Install Composer</span><br><span class=\"line\">curl -sS https:&#x2F;&#x2F;getcomposer.org&#x2F;installer | php</span><br></pre></td></tr></table></figure>\n<p>使用 composer 安装 guzzle</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php composer.phar require guzzlehttp&#x2F;guzzle</span><br><span class=\"line\"># 或者</span><br><span class=\"line\"> composer require guzzlehttp&#x2F;guzzle</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"用法\"><a href=\"#用法\" class=\"headerlink\" title=\"用法\"></a>用法</h2><p><a href=\"http://docs.guzzlephp.org/en/latest/#\">guzzle 文档</a></p>\n<p>命名空间中引入 guzzle 依赖</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">use GuzzleHttp\\Client;</span><br><span class=\"line\">use GuzzleHttp\\Exception\\GuzzleException;</span><br></pre></td></tr></table></figure>\n\n<p>保存头像，这里使用 md5 加密 url 作为文件名，基本可以保证唯一性。后缀选择 jpg，不知道会不会引起问题，暂时先这么处理了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!empty($avatar)) &#123;</span><br><span class=\"line\">    if (strpos($avatar, &#39;http:&#x2F;&#x2F;&#39;) &#x3D;&#x3D;&#x3D; 0 || strpos($avatar, &#39;https:&#x2F;&#x2F;&#39;) &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">        $client &#x3D; new Client([&#39;verify&#39; &#x3D;&gt; false]);  &#x2F;&#x2F;忽略SSL错误</span><br><span class=\"line\">        $path &#x3D; APP_ROOT . config(&#39;common.picture_path.user_avatar_path&#39;) . md5($avatar) . &#39;.jpg&#39;;</span><br><span class=\"line\">        $response &#x3D; $client-&gt;get($avatar, [&#39;save_to&#39; &#x3D;&gt; $path]);  &#x2F;&#x2F;保存远程url到文件</span><br><span class=\"line\">        if ($response-&gt;getStatusCode() &#x3D;&#x3D; 200) &#123;</span><br><span class=\"line\">            $avatar &#x3D; md5($avatar) . &#39;.jpg&#39;;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将生成后的文件名入库即可。</p>"},{"title":"Linux 安装 http2 支持","date":"2017-01-16T16:00:00.000Z","description":"HTTP 2.0即超文本传输协议 2.0，是下一代HTTP协议.","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-ffa57dd27771a53c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n<!--more-->\n\n1. 前提：服务器中已有 git，如果没有，输入下面的命令安装\n    ```\n    sudo apt-get install -y tmux curl vim wget htop git\n    ```\n2. curl请求一个需使用 http2 的网址，查看响应结果，为http1.1，说明暂时还不支持http2\n    ```\n        vagrant@homestead:~$ curl -I https://nghttp2.org/\n    HTTP/1.1 200 OK\n    Date: Tue, 28 Mar 2017 04:58:27 GMT\n    Content-Type: text/html\n    Last-Modified: Mon, 27 Mar 2017 14:39:24 GMT\n    Etag: \"58d9241c-19ff\"\n    Accept-Ranges: bytes\n    Content-Length: 6655\n    X-Backend-Header-Rtt: 0.001072\n    Strict-Transport-Security: max-age=31536000\n    Server: nghttpx\n    Via: 2 nghttpx\n    x-frame-options: SAMEORIGIN\n    x-xss-protection: 1; mode=block\n    x-content-type-options: nosniff\n    ```\n    如果强制使用http2请求，无法得到响应\n    ```\n    vagrant@homestead:~$ curl --http2 -I https://nghttp2.org/\n    curl: (1) Unsupported protocol\n    ```\n3. 安装 nghttp2\n    ```\n    # Get build requirements\n    # Some of these are used for the Python bindings\n    # this package also installs\n    sudo apt-get install g++ make binutils autoconf automake autotools-dev libtool pkg-config \\\n    zlib1g-dev libcunit1-dev libssl-dev libxml2-dev       libev-dev libevent-dev libjansson-dev \\\n    libjemalloc-dev cython python3-dev python-setuptools\n    \n    # Build nghttp2 from source\n    git clone https://github.com/tatsuhiro-t/nghttp2.git\n    cd nghttp2\n    autoreconf -i\n    automake\n    autoconf\n    ./configure\n    make\n    sudo make install\n    ```\n4. 升级最新版的 curl，[这里](https://curl.haxx.se/download.html)查看curl版本\n    ```\n    cd ~\n    sudo apt-get build-dep curl\n    wget http://curl.haxx.se/download/curl-7.xx.0.tar.bz2\n    tar -xvjf curl-7.xx.0.tar.bz2\n    cd curl-7.xx.0\n    ./configure --with-nghttp2=/usr/local --with-ssl\n    make\n    sudo make install\n    sudo ldconfig\n    ```\n\n5. 尝试再次连接\n    ```\n    # Try this out first\n    curl --http2 -I nghttp2.org\n    \n    # If you get errors, try setting this constant\n    # to tell curl where to find shared libraries\n    LD_LIBRARY_PATH=/usr/local/lib /usr/local/bin/curl --http2 -I nghttp2.org\n    ```\n\n6. 连接\n    ```\n    vagrant@homestead:~/curl-7.xx.0$ LD_LIBRARY_PATH=/usr/local/lib /usr/local/bin/curl --http2 -k -I -H \"Host: example.com\" https://localhost\n    HTTP/2.0 403\n    server:nginx/1.11.9\n    date:Tue, 28 Mar 2017 05:47:10 GMT\n    content-type:text/html; charset=utf-8\n    content-length:169\n    ```\n7. 打印出phpinfo\ncurl 的http2 显示 yes，表示成功。否则需要手动安装php的http扩展。\n\n![](http://upload-images.jianshu.io/upload_images/693141-3e7fd6d43ffe52c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","source":"_posts/Linux-安装-http2-支持.md","raw":"---\ntitle: Linux 安装 http2 支持\ndate: 2017-01-17\ntags: http2\ndescription: HTTP 2.0即超文本传输协议 2.0，是下一代HTTP协议.\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-ffa57dd27771a53c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n<!--more-->\n\n1. 前提：服务器中已有 git，如果没有，输入下面的命令安装\n    ```\n    sudo apt-get install -y tmux curl vim wget htop git\n    ```\n2. curl请求一个需使用 http2 的网址，查看响应结果，为http1.1，说明暂时还不支持http2\n    ```\n        vagrant@homestead:~$ curl -I https://nghttp2.org/\n    HTTP/1.1 200 OK\n    Date: Tue, 28 Mar 2017 04:58:27 GMT\n    Content-Type: text/html\n    Last-Modified: Mon, 27 Mar 2017 14:39:24 GMT\n    Etag: \"58d9241c-19ff\"\n    Accept-Ranges: bytes\n    Content-Length: 6655\n    X-Backend-Header-Rtt: 0.001072\n    Strict-Transport-Security: max-age=31536000\n    Server: nghttpx\n    Via: 2 nghttpx\n    x-frame-options: SAMEORIGIN\n    x-xss-protection: 1; mode=block\n    x-content-type-options: nosniff\n    ```\n    如果强制使用http2请求，无法得到响应\n    ```\n    vagrant@homestead:~$ curl --http2 -I https://nghttp2.org/\n    curl: (1) Unsupported protocol\n    ```\n3. 安装 nghttp2\n    ```\n    # Get build requirements\n    # Some of these are used for the Python bindings\n    # this package also installs\n    sudo apt-get install g++ make binutils autoconf automake autotools-dev libtool pkg-config \\\n    zlib1g-dev libcunit1-dev libssl-dev libxml2-dev       libev-dev libevent-dev libjansson-dev \\\n    libjemalloc-dev cython python3-dev python-setuptools\n    \n    # Build nghttp2 from source\n    git clone https://github.com/tatsuhiro-t/nghttp2.git\n    cd nghttp2\n    autoreconf -i\n    automake\n    autoconf\n    ./configure\n    make\n    sudo make install\n    ```\n4. 升级最新版的 curl，[这里](https://curl.haxx.se/download.html)查看curl版本\n    ```\n    cd ~\n    sudo apt-get build-dep curl\n    wget http://curl.haxx.se/download/curl-7.xx.0.tar.bz2\n    tar -xvjf curl-7.xx.0.tar.bz2\n    cd curl-7.xx.0\n    ./configure --with-nghttp2=/usr/local --with-ssl\n    make\n    sudo make install\n    sudo ldconfig\n    ```\n\n5. 尝试再次连接\n    ```\n    # Try this out first\n    curl --http2 -I nghttp2.org\n    \n    # If you get errors, try setting this constant\n    # to tell curl where to find shared libraries\n    LD_LIBRARY_PATH=/usr/local/lib /usr/local/bin/curl --http2 -I nghttp2.org\n    ```\n\n6. 连接\n    ```\n    vagrant@homestead:~/curl-7.xx.0$ LD_LIBRARY_PATH=/usr/local/lib /usr/local/bin/curl --http2 -k -I -H \"Host: example.com\" https://localhost\n    HTTP/2.0 403\n    server:nginx/1.11.9\n    date:Tue, 28 Mar 2017 05:47:10 GMT\n    content-type:text/html; charset=utf-8\n    content-length:169\n    ```\n7. 打印出phpinfo\ncurl 的http2 显示 yes，表示成功。否则需要手动安装php的http扩展。\n\n![](http://upload-images.jianshu.io/upload_images/693141-3e7fd6d43ffe52c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","slug":"Linux-安装-http2-支持","published":1,"updated":"2020-09-11T01:04:35.034Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz81000n6wo1eznt7v7t","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-ffa57dd27771a53c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n\n<ol>\n<li><p>前提：服务器中已有 git，如果没有，输入下面的命令安装</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install -y tmux curl vim wget htop git</span><br></pre></td></tr></table></figure></li>\n<li><p>curl请求一个需使用 http2 的网址，查看响应结果，为http1.1，说明暂时还不支持http2</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    vagrant@homestead:~$ curl -I https:&#x2F;&#x2F;nghttp2.org&#x2F;</span><br><span class=\"line\">HTTP&#x2F;1.1 200 OK</span><br><span class=\"line\">Date: Tue, 28 Mar 2017 04:58:27 GMT</span><br><span class=\"line\">Content-Type: text&#x2F;html</span><br><span class=\"line\">Last-Modified: Mon, 27 Mar 2017 14:39:24 GMT</span><br><span class=\"line\">Etag: &quot;58d9241c-19ff&quot;</span><br><span class=\"line\">Accept-Ranges: bytes</span><br><span class=\"line\">Content-Length: 6655</span><br><span class=\"line\">X-Backend-Header-Rtt: 0.001072</span><br><span class=\"line\">Strict-Transport-Security: max-age&#x3D;31536000</span><br><span class=\"line\">Server: nghttpx</span><br><span class=\"line\">Via: 2 nghttpx</span><br><span class=\"line\">x-frame-options: SAMEORIGIN</span><br><span class=\"line\">x-xss-protection: 1; mode&#x3D;block</span><br><span class=\"line\">x-content-type-options: nosniff</span><br></pre></td></tr></table></figure>\n<p> 如果强制使用http2请求，无法得到响应</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~$ curl --http2 -I https:&#x2F;&#x2F;nghttp2.org&#x2F;</span><br><span class=\"line\">curl: (1) Unsupported protocol</span><br></pre></td></tr></table></figure></li>\n<li><p>安装 nghttp2</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Get build requirements</span><br><span class=\"line\"># Some of these are used for the Python bindings</span><br><span class=\"line\"># this package also installs</span><br><span class=\"line\">sudo apt-get install g++ make binutils autoconf automake autotools-dev libtool pkg-config \\</span><br><span class=\"line\">zlib1g-dev libcunit1-dev libssl-dev libxml2-dev       libev-dev libevent-dev libjansson-dev \\</span><br><span class=\"line\">libjemalloc-dev cython python3-dev python-setuptools</span><br><span class=\"line\"></span><br><span class=\"line\"># Build nghttp2 from source</span><br><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;tatsuhiro-t&#x2F;nghttp2.git</span><br><span class=\"line\">cd nghttp2</span><br><span class=\"line\">autoreconf -i</span><br><span class=\"line\">automake</span><br><span class=\"line\">autoconf</span><br><span class=\"line\">.&#x2F;configure</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure></li>\n<li><p>升级最新版的 curl，<a href=\"https://curl.haxx.se/download.html\">这里</a>查看curl版本</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">sudo apt-get build-dep curl</span><br><span class=\"line\">wget http:&#x2F;&#x2F;curl.haxx.se&#x2F;download&#x2F;curl-7.xx.0.tar.bz2</span><br><span class=\"line\">tar -xvjf curl-7.xx.0.tar.bz2</span><br><span class=\"line\">cd curl-7.xx.0</span><br><span class=\"line\">.&#x2F;configure --with-nghttp2&#x3D;&#x2F;usr&#x2F;local --with-ssl</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br><span class=\"line\">sudo ldconfig</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>尝试再次连接</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Try this out first</span><br><span class=\"line\">curl --http2 -I nghttp2.org</span><br><span class=\"line\"></span><br><span class=\"line\"># If you get errors, try setting this constant</span><br><span class=\"line\"># to tell curl where to find shared libraries</span><br><span class=\"line\">LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;lib &#x2F;usr&#x2F;local&#x2F;bin&#x2F;curl --http2 -I nghttp2.org</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>连接</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~&#x2F;curl-7.xx.0$ LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;lib &#x2F;usr&#x2F;local&#x2F;bin&#x2F;curl --http2 -k -I -H &quot;Host: example.com&quot; https:&#x2F;&#x2F;localhost</span><br><span class=\"line\">HTTP&#x2F;2.0 403</span><br><span class=\"line\">server:nginx&#x2F;1.11.9</span><br><span class=\"line\">date:Tue, 28 Mar 2017 05:47:10 GMT</span><br><span class=\"line\">content-type:text&#x2F;html; charset&#x3D;utf-8</span><br><span class=\"line\">content-length:169</span><br></pre></td></tr></table></figure></li>\n<li><p>打印出phpinfo<br>curl 的http2 显示 yes，表示成功。否则需要手动安装php的http扩展。</p>\n</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-3e7fd6d43ffe52c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-ffa57dd27771a53c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<ol>\n<li><p>前提：服务器中已有 git，如果没有，输入下面的命令安装</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install -y tmux curl vim wget htop git</span><br></pre></td></tr></table></figure></li>\n<li><p>curl请求一个需使用 http2 的网址，查看响应结果，为http1.1，说明暂时还不支持http2</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    vagrant@homestead:~$ curl -I https:&#x2F;&#x2F;nghttp2.org&#x2F;</span><br><span class=\"line\">HTTP&#x2F;1.1 200 OK</span><br><span class=\"line\">Date: Tue, 28 Mar 2017 04:58:27 GMT</span><br><span class=\"line\">Content-Type: text&#x2F;html</span><br><span class=\"line\">Last-Modified: Mon, 27 Mar 2017 14:39:24 GMT</span><br><span class=\"line\">Etag: &quot;58d9241c-19ff&quot;</span><br><span class=\"line\">Accept-Ranges: bytes</span><br><span class=\"line\">Content-Length: 6655</span><br><span class=\"line\">X-Backend-Header-Rtt: 0.001072</span><br><span class=\"line\">Strict-Transport-Security: max-age&#x3D;31536000</span><br><span class=\"line\">Server: nghttpx</span><br><span class=\"line\">Via: 2 nghttpx</span><br><span class=\"line\">x-frame-options: SAMEORIGIN</span><br><span class=\"line\">x-xss-protection: 1; mode&#x3D;block</span><br><span class=\"line\">x-content-type-options: nosniff</span><br></pre></td></tr></table></figure>\n<p> 如果强制使用http2请求，无法得到响应</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~$ curl --http2 -I https:&#x2F;&#x2F;nghttp2.org&#x2F;</span><br><span class=\"line\">curl: (1) Unsupported protocol</span><br></pre></td></tr></table></figure></li>\n<li><p>安装 nghttp2</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Get build requirements</span><br><span class=\"line\"># Some of these are used for the Python bindings</span><br><span class=\"line\"># this package also installs</span><br><span class=\"line\">sudo apt-get install g++ make binutils autoconf automake autotools-dev libtool pkg-config \\</span><br><span class=\"line\">zlib1g-dev libcunit1-dev libssl-dev libxml2-dev       libev-dev libevent-dev libjansson-dev \\</span><br><span class=\"line\">libjemalloc-dev cython python3-dev python-setuptools</span><br><span class=\"line\"></span><br><span class=\"line\"># Build nghttp2 from source</span><br><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;tatsuhiro-t&#x2F;nghttp2.git</span><br><span class=\"line\">cd nghttp2</span><br><span class=\"line\">autoreconf -i</span><br><span class=\"line\">automake</span><br><span class=\"line\">autoconf</span><br><span class=\"line\">.&#x2F;configure</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure></li>\n<li><p>升级最新版的 curl，<a href=\"https://curl.haxx.se/download.html\">这里</a>查看curl版本</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">sudo apt-get build-dep curl</span><br><span class=\"line\">wget http:&#x2F;&#x2F;curl.haxx.se&#x2F;download&#x2F;curl-7.xx.0.tar.bz2</span><br><span class=\"line\">tar -xvjf curl-7.xx.0.tar.bz2</span><br><span class=\"line\">cd curl-7.xx.0</span><br><span class=\"line\">.&#x2F;configure --with-nghttp2&#x3D;&#x2F;usr&#x2F;local --with-ssl</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br><span class=\"line\">sudo ldconfig</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>尝试再次连接</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Try this out first</span><br><span class=\"line\">curl --http2 -I nghttp2.org</span><br><span class=\"line\"></span><br><span class=\"line\"># If you get errors, try setting this constant</span><br><span class=\"line\"># to tell curl where to find shared libraries</span><br><span class=\"line\">LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;lib &#x2F;usr&#x2F;local&#x2F;bin&#x2F;curl --http2 -I nghttp2.org</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>连接</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~&#x2F;curl-7.xx.0$ LD_LIBRARY_PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;lib &#x2F;usr&#x2F;local&#x2F;bin&#x2F;curl --http2 -k -I -H &quot;Host: example.com&quot; https:&#x2F;&#x2F;localhost</span><br><span class=\"line\">HTTP&#x2F;2.0 403</span><br><span class=\"line\">server:nginx&#x2F;1.11.9</span><br><span class=\"line\">date:Tue, 28 Mar 2017 05:47:10 GMT</span><br><span class=\"line\">content-type:text&#x2F;html; charset&#x3D;utf-8</span><br><span class=\"line\">content-length:169</span><br></pre></td></tr></table></figure></li>\n<li><p>打印出phpinfo<br>curl 的http2 显示 yes，表示成功。否则需要手动安装php的http扩展。</p>\n</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-3e7fd6d43ffe52c2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>"},{"title":"Linux 懒人工具--autojump","date":"2017-04-09T16:00:00.000Z","description":"在终端的文件夹跳转非常麻烦, 需要敲长长的路径. alias 别名也不是很方便。autojump 是通过记录进入过的目录到数据库来实现的, 所以必须是曾经进入过的目录才能跳转.","_content":"\n![](http://omp48p40q.bkt.clouddn.com/17-4-14/72919152-file_1492142306461_3bfa.jpg)\n\n> 在终端的文件夹跳转非常麻烦, 需要敲长长的路径.\nalias 别名也不是很方便。\n[autojump](https://github.com/wting/autojump) 是通过记录进入过的目录到数据库来实现的, 所以必须是曾经进入过的目录才能跳转.\n\n<!--more-->\n\n## 1. 安装\n### 1. OS X\n\n推荐使用 Homebrew 安装 autojump\n\n```\nbrew install autojump\n```\n\nmacOS 启动 Shell 自动读取的文件有\n\n```\n/etc/profile\n~/.bash_profile\n~/.bash_login\n~/.profile\n```\n\n所以只需要在上面其中一个文件加上\n\n```\n[[ -s $(brew --prefix)/etc/profile.d/[autojump.sh](http://autojump.sh/) ]] && . $(brew --prefix)/etc/profile.d/[autojump.sh](http://autojump.sh/)\n```\n\n但如果终端工具使用的是 zsh，需要在`~/.zshrc`添加\n\n```\n[[ -s `brew --prefix`/etc/autojump.sh ]] && . `brew --prefix`/etc/autojump.sh\n```\n\n然后，运行 `source <sourcefile>`.\n\n### 2. Linux\n\n首先下载 autojump 源码\n\n```\ngit clone git://github.com/joelthelion/autojump.git\n```\n\n然后可安装或卸载\n```\ncd autojump\n./install.py or ./uninstall.py\n```\n\n由于Linux 下 Shell 启动会自动读取 ~/.bashrc 文件，所以将下面一行添加到该文件中\n\n```\n[[ -s ~/.autojump/etc/profile.d/autojump.sh ]] && . ~/.autojump/etc/profile.d/autojump.sh\n```\n\n然后，运行`source ~/.bashrc`即可。\n\n安装完成后，使用查看autojump版本。\n\n```\n$ autojump --version\nautojump release-v21.1.2\n```\n\n\n\n## 2. 用法\n\n只有打开过的目录 autojump 才会记录，所以使用时间越长，autojump 才会越智能。\n\n可以使用 `autojump` 命令，或者使用短命令 `j`.\n\n1. 跳转到指定目录\n\n    ```\n    j directoryName\n    ```\n    如果不知道目录全名，输入一部分，按Tab键就好，输错了也没关系，可以自动识别，非常强大。\n\n    ```\n    # j csm\n    /data/www/xxx/cms\n    ```\n\n    Tab 键效果\n  \n    ```\n    vagrant@homestead:~$ pwd\n    /home/vagrant\n    vagrant@homestead:~$ j --stat\n    10.0:\t/etc/nginx/conf.d\n    20.0:\t/home/vagrant/www/xxx/doc_api\n    34.6:\t/home/vagrant/www/xxx\n    40.0:\t/var/log/nginx\n    Total key weight: 104. Number of stored dirs: 4\n    vagrant@homestead:~$ j n__ (Tab 键自动添加了下划线)\n    /var/log/nginx\n    vagrant@homestead:/var/log/nginx$\n    ```\n\n2. 跳转到指定目录的子目录（Mac 下效果与`j`相同，Ubuntu下不好用）\n\n    ```\n    jc directoryName\n    ```\n    \n3. 使用系统工具（Mac Finder, Windows Explorer, GNOME, etc.）打开目录，类似Mac OS terminal 下的 `open` 命令，但`open` 命令需要指定路径（Mac中还算实用，Ubuntu下不好用）\n\n    ```\n    jo directoryName\n    ```\n\n4. 查看权重 `j --stat`\n\n    ```\n    $ j --stat\n    10.0:\t/etc/nginx/conf.d\n    10.0:\t/home/vagrant/www/caijing/doc_api\n    10.0:\t/var/log/nginx\n    30.0:\t/home/vagrant/www/caijing\n    Total key weight: 59. Number of stored dirs: 4\n    ```\n\n    权重越高，说明目录使用的越频繁。\n\n    感觉 Mac 中的显示效果更好，还可以自己去调整权重值。\n\n    ```\n    $ j --stat\n    10.0:\t/Users/xxx/xxx/xxxx/xxxx/xxxx/vendor\n    22.4:\t/Users/xxx/xxx/xxxx/xxxx/xxxx/log\n    \n    32:\t    total weight\n    2:\t     number of entries\n    10.00:\t current directory weight\n    \n    data:\t /Users/xxx/Library/autojump/autojump.txt\n    ```\n\n5. 其他\n    ```\n    autojump --help\n    ```\n\n\n","source":"_posts/Linux-懒人工具---autojump.md","raw":"---\ntitle: Linux 懒人工具--autojump\ndate: 2017-04-10\ntags: Linux\ncategories: Linux\ndescription: 在终端的文件夹跳转非常麻烦, 需要敲长长的路径. alias 别名也不是很方便。autojump 是通过记录进入过的目录到数据库来实现的, 所以必须是曾经进入过的目录才能跳转.\n---\n\n![](http://omp48p40q.bkt.clouddn.com/17-4-14/72919152-file_1492142306461_3bfa.jpg)\n\n> 在终端的文件夹跳转非常麻烦, 需要敲长长的路径.\nalias 别名也不是很方便。\n[autojump](https://github.com/wting/autojump) 是通过记录进入过的目录到数据库来实现的, 所以必须是曾经进入过的目录才能跳转.\n\n<!--more-->\n\n## 1. 安装\n### 1. OS X\n\n推荐使用 Homebrew 安装 autojump\n\n```\nbrew install autojump\n```\n\nmacOS 启动 Shell 自动读取的文件有\n\n```\n/etc/profile\n~/.bash_profile\n~/.bash_login\n~/.profile\n```\n\n所以只需要在上面其中一个文件加上\n\n```\n[[ -s $(brew --prefix)/etc/profile.d/[autojump.sh](http://autojump.sh/) ]] && . $(brew --prefix)/etc/profile.d/[autojump.sh](http://autojump.sh/)\n```\n\n但如果终端工具使用的是 zsh，需要在`~/.zshrc`添加\n\n```\n[[ -s `brew --prefix`/etc/autojump.sh ]] && . `brew --prefix`/etc/autojump.sh\n```\n\n然后，运行 `source <sourcefile>`.\n\n### 2. Linux\n\n首先下载 autojump 源码\n\n```\ngit clone git://github.com/joelthelion/autojump.git\n```\n\n然后可安装或卸载\n```\ncd autojump\n./install.py or ./uninstall.py\n```\n\n由于Linux 下 Shell 启动会自动读取 ~/.bashrc 文件，所以将下面一行添加到该文件中\n\n```\n[[ -s ~/.autojump/etc/profile.d/autojump.sh ]] && . ~/.autojump/etc/profile.d/autojump.sh\n```\n\n然后，运行`source ~/.bashrc`即可。\n\n安装完成后，使用查看autojump版本。\n\n```\n$ autojump --version\nautojump release-v21.1.2\n```\n\n\n\n## 2. 用法\n\n只有打开过的目录 autojump 才会记录，所以使用时间越长，autojump 才会越智能。\n\n可以使用 `autojump` 命令，或者使用短命令 `j`.\n\n1. 跳转到指定目录\n\n    ```\n    j directoryName\n    ```\n    如果不知道目录全名，输入一部分，按Tab键就好，输错了也没关系，可以自动识别，非常强大。\n\n    ```\n    # j csm\n    /data/www/xxx/cms\n    ```\n\n    Tab 键效果\n  \n    ```\n    vagrant@homestead:~$ pwd\n    /home/vagrant\n    vagrant@homestead:~$ j --stat\n    10.0:\t/etc/nginx/conf.d\n    20.0:\t/home/vagrant/www/xxx/doc_api\n    34.6:\t/home/vagrant/www/xxx\n    40.0:\t/var/log/nginx\n    Total key weight: 104. Number of stored dirs: 4\n    vagrant@homestead:~$ j n__ (Tab 键自动添加了下划线)\n    /var/log/nginx\n    vagrant@homestead:/var/log/nginx$\n    ```\n\n2. 跳转到指定目录的子目录（Mac 下效果与`j`相同，Ubuntu下不好用）\n\n    ```\n    jc directoryName\n    ```\n    \n3. 使用系统工具（Mac Finder, Windows Explorer, GNOME, etc.）打开目录，类似Mac OS terminal 下的 `open` 命令，但`open` 命令需要指定路径（Mac中还算实用，Ubuntu下不好用）\n\n    ```\n    jo directoryName\n    ```\n\n4. 查看权重 `j --stat`\n\n    ```\n    $ j --stat\n    10.0:\t/etc/nginx/conf.d\n    10.0:\t/home/vagrant/www/caijing/doc_api\n    10.0:\t/var/log/nginx\n    30.0:\t/home/vagrant/www/caijing\n    Total key weight: 59. Number of stored dirs: 4\n    ```\n\n    权重越高，说明目录使用的越频繁。\n\n    感觉 Mac 中的显示效果更好，还可以自己去调整权重值。\n\n    ```\n    $ j --stat\n    10.0:\t/Users/xxx/xxx/xxxx/xxxx/xxxx/vendor\n    22.4:\t/Users/xxx/xxx/xxxx/xxxx/xxxx/log\n    \n    32:\t    total weight\n    2:\t     number of entries\n    10.00:\t current directory weight\n    \n    data:\t /Users/xxx/Library/autojump/autojump.txt\n    ```\n\n5. 其他\n    ```\n    autojump --help\n    ```\n\n\n","slug":"Linux-懒人工具---autojump","published":1,"updated":"2020-09-11T01:04:35.035Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz82000p6wo1ecv1gz9g","content":"<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-4-14/72919152-file_1492142306461_3bfa.jpg\"></p>\n<blockquote>\n<p>在终端的文件夹跳转非常麻烦, 需要敲长长的路径.<br>alias 别名也不是很方便。<br><a href=\"https://github.com/wting/autojump\">autojump</a> 是通过记录进入过的目录到数据库来实现的, 所以必须是曾经进入过的目录才能跳转.</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><h3 id=\"1-OS-X\"><a href=\"#1-OS-X\" class=\"headerlink\" title=\"1. OS X\"></a>1. OS X</h3><p>推荐使用 Homebrew 安装 autojump</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install autojump</span><br></pre></td></tr></table></figure>\n\n<p>macOS 启动 Shell 自动读取的文件有</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;profile</span><br><span class=\"line\">~&#x2F;.bash_profile</span><br><span class=\"line\">~&#x2F;.bash_login</span><br><span class=\"line\">~&#x2F;.profile</span><br></pre></td></tr></table></figure>\n\n<p>所以只需要在上面其中一个文件加上</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[ -s $(brew --prefix)&#x2F;etc&#x2F;profile.d&#x2F;[autojump.sh](http:&#x2F;&#x2F;autojump.sh&#x2F;) ]] &amp;&amp; . $(brew --prefix)&#x2F;etc&#x2F;profile.d&#x2F;[autojump.sh](http:&#x2F;&#x2F;autojump.sh&#x2F;)</span><br></pre></td></tr></table></figure>\n\n<p>但如果终端工具使用的是 zsh，需要在<code>~/.zshrc</code>添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[ -s &#96;brew --prefix&#96;&#x2F;etc&#x2F;autojump.sh ]] &amp;&amp; . &#96;brew --prefix&#96;&#x2F;etc&#x2F;autojump.sh</span><br></pre></td></tr></table></figure>\n\n<p>然后，运行 <code>source &lt;sourcefile&gt;</code>.</p>\n<h3 id=\"2-Linux\"><a href=\"#2-Linux\" class=\"headerlink\" title=\"2. Linux\"></a>2. Linux</h3><p>首先下载 autojump 源码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git:&#x2F;&#x2F;github.com&#x2F;joelthelion&#x2F;autojump.git</span><br></pre></td></tr></table></figure>\n\n<p>然后可安装或卸载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd autojump</span><br><span class=\"line\">.&#x2F;install.py or .&#x2F;uninstall.py</span><br></pre></td></tr></table></figure>\n\n<p>由于Linux 下 Shell 启动会自动读取 ~/.bashrc 文件，所以将下面一行添加到该文件中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[ -s ~&#x2F;.autojump&#x2F;etc&#x2F;profile.d&#x2F;autojump.sh ]] &amp;&amp; . ~&#x2F;.autojump&#x2F;etc&#x2F;profile.d&#x2F;autojump.sh</span><br></pre></td></tr></table></figure>\n\n<p>然后，运行<code>source ~/.bashrc</code>即可。</p>\n<p>安装完成后，使用查看autojump版本。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ autojump --version</span><br><span class=\"line\">autojump release-v21.1.2</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"2-用法\"><a href=\"#2-用法\" class=\"headerlink\" title=\"2. 用法\"></a>2. 用法</h2><p>只有打开过的目录 autojump 才会记录，所以使用时间越长，autojump 才会越智能。</p>\n<p>可以使用 <code>autojump</code> 命令，或者使用短命令 <code>j</code>.</p>\n<ol>\n<li><p>跳转到指定目录</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">j directoryName</span><br></pre></td></tr></table></figure>\n<p> 如果不知道目录全名，输入一部分，按Tab键就好，输错了也没关系，可以自动识别，非常强大。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># j csm</span><br><span class=\"line\">&#x2F;data&#x2F;www&#x2F;xxx&#x2F;cms</span><br></pre></td></tr></table></figure>\n\n<p> Tab 键效果</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~$ pwd</span><br><span class=\"line\">&#x2F;home&#x2F;vagrant</span><br><span class=\"line\">vagrant@homestead:~$ j --stat</span><br><span class=\"line\">10.0:\t&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">20.0:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;xxx&#x2F;doc_api</span><br><span class=\"line\">34.6:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;xxx</span><br><span class=\"line\">40.0:\t&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">Total key weight: 104. Number of stored dirs: 4</span><br><span class=\"line\">vagrant@homestead:~$ j n__ (Tab 键自动添加了下划线)</span><br><span class=\"line\">&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">vagrant@homestead:&#x2F;var&#x2F;log&#x2F;nginx$</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>跳转到指定目录的子目录（Mac 下效果与<code>j</code>相同，Ubuntu下不好用）</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jc directoryName</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用系统工具（Mac Finder, Windows Explorer, GNOME, etc.）打开目录，类似Mac OS terminal 下的 <code>open</code> 命令，但<code>open</code> 命令需要指定路径（Mac中还算实用，Ubuntu下不好用）</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jo directoryName</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看权重 <code>j --stat</code></p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ j --stat</span><br><span class=\"line\">10.0:\t&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">10.0:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;caijing&#x2F;doc_api</span><br><span class=\"line\">10.0:\t&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">30.0:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;caijing</span><br><span class=\"line\">Total key weight: 59. Number of stored dirs: 4</span><br></pre></td></tr></table></figure>\n\n<p> 权重越高，说明目录使用的越频繁。</p>\n<p> 感觉 Mac 中的显示效果更好，还可以自己去调整权重值。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ j --stat</span><br><span class=\"line\">10.0:\t&#x2F;Users&#x2F;xxx&#x2F;xxx&#x2F;xxxx&#x2F;xxxx&#x2F;xxxx&#x2F;vendor</span><br><span class=\"line\">22.4:\t&#x2F;Users&#x2F;xxx&#x2F;xxx&#x2F;xxxx&#x2F;xxxx&#x2F;xxxx&#x2F;log</span><br><span class=\"line\"></span><br><span class=\"line\">32:\t    total weight</span><br><span class=\"line\">2:\t     number of entries</span><br><span class=\"line\">10.00:\t current directory weight</span><br><span class=\"line\"></span><br><span class=\"line\">data:\t &#x2F;Users&#x2F;xxx&#x2F;Library&#x2F;autojump&#x2F;autojump.txt</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其他</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">autojump --help</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-4-14/72919152-file_1492142306461_3bfa.jpg\"></p>\n<blockquote>\n<p>在终端的文件夹跳转非常麻烦, 需要敲长长的路径.<br>alias 别名也不是很方便。<br><a href=\"https://github.com/wting/autojump\">autojump</a> 是通过记录进入过的目录到数据库来实现的, 所以必须是曾经进入过的目录才能跳转.</p>\n</blockquote>","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><h3 id=\"1-OS-X\"><a href=\"#1-OS-X\" class=\"headerlink\" title=\"1. OS X\"></a>1. OS X</h3><p>推荐使用 Homebrew 安装 autojump</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install autojump</span><br></pre></td></tr></table></figure>\n\n<p>macOS 启动 Shell 自动读取的文件有</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;etc&#x2F;profile</span><br><span class=\"line\">~&#x2F;.bash_profile</span><br><span class=\"line\">~&#x2F;.bash_login</span><br><span class=\"line\">~&#x2F;.profile</span><br></pre></td></tr></table></figure>\n\n<p>所以只需要在上面其中一个文件加上</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[ -s $(brew --prefix)&#x2F;etc&#x2F;profile.d&#x2F;[autojump.sh](http:&#x2F;&#x2F;autojump.sh&#x2F;) ]] &amp;&amp; . $(brew --prefix)&#x2F;etc&#x2F;profile.d&#x2F;[autojump.sh](http:&#x2F;&#x2F;autojump.sh&#x2F;)</span><br></pre></td></tr></table></figure>\n\n<p>但如果终端工具使用的是 zsh，需要在<code>~/.zshrc</code>添加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[ -s &#96;brew --prefix&#96;&#x2F;etc&#x2F;autojump.sh ]] &amp;&amp; . &#96;brew --prefix&#96;&#x2F;etc&#x2F;autojump.sh</span><br></pre></td></tr></table></figure>\n\n<p>然后，运行 <code>source &lt;sourcefile&gt;</code>.</p>\n<h3 id=\"2-Linux\"><a href=\"#2-Linux\" class=\"headerlink\" title=\"2. Linux\"></a>2. Linux</h3><p>首先下载 autojump 源码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone git:&#x2F;&#x2F;github.com&#x2F;joelthelion&#x2F;autojump.git</span><br></pre></td></tr></table></figure>\n\n<p>然后可安装或卸载</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd autojump</span><br><span class=\"line\">.&#x2F;install.py or .&#x2F;uninstall.py</span><br></pre></td></tr></table></figure>\n\n<p>由于Linux 下 Shell 启动会自动读取 ~/.bashrc 文件，所以将下面一行添加到该文件中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[[ -s ~&#x2F;.autojump&#x2F;etc&#x2F;profile.d&#x2F;autojump.sh ]] &amp;&amp; . ~&#x2F;.autojump&#x2F;etc&#x2F;profile.d&#x2F;autojump.sh</span><br></pre></td></tr></table></figure>\n\n<p>然后，运行<code>source ~/.bashrc</code>即可。</p>\n<p>安装完成后，使用查看autojump版本。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ autojump --version</span><br><span class=\"line\">autojump release-v21.1.2</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"2-用法\"><a href=\"#2-用法\" class=\"headerlink\" title=\"2. 用法\"></a>2. 用法</h2><p>只有打开过的目录 autojump 才会记录，所以使用时间越长，autojump 才会越智能。</p>\n<p>可以使用 <code>autojump</code> 命令，或者使用短命令 <code>j</code>.</p>\n<ol>\n<li><p>跳转到指定目录</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">j directoryName</span><br></pre></td></tr></table></figure>\n<p> 如果不知道目录全名，输入一部分，按Tab键就好，输错了也没关系，可以自动识别，非常强大。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># j csm</span><br><span class=\"line\">&#x2F;data&#x2F;www&#x2F;xxx&#x2F;cms</span><br></pre></td></tr></table></figure>\n\n<p> Tab 键效果</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~$ pwd</span><br><span class=\"line\">&#x2F;home&#x2F;vagrant</span><br><span class=\"line\">vagrant@homestead:~$ j --stat</span><br><span class=\"line\">10.0:\t&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">20.0:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;xxx&#x2F;doc_api</span><br><span class=\"line\">34.6:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;xxx</span><br><span class=\"line\">40.0:\t&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">Total key weight: 104. Number of stored dirs: 4</span><br><span class=\"line\">vagrant@homestead:~$ j n__ (Tab 键自动添加了下划线)</span><br><span class=\"line\">&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">vagrant@homestead:&#x2F;var&#x2F;log&#x2F;nginx$</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>跳转到指定目录的子目录（Mac 下效果与<code>j</code>相同，Ubuntu下不好用）</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jc directoryName</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>使用系统工具（Mac Finder, Windows Explorer, GNOME, etc.）打开目录，类似Mac OS terminal 下的 <code>open</code> 命令，但<code>open</code> 命令需要指定路径（Mac中还算实用，Ubuntu下不好用）</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jo directoryName</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>查看权重 <code>j --stat</code></p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ j --stat</span><br><span class=\"line\">10.0:\t&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">10.0:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;caijing&#x2F;doc_api</span><br><span class=\"line\">10.0:\t&#x2F;var&#x2F;log&#x2F;nginx</span><br><span class=\"line\">30.0:\t&#x2F;home&#x2F;vagrant&#x2F;www&#x2F;caijing</span><br><span class=\"line\">Total key weight: 59. Number of stored dirs: 4</span><br></pre></td></tr></table></figure>\n\n<p> 权重越高，说明目录使用的越频繁。</p>\n<p> 感觉 Mac 中的显示效果更好，还可以自己去调整权重值。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ j --stat</span><br><span class=\"line\">10.0:\t&#x2F;Users&#x2F;xxx&#x2F;xxx&#x2F;xxxx&#x2F;xxxx&#x2F;xxxx&#x2F;vendor</span><br><span class=\"line\">22.4:\t&#x2F;Users&#x2F;xxx&#x2F;xxx&#x2F;xxxx&#x2F;xxxx&#x2F;xxxx&#x2F;log</span><br><span class=\"line\"></span><br><span class=\"line\">32:\t    total weight</span><br><span class=\"line\">2:\t     number of entries</span><br><span class=\"line\">10.00:\t current directory weight</span><br><span class=\"line\"></span><br><span class=\"line\">data:\t &#x2F;Users&#x2F;xxx&#x2F;Library&#x2F;autojump&#x2F;autojump.txt</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>其他</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">autojump --help</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>"},{"title":"Linux 软件安装管理","date":"2018-02-18T04:19:34.000Z","_content":"\n## linux 安装软件\n\n只有两种方式，源码（二进制文件）编译和 rpm 包，yum 其实也是 rpm 包的一种在线安装方式，并解决了依赖问题。但是不支持查询和校验。\n\n<!-- more -->\n\n### 1. rpm 安装\n\n#### 1. 安装\n```\nrpm -ivh 软件包全名\nrpm -ivh httpd-2.2.15-15.e16.centos.1.i686.rpm\n```\n\n- i：install\n- v：verbose，显示指令执行过程；\n- h：hash，显示安装百分比\n\n#### 2. 升级\n```\nrpm -Uvh 软件包全名\nrpm -Uvh httpd-2.2.15-15.e16.centos.1.i686.rpm\n```\n\n- U：upgrade 升级\n\n如果没有安装过，相当于全新安装\n\n#### 3. 卸载\n\n```\nrpm -e 包名，而不是包全名，只有安装和升级需要包全名\nrpm -e httpd // 系统会去 /var/lib/rpm 目录下的数据库中找\n```\n\n- e：erase，删除\n- --nodeps：不检查依赖，实际环境中不允许使用\n\n卸载的依赖顺序和安装时的依赖顺序相反\n\nrpm 包一定要解决依赖性才可以正确安装和卸载\n\n为什么会有卸载命令？源码安装就没有卸载命令。因为 rpm 包安装的位置为系统默认位置，分布在系统的各个位置，想要卸载所有的文件非常麻烦，所以设置了一个卸载命令。\n\n\n#### 4. rpm 包查询\n\n##### 1. 系统是否已安装软件\n```\nrpm -q 包名\nrpm -q httpd\n```\n- q：query\n- a：all\n\n##### 2. 查询系统中所有已安装的软件\n```\nrpm -qa | grep httpd\n```\n\n##### 3. 查询软件包详细信息\n```\nrpm -qi 包名\nrpm -qi httpd\n```\n\n- i：information\n- p：package，查询未安装包信息\n\n```\nrpm -qip 包全名\nrpm -qi httpd-2.2.15-15.e16.centos.1.i686.rpm\n```\n\n##### 4. 查询包中文件安装位置\n```\nrpm -ql 包名\n```\n\n- l：list，列表\n\n##### 5. rpm 包默认安装路径\n\n路径 | 说明\n- | :-: \n/etc | 配置文件安装目录\n/usr/bin/ | 可执行命令安装目录\n/usr/lib | 程序所使用的函数库保存位置\n/usr/share/doc/ | 基本的软件使用手册保存位置\n/usr/share/man/ | 帮助文件保存位置\n\n\n##### 6. 查询系统文件（rpm 安装生成的文件）属于哪个 rpm 包\n```\nrpm -qf 系统文件名\n```\n\n##### 7. 查询软件包的依赖性\n```\nrpm -qR 包名\nrpm -qR httpd\n```\n查询结果没什么意义，还不如一步步安装，根据提示来安装各种依赖\n\n- R：requires\n\n#### 4. rpm 包校验\n\n包含 md5 校验、文件修改时间校验等\n\n```\nrpm -V 已安装的包名\nrpm -V httpd\n```\n\n- V：verify\n\n如果没有任何输出，表示校验通过，文件没有被修改\n\n\n#### 5. rpm 包内文件提取\n\n```\nrpm2cpio 包全名 | cpio -idv .文件绝对路径\n```\n\n- rpm2cpio：将 rpm 包转换为 cpio 格式的命令\n- cpio：是一个标准工具，它用于创建软件档案文件和从档案文件中提取文件\n\n```\ncpio 选项 < [文件|设备]\n```\n\n- i：copy-in 模式，还原\n- d：还原时自动新建目录\n- v：显示还原过程\n\n示例\n##### 1. 查询 ls 命令属于哪个 rpm 包\n\n```\nrpm -qf /bin/ls\n``` \n\n##### 2. 造成 ls 命令误删除假象\n\n```\nmv /bin/ls /tmp/\n```\n\n##### 3. 提取 rpm 包中 ls 命令到当前目录的 /bin/ls\n 下\n\n```\nrpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls\n```\n\n##### 4. 把 ls 命令复制到 /bin/ 目录，修复文件丢失\n\n```\ncp /root/bin/ls /bin/\n```\n\n### 2. yum 在线安装\n\n网络下载\n\nrpm 包的安装过程中，依赖性太强，使用难度较大。\n\nyum 好处：将所有软件包放到官方服务器上，当进行 yum 在线安装时，可以自动解决依赖性问题。\n\nRedhat 的 yum 在线安装需要付费，CentOS 的 yum 免费\n\n#### 1. yum 源文件\n\n/etc/yum/repos.d/CentOS-Base.repo\n\n```\n[base]\nname=CentOS-$releasever - Base - mirrors.aliyun.com\nfailovermethod=priority\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/\n        http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os\ngpgcheck=1\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n```\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-18/43605225.jpg)\n\n\n#### 2. yum 命令\n\n##### 1. 查询\n\n查询所有可用软件包列表\n```\nyum list\n```\n\n搜索服务器上所有和关键字相关的包\n```\nyum search 关键字\n```\n\n\n##### 2. 安装\n\nyum 安装不需要写包全名\n\n```\nyum -y install 包名\nyum -y install gcc\n```\n\n- install：安装\n- y：自动回答 yes\n\n##### 3. 升级\n\n```\nyum -y update 包名\n```\n\n<b style='color:red'>稳定和安全为主，没必要尽量不要升级</b>\n\n##### 4. 卸载\n\n```\nyum -y remove 包名\n```\n\n卸载也是要卸载各种依赖，很容易造成系统崩溃\n\n<b style='color:red'>服务器使用最小化安装，用什么软件安装什么，尽量不卸载</b>\n\n#### yum 软件组管理命令\n\n列出所有可用的软件组列表\n```\nyum grouplist\n```\n\n安装指定软件组，组名可以由 grouplist 查询处理\n```\nyum groupinstall 软件组名（必须英文）\nyum groupinstall \"Chinese Support\"\n```\n\n卸载指定软件组\n```\nyum groupremove 软件组名\n```\n### 3. 源码包和 rpm 包的区别\n\n- 安装之前的区别：概念上的区别\n- 安装之后的区别：安装位置不同\n\n\nrpm 包安装在默认位置（包作者所指定的位置），可以指定安装位置，但是强烈不建议这么做。\n\n#### 1. 安装位置不同带来的影响\n\nrpm 包安装的服务可以使用系统服务管理命令（service）管理，例如 rpm 包安装的 Apache 的启动方法是\n\n```\n/etc/rc.d/init.d/httpd start # linux 标准启动方法\nservice httpd start\n```\n<b style=\"color:red\">service 搜索的目录实际上就是 `/etc/rc.d/init.d/` 目录</b>\n\n源码包安装必须指定安装位置，一般是 `/usr/local/软件名/`，相当于 Windows 下的 `C:\\Programs`，因为源码包没有卸载命令，直接删除安装目录就是卸载。\n\n源码包安装的服务不能被服务管理命令管理，因为没有安卓到默认路径中。所以只能用绝对路径进行服务的管理，如：\n```\n/usr/local/apache2/bin/apachectl start\n```\n### 4. 源码包安装软件\n\n#### 1. 安装准备：\n\n- 安装 C 语言编译器 `rpm -qa | grep gcc`\n- 下载源码包，一般都是由官方网站提供\n\n\n<b style=\"color:red\">原则：给大量用户提供服务的软件，建议使用源码包安装，因为源码包效率更高\n\n不太影响效率的软件，可以使用 rpm 包安装</b>\n\n#### 2. 安装注意事项\n\n- 源代码保存位置：`/usr/local/src`\n- 软件安装位置：`/usr/local/`\n- 如何确定安装过程报错\n  - 安装过程停止\n  - 并且最后几行出现 error、warning 或 no 的提示\n\n#### 3. 安装过程\n1. 下载源码包\n2. 解压安装包\n3. 进入到解压缩目录\n4. `./configure` 软件配置与检查\n  - 定义需要的功能选项；\n  - 监测系统环境是否符合安装要求；\n  - 把定义好的功能选项和检测系统环境的信息都写到 Makefile 文件，用于后续的编辑。\n\n5.  `make` 编译，如果有报错，使用 `make clean` 清除缓存文件\n6. `make install` 编译安装\n\n### 5. 脚本安装软件\n\n所谓的一键安装包，实际上还是安装的源码包和 rpm 包，只是把安装过程写成了脚本，便于初学者安装\n\n优点：简单、快速、方便\n\n缺点：\n- 不能定义安装软件的版本\n- 不能定义所需要的软件功能\n- 源码包的优势（自定义、安装位置、依赖等）丧失\n\n\n\n\n\n","source":"_posts/Linux-软件安装管理.md","raw":"---\ntitle: Linux 软件安装管理\ndate: 2018-02-18 12:19:34\ntags: Linux\n---\n\n## linux 安装软件\n\n只有两种方式，源码（二进制文件）编译和 rpm 包，yum 其实也是 rpm 包的一种在线安装方式，并解决了依赖问题。但是不支持查询和校验。\n\n<!-- more -->\n\n### 1. rpm 安装\n\n#### 1. 安装\n```\nrpm -ivh 软件包全名\nrpm -ivh httpd-2.2.15-15.e16.centos.1.i686.rpm\n```\n\n- i：install\n- v：verbose，显示指令执行过程；\n- h：hash，显示安装百分比\n\n#### 2. 升级\n```\nrpm -Uvh 软件包全名\nrpm -Uvh httpd-2.2.15-15.e16.centos.1.i686.rpm\n```\n\n- U：upgrade 升级\n\n如果没有安装过，相当于全新安装\n\n#### 3. 卸载\n\n```\nrpm -e 包名，而不是包全名，只有安装和升级需要包全名\nrpm -e httpd // 系统会去 /var/lib/rpm 目录下的数据库中找\n```\n\n- e：erase，删除\n- --nodeps：不检查依赖，实际环境中不允许使用\n\n卸载的依赖顺序和安装时的依赖顺序相反\n\nrpm 包一定要解决依赖性才可以正确安装和卸载\n\n为什么会有卸载命令？源码安装就没有卸载命令。因为 rpm 包安装的位置为系统默认位置，分布在系统的各个位置，想要卸载所有的文件非常麻烦，所以设置了一个卸载命令。\n\n\n#### 4. rpm 包查询\n\n##### 1. 系统是否已安装软件\n```\nrpm -q 包名\nrpm -q httpd\n```\n- q：query\n- a：all\n\n##### 2. 查询系统中所有已安装的软件\n```\nrpm -qa | grep httpd\n```\n\n##### 3. 查询软件包详细信息\n```\nrpm -qi 包名\nrpm -qi httpd\n```\n\n- i：information\n- p：package，查询未安装包信息\n\n```\nrpm -qip 包全名\nrpm -qi httpd-2.2.15-15.e16.centos.1.i686.rpm\n```\n\n##### 4. 查询包中文件安装位置\n```\nrpm -ql 包名\n```\n\n- l：list，列表\n\n##### 5. rpm 包默认安装路径\n\n路径 | 说明\n- | :-: \n/etc | 配置文件安装目录\n/usr/bin/ | 可执行命令安装目录\n/usr/lib | 程序所使用的函数库保存位置\n/usr/share/doc/ | 基本的软件使用手册保存位置\n/usr/share/man/ | 帮助文件保存位置\n\n\n##### 6. 查询系统文件（rpm 安装生成的文件）属于哪个 rpm 包\n```\nrpm -qf 系统文件名\n```\n\n##### 7. 查询软件包的依赖性\n```\nrpm -qR 包名\nrpm -qR httpd\n```\n查询结果没什么意义，还不如一步步安装，根据提示来安装各种依赖\n\n- R：requires\n\n#### 4. rpm 包校验\n\n包含 md5 校验、文件修改时间校验等\n\n```\nrpm -V 已安装的包名\nrpm -V httpd\n```\n\n- V：verify\n\n如果没有任何输出，表示校验通过，文件没有被修改\n\n\n#### 5. rpm 包内文件提取\n\n```\nrpm2cpio 包全名 | cpio -idv .文件绝对路径\n```\n\n- rpm2cpio：将 rpm 包转换为 cpio 格式的命令\n- cpio：是一个标准工具，它用于创建软件档案文件和从档案文件中提取文件\n\n```\ncpio 选项 < [文件|设备]\n```\n\n- i：copy-in 模式，还原\n- d：还原时自动新建目录\n- v：显示还原过程\n\n示例\n##### 1. 查询 ls 命令属于哪个 rpm 包\n\n```\nrpm -qf /bin/ls\n``` \n\n##### 2. 造成 ls 命令误删除假象\n\n```\nmv /bin/ls /tmp/\n```\n\n##### 3. 提取 rpm 包中 ls 命令到当前目录的 /bin/ls\n 下\n\n```\nrpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls\n```\n\n##### 4. 把 ls 命令复制到 /bin/ 目录，修复文件丢失\n\n```\ncp /root/bin/ls /bin/\n```\n\n### 2. yum 在线安装\n\n网络下载\n\nrpm 包的安装过程中，依赖性太强，使用难度较大。\n\nyum 好处：将所有软件包放到官方服务器上，当进行 yum 在线安装时，可以自动解决依赖性问题。\n\nRedhat 的 yum 在线安装需要付费，CentOS 的 yum 免费\n\n#### 1. yum 源文件\n\n/etc/yum/repos.d/CentOS-Base.repo\n\n```\n[base]\nname=CentOS-$releasever - Base - mirrors.aliyun.com\nfailovermethod=priority\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/\n        http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/\n#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=os\ngpgcheck=1\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n```\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-18/43605225.jpg)\n\n\n#### 2. yum 命令\n\n##### 1. 查询\n\n查询所有可用软件包列表\n```\nyum list\n```\n\n搜索服务器上所有和关键字相关的包\n```\nyum search 关键字\n```\n\n\n##### 2. 安装\n\nyum 安装不需要写包全名\n\n```\nyum -y install 包名\nyum -y install gcc\n```\n\n- install：安装\n- y：自动回答 yes\n\n##### 3. 升级\n\n```\nyum -y update 包名\n```\n\n<b style='color:red'>稳定和安全为主，没必要尽量不要升级</b>\n\n##### 4. 卸载\n\n```\nyum -y remove 包名\n```\n\n卸载也是要卸载各种依赖，很容易造成系统崩溃\n\n<b style='color:red'>服务器使用最小化安装，用什么软件安装什么，尽量不卸载</b>\n\n#### yum 软件组管理命令\n\n列出所有可用的软件组列表\n```\nyum grouplist\n```\n\n安装指定软件组，组名可以由 grouplist 查询处理\n```\nyum groupinstall 软件组名（必须英文）\nyum groupinstall \"Chinese Support\"\n```\n\n卸载指定软件组\n```\nyum groupremove 软件组名\n```\n### 3. 源码包和 rpm 包的区别\n\n- 安装之前的区别：概念上的区别\n- 安装之后的区别：安装位置不同\n\n\nrpm 包安装在默认位置（包作者所指定的位置），可以指定安装位置，但是强烈不建议这么做。\n\n#### 1. 安装位置不同带来的影响\n\nrpm 包安装的服务可以使用系统服务管理命令（service）管理，例如 rpm 包安装的 Apache 的启动方法是\n\n```\n/etc/rc.d/init.d/httpd start # linux 标准启动方法\nservice httpd start\n```\n<b style=\"color:red\">service 搜索的目录实际上就是 `/etc/rc.d/init.d/` 目录</b>\n\n源码包安装必须指定安装位置，一般是 `/usr/local/软件名/`，相当于 Windows 下的 `C:\\Programs`，因为源码包没有卸载命令，直接删除安装目录就是卸载。\n\n源码包安装的服务不能被服务管理命令管理，因为没有安卓到默认路径中。所以只能用绝对路径进行服务的管理，如：\n```\n/usr/local/apache2/bin/apachectl start\n```\n### 4. 源码包安装软件\n\n#### 1. 安装准备：\n\n- 安装 C 语言编译器 `rpm -qa | grep gcc`\n- 下载源码包，一般都是由官方网站提供\n\n\n<b style=\"color:red\">原则：给大量用户提供服务的软件，建议使用源码包安装，因为源码包效率更高\n\n不太影响效率的软件，可以使用 rpm 包安装</b>\n\n#### 2. 安装注意事项\n\n- 源代码保存位置：`/usr/local/src`\n- 软件安装位置：`/usr/local/`\n- 如何确定安装过程报错\n  - 安装过程停止\n  - 并且最后几行出现 error、warning 或 no 的提示\n\n#### 3. 安装过程\n1. 下载源码包\n2. 解压安装包\n3. 进入到解压缩目录\n4. `./configure` 软件配置与检查\n  - 定义需要的功能选项；\n  - 监测系统环境是否符合安装要求；\n  - 把定义好的功能选项和检测系统环境的信息都写到 Makefile 文件，用于后续的编辑。\n\n5.  `make` 编译，如果有报错，使用 `make clean` 清除缓存文件\n6. `make install` 编译安装\n\n### 5. 脚本安装软件\n\n所谓的一键安装包，实际上还是安装的源码包和 rpm 包，只是把安装过程写成了脚本，便于初学者安装\n\n优点：简单、快速、方便\n\n缺点：\n- 不能定义安装软件的版本\n- 不能定义所需要的软件功能\n- 源码包的优势（自定义、安装位置、依赖等）丧失\n\n\n\n\n\n","slug":"Linux-软件安装管理","published":1,"updated":"2020-09-11T01:04:35.035Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz85000s6wo1axe475tb","content":"<h2 id=\"linux-安装软件\"><a href=\"#linux-安装软件\" class=\"headerlink\" title=\"linux 安装软件\"></a>linux 安装软件</h2><p>只有两种方式，源码（二进制文件）编译和 rpm 包，yum 其实也是 rpm 包的一种在线安装方式，并解决了依赖问题。但是不支持查询和校验。</p>\n<a id=\"more\"></a>\n\n<h3 id=\"1-rpm-安装\"><a href=\"#1-rpm-安装\" class=\"headerlink\" title=\"1. rpm 安装\"></a>1. rpm 安装</h3><h4 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh 软件包全名</span><br><span class=\"line\">rpm -ivh httpd-2.2.15-15.e16.centos.1.i686.rpm</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>i：install</li>\n<li>v：verbose，显示指令执行过程；</li>\n<li>h：hash，显示安装百分比</li>\n</ul>\n<h4 id=\"2-升级\"><a href=\"#2-升级\" class=\"headerlink\" title=\"2. 升级\"></a>2. 升级</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -Uvh 软件包全名</span><br><span class=\"line\">rpm -Uvh httpd-2.2.15-15.e16.centos.1.i686.rpm</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>U：upgrade 升级</li>\n</ul>\n<p>如果没有安装过，相当于全新安装</p>\n<h4 id=\"3-卸载\"><a href=\"#3-卸载\" class=\"headerlink\" title=\"3. 卸载\"></a>3. 卸载</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -e 包名，而不是包全名，只有安装和升级需要包全名</span><br><span class=\"line\">rpm -e httpd &#x2F;&#x2F; 系统会去 &#x2F;var&#x2F;lib&#x2F;rpm 目录下的数据库中找</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>e：erase，删除</li>\n<li>–nodeps：不检查依赖，实际环境中不允许使用</li>\n</ul>\n<p>卸载的依赖顺序和安装时的依赖顺序相反</p>\n<p>rpm 包一定要解决依赖性才可以正确安装和卸载</p>\n<p>为什么会有卸载命令？源码安装就没有卸载命令。因为 rpm 包安装的位置为系统默认位置，分布在系统的各个位置，想要卸载所有的文件非常麻烦，所以设置了一个卸载命令。</p>\n<h4 id=\"4-rpm-包查询\"><a href=\"#4-rpm-包查询\" class=\"headerlink\" title=\"4. rpm 包查询\"></a>4. rpm 包查询</h4><h5 id=\"1-系统是否已安装软件\"><a href=\"#1-系统是否已安装软件\" class=\"headerlink\" title=\"1. 系统是否已安装软件\"></a>1. 系统是否已安装软件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -q 包名</span><br><span class=\"line\">rpm -q httpd</span><br></pre></td></tr></table></figure>\n<ul>\n<li>q：query</li>\n<li>a：all</li>\n</ul>\n<h5 id=\"2-查询系统中所有已安装的软件\"><a href=\"#2-查询系统中所有已安装的软件\" class=\"headerlink\" title=\"2. 查询系统中所有已安装的软件\"></a>2. 查询系统中所有已安装的软件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qa | grep httpd</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-查询软件包详细信息\"><a href=\"#3-查询软件包详细信息\" class=\"headerlink\" title=\"3. 查询软件包详细信息\"></a>3. 查询软件包详细信息</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qi 包名</span><br><span class=\"line\">rpm -qi httpd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>i：information</li>\n<li>p：package，查询未安装包信息</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qip 包全名</span><br><span class=\"line\">rpm -qi httpd-2.2.15-15.e16.centos.1.i686.rpm</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-查询包中文件安装位置\"><a href=\"#4-查询包中文件安装位置\" class=\"headerlink\" title=\"4. 查询包中文件安装位置\"></a>4. 查询包中文件安装位置</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ql 包名</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>l：list，列表</li>\n</ul>\n<h5 id=\"5-rpm-包默认安装路径\"><a href=\"#5-rpm-包默认安装路径\" class=\"headerlink\" title=\"5. rpm 包默认安装路径\"></a>5. rpm 包默认安装路径</h5><table>\n<thead>\n<tr>\n<th>路径</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>/etc</td>\n<td align=\"center\">配置文件安装目录</td>\n</tr>\n<tr>\n<td>/usr/bin/</td>\n<td align=\"center\">可执行命令安装目录</td>\n</tr>\n<tr>\n<td>/usr/lib</td>\n<td align=\"center\">程序所使用的函数库保存位置</td>\n</tr>\n<tr>\n<td>/usr/share/doc/</td>\n<td align=\"center\">基本的软件使用手册保存位置</td>\n</tr>\n<tr>\n<td>/usr/share/man/</td>\n<td align=\"center\">帮助文件保存位置</td>\n</tr>\n</tbody></table>\n<h5 id=\"6-查询系统文件（rpm-安装生成的文件）属于哪个-rpm-包\"><a href=\"#6-查询系统文件（rpm-安装生成的文件）属于哪个-rpm-包\" class=\"headerlink\" title=\"6. 查询系统文件（rpm 安装生成的文件）属于哪个 rpm 包\"></a>6. 查询系统文件（rpm 安装生成的文件）属于哪个 rpm 包</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qf 系统文件名</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"7-查询软件包的依赖性\"><a href=\"#7-查询软件包的依赖性\" class=\"headerlink\" title=\"7. 查询软件包的依赖性\"></a>7. 查询软件包的依赖性</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qR 包名</span><br><span class=\"line\">rpm -qR httpd</span><br></pre></td></tr></table></figure>\n<p>查询结果没什么意义，还不如一步步安装，根据提示来安装各种依赖</p>\n<ul>\n<li>R：requires</li>\n</ul>\n<h4 id=\"4-rpm-包校验\"><a href=\"#4-rpm-包校验\" class=\"headerlink\" title=\"4. rpm 包校验\"></a>4. rpm 包校验</h4><p>包含 md5 校验、文件修改时间校验等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -V 已安装的包名</span><br><span class=\"line\">rpm -V httpd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>V：verify</li>\n</ul>\n<p>如果没有任何输出，表示校验通过，文件没有被修改</p>\n<h4 id=\"5-rpm-包内文件提取\"><a href=\"#5-rpm-包内文件提取\" class=\"headerlink\" title=\"5. rpm 包内文件提取\"></a>5. rpm 包内文件提取</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm2cpio 包全名 | cpio -idv .文件绝对路径</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>rpm2cpio：将 rpm 包转换为 cpio 格式的命令</li>\n<li>cpio：是一个标准工具，它用于创建软件档案文件和从档案文件中提取文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpio 选项 &lt; [文件|设备]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>i：copy-in 模式，还原</li>\n<li>d：还原时自动新建目录</li>\n<li>v：显示还原过程</li>\n</ul>\n<p>示例</p>\n<h5 id=\"1-查询-ls-命令属于哪个-rpm-包\"><a href=\"#1-查询-ls-命令属于哪个-rpm-包\" class=\"headerlink\" title=\"1. 查询 ls 命令属于哪个 rpm 包\"></a>1. 查询 ls 命令属于哪个 rpm 包</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qf &#x2F;bin&#x2F;ls</span><br><span class=\"line\">&#96;&#96;&#96; </span><br><span class=\"line\"></span><br><span class=\"line\">##### 2. 造成 ls 命令误删除假象</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>mv /bin/ls /tmp/</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">##### 3. 提取 rpm 包中 ls 命令到当前目录的 &#x2F;bin&#x2F;ls</span><br><span class=\"line\"> 下</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">##### 4. 把 ls 命令复制到 &#x2F;bin&#x2F; 目录，修复文件丢失</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>cp /root/bin/ls /bin/</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 2. yum 在线安装</span><br><span class=\"line\"></span><br><span class=\"line\">网络下载</span><br><span class=\"line\"></span><br><span class=\"line\">rpm 包的安装过程中，依赖性太强，使用难度较大。</span><br><span class=\"line\"></span><br><span class=\"line\">yum 好处：将所有软件包放到官方服务器上，当进行 yum 在线安装时，可以自动解决依赖性问题。</span><br><span class=\"line\"></span><br><span class=\"line\">Redhat 的 yum 在线安装需要付费，CentOS 的 yum 免费</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1. yum 源文件</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;etc&#x2F;yum&#x2F;repos.d&#x2F;CentOS-Base.repo</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>[base]<br>name=CentOS-$releasever - Base - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=<a href=\"http://mirrors.aliyun.com/centos/$releasever/os/$basearch/\">http://mirrors.aliyun.com/centos/$releasever/os/$basearch/</a><br>        <a href=\"http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/\">http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/</a><br>#mirrorlist=<a href=\"http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os\">http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os</a><br>gpgcheck=1<br>gpgkey=<a href=\"http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\">http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![](http:&#x2F;&#x2F;omp48p40q.bkt.clouddn.com&#x2F;18-2-18&#x2F;43605225.jpg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#### 2. yum 命令</span><br><span class=\"line\"></span><br><span class=\"line\">##### 1. 查询</span><br><span class=\"line\"></span><br><span class=\"line\">查询所有可用软件包列表</span><br></pre></td></tr></table></figure>\n<p>yum list</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">搜索服务器上所有和关键字相关的包</span><br></pre></td></tr></table></figure>\n<p>yum search 关键字</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">##### 2. 安装</span><br><span class=\"line\"></span><br><span class=\"line\">yum 安装不需要写包全名</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>yum -y install 包名<br>yum -y install gcc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- install：安装</span><br><span class=\"line\">- y：自动回答 yes</span><br><span class=\"line\"></span><br><span class=\"line\">##### 3. 升级</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>yum -y update 包名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;b style&#x3D;&#39;color:red&#39;&gt;稳定和安全为主，没必要尽量不要升级&lt;&#x2F;b&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">##### 4. 卸载</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>yum -y remove 包名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">卸载也是要卸载各种依赖，很容易造成系统崩溃</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;b style&#x3D;&#39;color:red&#39;&gt;服务器使用最小化安装，用什么软件安装什么，尽量不卸载&lt;&#x2F;b&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">#### yum 软件组管理命令</span><br><span class=\"line\"></span><br><span class=\"line\">列出所有可用的软件组列表</span><br></pre></td></tr></table></figure>\n<p>yum grouplist</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">安装指定软件组，组名可以由 grouplist 查询处理</span><br></pre></td></tr></table></figure>\n<p>yum groupinstall 软件组名（必须英文）<br>yum groupinstall “Chinese Support”</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">卸载指定软件组</span><br></pre></td></tr></table></figure>\n<p>yum groupremove 软件组名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">### 3. 源码包和 rpm 包的区别</span><br><span class=\"line\"></span><br><span class=\"line\">- 安装之前的区别：概念上的区别</span><br><span class=\"line\">- 安装之后的区别：安装位置不同</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">rpm 包安装在默认位置（包作者所指定的位置），可以指定安装位置，但是强烈不建议这么做。</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1. 安装位置不同带来的影响</span><br><span class=\"line\"></span><br><span class=\"line\">rpm 包安装的服务可以使用系统服务管理命令（service）管理，例如 rpm 包安装的 Apache 的启动方法是</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>/etc/rc.d/init.d/httpd start # linux 标准启动方法<br>service httpd start</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;b style&#x3D;&quot;color:red&quot;&gt;service 搜索的目录实际上就是 &#96;&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;&#96; 目录&lt;&#x2F;b&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">源码包安装必须指定安装位置，一般是 &#96;&#x2F;usr&#x2F;local&#x2F;软件名&#x2F;&#96;，相当于 Windows 下的 &#96;C:\\Programs&#96;，因为源码包没有卸载命令，直接删除安装目录就是卸载。</span><br><span class=\"line\"></span><br><span class=\"line\">源码包安装的服务不能被服务管理命令管理，因为没有安卓到默认路径中。所以只能用绝对路径进行服务的管理，如：</span><br></pre></td></tr></table></figure>\n<p>/usr/local/apache2/bin/apachectl start</p>\n<pre><code>### 4. 源码包安装软件\n\n#### 1. 安装准备：\n\n- 安装 C 语言编译器 `rpm -qa | grep gcc`\n- 下载源码包，一般都是由官方网站提供\n\n\n&lt;b style=&quot;color:red&quot;&gt;原则：给大量用户提供服务的软件，建议使用源码包安装，因为源码包效率更高\n\n不太影响效率的软件，可以使用 rpm 包安装&lt;/b&gt;\n\n#### 2. 安装注意事项\n\n- 源代码保存位置：`/usr/local/src`\n- 软件安装位置：`/usr/local/`\n- 如何确定安装过程报错\n  - 安装过程停止\n  - 并且最后几行出现 error、warning 或 no 的提示\n\n#### 3. 安装过程\n1. 下载源码包\n2. 解压安装包\n3. 进入到解压缩目录\n4. `./configure` 软件配置与检查\n  - 定义需要的功能选项；\n  - 监测系统环境是否符合安装要求；\n  - 把定义好的功能选项和检测系统环境的信息都写到 Makefile 文件，用于后续的编辑。\n\n5.  `make` 编译，如果有报错，使用 `make clean` 清除缓存文件\n6. `make install` 编译安装\n\n### 5. 脚本安装软件\n\n所谓的一键安装包，实际上还是安装的源码包和 rpm 包，只是把安装过程写成了脚本，便于初学者安装\n\n优点：简单、快速、方便\n\n缺点：\n- 不能定义安装软件的版本\n- 不能定义所需要的软件功能\n- 源码包的优势（自定义、安装位置、依赖等）丧失\n\n\n\n\n</code></pre>\n","site":{"data":{}},"excerpt":"<h2 id=\"linux-安装软件\"><a href=\"#linux-安装软件\" class=\"headerlink\" title=\"linux 安装软件\"></a>linux 安装软件</h2><p>只有两种方式，源码（二进制文件）编译和 rpm 包，yum 其实也是 rpm 包的一种在线安装方式，并解决了依赖问题。但是不支持查询和校验。</p>","more":"<h3 id=\"1-rpm-安装\"><a href=\"#1-rpm-安装\" class=\"headerlink\" title=\"1. rpm 安装\"></a>1. rpm 安装</h3><h4 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh 软件包全名</span><br><span class=\"line\">rpm -ivh httpd-2.2.15-15.e16.centos.1.i686.rpm</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>i：install</li>\n<li>v：verbose，显示指令执行过程；</li>\n<li>h：hash，显示安装百分比</li>\n</ul>\n<h4 id=\"2-升级\"><a href=\"#2-升级\" class=\"headerlink\" title=\"2. 升级\"></a>2. 升级</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -Uvh 软件包全名</span><br><span class=\"line\">rpm -Uvh httpd-2.2.15-15.e16.centos.1.i686.rpm</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>U：upgrade 升级</li>\n</ul>\n<p>如果没有安装过，相当于全新安装</p>\n<h4 id=\"3-卸载\"><a href=\"#3-卸载\" class=\"headerlink\" title=\"3. 卸载\"></a>3. 卸载</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -e 包名，而不是包全名，只有安装和升级需要包全名</span><br><span class=\"line\">rpm -e httpd &#x2F;&#x2F; 系统会去 &#x2F;var&#x2F;lib&#x2F;rpm 目录下的数据库中找</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>e：erase，删除</li>\n<li>–nodeps：不检查依赖，实际环境中不允许使用</li>\n</ul>\n<p>卸载的依赖顺序和安装时的依赖顺序相反</p>\n<p>rpm 包一定要解决依赖性才可以正确安装和卸载</p>\n<p>为什么会有卸载命令？源码安装就没有卸载命令。因为 rpm 包安装的位置为系统默认位置，分布在系统的各个位置，想要卸载所有的文件非常麻烦，所以设置了一个卸载命令。</p>\n<h4 id=\"4-rpm-包查询\"><a href=\"#4-rpm-包查询\" class=\"headerlink\" title=\"4. rpm 包查询\"></a>4. rpm 包查询</h4><h5 id=\"1-系统是否已安装软件\"><a href=\"#1-系统是否已安装软件\" class=\"headerlink\" title=\"1. 系统是否已安装软件\"></a>1. 系统是否已安装软件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -q 包名</span><br><span class=\"line\">rpm -q httpd</span><br></pre></td></tr></table></figure>\n<ul>\n<li>q：query</li>\n<li>a：all</li>\n</ul>\n<h5 id=\"2-查询系统中所有已安装的软件\"><a href=\"#2-查询系统中所有已安装的软件\" class=\"headerlink\" title=\"2. 查询系统中所有已安装的软件\"></a>2. 查询系统中所有已安装的软件</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qa | grep httpd</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"3-查询软件包详细信息\"><a href=\"#3-查询软件包详细信息\" class=\"headerlink\" title=\"3. 查询软件包详细信息\"></a>3. 查询软件包详细信息</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qi 包名</span><br><span class=\"line\">rpm -qi httpd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>i：information</li>\n<li>p：package，查询未安装包信息</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qip 包全名</span><br><span class=\"line\">rpm -qi httpd-2.2.15-15.e16.centos.1.i686.rpm</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"4-查询包中文件安装位置\"><a href=\"#4-查询包中文件安装位置\" class=\"headerlink\" title=\"4. 查询包中文件安装位置\"></a>4. 查询包中文件安装位置</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ql 包名</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>l：list，列表</li>\n</ul>\n<h5 id=\"5-rpm-包默认安装路径\"><a href=\"#5-rpm-包默认安装路径\" class=\"headerlink\" title=\"5. rpm 包默认安装路径\"></a>5. rpm 包默认安装路径</h5><table>\n<thead>\n<tr>\n<th>路径</th>\n<th align=\"center\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>/etc</td>\n<td align=\"center\">配置文件安装目录</td>\n</tr>\n<tr>\n<td>/usr/bin/</td>\n<td align=\"center\">可执行命令安装目录</td>\n</tr>\n<tr>\n<td>/usr/lib</td>\n<td align=\"center\">程序所使用的函数库保存位置</td>\n</tr>\n<tr>\n<td>/usr/share/doc/</td>\n<td align=\"center\">基本的软件使用手册保存位置</td>\n</tr>\n<tr>\n<td>/usr/share/man/</td>\n<td align=\"center\">帮助文件保存位置</td>\n</tr>\n</tbody></table>\n<h5 id=\"6-查询系统文件（rpm-安装生成的文件）属于哪个-rpm-包\"><a href=\"#6-查询系统文件（rpm-安装生成的文件）属于哪个-rpm-包\" class=\"headerlink\" title=\"6. 查询系统文件（rpm 安装生成的文件）属于哪个 rpm 包\"></a>6. 查询系统文件（rpm 安装生成的文件）属于哪个 rpm 包</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qf 系统文件名</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"7-查询软件包的依赖性\"><a href=\"#7-查询软件包的依赖性\" class=\"headerlink\" title=\"7. 查询软件包的依赖性\"></a>7. 查询软件包的依赖性</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qR 包名</span><br><span class=\"line\">rpm -qR httpd</span><br></pre></td></tr></table></figure>\n<p>查询结果没什么意义，还不如一步步安装，根据提示来安装各种依赖</p>\n<ul>\n<li>R：requires</li>\n</ul>\n<h4 id=\"4-rpm-包校验\"><a href=\"#4-rpm-包校验\" class=\"headerlink\" title=\"4. rpm 包校验\"></a>4. rpm 包校验</h4><p>包含 md5 校验、文件修改时间校验等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -V 已安装的包名</span><br><span class=\"line\">rpm -V httpd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>V：verify</li>\n</ul>\n<p>如果没有任何输出，表示校验通过，文件没有被修改</p>\n<h4 id=\"5-rpm-包内文件提取\"><a href=\"#5-rpm-包内文件提取\" class=\"headerlink\" title=\"5. rpm 包内文件提取\"></a>5. rpm 包内文件提取</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm2cpio 包全名 | cpio -idv .文件绝对路径</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>rpm2cpio：将 rpm 包转换为 cpio 格式的命令</li>\n<li>cpio：是一个标准工具，它用于创建软件档案文件和从档案文件中提取文件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cpio 选项 &lt; [文件|设备]</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>i：copy-in 模式，还原</li>\n<li>d：还原时自动新建目录</li>\n<li>v：显示还原过程</li>\n</ul>\n<p>示例</p>\n<h5 id=\"1-查询-ls-命令属于哪个-rpm-包\"><a href=\"#1-查询-ls-命令属于哪个-rpm-包\" class=\"headerlink\" title=\"1. 查询 ls 命令属于哪个 rpm 包\"></a>1. 查询 ls 命令属于哪个 rpm 包</h5><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -qf &#x2F;bin&#x2F;ls</span><br><span class=\"line\">&#96;&#96;&#96; </span><br><span class=\"line\"></span><br><span class=\"line\">##### 2. 造成 ls 命令误删除假象</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>mv /bin/ls /tmp/</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">##### 3. 提取 rpm 包中 ls 命令到当前目录的 &#x2F;bin&#x2F;ls</span><br><span class=\"line\"> 下</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>rpm2cpio /mnt/cdrom/Packages/coreutils-8.4-19.el6.i686.rpm | cpio -idv ./bin/ls</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">##### 4. 把 ls 命令复制到 &#x2F;bin&#x2F; 目录，修复文件丢失</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>cp /root/bin/ls /bin/</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 2. yum 在线安装</span><br><span class=\"line\"></span><br><span class=\"line\">网络下载</span><br><span class=\"line\"></span><br><span class=\"line\">rpm 包的安装过程中，依赖性太强，使用难度较大。</span><br><span class=\"line\"></span><br><span class=\"line\">yum 好处：将所有软件包放到官方服务器上，当进行 yum 在线安装时，可以自动解决依赖性问题。</span><br><span class=\"line\"></span><br><span class=\"line\">Redhat 的 yum 在线安装需要付费，CentOS 的 yum 免费</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1. yum 源文件</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;etc&#x2F;yum&#x2F;repos.d&#x2F;CentOS-Base.repo</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>[base]<br>name=CentOS-$releasever - Base - mirrors.aliyun.com<br>failovermethod=priority<br>baseurl=<a href=\"http://mirrors.aliyun.com/centos/$releasever/os/$basearch/\">http://mirrors.aliyun.com/centos/$releasever/os/$basearch/</a><br>        <a href=\"http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/\">http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/</a><br>#mirrorlist=<a href=\"http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os\">http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os</a><br>gpgcheck=1<br>gpgkey=<a href=\"http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\">http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![](http:&#x2F;&#x2F;omp48p40q.bkt.clouddn.com&#x2F;18-2-18&#x2F;43605225.jpg)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#### 2. yum 命令</span><br><span class=\"line\"></span><br><span class=\"line\">##### 1. 查询</span><br><span class=\"line\"></span><br><span class=\"line\">查询所有可用软件包列表</span><br></pre></td></tr></table></figure>\n<p>yum list</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">搜索服务器上所有和关键字相关的包</span><br></pre></td></tr></table></figure>\n<p>yum search 关键字</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">##### 2. 安装</span><br><span class=\"line\"></span><br><span class=\"line\">yum 安装不需要写包全名</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>yum -y install 包名<br>yum -y install gcc</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- install：安装</span><br><span class=\"line\">- y：自动回答 yes</span><br><span class=\"line\"></span><br><span class=\"line\">##### 3. 升级</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>yum -y update 包名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;b style&#x3D;&#39;color:red&#39;&gt;稳定和安全为主，没必要尽量不要升级&lt;&#x2F;b&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">##### 4. 卸载</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>yum -y remove 包名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">卸载也是要卸载各种依赖，很容易造成系统崩溃</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;b style&#x3D;&#39;color:red&#39;&gt;服务器使用最小化安装，用什么软件安装什么，尽量不卸载&lt;&#x2F;b&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">#### yum 软件组管理命令</span><br><span class=\"line\"></span><br><span class=\"line\">列出所有可用的软件组列表</span><br></pre></td></tr></table></figure>\n<p>yum grouplist</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">安装指定软件组，组名可以由 grouplist 查询处理</span><br></pre></td></tr></table></figure>\n<p>yum groupinstall 软件组名（必须英文）<br>yum groupinstall “Chinese Support”</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">卸载指定软件组</span><br></pre></td></tr></table></figure>\n<p>yum groupremove 软件组名</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">### 3. 源码包和 rpm 包的区别</span><br><span class=\"line\"></span><br><span class=\"line\">- 安装之前的区别：概念上的区别</span><br><span class=\"line\">- 安装之后的区别：安装位置不同</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">rpm 包安装在默认位置（包作者所指定的位置），可以指定安装位置，但是强烈不建议这么做。</span><br><span class=\"line\"></span><br><span class=\"line\">#### 1. 安装位置不同带来的影响</span><br><span class=\"line\"></span><br><span class=\"line\">rpm 包安装的服务可以使用系统服务管理命令（service）管理，例如 rpm 包安装的 Apache 的启动方法是</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>/etc/rc.d/init.d/httpd start # linux 标准启动方法<br>service httpd start</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;b style&#x3D;&quot;color:red&quot;&gt;service 搜索的目录实际上就是 &#96;&#x2F;etc&#x2F;rc.d&#x2F;init.d&#x2F;&#96; 目录&lt;&#x2F;b&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">源码包安装必须指定安装位置，一般是 &#96;&#x2F;usr&#x2F;local&#x2F;软件名&#x2F;&#96;，相当于 Windows 下的 &#96;C:\\Programs&#96;，因为源码包没有卸载命令，直接删除安装目录就是卸载。</span><br><span class=\"line\"></span><br><span class=\"line\">源码包安装的服务不能被服务管理命令管理，因为没有安卓到默认路径中。所以只能用绝对路径进行服务的管理，如：</span><br></pre></td></tr></table></figure>\n<p>/usr/local/apache2/bin/apachectl start</p>\n<pre><code>### 4. 源码包安装软件\n\n#### 1. 安装准备：\n\n- 安装 C 语言编译器 `rpm -qa | grep gcc`\n- 下载源码包，一般都是由官方网站提供\n\n\n&lt;b style=&quot;color:red&quot;&gt;原则：给大量用户提供服务的软件，建议使用源码包安装，因为源码包效率更高\n\n不太影响效率的软件，可以使用 rpm 包安装&lt;/b&gt;\n\n#### 2. 安装注意事项\n\n- 源代码保存位置：`/usr/local/src`\n- 软件安装位置：`/usr/local/`\n- 如何确定安装过程报错\n  - 安装过程停止\n  - 并且最后几行出现 error、warning 或 no 的提示\n\n#### 3. 安装过程\n1. 下载源码包\n2. 解压安装包\n3. 进入到解压缩目录\n4. `./configure` 软件配置与检查\n  - 定义需要的功能选项；\n  - 监测系统环境是否符合安装要求；\n  - 把定义好的功能选项和检测系统环境的信息都写到 Makefile 文件，用于后续的编辑。\n\n5.  `make` 编译，如果有报错，使用 `make clean` 清除缓存文件\n6. `make install` 编译安装\n\n### 5. 脚本安装软件\n\n所谓的一键安装包，实际上还是安装的源码包和 rpm 包，只是把安装过程写成了脚本，便于初学者安装\n\n优点：简单、快速、方便\n\n缺点：\n- 不能定义安装软件的版本\n- 不能定义所需要的软件功能\n- 源码包的优势（自定义、安装位置、依赖等）丧失\n\n\n\n\n</code></pre>"},{"title":"MVC 框架工作原理","date":"2018-02-16T10:38:37.000Z","_content":"\n### 1. 真题：谈谈你对 MVC 的认识，介绍几种目前比较流行的 MVC 框架\n\n考点：\n- MVC 工作原理\n- 常见 MVC 框架\n- 单一入口的理解\n- 模板引擎的理解\n\n<!-- more -->\n\n#### 1. MVC 工作原理\n- M: Model，数据模型层，通过对数据进行一些加工和处理，数据相关的操作基本都在 Model 层里操作。\n- V: View，视图层，跟用户进行交互的页面都在 View 层处理。\n- C: Controller，业务处理层，处理业务逻辑。\n\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-16/56348745.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-16/78897666.jpg)\n\n#### 2. 常见MVC 框架\n\nThinkPHP、Yii2、CI、Laravel、Symfony、Yaf\n\n\n#### 3. 单一入口的工作原理\n\n用一个处理程序文件处理所有的 HTTP 请求，根据请求时的参数的不同区分不同模块和操作的请求\n\n优势：\n- 可以进行统一的安全性检查\n- 集中处理程序\n\n劣势：\n- URL 不美观，可通过 URL 重写机制修改\n- 处理效率稍低\n\n#### 4. 模板引擎\nPHP 是一种 HTML 内嵌式的在服务端执行的脚本语言，但是 PHP 有很多可以使 PHP 代码和 HTML 代码分开的模板引擎，如 <b style='color:red;'>Smarty</b>、Twig、Haml、Liquid、blade 等。\n\n工作原理：<b style=\"color:red;\">模板引擎就是庞大的完善的正则表达式替换库</b>\n\n真题：框架中什么是单一入口和多入口，单一入口的优缺点\n\n### 2. PHP 框架有哪些，用过哪些？各自的优缺点是什么？\n\n考点：PHP 框架的差异和优缺点\n\n#### 1. Yaf \n使用 PHP 扩展的形式写的一个 PHP 框架，也就是以 C 语言为底层编写的，性能上要比 PHP 代码写的框架要快一个数量级。\n\n- 优点：执行效率高、轻量级框架、可扩展性强\n- 缺点：高版本兼容性差、底层代码可读性差、需要安装扩展、功能单一、开发需要编写大量插件，影响开发效率\n\n#### 2.Yii2 \n是一款非常优秀的通用 web 后端框架，结构简单优雅、实用功能丰富、扩展性强、性能高是它最突出的优点。\n\n- 缺点：功能多，学习成本较高；相比 Yaf，量级较重\n\n#### 3. 常见框架特性\n根据自己的框架实用经验，理解所使用框架的特性。例如，YII2 框架的路由配置等。\n\n此类题目，说明的最好是自己真正用过的框架，最好结合自己的简历，简历当中提高的框架，要着重准备，可以说说在开发过程中使用该框架最让你印象深刻的功能和特性，最好多进行框架间的对比，展现你对 PHP 框架的理解，侧面说明你的开发经验。\n\n#### 4. 真题：Yii2 框架如何实现数据的自动验证？\n\n在 Model 中编写一个 rules 规则，在 rules 里面写验证规则，数据接收以后调用 validate 方法进行验证，验证成功后才可以进行数据的 curd 操作。\n\n\n\n\n","source":"_posts/MVC-框架工作原理.md","raw":"---\ntitle: MVC 框架工作原理\ndate: 2018-02-16 18:38:37\ntags: MVC\n---\n\n### 1. 真题：谈谈你对 MVC 的认识，介绍几种目前比较流行的 MVC 框架\n\n考点：\n- MVC 工作原理\n- 常见 MVC 框架\n- 单一入口的理解\n- 模板引擎的理解\n\n<!-- more -->\n\n#### 1. MVC 工作原理\n- M: Model，数据模型层，通过对数据进行一些加工和处理，数据相关的操作基本都在 Model 层里操作。\n- V: View，视图层，跟用户进行交互的页面都在 View 层处理。\n- C: Controller，业务处理层，处理业务逻辑。\n\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-16/56348745.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-16/78897666.jpg)\n\n#### 2. 常见MVC 框架\n\nThinkPHP、Yii2、CI、Laravel、Symfony、Yaf\n\n\n#### 3. 单一入口的工作原理\n\n用一个处理程序文件处理所有的 HTTP 请求，根据请求时的参数的不同区分不同模块和操作的请求\n\n优势：\n- 可以进行统一的安全性检查\n- 集中处理程序\n\n劣势：\n- URL 不美观，可通过 URL 重写机制修改\n- 处理效率稍低\n\n#### 4. 模板引擎\nPHP 是一种 HTML 内嵌式的在服务端执行的脚本语言，但是 PHP 有很多可以使 PHP 代码和 HTML 代码分开的模板引擎，如 <b style='color:red;'>Smarty</b>、Twig、Haml、Liquid、blade 等。\n\n工作原理：<b style=\"color:red;\">模板引擎就是庞大的完善的正则表达式替换库</b>\n\n真题：框架中什么是单一入口和多入口，单一入口的优缺点\n\n### 2. PHP 框架有哪些，用过哪些？各自的优缺点是什么？\n\n考点：PHP 框架的差异和优缺点\n\n#### 1. Yaf \n使用 PHP 扩展的形式写的一个 PHP 框架，也就是以 C 语言为底层编写的，性能上要比 PHP 代码写的框架要快一个数量级。\n\n- 优点：执行效率高、轻量级框架、可扩展性强\n- 缺点：高版本兼容性差、底层代码可读性差、需要安装扩展、功能单一、开发需要编写大量插件，影响开发效率\n\n#### 2.Yii2 \n是一款非常优秀的通用 web 后端框架，结构简单优雅、实用功能丰富、扩展性强、性能高是它最突出的优点。\n\n- 缺点：功能多，学习成本较高；相比 Yaf，量级较重\n\n#### 3. 常见框架特性\n根据自己的框架实用经验，理解所使用框架的特性。例如，YII2 框架的路由配置等。\n\n此类题目，说明的最好是自己真正用过的框架，最好结合自己的简历，简历当中提高的框架，要着重准备，可以说说在开发过程中使用该框架最让你印象深刻的功能和特性，最好多进行框架间的对比，展现你对 PHP 框架的理解，侧面说明你的开发经验。\n\n#### 4. 真题：Yii2 框架如何实现数据的自动验证？\n\n在 Model 中编写一个 rules 规则，在 rules 里面写验证规则，数据接收以后调用 validate 方法进行验证，验证成功后才可以进行数据的 curd 操作。\n\n\n\n\n","slug":"MVC-框架工作原理","published":1,"updated":"2020-09-11T01:04:35.035Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz87000u6wo112xace51","content":"<h3 id=\"1-真题：谈谈你对-MVC-的认识，介绍几种目前比较流行的-MVC-框架\"><a href=\"#1-真题：谈谈你对-MVC-的认识，介绍几种目前比较流行的-MVC-框架\" class=\"headerlink\" title=\"1. 真题：谈谈你对 MVC 的认识，介绍几种目前比较流行的 MVC 框架\"></a>1. 真题：谈谈你对 MVC 的认识，介绍几种目前比较流行的 MVC 框架</h3><p>考点：</p>\n<ul>\n<li>MVC 工作原理</li>\n<li>常见 MVC 框架</li>\n<li>单一入口的理解</li>\n<li>模板引擎的理解</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"1-MVC-工作原理\"><a href=\"#1-MVC-工作原理\" class=\"headerlink\" title=\"1. MVC 工作原理\"></a>1. MVC 工作原理</h4><ul>\n<li>M: Model，数据模型层，通过对数据进行一些加工和处理，数据相关的操作基本都在 Model 层里操作。</li>\n<li>V: View，视图层，跟用户进行交互的页面都在 View 层处理。</li>\n<li>C: Controller，业务处理层，处理业务逻辑。</li>\n</ul>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-2-16/56348745.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-2-16/78897666.jpg\"></p>\n<h4 id=\"2-常见MVC-框架\"><a href=\"#2-常见MVC-框架\" class=\"headerlink\" title=\"2. 常见MVC 框架\"></a>2. 常见MVC 框架</h4><p>ThinkPHP、Yii2、CI、Laravel、Symfony、Yaf</p>\n<h4 id=\"3-单一入口的工作原理\"><a href=\"#3-单一入口的工作原理\" class=\"headerlink\" title=\"3. 单一入口的工作原理\"></a>3. 单一入口的工作原理</h4><p>用一个处理程序文件处理所有的 HTTP 请求，根据请求时的参数的不同区分不同模块和操作的请求</p>\n<p>优势：</p>\n<ul>\n<li>可以进行统一的安全性检查</li>\n<li>集中处理程序</li>\n</ul>\n<p>劣势：</p>\n<ul>\n<li>URL 不美观，可通过 URL 重写机制修改</li>\n<li>处理效率稍低</li>\n</ul>\n<h4 id=\"4-模板引擎\"><a href=\"#4-模板引擎\" class=\"headerlink\" title=\"4. 模板引擎\"></a>4. 模板引擎</h4><p>PHP 是一种 HTML 内嵌式的在服务端执行的脚本语言，但是 PHP 有很多可以使 PHP 代码和 HTML 代码分开的模板引擎，如 <b style='color:red;'>Smarty</b>、Twig、Haml、Liquid、blade 等。</p>\n<p>工作原理：<b style=\"color:red;\">模板引擎就是庞大的完善的正则表达式替换库</b></p>\n<p>真题：框架中什么是单一入口和多入口，单一入口的优缺点</p>\n<h3 id=\"2-PHP-框架有哪些，用过哪些？各自的优缺点是什么？\"><a href=\"#2-PHP-框架有哪些，用过哪些？各自的优缺点是什么？\" class=\"headerlink\" title=\"2. PHP 框架有哪些，用过哪些？各自的优缺点是什么？\"></a>2. PHP 框架有哪些，用过哪些？各自的优缺点是什么？</h3><p>考点：PHP 框架的差异和优缺点</p>\n<h4 id=\"1-Yaf\"><a href=\"#1-Yaf\" class=\"headerlink\" title=\"1. Yaf\"></a>1. Yaf</h4><p>使用 PHP 扩展的形式写的一个 PHP 框架，也就是以 C 语言为底层编写的，性能上要比 PHP 代码写的框架要快一个数量级。</p>\n<ul>\n<li>优点：执行效率高、轻量级框架、可扩展性强</li>\n<li>缺点：高版本兼容性差、底层代码可读性差、需要安装扩展、功能单一、开发需要编写大量插件，影响开发效率</li>\n</ul>\n<h4 id=\"2-Yii2\"><a href=\"#2-Yii2\" class=\"headerlink\" title=\"2.Yii2\"></a>2.Yii2</h4><p>是一款非常优秀的通用 web 后端框架，结构简单优雅、实用功能丰富、扩展性强、性能高是它最突出的优点。</p>\n<ul>\n<li>缺点：功能多，学习成本较高；相比 Yaf，量级较重</li>\n</ul>\n<h4 id=\"3-常见框架特性\"><a href=\"#3-常见框架特性\" class=\"headerlink\" title=\"3. 常见框架特性\"></a>3. 常见框架特性</h4><p>根据自己的框架实用经验，理解所使用框架的特性。例如，YII2 框架的路由配置等。</p>\n<p>此类题目，说明的最好是自己真正用过的框架，最好结合自己的简历，简历当中提高的框架，要着重准备，可以说说在开发过程中使用该框架最让你印象深刻的功能和特性，最好多进行框架间的对比，展现你对 PHP 框架的理解，侧面说明你的开发经验。</p>\n<h4 id=\"4-真题：Yii2-框架如何实现数据的自动验证？\"><a href=\"#4-真题：Yii2-框架如何实现数据的自动验证？\" class=\"headerlink\" title=\"4. 真题：Yii2 框架如何实现数据的自动验证？\"></a>4. 真题：Yii2 框架如何实现数据的自动验证？</h4><p>在 Model 中编写一个 rules 规则，在 rules 里面写验证规则，数据接收以后调用 validate 方法进行验证，验证成功后才可以进行数据的 curd 操作。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"1-真题：谈谈你对-MVC-的认识，介绍几种目前比较流行的-MVC-框架\"><a href=\"#1-真题：谈谈你对-MVC-的认识，介绍几种目前比较流行的-MVC-框架\" class=\"headerlink\" title=\"1. 真题：谈谈你对 MVC 的认识，介绍几种目前比较流行的 MVC 框架\"></a>1. 真题：谈谈你对 MVC 的认识，介绍几种目前比较流行的 MVC 框架</h3><p>考点：</p>\n<ul>\n<li>MVC 工作原理</li>\n<li>常见 MVC 框架</li>\n<li>单一入口的理解</li>\n<li>模板引擎的理解</li>\n</ul>","more":"<h4 id=\"1-MVC-工作原理\"><a href=\"#1-MVC-工作原理\" class=\"headerlink\" title=\"1. MVC 工作原理\"></a>1. MVC 工作原理</h4><ul>\n<li>M: Model，数据模型层，通过对数据进行一些加工和处理，数据相关的操作基本都在 Model 层里操作。</li>\n<li>V: View，视图层，跟用户进行交互的页面都在 View 层处理。</li>\n<li>C: Controller，业务处理层，处理业务逻辑。</li>\n</ul>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-2-16/56348745.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-2-16/78897666.jpg\"></p>\n<h4 id=\"2-常见MVC-框架\"><a href=\"#2-常见MVC-框架\" class=\"headerlink\" title=\"2. 常见MVC 框架\"></a>2. 常见MVC 框架</h4><p>ThinkPHP、Yii2、CI、Laravel、Symfony、Yaf</p>\n<h4 id=\"3-单一入口的工作原理\"><a href=\"#3-单一入口的工作原理\" class=\"headerlink\" title=\"3. 单一入口的工作原理\"></a>3. 单一入口的工作原理</h4><p>用一个处理程序文件处理所有的 HTTP 请求，根据请求时的参数的不同区分不同模块和操作的请求</p>\n<p>优势：</p>\n<ul>\n<li>可以进行统一的安全性检查</li>\n<li>集中处理程序</li>\n</ul>\n<p>劣势：</p>\n<ul>\n<li>URL 不美观，可通过 URL 重写机制修改</li>\n<li>处理效率稍低</li>\n</ul>\n<h4 id=\"4-模板引擎\"><a href=\"#4-模板引擎\" class=\"headerlink\" title=\"4. 模板引擎\"></a>4. 模板引擎</h4><p>PHP 是一种 HTML 内嵌式的在服务端执行的脚本语言，但是 PHP 有很多可以使 PHP 代码和 HTML 代码分开的模板引擎，如 <b style='color:red;'>Smarty</b>、Twig、Haml、Liquid、blade 等。</p>\n<p>工作原理：<b style=\"color:red;\">模板引擎就是庞大的完善的正则表达式替换库</b></p>\n<p>真题：框架中什么是单一入口和多入口，单一入口的优缺点</p>\n<h3 id=\"2-PHP-框架有哪些，用过哪些？各自的优缺点是什么？\"><a href=\"#2-PHP-框架有哪些，用过哪些？各自的优缺点是什么？\" class=\"headerlink\" title=\"2. PHP 框架有哪些，用过哪些？各自的优缺点是什么？\"></a>2. PHP 框架有哪些，用过哪些？各自的优缺点是什么？</h3><p>考点：PHP 框架的差异和优缺点</p>\n<h4 id=\"1-Yaf\"><a href=\"#1-Yaf\" class=\"headerlink\" title=\"1. Yaf\"></a>1. Yaf</h4><p>使用 PHP 扩展的形式写的一个 PHP 框架，也就是以 C 语言为底层编写的，性能上要比 PHP 代码写的框架要快一个数量级。</p>\n<ul>\n<li>优点：执行效率高、轻量级框架、可扩展性强</li>\n<li>缺点：高版本兼容性差、底层代码可读性差、需要安装扩展、功能单一、开发需要编写大量插件，影响开发效率</li>\n</ul>\n<h4 id=\"2-Yii2\"><a href=\"#2-Yii2\" class=\"headerlink\" title=\"2.Yii2\"></a>2.Yii2</h4><p>是一款非常优秀的通用 web 后端框架，结构简单优雅、实用功能丰富、扩展性强、性能高是它最突出的优点。</p>\n<ul>\n<li>缺点：功能多，学习成本较高；相比 Yaf，量级较重</li>\n</ul>\n<h4 id=\"3-常见框架特性\"><a href=\"#3-常见框架特性\" class=\"headerlink\" title=\"3. 常见框架特性\"></a>3. 常见框架特性</h4><p>根据自己的框架实用经验，理解所使用框架的特性。例如，YII2 框架的路由配置等。</p>\n<p>此类题目，说明的最好是自己真正用过的框架，最好结合自己的简历，简历当中提高的框架，要着重准备，可以说说在开发过程中使用该框架最让你印象深刻的功能和特性，最好多进行框架间的对比，展现你对 PHP 框架的理解，侧面说明你的开发经验。</p>\n<h4 id=\"4-真题：Yii2-框架如何实现数据的自动验证？\"><a href=\"#4-真题：Yii2-框架如何实现数据的自动验证？\" class=\"headerlink\" title=\"4. 真题：Yii2 框架如何实现数据的自动验证？\"></a>4. 真题：Yii2 框架如何实现数据的自动验证？</h4><p>在 Model 中编写一个 rules 规则，在 rules 里面写验证规则，数据接收以后调用 validate 方法进行验证，验证成功后才可以进行数据的 curd 操作。</p>"},{"title":"Mac 下如何快速搭建 PHP 集成环境","date":"2016-11-03T16:00:00.000Z","_content":"\n首先下载 MAMP 集成环境安装包 [MAMP官网](www.mamp.info)。免费版只支持 PHP5.6 和7.0 两个版本，需要其他版本的只能付费下载 MAMP PRO 了。\n\n<!--more-->\n\n下载后安装即可，非常简单\n\n![1.png](http://upload-images.jianshu.io/upload_images/693141-764791532f1931f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![2.png](http://upload-images.jianshu.io/upload_images/693141-bf3fceb62069e051.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n安装完成后点击 start，右上角两个绿灯亮起就说明环境配置成功了。\n\n![3.png](http://upload-images.jianshu.io/upload_images/693141-45f29022729c3323.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n点击设置，可对端口进行设置\n\n![4.png](http://upload-images.jianshu.io/upload_images/693141-ef9d70aec1593730.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n设置端口后需要重新启动 MAMP。回到 MAMP 主页，点击 Open start page，可以打开浏览器，进入主页。这里可以进入 phpinfo 和 phpmyadmin。\n\n![5.png](http://upload-images.jianshu.io/upload_images/693141-c7cd32ac6de73437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nlocalhost 的目录为 ``` /Applications/MAMP/htdocs/ ```\nApache 的配置文件路径为 ``` /Applications/MAMP/conf/apache/httpd.conf ```\nApache 的虚拟主机配置文件路径为 ``` /Applications/MAMP/conf/apache/extra/httpd-vhost.conf ```\n\n配置虚拟主机：\n1. 打开 httpd.conf，取消下面这行的注释 ```# Virtual hosts Include /Applications/MAMP/conf/apache/extra/httpd-vhosts.conf ```\n2. 在 httpd-vhost.conf 中配置虚拟主机\n```\n<VirtualHost *:80>\n    ServerAdmin webmaster@dummy-host.example.com\n    DocumentRoot \"/Applications/MAMP/htdocs/\"\n    ServerName localhost\n    ServerAlias\n    ErrorLog \"logs/dummy-host.example.com-error.log\"\n    CustomLog \"logs/dummy-host.example.com-access.log\" common\n    <Directory \"/Applications/MAMP/htdocs/\">\n        allow from all\n        AllowOverride all\n        Options +indexes\n    </Directory>\n</VirtualHost>\n```\n```\n<VirtualHost *:80>\n    ServerAdmin webmaster@dummy-host.example.com\n    DocumentRoot \"/Applications/MAMP/htdocs/oa\"\n    ServerName www.oa.cc\n    ServerAlias oa.cc\n    ErrorLog \"logs/dummy-host.example.com-error.log\"\n    CustomLog \"logs/dummy-host.example.com-access.log\" common\n    <Directory \"/Applications/MAMP/htdocs/oa\">\n        allow from all\n        AllowOverride all\n        Options +indexes\n    </Directory>\n</VirtualHost>\n```\n3. 配置完成后重启 MAMP（** 注意关掉 shadowsocks 等代理软件 **）\n4. 在 hosts 文件中添加 DNS 解析，即可通过域名访问本地脚本文件。有两种方式\n  1. 在 Finder 上右键，选择Go to Folder...，输入```/private/etc```， 找到 hosts 文件，复制到其他地方，使用文本编辑器进行编辑，添加需要解析的行，如```127.0.0.1 www.oa.com oa.com```，保存后退出，复制，然后回到 etc 目录，粘贴，选择替换。\n2. 打开终端 terminal，运行```sudo vim /private/etc/hosts```，就可以进行编辑了。编辑完成后保存即可。\n\n\n","source":"_posts/Mac-下如何快速搭建-PHP-集成环境.md","raw":"---\ntitle: Mac 下如何快速搭建 PHP 集成环境\ndate: 2016-11-04\ntags: mac\n---\n\n首先下载 MAMP 集成环境安装包 [MAMP官网](www.mamp.info)。免费版只支持 PHP5.6 和7.0 两个版本，需要其他版本的只能付费下载 MAMP PRO 了。\n\n<!--more-->\n\n下载后安装即可，非常简单\n\n![1.png](http://upload-images.jianshu.io/upload_images/693141-764791532f1931f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![2.png](http://upload-images.jianshu.io/upload_images/693141-bf3fceb62069e051.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n安装完成后点击 start，右上角两个绿灯亮起就说明环境配置成功了。\n\n![3.png](http://upload-images.jianshu.io/upload_images/693141-45f29022729c3323.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n点击设置，可对端口进行设置\n\n![4.png](http://upload-images.jianshu.io/upload_images/693141-ef9d70aec1593730.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n设置端口后需要重新启动 MAMP。回到 MAMP 主页，点击 Open start page，可以打开浏览器，进入主页。这里可以进入 phpinfo 和 phpmyadmin。\n\n![5.png](http://upload-images.jianshu.io/upload_images/693141-c7cd32ac6de73437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nlocalhost 的目录为 ``` /Applications/MAMP/htdocs/ ```\nApache 的配置文件路径为 ``` /Applications/MAMP/conf/apache/httpd.conf ```\nApache 的虚拟主机配置文件路径为 ``` /Applications/MAMP/conf/apache/extra/httpd-vhost.conf ```\n\n配置虚拟主机：\n1. 打开 httpd.conf，取消下面这行的注释 ```# Virtual hosts Include /Applications/MAMP/conf/apache/extra/httpd-vhosts.conf ```\n2. 在 httpd-vhost.conf 中配置虚拟主机\n```\n<VirtualHost *:80>\n    ServerAdmin webmaster@dummy-host.example.com\n    DocumentRoot \"/Applications/MAMP/htdocs/\"\n    ServerName localhost\n    ServerAlias\n    ErrorLog \"logs/dummy-host.example.com-error.log\"\n    CustomLog \"logs/dummy-host.example.com-access.log\" common\n    <Directory \"/Applications/MAMP/htdocs/\">\n        allow from all\n        AllowOverride all\n        Options +indexes\n    </Directory>\n</VirtualHost>\n```\n```\n<VirtualHost *:80>\n    ServerAdmin webmaster@dummy-host.example.com\n    DocumentRoot \"/Applications/MAMP/htdocs/oa\"\n    ServerName www.oa.cc\n    ServerAlias oa.cc\n    ErrorLog \"logs/dummy-host.example.com-error.log\"\n    CustomLog \"logs/dummy-host.example.com-access.log\" common\n    <Directory \"/Applications/MAMP/htdocs/oa\">\n        allow from all\n        AllowOverride all\n        Options +indexes\n    </Directory>\n</VirtualHost>\n```\n3. 配置完成后重启 MAMP（** 注意关掉 shadowsocks 等代理软件 **）\n4. 在 hosts 文件中添加 DNS 解析，即可通过域名访问本地脚本文件。有两种方式\n  1. 在 Finder 上右键，选择Go to Folder...，输入```/private/etc```， 找到 hosts 文件，复制到其他地方，使用文本编辑器进行编辑，添加需要解析的行，如```127.0.0.1 www.oa.com oa.com```，保存后退出，复制，然后回到 etc 目录，粘贴，选择替换。\n2. 打开终端 terminal，运行```sudo vim /private/etc/hosts```，就可以进行编辑了。编辑完成后保存即可。\n\n\n","slug":"Mac-下如何快速搭建-PHP-集成环境","published":1,"updated":"2020-09-11T01:04:35.036Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz88000x6wo12kww9iqt","content":"<p>首先下载 MAMP 集成环境安装包 <a href=\"www.mamp.info\">MAMP官网</a>。免费版只支持 PHP5.6 和7.0 两个版本，需要其他版本的只能付费下载 MAMP PRO 了。</p>\n<a id=\"more\"></a>\n\n<p>下载后安装即可，非常简单</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-764791532f1931f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"1.png\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-bf3fceb62069e051.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"2.png\"></p>\n<p>安装完成后点击 start，右上角两个绿灯亮起就说明环境配置成功了。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-45f29022729c3323.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"3.png\"></p>\n<p>点击设置，可对端口进行设置</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-ef9d70aec1593730.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"4.png\"></p>\n<p>设置端口后需要重新启动 MAMP。回到 MAMP 主页，点击 Open start page，可以打开浏览器，进入主页。这里可以进入 phpinfo 和 phpmyadmin。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-c7cd32ac6de73437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"5.png\"></p>\n<p>localhost 的目录为 <code>/Applications/MAMP/htdocs/</code><br>Apache 的配置文件路径为 <code>/Applications/MAMP/conf/apache/httpd.conf</code><br>Apache 的虚拟主机配置文件路径为 <code>/Applications/MAMP/conf/apache/extra/httpd-vhost.conf</code></p>\n<p>配置虚拟主机：</p>\n<ol>\n<li>打开 httpd.conf，取消下面这行的注释 <code># Virtual hosts Include /Applications/MAMP/conf/apache/extra/httpd-vhosts.conf </code></li>\n<li>在 httpd-vhost.conf 中配置虚拟主机<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:80&gt;</span><br><span class=\"line\">    ServerAdmin webmaster@dummy-host.example.com</span><br><span class=\"line\">    DocumentRoot &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;&quot;</span><br><span class=\"line\">    ServerName localhost</span><br><span class=\"line\">    ServerAlias</span><br><span class=\"line\">    ErrorLog &quot;logs&#x2F;dummy-host.example.com-error.log&quot;</span><br><span class=\"line\">    CustomLog &quot;logs&#x2F;dummy-host.example.com-access.log&quot; common</span><br><span class=\"line\">    &lt;Directory &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;&quot;&gt;</span><br><span class=\"line\">        allow from all</span><br><span class=\"line\">        AllowOverride all</span><br><span class=\"line\">        Options +indexes</span><br><span class=\"line\">    &lt;&#x2F;Directory&gt;</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:80&gt;</span><br><span class=\"line\">    ServerAdmin webmaster@dummy-host.example.com</span><br><span class=\"line\">    DocumentRoot &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;oa&quot;</span><br><span class=\"line\">    ServerName www.oa.cc</span><br><span class=\"line\">    ServerAlias oa.cc</span><br><span class=\"line\">    ErrorLog &quot;logs&#x2F;dummy-host.example.com-error.log&quot;</span><br><span class=\"line\">    CustomLog &quot;logs&#x2F;dummy-host.example.com-access.log&quot; common</span><br><span class=\"line\">    &lt;Directory &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;oa&quot;&gt;</span><br><span class=\"line\">        allow from all</span><br><span class=\"line\">        AllowOverride all</span><br><span class=\"line\">        Options +indexes</span><br><span class=\"line\">    &lt;&#x2F;Directory&gt;</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure></li>\n<li>配置完成后重启 MAMP（** 注意关掉 shadowsocks 等代理软件 **）</li>\n<li>在 hosts 文件中添加 DNS 解析，即可通过域名访问本地脚本文件。有两种方式<ol>\n<li>在 Finder 上右键，选择Go to Folder…，输入<code>/private/etc</code>， 找到 hosts 文件，复制到其他地方，使用文本编辑器进行编辑，添加需要解析的行，如<code>127.0.0.1 www.oa.com oa.com</code>，保存后退出，复制，然后回到 etc 目录，粘贴，选择替换。</li>\n</ol>\n</li>\n<li>打开终端 terminal，运行<code>sudo vim /private/etc/hosts</code>，就可以进行编辑了。编辑完成后保存即可。</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>首先下载 MAMP 集成环境安装包 <a href=\"www.mamp.info\">MAMP官网</a>。免费版只支持 PHP5.6 和7.0 两个版本，需要其他版本的只能付费下载 MAMP PRO 了。</p>","more":"<p>下载后安装即可，非常简单</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-764791532f1931f5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"1.png\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-bf3fceb62069e051.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"2.png\"></p>\n<p>安装完成后点击 start，右上角两个绿灯亮起就说明环境配置成功了。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-45f29022729c3323.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"3.png\"></p>\n<p>点击设置，可对端口进行设置</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-ef9d70aec1593730.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"4.png\"></p>\n<p>设置端口后需要重新启动 MAMP。回到 MAMP 主页，点击 Open start page，可以打开浏览器，进入主页。这里可以进入 phpinfo 和 phpmyadmin。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-c7cd32ac6de73437.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"5.png\"></p>\n<p>localhost 的目录为 <code>/Applications/MAMP/htdocs/</code><br>Apache 的配置文件路径为 <code>/Applications/MAMP/conf/apache/httpd.conf</code><br>Apache 的虚拟主机配置文件路径为 <code>/Applications/MAMP/conf/apache/extra/httpd-vhost.conf</code></p>\n<p>配置虚拟主机：</p>\n<ol>\n<li>打开 httpd.conf，取消下面这行的注释 <code># Virtual hosts Include /Applications/MAMP/conf/apache/extra/httpd-vhosts.conf </code></li>\n<li>在 httpd-vhost.conf 中配置虚拟主机<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:80&gt;</span><br><span class=\"line\">    ServerAdmin webmaster@dummy-host.example.com</span><br><span class=\"line\">    DocumentRoot &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;&quot;</span><br><span class=\"line\">    ServerName localhost</span><br><span class=\"line\">    ServerAlias</span><br><span class=\"line\">    ErrorLog &quot;logs&#x2F;dummy-host.example.com-error.log&quot;</span><br><span class=\"line\">    CustomLog &quot;logs&#x2F;dummy-host.example.com-access.log&quot; common</span><br><span class=\"line\">    &lt;Directory &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;&quot;&gt;</span><br><span class=\"line\">        allow from all</span><br><span class=\"line\">        AllowOverride all</span><br><span class=\"line\">        Options +indexes</span><br><span class=\"line\">    &lt;&#x2F;Directory&gt;</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:80&gt;</span><br><span class=\"line\">    ServerAdmin webmaster@dummy-host.example.com</span><br><span class=\"line\">    DocumentRoot &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;oa&quot;</span><br><span class=\"line\">    ServerName www.oa.cc</span><br><span class=\"line\">    ServerAlias oa.cc</span><br><span class=\"line\">    ErrorLog &quot;logs&#x2F;dummy-host.example.com-error.log&quot;</span><br><span class=\"line\">    CustomLog &quot;logs&#x2F;dummy-host.example.com-access.log&quot; common</span><br><span class=\"line\">    &lt;Directory &quot;&#x2F;Applications&#x2F;MAMP&#x2F;htdocs&#x2F;oa&quot;&gt;</span><br><span class=\"line\">        allow from all</span><br><span class=\"line\">        AllowOverride all</span><br><span class=\"line\">        Options +indexes</span><br><span class=\"line\">    &lt;&#x2F;Directory&gt;</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure></li>\n<li>配置完成后重启 MAMP（** 注意关掉 shadowsocks 等代理软件 **）</li>\n<li>在 hosts 文件中添加 DNS 解析，即可通过域名访问本地脚本文件。有两种方式<ol>\n<li>在 Finder 上右键，选择Go to Folder…，输入<code>/private/etc</code>， 找到 hosts 文件，复制到其他地方，使用文本编辑器进行编辑，添加需要解析的行，如<code>127.0.0.1 www.oa.com oa.com</code>，保存后退出，复制，然后回到 etc 目录，粘贴，选择替换。</li>\n</ol>\n</li>\n<li>打开终端 terminal，运行<code>sudo vim /private/etc/hosts</code>，就可以进行编辑了。编辑完成后保存即可。</li>\n</ol>"},{"title":"Mac 启动加载文件顺序问题","date":"2017-01-11T16:00:00.000Z","_content":"Mac 启动加载文件位置（可设置环境变量）\n-------------------------------------------------------\n （1）首先要知道你使用的Mac OS X是什么样的Shell，使用命令\necho $SHELL\n如果输出的是：csh或者是tcsh，那么你用的就是C Shell。\n如果输出的是：bash，sh，zsh，那么你的用的可能就是Bourne Shell的一个变种。\nMac OS X 10.2之前默认的是C Shell。\nMac OS X 10.3之后默认的是Bourne Shell。\n\n<!--more-->\n \n（2）如果是Bourne Shell。\n那么你可以把你要添加的环境变量添加到你主目录下面的.profile或者.bash_profile，如果存在没有关系添加进去即可，如果没有生成一个。\n \nMac配置环境变量的地方\n 1./etc/profile   （建议不修改这个文件 ）\n 全局（公有）配置，不管是哪个用户，登录时都会读取该文件。\n \n 2./etc/bashrc    （一般在这个文件中添加系统级环境变量）\n 全局（公有）配置，bash shell执行时，不管是何种方式，都会读取此文件。\n \n 3.~/.bash_profile  （一般在这个文件中添加用户级环境变量）\n 每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!\n \n \nMAC 修改host文件 \n-------------------------------------------------------\nsudo vi /etc/hosts\n\n目前还没有解决每次启动 terminal 都要重新运行一次 source .bash_profile 的问题。\n\n\n","source":"_posts/Mac-启动加载文件顺序问题.md","raw":"---\ntitle: Mac 启动加载文件顺序问题\ndate: 2017-01-12\ntags: Mac\n---\nMac 启动加载文件位置（可设置环境变量）\n-------------------------------------------------------\n （1）首先要知道你使用的Mac OS X是什么样的Shell，使用命令\necho $SHELL\n如果输出的是：csh或者是tcsh，那么你用的就是C Shell。\n如果输出的是：bash，sh，zsh，那么你的用的可能就是Bourne Shell的一个变种。\nMac OS X 10.2之前默认的是C Shell。\nMac OS X 10.3之后默认的是Bourne Shell。\n\n<!--more-->\n \n（2）如果是Bourne Shell。\n那么你可以把你要添加的环境变量添加到你主目录下面的.profile或者.bash_profile，如果存在没有关系添加进去即可，如果没有生成一个。\n \nMac配置环境变量的地方\n 1./etc/profile   （建议不修改这个文件 ）\n 全局（公有）配置，不管是哪个用户，登录时都会读取该文件。\n \n 2./etc/bashrc    （一般在这个文件中添加系统级环境变量）\n 全局（公有）配置，bash shell执行时，不管是何种方式，都会读取此文件。\n \n 3.~/.bash_profile  （一般在这个文件中添加用户级环境变量）\n 每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!\n \n \nMAC 修改host文件 \n-------------------------------------------------------\nsudo vi /etc/hosts\n\n目前还没有解决每次启动 terminal 都要重新运行一次 source .bash_profile 的问题。\n\n\n","slug":"Mac-启动加载文件顺序问题","published":1,"updated":"2020-09-11T01:04:35.036Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8a00106wo19ylh4c4l","content":"<h2 id=\"Mac-启动加载文件位置（可设置环境变量）\"><a href=\"#Mac-启动加载文件位置（可设置环境变量）\" class=\"headerlink\" title=\"Mac 启动加载文件位置（可设置环境变量）\"></a>Mac 启动加载文件位置（可设置环境变量）</h2><p> （1）首先要知道你使用的Mac OS X是什么样的Shell，使用命令<br>echo $SHELL<br>如果输出的是：csh或者是tcsh，那么你用的就是C Shell。<br>如果输出的是：bash，sh，zsh，那么你的用的可能就是Bourne Shell的一个变种。<br>Mac OS X 10.2之前默认的是C Shell。<br>Mac OS X 10.3之后默认的是Bourne Shell。</p>\n<a id=\"more\"></a>\n\n<p>（2）如果是Bourne Shell。<br>那么你可以把你要添加的环境变量添加到你主目录下面的.profile或者.bash_profile，如果存在没有关系添加进去即可，如果没有生成一个。</p>\n<p>Mac配置环境变量的地方<br> 1./etc/profile   （建议不修改这个文件 ）<br> 全局（公有）配置，不管是哪个用户，登录时都会读取该文件。</p>\n<p> 2./etc/bashrc    （一般在这个文件中添加系统级环境变量）<br> 全局（公有）配置，bash shell执行时，不管是何种方式，都会读取此文件。</p>\n<p> 3.~/.bash_profile  （一般在这个文件中添加用户级环境变量）<br> 每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!</p>\n<h2 id=\"MAC-修改host文件\"><a href=\"#MAC-修改host文件\" class=\"headerlink\" title=\"MAC 修改host文件 \"></a>MAC 修改host文件 </h2><p>sudo vi /etc/hosts</p>\n<p>目前还没有解决每次启动 terminal 都要重新运行一次 source .bash_profile 的问题。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Mac-启动加载文件位置（可设置环境变量）\"><a href=\"#Mac-启动加载文件位置（可设置环境变量）\" class=\"headerlink\" title=\"Mac 启动加载文件位置（可设置环境变量）\"></a>Mac 启动加载文件位置（可设置环境变量）</h2><p> （1）首先要知道你使用的Mac OS X是什么样的Shell，使用命令<br>echo $SHELL<br>如果输出的是：csh或者是tcsh，那么你用的就是C Shell。<br>如果输出的是：bash，sh，zsh，那么你的用的可能就是Bourne Shell的一个变种。<br>Mac OS X 10.2之前默认的是C Shell。<br>Mac OS X 10.3之后默认的是Bourne Shell。</p>","more":"<p>（2）如果是Bourne Shell。<br>那么你可以把你要添加的环境变量添加到你主目录下面的.profile或者.bash_profile，如果存在没有关系添加进去即可，如果没有生成一个。</p>\n<p>Mac配置环境变量的地方<br> 1./etc/profile   （建议不修改这个文件 ）<br> 全局（公有）配置，不管是哪个用户，登录时都会读取该文件。</p>\n<p> 2./etc/bashrc    （一般在这个文件中添加系统级环境变量）<br> 全局（公有）配置，bash shell执行时，不管是何种方式，都会读取此文件。</p>\n<p> 3.~/.bash_profile  （一般在这个文件中添加用户级环境变量）<br> 每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!</p>\n<h2 id=\"MAC-修改host文件\"><a href=\"#MAC-修改host文件\" class=\"headerlink\" title=\"MAC 修改host文件 \"></a>MAC 修改host文件 </h2><p>sudo vi /etc/hosts</p>\n<p>目前还没有解决每次启动 terminal 都要重新运行一次 source .bash_profile 的问题。</p>"},{"title":"Mac 如何让 Finder 显示隐藏文件和文件夹","date":"2017-07-15T12:37:35.000Z","_content":"\n> 原文地址：https://sspai.com/post/26273\n\n## 如何让 Finder 显示隐藏文件和文件夹\n\n第一步：打开「终端」应用程序。\n\n第二步：输入如下命令：\n\n```\ndefaults write com.apple.finder AppleShowAllFiles -boolean true ; killall Finder\n```\n\n第三步：按下「Return」键确认。\n\n<!-- more -->\n\n现在你将会在 Finder 窗口中看到那些隐藏的文件和文件夹了。\n\n如果你想再次隐藏原本的隐藏文件和文件夹的话，将上述命令替换成\n\n```\ndefaults write com.apple.finder AppleShowAllFiles -boolean false ; killall Finder\n```\n\n即可。\n\n注：该命令适用于 OS X Mavericks 和 OS X Yosemite 系统。对于还在使用 OS X Mountain Lion 或是更早版本的系统的 Mac 用户来说，命令需要稍微变化一下。\n\n\n","source":"_posts/Mac-如何让-Finder-显示隐藏文件和文件夹.md","raw":"---\ntitle: Mac 如何让 Finder 显示隐藏文件和文件夹\ndate: 2017-07-15 20:37:35\ntags: Mac\ncategories: Mac\n---\n\n> 原文地址：https://sspai.com/post/26273\n\n## 如何让 Finder 显示隐藏文件和文件夹\n\n第一步：打开「终端」应用程序。\n\n第二步：输入如下命令：\n\n```\ndefaults write com.apple.finder AppleShowAllFiles -boolean true ; killall Finder\n```\n\n第三步：按下「Return」键确认。\n\n<!-- more -->\n\n现在你将会在 Finder 窗口中看到那些隐藏的文件和文件夹了。\n\n如果你想再次隐藏原本的隐藏文件和文件夹的话，将上述命令替换成\n\n```\ndefaults write com.apple.finder AppleShowAllFiles -boolean false ; killall Finder\n```\n\n即可。\n\n注：该命令适用于 OS X Mavericks 和 OS X Yosemite 系统。对于还在使用 OS X Mountain Lion 或是更早版本的系统的 Mac 用户来说，命令需要稍微变化一下。\n\n\n","slug":"Mac-如何让-Finder-显示隐藏文件和文件夹","published":1,"updated":"2020-09-11T01:04:35.036Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8c00136wo1ef8vd8zd","content":"<blockquote>\n<p>原文地址：<a href=\"https://sspai.com/post/26273\">https://sspai.com/post/26273</a></p>\n</blockquote>\n<h2 id=\"如何让-Finder-显示隐藏文件和文件夹\"><a href=\"#如何让-Finder-显示隐藏文件和文件夹\" class=\"headerlink\" title=\"如何让 Finder 显示隐藏文件和文件夹\"></a>如何让 Finder 显示隐藏文件和文件夹</h2><p>第一步：打开「终端」应用程序。</p>\n<p>第二步：输入如下命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -boolean true ; killall Finder</span><br></pre></td></tr></table></figure>\n\n<p>第三步：按下「Return」键确认。</p>\n<a id=\"more\"></a>\n\n<p>现在你将会在 Finder 窗口中看到那些隐藏的文件和文件夹了。</p>\n<p>如果你想再次隐藏原本的隐藏文件和文件夹的话，将上述命令替换成</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -boolean false ; killall Finder</span><br></pre></td></tr></table></figure>\n\n<p>即可。</p>\n<p>注：该命令适用于 OS X Mavericks 和 OS X Yosemite 系统。对于还在使用 OS X Mountain Lion 或是更早版本的系统的 Mac 用户来说，命令需要稍微变化一下。</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>原文地址：<a href=\"https://sspai.com/post/26273\">https://sspai.com/post/26273</a></p>\n</blockquote>\n<h2 id=\"如何让-Finder-显示隐藏文件和文件夹\"><a href=\"#如何让-Finder-显示隐藏文件和文件夹\" class=\"headerlink\" title=\"如何让 Finder 显示隐藏文件和文件夹\"></a>如何让 Finder 显示隐藏文件和文件夹</h2><p>第一步：打开「终端」应用程序。</p>\n<p>第二步：输入如下命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -boolean true ; killall Finder</span><br></pre></td></tr></table></figure>\n\n<p>第三步：按下「Return」键确认。</p>","more":"<p>现在你将会在 Finder 窗口中看到那些隐藏的文件和文件夹了。</p>\n<p>如果你想再次隐藏原本的隐藏文件和文件夹的话，将上述命令替换成</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -boolean false ; killall Finder</span><br></pre></td></tr></table></figure>\n\n<p>即可。</p>\n<p>注：该命令适用于 OS X Mavericks 和 OS X Yosemite 系统。对于还在使用 OS X Mountain Lion 或是更早版本的系统的 Mac 用户来说，命令需要稍微变化一下。</p>"},{"title":"Mac 平台下配置 Charles 实现抓取手机网络请求","date":"2017-05-27T13:18:08.000Z","Categories":"Charles","_content":"\n> 在测试app的时候，往往需要去定位问题，找到所抛出的请求是否异常，Mac 平台下课通过 Charles 来实现，那么如何抓到手机抛出的请求呢？\n\n前提： Mac 和 手机处在同一局域网下\n\n<!--more-->\n# 1. 配置 Charles 实现 HTTP 请求的抓取\n\n## 1. 设置 Charles 代理\n\nCharles -> Proxy -> Proxy Settings -> Proxies, 在 Http Proxy  的 Port 中填写代理的端口，默认为 8888.\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/13486922.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/63870331.jpg)\n\n## 2. 获取 Mac 当前 IP\n\n方法有很多种，介绍一种最简单的\n\n按住 option 键，点击右上角的 WiFi 图标即可\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/18622996.jpg)\n\n## 3. 设置手机 HTTP 代理\n\n设置 -> 无线局域网 -> 与 Mac 同一 WiFi -> 点击右侧的信息 -> 页面最下面设置 HTTP 代理，服务器和端口在前两部中已获得，填入即可。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/54533762.jpg)\n\n> <font color=red>注意： 在不使用的时候需要将手机中的 HTTP 代理关闭，否则 mac 关机或者关闭软件后，手机无法正常上网！</font>\n\n# 2. 配置 Charles 实现 HTTPS 请求的抓取\n\n如果不进行下面的设置， https 的 reqeust 和 response 都是乱码，设置完之后 https 就可以抓包了。\n\n## 1. Mac 端安装证书\n\n点击 Charles 菜单的 help -> SSL -> proxying -> install charles root certificate\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/98451153.jpg)\n\n## 2. 从 Keychains 找到刚安装的证书，并选择信任\n\n安装完成后 keychains 会自动弹出。选择信任后，需要输入 Mac 的登录密码才能保存。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/74007718.jpg)\n\n## 3. 手机端安装证书\n\nSafari 中输入 chls.pro/ssl， 按提示一步步操作即可。此步需要输入手机密码。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/20454656.jpg)\n\n> <font color=red>注意： 对于 iOS 10.3 及以后的版本，安装完成后并不算结束，还需要一步设置：设置 -> 通用 -> 关于本机 -> 证书信任设置，找到 Charles 的证书，选择信任。</font>\n\n## 4. Charles 设置\n\nCharles -> Proxy -> SSL Proxy Setting\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/30483139.jpg)\n\n在弹出的窗口勾选 Enable SSL Proxying, 选择 Add，在弹窗中填入要抓取的域名和端口，如 API，baidu.com， Port: 443\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/62707963.jpg)\n\n配置完成，在手机端打开一个 https 站点试试。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/22162539.jpg)\n\nHttps 请求的 response 的 content 不再是乱码，可以愉快的玩耍了。\n\n不用的时候最好还是关掉，需要的再打开就好。\n\n\n\n\n\n","source":"_posts/Mac-平台下配置-Charles-实现抓取手机网络请求.md","raw":"---\ntitle: Mac 平台下配置 Charles 实现抓取手机网络请求\ndate: 2017-05-27 21:18:08\ntags: Charles\nCategories: Charles\n---\n\n> 在测试app的时候，往往需要去定位问题，找到所抛出的请求是否异常，Mac 平台下课通过 Charles 来实现，那么如何抓到手机抛出的请求呢？\n\n前提： Mac 和 手机处在同一局域网下\n\n<!--more-->\n# 1. 配置 Charles 实现 HTTP 请求的抓取\n\n## 1. 设置 Charles 代理\n\nCharles -> Proxy -> Proxy Settings -> Proxies, 在 Http Proxy  的 Port 中填写代理的端口，默认为 8888.\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/13486922.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/63870331.jpg)\n\n## 2. 获取 Mac 当前 IP\n\n方法有很多种，介绍一种最简单的\n\n按住 option 键，点击右上角的 WiFi 图标即可\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/18622996.jpg)\n\n## 3. 设置手机 HTTP 代理\n\n设置 -> 无线局域网 -> 与 Mac 同一 WiFi -> 点击右侧的信息 -> 页面最下面设置 HTTP 代理，服务器和端口在前两部中已获得，填入即可。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/54533762.jpg)\n\n> <font color=red>注意： 在不使用的时候需要将手机中的 HTTP 代理关闭，否则 mac 关机或者关闭软件后，手机无法正常上网！</font>\n\n# 2. 配置 Charles 实现 HTTPS 请求的抓取\n\n如果不进行下面的设置， https 的 reqeust 和 response 都是乱码，设置完之后 https 就可以抓包了。\n\n## 1. Mac 端安装证书\n\n点击 Charles 菜单的 help -> SSL -> proxying -> install charles root certificate\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/98451153.jpg)\n\n## 2. 从 Keychains 找到刚安装的证书，并选择信任\n\n安装完成后 keychains 会自动弹出。选择信任后，需要输入 Mac 的登录密码才能保存。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/74007718.jpg)\n\n## 3. 手机端安装证书\n\nSafari 中输入 chls.pro/ssl， 按提示一步步操作即可。此步需要输入手机密码。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/20454656.jpg)\n\n> <font color=red>注意： 对于 iOS 10.3 及以后的版本，安装完成后并不算结束，还需要一步设置：设置 -> 通用 -> 关于本机 -> 证书信任设置，找到 Charles 的证书，选择信任。</font>\n\n## 4. Charles 设置\n\nCharles -> Proxy -> SSL Proxy Setting\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/30483139.jpg)\n\n在弹出的窗口勾选 Enable SSL Proxying, 选择 Add，在弹窗中填入要抓取的域名和端口，如 API，baidu.com， Port: 443\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/62707963.jpg)\n\n配置完成，在手机端打开一个 https 站点试试。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-27/22162539.jpg)\n\nHttps 请求的 response 的 content 不再是乱码，可以愉快的玩耍了。\n\n不用的时候最好还是关掉，需要的再打开就好。\n\n\n\n\n\n","slug":"Mac-平台下配置-Charles-实现抓取手机网络请求","published":1,"updated":"2020-09-11T01:04:35.037Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8h00156wo15aex9v3r","content":"<blockquote>\n<p>在测试app的时候，往往需要去定位问题，找到所抛出的请求是否异常，Mac 平台下课通过 Charles 来实现，那么如何抓到手机抛出的请求呢？</p>\n</blockquote>\n<p>前提： Mac 和 手机处在同一局域网下</p>\n<a id=\"more\"></a>\n<h1 id=\"1-配置-Charles-实现-HTTP-请求的抓取\"><a href=\"#1-配置-Charles-实现-HTTP-请求的抓取\" class=\"headerlink\" title=\"1. 配置 Charles 实现 HTTP 请求的抓取\"></a>1. 配置 Charles 实现 HTTP 请求的抓取</h1><h2 id=\"1-设置-Charles-代理\"><a href=\"#1-设置-Charles-代理\" class=\"headerlink\" title=\"1. 设置 Charles 代理\"></a>1. 设置 Charles 代理</h2><p>Charles -&gt; Proxy -&gt; Proxy Settings -&gt; Proxies, 在 Http Proxy  的 Port 中填写代理的端口，默认为 8888.</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/13486922.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/63870331.jpg\"></p>\n<h2 id=\"2-获取-Mac-当前-IP\"><a href=\"#2-获取-Mac-当前-IP\" class=\"headerlink\" title=\"2. 获取 Mac 当前 IP\"></a>2. 获取 Mac 当前 IP</h2><p>方法有很多种，介绍一种最简单的</p>\n<p>按住 option 键，点击右上角的 WiFi 图标即可</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/18622996.jpg\"></p>\n<h2 id=\"3-设置手机-HTTP-代理\"><a href=\"#3-设置手机-HTTP-代理\" class=\"headerlink\" title=\"3. 设置手机 HTTP 代理\"></a>3. 设置手机 HTTP 代理</h2><p>设置 -&gt; 无线局域网 -&gt; 与 Mac 同一 WiFi -&gt; 点击右侧的信息 -&gt; 页面最下面设置 HTTP 代理，服务器和端口在前两部中已获得，填入即可。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/54533762.jpg\"></p>\n<blockquote>\n<p><font color=red>注意： 在不使用的时候需要将手机中的 HTTP 代理关闭，否则 mac 关机或者关闭软件后，手机无法正常上网！</font></p>\n</blockquote>\n<h1 id=\"2-配置-Charles-实现-HTTPS-请求的抓取\"><a href=\"#2-配置-Charles-实现-HTTPS-请求的抓取\" class=\"headerlink\" title=\"2. 配置 Charles 实现 HTTPS 请求的抓取\"></a>2. 配置 Charles 实现 HTTPS 请求的抓取</h1><p>如果不进行下面的设置， https 的 reqeust 和 response 都是乱码，设置完之后 https 就可以抓包了。</p>\n<h2 id=\"1-Mac-端安装证书\"><a href=\"#1-Mac-端安装证书\" class=\"headerlink\" title=\"1. Mac 端安装证书\"></a>1. Mac 端安装证书</h2><p>点击 Charles 菜单的 help -&gt; SSL -&gt; proxying -&gt; install charles root certificate</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/98451153.jpg\"></p>\n<h2 id=\"2-从-Keychains-找到刚安装的证书，并选择信任\"><a href=\"#2-从-Keychains-找到刚安装的证书，并选择信任\" class=\"headerlink\" title=\"2. 从 Keychains 找到刚安装的证书，并选择信任\"></a>2. 从 Keychains 找到刚安装的证书，并选择信任</h2><p>安装完成后 keychains 会自动弹出。选择信任后，需要输入 Mac 的登录密码才能保存。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/74007718.jpg\"></p>\n<h2 id=\"3-手机端安装证书\"><a href=\"#3-手机端安装证书\" class=\"headerlink\" title=\"3. 手机端安装证书\"></a>3. 手机端安装证书</h2><p>Safari 中输入 chls.pro/ssl， 按提示一步步操作即可。此步需要输入手机密码。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/20454656.jpg\"></p>\n<blockquote>\n<p><font color=red>注意： 对于 iOS 10.3 及以后的版本，安装完成后并不算结束，还需要一步设置：设置 -&gt; 通用 -&gt; 关于本机 -&gt; 证书信任设置，找到 Charles 的证书，选择信任。</font></p>\n</blockquote>\n<h2 id=\"4-Charles-设置\"><a href=\"#4-Charles-设置\" class=\"headerlink\" title=\"4. Charles 设置\"></a>4. Charles 设置</h2><p>Charles -&gt; Proxy -&gt; SSL Proxy Setting</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/30483139.jpg\"></p>\n<p>在弹出的窗口勾选 Enable SSL Proxying, 选择 Add，在弹窗中填入要抓取的域名和端口，如 API，baidu.com， Port: 443</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/62707963.jpg\"></p>\n<p>配置完成，在手机端打开一个 https 站点试试。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/22162539.jpg\"></p>\n<p>Https 请求的 response 的 content 不再是乱码，可以愉快的玩耍了。</p>\n<p>不用的时候最好还是关掉，需要的再打开就好。</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>在测试app的时候，往往需要去定位问题，找到所抛出的请求是否异常，Mac 平台下课通过 Charles 来实现，那么如何抓到手机抛出的请求呢？</p>\n</blockquote>\n<p>前提： Mac 和 手机处在同一局域网下</p>","more":"<h1 id=\"1-配置-Charles-实现-HTTP-请求的抓取\"><a href=\"#1-配置-Charles-实现-HTTP-请求的抓取\" class=\"headerlink\" title=\"1. 配置 Charles 实现 HTTP 请求的抓取\"></a>1. 配置 Charles 实现 HTTP 请求的抓取</h1><h2 id=\"1-设置-Charles-代理\"><a href=\"#1-设置-Charles-代理\" class=\"headerlink\" title=\"1. 设置 Charles 代理\"></a>1. 设置 Charles 代理</h2><p>Charles -&gt; Proxy -&gt; Proxy Settings -&gt; Proxies, 在 Http Proxy  的 Port 中填写代理的端口，默认为 8888.</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/13486922.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/63870331.jpg\"></p>\n<h2 id=\"2-获取-Mac-当前-IP\"><a href=\"#2-获取-Mac-当前-IP\" class=\"headerlink\" title=\"2. 获取 Mac 当前 IP\"></a>2. 获取 Mac 当前 IP</h2><p>方法有很多种，介绍一种最简单的</p>\n<p>按住 option 键，点击右上角的 WiFi 图标即可</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/18622996.jpg\"></p>\n<h2 id=\"3-设置手机-HTTP-代理\"><a href=\"#3-设置手机-HTTP-代理\" class=\"headerlink\" title=\"3. 设置手机 HTTP 代理\"></a>3. 设置手机 HTTP 代理</h2><p>设置 -&gt; 无线局域网 -&gt; 与 Mac 同一 WiFi -&gt; 点击右侧的信息 -&gt; 页面最下面设置 HTTP 代理，服务器和端口在前两部中已获得，填入即可。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/54533762.jpg\"></p>\n<blockquote>\n<p><font color=red>注意： 在不使用的时候需要将手机中的 HTTP 代理关闭，否则 mac 关机或者关闭软件后，手机无法正常上网！</font></p>\n</blockquote>\n<h1 id=\"2-配置-Charles-实现-HTTPS-请求的抓取\"><a href=\"#2-配置-Charles-实现-HTTPS-请求的抓取\" class=\"headerlink\" title=\"2. 配置 Charles 实现 HTTPS 请求的抓取\"></a>2. 配置 Charles 实现 HTTPS 请求的抓取</h1><p>如果不进行下面的设置， https 的 reqeust 和 response 都是乱码，设置完之后 https 就可以抓包了。</p>\n<h2 id=\"1-Mac-端安装证书\"><a href=\"#1-Mac-端安装证书\" class=\"headerlink\" title=\"1. Mac 端安装证书\"></a>1. Mac 端安装证书</h2><p>点击 Charles 菜单的 help -&gt; SSL -&gt; proxying -&gt; install charles root certificate</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/98451153.jpg\"></p>\n<h2 id=\"2-从-Keychains-找到刚安装的证书，并选择信任\"><a href=\"#2-从-Keychains-找到刚安装的证书，并选择信任\" class=\"headerlink\" title=\"2. 从 Keychains 找到刚安装的证书，并选择信任\"></a>2. 从 Keychains 找到刚安装的证书，并选择信任</h2><p>安装完成后 keychains 会自动弹出。选择信任后，需要输入 Mac 的登录密码才能保存。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/74007718.jpg\"></p>\n<h2 id=\"3-手机端安装证书\"><a href=\"#3-手机端安装证书\" class=\"headerlink\" title=\"3. 手机端安装证书\"></a>3. 手机端安装证书</h2><p>Safari 中输入 chls.pro/ssl， 按提示一步步操作即可。此步需要输入手机密码。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/20454656.jpg\"></p>\n<blockquote>\n<p><font color=red>注意： 对于 iOS 10.3 及以后的版本，安装完成后并不算结束，还需要一步设置：设置 -&gt; 通用 -&gt; 关于本机 -&gt; 证书信任设置，找到 Charles 的证书，选择信任。</font></p>\n</blockquote>\n<h2 id=\"4-Charles-设置\"><a href=\"#4-Charles-设置\" class=\"headerlink\" title=\"4. Charles 设置\"></a>4. Charles 设置</h2><p>Charles -&gt; Proxy -&gt; SSL Proxy Setting</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/30483139.jpg\"></p>\n<p>在弹出的窗口勾选 Enable SSL Proxying, 选择 Add，在弹窗中填入要抓取的域名和端口，如 API，baidu.com， Port: 443</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/62707963.jpg\"></p>\n<p>配置完成，在手机端打开一个 https 站点试试。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-27/22162539.jpg\"></p>\n<p>Https 请求的 response 的 content 不再是乱码，可以愉快的玩耍了。</p>\n<p>不用的时候最好还是关掉，需要的再打开就好。</p>"},{"title":"MarkDown 常用语法","date":"2017-04-05T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-4cd67258f6dba075.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n---\n\n<!--more-->\n## 1. 如何换行\n在 Markdown 中另起一段时，需要多敲一次回车键，来在段落之间添加一个空行。这是与其他常见文档格式的不同之处。\n\n\n## 2. 标题\nMarkdown 中，只需要在文本前面加上“#”，就会被认为是加了一个标题。同理，你还可以增加二级、三级、四级、五级标题和六级标题，只需要增加“#” 即可。\n\n示例：\n\n```\n# 一级标题\n## 二级标题\n### 三级标题\n#### 四级标题\n##### 五级标题\n###### 六级标题\n```\n\n效果：\n\n# 一级标题\n## 二级标题\n### 三级标题\n#### 四级标题\n##### 五级标题\n###### 六级标题\n\n## 3. 无序列表\n若列表中的条目没有特定顺序时，可以使用 无序列表。加号“+”或减号“-”都可以作为列表标记，后面要跟一个空格。\n\n示例：\n```\n- windows\n- mac\n- Linux\n或者\n+ windows\n+ mac\n+ Linux\n```\n\n效果：\n\n+ windows\n+ mac\n+ Linux\n\n## 4. 有序列表\n若想在段落前加上数字序号，就需要用到有序列表了。使用数字、一个英文句号和一个空格即可。\n\n示例：\n```\n1. windows\n2. mac\n3. Linux\n```\n\n效果：\n\n1. windows\n2. mac\n3. Linux\n\n## 5. 图片\nMarkdown 中可以插入图片，只需要感叹号、方括号和圆括号即可。例如：\n\n```\n![](/path/to/img.jpg)\n\n![](http://upload-images.jianshu.io/upload_images/693141-43ab4842291e1de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n```\n一个英文感叹号 “!” 后紧跟方括号，里面可以写这张图片的说明；再紧跟一对圆括号，里面写这张图片的网址。\n\n效果：\n![](http://upload-images.jianshu.io/upload_images/693141-43ab4842291e1de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 6. 链接\n在文档中插入连接的语法和插入图片的语法很像，只是少了最前面的英文感叹号\"!\"。\n\n在方括号写下链接文字，圆括号写下网址即可。例如：\n```\n[显示的文字](http://www.redirect.com)\n```\n\n效果：\n[显示的文字](http://www.redirect.com)\n\n## 7. 引用\n可以使用\">\" 标记来引用其他人的言论、书籍或报纸的内容。只需要在段落的第一行最前面加上 > 即可：\n\n```\n> ”每位作者都应该学习 Markdown。” ——马克思\n```\n\n效果：\n> ”每位作者都应该学习 Markdown。” ——马克思\n\n引用可以嵌套，只要根据层次的不同，加上不同数量的 > 即可。\n\n在引用的区域内，也可以使用其他的 Markdown 语法，包括标题、列表等。\n\n## 8. 强调\n在Markdown中，可以使用 * 和 _ 来表示斜体和加粗。\n\n在需要斜体的文本左右各加一个“*”或“_” ，在需要加粗的文本左右各加两个“*”或“_” 。\n\n## 9. 分割线\n在 Markdown 中，可以用分隔线来将内容分成不同区域。\n\n只需要连续三个减号\"-\"即可。\n\n---\n\n## 10. 待办事项\n```\n- [ ] 支持以 PDF 格式导出文稿\n- [ ] 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率\n- [x] 新增 Todo 列表功能\n- [x] 修复 LaTex 公式渲染问题\n- [x] 新增 LaTex 公式编号功能\n```\n\n效果：\n\n- [ ] 支持以 PDF 格式导出文稿\n- [ ] 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率\n- [x] 新增 Todo 列表功能\n- [x] 修复 LaTex 公式渲染问题\n- [x] 新增 LaTex 公式编号功能\n\n## 11. 数学公式\n```\n$$E=mc^2$$\n```\n简书不支持直接插入数学公式，只能采用[这里](http://www.jianshu.com/p/888c5eaebabd)提到的第二种方法。\n\n![](http://www.forkosh.com/mathtex.cgi? E=mc^2)\n\n\n## 12. 代码段\n\n使用 ``` 包含代码段。\n```php\n<?php\n  phpinfo();\n?>\n```\n\n## 13. 绘制表格\n\n```\n| 项目        | 价格   |  数量  |\n| --------   | -----:  | :----:  |\n| 计算机     | \\$1600 |   5     |\n| 手机        |   \\$12   |   12   |\n| 管线        |    \\$1    |  234  |\n```\n\n| 项目        | 价格   |  数量  |\n| --------   | -----:  | :----:  |\n| 计算机     | \\$1600 |   5     |\n| 手机        |   \\$12   |   12   |\n| 管线        |    \\$1    |  234  |\n\n\n## 14. 转义字符\n\n下面这些符号前面加上反斜杠来帮助插入普通的符号。\n\n```\n\\ 反斜杠\n` 反引号\n* 星号\n_ 底线\n{} 大括号\n[] 方括号\n() 括号\n# 井字号\n+ 加号\n- 减号\n. 英文句点\n! 惊叹号\n```\n\n![](http://upload-images.jianshu.io/upload_images/693141-a2fad6a87c1631d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","source":"_posts/MarkDown-常用语法.md","raw":"\n---\ntitle: MarkDown 常用语法\ndate: 2017-04-06\ntags: MarkDown\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-4cd67258f6dba075.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n---\n\n<!--more-->\n## 1. 如何换行\n在 Markdown 中另起一段时，需要多敲一次回车键，来在段落之间添加一个空行。这是与其他常见文档格式的不同之处。\n\n\n## 2. 标题\nMarkdown 中，只需要在文本前面加上“#”，就会被认为是加了一个标题。同理，你还可以增加二级、三级、四级、五级标题和六级标题，只需要增加“#” 即可。\n\n示例：\n\n```\n# 一级标题\n## 二级标题\n### 三级标题\n#### 四级标题\n##### 五级标题\n###### 六级标题\n```\n\n效果：\n\n# 一级标题\n## 二级标题\n### 三级标题\n#### 四级标题\n##### 五级标题\n###### 六级标题\n\n## 3. 无序列表\n若列表中的条目没有特定顺序时，可以使用 无序列表。加号“+”或减号“-”都可以作为列表标记，后面要跟一个空格。\n\n示例：\n```\n- windows\n- mac\n- Linux\n或者\n+ windows\n+ mac\n+ Linux\n```\n\n效果：\n\n+ windows\n+ mac\n+ Linux\n\n## 4. 有序列表\n若想在段落前加上数字序号，就需要用到有序列表了。使用数字、一个英文句号和一个空格即可。\n\n示例：\n```\n1. windows\n2. mac\n3. Linux\n```\n\n效果：\n\n1. windows\n2. mac\n3. Linux\n\n## 5. 图片\nMarkdown 中可以插入图片，只需要感叹号、方括号和圆括号即可。例如：\n\n```\n![](/path/to/img.jpg)\n\n![](http://upload-images.jianshu.io/upload_images/693141-43ab4842291e1de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n```\n一个英文感叹号 “!” 后紧跟方括号，里面可以写这张图片的说明；再紧跟一对圆括号，里面写这张图片的网址。\n\n效果：\n![](http://upload-images.jianshu.io/upload_images/693141-43ab4842291e1de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 6. 链接\n在文档中插入连接的语法和插入图片的语法很像，只是少了最前面的英文感叹号\"!\"。\n\n在方括号写下链接文字，圆括号写下网址即可。例如：\n```\n[显示的文字](http://www.redirect.com)\n```\n\n效果：\n[显示的文字](http://www.redirect.com)\n\n## 7. 引用\n可以使用\">\" 标记来引用其他人的言论、书籍或报纸的内容。只需要在段落的第一行最前面加上 > 即可：\n\n```\n> ”每位作者都应该学习 Markdown。” ——马克思\n```\n\n效果：\n> ”每位作者都应该学习 Markdown。” ——马克思\n\n引用可以嵌套，只要根据层次的不同，加上不同数量的 > 即可。\n\n在引用的区域内，也可以使用其他的 Markdown 语法，包括标题、列表等。\n\n## 8. 强调\n在Markdown中，可以使用 * 和 _ 来表示斜体和加粗。\n\n在需要斜体的文本左右各加一个“*”或“_” ，在需要加粗的文本左右各加两个“*”或“_” 。\n\n## 9. 分割线\n在 Markdown 中，可以用分隔线来将内容分成不同区域。\n\n只需要连续三个减号\"-\"即可。\n\n---\n\n## 10. 待办事项\n```\n- [ ] 支持以 PDF 格式导出文稿\n- [ ] 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率\n- [x] 新增 Todo 列表功能\n- [x] 修复 LaTex 公式渲染问题\n- [x] 新增 LaTex 公式编号功能\n```\n\n效果：\n\n- [ ] 支持以 PDF 格式导出文稿\n- [ ] 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率\n- [x] 新增 Todo 列表功能\n- [x] 修复 LaTex 公式渲染问题\n- [x] 新增 LaTex 公式编号功能\n\n## 11. 数学公式\n```\n$$E=mc^2$$\n```\n简书不支持直接插入数学公式，只能采用[这里](http://www.jianshu.com/p/888c5eaebabd)提到的第二种方法。\n\n![](http://www.forkosh.com/mathtex.cgi? E=mc^2)\n\n\n## 12. 代码段\n\n使用 ``` 包含代码段。\n```php\n<?php\n  phpinfo();\n?>\n```\n\n## 13. 绘制表格\n\n```\n| 项目        | 价格   |  数量  |\n| --------   | -----:  | :----:  |\n| 计算机     | \\$1600 |   5     |\n| 手机        |   \\$12   |   12   |\n| 管线        |    \\$1    |  234  |\n```\n\n| 项目        | 价格   |  数量  |\n| --------   | -----:  | :----:  |\n| 计算机     | \\$1600 |   5     |\n| 手机        |   \\$12   |   12   |\n| 管线        |    \\$1    |  234  |\n\n\n## 14. 转义字符\n\n下面这些符号前面加上反斜杠来帮助插入普通的符号。\n\n```\n\\ 反斜杠\n` 反引号\n* 星号\n_ 底线\n{} 大括号\n[] 方括号\n() 括号\n# 井字号\n+ 加号\n- 减号\n. 英文句点\n! 惊叹号\n```\n\n![](http://upload-images.jianshu.io/upload_images/693141-a2fad6a87c1631d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","slug":"MarkDown-常用语法","published":1,"updated":"2020-09-11T01:04:35.038Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8j00196wo12ykcfrcj","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-4cd67258f6dba075.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<hr>\n<a id=\"more\"></a>\n<h2 id=\"1-如何换行\"><a href=\"#1-如何换行\" class=\"headerlink\" title=\"1. 如何换行\"></a>1. 如何换行</h2><p>在 Markdown 中另起一段时，需要多敲一次回车键，来在段落之间添加一个空行。这是与其他常见文档格式的不同之处。</p>\n<h2 id=\"2-标题\"><a href=\"#2-标题\" class=\"headerlink\" title=\"2. 标题\"></a>2. 标题</h2><p>Markdown 中，只需要在文本前面加上“#”，就会被认为是加了一个标题。同理，你还可以增加二级、三级、四级、五级标题和六级标题，只需要增加“#” 即可。</p>\n<p>示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 一级标题</span><br><span class=\"line\">## 二级标题</span><br><span class=\"line\">### 三级标题</span><br><span class=\"line\">#### 四级标题</span><br><span class=\"line\">##### 五级标题</span><br><span class=\"line\">###### 六级标题</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<h1 id=\"一级标题\"><a href=\"#一级标题\" class=\"headerlink\" title=\"一级标题\"></a>一级标题</h1><h2 id=\"二级标题\"><a href=\"#二级标题\" class=\"headerlink\" title=\"二级标题\"></a>二级标题</h2><h3 id=\"三级标题\"><a href=\"#三级标题\" class=\"headerlink\" title=\"三级标题\"></a>三级标题</h3><h4 id=\"四级标题\"><a href=\"#四级标题\" class=\"headerlink\" title=\"四级标题\"></a>四级标题</h4><h5 id=\"五级标题\"><a href=\"#五级标题\" class=\"headerlink\" title=\"五级标题\"></a>五级标题</h5><h6 id=\"六级标题\"><a href=\"#六级标题\" class=\"headerlink\" title=\"六级标题\"></a>六级标题</h6><h2 id=\"3-无序列表\"><a href=\"#3-无序列表\" class=\"headerlink\" title=\"3. 无序列表\"></a>3. 无序列表</h2><p>若列表中的条目没有特定顺序时，可以使用 无序列表。加号“+”或减号“-”都可以作为列表标记，后面要跟一个空格。</p>\n<p>示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- windows</span><br><span class=\"line\">- mac</span><br><span class=\"line\">- Linux</span><br><span class=\"line\">或者</span><br><span class=\"line\">+ windows</span><br><span class=\"line\">+ mac</span><br><span class=\"line\">+ Linux</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<ul>\n<li>windows</li>\n<li>mac</li>\n<li>Linux</li>\n</ul>\n<h2 id=\"4-有序列表\"><a href=\"#4-有序列表\" class=\"headerlink\" title=\"4. 有序列表\"></a>4. 有序列表</h2><p>若想在段落前加上数字序号，就需要用到有序列表了。使用数字、一个英文句号和一个空格即可。</p>\n<p>示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. windows</span><br><span class=\"line\">2. mac</span><br><span class=\"line\">3. Linux</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<ol>\n<li>windows</li>\n<li>mac</li>\n<li>Linux</li>\n</ol>\n<h2 id=\"5-图片\"><a href=\"#5-图片\" class=\"headerlink\" title=\"5. 图片\"></a>5. 图片</h2><p>Markdown 中可以插入图片，只需要感叹号、方括号和圆括号即可。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">![](&#x2F;path&#x2F;to&#x2F;img.jpg)</span><br><span class=\"line\"></span><br><span class=\"line\">![](http:&#x2F;&#x2F;upload-images.jianshu.io&#x2F;upload_images&#x2F;693141-43ab4842291e1de8.png?imageMogr2&#x2F;auto-orient&#x2F;strip%7CimageView2&#x2F;2&#x2F;w&#x2F;1240)</span><br></pre></td></tr></table></figure>\n<p>一个英文感叹号 “!” 后紧跟方括号，里面可以写这张图片的说明；再紧跟一对圆括号，里面写这张图片的网址。</p>\n<p>效果：<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-43ab4842291e1de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"6-链接\"><a href=\"#6-链接\" class=\"headerlink\" title=\"6. 链接\"></a>6. 链接</h2><p>在文档中插入连接的语法和插入图片的语法很像，只是少了最前面的英文感叹号”!”。</p>\n<p>在方括号写下链接文字，圆括号写下网址即可。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[显示的文字](http:&#x2F;&#x2F;www.redirect.com)</span><br></pre></td></tr></table></figure>\n\n<p>效果：<br><a href=\"http://www.redirect.com/\">显示的文字</a></p>\n<h2 id=\"7-引用\"><a href=\"#7-引用\" class=\"headerlink\" title=\"7. 引用\"></a>7. 引用</h2><p>可以使用”&gt;” 标记来引用其他人的言论、书籍或报纸的内容。只需要在段落的第一行最前面加上 &gt; 即可：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; ”每位作者都应该学习 Markdown。” ——马克思</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<blockquote>\n<p>”每位作者都应该学习 Markdown。” ——马克思</p>\n</blockquote>\n<p>引用可以嵌套，只要根据层次的不同，加上不同数量的 &gt; 即可。</p>\n<p>在引用的区域内，也可以使用其他的 Markdown 语法，包括标题、列表等。</p>\n<h2 id=\"8-强调\"><a href=\"#8-强调\" class=\"headerlink\" title=\"8. 强调\"></a>8. 强调</h2><p>在Markdown中，可以使用 * 和 _ 来表示斜体和加粗。</p>\n<p>在需要斜体的文本左右各加一个“<em>”或“_” ，在需要加粗的文本左右各加两个“</em>”或“_” 。</p>\n<h2 id=\"9-分割线\"><a href=\"#9-分割线\" class=\"headerlink\" title=\"9. 分割线\"></a>9. 分割线</h2><p>在 Markdown 中，可以用分隔线来将内容分成不同区域。</p>\n<p>只需要连续三个减号”-“即可。</p>\n<hr>\n<h2 id=\"10-待办事项\"><a href=\"#10-待办事项\" class=\"headerlink\" title=\"10. 待办事项\"></a>10. 待办事项</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- [ ] 支持以 PDF 格式导出文稿</span><br><span class=\"line\">- [ ] 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率</span><br><span class=\"line\">- [x] 新增 Todo 列表功能</span><br><span class=\"line\">- [x] 修复 LaTex 公式渲染问题</span><br><span class=\"line\">- [x] 新增 LaTex 公式编号功能</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 支持以 PDF 格式导出文稿</li>\n<li><input disabled=\"\" type=\"checkbox\"> 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 新增 Todo 列表功能</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 修复 LaTex 公式渲染问题</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 新增 LaTex 公式编号功能</li>\n</ul>\n<h2 id=\"11-数学公式\"><a href=\"#11-数学公式\" class=\"headerlink\" title=\"11. 数学公式\"></a>11. 数学公式</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$$E&#x3D;mc^2$$</span><br></pre></td></tr></table></figure>\n<p>简书不支持直接插入数学公式，只能采用<a href=\"http://www.jianshu.com/p/888c5eaebabd\">这里</a>提到的第二种方法。</p>\n<p>![](<a href=\"http://www.forkosh.com/mathtex.cgi\">http://www.forkosh.com/mathtex.cgi</a>? E=mc^2)</p>\n<h2 id=\"12-代码段\"><a href=\"#12-代码段\" class=\"headerlink\" title=\"12. 代码段\"></a>12. 代码段</h2><p>使用 ``` 包含代码段。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  phpinfo();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"13-绘制表格\"><a href=\"#13-绘制表格\" class=\"headerlink\" title=\"13. 绘制表格\"></a>13. 绘制表格</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| 项目        | 价格   |  数量  |</span><br><span class=\"line\">| --------   | -----:  | :----:  |</span><br><span class=\"line\">| 计算机     | \\$1600 |   5     |</span><br><span class=\"line\">| 手机        |   \\$12   |   12   |</span><br><span class=\"line\">| 管线        |    \\$1    |  234  |</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>项目</th>\n<th align=\"right\">价格</th>\n<th align=\"center\">数量</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>计算机</td>\n<td align=\"right\">$1600</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td>手机</td>\n<td align=\"right\">$12</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td>管线</td>\n<td align=\"right\">$1</td>\n<td align=\"center\">234</td>\n</tr>\n</tbody></table>\n<h2 id=\"14-转义字符\"><a href=\"#14-转义字符\" class=\"headerlink\" title=\"14. 转义字符\"></a>14. 转义字符</h2><p>下面这些符号前面加上反斜杠来帮助插入普通的符号。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\ 反斜杠</span><br><span class=\"line\">&#96; 反引号</span><br><span class=\"line\">* 星号</span><br><span class=\"line\">_ 底线</span><br><span class=\"line\">&#123;&#125; 大括号</span><br><span class=\"line\">[] 方括号</span><br><span class=\"line\">() 括号</span><br><span class=\"line\"># 井字号</span><br><span class=\"line\">+ 加号</span><br><span class=\"line\">- 减号</span><br><span class=\"line\">. 英文句点</span><br><span class=\"line\">! 惊叹号</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-a2fad6a87c1631d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-4cd67258f6dba075.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<hr>","more":"<h2 id=\"1-如何换行\"><a href=\"#1-如何换行\" class=\"headerlink\" title=\"1. 如何换行\"></a>1. 如何换行</h2><p>在 Markdown 中另起一段时，需要多敲一次回车键，来在段落之间添加一个空行。这是与其他常见文档格式的不同之处。</p>\n<h2 id=\"2-标题\"><a href=\"#2-标题\" class=\"headerlink\" title=\"2. 标题\"></a>2. 标题</h2><p>Markdown 中，只需要在文本前面加上“#”，就会被认为是加了一个标题。同理，你还可以增加二级、三级、四级、五级标题和六级标题，只需要增加“#” 即可。</p>\n<p>示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 一级标题</span><br><span class=\"line\">## 二级标题</span><br><span class=\"line\">### 三级标题</span><br><span class=\"line\">#### 四级标题</span><br><span class=\"line\">##### 五级标题</span><br><span class=\"line\">###### 六级标题</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<h1 id=\"一级标题\"><a href=\"#一级标题\" class=\"headerlink\" title=\"一级标题\"></a>一级标题</h1><h2 id=\"二级标题\"><a href=\"#二级标题\" class=\"headerlink\" title=\"二级标题\"></a>二级标题</h2><h3 id=\"三级标题\"><a href=\"#三级标题\" class=\"headerlink\" title=\"三级标题\"></a>三级标题</h3><h4 id=\"四级标题\"><a href=\"#四级标题\" class=\"headerlink\" title=\"四级标题\"></a>四级标题</h4><h5 id=\"五级标题\"><a href=\"#五级标题\" class=\"headerlink\" title=\"五级标题\"></a>五级标题</h5><h6 id=\"六级标题\"><a href=\"#六级标题\" class=\"headerlink\" title=\"六级标题\"></a>六级标题</h6><h2 id=\"3-无序列表\"><a href=\"#3-无序列表\" class=\"headerlink\" title=\"3. 无序列表\"></a>3. 无序列表</h2><p>若列表中的条目没有特定顺序时，可以使用 无序列表。加号“+”或减号“-”都可以作为列表标记，后面要跟一个空格。</p>\n<p>示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- windows</span><br><span class=\"line\">- mac</span><br><span class=\"line\">- Linux</span><br><span class=\"line\">或者</span><br><span class=\"line\">+ windows</span><br><span class=\"line\">+ mac</span><br><span class=\"line\">+ Linux</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<ul>\n<li>windows</li>\n<li>mac</li>\n<li>Linux</li>\n</ul>\n<h2 id=\"4-有序列表\"><a href=\"#4-有序列表\" class=\"headerlink\" title=\"4. 有序列表\"></a>4. 有序列表</h2><p>若想在段落前加上数字序号，就需要用到有序列表了。使用数字、一个英文句号和一个空格即可。</p>\n<p>示例：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. windows</span><br><span class=\"line\">2. mac</span><br><span class=\"line\">3. Linux</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<ol>\n<li>windows</li>\n<li>mac</li>\n<li>Linux</li>\n</ol>\n<h2 id=\"5-图片\"><a href=\"#5-图片\" class=\"headerlink\" title=\"5. 图片\"></a>5. 图片</h2><p>Markdown 中可以插入图片，只需要感叹号、方括号和圆括号即可。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">![](&#x2F;path&#x2F;to&#x2F;img.jpg)</span><br><span class=\"line\"></span><br><span class=\"line\">![](http:&#x2F;&#x2F;upload-images.jianshu.io&#x2F;upload_images&#x2F;693141-43ab4842291e1de8.png?imageMogr2&#x2F;auto-orient&#x2F;strip%7CimageView2&#x2F;2&#x2F;w&#x2F;1240)</span><br></pre></td></tr></table></figure>\n<p>一个英文感叹号 “!” 后紧跟方括号，里面可以写这张图片的说明；再紧跟一对圆括号，里面写这张图片的网址。</p>\n<p>效果：<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-43ab4842291e1de8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"6-链接\"><a href=\"#6-链接\" class=\"headerlink\" title=\"6. 链接\"></a>6. 链接</h2><p>在文档中插入连接的语法和插入图片的语法很像，只是少了最前面的英文感叹号”!”。</p>\n<p>在方括号写下链接文字，圆括号写下网址即可。例如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[显示的文字](http:&#x2F;&#x2F;www.redirect.com)</span><br></pre></td></tr></table></figure>\n\n<p>效果：<br><a href=\"http://www.redirect.com/\">显示的文字</a></p>\n<h2 id=\"7-引用\"><a href=\"#7-引用\" class=\"headerlink\" title=\"7. 引用\"></a>7. 引用</h2><p>可以使用”&gt;” 标记来引用其他人的言论、书籍或报纸的内容。只需要在段落的第一行最前面加上 &gt; 即可：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; ”每位作者都应该学习 Markdown。” ——马克思</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<blockquote>\n<p>”每位作者都应该学习 Markdown。” ——马克思</p>\n</blockquote>\n<p>引用可以嵌套，只要根据层次的不同，加上不同数量的 &gt; 即可。</p>\n<p>在引用的区域内，也可以使用其他的 Markdown 语法，包括标题、列表等。</p>\n<h2 id=\"8-强调\"><a href=\"#8-强调\" class=\"headerlink\" title=\"8. 强调\"></a>8. 强调</h2><p>在Markdown中，可以使用 * 和 _ 来表示斜体和加粗。</p>\n<p>在需要斜体的文本左右各加一个“<em>”或“_” ，在需要加粗的文本左右各加两个“</em>”或“_” 。</p>\n<h2 id=\"9-分割线\"><a href=\"#9-分割线\" class=\"headerlink\" title=\"9. 分割线\"></a>9. 分割线</h2><p>在 Markdown 中，可以用分隔线来将内容分成不同区域。</p>\n<p>只需要连续三个减号”-“即可。</p>\n<hr>\n<h2 id=\"10-待办事项\"><a href=\"#10-待办事项\" class=\"headerlink\" title=\"10. 待办事项\"></a>10. 待办事项</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- [ ] 支持以 PDF 格式导出文稿</span><br><span class=\"line\">- [ ] 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率</span><br><span class=\"line\">- [x] 新增 Todo 列表功能</span><br><span class=\"line\">- [x] 修复 LaTex 公式渲染问题</span><br><span class=\"line\">- [x] 新增 LaTex 公式编号功能</span><br></pre></td></tr></table></figure>\n\n<p>效果：</p>\n<ul>\n<li><input disabled=\"\" type=\"checkbox\"> 支持以 PDF 格式导出文稿</li>\n<li><input disabled=\"\" type=\"checkbox\"> 改进 Cmd 渲染算法，使用局部渲染技术提高渲染效率</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 新增 Todo 列表功能</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 修复 LaTex 公式渲染问题</li>\n<li><input checked=\"\" disabled=\"\" type=\"checkbox\"> 新增 LaTex 公式编号功能</li>\n</ul>\n<h2 id=\"11-数学公式\"><a href=\"#11-数学公式\" class=\"headerlink\" title=\"11. 数学公式\"></a>11. 数学公式</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$$E&#x3D;mc^2$$</span><br></pre></td></tr></table></figure>\n<p>简书不支持直接插入数学公式，只能采用<a href=\"http://www.jianshu.com/p/888c5eaebabd\">这里</a>提到的第二种方法。</p>\n<p>![](<a href=\"http://www.forkosh.com/mathtex.cgi\">http://www.forkosh.com/mathtex.cgi</a>? E=mc^2)</p>\n<h2 id=\"12-代码段\"><a href=\"#12-代码段\" class=\"headerlink\" title=\"12. 代码段\"></a>12. 代码段</h2><p>使用 ``` 包含代码段。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">  phpinfo();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"13-绘制表格\"><a href=\"#13-绘制表格\" class=\"headerlink\" title=\"13. 绘制表格\"></a>13. 绘制表格</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| 项目        | 价格   |  数量  |</span><br><span class=\"line\">| --------   | -----:  | :----:  |</span><br><span class=\"line\">| 计算机     | \\$1600 |   5     |</span><br><span class=\"line\">| 手机        |   \\$12   |   12   |</span><br><span class=\"line\">| 管线        |    \\$1    |  234  |</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>项目</th>\n<th align=\"right\">价格</th>\n<th align=\"center\">数量</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>计算机</td>\n<td align=\"right\">$1600</td>\n<td align=\"center\">5</td>\n</tr>\n<tr>\n<td>手机</td>\n<td align=\"right\">$12</td>\n<td align=\"center\">12</td>\n</tr>\n<tr>\n<td>管线</td>\n<td align=\"right\">$1</td>\n<td align=\"center\">234</td>\n</tr>\n</tbody></table>\n<h2 id=\"14-转义字符\"><a href=\"#14-转义字符\" class=\"headerlink\" title=\"14. 转义字符\"></a>14. 转义字符</h2><p>下面这些符号前面加上反斜杠来帮助插入普通的符号。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\\ 反斜杠</span><br><span class=\"line\">&#96; 反引号</span><br><span class=\"line\">* 星号</span><br><span class=\"line\">_ 底线</span><br><span class=\"line\">&#123;&#125; 大括号</span><br><span class=\"line\">[] 方括号</span><br><span class=\"line\">() 括号</span><br><span class=\"line\"># 井字号</span><br><span class=\"line\">+ 加号</span><br><span class=\"line\">- 减号</span><br><span class=\"line\">. 英文句点</span><br><span class=\"line\">! 惊叹号</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-a2fad6a87c1631d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>"},{"title":"MySQL 分区分表","date":"2018-02-26T10:05:49.000Z","_content":"\n## 1. MySQL 分区 && 分库分表\n\n### 1. 分区表\n分区表是一个独立的逻辑表，但是底层 MySQL 将其分成了多个物理子表，每一个分区表都会使用一个独立的表文件\n\n客户端和 PHP 无感知，代码不需要修改，对业务逻辑没有任何影响\n\n<!-- more -->\n\n#### 1. 工作原理\n创建表时使用 `partition by` 子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有所需数据的分区，这样查询只需要查询所需数据所在的分区即可，大大提高查询效率\n\n分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，这样可以将相关的数据存放在一起，而且如果想一次性删除整个分区的数据也很方便\n\n#### 2. 适用场景\n1. 表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据\n2. 分区表的数据更易维护，可以对独立的分区进行独立的操作\n3. 分区表的数据可以分布在不同的机器上，从而高效使用资源\n4. 可以使用分区表来避免某些特殊的瓶颈\n5. 可以备份和恢复独立的分区\n\n#### 3. 限制\n1. 一个表最多只能有 1024 个分区\n2. 5.1 版本，分区表表达式必须是整数，5.5 之后可以使用列分区\n3. 分区字段如果有主键和唯一索引列，那么主键列和唯一列都必须包含进来\n4. 分区表中无法使用外键约束\n5. 需要对现有表的结构进行修改\n6. 所有分区都必须使用相同的存储引擎\n7. 可以使用的函数和表达式会有一些限制\n8. 部分存储引擎不支持分区（InnoDB 和 MyISAM 都支持）\n9. 对于 MyISAM 的分区表，不能使用 load index into cache，即不能将索引缓存\n10. 对于 MyISAM 的分区表，使用分区表时需要打开更多的文件描述符，降低查询效率。\n\n### 2. 分库分表\n#### 1. 工作原理\n通过一些 hash 算法或者工具实现将一张数据表垂直或者水平进行物理切分。\n\n#### 2. 适用场景\n1. 单表记录条数达到百万或者千万级别时\n2. 解决表锁的问题\n\n#### 3. 分表方式\n##### 1. 水平分割\n表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询速度\n\n###### 1. 使用场景\n1. 表中的数据本身就有独立性，例如表中分别记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用，比如切分历史数据和活跃数据\n2. 需要把数据存放到多个介质上\n\n###### 2. 缺点\n1. 给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需要 union 操作；\n2. 在许多数据库应用中，这种复杂性会超过带来的优点，查询时会增加读一个索引层的磁盘次数；\n\n##### 2. 垂直分表\n\n把主键和一些列放在一张表，然后把主键和另外的列放在另一张表中\n\n###### 1. 使用场景\n1. 表中某些列常用，而另外一些列不常用\n2. 可以使数据行变小，一个数据页能存储更多数据，查询时减少 I/O 次数\n\n###### 2. 缺点\n管理冗余列，查询所有数据都需要 join 操作\n\n\n### 3. 分库分表缺点\n1. 有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差\n2. 对于应用层来说，逻辑算法无疑会增加开发成本\n\n\n\n## 2. MySQL 复制原理及负载均衡\n\n### 1. MySQL 主从复制工作原理\n\n1. 在主库上把数据更改记录到二进制文件，即所有的写操作都记录到 binlog\n2. 从库将主库的日志复制到自己的中继日志\n3. 从库读取中继日志中的事件，将其重放到从库数据中，即执行了日志中的 SQL 语句\n\n\n### 2. 解决了哪些问题\n1. 数据分布：随意停止或开始复制，并在不同地理位置分布数据备份\n2. 负载均衡：降低单个服务器的压力\n3. 高可用和故障切换：帮助应用程序避免单点失败\n4. 升级测试：可以使用更高版本的 MySQL 作为从库\n","source":"_posts/MySQL-分区分表.md","raw":"---\ntitle: MySQL 分区分表\ndate: 2018-02-26 18:05:49\ntags: MySQL\n---\n\n## 1. MySQL 分区 && 分库分表\n\n### 1. 分区表\n分区表是一个独立的逻辑表，但是底层 MySQL 将其分成了多个物理子表，每一个分区表都会使用一个独立的表文件\n\n客户端和 PHP 无感知，代码不需要修改，对业务逻辑没有任何影响\n\n<!-- more -->\n\n#### 1. 工作原理\n创建表时使用 `partition by` 子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有所需数据的分区，这样查询只需要查询所需数据所在的分区即可，大大提高查询效率\n\n分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，这样可以将相关的数据存放在一起，而且如果想一次性删除整个分区的数据也很方便\n\n#### 2. 适用场景\n1. 表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据\n2. 分区表的数据更易维护，可以对独立的分区进行独立的操作\n3. 分区表的数据可以分布在不同的机器上，从而高效使用资源\n4. 可以使用分区表来避免某些特殊的瓶颈\n5. 可以备份和恢复独立的分区\n\n#### 3. 限制\n1. 一个表最多只能有 1024 个分区\n2. 5.1 版本，分区表表达式必须是整数，5.5 之后可以使用列分区\n3. 分区字段如果有主键和唯一索引列，那么主键列和唯一列都必须包含进来\n4. 分区表中无法使用外键约束\n5. 需要对现有表的结构进行修改\n6. 所有分区都必须使用相同的存储引擎\n7. 可以使用的函数和表达式会有一些限制\n8. 部分存储引擎不支持分区（InnoDB 和 MyISAM 都支持）\n9. 对于 MyISAM 的分区表，不能使用 load index into cache，即不能将索引缓存\n10. 对于 MyISAM 的分区表，使用分区表时需要打开更多的文件描述符，降低查询效率。\n\n### 2. 分库分表\n#### 1. 工作原理\n通过一些 hash 算法或者工具实现将一张数据表垂直或者水平进行物理切分。\n\n#### 2. 适用场景\n1. 单表记录条数达到百万或者千万级别时\n2. 解决表锁的问题\n\n#### 3. 分表方式\n##### 1. 水平分割\n表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询速度\n\n###### 1. 使用场景\n1. 表中的数据本身就有独立性，例如表中分别记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用，比如切分历史数据和活跃数据\n2. 需要把数据存放到多个介质上\n\n###### 2. 缺点\n1. 给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需要 union 操作；\n2. 在许多数据库应用中，这种复杂性会超过带来的优点，查询时会增加读一个索引层的磁盘次数；\n\n##### 2. 垂直分表\n\n把主键和一些列放在一张表，然后把主键和另外的列放在另一张表中\n\n###### 1. 使用场景\n1. 表中某些列常用，而另外一些列不常用\n2. 可以使数据行变小，一个数据页能存储更多数据，查询时减少 I/O 次数\n\n###### 2. 缺点\n管理冗余列，查询所有数据都需要 join 操作\n\n\n### 3. 分库分表缺点\n1. 有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差\n2. 对于应用层来说，逻辑算法无疑会增加开发成本\n\n\n\n## 2. MySQL 复制原理及负载均衡\n\n### 1. MySQL 主从复制工作原理\n\n1. 在主库上把数据更改记录到二进制文件，即所有的写操作都记录到 binlog\n2. 从库将主库的日志复制到自己的中继日志\n3. 从库读取中继日志中的事件，将其重放到从库数据中，即执行了日志中的 SQL 语句\n\n\n### 2. 解决了哪些问题\n1. 数据分布：随意停止或开始复制，并在不同地理位置分布数据备份\n2. 负载均衡：降低单个服务器的压力\n3. 高可用和故障切换：帮助应用程序避免单点失败\n4. 升级测试：可以使用更高版本的 MySQL 作为从库\n","slug":"MySQL-分区分表","published":1,"updated":"2020-09-11T01:04:35.038Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8k001b6wo183cl9fmd","content":"<h2 id=\"1-MySQL-分区-amp-amp-分库分表\"><a href=\"#1-MySQL-分区-amp-amp-分库分表\" class=\"headerlink\" title=\"1. MySQL 分区 &amp;&amp; 分库分表\"></a>1. MySQL 分区 &amp;&amp; 分库分表</h2><h3 id=\"1-分区表\"><a href=\"#1-分区表\" class=\"headerlink\" title=\"1. 分区表\"></a>1. 分区表</h3><p>分区表是一个独立的逻辑表，但是底层 MySQL 将其分成了多个物理子表，每一个分区表都会使用一个独立的表文件</p>\n<p>客户端和 PHP 无感知，代码不需要修改，对业务逻辑没有任何影响</p>\n<a id=\"more\"></a>\n\n<h4 id=\"1-工作原理\"><a href=\"#1-工作原理\" class=\"headerlink\" title=\"1. 工作原理\"></a>1. 工作原理</h4><p>创建表时使用 <code>partition by</code> 子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有所需数据的分区，这样查询只需要查询所需数据所在的分区即可，大大提高查询效率</p>\n<p>分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，这样可以将相关的数据存放在一起，而且如果想一次性删除整个分区的数据也很方便</p>\n<h4 id=\"2-适用场景\"><a href=\"#2-适用场景\" class=\"headerlink\" title=\"2. 适用场景\"></a>2. 适用场景</h4><ol>\n<li>表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据</li>\n<li>分区表的数据更易维护，可以对独立的分区进行独立的操作</li>\n<li>分区表的数据可以分布在不同的机器上，从而高效使用资源</li>\n<li>可以使用分区表来避免某些特殊的瓶颈</li>\n<li>可以备份和恢复独立的分区</li>\n</ol>\n<h4 id=\"3-限制\"><a href=\"#3-限制\" class=\"headerlink\" title=\"3. 限制\"></a>3. 限制</h4><ol>\n<li>一个表最多只能有 1024 个分区</li>\n<li>5.1 版本，分区表表达式必须是整数，5.5 之后可以使用列分区</li>\n<li>分区字段如果有主键和唯一索引列，那么主键列和唯一列都必须包含进来</li>\n<li>分区表中无法使用外键约束</li>\n<li>需要对现有表的结构进行修改</li>\n<li>所有分区都必须使用相同的存储引擎</li>\n<li>可以使用的函数和表达式会有一些限制</li>\n<li>部分存储引擎不支持分区（InnoDB 和 MyISAM 都支持）</li>\n<li>对于 MyISAM 的分区表，不能使用 load index into cache，即不能将索引缓存</li>\n<li>对于 MyISAM 的分区表，使用分区表时需要打开更多的文件描述符，降低查询效率。</li>\n</ol>\n<h3 id=\"2-分库分表\"><a href=\"#2-分库分表\" class=\"headerlink\" title=\"2. 分库分表\"></a>2. 分库分表</h3><h4 id=\"1-工作原理-1\"><a href=\"#1-工作原理-1\" class=\"headerlink\" title=\"1. 工作原理\"></a>1. 工作原理</h4><p>通过一些 hash 算法或者工具实现将一张数据表垂直或者水平进行物理切分。</p>\n<h4 id=\"2-适用场景-1\"><a href=\"#2-适用场景-1\" class=\"headerlink\" title=\"2. 适用场景\"></a>2. 适用场景</h4><ol>\n<li>单表记录条数达到百万或者千万级别时</li>\n<li>解决表锁的问题</li>\n</ol>\n<h4 id=\"3-分表方式\"><a href=\"#3-分表方式\" class=\"headerlink\" title=\"3. 分表方式\"></a>3. 分表方式</h4><h5 id=\"1-水平分割\"><a href=\"#1-水平分割\" class=\"headerlink\" title=\"1. 水平分割\"></a>1. 水平分割</h5><p>表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询速度</p>\n<h6 id=\"1-使用场景\"><a href=\"#1-使用场景\" class=\"headerlink\" title=\"1. 使用场景\"></a>1. 使用场景</h6><ol>\n<li>表中的数据本身就有独立性，例如表中分别记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用，比如切分历史数据和活跃数据</li>\n<li>需要把数据存放到多个介质上</li>\n</ol>\n<h6 id=\"2-缺点\"><a href=\"#2-缺点\" class=\"headerlink\" title=\"2. 缺点\"></a>2. 缺点</h6><ol>\n<li>给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需要 union 操作；</li>\n<li>在许多数据库应用中，这种复杂性会超过带来的优点，查询时会增加读一个索引层的磁盘次数；</li>\n</ol>\n<h5 id=\"2-垂直分表\"><a href=\"#2-垂直分表\" class=\"headerlink\" title=\"2. 垂直分表\"></a>2. 垂直分表</h5><p>把主键和一些列放在一张表，然后把主键和另外的列放在另一张表中</p>\n<h6 id=\"1-使用场景-1\"><a href=\"#1-使用场景-1\" class=\"headerlink\" title=\"1. 使用场景\"></a>1. 使用场景</h6><ol>\n<li>表中某些列常用，而另外一些列不常用</li>\n<li>可以使数据行变小，一个数据页能存储更多数据，查询时减少 I/O 次数</li>\n</ol>\n<h6 id=\"2-缺点-1\"><a href=\"#2-缺点-1\" class=\"headerlink\" title=\"2. 缺点\"></a>2. 缺点</h6><p>管理冗余列，查询所有数据都需要 join 操作</p>\n<h3 id=\"3-分库分表缺点\"><a href=\"#3-分库分表缺点\" class=\"headerlink\" title=\"3. 分库分表缺点\"></a>3. 分库分表缺点</h3><ol>\n<li>有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差</li>\n<li>对于应用层来说，逻辑算法无疑会增加开发成本</li>\n</ol>\n<h2 id=\"2-MySQL-复制原理及负载均衡\"><a href=\"#2-MySQL-复制原理及负载均衡\" class=\"headerlink\" title=\"2. MySQL 复制原理及负载均衡\"></a>2. MySQL 复制原理及负载均衡</h2><h3 id=\"1-MySQL-主从复制工作原理\"><a href=\"#1-MySQL-主从复制工作原理\" class=\"headerlink\" title=\"1. MySQL 主从复制工作原理\"></a>1. MySQL 主从复制工作原理</h3><ol>\n<li>在主库上把数据更改记录到二进制文件，即所有的写操作都记录到 binlog</li>\n<li>从库将主库的日志复制到自己的中继日志</li>\n<li>从库读取中继日志中的事件，将其重放到从库数据中，即执行了日志中的 SQL 语句</li>\n</ol>\n<h3 id=\"2-解决了哪些问题\"><a href=\"#2-解决了哪些问题\" class=\"headerlink\" title=\"2. 解决了哪些问题\"></a>2. 解决了哪些问题</h3><ol>\n<li>数据分布：随意停止或开始复制，并在不同地理位置分布数据备份</li>\n<li>负载均衡：降低单个服务器的压力</li>\n<li>高可用和故障切换：帮助应用程序避免单点失败</li>\n<li>升级测试：可以使用更高版本的 MySQL 作为从库</li>\n</ol>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-MySQL-分区-amp-amp-分库分表\"><a href=\"#1-MySQL-分区-amp-amp-分库分表\" class=\"headerlink\" title=\"1. MySQL 分区 &amp;&amp; 分库分表\"></a>1. MySQL 分区 &amp;&amp; 分库分表</h2><h3 id=\"1-分区表\"><a href=\"#1-分区表\" class=\"headerlink\" title=\"1. 分区表\"></a>1. 分区表</h3><p>分区表是一个独立的逻辑表，但是底层 MySQL 将其分成了多个物理子表，每一个分区表都会使用一个独立的表文件</p>\n<p>客户端和 PHP 无感知，代码不需要修改，对业务逻辑没有任何影响</p>","more":"<h4 id=\"1-工作原理\"><a href=\"#1-工作原理\" class=\"headerlink\" title=\"1. 工作原理\"></a>1. 工作原理</h4><p>创建表时使用 <code>partition by</code> 子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义过滤那些没有所需数据的分区，这样查询只需要查询所需数据所在的分区即可，大大提高查询效率</p>\n<p>分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，这样可以将相关的数据存放在一起，而且如果想一次性删除整个分区的数据也很方便</p>\n<h4 id=\"2-适用场景\"><a href=\"#2-适用场景\" class=\"headerlink\" title=\"2. 适用场景\"></a>2. 适用场景</h4><ol>\n<li>表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据</li>\n<li>分区表的数据更易维护，可以对独立的分区进行独立的操作</li>\n<li>分区表的数据可以分布在不同的机器上，从而高效使用资源</li>\n<li>可以使用分区表来避免某些特殊的瓶颈</li>\n<li>可以备份和恢复独立的分区</li>\n</ol>\n<h4 id=\"3-限制\"><a href=\"#3-限制\" class=\"headerlink\" title=\"3. 限制\"></a>3. 限制</h4><ol>\n<li>一个表最多只能有 1024 个分区</li>\n<li>5.1 版本，分区表表达式必须是整数，5.5 之后可以使用列分区</li>\n<li>分区字段如果有主键和唯一索引列，那么主键列和唯一列都必须包含进来</li>\n<li>分区表中无法使用外键约束</li>\n<li>需要对现有表的结构进行修改</li>\n<li>所有分区都必须使用相同的存储引擎</li>\n<li>可以使用的函数和表达式会有一些限制</li>\n<li>部分存储引擎不支持分区（InnoDB 和 MyISAM 都支持）</li>\n<li>对于 MyISAM 的分区表，不能使用 load index into cache，即不能将索引缓存</li>\n<li>对于 MyISAM 的分区表，使用分区表时需要打开更多的文件描述符，降低查询效率。</li>\n</ol>\n<h3 id=\"2-分库分表\"><a href=\"#2-分库分表\" class=\"headerlink\" title=\"2. 分库分表\"></a>2. 分库分表</h3><h4 id=\"1-工作原理-1\"><a href=\"#1-工作原理-1\" class=\"headerlink\" title=\"1. 工作原理\"></a>1. 工作原理</h4><p>通过一些 hash 算法或者工具实现将一张数据表垂直或者水平进行物理切分。</p>\n<h4 id=\"2-适用场景-1\"><a href=\"#2-适用场景-1\" class=\"headerlink\" title=\"2. 适用场景\"></a>2. 适用场景</h4><ol>\n<li>单表记录条数达到百万或者千万级别时</li>\n<li>解决表锁的问题</li>\n</ol>\n<h4 id=\"3-分表方式\"><a href=\"#3-分表方式\" class=\"headerlink\" title=\"3. 分表方式\"></a>3. 分表方式</h4><h5 id=\"1-水平分割\"><a href=\"#1-水平分割\" class=\"headerlink\" title=\"1. 水平分割\"></a>1. 水平分割</h5><p>表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询速度</p>\n<h6 id=\"1-使用场景\"><a href=\"#1-使用场景\" class=\"headerlink\" title=\"1. 使用场景\"></a>1. 使用场景</h6><ol>\n<li>表中的数据本身就有独立性，例如表中分别记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用，比如切分历史数据和活跃数据</li>\n<li>需要把数据存放到多个介质上</li>\n</ol>\n<h6 id=\"2-缺点\"><a href=\"#2-缺点\" class=\"headerlink\" title=\"2. 缺点\"></a>2. 缺点</h6><ol>\n<li>给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需要 union 操作；</li>\n<li>在许多数据库应用中，这种复杂性会超过带来的优点，查询时会增加读一个索引层的磁盘次数；</li>\n</ol>\n<h5 id=\"2-垂直分表\"><a href=\"#2-垂直分表\" class=\"headerlink\" title=\"2. 垂直分表\"></a>2. 垂直分表</h5><p>把主键和一些列放在一张表，然后把主键和另外的列放在另一张表中</p>\n<h6 id=\"1-使用场景-1\"><a href=\"#1-使用场景-1\" class=\"headerlink\" title=\"1. 使用场景\"></a>1. 使用场景</h6><ol>\n<li>表中某些列常用，而另外一些列不常用</li>\n<li>可以使数据行变小，一个数据页能存储更多数据，查询时减少 I/O 次数</li>\n</ol>\n<h6 id=\"2-缺点-1\"><a href=\"#2-缺点-1\" class=\"headerlink\" title=\"2. 缺点\"></a>2. 缺点</h6><p>管理冗余列，查询所有数据都需要 join 操作</p>\n<h3 id=\"3-分库分表缺点\"><a href=\"#3-分库分表缺点\" class=\"headerlink\" title=\"3. 分库分表缺点\"></a>3. 分库分表缺点</h3><ol>\n<li>有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差</li>\n<li>对于应用层来说，逻辑算法无疑会增加开发成本</li>\n</ol>\n<h2 id=\"2-MySQL-复制原理及负载均衡\"><a href=\"#2-MySQL-复制原理及负载均衡\" class=\"headerlink\" title=\"2. MySQL 复制原理及负载均衡\"></a>2. MySQL 复制原理及负载均衡</h2><h3 id=\"1-MySQL-主从复制工作原理\"><a href=\"#1-MySQL-主从复制工作原理\" class=\"headerlink\" title=\"1. MySQL 主从复制工作原理\"></a>1. MySQL 主从复制工作原理</h3><ol>\n<li>在主库上把数据更改记录到二进制文件，即所有的写操作都记录到 binlog</li>\n<li>从库将主库的日志复制到自己的中继日志</li>\n<li>从库读取中继日志中的事件，将其重放到从库数据中，即执行了日志中的 SQL 语句</li>\n</ol>\n<h3 id=\"2-解决了哪些问题\"><a href=\"#2-解决了哪些问题\" class=\"headerlink\" title=\"2. 解决了哪些问题\"></a>2. 解决了哪些问题</h3><ol>\n<li>数据分布：随意停止或开始复制，并在不同地理位置分布数据备份</li>\n<li>负载均衡：降低单个服务器的压力</li>\n<li>高可用和故障切换：帮助应用程序避免单点失败</li>\n<li>升级测试：可以使用更高版本的 MySQL 作为从库</li>\n</ol>"},{"title":"MySQL 知识整理","date":"2018-02-24T06:26:02.000Z","_content":"\n### mysql 关联更新\n\nupdate 后面跟的表名是即将要使用到的表\n\n```sql\nupdate A,B set A.c1=b.c1, A.c2=b.c2 where A.id=B.id;\nupdate A inner join B on A.id=b.id set A.c1=B.c1, A.c2=B.c2 where ...;\n```\n<!-- more -->\n\n### 6 种关联查询\n- 交叉连接 cross join: 笛卡尔积\n    - `select * from A, B, (,C)`\n    - `select * from A cross join B (cross join C)`\n    - 没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用\n- 内连接 inner join\n    - `select * from A,B where A.id=B.id`\n    - `select * from A (inner) join B on A.id=B.id`\n    - 多表中同时符合某种条件的数据记录的集合\n    - 等值连接（`on A.id=B.id`）、不等值连接（`on A.id>B.id`）、自连接（`select * from A t1 inner join A t2 on t1.id=t2.pid`）\n    - 可以缩写为 join\n- 外连接 left join/right join\n    - 左外连接： left outer join，以左表为主，先查询出左表，按照 on 后的关联条件匹配右表，没有匹配到的用 null 填充，可以简写为 left join\n    - 右外连接 right outer join\n- 联合查询 union, union all\n    - `select * from A union select * from B union ...`\n    - 多条 select 语句的结果集进行累加，union 前的结果为基准\n    - 列数要相等，相同的记录行会合并\n    - 如果使用 union all，则不会合并重复的记录行\n    - union 效率高于 union all\n- 全连接 full join\n    - 只是一个概念，mysql 不支持\n    - 可以使用 left join，union，right join 联合实现，`select * from A left join B on A.id=B.id union select * from A right join B on A.id=B.id`\n\n\n### MySQL 查询优化\n#### 1. 查找分享查询速度慢的原因\n\n##### 记录慢查询日志\n分析查询日志，不建议直接打开慢查询日志进行分析，可以使用 pt-query-digest 工具进行分析\n\n##### 使用 show profile\n`set profiling=1;` 开启，服务器上执行的所有语句都会监测消耗的时间，存到临时表中\n\n``` sql\nshow profiles;\nshow profile for query 临时表中单条记录ID;\n```\n\n##### 使用 show status\n`show status` 会返回一些计数器，`show global status` 查看服务器级别的所有计数\n\n有时根据这些计数，可以猜测出哪些操作代价较高或者消耗时间多\n\n##### 使用 show processlist\n观察是否有大量进程处于不正常的状态或者特征\n\n##### 使用 explain\n分析单条 SQL 语句\n`explain select * from A;`\n\n#### 2. 优化查询过程中的数据访问\n- 访问数据太多导致查询性能下降\n- 确定应用程序是否在检索大量超过需要的数据，可能是太多行或列\n- 确认 mysql 服务器是否在分析大量不必要的数据行\n\n方案\n- 查询不需要的记录，使用 limit\n- 多表关联只返回所需要的列\n- select * 不要用\n- 重复查询相同的数据，可以缓存数据，下次直接读取缓存\n- 使用索引覆盖扫描，把所有用的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果\n- 改变数据库和表的结构，修改数据表范式（冗余字段降低范式，用空间换取时间）\n- 重写 SQL 语句，让优化器可以以更优的方式执行查询\n\n#### 3. 优化长难的查询语句\n应当使用一个复杂查询还是多个简单查询？\n\nMySQL 内部每秒能扫描内存中上百万行的数据，相比之下，响应数据给客户端就要慢得多\n\n大多数情况下，使用尽可能少的查询是好的，但是有时将一个大的查询分解为多个小的查询也是很有必要的，这样可以方便地做缓存\n\n##### 切分查询\n将一个大的查询分为多个小的相同的查询\n\n一次性删除 1000 万的数据比一次删除一万，暂停一会的方案更加损耗服务器开销。\n\n##### 分解关联查询\n- 可以将一条关联语句分解成多条 SQL 来执行\n- 让缓存效率更高\n- 执行单个查询可以减少锁的竞争\n- 在应用层做关联可以更容易对数据库进行拆分\n\n\n#### 4. 优化特定类型的查询语句\n\n##### 优化 count(*)\n- count(*) 中的 * 会忽略所有的列，直接统计所有列数，速度更快，因此不要使用 count(列名)\n- MyISAM 中，没有任何 where 条件的 count(*) 非常快\n- 当有 where 条件，MyISAM 的 count 统计也不一定比其他表引擎快\n- 或者增加一张汇总表\n- 缓存汇总信息\n\n##### 优化关联查询\n- 确认 on 或者 using 子句的列上有索引，如果没有要添加，否则会导致全表扫描\n- 确保 group by 和 order by 中只有一个表中的列，这样 MySQL 才有可能使用索\n\n##### 优化子查询\n尽可能使用关联查询来替代\n\n##### 优化 group by 和 distinct\n- 均可使用索引来优化，是最有效的优化方法\n- 关联查询中，使用标识列进行分组效率更高，即 group by 后面跟的列名是主键列或 auto_increment 列\n- 如果不需要排序，进行 group by 时使用 order by null，MySQL 就不会再进行文件排序\n- with rollup 超级聚合，尽量挪到应用程序处理，而不应该在数据库中处理\n\n##### 优化 limit 分页\n- limit 偏移量大的时候，查询效率较低\n- 可以记录上次查询的最大ID，下次查询时直接根据该ID来查询\n\n##### 优化 union 查询\n使用 union all 替代 union 查询，效率更高，数据去重放到应用层面\n","source":"_posts/MySQL-知识整理.md","raw":"---\ntitle: MySQL 知识整理\ndate: 2018-02-24 14:26:02\ntags: MySQL\n---\n\n### mysql 关联更新\n\nupdate 后面跟的表名是即将要使用到的表\n\n```sql\nupdate A,B set A.c1=b.c1, A.c2=b.c2 where A.id=B.id;\nupdate A inner join B on A.id=b.id set A.c1=B.c1, A.c2=B.c2 where ...;\n```\n<!-- more -->\n\n### 6 种关联查询\n- 交叉连接 cross join: 笛卡尔积\n    - `select * from A, B, (,C)`\n    - `select * from A cross join B (cross join C)`\n    - 没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用\n- 内连接 inner join\n    - `select * from A,B where A.id=B.id`\n    - `select * from A (inner) join B on A.id=B.id`\n    - 多表中同时符合某种条件的数据记录的集合\n    - 等值连接（`on A.id=B.id`）、不等值连接（`on A.id>B.id`）、自连接（`select * from A t1 inner join A t2 on t1.id=t2.pid`）\n    - 可以缩写为 join\n- 外连接 left join/right join\n    - 左外连接： left outer join，以左表为主，先查询出左表，按照 on 后的关联条件匹配右表，没有匹配到的用 null 填充，可以简写为 left join\n    - 右外连接 right outer join\n- 联合查询 union, union all\n    - `select * from A union select * from B union ...`\n    - 多条 select 语句的结果集进行累加，union 前的结果为基准\n    - 列数要相等，相同的记录行会合并\n    - 如果使用 union all，则不会合并重复的记录行\n    - union 效率高于 union all\n- 全连接 full join\n    - 只是一个概念，mysql 不支持\n    - 可以使用 left join，union，right join 联合实现，`select * from A left join B on A.id=B.id union select * from A right join B on A.id=B.id`\n\n\n### MySQL 查询优化\n#### 1. 查找分享查询速度慢的原因\n\n##### 记录慢查询日志\n分析查询日志，不建议直接打开慢查询日志进行分析，可以使用 pt-query-digest 工具进行分析\n\n##### 使用 show profile\n`set profiling=1;` 开启，服务器上执行的所有语句都会监测消耗的时间，存到临时表中\n\n``` sql\nshow profiles;\nshow profile for query 临时表中单条记录ID;\n```\n\n##### 使用 show status\n`show status` 会返回一些计数器，`show global status` 查看服务器级别的所有计数\n\n有时根据这些计数，可以猜测出哪些操作代价较高或者消耗时间多\n\n##### 使用 show processlist\n观察是否有大量进程处于不正常的状态或者特征\n\n##### 使用 explain\n分析单条 SQL 语句\n`explain select * from A;`\n\n#### 2. 优化查询过程中的数据访问\n- 访问数据太多导致查询性能下降\n- 确定应用程序是否在检索大量超过需要的数据，可能是太多行或列\n- 确认 mysql 服务器是否在分析大量不必要的数据行\n\n方案\n- 查询不需要的记录，使用 limit\n- 多表关联只返回所需要的列\n- select * 不要用\n- 重复查询相同的数据，可以缓存数据，下次直接读取缓存\n- 使用索引覆盖扫描，把所有用的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果\n- 改变数据库和表的结构，修改数据表范式（冗余字段降低范式，用空间换取时间）\n- 重写 SQL 语句，让优化器可以以更优的方式执行查询\n\n#### 3. 优化长难的查询语句\n应当使用一个复杂查询还是多个简单查询？\n\nMySQL 内部每秒能扫描内存中上百万行的数据，相比之下，响应数据给客户端就要慢得多\n\n大多数情况下，使用尽可能少的查询是好的，但是有时将一个大的查询分解为多个小的查询也是很有必要的，这样可以方便地做缓存\n\n##### 切分查询\n将一个大的查询分为多个小的相同的查询\n\n一次性删除 1000 万的数据比一次删除一万，暂停一会的方案更加损耗服务器开销。\n\n##### 分解关联查询\n- 可以将一条关联语句分解成多条 SQL 来执行\n- 让缓存效率更高\n- 执行单个查询可以减少锁的竞争\n- 在应用层做关联可以更容易对数据库进行拆分\n\n\n#### 4. 优化特定类型的查询语句\n\n##### 优化 count(*)\n- count(*) 中的 * 会忽略所有的列，直接统计所有列数，速度更快，因此不要使用 count(列名)\n- MyISAM 中，没有任何 where 条件的 count(*) 非常快\n- 当有 where 条件，MyISAM 的 count 统计也不一定比其他表引擎快\n- 或者增加一张汇总表\n- 缓存汇总信息\n\n##### 优化关联查询\n- 确认 on 或者 using 子句的列上有索引，如果没有要添加，否则会导致全表扫描\n- 确保 group by 和 order by 中只有一个表中的列，这样 MySQL 才有可能使用索\n\n##### 优化子查询\n尽可能使用关联查询来替代\n\n##### 优化 group by 和 distinct\n- 均可使用索引来优化，是最有效的优化方法\n- 关联查询中，使用标识列进行分组效率更高，即 group by 后面跟的列名是主键列或 auto_increment 列\n- 如果不需要排序，进行 group by 时使用 order by null，MySQL 就不会再进行文件排序\n- with rollup 超级聚合，尽量挪到应用程序处理，而不应该在数据库中处理\n\n##### 优化 limit 分页\n- limit 偏移量大的时候，查询效率较低\n- 可以记录上次查询的最大ID，下次查询时直接根据该ID来查询\n\n##### 优化 union 查询\n使用 union all 替代 union 查询，效率更高，数据去重放到应用层面\n","slug":"MySQL-知识整理","published":1,"updated":"2020-09-11T01:04:35.038Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8l001e6wo1f8zi038a","content":"<h3 id=\"mysql-关联更新\"><a href=\"#mysql-关联更新\" class=\"headerlink\" title=\"mysql 关联更新\"></a>mysql 关联更新</h3><p>update 后面跟的表名是即将要使用到的表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">update</span> A,B <span class=\"keyword\">set</span> A.c1=b.c1, A.c2=b.c2 <span class=\"keyword\">where</span> A.id=B.id;</span><br><span class=\"line\"><span class=\"keyword\">update</span> A <span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> B <span class=\"keyword\">on</span> A.id=b.id <span class=\"keyword\">set</span> A.c1=B.c1, A.c2=B.c2 <span class=\"keyword\">where</span> ...;</span><br></pre></td></tr></table></figure>\n<a id=\"more\"></a>\n\n<h3 id=\"6-种关联查询\"><a href=\"#6-种关联查询\" class=\"headerlink\" title=\"6 种关联查询\"></a>6 种关联查询</h3><ul>\n<li>交叉连接 cross join: 笛卡尔积<ul>\n<li><code>select * from A, B, (,C)</code></li>\n<li><code>select * from A cross join B (cross join C)</code></li>\n<li>没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用</li>\n</ul>\n</li>\n<li>内连接 inner join<ul>\n<li><code>select * from A,B where A.id=B.id</code></li>\n<li><code>select * from A (inner) join B on A.id=B.id</code></li>\n<li>多表中同时符合某种条件的数据记录的集合</li>\n<li>等值连接（<code>on A.id=B.id</code>）、不等值连接（<code>on A.id&gt;B.id</code>）、自连接（<code>select * from A t1 inner join A t2 on t1.id=t2.pid</code>）</li>\n<li>可以缩写为 join</li>\n</ul>\n</li>\n<li>外连接 left join/right join<ul>\n<li>左外连接： left outer join，以左表为主，先查询出左表，按照 on 后的关联条件匹配右表，没有匹配到的用 null 填充，可以简写为 left join</li>\n<li>右外连接 right outer join</li>\n</ul>\n</li>\n<li>联合查询 union, union all<ul>\n<li><code>select * from A union select * from B union ...</code></li>\n<li>多条 select 语句的结果集进行累加，union 前的结果为基准</li>\n<li>列数要相等，相同的记录行会合并</li>\n<li>如果使用 union all，则不会合并重复的记录行</li>\n<li>union 效率高于 union all</li>\n</ul>\n</li>\n<li>全连接 full join<ul>\n<li>只是一个概念，mysql 不支持</li>\n<li>可以使用 left join，union，right join 联合实现，<code>select * from A left join B on A.id=B.id union select * from A right join B on A.id=B.id</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MySQL-查询优化\"><a href=\"#MySQL-查询优化\" class=\"headerlink\" title=\"MySQL 查询优化\"></a>MySQL 查询优化</h3><h4 id=\"1-查找分享查询速度慢的原因\"><a href=\"#1-查找分享查询速度慢的原因\" class=\"headerlink\" title=\"1. 查找分享查询速度慢的原因\"></a>1. 查找分享查询速度慢的原因</h4><h5 id=\"记录慢查询日志\"><a href=\"#记录慢查询日志\" class=\"headerlink\" title=\"记录慢查询日志\"></a>记录慢查询日志</h5><p>分析查询日志，不建议直接打开慢查询日志进行分析，可以使用 pt-query-digest 工具进行分析</p>\n<h5 id=\"使用-show-profile\"><a href=\"#使用-show-profile\" class=\"headerlink\" title=\"使用 show profile\"></a>使用 show profile</h5><p><code>set profiling=1;</code> 开启，服务器上执行的所有语句都会监测消耗的时间，存到临时表中</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">profiles</span>;</span><br><span class=\"line\"><span class=\"keyword\">show</span> profile <span class=\"keyword\">for</span> <span class=\"keyword\">query</span> 临时表中单条记录<span class=\"keyword\">ID</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"使用-show-status\"><a href=\"#使用-show-status\" class=\"headerlink\" title=\"使用 show status\"></a>使用 show status</h5><p><code>show status</code> 会返回一些计数器，<code>show global status</code> 查看服务器级别的所有计数</p>\n<p>有时根据这些计数，可以猜测出哪些操作代价较高或者消耗时间多</p>\n<h5 id=\"使用-show-processlist\"><a href=\"#使用-show-processlist\" class=\"headerlink\" title=\"使用 show processlist\"></a>使用 show processlist</h5><p>观察是否有大量进程处于不正常的状态或者特征</p>\n<h5 id=\"使用-explain\"><a href=\"#使用-explain\" class=\"headerlink\" title=\"使用 explain\"></a>使用 explain</h5><p>分析单条 SQL 语句<br><code>explain select * from A;</code></p>\n<h4 id=\"2-优化查询过程中的数据访问\"><a href=\"#2-优化查询过程中的数据访问\" class=\"headerlink\" title=\"2. 优化查询过程中的数据访问\"></a>2. 优化查询过程中的数据访问</h4><ul>\n<li>访问数据太多导致查询性能下降</li>\n<li>确定应用程序是否在检索大量超过需要的数据，可能是太多行或列</li>\n<li>确认 mysql 服务器是否在分析大量不必要的数据行</li>\n</ul>\n<p>方案</p>\n<ul>\n<li>查询不需要的记录，使用 limit</li>\n<li>多表关联只返回所需要的列</li>\n<li>select * 不要用</li>\n<li>重复查询相同的数据，可以缓存数据，下次直接读取缓存</li>\n<li>使用索引覆盖扫描，把所有用的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果</li>\n<li>改变数据库和表的结构，修改数据表范式（冗余字段降低范式，用空间换取时间）</li>\n<li>重写 SQL 语句，让优化器可以以更优的方式执行查询</li>\n</ul>\n<h4 id=\"3-优化长难的查询语句\"><a href=\"#3-优化长难的查询语句\" class=\"headerlink\" title=\"3. 优化长难的查询语句\"></a>3. 优化长难的查询语句</h4><p>应当使用一个复杂查询还是多个简单查询？</p>\n<p>MySQL 内部每秒能扫描内存中上百万行的数据，相比之下，响应数据给客户端就要慢得多</p>\n<p>大多数情况下，使用尽可能少的查询是好的，但是有时将一个大的查询分解为多个小的查询也是很有必要的，这样可以方便地做缓存</p>\n<h5 id=\"切分查询\"><a href=\"#切分查询\" class=\"headerlink\" title=\"切分查询\"></a>切分查询</h5><p>将一个大的查询分为多个小的相同的查询</p>\n<p>一次性删除 1000 万的数据比一次删除一万，暂停一会的方案更加损耗服务器开销。</p>\n<h5 id=\"分解关联查询\"><a href=\"#分解关联查询\" class=\"headerlink\" title=\"分解关联查询\"></a>分解关联查询</h5><ul>\n<li>可以将一条关联语句分解成多条 SQL 来执行</li>\n<li>让缓存效率更高</li>\n<li>执行单个查询可以减少锁的竞争</li>\n<li>在应用层做关联可以更容易对数据库进行拆分</li>\n</ul>\n<h4 id=\"4-优化特定类型的查询语句\"><a href=\"#4-优化特定类型的查询语句\" class=\"headerlink\" title=\"4. 优化特定类型的查询语句\"></a>4. 优化特定类型的查询语句</h4><h5 id=\"优化-count\"><a href=\"#优化-count\" class=\"headerlink\" title=\"优化 count(*)\"></a>优化 count(*)</h5><ul>\n<li>count(*) 中的 * 会忽略所有的列，直接统计所有列数，速度更快，因此不要使用 count(列名)</li>\n<li>MyISAM 中，没有任何 where 条件的 count(*) 非常快</li>\n<li>当有 where 条件，MyISAM 的 count 统计也不一定比其他表引擎快</li>\n<li>或者增加一张汇总表</li>\n<li>缓存汇总信息</li>\n</ul>\n<h5 id=\"优化关联查询\"><a href=\"#优化关联查询\" class=\"headerlink\" title=\"优化关联查询\"></a>优化关联查询</h5><ul>\n<li>确认 on 或者 using 子句的列上有索引，如果没有要添加，否则会导致全表扫描</li>\n<li>确保 group by 和 order by 中只有一个表中的列，这样 MySQL 才有可能使用索</li>\n</ul>\n<h5 id=\"优化子查询\"><a href=\"#优化子查询\" class=\"headerlink\" title=\"优化子查询\"></a>优化子查询</h5><p>尽可能使用关联查询来替代</p>\n<h5 id=\"优化-group-by-和-distinct\"><a href=\"#优化-group-by-和-distinct\" class=\"headerlink\" title=\"优化 group by 和 distinct\"></a>优化 group by 和 distinct</h5><ul>\n<li>均可使用索引来优化，是最有效的优化方法</li>\n<li>关联查询中，使用标识列进行分组效率更高，即 group by 后面跟的列名是主键列或 auto_increment 列</li>\n<li>如果不需要排序，进行 group by 时使用 order by null，MySQL 就不会再进行文件排序</li>\n<li>with rollup 超级聚合，尽量挪到应用程序处理，而不应该在数据库中处理</li>\n</ul>\n<h5 id=\"优化-limit-分页\"><a href=\"#优化-limit-分页\" class=\"headerlink\" title=\"优化 limit 分页\"></a>优化 limit 分页</h5><ul>\n<li>limit 偏移量大的时候，查询效率较低</li>\n<li>可以记录上次查询的最大ID，下次查询时直接根据该ID来查询</li>\n</ul>\n<h5 id=\"优化-union-查询\"><a href=\"#优化-union-查询\" class=\"headerlink\" title=\"优化 union 查询\"></a>优化 union 查询</h5><p>使用 union all 替代 union 查询，效率更高，数据去重放到应用层面</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"mysql-关联更新\"><a href=\"#mysql-关联更新\" class=\"headerlink\" title=\"mysql 关联更新\"></a>mysql 关联更新</h3><p>update 后面跟的表名是即将要使用到的表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">update</span> A,B <span class=\"keyword\">set</span> A.c1=b.c1, A.c2=b.c2 <span class=\"keyword\">where</span> A.id=B.id;</span><br><span class=\"line\"><span class=\"keyword\">update</span> A <span class=\"keyword\">inner</span> <span class=\"keyword\">join</span> B <span class=\"keyword\">on</span> A.id=b.id <span class=\"keyword\">set</span> A.c1=B.c1, A.c2=B.c2 <span class=\"keyword\">where</span> ...;</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"6-种关联查询\"><a href=\"#6-种关联查询\" class=\"headerlink\" title=\"6 种关联查询\"></a>6 种关联查询</h3><ul>\n<li>交叉连接 cross join: 笛卡尔积<ul>\n<li><code>select * from A, B, (,C)</code></li>\n<li><code>select * from A cross join B (cross join C)</code></li>\n<li>没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用</li>\n</ul>\n</li>\n<li>内连接 inner join<ul>\n<li><code>select * from A,B where A.id=B.id</code></li>\n<li><code>select * from A (inner) join B on A.id=B.id</code></li>\n<li>多表中同时符合某种条件的数据记录的集合</li>\n<li>等值连接（<code>on A.id=B.id</code>）、不等值连接（<code>on A.id&gt;B.id</code>）、自连接（<code>select * from A t1 inner join A t2 on t1.id=t2.pid</code>）</li>\n<li>可以缩写为 join</li>\n</ul>\n</li>\n<li>外连接 left join/right join<ul>\n<li>左外连接： left outer join，以左表为主，先查询出左表，按照 on 后的关联条件匹配右表，没有匹配到的用 null 填充，可以简写为 left join</li>\n<li>右外连接 right outer join</li>\n</ul>\n</li>\n<li>联合查询 union, union all<ul>\n<li><code>select * from A union select * from B union ...</code></li>\n<li>多条 select 语句的结果集进行累加，union 前的结果为基准</li>\n<li>列数要相等，相同的记录行会合并</li>\n<li>如果使用 union all，则不会合并重复的记录行</li>\n<li>union 效率高于 union all</li>\n</ul>\n</li>\n<li>全连接 full join<ul>\n<li>只是一个概念，mysql 不支持</li>\n<li>可以使用 left join，union，right join 联合实现，<code>select * from A left join B on A.id=B.id union select * from A right join B on A.id=B.id</code></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"MySQL-查询优化\"><a href=\"#MySQL-查询优化\" class=\"headerlink\" title=\"MySQL 查询优化\"></a>MySQL 查询优化</h3><h4 id=\"1-查找分享查询速度慢的原因\"><a href=\"#1-查找分享查询速度慢的原因\" class=\"headerlink\" title=\"1. 查找分享查询速度慢的原因\"></a>1. 查找分享查询速度慢的原因</h4><h5 id=\"记录慢查询日志\"><a href=\"#记录慢查询日志\" class=\"headerlink\" title=\"记录慢查询日志\"></a>记录慢查询日志</h5><p>分析查询日志，不建议直接打开慢查询日志进行分析，可以使用 pt-query-digest 工具进行分析</p>\n<h5 id=\"使用-show-profile\"><a href=\"#使用-show-profile\" class=\"headerlink\" title=\"使用 show profile\"></a>使用 show profile</h5><p><code>set profiling=1;</code> 开启，服务器上执行的所有语句都会监测消耗的时间，存到临时表中</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">show</span> <span class=\"keyword\">profiles</span>;</span><br><span class=\"line\"><span class=\"keyword\">show</span> profile <span class=\"keyword\">for</span> <span class=\"keyword\">query</span> 临时表中单条记录<span class=\"keyword\">ID</span>;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"使用-show-status\"><a href=\"#使用-show-status\" class=\"headerlink\" title=\"使用 show status\"></a>使用 show status</h5><p><code>show status</code> 会返回一些计数器，<code>show global status</code> 查看服务器级别的所有计数</p>\n<p>有时根据这些计数，可以猜测出哪些操作代价较高或者消耗时间多</p>\n<h5 id=\"使用-show-processlist\"><a href=\"#使用-show-processlist\" class=\"headerlink\" title=\"使用 show processlist\"></a>使用 show processlist</h5><p>观察是否有大量进程处于不正常的状态或者特征</p>\n<h5 id=\"使用-explain\"><a href=\"#使用-explain\" class=\"headerlink\" title=\"使用 explain\"></a>使用 explain</h5><p>分析单条 SQL 语句<br><code>explain select * from A;</code></p>\n<h4 id=\"2-优化查询过程中的数据访问\"><a href=\"#2-优化查询过程中的数据访问\" class=\"headerlink\" title=\"2. 优化查询过程中的数据访问\"></a>2. 优化查询过程中的数据访问</h4><ul>\n<li>访问数据太多导致查询性能下降</li>\n<li>确定应用程序是否在检索大量超过需要的数据，可能是太多行或列</li>\n<li>确认 mysql 服务器是否在分析大量不必要的数据行</li>\n</ul>\n<p>方案</p>\n<ul>\n<li>查询不需要的记录，使用 limit</li>\n<li>多表关联只返回所需要的列</li>\n<li>select * 不要用</li>\n<li>重复查询相同的数据，可以缓存数据，下次直接读取缓存</li>\n<li>使用索引覆盖扫描，把所有用的列都放到索引中，这样存储引擎不需要回表获取对应行就可以返回结果</li>\n<li>改变数据库和表的结构，修改数据表范式（冗余字段降低范式，用空间换取时间）</li>\n<li>重写 SQL 语句，让优化器可以以更优的方式执行查询</li>\n</ul>\n<h4 id=\"3-优化长难的查询语句\"><a href=\"#3-优化长难的查询语句\" class=\"headerlink\" title=\"3. 优化长难的查询语句\"></a>3. 优化长难的查询语句</h4><p>应当使用一个复杂查询还是多个简单查询？</p>\n<p>MySQL 内部每秒能扫描内存中上百万行的数据，相比之下，响应数据给客户端就要慢得多</p>\n<p>大多数情况下，使用尽可能少的查询是好的，但是有时将一个大的查询分解为多个小的查询也是很有必要的，这样可以方便地做缓存</p>\n<h5 id=\"切分查询\"><a href=\"#切分查询\" class=\"headerlink\" title=\"切分查询\"></a>切分查询</h5><p>将一个大的查询分为多个小的相同的查询</p>\n<p>一次性删除 1000 万的数据比一次删除一万，暂停一会的方案更加损耗服务器开销。</p>\n<h5 id=\"分解关联查询\"><a href=\"#分解关联查询\" class=\"headerlink\" title=\"分解关联查询\"></a>分解关联查询</h5><ul>\n<li>可以将一条关联语句分解成多条 SQL 来执行</li>\n<li>让缓存效率更高</li>\n<li>执行单个查询可以减少锁的竞争</li>\n<li>在应用层做关联可以更容易对数据库进行拆分</li>\n</ul>\n<h4 id=\"4-优化特定类型的查询语句\"><a href=\"#4-优化特定类型的查询语句\" class=\"headerlink\" title=\"4. 优化特定类型的查询语句\"></a>4. 优化特定类型的查询语句</h4><h5 id=\"优化-count\"><a href=\"#优化-count\" class=\"headerlink\" title=\"优化 count(*)\"></a>优化 count(*)</h5><ul>\n<li>count(*) 中的 * 会忽略所有的列，直接统计所有列数，速度更快，因此不要使用 count(列名)</li>\n<li>MyISAM 中，没有任何 where 条件的 count(*) 非常快</li>\n<li>当有 where 条件，MyISAM 的 count 统计也不一定比其他表引擎快</li>\n<li>或者增加一张汇总表</li>\n<li>缓存汇总信息</li>\n</ul>\n<h5 id=\"优化关联查询\"><a href=\"#优化关联查询\" class=\"headerlink\" title=\"优化关联查询\"></a>优化关联查询</h5><ul>\n<li>确认 on 或者 using 子句的列上有索引，如果没有要添加，否则会导致全表扫描</li>\n<li>确保 group by 和 order by 中只有一个表中的列，这样 MySQL 才有可能使用索</li>\n</ul>\n<h5 id=\"优化子查询\"><a href=\"#优化子查询\" class=\"headerlink\" title=\"优化子查询\"></a>优化子查询</h5><p>尽可能使用关联查询来替代</p>\n<h5 id=\"优化-group-by-和-distinct\"><a href=\"#优化-group-by-和-distinct\" class=\"headerlink\" title=\"优化 group by 和 distinct\"></a>优化 group by 和 distinct</h5><ul>\n<li>均可使用索引来优化，是最有效的优化方法</li>\n<li>关联查询中，使用标识列进行分组效率更高，即 group by 后面跟的列名是主键列或 auto_increment 列</li>\n<li>如果不需要排序，进行 group by 时使用 order by null，MySQL 就不会再进行文件排序</li>\n<li>with rollup 超级聚合，尽量挪到应用程序处理，而不应该在数据库中处理</li>\n</ul>\n<h5 id=\"优化-limit-分页\"><a href=\"#优化-limit-分页\" class=\"headerlink\" title=\"优化 limit 分页\"></a>优化 limit 分页</h5><ul>\n<li>limit 偏移量大的时候，查询效率较低</li>\n<li>可以记录上次查询的最大ID，下次查询时直接根据该ID来查询</li>\n</ul>\n<h5 id=\"优化-union-查询\"><a href=\"#优化-union-查询\" class=\"headerlink\" title=\"优化 union 查询\"></a>优化 union 查询</h5><p>使用 union all 替代 union 查询，效率更高，数据去重放到应用层面</p>"},{"_content":"### 1. echo(),print(),print_r()的区别？\n- echo 和 print 不是一个函数，是一个语言结构；\n- `print(string $arg)` 只有一个参数；\n- `echo arg1,arg2` 可以输出多个参数，返回 `void` ；\n- `echo` 和 `print` 只能打印出string，不能打印出结构；\n- `print_r` 能打印出结构。比如:\n\n<!--more-->\n\n```\n$arr = array(\"key\"=>\"value\");\nprint_r($arr);\n\nArray\n(\n    [key] => value\n)\n```\n\n### 2. 语句include和require的区别是什么?\n在失败的时候：\ninclude 产生一个 warning ，而 require 直接产生错误中断；\n\nrequire 在运行前载入；\n\ninclude 在运行时载入；\n\nrequire_once 和 include_once 可以避免重复包含同一文件。\n\n### 3. php中传值与传引用有啥区别?\n&表示传引用；\n\n函数中参数传引用会将参数进行改变；\n\n一般在输出参数有多个的时候可以考虑使用引用。\n\n### 4. 下面哪项没有将john添加到users数组中？\n```\n(a) $users[] = 'john';\n(b) array_add($users,'john');\n(c) array_push($users,'john');\n(d) $users ||= 'john';\n```\n\n答案为bd，php 里面无 `array_add` 函数，d项为语法错误的表达。\n\n### 5. HTTP协议中几个状态码的含义。\n- 200 : 请求成功，请求的数据随之返回 OK。\n- 301 : 永久性重定向 Moved permanently。\n- 302 : 暂时行重定向 Moved Temporarily\n- 401 : 当前请求需要用户验证 Unauthorized。\n- 403 : 服务器拒绝执行请求，即没有权限 Forbidden。\n- 404 : 请求失败，请求的数据在服务器上未发现 Not found。\n- 500 : 服务器错误。一般服务器端程序执行错误 Internal server error。\n- 503 : 服务器临时维护或过载。这个状态时临时性的 Service unavailable。\n- 504：超时，Gateway timeout\n\n\n### 6. 写出一些php魔术方法。\n```\n__construct() 实例化类时自动调用。\n__destruct() 类对象使用结束时自动调用。\n__set() 在给未定义的属性赋值的时候调用。\n__get() 调用未定义的属性时候调用。\n__isset() 使用isset()或empty()函数时候会调用。\n__unset() 使用unset()时候会调用。\n__sleep() 使用serialize序列化时候调用。\n__wakeup() 使用unserialize反序列化的时候调用。\n__call() 调用一个不存在的方法的时候调用。\n__callStatic()调用一个不存在的静态方法是调用。\n__toString() 把对象转换成字符串的时候会调用。比如 echo。\n__invoke() 当尝试把对象当方法调用时调用。\n__set_state() 当使用var_export()函数时候调用。接受一个数组参数。\n__clone() 当使用clone复制一个对象时候调用。\n```\n\n### 7. MySQL存储引擎 MyISAM 和 InnoDB 的区别。\n```\na. MyISAM类型不支持事务处理等高级处理，而InnoDB类型支持.\nb. MyISAM类型的表强调的是性能，其执行速度比InnoDB类型更快.\nc. InnoDB不支持FULLTEXT类型的索引.\nd. InnoDB中不保存表的具体行数，也就是说，执行select count(*) from table时，InnoDB要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可.\ne. 对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。\nf. DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除。\ng. LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性(例如外键)的表不适用.\nh. MyISAM支持表锁，InnoDB支持行锁。\n```\n\n### 8. 说出一些MySQL优化方法？\n```\na. 设计良好的数据库结构，允许部分数据冗余，尽量避免join查询，提高效率。\nb. 选择合适的表字段数据类型和存储引擎，适当的添加索引。\nc. mysql库主从读写分离。\nd. 找规律分表，减少单表中的数据量提高查询速度。\ne. 添加缓存机制，比如memcached，apc等。\nf. 不经常改动的页面，生成静态页面。\ng. 书写高效率的SQL。比如 SELECT * FROM TABEL 改为 SELECT field_1, field_2, field_3 FROM TABLE.\n```\n\n### 9. 下面$a的结果是：\n```\n<?php\n$a = in_array('01', array('1')) == var_dump('01' == 1);\n?>\nA true\nB false\n\nvar_dump('01' == 1) // return NULL\nin_array('01', array('1')) // return true\n\n$a // false\n```\n\n答案为B\n\n### 10. 说下php中empty()和isset()的区别。\n```\nisset 用于检测变量是否被设置，使用 isset() 测试一个被设置成 NULL 的变量，将返回 FALSE 。\nempty 如果 var 是非空或非零的值，则 empty() 返回 FALSE。换句话说，\"\"、0、\"0\"、NULL、FALSE、array()、var $var; 以及没有任何属性的对象（只有这8个，记住了）都将被认为是空的，如果 var 为空，则返回 TRUE 。\n\n如果变量为 0 ，则empty()会返回TRUE，isset()会返回TRUE；\n如果变量为空字符串，则empty()会返回TRUE，isset()会返回TRUE；\n如果变量未定义，则empty()会返回TRUE，isset()会返回FLASE。\n\n注意：isset() 只能用于变量，因为传递任何其它参数都将造成解析错误。若想检测常量是否已设置，可使用 defined() 函数。\n当要 判断一个变量是否已经声明的时候 可以使用 isset 函数；\n当要 判断一个变量是否已经赋予数据且不为空 可以用 empty函数；\n当要 判断 一个变量 存在且不为空 先 isset 函数 再用 empty 函数；\n```\n\n### 题2：nginx使用哪种网络协议?\n\n答案：nginx是应用层 我觉得从下往上的话 传输层用的是tcp/ip 应用层用的是http fastcgi负责调度进程。\n\n### cookie 和session 的区别：\n\n1. cookie数据存放在客户的浏览器上，session数据放在服务器上。\n\n2. cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗\n   考虑到安全应当使用session。\n\n1. session 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能\n   考虑到减轻服务器性能方面，应当使用COOKIE。\n\n4. 单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。\n\n1. 所以个人建议：\n   将登陆信息等重要信息存放为SESSION，其他信息如果需要保留，可以放在COOKIE中\n   \n   ### 题9：数据库中的事务是什么?\n\n答案：事务（transaction）是作为一个单元的一组有序的数据库操作。如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。如果所有操作完成，事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。\n\n### 题11：简述下面程序的输出结果, 简要说明为什么, 如何解决这类问题? \n```php\n<?php \n$tmp = 0 == \"a\"? 1: 2; \necho $tmp; \n?> \n```\n答案： 1\n\nint和string类型强制转换造成的，0 ＝＝ 0 肯定是true啊 \n\nPHP是弱类型\n```\n$tmp = 0 === \"a\"? 1: 2; \necho $tmp; \n```\n这样就是2 \n\n### 题12：什么是MVC？\n\n答案：MVC由Model（模型）, View（视图）和Controller（控制器）组成，PHP MVC可以更高效地管理好3个不同层的PHP代码。\n\n- Model：数据信息存取层。\n- View：view层负责将应用的数据以特定的方式展现在界面上。\n- Controller：通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。\n\n\n### \n题21：简述两种屏蔽php程序的notice警告的方法 \n\n答案：\n\n1. 在程序中添加：error_reporting (E_ALL & ~E_NOTICE); \n2. 修改php.ini中的：error_reporting = E_ALL 改为：error_reporting = E_ALL & ~E_NOTICE \n3. error_reporting(0);或者修改php.inidisplay_errors=Off \n\n### 题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\n\n答案：\n\n冒泡排序（数组排序）：原理：两两相邻的数进行比较，如果反序就交换，否则不交换\n``` php\nfunction bubble_sort($array)\n{\n    $count = count($array);\n    if ($count <= 0) return false;\n    for($i=0; $i<$count; $i++){\n        for($j=$count-1; $j>$i; $j--){\n            if ($array[$j] < $array[$j-1]){\n                $tmp = $array[$j];\n                $array[$j] = $array[$j-1];\n                $array[$j-1] = $tmp;\n            }\n        }\n    }\n    return $array;\n}\n```\n\n快速排序（数组排序）：\n\n原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，\n如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作\n\n不难发现，这里符合递归的原理，所以我们可以用递归来实现。\n\n使用递归，则需要找到递归点和递归出口：\n- 递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1\n- 递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。\n\n``` php\nfunction quicksort($array) {\n    if (count($array) <= 1) return $array;\n    $key = $array[0];\n    $left_arr = array();\n    $right_arr = array();\n    for ($i=1; $i<count($array); $i++){\n        if ($array[$i] <= $key)\n            $left_arr[] = $array[$i];\n        else\n            $right_arr[] = $array[$i];\n    }\n    $left_arr = quicksort($left_arr);\n    $right_arr = quicksort($right_arr);\n    return array_merge($left_arr, array($key), $right_arr);\n}\n```\n","source":"_posts/PHP 面试.md","raw":"### 1. echo(),print(),print_r()的区别？\n- echo 和 print 不是一个函数，是一个语言结构；\n- `print(string $arg)` 只有一个参数；\n- `echo arg1,arg2` 可以输出多个参数，返回 `void` ；\n- `echo` 和 `print` 只能打印出string，不能打印出结构；\n- `print_r` 能打印出结构。比如:\n\n<!--more-->\n\n```\n$arr = array(\"key\"=>\"value\");\nprint_r($arr);\n\nArray\n(\n    [key] => value\n)\n```\n\n### 2. 语句include和require的区别是什么?\n在失败的时候：\ninclude 产生一个 warning ，而 require 直接产生错误中断；\n\nrequire 在运行前载入；\n\ninclude 在运行时载入；\n\nrequire_once 和 include_once 可以避免重复包含同一文件。\n\n### 3. php中传值与传引用有啥区别?\n&表示传引用；\n\n函数中参数传引用会将参数进行改变；\n\n一般在输出参数有多个的时候可以考虑使用引用。\n\n### 4. 下面哪项没有将john添加到users数组中？\n```\n(a) $users[] = 'john';\n(b) array_add($users,'john');\n(c) array_push($users,'john');\n(d) $users ||= 'john';\n```\n\n答案为bd，php 里面无 `array_add` 函数，d项为语法错误的表达。\n\n### 5. HTTP协议中几个状态码的含义。\n- 200 : 请求成功，请求的数据随之返回 OK。\n- 301 : 永久性重定向 Moved permanently。\n- 302 : 暂时行重定向 Moved Temporarily\n- 401 : 当前请求需要用户验证 Unauthorized。\n- 403 : 服务器拒绝执行请求，即没有权限 Forbidden。\n- 404 : 请求失败，请求的数据在服务器上未发现 Not found。\n- 500 : 服务器错误。一般服务器端程序执行错误 Internal server error。\n- 503 : 服务器临时维护或过载。这个状态时临时性的 Service unavailable。\n- 504：超时，Gateway timeout\n\n\n### 6. 写出一些php魔术方法。\n```\n__construct() 实例化类时自动调用。\n__destruct() 类对象使用结束时自动调用。\n__set() 在给未定义的属性赋值的时候调用。\n__get() 调用未定义的属性时候调用。\n__isset() 使用isset()或empty()函数时候会调用。\n__unset() 使用unset()时候会调用。\n__sleep() 使用serialize序列化时候调用。\n__wakeup() 使用unserialize反序列化的时候调用。\n__call() 调用一个不存在的方法的时候调用。\n__callStatic()调用一个不存在的静态方法是调用。\n__toString() 把对象转换成字符串的时候会调用。比如 echo。\n__invoke() 当尝试把对象当方法调用时调用。\n__set_state() 当使用var_export()函数时候调用。接受一个数组参数。\n__clone() 当使用clone复制一个对象时候调用。\n```\n\n### 7. MySQL存储引擎 MyISAM 和 InnoDB 的区别。\n```\na. MyISAM类型不支持事务处理等高级处理，而InnoDB类型支持.\nb. MyISAM类型的表强调的是性能，其执行速度比InnoDB类型更快.\nc. InnoDB不支持FULLTEXT类型的索引.\nd. InnoDB中不保存表的具体行数，也就是说，执行select count(*) from table时，InnoDB要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可.\ne. 对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。\nf. DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除。\ng. LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性(例如外键)的表不适用.\nh. MyISAM支持表锁，InnoDB支持行锁。\n```\n\n### 8. 说出一些MySQL优化方法？\n```\na. 设计良好的数据库结构，允许部分数据冗余，尽量避免join查询，提高效率。\nb. 选择合适的表字段数据类型和存储引擎，适当的添加索引。\nc. mysql库主从读写分离。\nd. 找规律分表，减少单表中的数据量提高查询速度。\ne. 添加缓存机制，比如memcached，apc等。\nf. 不经常改动的页面，生成静态页面。\ng. 书写高效率的SQL。比如 SELECT * FROM TABEL 改为 SELECT field_1, field_2, field_3 FROM TABLE.\n```\n\n### 9. 下面$a的结果是：\n```\n<?php\n$a = in_array('01', array('1')) == var_dump('01' == 1);\n?>\nA true\nB false\n\nvar_dump('01' == 1) // return NULL\nin_array('01', array('1')) // return true\n\n$a // false\n```\n\n答案为B\n\n### 10. 说下php中empty()和isset()的区别。\n```\nisset 用于检测变量是否被设置，使用 isset() 测试一个被设置成 NULL 的变量，将返回 FALSE 。\nempty 如果 var 是非空或非零的值，则 empty() 返回 FALSE。换句话说，\"\"、0、\"0\"、NULL、FALSE、array()、var $var; 以及没有任何属性的对象（只有这8个，记住了）都将被认为是空的，如果 var 为空，则返回 TRUE 。\n\n如果变量为 0 ，则empty()会返回TRUE，isset()会返回TRUE；\n如果变量为空字符串，则empty()会返回TRUE，isset()会返回TRUE；\n如果变量未定义，则empty()会返回TRUE，isset()会返回FLASE。\n\n注意：isset() 只能用于变量，因为传递任何其它参数都将造成解析错误。若想检测常量是否已设置，可使用 defined() 函数。\n当要 判断一个变量是否已经声明的时候 可以使用 isset 函数；\n当要 判断一个变量是否已经赋予数据且不为空 可以用 empty函数；\n当要 判断 一个变量 存在且不为空 先 isset 函数 再用 empty 函数；\n```\n\n### 题2：nginx使用哪种网络协议?\n\n答案：nginx是应用层 我觉得从下往上的话 传输层用的是tcp/ip 应用层用的是http fastcgi负责调度进程。\n\n### cookie 和session 的区别：\n\n1. cookie数据存放在客户的浏览器上，session数据放在服务器上。\n\n2. cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗\n   考虑到安全应当使用session。\n\n1. session 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能\n   考虑到减轻服务器性能方面，应当使用COOKIE。\n\n4. 单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。\n\n1. 所以个人建议：\n   将登陆信息等重要信息存放为SESSION，其他信息如果需要保留，可以放在COOKIE中\n   \n   ### 题9：数据库中的事务是什么?\n\n答案：事务（transaction）是作为一个单元的一组有序的数据库操作。如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。如果所有操作完成，事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。\n\n### 题11：简述下面程序的输出结果, 简要说明为什么, 如何解决这类问题? \n```php\n<?php \n$tmp = 0 == \"a\"? 1: 2; \necho $tmp; \n?> \n```\n答案： 1\n\nint和string类型强制转换造成的，0 ＝＝ 0 肯定是true啊 \n\nPHP是弱类型\n```\n$tmp = 0 === \"a\"? 1: 2; \necho $tmp; \n```\n这样就是2 \n\n### 题12：什么是MVC？\n\n答案：MVC由Model（模型）, View（视图）和Controller（控制器）组成，PHP MVC可以更高效地管理好3个不同层的PHP代码。\n\n- Model：数据信息存取层。\n- View：view层负责将应用的数据以特定的方式展现在界面上。\n- Controller：通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。\n\n\n### \n题21：简述两种屏蔽php程序的notice警告的方法 \n\n答案：\n\n1. 在程序中添加：error_reporting (E_ALL & ~E_NOTICE); \n2. 修改php.ini中的：error_reporting = E_ALL 改为：error_reporting = E_ALL & ~E_NOTICE \n3. error_reporting(0);或者修改php.inidisplay_errors=Off \n\n### 题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\n\n答案：\n\n冒泡排序（数组排序）：原理：两两相邻的数进行比较，如果反序就交换，否则不交换\n``` php\nfunction bubble_sort($array)\n{\n    $count = count($array);\n    if ($count <= 0) return false;\n    for($i=0; $i<$count; $i++){\n        for($j=$count-1; $j>$i; $j--){\n            if ($array[$j] < $array[$j-1]){\n                $tmp = $array[$j];\n                $array[$j] = $array[$j-1];\n                $array[$j-1] = $tmp;\n            }\n        }\n    }\n    return $array;\n}\n```\n\n快速排序（数组排序）：\n\n原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，\n如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作\n\n不难发现，这里符合递归的原理，所以我们可以用递归来实现。\n\n使用递归，则需要找到递归点和递归出口：\n- 递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1\n- 递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。\n\n``` php\nfunction quicksort($array) {\n    if (count($array) <= 1) return $array;\n    $key = $array[0];\n    $left_arr = array();\n    $right_arr = array();\n    for ($i=1; $i<count($array); $i++){\n        if ($array[$i] <= $key)\n            $left_arr[] = $array[$i];\n        else\n            $right_arr[] = $array[$i];\n    }\n    $left_arr = quicksort($left_arr);\n    $right_arr = quicksort($right_arr);\n    return array_merge($left_arr, array($key), $right_arr);\n}\n```\n","slug":"PHP 面试","published":1,"date":"2020-09-11T01:04:35.039Z","updated":"2020-09-11T01:04:35.039Z","title":"","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8n001g6wo1f8k75wct","content":"<h3 id=\"1-echo-print-print-r-的区别？\"><a href=\"#1-echo-print-print-r-的区别？\" class=\"headerlink\" title=\"1. echo(),print(),print_r()的区别？\"></a>1. echo(),print(),print_r()的区别？</h3><ul>\n<li>echo 和 print 不是一个函数，是一个语言结构；</li>\n<li><code>print(string $arg)</code> 只有一个参数；</li>\n<li><code>echo arg1,arg2</code> 可以输出多个参数，返回 <code>void</code> ；</li>\n<li><code>echo</code> 和 <code>print</code> 只能打印出string，不能打印出结构；</li>\n<li><code>print_r</code> 能打印出结构。比如:</li>\n</ul>\n<a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr &#x3D; array(&quot;key&quot;&#x3D;&gt;&quot;value&quot;);</span><br><span class=\"line\">print_r($arr);</span><br><span class=\"line\"></span><br><span class=\"line\">Array</span><br><span class=\"line\">(</span><br><span class=\"line\">    [key] &#x3D;&gt; value</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-语句include和require的区别是什么\"><a href=\"#2-语句include和require的区别是什么\" class=\"headerlink\" title=\"2. 语句include和require的区别是什么?\"></a>2. 语句include和require的区别是什么?</h3><p>在失败的时候：<br>include 产生一个 warning ，而 require 直接产生错误中断；</p>\n<p>require 在运行前载入；</p>\n<p>include 在运行时载入；</p>\n<p>require_once 和 include_once 可以避免重复包含同一文件。</p>\n<h3 id=\"3-php中传值与传引用有啥区别\"><a href=\"#3-php中传值与传引用有啥区别\" class=\"headerlink\" title=\"3. php中传值与传引用有啥区别?\"></a>3. php中传值与传引用有啥区别?</h3><p>&amp;表示传引用；</p>\n<p>函数中参数传引用会将参数进行改变；</p>\n<p>一般在输出参数有多个的时候可以考虑使用引用。</p>\n<h3 id=\"4-下面哪项没有将john添加到users数组中？\"><a href=\"#4-下面哪项没有将john添加到users数组中？\" class=\"headerlink\" title=\"4. 下面哪项没有将john添加到users数组中？\"></a>4. 下面哪项没有将john添加到users数组中？</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(a) $users[] &#x3D; &#39;john&#39;;</span><br><span class=\"line\">(b) array_add($users,&#39;john&#39;);</span><br><span class=\"line\">(c) array_push($users,&#39;john&#39;);</span><br><span class=\"line\">(d) $users ||&#x3D; &#39;john&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>答案为bd，php 里面无 <code>array_add</code> 函数，d项为语法错误的表达。</p>\n<h3 id=\"5-HTTP协议中几个状态码的含义。\"><a href=\"#5-HTTP协议中几个状态码的含义。\" class=\"headerlink\" title=\"5. HTTP协议中几个状态码的含义。\"></a>5. HTTP协议中几个状态码的含义。</h3><ul>\n<li>200 : 请求成功，请求的数据随之返回 OK。</li>\n<li>301 : 永久性重定向 Moved permanently。</li>\n<li>302 : 暂时行重定向 Moved Temporarily</li>\n<li>401 : 当前请求需要用户验证 Unauthorized。</li>\n<li>403 : 服务器拒绝执行请求，即没有权限 Forbidden。</li>\n<li>404 : 请求失败，请求的数据在服务器上未发现 Not found。</li>\n<li>500 : 服务器错误。一般服务器端程序执行错误 Internal server error。</li>\n<li>503 : 服务器临时维护或过载。这个状态时临时性的 Service unavailable。</li>\n<li>504：超时，Gateway timeout</li>\n</ul>\n<h3 id=\"6-写出一些php魔术方法。\"><a href=\"#6-写出一些php魔术方法。\" class=\"headerlink\" title=\"6. 写出一些php魔术方法。\"></a>6. 写出一些php魔术方法。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__construct() 实例化类时自动调用。</span><br><span class=\"line\">__destruct() 类对象使用结束时自动调用。</span><br><span class=\"line\">__set() 在给未定义的属性赋值的时候调用。</span><br><span class=\"line\">__get() 调用未定义的属性时候调用。</span><br><span class=\"line\">__isset() 使用isset()或empty()函数时候会调用。</span><br><span class=\"line\">__unset() 使用unset()时候会调用。</span><br><span class=\"line\">__sleep() 使用serialize序列化时候调用。</span><br><span class=\"line\">__wakeup() 使用unserialize反序列化的时候调用。</span><br><span class=\"line\">__call() 调用一个不存在的方法的时候调用。</span><br><span class=\"line\">__callStatic()调用一个不存在的静态方法是调用。</span><br><span class=\"line\">__toString() 把对象转换成字符串的时候会调用。比如 echo。</span><br><span class=\"line\">__invoke() 当尝试把对象当方法调用时调用。</span><br><span class=\"line\">__set_state() 当使用var_export()函数时候调用。接受一个数组参数。</span><br><span class=\"line\">__clone() 当使用clone复制一个对象时候调用。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-MySQL存储引擎-MyISAM-和-InnoDB-的区别。\"><a href=\"#7-MySQL存储引擎-MyISAM-和-InnoDB-的区别。\" class=\"headerlink\" title=\"7. MySQL存储引擎 MyISAM 和 InnoDB 的区别。\"></a>7. MySQL存储引擎 MyISAM 和 InnoDB 的区别。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a. MyISAM类型不支持事务处理等高级处理，而InnoDB类型支持.</span><br><span class=\"line\">b. MyISAM类型的表强调的是性能，其执行速度比InnoDB类型更快.</span><br><span class=\"line\">c. InnoDB不支持FULLTEXT类型的索引.</span><br><span class=\"line\">d. InnoDB中不保存表的具体行数，也就是说，执行select count(*) from table时，InnoDB要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可.</span><br><span class=\"line\">e. 对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。</span><br><span class=\"line\">f. DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除。</span><br><span class=\"line\">g. LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性(例如外键)的表不适用.</span><br><span class=\"line\">h. MyISAM支持表锁，InnoDB支持行锁。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-说出一些MySQL优化方法？\"><a href=\"#8-说出一些MySQL优化方法？\" class=\"headerlink\" title=\"8. 说出一些MySQL优化方法？\"></a>8. 说出一些MySQL优化方法？</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a. 设计良好的数据库结构，允许部分数据冗余，尽量避免join查询，提高效率。</span><br><span class=\"line\">b. 选择合适的表字段数据类型和存储引擎，适当的添加索引。</span><br><span class=\"line\">c. mysql库主从读写分离。</span><br><span class=\"line\">d. 找规律分表，减少单表中的数据量提高查询速度。</span><br><span class=\"line\">e. 添加缓存机制，比如memcached，apc等。</span><br><span class=\"line\">f. 不经常改动的页面，生成静态页面。</span><br><span class=\"line\">g. 书写高效率的SQL。比如 SELECT * FROM TABEL 改为 SELECT field_1, field_2, field_3 FROM TABLE.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-下面-a的结果是：\"><a href=\"#9-下面-a的结果是：\" class=\"headerlink\" title=\"9. 下面$a的结果是：\"></a>9. 下面$a的结果是：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$a &#x3D; in_array(&#39;01&#39;, array(&#39;1&#39;)) &#x3D;&#x3D; var_dump(&#39;01&#39; &#x3D;&#x3D; 1);</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">A true</span><br><span class=\"line\">B false</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump(&#39;01&#39; &#x3D;&#x3D; 1) &#x2F;&#x2F; return NULL</span><br><span class=\"line\">in_array(&#39;01&#39;, array(&#39;1&#39;)) &#x2F;&#x2F; return true</span><br><span class=\"line\"></span><br><span class=\"line\">$a &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>\n\n<p>答案为B</p>\n<h3 id=\"10-说下php中empty-和isset-的区别。\"><a href=\"#10-说下php中empty-和isset-的区别。\" class=\"headerlink\" title=\"10. 说下php中empty()和isset()的区别。\"></a>10. 说下php中empty()和isset()的区别。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">isset 用于检测变量是否被设置，使用 isset() 测试一个被设置成 NULL 的变量，将返回 FALSE 。</span><br><span class=\"line\">empty 如果 var 是非空或非零的值，则 empty() 返回 FALSE。换句话说，&quot;&quot;、0、&quot;0&quot;、NULL、FALSE、array()、var $var; 以及没有任何属性的对象（只有这8个，记住了）都将被认为是空的，如果 var 为空，则返回 TRUE 。</span><br><span class=\"line\"></span><br><span class=\"line\">如果变量为 0 ，则empty()会返回TRUE，isset()会返回TRUE；</span><br><span class=\"line\">如果变量为空字符串，则empty()会返回TRUE，isset()会返回TRUE；</span><br><span class=\"line\">如果变量未定义，则empty()会返回TRUE，isset()会返回FLASE。</span><br><span class=\"line\"></span><br><span class=\"line\">注意：isset() 只能用于变量，因为传递任何其它参数都将造成解析错误。若想检测常量是否已设置，可使用 defined() 函数。</span><br><span class=\"line\">当要 判断一个变量是否已经声明的时候 可以使用 isset 函数；</span><br><span class=\"line\">当要 判断一个变量是否已经赋予数据且不为空 可以用 empty函数；</span><br><span class=\"line\">当要 判断 一个变量 存在且不为空 先 isset 函数 再用 empty 函数；</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"题2：nginx使用哪种网络协议\"><a href=\"#题2：nginx使用哪种网络协议\" class=\"headerlink\" title=\"题2：nginx使用哪种网络协议?\"></a>题2：nginx使用哪种网络协议?</h3><p>答案：nginx是应用层 我觉得从下往上的话 传输层用的是tcp/ip 应用层用的是http fastcgi负责调度进程。</p>\n<h3 id=\"cookie-和session-的区别：\"><a href=\"#cookie-和session-的区别：\" class=\"headerlink\" title=\"cookie 和session 的区别：\"></a>cookie 和session 的区别：</h3><ol>\n<li><p>cookie数据存放在客户的浏览器上，session数据放在服务器上。</p>\n</li>\n<li><p>cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗<br>考虑到安全应当使用session。</p>\n</li>\n<li><p>session 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能<br>考虑到减轻服务器性能方面，应当使用COOKIE。</p>\n</li>\n<li><p>单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。</p>\n</li>\n<li><p>所以个人建议：<br>将登陆信息等重要信息存放为SESSION，其他信息如果需要保留，可以放在COOKIE中</p>\n<h3 id=\"题9：数据库中的事务是什么\"><a href=\"#题9：数据库中的事务是什么\" class=\"headerlink\" title=\"题9：数据库中的事务是什么?\"></a>题9：数据库中的事务是什么?</h3></li>\n</ol>\n<p>答案：事务（transaction）是作为一个单元的一组有序的数据库操作。如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。如果所有操作完成，事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。</p>\n<h3 id=\"题11：简述下面程序的输出结果-简要说明为什么-如何解决这类问题\"><a href=\"#题11：简述下面程序的输出结果-简要说明为什么-如何解决这类问题\" class=\"headerlink\" title=\"题11：简述下面程序的输出结果, 简要说明为什么, 如何解决这类问题?\"></a>题11：简述下面程序的输出结果, 简要说明为什么, 如何解决这类问题?</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">$tmp = <span class=\"number\">0</span> == <span class=\"string\">&quot;a&quot;</span>? <span class=\"number\">1</span>: <span class=\"number\">2</span>; </span><br><span class=\"line\"><span class=\"keyword\">echo</span> $tmp; </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<p>答案： 1</p>\n<p>int和string类型强制转换造成的，0 ＝＝ 0 肯定是true啊 </p>\n<p>PHP是弱类型</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$tmp &#x3D; 0 &#x3D;&#x3D;&#x3D; &quot;a&quot;? 1: 2; </span><br><span class=\"line\">echo $tmp; </span><br></pre></td></tr></table></figure>\n<p>这样就是2 </p>\n<h3 id=\"题12：什么是MVC？\"><a href=\"#题12：什么是MVC？\" class=\"headerlink\" title=\"题12：什么是MVC？\"></a>题12：什么是MVC？</h3><p>答案：MVC由Model（模型）, View（视图）和Controller（控制器）组成，PHP MVC可以更高效地管理好3个不同层的PHP代码。</p>\n<ul>\n<li>Model：数据信息存取层。</li>\n<li>View：view层负责将应用的数据以特定的方式展现在界面上。</li>\n<li>Controller：通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>题21：简述两种屏蔽php程序的notice警告的方法 </p>\n<p>答案：</p>\n<ol>\n<li>在程序中添加：error_reporting (E_ALL &amp; ~E_NOTICE); </li>\n<li>修改php.ini中的：error_reporting = E_ALL 改为：error_reporting = E_ALL &amp; ~E_NOTICE </li>\n<li>error_reporting(0);或者修改php.inidisplay_errors=Off </li>\n</ol>\n<h3 id=\"题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\"><a href=\"#题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\" class=\"headerlink\" title=\"题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\"></a>题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组</h3><p>答案：</p>\n<p>冒泡排序（数组排序）：原理：两两相邻的数进行比较，如果反序就交换，否则不交换</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubble_sort</span>(<span class=\"params\">$array</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    $count = count($array);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($count &lt;= <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>($i=<span class=\"number\">0</span>; $i&lt;$count; $i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>($j=$count<span class=\"number\">-1</span>; $j&gt;$i; $j--)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($array[$j] &lt; $array[$j<span class=\"number\">-1</span>])&#123;</span><br><span class=\"line\">                $tmp = $array[$j];</span><br><span class=\"line\">                $array[$j] = $array[$j<span class=\"number\">-1</span>];</span><br><span class=\"line\">                $array[$j<span class=\"number\">-1</span>] = $tmp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $array;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>快速排序（数组排序）：</p>\n<p>原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，<br>如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作</p>\n<p>不难发现，这里符合递归的原理，所以我们可以用递归来实现。</p>\n<p>使用递归，则需要找到递归点和递归出口：</p>\n<ul>\n<li>递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1</li>\n<li>递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">quicksort</span>(<span class=\"params\">$array</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count($array) &lt;= <span class=\"number\">1</span>) <span class=\"keyword\">return</span> $array;</span><br><span class=\"line\">    $key = $array[<span class=\"number\">0</span>];</span><br><span class=\"line\">    $left_arr = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    $right_arr = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ($i=<span class=\"number\">1</span>; $i&lt;count($array); $i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($array[$i] &lt;= $key)</span><br><span class=\"line\">            $left_arr[] = $array[$i];</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            $right_arr[] = $array[$i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $left_arr = quicksort($left_arr);</span><br><span class=\"line\">    $right_arr = quicksort($right_arr);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array_merge($left_arr, <span class=\"keyword\">array</span>($key), $right_arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h3 id=\"1-echo-print-print-r-的区别？\"><a href=\"#1-echo-print-print-r-的区别？\" class=\"headerlink\" title=\"1. echo(),print(),print_r()的区别？\"></a>1. echo(),print(),print_r()的区别？</h3><ul>\n<li>echo 和 print 不是一个函数，是一个语言结构；</li>\n<li><code>print(string $arg)</code> 只有一个参数；</li>\n<li><code>echo arg1,arg2</code> 可以输出多个参数，返回 <code>void</code> ；</li>\n<li><code>echo</code> 和 <code>print</code> 只能打印出string，不能打印出结构；</li>\n<li><code>print_r</code> 能打印出结构。比如:</li>\n</ul>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$arr &#x3D; array(&quot;key&quot;&#x3D;&gt;&quot;value&quot;);</span><br><span class=\"line\">print_r($arr);</span><br><span class=\"line\"></span><br><span class=\"line\">Array</span><br><span class=\"line\">(</span><br><span class=\"line\">    [key] &#x3D;&gt; value</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-语句include和require的区别是什么\"><a href=\"#2-语句include和require的区别是什么\" class=\"headerlink\" title=\"2. 语句include和require的区别是什么?\"></a>2. 语句include和require的区别是什么?</h3><p>在失败的时候：<br>include 产生一个 warning ，而 require 直接产生错误中断；</p>\n<p>require 在运行前载入；</p>\n<p>include 在运行时载入；</p>\n<p>require_once 和 include_once 可以避免重复包含同一文件。</p>\n<h3 id=\"3-php中传值与传引用有啥区别\"><a href=\"#3-php中传值与传引用有啥区别\" class=\"headerlink\" title=\"3. php中传值与传引用有啥区别?\"></a>3. php中传值与传引用有啥区别?</h3><p>&amp;表示传引用；</p>\n<p>函数中参数传引用会将参数进行改变；</p>\n<p>一般在输出参数有多个的时候可以考虑使用引用。</p>\n<h3 id=\"4-下面哪项没有将john添加到users数组中？\"><a href=\"#4-下面哪项没有将john添加到users数组中？\" class=\"headerlink\" title=\"4. 下面哪项没有将john添加到users数组中？\"></a>4. 下面哪项没有将john添加到users数组中？</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(a) $users[] &#x3D; &#39;john&#39;;</span><br><span class=\"line\">(b) array_add($users,&#39;john&#39;);</span><br><span class=\"line\">(c) array_push($users,&#39;john&#39;);</span><br><span class=\"line\">(d) $users ||&#x3D; &#39;john&#39;;</span><br></pre></td></tr></table></figure>\n\n<p>答案为bd，php 里面无 <code>array_add</code> 函数，d项为语法错误的表达。</p>\n<h3 id=\"5-HTTP协议中几个状态码的含义。\"><a href=\"#5-HTTP协议中几个状态码的含义。\" class=\"headerlink\" title=\"5. HTTP协议中几个状态码的含义。\"></a>5. HTTP协议中几个状态码的含义。</h3><ul>\n<li>200 : 请求成功，请求的数据随之返回 OK。</li>\n<li>301 : 永久性重定向 Moved permanently。</li>\n<li>302 : 暂时行重定向 Moved Temporarily</li>\n<li>401 : 当前请求需要用户验证 Unauthorized。</li>\n<li>403 : 服务器拒绝执行请求，即没有权限 Forbidden。</li>\n<li>404 : 请求失败，请求的数据在服务器上未发现 Not found。</li>\n<li>500 : 服务器错误。一般服务器端程序执行错误 Internal server error。</li>\n<li>503 : 服务器临时维护或过载。这个状态时临时性的 Service unavailable。</li>\n<li>504：超时，Gateway timeout</li>\n</ul>\n<h3 id=\"6-写出一些php魔术方法。\"><a href=\"#6-写出一些php魔术方法。\" class=\"headerlink\" title=\"6. 写出一些php魔术方法。\"></a>6. 写出一些php魔术方法。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__construct() 实例化类时自动调用。</span><br><span class=\"line\">__destruct() 类对象使用结束时自动调用。</span><br><span class=\"line\">__set() 在给未定义的属性赋值的时候调用。</span><br><span class=\"line\">__get() 调用未定义的属性时候调用。</span><br><span class=\"line\">__isset() 使用isset()或empty()函数时候会调用。</span><br><span class=\"line\">__unset() 使用unset()时候会调用。</span><br><span class=\"line\">__sleep() 使用serialize序列化时候调用。</span><br><span class=\"line\">__wakeup() 使用unserialize反序列化的时候调用。</span><br><span class=\"line\">__call() 调用一个不存在的方法的时候调用。</span><br><span class=\"line\">__callStatic()调用一个不存在的静态方法是调用。</span><br><span class=\"line\">__toString() 把对象转换成字符串的时候会调用。比如 echo。</span><br><span class=\"line\">__invoke() 当尝试把对象当方法调用时调用。</span><br><span class=\"line\">__set_state() 当使用var_export()函数时候调用。接受一个数组参数。</span><br><span class=\"line\">__clone() 当使用clone复制一个对象时候调用。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-MySQL存储引擎-MyISAM-和-InnoDB-的区别。\"><a href=\"#7-MySQL存储引擎-MyISAM-和-InnoDB-的区别。\" class=\"headerlink\" title=\"7. MySQL存储引擎 MyISAM 和 InnoDB 的区别。\"></a>7. MySQL存储引擎 MyISAM 和 InnoDB 的区别。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a. MyISAM类型不支持事务处理等高级处理，而InnoDB类型支持.</span><br><span class=\"line\">b. MyISAM类型的表强调的是性能，其执行速度比InnoDB类型更快.</span><br><span class=\"line\">c. InnoDB不支持FULLTEXT类型的索引.</span><br><span class=\"line\">d. InnoDB中不保存表的具体行数，也就是说，执行select count(*) from table时，InnoDB要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可.</span><br><span class=\"line\">e. 对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。</span><br><span class=\"line\">f. DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除。</span><br><span class=\"line\">g. LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性(例如外键)的表不适用.</span><br><span class=\"line\">h. MyISAM支持表锁，InnoDB支持行锁。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-说出一些MySQL优化方法？\"><a href=\"#8-说出一些MySQL优化方法？\" class=\"headerlink\" title=\"8. 说出一些MySQL优化方法？\"></a>8. 说出一些MySQL优化方法？</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a. 设计良好的数据库结构，允许部分数据冗余，尽量避免join查询，提高效率。</span><br><span class=\"line\">b. 选择合适的表字段数据类型和存储引擎，适当的添加索引。</span><br><span class=\"line\">c. mysql库主从读写分离。</span><br><span class=\"line\">d. 找规律分表，减少单表中的数据量提高查询速度。</span><br><span class=\"line\">e. 添加缓存机制，比如memcached，apc等。</span><br><span class=\"line\">f. 不经常改动的页面，生成静态页面。</span><br><span class=\"line\">g. 书写高效率的SQL。比如 SELECT * FROM TABEL 改为 SELECT field_1, field_2, field_3 FROM TABLE.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-下面-a的结果是：\"><a href=\"#9-下面-a的结果是：\" class=\"headerlink\" title=\"9. 下面$a的结果是：\"></a>9. 下面$a的结果是：</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$a &#x3D; in_array(&#39;01&#39;, array(&#39;1&#39;)) &#x3D;&#x3D; var_dump(&#39;01&#39; &#x3D;&#x3D; 1);</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">A true</span><br><span class=\"line\">B false</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump(&#39;01&#39; &#x3D;&#x3D; 1) &#x2F;&#x2F; return NULL</span><br><span class=\"line\">in_array(&#39;01&#39;, array(&#39;1&#39;)) &#x2F;&#x2F; return true</span><br><span class=\"line\"></span><br><span class=\"line\">$a &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>\n\n<p>答案为B</p>\n<h3 id=\"10-说下php中empty-和isset-的区别。\"><a href=\"#10-说下php中empty-和isset-的区别。\" class=\"headerlink\" title=\"10. 说下php中empty()和isset()的区别。\"></a>10. 说下php中empty()和isset()的区别。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">isset 用于检测变量是否被设置，使用 isset() 测试一个被设置成 NULL 的变量，将返回 FALSE 。</span><br><span class=\"line\">empty 如果 var 是非空或非零的值，则 empty() 返回 FALSE。换句话说，&quot;&quot;、0、&quot;0&quot;、NULL、FALSE、array()、var $var; 以及没有任何属性的对象（只有这8个，记住了）都将被认为是空的，如果 var 为空，则返回 TRUE 。</span><br><span class=\"line\"></span><br><span class=\"line\">如果变量为 0 ，则empty()会返回TRUE，isset()会返回TRUE；</span><br><span class=\"line\">如果变量为空字符串，则empty()会返回TRUE，isset()会返回TRUE；</span><br><span class=\"line\">如果变量未定义，则empty()会返回TRUE，isset()会返回FLASE。</span><br><span class=\"line\"></span><br><span class=\"line\">注意：isset() 只能用于变量，因为传递任何其它参数都将造成解析错误。若想检测常量是否已设置，可使用 defined() 函数。</span><br><span class=\"line\">当要 判断一个变量是否已经声明的时候 可以使用 isset 函数；</span><br><span class=\"line\">当要 判断一个变量是否已经赋予数据且不为空 可以用 empty函数；</span><br><span class=\"line\">当要 判断 一个变量 存在且不为空 先 isset 函数 再用 empty 函数；</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"题2：nginx使用哪种网络协议\"><a href=\"#题2：nginx使用哪种网络协议\" class=\"headerlink\" title=\"题2：nginx使用哪种网络协议?\"></a>题2：nginx使用哪种网络协议?</h3><p>答案：nginx是应用层 我觉得从下往上的话 传输层用的是tcp/ip 应用层用的是http fastcgi负责调度进程。</p>\n<h3 id=\"cookie-和session-的区别：\"><a href=\"#cookie-和session-的区别：\" class=\"headerlink\" title=\"cookie 和session 的区别：\"></a>cookie 和session 的区别：</h3><ol>\n<li><p>cookie数据存放在客户的浏览器上，session数据放在服务器上。</p>\n</li>\n<li><p>cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗<br>考虑到安全应当使用session。</p>\n</li>\n<li><p>session 会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能<br>考虑到减轻服务器性能方面，应当使用COOKIE。</p>\n</li>\n<li><p>单个cookie保存的数据不能超过4K，很多浏览器都限制一个站点最多保存20个cookie。</p>\n</li>\n<li><p>所以个人建议：<br>将登陆信息等重要信息存放为SESSION，其他信息如果需要保留，可以放在COOKIE中</p>\n<h3 id=\"题9：数据库中的事务是什么\"><a href=\"#题9：数据库中的事务是什么\" class=\"headerlink\" title=\"题9：数据库中的事务是什么?\"></a>题9：数据库中的事务是什么?</h3></li>\n</ol>\n<p>答案：事务（transaction）是作为一个单元的一组有序的数据库操作。如果组中的所有操作都成功，则认为事务成功，即使只有一个操作失败，事务也不成功。如果所有操作完成，事务则提交，其修改将作用于所有其他数据库进程。如果一个操作失败，则事务将回滚，该事务所有操作的影响都将取消。</p>\n<h3 id=\"题11：简述下面程序的输出结果-简要说明为什么-如何解决这类问题\"><a href=\"#题11：简述下面程序的输出结果-简要说明为什么-如何解决这类问题\" class=\"headerlink\" title=\"题11：简述下面程序的输出结果, 简要说明为什么, 如何解决这类问题?\"></a>题11：简述下面程序的输出结果, 简要说明为什么, 如何解决这类问题?</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\">$tmp = <span class=\"number\">0</span> == <span class=\"string\">&quot;a&quot;</span>? <span class=\"number\">1</span>: <span class=\"number\">2</span>; </span><br><span class=\"line\"><span class=\"keyword\">echo</span> $tmp; </span><br><span class=\"line\"><span class=\"meta\">?&gt;</span> </span><br></pre></td></tr></table></figure>\n<p>答案： 1</p>\n<p>int和string类型强制转换造成的，0 ＝＝ 0 肯定是true啊 </p>\n<p>PHP是弱类型</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$tmp &#x3D; 0 &#x3D;&#x3D;&#x3D; &quot;a&quot;? 1: 2; </span><br><span class=\"line\">echo $tmp; </span><br></pre></td></tr></table></figure>\n<p>这样就是2 </p>\n<h3 id=\"题12：什么是MVC？\"><a href=\"#题12：什么是MVC？\" class=\"headerlink\" title=\"题12：什么是MVC？\"></a>题12：什么是MVC？</h3><p>答案：MVC由Model（模型）, View（视图）和Controller（控制器）组成，PHP MVC可以更高效地管理好3个不同层的PHP代码。</p>\n<ul>\n<li>Model：数据信息存取层。</li>\n<li>View：view层负责将应用的数据以特定的方式展现在界面上。</li>\n<li>Controller：通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</li>\n</ul>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>题21：简述两种屏蔽php程序的notice警告的方法 </p>\n<p>答案：</p>\n<ol>\n<li>在程序中添加：error_reporting (E_ALL &amp; ~E_NOTICE); </li>\n<li>修改php.ini中的：error_reporting = E_ALL 改为：error_reporting = E_ALL &amp; ~E_NOTICE </li>\n<li>error_reporting(0);或者修改php.inidisplay_errors=Off </li>\n</ol>\n<h3 id=\"题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\"><a href=\"#题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\" class=\"headerlink\" title=\"题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组\"></a>题28：写一个排序算法，可以是冒泡排序或者是快速排序，假设待排序对象是一个维数组</h3><p>答案：</p>\n<p>冒泡排序（数组排序）：原理：两两相邻的数进行比较，如果反序就交换，否则不交换</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">bubble_sort</span>(<span class=\"params\">$array</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    $count = count($array);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ($count &lt;= <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>($i=<span class=\"number\">0</span>; $i&lt;$count; $i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>($j=$count<span class=\"number\">-1</span>; $j&gt;$i; $j--)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> ($array[$j] &lt; $array[$j<span class=\"number\">-1</span>])&#123;</span><br><span class=\"line\">                $tmp = $array[$j];</span><br><span class=\"line\">                $array[$j] = $array[$j<span class=\"number\">-1</span>];</span><br><span class=\"line\">                $array[$j<span class=\"number\">-1</span>] = $tmp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $array;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>快速排序（数组排序）：</p>\n<p>原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，<br>如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作</p>\n<p>不难发现，这里符合递归的原理，所以我们可以用递归来实现。</p>\n<p>使用递归，则需要找到递归点和递归出口：</p>\n<ul>\n<li>递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1</li>\n<li>递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">quicksort</span>(<span class=\"params\">$array</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count($array) &lt;= <span class=\"number\">1</span>) <span class=\"keyword\">return</span> $array;</span><br><span class=\"line\">    $key = $array[<span class=\"number\">0</span>];</span><br><span class=\"line\">    $left_arr = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    $right_arr = <span class=\"keyword\">array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ($i=<span class=\"number\">1</span>; $i&lt;count($array); $i++)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ($array[$i] &lt;= $key)</span><br><span class=\"line\">            $left_arr[] = $array[$i];</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            $right_arr[] = $array[$i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $left_arr = quicksort($left_arr);</span><br><span class=\"line\">    $right_arr = quicksort($right_arr);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> array_merge($left_arr, <span class=\"keyword\">array</span>($key), $right_arr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"Shadowsocks 配置用法教程","date":"2017-12-08T03:38:50.000Z","_content":"\n下载所需平台（Android, iOS, Mac, Windows）的应用\n\n打包下载地址1： http://zouzhipeng.com/ss/ssVPN.7z\n\n打包下载地址2： 链接:https://pan.baidu.com/s/1geWkOWb  密码:qhmz\n\n单个下载：\n1. win7: http://zouzhipeng.com/ss/win7.zip\n2. win8: http://zouzhipeng.com/ss/win8.zip\n3. win10: http://zouzhipeng.com/ss/win10.zip\n4. Mac: http://zouzhipeng.com/ss/mac.zip\n5. Android: http://zouzhipeng.com/ss/shadowsocks-nightly-4.2.5.apk\n6. iOS: AppStore\n7. android 用户推荐使用[这个](http://zouzhipeng.com/ss/APKPure_v2.3.1_apkpure.com.apk)下载应用，无论是国内应用还是国外应用\n\n<!-- more -->\n\n## 1. android\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/12164971.jpg)\n\n## 2. iOS\n\n2017-12-16 补充： srrconnectpro 的扫码功能不太好用，推荐使用下面两个。配置方法相同。 直接扫码更方便快捷，密码太容易输错了。。。\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-16/5580234.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/74659104.jpg)\n\n## 3. Mac\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/46512741.jpg)\n\n## 4. Windows\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/11108434.jpg)\n\n","source":"_posts/Shadowsocks-配置用法教程.md","raw":"---\ntitle: Shadowsocks 配置用法教程\ndate: 2017-12-08 11:38:50\ntags: shadowsocks\ncategories: trivia\n---\n\n下载所需平台（Android, iOS, Mac, Windows）的应用\n\n打包下载地址1： http://zouzhipeng.com/ss/ssVPN.7z\n\n打包下载地址2： 链接:https://pan.baidu.com/s/1geWkOWb  密码:qhmz\n\n单个下载：\n1. win7: http://zouzhipeng.com/ss/win7.zip\n2. win8: http://zouzhipeng.com/ss/win8.zip\n3. win10: http://zouzhipeng.com/ss/win10.zip\n4. Mac: http://zouzhipeng.com/ss/mac.zip\n5. Android: http://zouzhipeng.com/ss/shadowsocks-nightly-4.2.5.apk\n6. iOS: AppStore\n7. android 用户推荐使用[这个](http://zouzhipeng.com/ss/APKPure_v2.3.1_apkpure.com.apk)下载应用，无论是国内应用还是国外应用\n\n<!-- more -->\n\n## 1. android\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/12164971.jpg)\n\n## 2. iOS\n\n2017-12-16 补充： srrconnectpro 的扫码功能不太好用，推荐使用下面两个。配置方法相同。 直接扫码更方便快捷，密码太容易输错了。。。\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-16/5580234.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/74659104.jpg)\n\n## 3. Mac\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/46512741.jpg)\n\n## 4. Windows\n\n![](http://omp48p40q.bkt.clouddn.com/17-12-8/11108434.jpg)\n\n","slug":"Shadowsocks-配置用法教程","published":1,"updated":"2020-09-11T01:04:35.039Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8o001i6wo12ryydn3f","content":"<p>下载所需平台（Android, iOS, Mac, Windows）的应用</p>\n<p>打包下载地址1： <a href=\"http://zouzhipeng.com/ss/ssVPN.7z\">http://zouzhipeng.com/ss/ssVPN.7z</a></p>\n<p>打包下载地址2： 链接:<a href=\"https://pan.baidu.com/s/1geWkOWb\">https://pan.baidu.com/s/1geWkOWb</a>  密码:qhmz</p>\n<p>单个下载：</p>\n<ol>\n<li>win7: <a href=\"http://zouzhipeng.com/ss/win7.zip\">http://zouzhipeng.com/ss/win7.zip</a></li>\n<li>win8: <a href=\"http://zouzhipeng.com/ss/win8.zip\">http://zouzhipeng.com/ss/win8.zip</a></li>\n<li>win10: <a href=\"http://zouzhipeng.com/ss/win10.zip\">http://zouzhipeng.com/ss/win10.zip</a></li>\n<li>Mac: <a href=\"http://zouzhipeng.com/ss/mac.zip\">http://zouzhipeng.com/ss/mac.zip</a></li>\n<li>Android: <a href=\"http://zouzhipeng.com/ss/shadowsocks-nightly-4.2.5.apk\">http://zouzhipeng.com/ss/shadowsocks-nightly-4.2.5.apk</a></li>\n<li>iOS: AppStore</li>\n<li>android 用户推荐使用<a href=\"http://zouzhipeng.com/ss/APKPure_v2.3.1_apkpure.com.apk\">这个</a>下载应用，无论是国内应用还是国外应用</li>\n</ol>\n<a id=\"more\"></a>\n\n<h2 id=\"1-android\"><a href=\"#1-android\" class=\"headerlink\" title=\"1. android\"></a>1. android</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/12164971.jpg\"></p>\n<h2 id=\"2-iOS\"><a href=\"#2-iOS\" class=\"headerlink\" title=\"2. iOS\"></a>2. iOS</h2><p>2017-12-16 补充： srrconnectpro 的扫码功能不太好用，推荐使用下面两个。配置方法相同。 直接扫码更方便快捷，密码太容易输错了。。。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-16/5580234.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/74659104.jpg\"></p>\n<h2 id=\"3-Mac\"><a href=\"#3-Mac\" class=\"headerlink\" title=\"3. Mac\"></a>3. Mac</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/46512741.jpg\"></p>\n<h2 id=\"4-Windows\"><a href=\"#4-Windows\" class=\"headerlink\" title=\"4. Windows\"></a>4. Windows</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/11108434.jpg\"></p>\n","site":{"data":{}},"excerpt":"<p>下载所需平台（Android, iOS, Mac, Windows）的应用</p>\n<p>打包下载地址1： <a href=\"http://zouzhipeng.com/ss/ssVPN.7z\">http://zouzhipeng.com/ss/ssVPN.7z</a></p>\n<p>打包下载地址2： 链接:<a href=\"https://pan.baidu.com/s/1geWkOWb\">https://pan.baidu.com/s/1geWkOWb</a>  密码:qhmz</p>\n<p>单个下载：</p>\n<ol>\n<li>win7: <a href=\"http://zouzhipeng.com/ss/win7.zip\">http://zouzhipeng.com/ss/win7.zip</a></li>\n<li>win8: <a href=\"http://zouzhipeng.com/ss/win8.zip\">http://zouzhipeng.com/ss/win8.zip</a></li>\n<li>win10: <a href=\"http://zouzhipeng.com/ss/win10.zip\">http://zouzhipeng.com/ss/win10.zip</a></li>\n<li>Mac: <a href=\"http://zouzhipeng.com/ss/mac.zip\">http://zouzhipeng.com/ss/mac.zip</a></li>\n<li>Android: <a href=\"http://zouzhipeng.com/ss/shadowsocks-nightly-4.2.5.apk\">http://zouzhipeng.com/ss/shadowsocks-nightly-4.2.5.apk</a></li>\n<li>iOS: AppStore</li>\n<li>android 用户推荐使用<a href=\"http://zouzhipeng.com/ss/APKPure_v2.3.1_apkpure.com.apk\">这个</a>下载应用，无论是国内应用还是国外应用</li>\n</ol>","more":"<h2 id=\"1-android\"><a href=\"#1-android\" class=\"headerlink\" title=\"1. android\"></a>1. android</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/12164971.jpg\"></p>\n<h2 id=\"2-iOS\"><a href=\"#2-iOS\" class=\"headerlink\" title=\"2. iOS\"></a>2. iOS</h2><p>2017-12-16 补充： srrconnectpro 的扫码功能不太好用，推荐使用下面两个。配置方法相同。 直接扫码更方便快捷，密码太容易输错了。。。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-16/5580234.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/74659104.jpg\"></p>\n<h2 id=\"3-Mac\"><a href=\"#3-Mac\" class=\"headerlink\" title=\"3. Mac\"></a>3. Mac</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/46512741.jpg\"></p>\n<h2 id=\"4-Windows\"><a href=\"#4-Windows\" class=\"headerlink\" title=\"4. Windows\"></a>4. Windows</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-12-8/11108434.jpg\"></p>"},{"title":"Shell-脚本学习记录（1）","date":"2017-02-21T16:00:00.000Z","description":"这是我在慕课网《Shell典型应用之主控脚本实现》的学习记录，方便自己以后查找。希望对其他读者也能有些帮助。","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-8b4a409ba533a5ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n> 这是我在慕课网[《Shell典型应用之主控脚本实现》](http://www.imooc.com/learn/522)的学习记录，方便自己以后查找。希望对其他读者也能有些帮助。\n\n<!--more-->\n\n# 第一部分 主控文件\n## 1. vim 编辑器的设置\n1. 临时性的设置\n在末行模式进行的设置，当次有效\n2. 永久设置 修改vimrc/.vimrc文件\n    ```\n    # 语法高亮\n    syntax on\n    # 显示行号\n    set number\n    # 自动缩进\n    set autoindent\n    set cindent\n    # 自动加入文件头\n    ```\n    ![](http://upload-images.jianshu.io/upload_images/693141-70a7f46e1f5d6174.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n    \n## 2. shell 高亮显示\n```\necho -e 终端颜色 + 显示内容 + 结束后颜色\necho -e \"\\e[1;30m Hello \\e[1;0m\"\n# echo -e(扩展输出) \"\\e(颜色设置使用\\e)[1(1为设置终端颜色，0为不设置);\n# 30m(颜色) Hello \\e(闭合)[1;0m(结束后的颜色)\"(所有内容包含在双引号中)\necho -e \"\\e[1;30m Hello \" $(tput sgr0)\n# $(tput sgr0)的作用是初始化输出的终端，使其颜色恢复为默认值\n```\n效果图\n\n![](http://upload-images.jianshu.io/upload_images/693141-b86151289bd439b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 3. shell 中的关联数组\n```\n# 声明关联数组\ndeclare -A asso_arr1\n```\n\n## 4. ubuntu的坑\nubuntu的默认shell由bash改为了dash，上述脚本输出时会出现两个错误。1，declare not found; 2，echo 后面的颜色配置内容都给输出。\n\n三种解决方法：\n1. 执行时由```sh build.sh```变成```bash build.sh```\n2. ```ln -s /bin/bash /bin/sh -f```\n3. ```sudo dpkg-reconfigure dash``` 进行配置，道理同（2）\n\n\n主控文件所有内容及注释 monitor_main.sh\n\n```\n#!/bin/bash\nresettem=$(tput sgr0)\n# 定义关联数组存储 键：数字,脚本号码   值：脚本名\nDECLARE -A ssharray\ni=0\nnumbers=\"\"\n\n# 使用for循环遍历所有子功能shell并输出(需要排除本文件) 注意单引号和双引号的使用\nfor script_file in `ls -I \"monitor_main.sh\" ./`\ndo\n    echo -e \"\\e[1;35m\" \"The Script:\" ${i} '==>' ${ressettem} ${script_file}\n    # 关联数组赋值\n    ssharray[$i]=${script_file}\n    # echo ${ssharray[$i]}\n    numbers=\"${numbers} | $i\"\n    i=$((i+1))\ndone\n# echo ${numbers}\n# 写一个无限循环\nwhile true\ndo\n  # 输入提示\n  read -p \"Please input a number [ ${numbers} ]:\"  execshell\n  # echo ${execshell}\n  # 如果输入内容不是数字，中断\n  if [[ ! ${execshell} =~ ^[0-9]+ ]];  then\n     exit 0\n  fi\n\n  # 如果输入正确，执行对应的脚本\n  /bin/bash ./${ssharray[$execshell]}\ndone\n```\n\n\n# 第二部分 系统信息及运行状态获取\n## 1. 系统信息所有内容及注释 system_monitor.sh\n```\n#!/bin/bash\n# 清屏\nclear\n# $# 可提取位置参数个数 注意 [] 与内容之间都要有空格\nif [[ $# -eq  0 ]]\nthen\n# 定义变量\nreset_terminal=$(tput sgr0)\n# check OS type\nos=$(uname -o)\necho -e '\\e[1;32m' \"Operating System Type: \" $reset_terminal $os\n# check OS release version and name\nos_name=$(cat /etc/issue)\n# os_name=$(cat /etc/issue|grep -e \"Server\")\necho -e '\\e[1;32m' \"release version and name: \" $reset_terminal $os_name\n# check architecture\narchitecture=$(uname -m)\necho -e '\\e[1;32m' \"architecture Type: \" $reset_terminal $architecture\n# check kernel release\nkernel=$(uname -r);\necho -e '\\e[1;32m' \"kernel Type: \" $reset_terminal $kernel\n# check hostname\nhostname=$(uname -n)\necho -e '\\e[1;32m' \"hostname: \" $reset_terminal $hostname\n# hostname=$(hostname)\n# hostname=$(echo $HOSTNAME)\n\n# check internal IP\ninternalIP=$(hostname -I)\necho -e '\\e[1;32m' \"internalIP: \" $reset_terminal $internalIP\n# check external IP\nexternalIP=$(curl -s http://ipecho.net/plain)\necho -e '\\e[1;32m' \"externalIP: \" $reset_terminal $externalIP\n# check DNS\n# -E 支持元字符  加边界匹配，匹配以<nameserver开头，后面跟任意多个空格的内容\n# 使用awk做列筛选，$NF 表示以空格作为分隔符，打印出最后一列\n# 注意单双引号的使用\nDNS=$(cat /etc/resolv.conf |grep -E \"\\<nameserver[ ]+\" | awk '{print $NF}')\necho -e '\\e[1;32m' \"DNS: \" $reset_terminal $DNS\n# check internet connection status\n# ping -c 表示次数\n# 输出到空设备  &>/dev/null\nping -c 2 baidu.com &>/dev/null && echo \"Internet connected\" || echo \"Internet disconnected\"\n# check LoggedIn users\nwho>/tmp/who\necho -e '\\e[1;32m' \"LoggedIn users: \" $reset_terminal && cat /tmp/who\n# 用完及时删除\nrm -rf /tmp/who\nfi\n```\n效果图\n\n![](http://upload-images.jianshu.io/upload_images/693141-30d101e3970871cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n## 2. 系统监控脚本\n1. 操作系统使用内存与应用使用内存的区别\n![](http://upload-images.jianshu.io/upload_images/693141-1fdb300ae6d72455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n```\n系统使用内容 = total - free\n应用使用内容 = total - (free + cached + buffers)\n```\n\n2. 内存中cache和buffer 区别\n\n![](http://upload-images.jianshu.io/upload_images/693141-7fbc5e89dfe596d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\ncache主要用来缓存打开过的文件，buffer用于缓存目录项，inode节点（文件索引头）。\n\n除了使用 free -m 来获取内存外，还可以使用读取文件的方式来获取内容，文件位于 /proc/meminfo\n```\nawk '/MemTotal/{total=$2}/MemFree/{free=$2}END{print (total-free)/1024}' /proc/meminfo\n```\n解释： 使用awk来进行模式匹配，首先 匹配 MemTotal，第二列的值赋值给变量total；匹配MemFree，第二列的值赋值给free。使用END结束匹配，输出计算结果，并以MB单位显示。\n\n```\n############################################################\n# 内存使用\nsystem_memory_usage=$(awk '/MemTotal/{total=$2}/MemFree/{free=$2}END{print (total-free)/1024}' /proc/meminfo)\necho -e '\\e[32m' \"system memory usage:\" $reset_terminal $system_memory_usage\n# 有两个cache，匹配第一个\napp_memory_usage=$(awk '/MemTotal/{total=$2}/MemFree/{free=$2}/^Cached/{cached=$2}/Buffers/{buffers=$2}END{print (total-free-cached-buffers)/1024}' /proc/meminfo)\necho -e '\\e[32m' \"apps memory usage:\" $reset_terminal $app_memory_usage\n```\n\n## 3. CPU 负载\n\n![](http://upload-images.jianshu.io/upload_images/693141-b08caa30fe4cfcd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n可以读取 /proc/meminfo 文件，也可以使用 top 命令。\n```\ntop -n 1 -b | grep \"load average\" | awk '{print $10  $11  $12}'\n```\n解释： -n 表示刷新次数，一次即可。  -b表示更完整地显示信息。 awk 进行列匹配，取出第10，11，12 列的数值。\n\n![](http://upload-images.jianshu.io/upload_images/693141-04d1c54659ab212b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 4. 磁盘容量 使用量\n```\ndf -h | grep -vE 'Filesystem|tmpfs' | awk '{print $1 \" \" $5}'\n```\n解释： v表示反选，E表示元字符，匹配到的内容将别忽略，即取出除匹配到的内容之外的所有内容。\n\n```\n###########################################################\n# CPU\nloadaverage=$(top -n 1 -b | grep \"load average\" | awk '{print $10  $11  $12}')\necho -e '\\e[32m' \"load averages \" $reset_terminal $loadaverage\ndiskaverage=$(df -h | grep -vE 'Filesystem|tmpfs' | awk '{print $1 \" \" $5}')\necho -e '\\e[32m' \"disk averages \" $reset_terminal $diskaverage\n```\n\n\n","source":"_posts/Shell-脚本学习记录（1）.md","raw":"---\ntitle: Shell-脚本学习记录（1）\ndate: 2017-02-22\ntags: shell\ndescription: 这是我在慕课网《Shell典型应用之主控脚本实现》的学习记录，方便自己以后查找。希望对其他读者也能有些帮助。\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-8b4a409ba533a5ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n> 这是我在慕课网[《Shell典型应用之主控脚本实现》](http://www.imooc.com/learn/522)的学习记录，方便自己以后查找。希望对其他读者也能有些帮助。\n\n<!--more-->\n\n# 第一部分 主控文件\n## 1. vim 编辑器的设置\n1. 临时性的设置\n在末行模式进行的设置，当次有效\n2. 永久设置 修改vimrc/.vimrc文件\n    ```\n    # 语法高亮\n    syntax on\n    # 显示行号\n    set number\n    # 自动缩进\n    set autoindent\n    set cindent\n    # 自动加入文件头\n    ```\n    ![](http://upload-images.jianshu.io/upload_images/693141-70a7f46e1f5d6174.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n    \n## 2. shell 高亮显示\n```\necho -e 终端颜色 + 显示内容 + 结束后颜色\necho -e \"\\e[1;30m Hello \\e[1;0m\"\n# echo -e(扩展输出) \"\\e(颜色设置使用\\e)[1(1为设置终端颜色，0为不设置);\n# 30m(颜色) Hello \\e(闭合)[1;0m(结束后的颜色)\"(所有内容包含在双引号中)\necho -e \"\\e[1;30m Hello \" $(tput sgr0)\n# $(tput sgr0)的作用是初始化输出的终端，使其颜色恢复为默认值\n```\n效果图\n\n![](http://upload-images.jianshu.io/upload_images/693141-b86151289bd439b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 3. shell 中的关联数组\n```\n# 声明关联数组\ndeclare -A asso_arr1\n```\n\n## 4. ubuntu的坑\nubuntu的默认shell由bash改为了dash，上述脚本输出时会出现两个错误。1，declare not found; 2，echo 后面的颜色配置内容都给输出。\n\n三种解决方法：\n1. 执行时由```sh build.sh```变成```bash build.sh```\n2. ```ln -s /bin/bash /bin/sh -f```\n3. ```sudo dpkg-reconfigure dash``` 进行配置，道理同（2）\n\n\n主控文件所有内容及注释 monitor_main.sh\n\n```\n#!/bin/bash\nresettem=$(tput sgr0)\n# 定义关联数组存储 键：数字,脚本号码   值：脚本名\nDECLARE -A ssharray\ni=0\nnumbers=\"\"\n\n# 使用for循环遍历所有子功能shell并输出(需要排除本文件) 注意单引号和双引号的使用\nfor script_file in `ls -I \"monitor_main.sh\" ./`\ndo\n    echo -e \"\\e[1;35m\" \"The Script:\" ${i} '==>' ${ressettem} ${script_file}\n    # 关联数组赋值\n    ssharray[$i]=${script_file}\n    # echo ${ssharray[$i]}\n    numbers=\"${numbers} | $i\"\n    i=$((i+1))\ndone\n# echo ${numbers}\n# 写一个无限循环\nwhile true\ndo\n  # 输入提示\n  read -p \"Please input a number [ ${numbers} ]:\"  execshell\n  # echo ${execshell}\n  # 如果输入内容不是数字，中断\n  if [[ ! ${execshell} =~ ^[0-9]+ ]];  then\n     exit 0\n  fi\n\n  # 如果输入正确，执行对应的脚本\n  /bin/bash ./${ssharray[$execshell]}\ndone\n```\n\n\n# 第二部分 系统信息及运行状态获取\n## 1. 系统信息所有内容及注释 system_monitor.sh\n```\n#!/bin/bash\n# 清屏\nclear\n# $# 可提取位置参数个数 注意 [] 与内容之间都要有空格\nif [[ $# -eq  0 ]]\nthen\n# 定义变量\nreset_terminal=$(tput sgr0)\n# check OS type\nos=$(uname -o)\necho -e '\\e[1;32m' \"Operating System Type: \" $reset_terminal $os\n# check OS release version and name\nos_name=$(cat /etc/issue)\n# os_name=$(cat /etc/issue|grep -e \"Server\")\necho -e '\\e[1;32m' \"release version and name: \" $reset_terminal $os_name\n# check architecture\narchitecture=$(uname -m)\necho -e '\\e[1;32m' \"architecture Type: \" $reset_terminal $architecture\n# check kernel release\nkernel=$(uname -r);\necho -e '\\e[1;32m' \"kernel Type: \" $reset_terminal $kernel\n# check hostname\nhostname=$(uname -n)\necho -e '\\e[1;32m' \"hostname: \" $reset_terminal $hostname\n# hostname=$(hostname)\n# hostname=$(echo $HOSTNAME)\n\n# check internal IP\ninternalIP=$(hostname -I)\necho -e '\\e[1;32m' \"internalIP: \" $reset_terminal $internalIP\n# check external IP\nexternalIP=$(curl -s http://ipecho.net/plain)\necho -e '\\e[1;32m' \"externalIP: \" $reset_terminal $externalIP\n# check DNS\n# -E 支持元字符  加边界匹配，匹配以<nameserver开头，后面跟任意多个空格的内容\n# 使用awk做列筛选，$NF 表示以空格作为分隔符，打印出最后一列\n# 注意单双引号的使用\nDNS=$(cat /etc/resolv.conf |grep -E \"\\<nameserver[ ]+\" | awk '{print $NF}')\necho -e '\\e[1;32m' \"DNS: \" $reset_terminal $DNS\n# check internet connection status\n# ping -c 表示次数\n# 输出到空设备  &>/dev/null\nping -c 2 baidu.com &>/dev/null && echo \"Internet connected\" || echo \"Internet disconnected\"\n# check LoggedIn users\nwho>/tmp/who\necho -e '\\e[1;32m' \"LoggedIn users: \" $reset_terminal && cat /tmp/who\n# 用完及时删除\nrm -rf /tmp/who\nfi\n```\n效果图\n\n![](http://upload-images.jianshu.io/upload_images/693141-30d101e3970871cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n## 2. 系统监控脚本\n1. 操作系统使用内存与应用使用内存的区别\n![](http://upload-images.jianshu.io/upload_images/693141-1fdb300ae6d72455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n```\n系统使用内容 = total - free\n应用使用内容 = total - (free + cached + buffers)\n```\n\n2. 内存中cache和buffer 区别\n\n![](http://upload-images.jianshu.io/upload_images/693141-7fbc5e89dfe596d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\ncache主要用来缓存打开过的文件，buffer用于缓存目录项，inode节点（文件索引头）。\n\n除了使用 free -m 来获取内存外，还可以使用读取文件的方式来获取内容，文件位于 /proc/meminfo\n```\nawk '/MemTotal/{total=$2}/MemFree/{free=$2}END{print (total-free)/1024}' /proc/meminfo\n```\n解释： 使用awk来进行模式匹配，首先 匹配 MemTotal，第二列的值赋值给变量total；匹配MemFree，第二列的值赋值给free。使用END结束匹配，输出计算结果，并以MB单位显示。\n\n```\n############################################################\n# 内存使用\nsystem_memory_usage=$(awk '/MemTotal/{total=$2}/MemFree/{free=$2}END{print (total-free)/1024}' /proc/meminfo)\necho -e '\\e[32m' \"system memory usage:\" $reset_terminal $system_memory_usage\n# 有两个cache，匹配第一个\napp_memory_usage=$(awk '/MemTotal/{total=$2}/MemFree/{free=$2}/^Cached/{cached=$2}/Buffers/{buffers=$2}END{print (total-free-cached-buffers)/1024}' /proc/meminfo)\necho -e '\\e[32m' \"apps memory usage:\" $reset_terminal $app_memory_usage\n```\n\n## 3. CPU 负载\n\n![](http://upload-images.jianshu.io/upload_images/693141-b08caa30fe4cfcd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n可以读取 /proc/meminfo 文件，也可以使用 top 命令。\n```\ntop -n 1 -b | grep \"load average\" | awk '{print $10  $11  $12}'\n```\n解释： -n 表示刷新次数，一次即可。  -b表示更完整地显示信息。 awk 进行列匹配，取出第10，11，12 列的数值。\n\n![](http://upload-images.jianshu.io/upload_images/693141-04d1c54659ab212b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n## 4. 磁盘容量 使用量\n```\ndf -h | grep -vE 'Filesystem|tmpfs' | awk '{print $1 \" \" $5}'\n```\n解释： v表示反选，E表示元字符，匹配到的内容将别忽略，即取出除匹配到的内容之外的所有内容。\n\n```\n###########################################################\n# CPU\nloadaverage=$(top -n 1 -b | grep \"load average\" | awk '{print $10  $11  $12}')\necho -e '\\e[32m' \"load averages \" $reset_terminal $loadaverage\ndiskaverage=$(df -h | grep -vE 'Filesystem|tmpfs' | awk '{print $1 \" \" $5}')\necho -e '\\e[32m' \"disk averages \" $reset_terminal $diskaverage\n```\n\n\n","slug":"Shell-脚本学习记录（1）","published":1,"updated":"2020-09-11T01:04:35.040Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8p001l6wo14qq9bl1u","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-8b4a409ba533a5ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>这是我在慕课网<a href=\"http://www.imooc.com/learn/522\">《Shell典型应用之主控脚本实现》</a>的学习记录，方便自己以后查找。希望对其他读者也能有些帮助。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h1 id=\"第一部分-主控文件\"><a href=\"#第一部分-主控文件\" class=\"headerlink\" title=\"第一部分 主控文件\"></a>第一部分 主控文件</h1><h2 id=\"1-vim-编辑器的设置\"><a href=\"#1-vim-编辑器的设置\" class=\"headerlink\" title=\"1. vim 编辑器的设置\"></a>1. vim 编辑器的设置</h2><ol>\n<li>临时性的设置<br>在末行模式进行的设置，当次有效</li>\n<li>永久设置 修改vimrc/.vimrc文件 <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法高亮</span><br><span class=\"line\">syntax on</span><br><span class=\"line\"># 显示行号</span><br><span class=\"line\">set number</span><br><span class=\"line\"># 自动缩进</span><br><span class=\"line\">set autoindent</span><br><span class=\"line\">set cindent</span><br><span class=\"line\"># 自动加入文件头</span><br></pre></td></tr></table></figure>\n <img src=\"http://upload-images.jianshu.io/upload_images/693141-70a7f46e1f5d6174.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></li>\n</ol>\n<h2 id=\"2-shell-高亮显示\"><a href=\"#2-shell-高亮显示\" class=\"headerlink\" title=\"2. shell 高亮显示\"></a>2. shell 高亮显示</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo -e 终端颜色 + 显示内容 + 结束后颜色</span><br><span class=\"line\">echo -e &quot;\\e[1;30m Hello \\e[1;0m&quot;</span><br><span class=\"line\"># echo -e(扩展输出) &quot;\\e(颜色设置使用\\e)[1(1为设置终端颜色，0为不设置);</span><br><span class=\"line\"># 30m(颜色) Hello \\e(闭合)[1;0m(结束后的颜色)&quot;(所有内容包含在双引号中)</span><br><span class=\"line\">echo -e &quot;\\e[1;30m Hello &quot; $(tput sgr0)</span><br><span class=\"line\"># $(tput sgr0)的作用是初始化输出的终端，使其颜色恢复为默认值</span><br></pre></td></tr></table></figure>\n<p>效果图</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b86151289bd439b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"3-shell-中的关联数组\"><a href=\"#3-shell-中的关联数组\" class=\"headerlink\" title=\"3. shell 中的关联数组\"></a>3. shell 中的关联数组</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 声明关联数组</span><br><span class=\"line\">declare -A asso_arr1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-ubuntu的坑\"><a href=\"#4-ubuntu的坑\" class=\"headerlink\" title=\"4. ubuntu的坑\"></a>4. ubuntu的坑</h2><p>ubuntu的默认shell由bash改为了dash，上述脚本输出时会出现两个错误。1，declare not found; 2，echo 后面的颜色配置内容都给输出。</p>\n<p>三种解决方法：</p>\n<ol>\n<li>执行时由<code>sh build.sh</code>变成<code>bash build.sh</code></li>\n<li><code>ln -s /bin/bash /bin/sh -f</code></li>\n<li><code>sudo dpkg-reconfigure dash</code> 进行配置，道理同（2）</li>\n</ol>\n<p>主控文件所有内容及注释 monitor_main.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">resettem&#x3D;$(tput sgr0)</span><br><span class=\"line\"># 定义关联数组存储 键：数字,脚本号码   值：脚本名</span><br><span class=\"line\">DECLARE -A ssharray</span><br><span class=\"line\">i&#x3D;0</span><br><span class=\"line\">numbers&#x3D;&quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用for循环遍历所有子功能shell并输出(需要排除本文件) 注意单引号和双引号的使用</span><br><span class=\"line\">for script_file in &#96;ls -I &quot;monitor_main.sh&quot; .&#x2F;&#96;</span><br><span class=\"line\">do</span><br><span class=\"line\">    echo -e &quot;\\e[1;35m&quot; &quot;The Script:&quot; $&#123;i&#125; &#39;&#x3D;&#x3D;&gt;&#39; $&#123;ressettem&#125; $&#123;script_file&#125;</span><br><span class=\"line\">    # 关联数组赋值</span><br><span class=\"line\">    ssharray[$i]&#x3D;$&#123;script_file&#125;</span><br><span class=\"line\">    # echo $&#123;ssharray[$i]&#125;</span><br><span class=\"line\">    numbers&#x3D;&quot;$&#123;numbers&#125; | $i&quot;</span><br><span class=\"line\">    i&#x3D;$((i+1))</span><br><span class=\"line\">done</span><br><span class=\"line\"># echo $&#123;numbers&#125;</span><br><span class=\"line\"># 写一个无限循环</span><br><span class=\"line\">while true</span><br><span class=\"line\">do</span><br><span class=\"line\">  # 输入提示</span><br><span class=\"line\">  read -p &quot;Please input a number [ $&#123;numbers&#125; ]:&quot;  execshell</span><br><span class=\"line\">  # echo $&#123;execshell&#125;</span><br><span class=\"line\">  # 如果输入内容不是数字，中断</span><br><span class=\"line\">  if [[ ! $&#123;execshell&#125; &#x3D;~ ^[0-9]+ ]];  then</span><br><span class=\"line\">     exit 0</span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">  # 如果输入正确，执行对应的脚本</span><br><span class=\"line\">  &#x2F;bin&#x2F;bash .&#x2F;$&#123;ssharray[$execshell]&#125;</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"第二部分-系统信息及运行状态获取\"><a href=\"#第二部分-系统信息及运行状态获取\" class=\"headerlink\" title=\"第二部分 系统信息及运行状态获取\"></a>第二部分 系统信息及运行状态获取</h1><h2 id=\"1-系统信息所有内容及注释-system-monitor-sh\"><a href=\"#1-系统信息所有内容及注释-system-monitor-sh\" class=\"headerlink\" title=\"1. 系统信息所有内容及注释 system_monitor.sh\"></a>1. 系统信息所有内容及注释 system_monitor.sh</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># 清屏</span><br><span class=\"line\">clear</span><br><span class=\"line\"># $# 可提取位置参数个数 注意 [] 与内容之间都要有空格</span><br><span class=\"line\">if [[ $# -eq  0 ]]</span><br><span class=\"line\">then</span><br><span class=\"line\"># 定义变量</span><br><span class=\"line\">reset_terminal&#x3D;$(tput sgr0)</span><br><span class=\"line\"># check OS type</span><br><span class=\"line\">os&#x3D;$(uname -o)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;Operating System Type: &quot; $reset_terminal $os</span><br><span class=\"line\"># check OS release version and name</span><br><span class=\"line\">os_name&#x3D;$(cat &#x2F;etc&#x2F;issue)</span><br><span class=\"line\"># os_name&#x3D;$(cat &#x2F;etc&#x2F;issue|grep -e &quot;Server&quot;)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;release version and name: &quot; $reset_terminal $os_name</span><br><span class=\"line\"># check architecture</span><br><span class=\"line\">architecture&#x3D;$(uname -m)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;architecture Type: &quot; $reset_terminal $architecture</span><br><span class=\"line\"># check kernel release</span><br><span class=\"line\">kernel&#x3D;$(uname -r);</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;kernel Type: &quot; $reset_terminal $kernel</span><br><span class=\"line\"># check hostname</span><br><span class=\"line\">hostname&#x3D;$(uname -n)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;hostname: &quot; $reset_terminal $hostname</span><br><span class=\"line\"># hostname&#x3D;$(hostname)</span><br><span class=\"line\"># hostname&#x3D;$(echo $HOSTNAME)</span><br><span class=\"line\"></span><br><span class=\"line\"># check internal IP</span><br><span class=\"line\">internalIP&#x3D;$(hostname -I)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;internalIP: &quot; $reset_terminal $internalIP</span><br><span class=\"line\"># check external IP</span><br><span class=\"line\">externalIP&#x3D;$(curl -s http:&#x2F;&#x2F;ipecho.net&#x2F;plain)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;externalIP: &quot; $reset_terminal $externalIP</span><br><span class=\"line\"># check DNS</span><br><span class=\"line\"># -E 支持元字符  加边界匹配，匹配以&lt;nameserver开头，后面跟任意多个空格的内容</span><br><span class=\"line\"># 使用awk做列筛选，$NF 表示以空格作为分隔符，打印出最后一列</span><br><span class=\"line\"># 注意单双引号的使用</span><br><span class=\"line\">DNS&#x3D;$(cat &#x2F;etc&#x2F;resolv.conf |grep -E &quot;\\&lt;nameserver[ ]+&quot; | awk &#39;&#123;print $NF&#125;&#39;)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;DNS: &quot; $reset_terminal $DNS</span><br><span class=\"line\"># check internet connection status</span><br><span class=\"line\"># ping -c 表示次数</span><br><span class=\"line\"># 输出到空设备  &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">ping -c 2 baidu.com &amp;&gt;&#x2F;dev&#x2F;null &amp;&amp; echo &quot;Internet connected&quot; || echo &quot;Internet disconnected&quot;</span><br><span class=\"line\"># check LoggedIn users</span><br><span class=\"line\">who&gt;&#x2F;tmp&#x2F;who</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;LoggedIn users: &quot; $reset_terminal &amp;&amp; cat &#x2F;tmp&#x2F;who</span><br><span class=\"line\"># 用完及时删除</span><br><span class=\"line\">rm -rf &#x2F;tmp&#x2F;who</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>效果图</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-30d101e3970871cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"2-系统监控脚本\"><a href=\"#2-系统监控脚本\" class=\"headerlink\" title=\"2. 系统监控脚本\"></a>2. 系统监控脚本</h2><ol>\n<li>操作系统使用内存与应用使用内存的区别<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-1fdb300ae6d72455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">系统使用内容 &#x3D; total - free</span><br><span class=\"line\">应用使用内容 &#x3D; total - (free + cached + buffers)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>内存中cache和buffer 区别</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-7fbc5e89dfe596d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>cache主要用来缓存打开过的文件，buffer用于缓存目录项，inode节点（文件索引头）。</p>\n<p>除了使用 free -m 来获取内存外，还可以使用读取文件的方式来获取内容，文件位于 /proc/meminfo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &#39;&#x2F;MemTotal&#x2F;&#123;total&#x3D;$2&#125;&#x2F;MemFree&#x2F;&#123;free&#x3D;$2&#125;END&#123;print (total-free)&#x2F;1024&#125;&#39; &#x2F;proc&#x2F;meminfo</span><br></pre></td></tr></table></figure>\n<p>解释： 使用awk来进行模式匹配，首先 匹配 MemTotal，第二列的值赋值给变量total；匹配MemFree，第二列的值赋值给free。使用END结束匹配，输出计算结果，并以MB单位显示。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">############################################################</span><br><span class=\"line\"># 内存使用</span><br><span class=\"line\">system_memory_usage&#x3D;$(awk &#39;&#x2F;MemTotal&#x2F;&#123;total&#x3D;$2&#125;&#x2F;MemFree&#x2F;&#123;free&#x3D;$2&#125;END&#123;print (total-free)&#x2F;1024&#125;&#39; &#x2F;proc&#x2F;meminfo)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;system memory usage:&quot; $reset_terminal $system_memory_usage</span><br><span class=\"line\"># 有两个cache，匹配第一个</span><br><span class=\"line\">app_memory_usage&#x3D;$(awk &#39;&#x2F;MemTotal&#x2F;&#123;total&#x3D;$2&#125;&#x2F;MemFree&#x2F;&#123;free&#x3D;$2&#125;&#x2F;^Cached&#x2F;&#123;cached&#x3D;$2&#125;&#x2F;Buffers&#x2F;&#123;buffers&#x3D;$2&#125;END&#123;print (total-free-cached-buffers)&#x2F;1024&#125;&#39; &#x2F;proc&#x2F;meminfo)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;apps memory usage:&quot; $reset_terminal $app_memory_usage</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-CPU-负载\"><a href=\"#3-CPU-负载\" class=\"headerlink\" title=\"3. CPU 负载\"></a>3. CPU 负载</h2><p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b08caa30fe4cfcd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>可以读取 /proc/meminfo 文件，也可以使用 top 命令。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top -n 1 -b | grep &quot;load average&quot; | awk &#39;&#123;print $10  $11  $12&#125;&#39;</span><br></pre></td></tr></table></figure>\n<p>解释： -n 表示刷新次数，一次即可。  -b表示更完整地显示信息。 awk 进行列匹配，取出第10，11，12 列的数值。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-04d1c54659ab212b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"4-磁盘容量-使用量\"><a href=\"#4-磁盘容量-使用量\" class=\"headerlink\" title=\"4. 磁盘容量 使用量\"></a>4. 磁盘容量 使用量</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h | grep -vE &#39;Filesystem|tmpfs&#39; | awk &#39;&#123;print $1 &quot; &quot; $5&#125;&#39;</span><br></pre></td></tr></table></figure>\n<p>解释： v表示反选，E表示元字符，匹配到的内容将别忽略，即取出除匹配到的内容之外的所有内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">###########################################################</span><br><span class=\"line\"># CPU</span><br><span class=\"line\">loadaverage&#x3D;$(top -n 1 -b | grep &quot;load average&quot; | awk &#39;&#123;print $10  $11  $12&#125;&#39;)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;load averages &quot; $reset_terminal $loadaverage</span><br><span class=\"line\">diskaverage&#x3D;$(df -h | grep -vE &#39;Filesystem|tmpfs&#39; | awk &#39;&#123;print $1 &quot; &quot; $5&#125;&#39;)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;disk averages &quot; $reset_terminal $diskaverage</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-8b4a409ba533a5ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>这是我在慕课网<a href=\"http://www.imooc.com/learn/522\">《Shell典型应用之主控脚本实现》</a>的学习记录，方便自己以后查找。希望对其他读者也能有些帮助。</p>\n</blockquote>","more":"<h1 id=\"第一部分-主控文件\"><a href=\"#第一部分-主控文件\" class=\"headerlink\" title=\"第一部分 主控文件\"></a>第一部分 主控文件</h1><h2 id=\"1-vim-编辑器的设置\"><a href=\"#1-vim-编辑器的设置\" class=\"headerlink\" title=\"1. vim 编辑器的设置\"></a>1. vim 编辑器的设置</h2><ol>\n<li>临时性的设置<br>在末行模式进行的设置，当次有效</li>\n<li>永久设置 修改vimrc/.vimrc文件 <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 语法高亮</span><br><span class=\"line\">syntax on</span><br><span class=\"line\"># 显示行号</span><br><span class=\"line\">set number</span><br><span class=\"line\"># 自动缩进</span><br><span class=\"line\">set autoindent</span><br><span class=\"line\">set cindent</span><br><span class=\"line\"># 自动加入文件头</span><br></pre></td></tr></table></figure>\n <img src=\"http://upload-images.jianshu.io/upload_images/693141-70a7f46e1f5d6174.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></li>\n</ol>\n<h2 id=\"2-shell-高亮显示\"><a href=\"#2-shell-高亮显示\" class=\"headerlink\" title=\"2. shell 高亮显示\"></a>2. shell 高亮显示</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo -e 终端颜色 + 显示内容 + 结束后颜色</span><br><span class=\"line\">echo -e &quot;\\e[1;30m Hello \\e[1;0m&quot;</span><br><span class=\"line\"># echo -e(扩展输出) &quot;\\e(颜色设置使用\\e)[1(1为设置终端颜色，0为不设置);</span><br><span class=\"line\"># 30m(颜色) Hello \\e(闭合)[1;0m(结束后的颜色)&quot;(所有内容包含在双引号中)</span><br><span class=\"line\">echo -e &quot;\\e[1;30m Hello &quot; $(tput sgr0)</span><br><span class=\"line\"># $(tput sgr0)的作用是初始化输出的终端，使其颜色恢复为默认值</span><br></pre></td></tr></table></figure>\n<p>效果图</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b86151289bd439b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"3-shell-中的关联数组\"><a href=\"#3-shell-中的关联数组\" class=\"headerlink\" title=\"3. shell 中的关联数组\"></a>3. shell 中的关联数组</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 声明关联数组</span><br><span class=\"line\">declare -A asso_arr1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-ubuntu的坑\"><a href=\"#4-ubuntu的坑\" class=\"headerlink\" title=\"4. ubuntu的坑\"></a>4. ubuntu的坑</h2><p>ubuntu的默认shell由bash改为了dash，上述脚本输出时会出现两个错误。1，declare not found; 2，echo 后面的颜色配置内容都给输出。</p>\n<p>三种解决方法：</p>\n<ol>\n<li>执行时由<code>sh build.sh</code>变成<code>bash build.sh</code></li>\n<li><code>ln -s /bin/bash /bin/sh -f</code></li>\n<li><code>sudo dpkg-reconfigure dash</code> 进行配置，道理同（2）</li>\n</ol>\n<p>主控文件所有内容及注释 monitor_main.sh</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">resettem&#x3D;$(tput sgr0)</span><br><span class=\"line\"># 定义关联数组存储 键：数字,脚本号码   值：脚本名</span><br><span class=\"line\">DECLARE -A ssharray</span><br><span class=\"line\">i&#x3D;0</span><br><span class=\"line\">numbers&#x3D;&quot;&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># 使用for循环遍历所有子功能shell并输出(需要排除本文件) 注意单引号和双引号的使用</span><br><span class=\"line\">for script_file in &#96;ls -I &quot;monitor_main.sh&quot; .&#x2F;&#96;</span><br><span class=\"line\">do</span><br><span class=\"line\">    echo -e &quot;\\e[1;35m&quot; &quot;The Script:&quot; $&#123;i&#125; &#39;&#x3D;&#x3D;&gt;&#39; $&#123;ressettem&#125; $&#123;script_file&#125;</span><br><span class=\"line\">    # 关联数组赋值</span><br><span class=\"line\">    ssharray[$i]&#x3D;$&#123;script_file&#125;</span><br><span class=\"line\">    # echo $&#123;ssharray[$i]&#125;</span><br><span class=\"line\">    numbers&#x3D;&quot;$&#123;numbers&#125; | $i&quot;</span><br><span class=\"line\">    i&#x3D;$((i+1))</span><br><span class=\"line\">done</span><br><span class=\"line\"># echo $&#123;numbers&#125;</span><br><span class=\"line\"># 写一个无限循环</span><br><span class=\"line\">while true</span><br><span class=\"line\">do</span><br><span class=\"line\">  # 输入提示</span><br><span class=\"line\">  read -p &quot;Please input a number [ $&#123;numbers&#125; ]:&quot;  execshell</span><br><span class=\"line\">  # echo $&#123;execshell&#125;</span><br><span class=\"line\">  # 如果输入内容不是数字，中断</span><br><span class=\"line\">  if [[ ! $&#123;execshell&#125; &#x3D;~ ^[0-9]+ ]];  then</span><br><span class=\"line\">     exit 0</span><br><span class=\"line\">  fi</span><br><span class=\"line\"></span><br><span class=\"line\">  # 如果输入正确，执行对应的脚本</span><br><span class=\"line\">  &#x2F;bin&#x2F;bash .&#x2F;$&#123;ssharray[$execshell]&#125;</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"第二部分-系统信息及运行状态获取\"><a href=\"#第二部分-系统信息及运行状态获取\" class=\"headerlink\" title=\"第二部分 系统信息及运行状态获取\"></a>第二部分 系统信息及运行状态获取</h1><h2 id=\"1-系统信息所有内容及注释-system-monitor-sh\"><a href=\"#1-系统信息所有内容及注释-system-monitor-sh\" class=\"headerlink\" title=\"1. 系统信息所有内容及注释 system_monitor.sh\"></a>1. 系统信息所有内容及注释 system_monitor.sh</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\"># 清屏</span><br><span class=\"line\">clear</span><br><span class=\"line\"># $# 可提取位置参数个数 注意 [] 与内容之间都要有空格</span><br><span class=\"line\">if [[ $# -eq  0 ]]</span><br><span class=\"line\">then</span><br><span class=\"line\"># 定义变量</span><br><span class=\"line\">reset_terminal&#x3D;$(tput sgr0)</span><br><span class=\"line\"># check OS type</span><br><span class=\"line\">os&#x3D;$(uname -o)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;Operating System Type: &quot; $reset_terminal $os</span><br><span class=\"line\"># check OS release version and name</span><br><span class=\"line\">os_name&#x3D;$(cat &#x2F;etc&#x2F;issue)</span><br><span class=\"line\"># os_name&#x3D;$(cat &#x2F;etc&#x2F;issue|grep -e &quot;Server&quot;)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;release version and name: &quot; $reset_terminal $os_name</span><br><span class=\"line\"># check architecture</span><br><span class=\"line\">architecture&#x3D;$(uname -m)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;architecture Type: &quot; $reset_terminal $architecture</span><br><span class=\"line\"># check kernel release</span><br><span class=\"line\">kernel&#x3D;$(uname -r);</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;kernel Type: &quot; $reset_terminal $kernel</span><br><span class=\"line\"># check hostname</span><br><span class=\"line\">hostname&#x3D;$(uname -n)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;hostname: &quot; $reset_terminal $hostname</span><br><span class=\"line\"># hostname&#x3D;$(hostname)</span><br><span class=\"line\"># hostname&#x3D;$(echo $HOSTNAME)</span><br><span class=\"line\"></span><br><span class=\"line\"># check internal IP</span><br><span class=\"line\">internalIP&#x3D;$(hostname -I)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;internalIP: &quot; $reset_terminal $internalIP</span><br><span class=\"line\"># check external IP</span><br><span class=\"line\">externalIP&#x3D;$(curl -s http:&#x2F;&#x2F;ipecho.net&#x2F;plain)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;externalIP: &quot; $reset_terminal $externalIP</span><br><span class=\"line\"># check DNS</span><br><span class=\"line\"># -E 支持元字符  加边界匹配，匹配以&lt;nameserver开头，后面跟任意多个空格的内容</span><br><span class=\"line\"># 使用awk做列筛选，$NF 表示以空格作为分隔符，打印出最后一列</span><br><span class=\"line\"># 注意单双引号的使用</span><br><span class=\"line\">DNS&#x3D;$(cat &#x2F;etc&#x2F;resolv.conf |grep -E &quot;\\&lt;nameserver[ ]+&quot; | awk &#39;&#123;print $NF&#125;&#39;)</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;DNS: &quot; $reset_terminal $DNS</span><br><span class=\"line\"># check internet connection status</span><br><span class=\"line\"># ping -c 表示次数</span><br><span class=\"line\"># 输出到空设备  &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class=\"line\">ping -c 2 baidu.com &amp;&gt;&#x2F;dev&#x2F;null &amp;&amp; echo &quot;Internet connected&quot; || echo &quot;Internet disconnected&quot;</span><br><span class=\"line\"># check LoggedIn users</span><br><span class=\"line\">who&gt;&#x2F;tmp&#x2F;who</span><br><span class=\"line\">echo -e &#39;\\e[1;32m&#39; &quot;LoggedIn users: &quot; $reset_terminal &amp;&amp; cat &#x2F;tmp&#x2F;who</span><br><span class=\"line\"># 用完及时删除</span><br><span class=\"line\">rm -rf &#x2F;tmp&#x2F;who</span><br><span class=\"line\">fi</span><br></pre></td></tr></table></figure>\n<p>效果图</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-30d101e3970871cf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"2-系统监控脚本\"><a href=\"#2-系统监控脚本\" class=\"headerlink\" title=\"2. 系统监控脚本\"></a>2. 系统监控脚本</h2><ol>\n<li>操作系统使用内存与应用使用内存的区别<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-1fdb300ae6d72455.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">系统使用内容 &#x3D; total - free</span><br><span class=\"line\">应用使用内容 &#x3D; total - (free + cached + buffers)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>内存中cache和buffer 区别</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-7fbc5e89dfe596d5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>cache主要用来缓存打开过的文件，buffer用于缓存目录项，inode节点（文件索引头）。</p>\n<p>除了使用 free -m 来获取内存外，还可以使用读取文件的方式来获取内容，文件位于 /proc/meminfo</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">awk &#39;&#x2F;MemTotal&#x2F;&#123;total&#x3D;$2&#125;&#x2F;MemFree&#x2F;&#123;free&#x3D;$2&#125;END&#123;print (total-free)&#x2F;1024&#125;&#39; &#x2F;proc&#x2F;meminfo</span><br></pre></td></tr></table></figure>\n<p>解释： 使用awk来进行模式匹配，首先 匹配 MemTotal，第二列的值赋值给变量total；匹配MemFree，第二列的值赋值给free。使用END结束匹配，输出计算结果，并以MB单位显示。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">############################################################</span><br><span class=\"line\"># 内存使用</span><br><span class=\"line\">system_memory_usage&#x3D;$(awk &#39;&#x2F;MemTotal&#x2F;&#123;total&#x3D;$2&#125;&#x2F;MemFree&#x2F;&#123;free&#x3D;$2&#125;END&#123;print (total-free)&#x2F;1024&#125;&#39; &#x2F;proc&#x2F;meminfo)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;system memory usage:&quot; $reset_terminal $system_memory_usage</span><br><span class=\"line\"># 有两个cache，匹配第一个</span><br><span class=\"line\">app_memory_usage&#x3D;$(awk &#39;&#x2F;MemTotal&#x2F;&#123;total&#x3D;$2&#125;&#x2F;MemFree&#x2F;&#123;free&#x3D;$2&#125;&#x2F;^Cached&#x2F;&#123;cached&#x3D;$2&#125;&#x2F;Buffers&#x2F;&#123;buffers&#x3D;$2&#125;END&#123;print (total-free-cached-buffers)&#x2F;1024&#125;&#39; &#x2F;proc&#x2F;meminfo)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;apps memory usage:&quot; $reset_terminal $app_memory_usage</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-CPU-负载\"><a href=\"#3-CPU-负载\" class=\"headerlink\" title=\"3. CPU 负载\"></a>3. CPU 负载</h2><p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b08caa30fe4cfcd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>可以读取 /proc/meminfo 文件，也可以使用 top 命令。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top -n 1 -b | grep &quot;load average&quot; | awk &#39;&#123;print $10  $11  $12&#125;&#39;</span><br></pre></td></tr></table></figure>\n<p>解释： -n 表示刷新次数，一次即可。  -b表示更完整地显示信息。 awk 进行列匹配，取出第10，11，12 列的数值。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-04d1c54659ab212b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<h2 id=\"4-磁盘容量-使用量\"><a href=\"#4-磁盘容量-使用量\" class=\"headerlink\" title=\"4. 磁盘容量 使用量\"></a>4. 磁盘容量 使用量</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">df -h | grep -vE &#39;Filesystem|tmpfs&#39; | awk &#39;&#123;print $1 &quot; &quot; $5&#125;&#39;</span><br></pre></td></tr></table></figure>\n<p>解释： v表示反选，E表示元字符，匹配到的内容将别忽略，即取出除匹配到的内容之外的所有内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">###########################################################</span><br><span class=\"line\"># CPU</span><br><span class=\"line\">loadaverage&#x3D;$(top -n 1 -b | grep &quot;load average&quot; | awk &#39;&#123;print $10  $11  $12&#125;&#39;)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;load averages &quot; $reset_terminal $loadaverage</span><br><span class=\"line\">diskaverage&#x3D;$(df -h | grep -vE &#39;Filesystem|tmpfs&#39; | awk &#39;&#123;print $1 &quot; &quot; $5&#125;&#39;)</span><br><span class=\"line\">echo -e &#39;\\e[32m&#39; &quot;disk averages &quot; $reset_terminal $diskaverage</span><br></pre></td></tr></table></figure>"},{"title":"Yii-框架-开启网页调试功能","date":"2016-12-29T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-6753b35ab3060072.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\n\n## 1. 首先在入口文件 `index.php`  开启 debug 模式\n\n```\ndefined('YII_DEBUG') or define('YII_DEBUG',true);\n```\n\n## 2. `protected/config/main.php` 的 log 下面\n```\n'log' => array(\n            'class' => 'CLogRouter',\n            'routes' => array(\n                array(\n                    'enabled' => true,\n                    'class' => 'CWebLogRoute',\n                    'levels' => '',\n                    'categories' => '',\n                ),\n...\n```\n\n就这么简单。\n\n\n","source":"_posts/Yii-框架-开启网页调试功能.md","raw":"---\ntitle: Yii-框架-开启网页调试功能\ndate: 2016-12-30\ntags: Yii\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-6753b35ab3060072.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\n\n## 1. 首先在入口文件 `index.php`  开启 debug 模式\n\n```\ndefined('YII_DEBUG') or define('YII_DEBUG',true);\n```\n\n## 2. `protected/config/main.php` 的 log 下面\n```\n'log' => array(\n            'class' => 'CLogRouter',\n            'routes' => array(\n                array(\n                    'enabled' => true,\n                    'class' => 'CWebLogRoute',\n                    'levels' => '',\n                    'categories' => '',\n                ),\n...\n```\n\n就这么简单。\n\n\n","slug":"Yii-框架-开启网页调试功能","published":1,"updated":"2020-09-11T01:04:35.040Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8r001o6wo14zve6790","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-6753b35ab3060072.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n\n<h2 id=\"1-首先在入口文件-index-php-开启-debug-模式\"><a href=\"#1-首先在入口文件-index-php-开启-debug-模式\" class=\"headerlink\" title=\"1. 首先在入口文件 index.php  开启 debug 模式\"></a>1. 首先在入口文件 <code>index.php</code>  开启 debug 模式</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defined(&#39;YII_DEBUG&#39;) or define(&#39;YII_DEBUG&#39;,true);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-protected-config-main-php-的-log-下面\"><a href=\"#2-protected-config-main-php-的-log-下面\" class=\"headerlink\" title=\"2. protected/config/main.php 的 log 下面\"></a>2. <code>protected/config/main.php</code> 的 log 下面</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;log&#39; &#x3D;&gt; array(</span><br><span class=\"line\">            &#39;class&#39; &#x3D;&gt; &#39;CLogRouter&#39;,</span><br><span class=\"line\">            &#39;routes&#39; &#x3D;&gt; array(</span><br><span class=\"line\">                array(</span><br><span class=\"line\">                    &#39;enabled&#39; &#x3D;&gt; true,</span><br><span class=\"line\">                    &#39;class&#39; &#x3D;&gt; &#39;CWebLogRoute&#39;,</span><br><span class=\"line\">                    &#39;levels&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">                    &#39;categories&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">                ),</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>就这么简单。</p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-6753b35ab3060072.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<h2 id=\"1-首先在入口文件-index-php-开启-debug-模式\"><a href=\"#1-首先在入口文件-index-php-开启-debug-模式\" class=\"headerlink\" title=\"1. 首先在入口文件 index.php  开启 debug 模式\"></a>1. 首先在入口文件 <code>index.php</code>  开启 debug 模式</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defined(&#39;YII_DEBUG&#39;) or define(&#39;YII_DEBUG&#39;,true);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-protected-config-main-php-的-log-下面\"><a href=\"#2-protected-config-main-php-的-log-下面\" class=\"headerlink\" title=\"2. protected/config/main.php 的 log 下面\"></a>2. <code>protected/config/main.php</code> 的 log 下面</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#39;log&#39; &#x3D;&gt; array(</span><br><span class=\"line\">            &#39;class&#39; &#x3D;&gt; &#39;CLogRouter&#39;,</span><br><span class=\"line\">            &#39;routes&#39; &#x3D;&gt; array(</span><br><span class=\"line\">                array(</span><br><span class=\"line\">                    &#39;enabled&#39; &#x3D;&gt; true,</span><br><span class=\"line\">                    &#39;class&#39; &#x3D;&gt; &#39;CWebLogRoute&#39;,</span><br><span class=\"line\">                    &#39;levels&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">                    &#39;categories&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">                ),</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>就这么简单。</p>"},{"title":"bd：快速返回某级父目录而不用冗余地输入 “cd ..”","date":"2017-05-20T02:27:37.000Z","_content":"\n> 在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（`cd ../../..`），直到进入感兴趣的目录。\n\n转自 [Linux 中国 bd：快速返回某级父目录而不用冗余地输入 “cd ..”](https://linux.cn/article-8491-1.html)，有删改。\n\n建议阅读： [Autojump - 一个快速浏览 Linux 文件系统的高级 “cd” 命令](https://linux.cn/article-5983-1.html)\n\n<!--more-->\n\n在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（`cd ../../..`），直到进入感兴趣的目录。\n\n对于经验丰富的 Linux 用户或需要进行各种不同任务的系统管理员而言，这可能非常乏味，因此希望在操作系统时有一个快捷方式来简化工作。\n\nbd 是用于切换文件夹的便利工具，它可以使你快速返回到父目录，而不必重复键入 `cd ../../..` 。 你可以可靠地将其与其他 Linux 命令组合以执行几个日常操作。\n\n## 安装 [bd](https://github.com/vigneshwaranr/bd)\n\n```\nwget --no-check-certificate -O /usr/local/bin/bd https://raw.github.com/vigneshwaranr/bd/master/bd\nchmod +rx /usr/local/bin/bd\necho 'alias bd=\". bd -si\"' >> ~/.bashrc\nsource ~/.bashrc\n```\n\n**注意**：如果 shell 使用的是 zsh，后面两步的 `.bashrc` 要替换成 `.zshrc`\n\n\n## 使用\n\n使用方法很简单。\n\n假定当前目录为`/home/user/project/src/org/main/site/utils/file/reader/whatever`，想要快速跳转至 site 目录，只需输入 `bd site` 即可。甚至只需输入目前的前几个字母都可以，比如 `bd si`。\n\n配合 autojump 使用，爽歪歪。\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/bd：快速返回某级父目录而不用冗余地输入-“cd-”.md","raw":"---\ntitle: bd：快速返回某级父目录而不用冗余地输入 “cd ..”\ndate: 2017-05-20 10:27:37\ntags: Linux\ncategories: Linux\n---\n\n> 在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（`cd ../../..`），直到进入感兴趣的目录。\n\n转自 [Linux 中国 bd：快速返回某级父目录而不用冗余地输入 “cd ..”](https://linux.cn/article-8491-1.html)，有删改。\n\n建议阅读： [Autojump - 一个快速浏览 Linux 文件系统的高级 “cd” 命令](https://linux.cn/article-5983-1.html)\n\n<!--more-->\n\n在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（`cd ../../..`），直到进入感兴趣的目录。\n\n对于经验丰富的 Linux 用户或需要进行各种不同任务的系统管理员而言，这可能非常乏味，因此希望在操作系统时有一个快捷方式来简化工作。\n\nbd 是用于切换文件夹的便利工具，它可以使你快速返回到父目录，而不必重复键入 `cd ../../..` 。 你可以可靠地将其与其他 Linux 命令组合以执行几个日常操作。\n\n## 安装 [bd](https://github.com/vigneshwaranr/bd)\n\n```\nwget --no-check-certificate -O /usr/local/bin/bd https://raw.github.com/vigneshwaranr/bd/master/bd\nchmod +rx /usr/local/bin/bd\necho 'alias bd=\". bd -si\"' >> ~/.bashrc\nsource ~/.bashrc\n```\n\n**注意**：如果 shell 使用的是 zsh，后面两步的 `.bashrc` 要替换成 `.zshrc`\n\n\n## 使用\n\n使用方法很简单。\n\n假定当前目录为`/home/user/project/src/org/main/site/utils/file/reader/whatever`，想要快速跳转至 site 目录，只需输入 `bd site` 即可。甚至只需输入目前的前几个字母都可以，比如 `bd si`。\n\n配合 autojump 使用，爽歪歪。\n\n\n\n\n\n\n\n\n\n\n","slug":"bd：快速返回某级父目录而不用冗余地输入-“cd-”","published":1,"updated":"2020-09-11T01:04:35.040Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8s001p6wo1am3m0j02","content":"<blockquote>\n<p>在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（<code>cd ../../..</code>），直到进入感兴趣的目录。</p>\n</blockquote>\n<p>转自 <a href=\"https://linux.cn/article-8491-1.html\">Linux 中国 bd：快速返回某级父目录而不用冗余地输入 “cd ..”</a>，有删改。</p>\n<p>建议阅读： <a href=\"https://linux.cn/article-5983-1.html\">Autojump - 一个快速浏览 Linux 文件系统的高级 “cd” 命令</a></p>\n<a id=\"more\"></a>\n\n<p>在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（<code>cd ../../..</code>），直到进入感兴趣的目录。</p>\n<p>对于经验丰富的 Linux 用户或需要进行各种不同任务的系统管理员而言，这可能非常乏味，因此希望在操作系统时有一个快捷方式来简化工作。</p>\n<p>bd 是用于切换文件夹的便利工具，它可以使你快速返回到父目录，而不必重复键入 <code>cd ../../..</code> 。 你可以可靠地将其与其他 Linux 命令组合以执行几个日常操作。</p>\n<h2 id=\"安装-bd\"><a href=\"#安装-bd\" class=\"headerlink\" title=\"安装 bd\"></a>安装 <a href=\"https://github.com/vigneshwaranr/bd\">bd</a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;bd https:&#x2F;&#x2F;raw.github.com&#x2F;vigneshwaranr&#x2F;bd&#x2F;master&#x2F;bd</span><br><span class=\"line\">chmod +rx &#x2F;usr&#x2F;local&#x2F;bin&#x2F;bd</span><br><span class=\"line\">echo &#39;alias bd&#x3D;&quot;. bd -si&quot;&#39; &gt;&gt; ~&#x2F;.bashrc</span><br><span class=\"line\">source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：如果 shell 使用的是 zsh，后面两步的 <code>.bashrc</code> 要替换成 <code>.zshrc</code></p>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>使用方法很简单。</p>\n<p>假定当前目录为<code>/home/user/project/src/org/main/site/utils/file/reader/whatever</code>，想要快速跳转至 site 目录，只需输入 <code>bd site</code> 即可。甚至只需输入目前的前几个字母都可以，比如 <code>bd si</code>。</p>\n<p>配合 autojump 使用，爽歪歪。</p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（<code>cd ../../..</code>），直到进入感兴趣的目录。</p>\n</blockquote>\n<p>转自 <a href=\"https://linux.cn/article-8491-1.html\">Linux 中国 bd：快速返回某级父目录而不用冗余地输入 “cd ..”</a>，有删改。</p>\n<p>建议阅读： <a href=\"https://linux.cn/article-5983-1.html\">Autojump - 一个快速浏览 Linux 文件系统的高级 “cd” 命令</a></p>","more":"<p>在 Linux 系统上通过命令行切换文件夹时，为了回到父目录（长路径），我们通常会重复输入 cd 命令（<code>cd ../../..</code>），直到进入感兴趣的目录。</p>\n<p>对于经验丰富的 Linux 用户或需要进行各种不同任务的系统管理员而言，这可能非常乏味，因此希望在操作系统时有一个快捷方式来简化工作。</p>\n<p>bd 是用于切换文件夹的便利工具，它可以使你快速返回到父目录，而不必重复键入 <code>cd ../../..</code> 。 你可以可靠地将其与其他 Linux 命令组合以执行几个日常操作。</p>\n<h2 id=\"安装-bd\"><a href=\"#安装-bd\" class=\"headerlink\" title=\"安装 bd\"></a>安装 <a href=\"https://github.com/vigneshwaranr/bd\">bd</a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget --no-check-certificate -O &#x2F;usr&#x2F;local&#x2F;bin&#x2F;bd https:&#x2F;&#x2F;raw.github.com&#x2F;vigneshwaranr&#x2F;bd&#x2F;master&#x2F;bd</span><br><span class=\"line\">chmod +rx &#x2F;usr&#x2F;local&#x2F;bin&#x2F;bd</span><br><span class=\"line\">echo &#39;alias bd&#x3D;&quot;. bd -si&quot;&#39; &gt;&gt; ~&#x2F;.bashrc</span><br><span class=\"line\">source ~&#x2F;.bashrc</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：如果 shell 使用的是 zsh，后面两步的 <code>.bashrc</code> 要替换成 <code>.zshrc</code></p>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>使用方法很简单。</p>\n<p>假定当前目录为<code>/home/user/project/src/org/main/site/utils/file/reader/whatever</code>，想要快速跳转至 site 目录，只需输入 <code>bd site</code> 即可。甚至只需输入目前的前几个字母都可以，比如 <code>bd si</code>。</p>\n<p>配合 autojump 使用，爽歪歪。</p>"},{"title":"centOS7 安装 PHP7 (updated at 2017-11-20)","date":"2017-05-05T16:00:00.000Z","description":"如果既想获得 RHEL 的高质量、高性能、高可靠性，又需要方便易用(关键是免费)的软件包更新功能，那么 Fedora Project 推出的 EPEL(Extra Packages for Enterprise Linux)正好适合你。EPEL 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-8d0e8340119e6d58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n> 新买了台服务器，随便倒腾，记录一下。\n\n\n<!-- more -->\n\n## 1. 安装 epel-release\n\n### 1. 什么是epel\n如果既想获得 RHEL 的高质量、高性能、高可靠性，又需要方便易用(关键是免费)的软件包更新功能，那么 Fedora Project 推出的 EPEL(Extra Packages for Enterprise Linux)正好适合你。\n\n[EPEL](http://fedoraproject.org/wiki/EPEL) 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。\n\n### 2. 使用心得\n1. 不用去换原来yum源，安装后会产生新repo\n2. epel会有很多源地址，如果一个下不到，会去另外一个下\n\n### 3. 安装方法\n\n#### 1. 搜索EPEL相关的软件包\n\n```\n# yum search epel\nLoaded plugins: fastestmirror\nRepository base is listed more than once in the configuration\nRepository updates is listed more than once in the configuration\nRepository extras is listed more than once in the configuration\nRepository epel is listed more than once in the configuration\nLoading mirror speeds from cached hostfile\n * base: mirrors.cloud.aliyuncs.com\n * epel: mirrors.cloud.aliyuncs.com\n * extras: mirrors.cloud.aliyuncs.com\n * updates: mirrors.cloud.aliyuncs.com\n * webtatic: us-east.repo.webtatic.com\n================================= N/S matched: epel =================================\nepel-release.noarch : Extra Packages for Enterprise Linux repository configuration\nepel-rpm-macros.noarch : Extra Packages for Enterprise Linux RPM macros\npython3-pkgversion-macros.noarch : Convenience macros for Fedora/EPEL Python 3\n                                 : packages building\n\n  Name and summary matches only, use \"search all\" for everything.\n```\n\n#### 2. 安装EPEL软件包\n\n通过yum搜索的结果中epel-release.noarch就是我们需要的软件包。\n\n安装可以不用包含软件包名称中点“.”后面的部分，当然包含也没有问题。点“.”后面的部分只是提供软件包适应系统架构。noarch为通用型，还有x86_64为64位的系统，i686为32位系统使用。\n\n通过下面命令进行安装。\n\n```\n# yum install epel-release\nLoaded plugins: fastestmirror\nRepository base is listed more than once in the configuration\nRepository updates is listed more than once in the configuration\nRepository extras is listed more than once in the configuration\nRepository epel is listed more than once in the configuration\nLoading mirror speeds from cached hostfile\n * base: mirrors.cloud.aliyuncs.com\n * epel: mirrors.cloud.aliyuncs.com\n * extras: mirrors.cloud.aliyuncs.com\n * updates: mirrors.cloud.aliyuncs.com\n * webtatic: uk.repo.webtatic.com\nPackage epel-release-7-9.noarch already installed and latest version\nNothing to do\n```\n\n想知道epel-release这个包包含哪些内容，就使用rpm命令查询列出。-q 表示查询，-l 标识列出软件包的所包含的文件。\n\n```\n# rpm -ql epel-release\n/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\n/etc/yum.repos.d/epel-testing.repo\n/etc/yum.repos.d/epel.repo\n/usr/lib/systemd/system-preset/90-epel.preset\n/usr/share/doc/epel-release-7\n/usr/share/doc/epel-release-7/GPL\n```\n\n可以看出最主要的就是/etc/yum.repos.d/epel.repo这个文件了，默认已经启用。不确定的话可以用vi等命令查看编辑。\n\n`enabled=1`说明已经启用\n\n启用之后就可安装EPEL源中提供的软件了。\n通过使用`yum install XXXXX`命令安装，会自动搜索所有可用的软件源，并提示可用的软件包。\n\n## 2. 安装PHP7的rpm源\n\n```\n# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\nRetrieving https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\nPreparing...                          ################################# [100%]\n    package webtatic-release-7-3.noarch is already installed\n```\n\n## 3. 安装PHP7\n\n```\n# yum install php71w\n```\n\n## 4. 编译安装\n\n### 1. 下载PHP源码包\n\n从[这里](http://cn2.php.net/downloads.php)获取所需版本的PHP的下载地址。\n\n```\n# wget -O php7.tar.gz url/get/from/last/step\n```\n\n### 2. 解压php7\n\n```\n# tar -xvf php7.tar.gz\n```\n\n### 3. 进入php目录\n\n```\n# cd php-7.x.x\n```\n\n### 4. 安装依赖包\n\n```\n# yum install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel\n```\n\n### 5. 编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\n嫌麻烦的可以从这一步起参考[PHP官方安装说明](http://php.net/manual/zh/install.unix.nginx.php)\n\n```\n# ./configure \\\n--prefix=/usr/local/php \\\n--with-config-file-path=/etc \\\n--enable-fpm \\\n--with-fpm-user=nginx  \\\n--with-fpm-group=nginx \\\n--enable-inline-optimization \\\n--disable-debug \\\n--disable-rpath \\\n--enable-shared  \\\n--enable-soap \\\n--with-libxml-dir \\\n--with-xmlrpc \\\n--with-openssl \\\n--with-mcrypt \\\n--with-mhash \\\n--with-pcre-regex \\\n--with-sqlite3 \\\n--with-zlib \\\n--enable-bcmath \\\n--with-iconv \\\n--with-bz2 \\\n--enable-calendar \\\n--with-curl \\\n--with-cdb \\\n--enable-dom \\\n--enable-exif \\\n--enable-fileinfo \\\n--enable-filter \\\n--with-pcre-dir \\\n--enable-ftp \\\n--with-gd \\\n--with-openssl-dir \\\n--with-jpeg-dir \\\n--with-png-dir \\\n--with-zlib-dir  \\\n--with-freetype-dir \\\n--enable-gd-native-ttf \\\n--enable-gd-jis-conv \\\n--with-gettext \\\n--with-gmp \\\n--with-mhash \\\n--enable-json \\\n--enable-mbstring \\\n--enable-mbregex \\\n--enable-mbregex-backtrack \\\n--with-libmbfl \\\n--with-onig \\\n--enable-pdo \\\n--with-mysqli=mysqlnd \\\n--with-pdo-mysql=mysqlnd \\\n--with-zlib-dir \\\n--with-pdo-sqlite \\\n--with-readline \\\n--enable-session \\\n--enable-shmop \\\n--enable-simplexml \\\n--enable-sockets  \\\n--enable-sysvmsg \\\n--enable-sysvsem \\\n--enable-sysvshm \\\n--enable-wddx \\\n--with-libxml-dir \\\n--with-xsl \\\n--enable-zip \\\n--enable-mysqlnd-compression-support \\\n--with-pear \\\n--enable-opcache\n```\n\n这里可能会报很多错误，一个个解决即可。[这里](http://ask.apelearn.com/question/10761)有大部分的解决方法。\n\n列出几个常见的\n\n```\nchecking for png_write_image in -lpng… yes If configure fails try –with-xpm-dir=\n\nconfigure: error: freetype.h not found.\nFix: Reconfigure your PHP with the following option. --with-xpm-dir=/usr\n\nchecking for png_write_image in -lpng… yes configure: error: libXpm.(a|so) not found.\n\nFix: yum install libXpm-devel\n\nchecking for bind_textdomain_codeset in -lc… yes checking for GNU MP support… yes configure: error: Unable to locate gmp.h\n\nFix: yum install gmp-devel\n```\n\n### 6. 正式安装\n\n```\n# make && make install\n```\n\n没有报错就表示安装完成。\n\n## 4. 配置PHP\n\n### 1. 配置环境变量\n\n```\n# vi /etc/profile\n```\n\n在末尾追加\n\n```\nPATH=$PATH:/usr/local/php/bin\nexport PATH\n```\n\n执行命令使得改动立即生效\n\n```\n# source /etc/profile\n```\n\n### 2. 配置php-fpm\n\n把所需的几个配置文件放到需要的位置\n\n```\n# cp php.ini-production /etc/php.ini\n# cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf\n# cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf\n# cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm\n# chmod +x /etc/init.d/php-fpm\n```\n\n### 3. 启动php-fpm\n\n```\n# /etc/init.d/php-fpm start\n```\n### 4. 查看是否已正确安装\n\n```\n# php -v\nPHP 7.1.4 (cli) (built: Apr 30 2017 11:20:19) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\n# which php\n/usr/local/php/bin/php\n```\n\n## 5. 坑\n\n### 1. Nginx Error! \n\nThe page you are looking for is temporarily unavailable. Please try again later.\n\n```\nconnect() to unix:/var/run/php-fpm/php-fpm.sock failed (2: No such file or directory) while connecting to upstream\n```\n\n参考[这里](https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/)的解决方案\n\n```\n# cp /etc/php-fpm.d/www.conf.rpmsave /etc/php-fpm.d/www.conf\n# vi /etc/php-fpm.d/www.conf\nlisten 改为\nlisten = 127.0.0.1:9000;\n```\n\nnginx 配置文件也改\n```\n# vi /etc/nginx/conf.d/yoursite.com.conf\n\nfastcgi_pass 127.0.0.1:9000;\n```\n\n重启php-fpm 和 nginx\n```\n# sudo /etc/init.d/php-fpm restart\n# sudo systemctl restart nginx\n```\n\n上面是 TCP 的解决方案，另一种连接方式是通过 socket 套接字连接。 \nNginx连接fastcgi的方式有2种：TCP和unix domain socket, 推荐使用php-fpm的UnixSocket的方式\n\n> Socket 可以被定义描述为两个应用通信通道的端点。一个 Socket 端点可以用 Socket 地址来描述， Socket 地址结构由 IP 地址，端口和使用协议组成（ TCP or UDP ）。http协议可以通过socket实现，socket在传输层上实现。从这个角度来说，socket介于应用层和传输层之间。但是socket作为一种进程通信机制，操作系统分配唯一一个socket号，是依赖于通信协议的，但是这个通信协议不仅仅是 tcp或udp，也可以是其它协议。\n\n\nTCP是使用TCP端口连接127.0.0.1:9001\nSocket是使用unix domain\nsocket连接套接字/dev/shm/php-cgi.sock（很多教程使用路径/tmp，而路径/dev/shm是个tmpfs，速度比磁盘快得多）\n\n理论上，unix socket不走网络，会快些，\n可是，稳定性就不那么理想了，\n另外放在/tmp目录不如放在内存里面\n我一般放在 /dev/shm/php-fpm.sock\n放在内存读取速度快更快的\n\n修改方法：\n\nphp-fpm listen sock 模式\n\n#### 1. 新建套接字文件\n\n```\ntouch /dev/shm/php-fpm.sock\nchmod 777 /dev/shm/php-fpm.sock\n# 用户组和用户名查 nginx.conf 文件\nchown nginx:nginx /dev/shm/php-fpm.sock\n```\n\n#### 2. nginx 配置\n\n```\nlocation ~ \\.php$ {\n\t#fastcgi_pass 127.0.0.1:9001; \n\tfastcgi_pass unix:/dev/shm/php-fpm.sock;\n\tfastcgi_index index.php;\n\t# 不要忘了这一行\n\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\tinclude fastcgi_params;\n}\n```\n\n#### 3. php fpm conf\n\n```\nvim www.conf\n;listen = 127.0.0.1:9001\nlisten = /dev/shm/php-fpm.sock\nlisten.owner = nginx\nlisten.group = nginx\nlisten.mode = 0660\n```\n\n#### 4. 问题\n\n```\nconnect() to unix:/dev/shm/php-fpm.sock failed (13: Permission denied) while connecting to upstream, \nclient: 192.168.121.130, server: localhost, request: \"GET /index.php HTTP/1.1\", \nupstream: \"fastcgi://unix:/dev/shm/php-fpm.sock:\", host: \"192.168.121.130\" \n```\n\n确保：nginx: worker process 的用户是 nginx.conf 中的 user, Permission denied 不是一个用户导致\n\n\n## 6. 参考资料\n1. [How To Install Wget on CentOS](http://idroot.net/tutorials/how-to-install-wget-on-centos/)\n2. [CentOS怎样强制卸载PHP以及自定义安装PHP](http://blog.csdn.net/21aspnet/article/details/6581618)\n3. [CentOS7 安装 PHP7最新版](http://www.jianshu.com/p/246ffcd5e77d)\n4. [PHP编译过程中常见错误信息的解决方法](http://lyp.cn/350_how-to-fix-php-compile-errors)\n5. [PHP编译安装时常见错误解决办法，php编译常见错误](http://ask.apelearn.com/question/10761)\n6. [PHP-FPM connect() to unix:/tmp/php5-fpm.sock failed (2: No such file or directory)](https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/)\n\n","source":"_posts/centOS 安装 PHP7.md","raw":"---\ntitle: centOS7 安装 PHP7 (updated at 2017-11-20)\ndate: 2017-05-06\ntags: PHP\ncategories: PHP\ndescription: 如果既想获得 RHEL 的高质量、高性能、高可靠性，又需要方便易用(关键是免费)的软件包更新功能，那么 Fedora Project 推出的 EPEL(Extra Packages for Enterprise Linux)正好适合你。EPEL 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-8d0e8340119e6d58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n> 新买了台服务器，随便倒腾，记录一下。\n\n\n<!-- more -->\n\n## 1. 安装 epel-release\n\n### 1. 什么是epel\n如果既想获得 RHEL 的高质量、高性能、高可靠性，又需要方便易用(关键是免费)的软件包更新功能，那么 Fedora Project 推出的 EPEL(Extra Packages for Enterprise Linux)正好适合你。\n\n[EPEL](http://fedoraproject.org/wiki/EPEL) 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。\n\n### 2. 使用心得\n1. 不用去换原来yum源，安装后会产生新repo\n2. epel会有很多源地址，如果一个下不到，会去另外一个下\n\n### 3. 安装方法\n\n#### 1. 搜索EPEL相关的软件包\n\n```\n# yum search epel\nLoaded plugins: fastestmirror\nRepository base is listed more than once in the configuration\nRepository updates is listed more than once in the configuration\nRepository extras is listed more than once in the configuration\nRepository epel is listed more than once in the configuration\nLoading mirror speeds from cached hostfile\n * base: mirrors.cloud.aliyuncs.com\n * epel: mirrors.cloud.aliyuncs.com\n * extras: mirrors.cloud.aliyuncs.com\n * updates: mirrors.cloud.aliyuncs.com\n * webtatic: us-east.repo.webtatic.com\n================================= N/S matched: epel =================================\nepel-release.noarch : Extra Packages for Enterprise Linux repository configuration\nepel-rpm-macros.noarch : Extra Packages for Enterprise Linux RPM macros\npython3-pkgversion-macros.noarch : Convenience macros for Fedora/EPEL Python 3\n                                 : packages building\n\n  Name and summary matches only, use \"search all\" for everything.\n```\n\n#### 2. 安装EPEL软件包\n\n通过yum搜索的结果中epel-release.noarch就是我们需要的软件包。\n\n安装可以不用包含软件包名称中点“.”后面的部分，当然包含也没有问题。点“.”后面的部分只是提供软件包适应系统架构。noarch为通用型，还有x86_64为64位的系统，i686为32位系统使用。\n\n通过下面命令进行安装。\n\n```\n# yum install epel-release\nLoaded plugins: fastestmirror\nRepository base is listed more than once in the configuration\nRepository updates is listed more than once in the configuration\nRepository extras is listed more than once in the configuration\nRepository epel is listed more than once in the configuration\nLoading mirror speeds from cached hostfile\n * base: mirrors.cloud.aliyuncs.com\n * epel: mirrors.cloud.aliyuncs.com\n * extras: mirrors.cloud.aliyuncs.com\n * updates: mirrors.cloud.aliyuncs.com\n * webtatic: uk.repo.webtatic.com\nPackage epel-release-7-9.noarch already installed and latest version\nNothing to do\n```\n\n想知道epel-release这个包包含哪些内容，就使用rpm命令查询列出。-q 表示查询，-l 标识列出软件包的所包含的文件。\n\n```\n# rpm -ql epel-release\n/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7\n/etc/yum.repos.d/epel-testing.repo\n/etc/yum.repos.d/epel.repo\n/usr/lib/systemd/system-preset/90-epel.preset\n/usr/share/doc/epel-release-7\n/usr/share/doc/epel-release-7/GPL\n```\n\n可以看出最主要的就是/etc/yum.repos.d/epel.repo这个文件了，默认已经启用。不确定的话可以用vi等命令查看编辑。\n\n`enabled=1`说明已经启用\n\n启用之后就可安装EPEL源中提供的软件了。\n通过使用`yum install XXXXX`命令安装，会自动搜索所有可用的软件源，并提示可用的软件包。\n\n## 2. 安装PHP7的rpm源\n\n```\n# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\nRetrieving https://mirror.webtatic.com/yum/el7/webtatic-release.rpm\nPreparing...                          ################################# [100%]\n    package webtatic-release-7-3.noarch is already installed\n```\n\n## 3. 安装PHP7\n\n```\n# yum install php71w\n```\n\n## 4. 编译安装\n\n### 1. 下载PHP源码包\n\n从[这里](http://cn2.php.net/downloads.php)获取所需版本的PHP的下载地址。\n\n```\n# wget -O php7.tar.gz url/get/from/last/step\n```\n\n### 2. 解压php7\n\n```\n# tar -xvf php7.tar.gz\n```\n\n### 3. 进入php目录\n\n```\n# cd php-7.x.x\n```\n\n### 4. 安装依赖包\n\n```\n# yum install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel\n```\n\n### 5. 编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\n嫌麻烦的可以从这一步起参考[PHP官方安装说明](http://php.net/manual/zh/install.unix.nginx.php)\n\n```\n# ./configure \\\n--prefix=/usr/local/php \\\n--with-config-file-path=/etc \\\n--enable-fpm \\\n--with-fpm-user=nginx  \\\n--with-fpm-group=nginx \\\n--enable-inline-optimization \\\n--disable-debug \\\n--disable-rpath \\\n--enable-shared  \\\n--enable-soap \\\n--with-libxml-dir \\\n--with-xmlrpc \\\n--with-openssl \\\n--with-mcrypt \\\n--with-mhash \\\n--with-pcre-regex \\\n--with-sqlite3 \\\n--with-zlib \\\n--enable-bcmath \\\n--with-iconv \\\n--with-bz2 \\\n--enable-calendar \\\n--with-curl \\\n--with-cdb \\\n--enable-dom \\\n--enable-exif \\\n--enable-fileinfo \\\n--enable-filter \\\n--with-pcre-dir \\\n--enable-ftp \\\n--with-gd \\\n--with-openssl-dir \\\n--with-jpeg-dir \\\n--with-png-dir \\\n--with-zlib-dir  \\\n--with-freetype-dir \\\n--enable-gd-native-ttf \\\n--enable-gd-jis-conv \\\n--with-gettext \\\n--with-gmp \\\n--with-mhash \\\n--enable-json \\\n--enable-mbstring \\\n--enable-mbregex \\\n--enable-mbregex-backtrack \\\n--with-libmbfl \\\n--with-onig \\\n--enable-pdo \\\n--with-mysqli=mysqlnd \\\n--with-pdo-mysql=mysqlnd \\\n--with-zlib-dir \\\n--with-pdo-sqlite \\\n--with-readline \\\n--enable-session \\\n--enable-shmop \\\n--enable-simplexml \\\n--enable-sockets  \\\n--enable-sysvmsg \\\n--enable-sysvsem \\\n--enable-sysvshm \\\n--enable-wddx \\\n--with-libxml-dir \\\n--with-xsl \\\n--enable-zip \\\n--enable-mysqlnd-compression-support \\\n--with-pear \\\n--enable-opcache\n```\n\n这里可能会报很多错误，一个个解决即可。[这里](http://ask.apelearn.com/question/10761)有大部分的解决方法。\n\n列出几个常见的\n\n```\nchecking for png_write_image in -lpng… yes If configure fails try –with-xpm-dir=\n\nconfigure: error: freetype.h not found.\nFix: Reconfigure your PHP with the following option. --with-xpm-dir=/usr\n\nchecking for png_write_image in -lpng… yes configure: error: libXpm.(a|so) not found.\n\nFix: yum install libXpm-devel\n\nchecking for bind_textdomain_codeset in -lc… yes checking for GNU MP support… yes configure: error: Unable to locate gmp.h\n\nFix: yum install gmp-devel\n```\n\n### 6. 正式安装\n\n```\n# make && make install\n```\n\n没有报错就表示安装完成。\n\n## 4. 配置PHP\n\n### 1. 配置环境变量\n\n```\n# vi /etc/profile\n```\n\n在末尾追加\n\n```\nPATH=$PATH:/usr/local/php/bin\nexport PATH\n```\n\n执行命令使得改动立即生效\n\n```\n# source /etc/profile\n```\n\n### 2. 配置php-fpm\n\n把所需的几个配置文件放到需要的位置\n\n```\n# cp php.ini-production /etc/php.ini\n# cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf\n# cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf\n# cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm\n# chmod +x /etc/init.d/php-fpm\n```\n\n### 3. 启动php-fpm\n\n```\n# /etc/init.d/php-fpm start\n```\n### 4. 查看是否已正确安装\n\n```\n# php -v\nPHP 7.1.4 (cli) (built: Apr 30 2017 11:20:19) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\n# which php\n/usr/local/php/bin/php\n```\n\n## 5. 坑\n\n### 1. Nginx Error! \n\nThe page you are looking for is temporarily unavailable. Please try again later.\n\n```\nconnect() to unix:/var/run/php-fpm/php-fpm.sock failed (2: No such file or directory) while connecting to upstream\n```\n\n参考[这里](https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/)的解决方案\n\n```\n# cp /etc/php-fpm.d/www.conf.rpmsave /etc/php-fpm.d/www.conf\n# vi /etc/php-fpm.d/www.conf\nlisten 改为\nlisten = 127.0.0.1:9000;\n```\n\nnginx 配置文件也改\n```\n# vi /etc/nginx/conf.d/yoursite.com.conf\n\nfastcgi_pass 127.0.0.1:9000;\n```\n\n重启php-fpm 和 nginx\n```\n# sudo /etc/init.d/php-fpm restart\n# sudo systemctl restart nginx\n```\n\n上面是 TCP 的解决方案，另一种连接方式是通过 socket 套接字连接。 \nNginx连接fastcgi的方式有2种：TCP和unix domain socket, 推荐使用php-fpm的UnixSocket的方式\n\n> Socket 可以被定义描述为两个应用通信通道的端点。一个 Socket 端点可以用 Socket 地址来描述， Socket 地址结构由 IP 地址，端口和使用协议组成（ TCP or UDP ）。http协议可以通过socket实现，socket在传输层上实现。从这个角度来说，socket介于应用层和传输层之间。但是socket作为一种进程通信机制，操作系统分配唯一一个socket号，是依赖于通信协议的，但是这个通信协议不仅仅是 tcp或udp，也可以是其它协议。\n\n\nTCP是使用TCP端口连接127.0.0.1:9001\nSocket是使用unix domain\nsocket连接套接字/dev/shm/php-cgi.sock（很多教程使用路径/tmp，而路径/dev/shm是个tmpfs，速度比磁盘快得多）\n\n理论上，unix socket不走网络，会快些，\n可是，稳定性就不那么理想了，\n另外放在/tmp目录不如放在内存里面\n我一般放在 /dev/shm/php-fpm.sock\n放在内存读取速度快更快的\n\n修改方法：\n\nphp-fpm listen sock 模式\n\n#### 1. 新建套接字文件\n\n```\ntouch /dev/shm/php-fpm.sock\nchmod 777 /dev/shm/php-fpm.sock\n# 用户组和用户名查 nginx.conf 文件\nchown nginx:nginx /dev/shm/php-fpm.sock\n```\n\n#### 2. nginx 配置\n\n```\nlocation ~ \\.php$ {\n\t#fastcgi_pass 127.0.0.1:9001; \n\tfastcgi_pass unix:/dev/shm/php-fpm.sock;\n\tfastcgi_index index.php;\n\t# 不要忘了这一行\n\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\tinclude fastcgi_params;\n}\n```\n\n#### 3. php fpm conf\n\n```\nvim www.conf\n;listen = 127.0.0.1:9001\nlisten = /dev/shm/php-fpm.sock\nlisten.owner = nginx\nlisten.group = nginx\nlisten.mode = 0660\n```\n\n#### 4. 问题\n\n```\nconnect() to unix:/dev/shm/php-fpm.sock failed (13: Permission denied) while connecting to upstream, \nclient: 192.168.121.130, server: localhost, request: \"GET /index.php HTTP/1.1\", \nupstream: \"fastcgi://unix:/dev/shm/php-fpm.sock:\", host: \"192.168.121.130\" \n```\n\n确保：nginx: worker process 的用户是 nginx.conf 中的 user, Permission denied 不是一个用户导致\n\n\n## 6. 参考资料\n1. [How To Install Wget on CentOS](http://idroot.net/tutorials/how-to-install-wget-on-centos/)\n2. [CentOS怎样强制卸载PHP以及自定义安装PHP](http://blog.csdn.net/21aspnet/article/details/6581618)\n3. [CentOS7 安装 PHP7最新版](http://www.jianshu.com/p/246ffcd5e77d)\n4. [PHP编译过程中常见错误信息的解决方法](http://lyp.cn/350_how-to-fix-php-compile-errors)\n5. [PHP编译安装时常见错误解决办法，php编译常见错误](http://ask.apelearn.com/question/10761)\n6. [PHP-FPM connect() to unix:/tmp/php5-fpm.sock failed (2: No such file or directory)](https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/)\n\n","slug":"centOS 安装 PHP7","published":1,"updated":"2020-09-11T01:04:35.041Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8u001s6wo1f06wenrl","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-8d0e8340119e6d58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>新买了台服务器，随便倒腾，记录一下。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h2 id=\"1-安装-epel-release\"><a href=\"#1-安装-epel-release\" class=\"headerlink\" title=\"1. 安装 epel-release\"></a>1. 安装 epel-release</h2><h3 id=\"1-什么是epel\"><a href=\"#1-什么是epel\" class=\"headerlink\" title=\"1. 什么是epel\"></a>1. 什么是epel</h3><p>如果既想获得 RHEL 的高质量、高性能、高可靠性，又需要方便易用(关键是免费)的软件包更新功能，那么 Fedora Project 推出的 EPEL(Extra Packages for Enterprise Linux)正好适合你。</p>\n<p><a href=\"http://fedoraproject.org/wiki/EPEL\">EPEL</a> 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。</p>\n<h3 id=\"2-使用心得\"><a href=\"#2-使用心得\" class=\"headerlink\" title=\"2. 使用心得\"></a>2. 使用心得</h3><ol>\n<li>不用去换原来yum源，安装后会产生新repo</li>\n<li>epel会有很多源地址，如果一个下不到，会去另外一个下</li>\n</ol>\n<h3 id=\"3-安装方法\"><a href=\"#3-安装方法\" class=\"headerlink\" title=\"3. 安装方法\"></a>3. 安装方法</h3><h4 id=\"1-搜索EPEL相关的软件包\"><a href=\"#1-搜索EPEL相关的软件包\" class=\"headerlink\" title=\"1. 搜索EPEL相关的软件包\"></a>1. 搜索EPEL相关的软件包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum search epel</span><br><span class=\"line\">Loaded plugins: fastestmirror</span><br><span class=\"line\">Repository base is listed more than once in the configuration</span><br><span class=\"line\">Repository updates is listed more than once in the configuration</span><br><span class=\"line\">Repository extras is listed more than once in the configuration</span><br><span class=\"line\">Repository epel is listed more than once in the configuration</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\"> * base: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * epel: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * extras: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * updates: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * webtatic: us-east.repo.webtatic.com</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; N&#x2F;S matched: epel &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">epel-release.noarch : Extra Packages for Enterprise Linux repository configuration</span><br><span class=\"line\">epel-rpm-macros.noarch : Extra Packages for Enterprise Linux RPM macros</span><br><span class=\"line\">python3-pkgversion-macros.noarch : Convenience macros for Fedora&#x2F;EPEL Python 3</span><br><span class=\"line\">                                 : packages building</span><br><span class=\"line\"></span><br><span class=\"line\">  Name and summary matches only, use &quot;search all&quot; for everything.</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-安装EPEL软件包\"><a href=\"#2-安装EPEL软件包\" class=\"headerlink\" title=\"2. 安装EPEL软件包\"></a>2. 安装EPEL软件包</h4><p>通过yum搜索的结果中epel-release.noarch就是我们需要的软件包。</p>\n<p>安装可以不用包含软件包名称中点“.”后面的部分，当然包含也没有问题。点“.”后面的部分只是提供软件包适应系统架构。noarch为通用型，还有x86_64为64位的系统，i686为32位系统使用。</p>\n<p>通过下面命令进行安装。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install epel-release</span><br><span class=\"line\">Loaded plugins: fastestmirror</span><br><span class=\"line\">Repository base is listed more than once in the configuration</span><br><span class=\"line\">Repository updates is listed more than once in the configuration</span><br><span class=\"line\">Repository extras is listed more than once in the configuration</span><br><span class=\"line\">Repository epel is listed more than once in the configuration</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\"> * base: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * epel: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * extras: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * updates: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * webtatic: uk.repo.webtatic.com</span><br><span class=\"line\">Package epel-release-7-9.noarch already installed and latest version</span><br><span class=\"line\">Nothing to do</span><br></pre></td></tr></table></figure>\n\n<p>想知道epel-release这个包包含哪些内容，就使用rpm命令查询列出。-q 表示查询，-l 标识列出软件包的所包含的文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># rpm -ql epel-release</span><br><span class=\"line\">&#x2F;etc&#x2F;pki&#x2F;rpm-gpg&#x2F;RPM-GPG-KEY-EPEL-7</span><br><span class=\"line\">&#x2F;etc&#x2F;yum.repos.d&#x2F;epel-testing.repo</span><br><span class=\"line\">&#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo</span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system-preset&#x2F;90-epel.preset</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;epel-release-7</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;epel-release-7&#x2F;GPL</span><br></pre></td></tr></table></figure>\n\n<p>可以看出最主要的就是/etc/yum.repos.d/epel.repo这个文件了，默认已经启用。不确定的话可以用vi等命令查看编辑。</p>\n<p><code>enabled=1</code>说明已经启用</p>\n<p>启用之后就可安装EPEL源中提供的软件了。<br>通过使用<code>yum install XXXXX</code>命令安装，会自动搜索所有可用的软件源，并提示可用的软件包。</p>\n<h2 id=\"2-安装PHP7的rpm源\"><a href=\"#2-安装PHP7的rpm源\" class=\"headerlink\" title=\"2. 安装PHP7的rpm源\"></a>2. 安装PHP7的rpm源</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># rpm -Uvh https:&#x2F;&#x2F;mirror.webtatic.com&#x2F;yum&#x2F;el7&#x2F;webtatic-release.rpm</span><br><span class=\"line\">Retrieving https:&#x2F;&#x2F;mirror.webtatic.com&#x2F;yum&#x2F;el7&#x2F;webtatic-release.rpm</span><br><span class=\"line\">Preparing...                          ################################# [100%]</span><br><span class=\"line\">    package webtatic-release-7-3.noarch is already installed</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-安装PHP7\"><a href=\"#3-安装PHP7\" class=\"headerlink\" title=\"3. 安装PHP7\"></a>3. 安装PHP7</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install php71w</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-编译安装\"><a href=\"#4-编译安装\" class=\"headerlink\" title=\"4. 编译安装\"></a>4. 编译安装</h2><h3 id=\"1-下载PHP源码包\"><a href=\"#1-下载PHP源码包\" class=\"headerlink\" title=\"1. 下载PHP源码包\"></a>1. 下载PHP源码包</h3><p>从<a href=\"http://cn2.php.net/downloads.php\">这里</a>获取所需版本的PHP的下载地址。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># wget -O php7.tar.gz url&#x2F;get&#x2F;from&#x2F;last&#x2F;step</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-解压php7\"><a href=\"#2-解压php7\" class=\"headerlink\" title=\"2. 解压php7\"></a>2. 解压php7</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tar -xvf php7.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-进入php目录\"><a href=\"#3-进入php目录\" class=\"headerlink\" title=\"3. 进入php目录\"></a>3. 进入php目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd php-7.x.x</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-安装依赖包\"><a href=\"#4-安装依赖包\" class=\"headerlink\" title=\"4. 安装依赖包\"></a>4. 安装依赖包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\"><a href=\"#5-编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\" class=\"headerlink\" title=\"5. 编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\"></a>5. 编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）</h3><p>嫌麻烦的可以从这一步起参考<a href=\"http://php.net/manual/zh/install.unix.nginx.php\">PHP官方安装说明</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># .&#x2F;configure \\</span><br><span class=\"line\">--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;php \\</span><br><span class=\"line\">--with-config-file-path&#x3D;&#x2F;etc \\</span><br><span class=\"line\">--enable-fpm \\</span><br><span class=\"line\">--with-fpm-user&#x3D;nginx  \\</span><br><span class=\"line\">--with-fpm-group&#x3D;nginx \\</span><br><span class=\"line\">--enable-inline-optimization \\</span><br><span class=\"line\">--disable-debug \\</span><br><span class=\"line\">--disable-rpath \\</span><br><span class=\"line\">--enable-shared  \\</span><br><span class=\"line\">--enable-soap \\</span><br><span class=\"line\">--with-libxml-dir \\</span><br><span class=\"line\">--with-xmlrpc \\</span><br><span class=\"line\">--with-openssl \\</span><br><span class=\"line\">--with-mcrypt \\</span><br><span class=\"line\">--with-mhash \\</span><br><span class=\"line\">--with-pcre-regex \\</span><br><span class=\"line\">--with-sqlite3 \\</span><br><span class=\"line\">--with-zlib \\</span><br><span class=\"line\">--enable-bcmath \\</span><br><span class=\"line\">--with-iconv \\</span><br><span class=\"line\">--with-bz2 \\</span><br><span class=\"line\">--enable-calendar \\</span><br><span class=\"line\">--with-curl \\</span><br><span class=\"line\">--with-cdb \\</span><br><span class=\"line\">--enable-dom \\</span><br><span class=\"line\">--enable-exif \\</span><br><span class=\"line\">--enable-fileinfo \\</span><br><span class=\"line\">--enable-filter \\</span><br><span class=\"line\">--with-pcre-dir \\</span><br><span class=\"line\">--enable-ftp \\</span><br><span class=\"line\">--with-gd \\</span><br><span class=\"line\">--with-openssl-dir \\</span><br><span class=\"line\">--with-jpeg-dir \\</span><br><span class=\"line\">--with-png-dir \\</span><br><span class=\"line\">--with-zlib-dir  \\</span><br><span class=\"line\">--with-freetype-dir \\</span><br><span class=\"line\">--enable-gd-native-ttf \\</span><br><span class=\"line\">--enable-gd-jis-conv \\</span><br><span class=\"line\">--with-gettext \\</span><br><span class=\"line\">--with-gmp \\</span><br><span class=\"line\">--with-mhash \\</span><br><span class=\"line\">--enable-json \\</span><br><span class=\"line\">--enable-mbstring \\</span><br><span class=\"line\">--enable-mbregex \\</span><br><span class=\"line\">--enable-mbregex-backtrack \\</span><br><span class=\"line\">--with-libmbfl \\</span><br><span class=\"line\">--with-onig \\</span><br><span class=\"line\">--enable-pdo \\</span><br><span class=\"line\">--with-mysqli&#x3D;mysqlnd \\</span><br><span class=\"line\">--with-pdo-mysql&#x3D;mysqlnd \\</span><br><span class=\"line\">--with-zlib-dir \\</span><br><span class=\"line\">--with-pdo-sqlite \\</span><br><span class=\"line\">--with-readline \\</span><br><span class=\"line\">--enable-session \\</span><br><span class=\"line\">--enable-shmop \\</span><br><span class=\"line\">--enable-simplexml \\</span><br><span class=\"line\">--enable-sockets  \\</span><br><span class=\"line\">--enable-sysvmsg \\</span><br><span class=\"line\">--enable-sysvsem \\</span><br><span class=\"line\">--enable-sysvshm \\</span><br><span class=\"line\">--enable-wddx \\</span><br><span class=\"line\">--with-libxml-dir \\</span><br><span class=\"line\">--with-xsl \\</span><br><span class=\"line\">--enable-zip \\</span><br><span class=\"line\">--enable-mysqlnd-compression-support \\</span><br><span class=\"line\">--with-pear \\</span><br><span class=\"line\">--enable-opcache</span><br></pre></td></tr></table></figure>\n\n<p>这里可能会报很多错误，一个个解决即可。<a href=\"http://ask.apelearn.com/question/10761\">这里</a>有大部分的解决方法。</p>\n<p>列出几个常见的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checking for png_write_image in -lpng… yes If configure fails try –with-xpm-dir&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\">configure: error: freetype.h not found.</span><br><span class=\"line\">Fix: Reconfigure your PHP with the following option. --with-xpm-dir&#x3D;&#x2F;usr</span><br><span class=\"line\"></span><br><span class=\"line\">checking for png_write_image in -lpng… yes configure: error: libXpm.(a|so) not found.</span><br><span class=\"line\"></span><br><span class=\"line\">Fix: yum install libXpm-devel</span><br><span class=\"line\"></span><br><span class=\"line\">checking for bind_textdomain_codeset in -lc… yes checking for GNU MP support… yes configure: error: Unable to locate gmp.h</span><br><span class=\"line\"></span><br><span class=\"line\">Fix: yum install gmp-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-正式安装\"><a href=\"#6-正式安装\" class=\"headerlink\" title=\"6. 正式安装\"></a>6. 正式安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>没有报错就表示安装完成。</p>\n<h2 id=\"4-配置PHP\"><a href=\"#4-配置PHP\" class=\"headerlink\" title=\"4. 配置PHP\"></a>4. 配置PHP</h2><h3 id=\"1-配置环境变量\"><a href=\"#1-配置环境变量\" class=\"headerlink\" title=\"1. 配置环境变量\"></a>1. 配置环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n\n<p>在末尾追加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin</span><br><span class=\"line\">export PATH</span><br></pre></td></tr></table></figure>\n\n<p>执行命令使得改动立即生效</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置php-fpm\"><a href=\"#2-配置php-fpm\" class=\"headerlink\" title=\"2. 配置php-fpm\"></a>2. 配置php-fpm</h3><p>把所需的几个配置文件放到需要的位置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cp php.ini-production &#x2F;etc&#x2F;php.ini</span><br><span class=\"line\"># cp &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.conf.default &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.conf</span><br><span class=\"line\"># cp &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf.default &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br><span class=\"line\"># cp sapi&#x2F;fpm&#x2F;init.d.php-fpm &#x2F;etc&#x2F;init.d&#x2F;php-fpm</span><br><span class=\"line\"># chmod +x &#x2F;etc&#x2F;init.d&#x2F;php-fpm</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-启动php-fpm\"><a href=\"#3-启动php-fpm\" class=\"headerlink\" title=\"3. 启动php-fpm\"></a>3. 启动php-fpm</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#x2F;etc&#x2F;init.d&#x2F;php-fpm start</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-查看是否已正确安装\"><a href=\"#4-查看是否已正确安装\" class=\"headerlink\" title=\"4. 查看是否已正确安装\"></a>4. 查看是否已正确安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># php -v</span><br><span class=\"line\">PHP 7.1.4 (cli) (built: Apr 30 2017 11:20:19) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2017 The PHP Group</span><br><span class=\"line\">Zend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies</span><br><span class=\"line\"># which php</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin&#x2F;php</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-坑\"><a href=\"#5-坑\" class=\"headerlink\" title=\"5. 坑\"></a>5. 坑</h2><h3 id=\"1-Nginx-Error\"><a href=\"#1-Nginx-Error\" class=\"headerlink\" title=\"1. Nginx Error!\"></a>1. Nginx Error!</h3><p>The page you are looking for is temporarily unavailable. Please try again later.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">connect() to unix:&#x2F;var&#x2F;run&#x2F;php-fpm&#x2F;php-fpm.sock failed (2: No such file or directory) while connecting to upstream</span><br></pre></td></tr></table></figure>\n\n<p>参考<a href=\"https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/\">这里</a>的解决方案</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cp &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf.rpmsave &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br><span class=\"line\"># vi &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br><span class=\"line\">listen 改为</span><br><span class=\"line\">listen &#x3D; 127.0.0.1:9000;</span><br></pre></td></tr></table></figure>\n\n<p>nginx 配置文件也改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vi &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;yoursite.com.conf</span><br><span class=\"line\"></span><br><span class=\"line\">fastcgi_pass 127.0.0.1:9000;</span><br></pre></td></tr></table></figure>\n\n<p>重启php-fpm 和 nginx</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sudo &#x2F;etc&#x2F;init.d&#x2F;php-fpm restart</span><br><span class=\"line\"># sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>\n\n<p>上面是 TCP 的解决方案，另一种连接方式是通过 socket 套接字连接。<br>Nginx连接fastcgi的方式有2种：TCP和unix domain socket, 推荐使用php-fpm的UnixSocket的方式</p>\n<blockquote>\n<p>Socket 可以被定义描述为两个应用通信通道的端点。一个 Socket 端点可以用 Socket 地址来描述， Socket 地址结构由 IP 地址，端口和使用协议组成（ TCP or UDP ）。http协议可以通过socket实现，socket在传输层上实现。从这个角度来说，socket介于应用层和传输层之间。但是socket作为一种进程通信机制，操作系统分配唯一一个socket号，是依赖于通信协议的，但是这个通信协议不仅仅是 tcp或udp，也可以是其它协议。</p>\n</blockquote>\n<p>TCP是使用TCP端口连接127.0.0.1:9001<br>Socket是使用unix domain<br>socket连接套接字/dev/shm/php-cgi.sock（很多教程使用路径/tmp，而路径/dev/shm是个tmpfs，速度比磁盘快得多）</p>\n<p>理论上，unix socket不走网络，会快些，<br>可是，稳定性就不那么理想了，<br>另外放在/tmp目录不如放在内存里面<br>我一般放在 /dev/shm/php-fpm.sock<br>放在内存读取速度快更快的</p>\n<p>修改方法：</p>\n<p>php-fpm listen sock 模式</p>\n<h4 id=\"1-新建套接字文件\"><a href=\"#1-新建套接字文件\" class=\"headerlink\" title=\"1. 新建套接字文件\"></a>1. 新建套接字文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br><span class=\"line\">chmod 777 &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br><span class=\"line\"># 用户组和用户名查 nginx.conf 文件</span><br><span class=\"line\">chown nginx:nginx &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-nginx-配置\"><a href=\"#2-nginx-配置\" class=\"headerlink\" title=\"2. nginx 配置\"></a>2. nginx 配置</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location ~ \\.php$ &#123;</span><br><span class=\"line\">\t#fastcgi_pass 127.0.0.1:9001; </span><br><span class=\"line\">\tfastcgi_pass unix:&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock;</span><br><span class=\"line\">\tfastcgi_index index.php;</span><br><span class=\"line\">\t# 不要忘了这一行</span><br><span class=\"line\">\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class=\"line\">\tinclude fastcgi_params;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-php-fpm-conf\"><a href=\"#3-php-fpm-conf\" class=\"headerlink\" title=\"3. php fpm conf\"></a>3. php fpm conf</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim www.conf</span><br><span class=\"line\">;listen &#x3D; 127.0.0.1:9001</span><br><span class=\"line\">listen &#x3D; &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br><span class=\"line\">listen.owner &#x3D; nginx</span><br><span class=\"line\">listen.group &#x3D; nginx</span><br><span class=\"line\">listen.mode &#x3D; 0660</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-问题\"><a href=\"#4-问题\" class=\"headerlink\" title=\"4. 问题\"></a>4. 问题</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">connect() to unix:&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock failed (13: Permission denied) while connecting to upstream, </span><br><span class=\"line\">client: 192.168.121.130, server: localhost, request: &quot;GET &#x2F;index.php HTTP&#x2F;1.1&quot;, </span><br><span class=\"line\">upstream: &quot;fastcgi:&#x2F;&#x2F;unix:&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock:&quot;, host: &quot;192.168.121.130&quot; </span><br></pre></td></tr></table></figure>\n\n<p>确保：nginx: worker process 的用户是 nginx.conf 中的 user, Permission denied 不是一个用户导致</p>\n<h2 id=\"6-参考资料\"><a href=\"#6-参考资料\" class=\"headerlink\" title=\"6. 参考资料\"></a>6. 参考资料</h2><ol>\n<li><a href=\"http://idroot.net/tutorials/how-to-install-wget-on-centos/\">How To Install Wget on CentOS</a></li>\n<li><a href=\"http://blog.csdn.net/21aspnet/article/details/6581618\">CentOS怎样强制卸载PHP以及自定义安装PHP</a></li>\n<li><a href=\"http://www.jianshu.com/p/246ffcd5e77d\">CentOS7 安装 PHP7最新版</a></li>\n<li><a href=\"http://lyp.cn/350_how-to-fix-php-compile-errors\">PHP编译过程中常见错误信息的解决方法</a></li>\n<li><a href=\"http://ask.apelearn.com/question/10761\">PHP编译安装时常见错误解决办法，php编译常见错误</a></li>\n<li><a href=\"https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/\">PHP-FPM connect() to unix:/tmp/php5-fpm.sock failed (2: No such file or directory)</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-8d0e8340119e6d58.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>新买了台服务器，随便倒腾，记录一下。</p>\n</blockquote>","more":"<h2 id=\"1-安装-epel-release\"><a href=\"#1-安装-epel-release\" class=\"headerlink\" title=\"1. 安装 epel-release\"></a>1. 安装 epel-release</h2><h3 id=\"1-什么是epel\"><a href=\"#1-什么是epel\" class=\"headerlink\" title=\"1. 什么是epel\"></a>1. 什么是epel</h3><p>如果既想获得 RHEL 的高质量、高性能、高可靠性，又需要方便易用(关键是免费)的软件包更新功能，那么 Fedora Project 推出的 EPEL(Extra Packages for Enterprise Linux)正好适合你。</p>\n<p><a href=\"http://fedoraproject.org/wiki/EPEL\">EPEL</a> 是由 Fedora 社区打造，为 RHEL 及衍生发行版如 CentOS、Scientific Linux 等提供高质量软件包的项目。</p>\n<h3 id=\"2-使用心得\"><a href=\"#2-使用心得\" class=\"headerlink\" title=\"2. 使用心得\"></a>2. 使用心得</h3><ol>\n<li>不用去换原来yum源，安装后会产生新repo</li>\n<li>epel会有很多源地址，如果一个下不到，会去另外一个下</li>\n</ol>\n<h3 id=\"3-安装方法\"><a href=\"#3-安装方法\" class=\"headerlink\" title=\"3. 安装方法\"></a>3. 安装方法</h3><h4 id=\"1-搜索EPEL相关的软件包\"><a href=\"#1-搜索EPEL相关的软件包\" class=\"headerlink\" title=\"1. 搜索EPEL相关的软件包\"></a>1. 搜索EPEL相关的软件包</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum search epel</span><br><span class=\"line\">Loaded plugins: fastestmirror</span><br><span class=\"line\">Repository base is listed more than once in the configuration</span><br><span class=\"line\">Repository updates is listed more than once in the configuration</span><br><span class=\"line\">Repository extras is listed more than once in the configuration</span><br><span class=\"line\">Repository epel is listed more than once in the configuration</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\"> * base: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * epel: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * extras: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * updates: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * webtatic: us-east.repo.webtatic.com</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; N&#x2F;S matched: epel &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">epel-release.noarch : Extra Packages for Enterprise Linux repository configuration</span><br><span class=\"line\">epel-rpm-macros.noarch : Extra Packages for Enterprise Linux RPM macros</span><br><span class=\"line\">python3-pkgversion-macros.noarch : Convenience macros for Fedora&#x2F;EPEL Python 3</span><br><span class=\"line\">                                 : packages building</span><br><span class=\"line\"></span><br><span class=\"line\">  Name and summary matches only, use &quot;search all&quot; for everything.</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-安装EPEL软件包\"><a href=\"#2-安装EPEL软件包\" class=\"headerlink\" title=\"2. 安装EPEL软件包\"></a>2. 安装EPEL软件包</h4><p>通过yum搜索的结果中epel-release.noarch就是我们需要的软件包。</p>\n<p>安装可以不用包含软件包名称中点“.”后面的部分，当然包含也没有问题。点“.”后面的部分只是提供软件包适应系统架构。noarch为通用型，还有x86_64为64位的系统，i686为32位系统使用。</p>\n<p>通过下面命令进行安装。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install epel-release</span><br><span class=\"line\">Loaded plugins: fastestmirror</span><br><span class=\"line\">Repository base is listed more than once in the configuration</span><br><span class=\"line\">Repository updates is listed more than once in the configuration</span><br><span class=\"line\">Repository extras is listed more than once in the configuration</span><br><span class=\"line\">Repository epel is listed more than once in the configuration</span><br><span class=\"line\">Loading mirror speeds from cached hostfile</span><br><span class=\"line\"> * base: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * epel: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * extras: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * updates: mirrors.cloud.aliyuncs.com</span><br><span class=\"line\"> * webtatic: uk.repo.webtatic.com</span><br><span class=\"line\">Package epel-release-7-9.noarch already installed and latest version</span><br><span class=\"line\">Nothing to do</span><br></pre></td></tr></table></figure>\n\n<p>想知道epel-release这个包包含哪些内容，就使用rpm命令查询列出。-q 表示查询，-l 标识列出软件包的所包含的文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># rpm -ql epel-release</span><br><span class=\"line\">&#x2F;etc&#x2F;pki&#x2F;rpm-gpg&#x2F;RPM-GPG-KEY-EPEL-7</span><br><span class=\"line\">&#x2F;etc&#x2F;yum.repos.d&#x2F;epel-testing.repo</span><br><span class=\"line\">&#x2F;etc&#x2F;yum.repos.d&#x2F;epel.repo</span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system-preset&#x2F;90-epel.preset</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;epel-release-7</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;epel-release-7&#x2F;GPL</span><br></pre></td></tr></table></figure>\n\n<p>可以看出最主要的就是/etc/yum.repos.d/epel.repo这个文件了，默认已经启用。不确定的话可以用vi等命令查看编辑。</p>\n<p><code>enabled=1</code>说明已经启用</p>\n<p>启用之后就可安装EPEL源中提供的软件了。<br>通过使用<code>yum install XXXXX</code>命令安装，会自动搜索所有可用的软件源，并提示可用的软件包。</p>\n<h2 id=\"2-安装PHP7的rpm源\"><a href=\"#2-安装PHP7的rpm源\" class=\"headerlink\" title=\"2. 安装PHP7的rpm源\"></a>2. 安装PHP7的rpm源</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># rpm -Uvh https:&#x2F;&#x2F;mirror.webtatic.com&#x2F;yum&#x2F;el7&#x2F;webtatic-release.rpm</span><br><span class=\"line\">Retrieving https:&#x2F;&#x2F;mirror.webtatic.com&#x2F;yum&#x2F;el7&#x2F;webtatic-release.rpm</span><br><span class=\"line\">Preparing...                          ################################# [100%]</span><br><span class=\"line\">    package webtatic-release-7-3.noarch is already installed</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-安装PHP7\"><a href=\"#3-安装PHP7\" class=\"headerlink\" title=\"3. 安装PHP7\"></a>3. 安装PHP7</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install php71w</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-编译安装\"><a href=\"#4-编译安装\" class=\"headerlink\" title=\"4. 编译安装\"></a>4. 编译安装</h2><h3 id=\"1-下载PHP源码包\"><a href=\"#1-下载PHP源码包\" class=\"headerlink\" title=\"1. 下载PHP源码包\"></a>1. 下载PHP源码包</h3><p>从<a href=\"http://cn2.php.net/downloads.php\">这里</a>获取所需版本的PHP的下载地址。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># wget -O php7.tar.gz url&#x2F;get&#x2F;from&#x2F;last&#x2F;step</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-解压php7\"><a href=\"#2-解压php7\" class=\"headerlink\" title=\"2. 解压php7\"></a>2. 解压php7</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># tar -xvf php7.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-进入php目录\"><a href=\"#3-进入php目录\" class=\"headerlink\" title=\"3. 进入php目录\"></a>3. 进入php目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd php-7.x.x</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-安装依赖包\"><a href=\"#4-安装依赖包\" class=\"headerlink\" title=\"4. 安装依赖包\"></a>4. 安装依赖包</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install libxml2 libxml2-devel openssl openssl-devel bzip2 bzip2-devel libcurl libcurl-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel gmp gmp-devel libmcrypt libmcrypt-devel readline readline-devel libxslt libxslt-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\"><a href=\"#5-编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\" class=\"headerlink\" title=\"5. 编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）\"></a>5. 编译配置（如果出现错误，基本都是上一步的依赖文件没有安装所致）</h3><p>嫌麻烦的可以从这一步起参考<a href=\"http://php.net/manual/zh/install.unix.nginx.php\">PHP官方安装说明</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># .&#x2F;configure \\</span><br><span class=\"line\">--prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;php \\</span><br><span class=\"line\">--with-config-file-path&#x3D;&#x2F;etc \\</span><br><span class=\"line\">--enable-fpm \\</span><br><span class=\"line\">--with-fpm-user&#x3D;nginx  \\</span><br><span class=\"line\">--with-fpm-group&#x3D;nginx \\</span><br><span class=\"line\">--enable-inline-optimization \\</span><br><span class=\"line\">--disable-debug \\</span><br><span class=\"line\">--disable-rpath \\</span><br><span class=\"line\">--enable-shared  \\</span><br><span class=\"line\">--enable-soap \\</span><br><span class=\"line\">--with-libxml-dir \\</span><br><span class=\"line\">--with-xmlrpc \\</span><br><span class=\"line\">--with-openssl \\</span><br><span class=\"line\">--with-mcrypt \\</span><br><span class=\"line\">--with-mhash \\</span><br><span class=\"line\">--with-pcre-regex \\</span><br><span class=\"line\">--with-sqlite3 \\</span><br><span class=\"line\">--with-zlib \\</span><br><span class=\"line\">--enable-bcmath \\</span><br><span class=\"line\">--with-iconv \\</span><br><span class=\"line\">--with-bz2 \\</span><br><span class=\"line\">--enable-calendar \\</span><br><span class=\"line\">--with-curl \\</span><br><span class=\"line\">--with-cdb \\</span><br><span class=\"line\">--enable-dom \\</span><br><span class=\"line\">--enable-exif \\</span><br><span class=\"line\">--enable-fileinfo \\</span><br><span class=\"line\">--enable-filter \\</span><br><span class=\"line\">--with-pcre-dir \\</span><br><span class=\"line\">--enable-ftp \\</span><br><span class=\"line\">--with-gd \\</span><br><span class=\"line\">--with-openssl-dir \\</span><br><span class=\"line\">--with-jpeg-dir \\</span><br><span class=\"line\">--with-png-dir \\</span><br><span class=\"line\">--with-zlib-dir  \\</span><br><span class=\"line\">--with-freetype-dir \\</span><br><span class=\"line\">--enable-gd-native-ttf \\</span><br><span class=\"line\">--enable-gd-jis-conv \\</span><br><span class=\"line\">--with-gettext \\</span><br><span class=\"line\">--with-gmp \\</span><br><span class=\"line\">--with-mhash \\</span><br><span class=\"line\">--enable-json \\</span><br><span class=\"line\">--enable-mbstring \\</span><br><span class=\"line\">--enable-mbregex \\</span><br><span class=\"line\">--enable-mbregex-backtrack \\</span><br><span class=\"line\">--with-libmbfl \\</span><br><span class=\"line\">--with-onig \\</span><br><span class=\"line\">--enable-pdo \\</span><br><span class=\"line\">--with-mysqli&#x3D;mysqlnd \\</span><br><span class=\"line\">--with-pdo-mysql&#x3D;mysqlnd \\</span><br><span class=\"line\">--with-zlib-dir \\</span><br><span class=\"line\">--with-pdo-sqlite \\</span><br><span class=\"line\">--with-readline \\</span><br><span class=\"line\">--enable-session \\</span><br><span class=\"line\">--enable-shmop \\</span><br><span class=\"line\">--enable-simplexml \\</span><br><span class=\"line\">--enable-sockets  \\</span><br><span class=\"line\">--enable-sysvmsg \\</span><br><span class=\"line\">--enable-sysvsem \\</span><br><span class=\"line\">--enable-sysvshm \\</span><br><span class=\"line\">--enable-wddx \\</span><br><span class=\"line\">--with-libxml-dir \\</span><br><span class=\"line\">--with-xsl \\</span><br><span class=\"line\">--enable-zip \\</span><br><span class=\"line\">--enable-mysqlnd-compression-support \\</span><br><span class=\"line\">--with-pear \\</span><br><span class=\"line\">--enable-opcache</span><br></pre></td></tr></table></figure>\n\n<p>这里可能会报很多错误，一个个解决即可。<a href=\"http://ask.apelearn.com/question/10761\">这里</a>有大部分的解决方法。</p>\n<p>列出几个常见的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">checking for png_write_image in -lpng… yes If configure fails try –with-xpm-dir&#x3D;</span><br><span class=\"line\"></span><br><span class=\"line\">configure: error: freetype.h not found.</span><br><span class=\"line\">Fix: Reconfigure your PHP with the following option. --with-xpm-dir&#x3D;&#x2F;usr</span><br><span class=\"line\"></span><br><span class=\"line\">checking for png_write_image in -lpng… yes configure: error: libXpm.(a|so) not found.</span><br><span class=\"line\"></span><br><span class=\"line\">Fix: yum install libXpm-devel</span><br><span class=\"line\"></span><br><span class=\"line\">checking for bind_textdomain_codeset in -lc… yes checking for GNU MP support… yes configure: error: Unable to locate gmp.h</span><br><span class=\"line\"></span><br><span class=\"line\">Fix: yum install gmp-devel</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-正式安装\"><a href=\"#6-正式安装\" class=\"headerlink\" title=\"6. 正式安装\"></a>6. 正式安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># make &amp;&amp; make install</span><br></pre></td></tr></table></figure>\n\n<p>没有报错就表示安装完成。</p>\n<h2 id=\"4-配置PHP\"><a href=\"#4-配置PHP\" class=\"headerlink\" title=\"4. 配置PHP\"></a>4. 配置PHP</h2><h3 id=\"1-配置环境变量\"><a href=\"#1-配置环境变量\" class=\"headerlink\" title=\"1. 配置环境变量\"></a>1. 配置环境变量</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vi &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n\n<p>在末尾追加</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin</span><br><span class=\"line\">export PATH</span><br></pre></td></tr></table></figure>\n\n<p>执行命令使得改动立即生效</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># source &#x2F;etc&#x2F;profile</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置php-fpm\"><a href=\"#2-配置php-fpm\" class=\"headerlink\" title=\"2. 配置php-fpm\"></a>2. 配置php-fpm</h3><p>把所需的几个配置文件放到需要的位置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cp php.ini-production &#x2F;etc&#x2F;php.ini</span><br><span class=\"line\"># cp &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.conf.default &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.conf</span><br><span class=\"line\"># cp &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf.default &#x2F;usr&#x2F;local&#x2F;php&#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br><span class=\"line\"># cp sapi&#x2F;fpm&#x2F;init.d.php-fpm &#x2F;etc&#x2F;init.d&#x2F;php-fpm</span><br><span class=\"line\"># chmod +x &#x2F;etc&#x2F;init.d&#x2F;php-fpm</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-启动php-fpm\"><a href=\"#3-启动php-fpm\" class=\"headerlink\" title=\"3. 启动php-fpm\"></a>3. 启动php-fpm</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># &#x2F;etc&#x2F;init.d&#x2F;php-fpm start</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-查看是否已正确安装\"><a href=\"#4-查看是否已正确安装\" class=\"headerlink\" title=\"4. 查看是否已正确安装\"></a>4. 查看是否已正确安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># php -v</span><br><span class=\"line\">PHP 7.1.4 (cli) (built: Apr 30 2017 11:20:19) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2017 The PHP Group</span><br><span class=\"line\">Zend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies</span><br><span class=\"line\"># which php</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin&#x2F;php</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-坑\"><a href=\"#5-坑\" class=\"headerlink\" title=\"5. 坑\"></a>5. 坑</h2><h3 id=\"1-Nginx-Error\"><a href=\"#1-Nginx-Error\" class=\"headerlink\" title=\"1. Nginx Error!\"></a>1. Nginx Error!</h3><p>The page you are looking for is temporarily unavailable. Please try again later.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">connect() to unix:&#x2F;var&#x2F;run&#x2F;php-fpm&#x2F;php-fpm.sock failed (2: No such file or directory) while connecting to upstream</span><br></pre></td></tr></table></figure>\n\n<p>参考<a href=\"https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/\">这里</a>的解决方案</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cp &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf.rpmsave &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br><span class=\"line\"># vi &#x2F;etc&#x2F;php-fpm.d&#x2F;www.conf</span><br><span class=\"line\">listen 改为</span><br><span class=\"line\">listen &#x3D; 127.0.0.1:9000;</span><br></pre></td></tr></table></figure>\n\n<p>nginx 配置文件也改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># vi &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;yoursite.com.conf</span><br><span class=\"line\"></span><br><span class=\"line\">fastcgi_pass 127.0.0.1:9000;</span><br></pre></td></tr></table></figure>\n\n<p>重启php-fpm 和 nginx</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sudo &#x2F;etc&#x2F;init.d&#x2F;php-fpm restart</span><br><span class=\"line\"># sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>\n\n<p>上面是 TCP 的解决方案，另一种连接方式是通过 socket 套接字连接。<br>Nginx连接fastcgi的方式有2种：TCP和unix domain socket, 推荐使用php-fpm的UnixSocket的方式</p>\n<blockquote>\n<p>Socket 可以被定义描述为两个应用通信通道的端点。一个 Socket 端点可以用 Socket 地址来描述， Socket 地址结构由 IP 地址，端口和使用协议组成（ TCP or UDP ）。http协议可以通过socket实现，socket在传输层上实现。从这个角度来说，socket介于应用层和传输层之间。但是socket作为一种进程通信机制，操作系统分配唯一一个socket号，是依赖于通信协议的，但是这个通信协议不仅仅是 tcp或udp，也可以是其它协议。</p>\n</blockquote>\n<p>TCP是使用TCP端口连接127.0.0.1:9001<br>Socket是使用unix domain<br>socket连接套接字/dev/shm/php-cgi.sock（很多教程使用路径/tmp，而路径/dev/shm是个tmpfs，速度比磁盘快得多）</p>\n<p>理论上，unix socket不走网络，会快些，<br>可是，稳定性就不那么理想了，<br>另外放在/tmp目录不如放在内存里面<br>我一般放在 /dev/shm/php-fpm.sock<br>放在内存读取速度快更快的</p>\n<p>修改方法：</p>\n<p>php-fpm listen sock 模式</p>\n<h4 id=\"1-新建套接字文件\"><a href=\"#1-新建套接字文件\" class=\"headerlink\" title=\"1. 新建套接字文件\"></a>1. 新建套接字文件</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br><span class=\"line\">chmod 777 &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br><span class=\"line\"># 用户组和用户名查 nginx.conf 文件</span><br><span class=\"line\">chown nginx:nginx &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-nginx-配置\"><a href=\"#2-nginx-配置\" class=\"headerlink\" title=\"2. nginx 配置\"></a>2. nginx 配置</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">location ~ \\.php$ &#123;</span><br><span class=\"line\">\t#fastcgi_pass 127.0.0.1:9001; </span><br><span class=\"line\">\tfastcgi_pass unix:&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock;</span><br><span class=\"line\">\tfastcgi_index index.php;</span><br><span class=\"line\">\t# 不要忘了这一行</span><br><span class=\"line\">\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class=\"line\">\tinclude fastcgi_params;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-php-fpm-conf\"><a href=\"#3-php-fpm-conf\" class=\"headerlink\" title=\"3. php fpm conf\"></a>3. php fpm conf</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim www.conf</span><br><span class=\"line\">;listen &#x3D; 127.0.0.1:9001</span><br><span class=\"line\">listen &#x3D; &#x2F;dev&#x2F;shm&#x2F;php-fpm.sock</span><br><span class=\"line\">listen.owner &#x3D; nginx</span><br><span class=\"line\">listen.group &#x3D; nginx</span><br><span class=\"line\">listen.mode &#x3D; 0660</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-问题\"><a href=\"#4-问题\" class=\"headerlink\" title=\"4. 问题\"></a>4. 问题</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">connect() to unix:&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock failed (13: Permission denied) while connecting to upstream, </span><br><span class=\"line\">client: 192.168.121.130, server: localhost, request: &quot;GET &#x2F;index.php HTTP&#x2F;1.1&quot;, </span><br><span class=\"line\">upstream: &quot;fastcgi:&#x2F;&#x2F;unix:&#x2F;dev&#x2F;shm&#x2F;php-fpm.sock:&quot;, host: &quot;192.168.121.130&quot; </span><br></pre></td></tr></table></figure>\n\n<p>确保：nginx: worker process 的用户是 nginx.conf 中的 user, Permission denied 不是一个用户导致</p>\n<h2 id=\"6-参考资料\"><a href=\"#6-参考资料\" class=\"headerlink\" title=\"6. 参考资料\"></a>6. 参考资料</h2><ol>\n<li><a href=\"http://idroot.net/tutorials/how-to-install-wget-on-centos/\">How To Install Wget on CentOS</a></li>\n<li><a href=\"http://blog.csdn.net/21aspnet/article/details/6581618\">CentOS怎样强制卸载PHP以及自定义安装PHP</a></li>\n<li><a href=\"http://www.jianshu.com/p/246ffcd5e77d\">CentOS7 安装 PHP7最新版</a></li>\n<li><a href=\"http://lyp.cn/350_how-to-fix-php-compile-errors\">PHP编译过程中常见错误信息的解决方法</a></li>\n<li><a href=\"http://ask.apelearn.com/question/10761\">PHP编译安装时常见错误解决办法，php编译常见错误</a></li>\n<li><a href=\"https://www.scalescale.com/tips/nginx/php-fpm-connect-to-unixtmpphp5-fpm-sock-failed-2-no-such-file-or-directory/\">PHP-FPM connect() to unix:/tmp/php5-fpm.sock failed (2: No such file or directory)</a></li>\n</ol>"},{"title":"git 的几个小问题","date":"2017-04-10T16:00:00.000Z","_content":"## 1. `git blame` 指定行或范围\n\n\n```\n$ git blame filename -L150,+11\n```\n\n\n这里 `-L150,11` 表示“只看150-160行”。\n\n<!-- more -->\n\n## 2. `git cherry-pick` 合并某一次提交到另一分支\n\n经常地，在错误的分支里进行了想要的提交，这时需要将本次提交合并到正确的分支。\n\n```\n$ git checkout 目标分支名\n$ git cherry-pick 想要合并的提交\n```\n\n\n\n","source":"_posts/git 的几个小问题.md","raw":"---\ntitle: git 的几个小问题\ndate: 2017-04-11\ntags: git\n---\n## 1. `git blame` 指定行或范围\n\n\n```\n$ git blame filename -L150,+11\n```\n\n\n这里 `-L150,11` 表示“只看150-160行”。\n\n<!-- more -->\n\n## 2. `git cherry-pick` 合并某一次提交到另一分支\n\n经常地，在错误的分支里进行了想要的提交，这时需要将本次提交合并到正确的分支。\n\n```\n$ git checkout 目标分支名\n$ git cherry-pick 想要合并的提交\n```\n\n\n\n","slug":"git 的几个小问题","published":1,"updated":"2020-09-11T01:04:35.041Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8u001t6wo14e2g2hhn","content":"<h2 id=\"1-git-blame-指定行或范围\"><a href=\"#1-git-blame-指定行或范围\" class=\"headerlink\" title=\"1. git blame 指定行或范围\"></a>1. <code>git blame</code> 指定行或范围</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git blame filename -L150,+11</span><br></pre></td></tr></table></figure>\n\n\n<p>这里 <code>-L150,11</code> 表示“只看150-160行”。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"2-git-cherry-pick-合并某一次提交到另一分支\"><a href=\"#2-git-cherry-pick-合并某一次提交到另一分支\" class=\"headerlink\" title=\"2. git cherry-pick 合并某一次提交到另一分支\"></a>2. <code>git cherry-pick</code> 合并某一次提交到另一分支</h2><p>经常地，在错误的分支里进行了想要的提交，这时需要将本次提交合并到正确的分支。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout 目标分支名</span><br><span class=\"line\">$ git cherry-pick 想要合并的提交</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"<h2 id=\"1-git-blame-指定行或范围\"><a href=\"#1-git-blame-指定行或范围\" class=\"headerlink\" title=\"1. git blame 指定行或范围\"></a>1. <code>git blame</code> 指定行或范围</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git blame filename -L150,+11</span><br></pre></td></tr></table></figure>\n\n\n<p>这里 <code>-L150,11</code> 表示“只看150-160行”。</p>","more":"<h2 id=\"2-git-cherry-pick-合并某一次提交到另一分支\"><a href=\"#2-git-cherry-pick-合并某一次提交到另一分支\" class=\"headerlink\" title=\"2. git cherry-pick 合并某一次提交到另一分支\"></a>2. <code>git cherry-pick</code> 合并某一次提交到另一分支</h2><p>经常地，在错误的分支里进行了想要的提交，这时需要将本次提交合并到正确的分支。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git checkout 目标分支名</span><br><span class=\"line\">$ git cherry-pick 想要合并的提交</span><br></pre></td></tr></table></figure>"},{"title":"hexo 搭建个人博客的学习记录-Git 自动部署代码到服务器","date":"2017-04-17T16:00:00.000Z","description":"这个世界是由懒人驱动的。PS, 参考这类技术文章还是要找原文，国内的翻译，不说了。","_content":"\n<style>\n  .img {\n    width: 60%;\n    text-align: center;\n  }\n</style>\n\n<div class='img'>\n![](http://omp48p40q.bkt.clouddn.com/17-5-7/51656771-file_1494155724132_a08a.png)\n</div>\n\n\n> 这个世界是由懒人驱动的。 PS: 参考这类技术文章还是要找原文，国内的翻译，不说了。\n\n<!-- more -->\n\n\n之前常用的部署代码就是用svn，或是更老土的ftp。每次的git pull实在是一个让人烦躁的东西，就网上查找了一下，发现git-hook 是个好东西。[参考原文](http://toroid.org/git-website-howto)\n\n\n实现原理是当我们push 代码到`remote repository`时，通过git的`post-receive hooks`。执行\n`git checkout prod -f`\n来帮助我们实现自动部署。\n\n## 1. 在**本地**创建一个`git repository`\n\n```\n$ mkdir test && cd test\n$ git init \n$ echo 'Hello, world!' > index.html\n$ git add index.html\n$ git commit -q -m \"init\"\n```\n\n`index.html` 就是我们希望能够部署到服务器的代码\n\n## 2. 然后在**服务**器创建一个`repository`\n\n要注意，服务器要设置两个目录，一个是 git 目录，一个是代码目录。服务器的git目录和本地的代码目的都要指向服务器的代码目录。\n\n这里可不是服务器部署代码的位置\n\n```\n$ mkdir test.git && cd test.git\n$ git init --bare\n$ cat > hooks/post-receive\n#!/bin/sh\nGIT_WORK_TREE=/dir/to/your/webpage/root git checkout -f\n\n#!/bin/sh\nGIT_WORK_TREE=/root/www/test git checkout  -f  // 这个是我的网站路径，这就是服务器git目录指向服务器代码目录的方式\n$ chmod +x hooks/post-receive\n```\n\n这是服务器的git代码目录\n\n```\n/dir/to/test.git\n```\n\n这里的 `/root/www/test` 就是我将要部署服务器代码的位置，一般的lamp，我们喜欢放在www里，当然这里需要根据不同的环境更换就好了。\n\n## 3. 在本地的git目录下增加一个remote\n\n```\n$ git remote add web ssh://root@47.93.234.60:/root/www/test.git\n$ git push web +master:refs/heads/master\n```\n\nserver_address 可以是 ip，域名。\n\n也可以使用 SourceTree 来实现上面两个步骤。\n\n这时我们切换到服务器目录下，就可以看到我们的`index.html` 在我们向`web push`的之后，已经自动`check out` 到我们指定目录下了。\n\n之后我们只需要修改完成之后，`git push web` 就可以自动部署代码了。\n\nSourceTree\n\n1. New Repository -> add Existing Local Repository -> 选中本地代码目录\n2. 更改文件后添加并push即可。 \n\n\n我的做法是把 hexo 的 public 目录作为本地代码目录，编译生成静态文件后通过git上传到服务器代码目录，然后nginx将站点指向服务器代码目录即可。服务器上不需要配置hexo，只保留静态文件即可。\n\n在本地写markdown文件并调试好再上传。\n\n最后还是决定同步整个 hexo 文件夹。本地和服务器都可以做更改。但在服务器上做的更改需要注意，可能会被本地的更改冲掉。所以尽量在本地做更改。\n\n","source":"_posts/hexo 搭建个人博客的学习记录-Git 自动部署代码到服务器.md","raw":"---\ntitle: hexo 搭建个人博客的学习记录-Git 自动部署代码到服务器\ndate: 2017-04-18\ntags: git\ndescription: 这个世界是由懒人驱动的。PS, 参考这类技术文章还是要找原文，国内的翻译，不说了。\n---\n\n<style>\n  .img {\n    width: 60%;\n    text-align: center;\n  }\n</style>\n\n<div class='img'>\n![](http://omp48p40q.bkt.clouddn.com/17-5-7/51656771-file_1494155724132_a08a.png)\n</div>\n\n\n> 这个世界是由懒人驱动的。 PS: 参考这类技术文章还是要找原文，国内的翻译，不说了。\n\n<!-- more -->\n\n\n之前常用的部署代码就是用svn，或是更老土的ftp。每次的git pull实在是一个让人烦躁的东西，就网上查找了一下，发现git-hook 是个好东西。[参考原文](http://toroid.org/git-website-howto)\n\n\n实现原理是当我们push 代码到`remote repository`时，通过git的`post-receive hooks`。执行\n`git checkout prod -f`\n来帮助我们实现自动部署。\n\n## 1. 在**本地**创建一个`git repository`\n\n```\n$ mkdir test && cd test\n$ git init \n$ echo 'Hello, world!' > index.html\n$ git add index.html\n$ git commit -q -m \"init\"\n```\n\n`index.html` 就是我们希望能够部署到服务器的代码\n\n## 2. 然后在**服务**器创建一个`repository`\n\n要注意，服务器要设置两个目录，一个是 git 目录，一个是代码目录。服务器的git目录和本地的代码目的都要指向服务器的代码目录。\n\n这里可不是服务器部署代码的位置\n\n```\n$ mkdir test.git && cd test.git\n$ git init --bare\n$ cat > hooks/post-receive\n#!/bin/sh\nGIT_WORK_TREE=/dir/to/your/webpage/root git checkout -f\n\n#!/bin/sh\nGIT_WORK_TREE=/root/www/test git checkout  -f  // 这个是我的网站路径，这就是服务器git目录指向服务器代码目录的方式\n$ chmod +x hooks/post-receive\n```\n\n这是服务器的git代码目录\n\n```\n/dir/to/test.git\n```\n\n这里的 `/root/www/test` 就是我将要部署服务器代码的位置，一般的lamp，我们喜欢放在www里，当然这里需要根据不同的环境更换就好了。\n\n## 3. 在本地的git目录下增加一个remote\n\n```\n$ git remote add web ssh://root@47.93.234.60:/root/www/test.git\n$ git push web +master:refs/heads/master\n```\n\nserver_address 可以是 ip，域名。\n\n也可以使用 SourceTree 来实现上面两个步骤。\n\n这时我们切换到服务器目录下，就可以看到我们的`index.html` 在我们向`web push`的之后，已经自动`check out` 到我们指定目录下了。\n\n之后我们只需要修改完成之后，`git push web` 就可以自动部署代码了。\n\nSourceTree\n\n1. New Repository -> add Existing Local Repository -> 选中本地代码目录\n2. 更改文件后添加并push即可。 \n\n\n我的做法是把 hexo 的 public 目录作为本地代码目录，编译生成静态文件后通过git上传到服务器代码目录，然后nginx将站点指向服务器代码目录即可。服务器上不需要配置hexo，只保留静态文件即可。\n\n在本地写markdown文件并调试好再上传。\n\n最后还是决定同步整个 hexo 文件夹。本地和服务器都可以做更改。但在服务器上做的更改需要注意，可能会被本地的更改冲掉。所以尽量在本地做更改。\n\n","slug":"hexo 搭建个人博客的学习记录-Git 自动部署代码到服务器","published":1,"updated":"2020-09-11T01:04:35.041Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8w001v6wo18a2qd0fw","content":"<style>\n  .img {\n    width: 60%;\n    text-align: center;\n  }\n</style>\n\n<div class='img'>\n![](http://omp48p40q.bkt.clouddn.com/17-5-7/51656771-file_1494155724132_a08a.png)\n</div>\n\n\n<blockquote>\n<p>这个世界是由懒人驱动的。 PS: 参考这类技术文章还是要找原文，国内的翻译，不说了。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n\n<p>之前常用的部署代码就是用svn，或是更老土的ftp。每次的git pull实在是一个让人烦躁的东西，就网上查找了一下，发现git-hook 是个好东西。<a href=\"http://toroid.org/git-website-howto\">参考原文</a></p>\n<p>实现原理是当我们push 代码到<code>remote repository</code>时，通过git的<code>post-receive hooks</code>。执行<br><code>git checkout prod -f</code><br>来帮助我们实现自动部署。</p>\n<h2 id=\"1-在本地创建一个git-repository\"><a href=\"#1-在本地创建一个git-repository\" class=\"headerlink\" title=\"1. 在本地创建一个git repository\"></a>1. 在<strong>本地</strong>创建一个<code>git repository</code></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mkdir test &amp;&amp; cd test</span><br><span class=\"line\">$ git init </span><br><span class=\"line\">$ echo &#39;Hello, world!&#39; &gt; index.html</span><br><span class=\"line\">$ git add index.html</span><br><span class=\"line\">$ git commit -q -m &quot;init&quot;</span><br></pre></td></tr></table></figure>\n\n<p><code>index.html</code> 就是我们希望能够部署到服务器的代码</p>\n<h2 id=\"2-然后在服务器创建一个repository\"><a href=\"#2-然后在服务器创建一个repository\" class=\"headerlink\" title=\"2. 然后在服务器创建一个repository\"></a>2. 然后在<strong>服务</strong>器创建一个<code>repository</code></h2><p>要注意，服务器要设置两个目录，一个是 git 目录，一个是代码目录。服务器的git目录和本地的代码目的都要指向服务器的代码目录。</p>\n<p>这里可不是服务器部署代码的位置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mkdir test.git &amp;&amp; cd test.git</span><br><span class=\"line\">$ git init --bare</span><br><span class=\"line\">$ cat &gt; hooks&#x2F;post-receive</span><br><span class=\"line\">#!&#x2F;bin&#x2F;sh</span><br><span class=\"line\">GIT_WORK_TREE&#x3D;&#x2F;dir&#x2F;to&#x2F;your&#x2F;webpage&#x2F;root git checkout -f</span><br><span class=\"line\"></span><br><span class=\"line\">#!&#x2F;bin&#x2F;sh</span><br><span class=\"line\">GIT_WORK_TREE&#x3D;&#x2F;root&#x2F;www&#x2F;test git checkout  -f  &#x2F;&#x2F; 这个是我的网站路径，这就是服务器git目录指向服务器代码目录的方式</span><br><span class=\"line\">$ chmod +x hooks&#x2F;post-receive</span><br></pre></td></tr></table></figure>\n\n<p>这是服务器的git代码目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;dir&#x2F;to&#x2F;test.git</span><br></pre></td></tr></table></figure>\n\n<p>这里的 <code>/root/www/test</code> 就是我将要部署服务器代码的位置，一般的lamp，我们喜欢放在www里，当然这里需要根据不同的环境更换就好了。</p>\n<h2 id=\"3-在本地的git目录下增加一个remote\"><a href=\"#3-在本地的git目录下增加一个remote\" class=\"headerlink\" title=\"3. 在本地的git目录下增加一个remote\"></a>3. 在本地的git目录下增加一个remote</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote add web ssh:&#x2F;&#x2F;root@47.93.234.60:&#x2F;root&#x2F;www&#x2F;test.git</span><br><span class=\"line\">$ git push web +master:refs&#x2F;heads&#x2F;master</span><br></pre></td></tr></table></figure>\n\n<p>server_address 可以是 ip，域名。</p>\n<p>也可以使用 SourceTree 来实现上面两个步骤。</p>\n<p>这时我们切换到服务器目录下，就可以看到我们的<code>index.html</code> 在我们向<code>web push</code>的之后，已经自动<code>check out</code> 到我们指定目录下了。</p>\n<p>之后我们只需要修改完成之后，<code>git push web</code> 就可以自动部署代码了。</p>\n<p>SourceTree</p>\n<ol>\n<li>New Repository -&gt; add Existing Local Repository -&gt; 选中本地代码目录</li>\n<li>更改文件后添加并push即可。 </li>\n</ol>\n<p>我的做法是把 hexo 的 public 目录作为本地代码目录，编译生成静态文件后通过git上传到服务器代码目录，然后nginx将站点指向服务器代码目录即可。服务器上不需要配置hexo，只保留静态文件即可。</p>\n<p>在本地写markdown文件并调试好再上传。</p>\n<p>最后还是决定同步整个 hexo 文件夹。本地和服务器都可以做更改。但在服务器上做的更改需要注意，可能会被本地的更改冲掉。所以尽量在本地做更改。</p>\n","site":{"data":{}},"excerpt":"<style>\n  .img {\n    width: 60%;\n    text-align: center;\n  }\n</style>\n\n<div class='img'>\n![](http://omp48p40q.bkt.clouddn.com/17-5-7/51656771-file_1494155724132_a08a.png)\n</div>\n\n\n<blockquote>\n<p>这个世界是由懒人驱动的。 PS: 参考这类技术文章还是要找原文，国内的翻译，不说了。</p>\n</blockquote>","more":"<p>之前常用的部署代码就是用svn，或是更老土的ftp。每次的git pull实在是一个让人烦躁的东西，就网上查找了一下，发现git-hook 是个好东西。<a href=\"http://toroid.org/git-website-howto\">参考原文</a></p>\n<p>实现原理是当我们push 代码到<code>remote repository</code>时，通过git的<code>post-receive hooks</code>。执行<br><code>git checkout prod -f</code><br>来帮助我们实现自动部署。</p>\n<h2 id=\"1-在本地创建一个git-repository\"><a href=\"#1-在本地创建一个git-repository\" class=\"headerlink\" title=\"1. 在本地创建一个git repository\"></a>1. 在<strong>本地</strong>创建一个<code>git repository</code></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mkdir test &amp;&amp; cd test</span><br><span class=\"line\">$ git init </span><br><span class=\"line\">$ echo &#39;Hello, world!&#39; &gt; index.html</span><br><span class=\"line\">$ git add index.html</span><br><span class=\"line\">$ git commit -q -m &quot;init&quot;</span><br></pre></td></tr></table></figure>\n\n<p><code>index.html</code> 就是我们希望能够部署到服务器的代码</p>\n<h2 id=\"2-然后在服务器创建一个repository\"><a href=\"#2-然后在服务器创建一个repository\" class=\"headerlink\" title=\"2. 然后在服务器创建一个repository\"></a>2. 然后在<strong>服务</strong>器创建一个<code>repository</code></h2><p>要注意，服务器要设置两个目录，一个是 git 目录，一个是代码目录。服务器的git目录和本地的代码目的都要指向服务器的代码目录。</p>\n<p>这里可不是服务器部署代码的位置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mkdir test.git &amp;&amp; cd test.git</span><br><span class=\"line\">$ git init --bare</span><br><span class=\"line\">$ cat &gt; hooks&#x2F;post-receive</span><br><span class=\"line\">#!&#x2F;bin&#x2F;sh</span><br><span class=\"line\">GIT_WORK_TREE&#x3D;&#x2F;dir&#x2F;to&#x2F;your&#x2F;webpage&#x2F;root git checkout -f</span><br><span class=\"line\"></span><br><span class=\"line\">#!&#x2F;bin&#x2F;sh</span><br><span class=\"line\">GIT_WORK_TREE&#x3D;&#x2F;root&#x2F;www&#x2F;test git checkout  -f  &#x2F;&#x2F; 这个是我的网站路径，这就是服务器git目录指向服务器代码目录的方式</span><br><span class=\"line\">$ chmod +x hooks&#x2F;post-receive</span><br></pre></td></tr></table></figure>\n\n<p>这是服务器的git代码目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;dir&#x2F;to&#x2F;test.git</span><br></pre></td></tr></table></figure>\n\n<p>这里的 <code>/root/www/test</code> 就是我将要部署服务器代码的位置，一般的lamp，我们喜欢放在www里，当然这里需要根据不同的环境更换就好了。</p>\n<h2 id=\"3-在本地的git目录下增加一个remote\"><a href=\"#3-在本地的git目录下增加一个remote\" class=\"headerlink\" title=\"3. 在本地的git目录下增加一个remote\"></a>3. 在本地的git目录下增加一个remote</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git remote add web ssh:&#x2F;&#x2F;root@47.93.234.60:&#x2F;root&#x2F;www&#x2F;test.git</span><br><span class=\"line\">$ git push web +master:refs&#x2F;heads&#x2F;master</span><br></pre></td></tr></table></figure>\n\n<p>server_address 可以是 ip，域名。</p>\n<p>也可以使用 SourceTree 来实现上面两个步骤。</p>\n<p>这时我们切换到服务器目录下，就可以看到我们的<code>index.html</code> 在我们向<code>web push</code>的之后，已经自动<code>check out</code> 到我们指定目录下了。</p>\n<p>之后我们只需要修改完成之后，<code>git push web</code> 就可以自动部署代码了。</p>\n<p>SourceTree</p>\n<ol>\n<li>New Repository -&gt; add Existing Local Repository -&gt; 选中本地代码目录</li>\n<li>更改文件后添加并push即可。 </li>\n</ol>\n<p>我的做法是把 hexo 的 public 目录作为本地代码目录，编译生成静态文件后通过git上传到服务器代码目录，然后nginx将站点指向服务器代码目录即可。服务器上不需要配置hexo，只保留静态文件即可。</p>\n<p>在本地写markdown文件并调试好再上传。</p>\n<p>最后还是决定同步整个 hexo 文件夹。本地和服务器都可以做更改。但在服务器上做的更改需要注意，可能会被本地的更改冲掉。所以尽量在本地做更改。</p>"},{"title":"hexo 搭建个人博客的学习记录-yelee 主题设置","date":"2017-04-23T16:00:00.000Z","description":"对比了很多主题，最后采用 Yelee. 无他，看着顺眼罢了。","_content":"\n对比了很多主题，最后采用 [Yelee](https://github.com/MOxFIVE/hexo-theme-yelee)\n\n[Yelee 文档](http://moxfive.coding.me/yelee/)\n\n<!--more-->\n\n## 1. 安装\n\n首先，确保已安装 [hexo](https://github.com/hexojs/hexo)\n\n```\ngit clone https://github.com/MOxFIVE/hexo-theme-yelee.git themes/yelee\n```\n\n再修改 Hexo 根目录对应配置文件 `_config.yml`，即可切换到 Yelee 主题\n\n```\ntheme: yelee\n```\n\n执行以下命令预览当前主题\n\n```\nhexo clean && hexo g\n```\n\n### 语言切换\n\n```\nlanguage: zh-Hans\n```\n\n### Https\n\n如果站点通过 HTTPS 访问，那下列的服务可能 无法正常使用：\n\n- 多说评论\n- 友言评论\n- 百度分享\n- 百度统计\n\n可使用下列支持 HTTPS 的服务替代：\n\n- Disqus 评论\n- AddThis\n- 谷歌分析\n\n\n## 2. 基本设置\n\n### 头像\n\n默认头像存储于 `yelee/source/img/avatar.png`\n\n配置中对应填写 `/img/avatar.png`，可替换图片或指定新地址\n\n我上传了自己的头像，尺寸为 150*150\n\n```\navatar: /img/zzp.png\n```\n\n### 文章摘要\n\n两种在文章列表显示摘要的方式\n\n1. 正文中添加 `<!-- more -->`\n2. 文件头添加 description 标签，内容就是显示在文章列表中 摘要，如：\n\n```\ndescription: \"这里写要显示在文章列表的摘要。\"\n```\n\n### 评论系统\n\n等备案完成后再来补充\n\n### 标签云页面\n\n使用 Hexo 命令新建一个名为 tags 的页面即可\n\n```\nhexo new page tags\n```\n\n该页面标题可以在文件 `\\hexo\\source\\tags\\index.md` 中修改\n\n### 关于我页面\n\n使用 Hexo 命令新建一个名为 about 的页面即可\n\n```\nhexo new page about\n```\n\n该页面内容在文件 `\\hexo\\source\\about\\index.md` 中修改\n\n### 站点小图标\n\n若将图标存储于 `yelee/source/favicon.png`\n\n则配置中对应填写 `/favicon.png`，另外填网络图片的地址也可\n\n`favicon: /favicon.png`\n\n[在线制作小图片](http://tool.lu/favicon/)\n\n\n\n\n","source":"_posts/hexo 搭建个人博客的学习记录-yelee 主题设置.md","raw":"---\ntitle: hexo 搭建个人博客的学习记录-yelee 主题设置\ndate: 2017-04-24\ntags: hexo\ndescription: 对比了很多主题，最后采用 Yelee. 无他，看着顺眼罢了。\n---\n\n对比了很多主题，最后采用 [Yelee](https://github.com/MOxFIVE/hexo-theme-yelee)\n\n[Yelee 文档](http://moxfive.coding.me/yelee/)\n\n<!--more-->\n\n## 1. 安装\n\n首先，确保已安装 [hexo](https://github.com/hexojs/hexo)\n\n```\ngit clone https://github.com/MOxFIVE/hexo-theme-yelee.git themes/yelee\n```\n\n再修改 Hexo 根目录对应配置文件 `_config.yml`，即可切换到 Yelee 主题\n\n```\ntheme: yelee\n```\n\n执行以下命令预览当前主题\n\n```\nhexo clean && hexo g\n```\n\n### 语言切换\n\n```\nlanguage: zh-Hans\n```\n\n### Https\n\n如果站点通过 HTTPS 访问，那下列的服务可能 无法正常使用：\n\n- 多说评论\n- 友言评论\n- 百度分享\n- 百度统计\n\n可使用下列支持 HTTPS 的服务替代：\n\n- Disqus 评论\n- AddThis\n- 谷歌分析\n\n\n## 2. 基本设置\n\n### 头像\n\n默认头像存储于 `yelee/source/img/avatar.png`\n\n配置中对应填写 `/img/avatar.png`，可替换图片或指定新地址\n\n我上传了自己的头像，尺寸为 150*150\n\n```\navatar: /img/zzp.png\n```\n\n### 文章摘要\n\n两种在文章列表显示摘要的方式\n\n1. 正文中添加 `<!-- more -->`\n2. 文件头添加 description 标签，内容就是显示在文章列表中 摘要，如：\n\n```\ndescription: \"这里写要显示在文章列表的摘要。\"\n```\n\n### 评论系统\n\n等备案完成后再来补充\n\n### 标签云页面\n\n使用 Hexo 命令新建一个名为 tags 的页面即可\n\n```\nhexo new page tags\n```\n\n该页面标题可以在文件 `\\hexo\\source\\tags\\index.md` 中修改\n\n### 关于我页面\n\n使用 Hexo 命令新建一个名为 about 的页面即可\n\n```\nhexo new page about\n```\n\n该页面内容在文件 `\\hexo\\source\\about\\index.md` 中修改\n\n### 站点小图标\n\n若将图标存储于 `yelee/source/favicon.png`\n\n则配置中对应填写 `/favicon.png`，另外填网络图片的地址也可\n\n`favicon: /favicon.png`\n\n[在线制作小图片](http://tool.lu/favicon/)\n\n\n\n\n","slug":"hexo 搭建个人博客的学习记录-yelee 主题设置","published":1,"updated":"2020-09-11T01:04:35.042Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8x001y6wo1fb88d5pw","content":"<p>对比了很多主题，最后采用 <a href=\"https://github.com/MOxFIVE/hexo-theme-yelee\">Yelee</a></p>\n<p><a href=\"http://moxfive.coding.me/yelee/\">Yelee 文档</a></p>\n<a id=\"more\"></a>\n\n<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><p>首先，确保已安装 <a href=\"https://github.com/hexojs/hexo\">hexo</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;MOxFIVE&#x2F;hexo-theme-yelee.git themes&#x2F;yelee</span><br></pre></td></tr></table></figure>\n\n<p>再修改 Hexo 根目录对应配置文件 <code>_config.yml</code>，即可切换到 Yelee 主题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: yelee</span><br></pre></td></tr></table></figure>\n\n<p>执行以下命令预览当前主题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean &amp;&amp; hexo g</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"语言切换\"><a href=\"#语言切换\" class=\"headerlink\" title=\"语言切换\"></a>语言切换</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">language: zh-Hans</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Https\"><a href=\"#Https\" class=\"headerlink\" title=\"Https\"></a>Https</h3><p>如果站点通过 HTTPS 访问，那下列的服务可能 无法正常使用：</p>\n<ul>\n<li>多说评论</li>\n<li>友言评论</li>\n<li>百度分享</li>\n<li>百度统计</li>\n</ul>\n<p>可使用下列支持 HTTPS 的服务替代：</p>\n<ul>\n<li>Disqus 评论</li>\n<li>AddThis</li>\n<li>谷歌分析</li>\n</ul>\n<h2 id=\"2-基本设置\"><a href=\"#2-基本设置\" class=\"headerlink\" title=\"2. 基本设置\"></a>2. 基本设置</h2><h3 id=\"头像\"><a href=\"#头像\" class=\"headerlink\" title=\"头像\"></a>头像</h3><p>默认头像存储于 <code>yelee/source/img/avatar.png</code></p>\n<p>配置中对应填写 <code>/img/avatar.png</code>，可替换图片或指定新地址</p>\n<p>我上传了自己的头像，尺寸为 150*150</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">avatar: &#x2F;img&#x2F;zzp.png</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文章摘要\"><a href=\"#文章摘要\" class=\"headerlink\" title=\"文章摘要\"></a>文章摘要</h3><p>两种在文章列表显示摘要的方式</p>\n<ol>\n<li>正文中添加 <code>&lt;!-- more --&gt;</code></li>\n<li>文件头添加 description 标签，内容就是显示在文章列表中 摘要，如：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">description: &quot;这里写要显示在文章列表的摘要。&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"评论系统\"><a href=\"#评论系统\" class=\"headerlink\" title=\"评论系统\"></a>评论系统</h3><p>等备案完成后再来补充</p>\n<h3 id=\"标签云页面\"><a href=\"#标签云页面\" class=\"headerlink\" title=\"标签云页面\"></a>标签云页面</h3><p>使用 Hexo 命令新建一个名为 tags 的页面即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new page tags</span><br></pre></td></tr></table></figure>\n\n<p>该页面标题可以在文件 <code>\\hexo\\source\\tags\\index.md</code> 中修改</p>\n<h3 id=\"关于我页面\"><a href=\"#关于我页面\" class=\"headerlink\" title=\"关于我页面\"></a>关于我页面</h3><p>使用 Hexo 命令新建一个名为 about 的页面即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new page about</span><br></pre></td></tr></table></figure>\n\n<p>该页面内容在文件 <code>\\hexo\\source\\about\\index.md</code> 中修改</p>\n<h3 id=\"站点小图标\"><a href=\"#站点小图标\" class=\"headerlink\" title=\"站点小图标\"></a>站点小图标</h3><p>若将图标存储于 <code>yelee/source/favicon.png</code></p>\n<p>则配置中对应填写 <code>/favicon.png</code>，另外填网络图片的地址也可</p>\n<p><code>favicon: /favicon.png</code></p>\n<p><a href=\"http://tool.lu/favicon/\">在线制作小图片</a></p>\n","site":{"data":{}},"excerpt":"<p>对比了很多主题，最后采用 <a href=\"https://github.com/MOxFIVE/hexo-theme-yelee\">Yelee</a></p>\n<p><a href=\"http://moxfive.coding.me/yelee/\">Yelee 文档</a></p>","more":"<h2 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1. 安装\"></a>1. 安装</h2><p>首先，确保已安装 <a href=\"https://github.com/hexojs/hexo\">hexo</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;MOxFIVE&#x2F;hexo-theme-yelee.git themes&#x2F;yelee</span><br></pre></td></tr></table></figure>\n\n<p>再修改 Hexo 根目录对应配置文件 <code>_config.yml</code>，即可切换到 Yelee 主题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">theme: yelee</span><br></pre></td></tr></table></figure>\n\n<p>执行以下命令预览当前主题</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean &amp;&amp; hexo g</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"语言切换\"><a href=\"#语言切换\" class=\"headerlink\" title=\"语言切换\"></a>语言切换</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">language: zh-Hans</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Https\"><a href=\"#Https\" class=\"headerlink\" title=\"Https\"></a>Https</h3><p>如果站点通过 HTTPS 访问，那下列的服务可能 无法正常使用：</p>\n<ul>\n<li>多说评论</li>\n<li>友言评论</li>\n<li>百度分享</li>\n<li>百度统计</li>\n</ul>\n<p>可使用下列支持 HTTPS 的服务替代：</p>\n<ul>\n<li>Disqus 评论</li>\n<li>AddThis</li>\n<li>谷歌分析</li>\n</ul>\n<h2 id=\"2-基本设置\"><a href=\"#2-基本设置\" class=\"headerlink\" title=\"2. 基本设置\"></a>2. 基本设置</h2><h3 id=\"头像\"><a href=\"#头像\" class=\"headerlink\" title=\"头像\"></a>头像</h3><p>默认头像存储于 <code>yelee/source/img/avatar.png</code></p>\n<p>配置中对应填写 <code>/img/avatar.png</code>，可替换图片或指定新地址</p>\n<p>我上传了自己的头像，尺寸为 150*150</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">avatar: &#x2F;img&#x2F;zzp.png</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文章摘要\"><a href=\"#文章摘要\" class=\"headerlink\" title=\"文章摘要\"></a>文章摘要</h3><p>两种在文章列表显示摘要的方式</p>\n<ol>\n<li>正文中添加 <code>&lt;!-- more --&gt;</code></li>\n<li>文件头添加 description 标签，内容就是显示在文章列表中 摘要，如：</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">description: &quot;这里写要显示在文章列表的摘要。&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"评论系统\"><a href=\"#评论系统\" class=\"headerlink\" title=\"评论系统\"></a>评论系统</h3><p>等备案完成后再来补充</p>\n<h3 id=\"标签云页面\"><a href=\"#标签云页面\" class=\"headerlink\" title=\"标签云页面\"></a>标签云页面</h3><p>使用 Hexo 命令新建一个名为 tags 的页面即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new page tags</span><br></pre></td></tr></table></figure>\n\n<p>该页面标题可以在文件 <code>\\hexo\\source\\tags\\index.md</code> 中修改</p>\n<h3 id=\"关于我页面\"><a href=\"#关于我页面\" class=\"headerlink\" title=\"关于我页面\"></a>关于我页面</h3><p>使用 Hexo 命令新建一个名为 about 的页面即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo new page about</span><br></pre></td></tr></table></figure>\n\n<p>该页面内容在文件 <code>\\hexo\\source\\about\\index.md</code> 中修改</p>\n<h3 id=\"站点小图标\"><a href=\"#站点小图标\" class=\"headerlink\" title=\"站点小图标\"></a>站点小图标</h3><p>若将图标存储于 <code>yelee/source/favicon.png</code></p>\n<p>则配置中对应填写 <code>/favicon.png</code>，另外填网络图片的地址也可</p>\n<p><code>favicon: /favicon.png</code></p>\n<p><a href=\"http://tool.lu/favicon/\">在线制作小图片</a></p>"},{"title":"iThoughtX-for-Mac-常用快捷键","date":"2016-08-20T16:00:00.000Z","_content":"\n作为 Mac 上大名鼎鼎的思维导图 App，IThoughtX 界面和操作都做到了极简，如果不掌握常用的快捷键操作，面对这个强大的工具只能是一头雾水，下面是整理的一些常用的快捷键。\n表格贴不上来，只能截图了...\n\n<!--more-->\n\n\n![IThoughtX 常用快捷键.png](http://upload-images.jianshu.io/upload_images/693141-e8554c82c5726c74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","source":"_posts/iThoughtX-for-Mac-常用快捷键.md","raw":"---\ntitle: iThoughtX-for-Mac-常用快捷键\ndate: 2016-08-21\ntags: mac\n---\n\n作为 Mac 上大名鼎鼎的思维导图 App，IThoughtX 界面和操作都做到了极简，如果不掌握常用的快捷键操作，面对这个强大的工具只能是一头雾水，下面是整理的一些常用的快捷键。\n表格贴不上来，只能截图了...\n\n<!--more-->\n\n\n![IThoughtX 常用快捷键.png](http://upload-images.jianshu.io/upload_images/693141-e8554c82c5726c74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","slug":"iThoughtX-for-Mac-常用快捷键","published":1,"updated":"2020-09-11T01:04:35.042Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz8z00226wo1fzipdx2k","content":"<p>作为 Mac 上大名鼎鼎的思维导图 App，IThoughtX 界面和操作都做到了极简，如果不掌握常用的快捷键操作，面对这个强大的工具只能是一头雾水，下面是整理的一些常用的快捷键。<br>表格贴不上来，只能截图了…</p>\n<a id=\"more\"></a>\n\n\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-e8554c82c5726c74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"IThoughtX 常用快捷键.png\"></p>\n","site":{"data":{}},"excerpt":"<p>作为 Mac 上大名鼎鼎的思维导图 App，IThoughtX 界面和操作都做到了极简，如果不掌握常用的快捷键操作，面对这个强大的工具只能是一头雾水，下面是整理的一些常用的快捷键。<br>表格贴不上来，只能截图了…</p>","more":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-e8554c82c5726c74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"IThoughtX 常用快捷键.png\"></p>"},{"title":"linux 权限管理","date":"2018-02-22T06:37:09.000Z","_content":"\n\n## linux 权限 https://www.imooc.com/video/9434\n\n### 1. 权限对目录的作用\n- r：可以查询目录下文件名（ls）\n- w：具有修改目录结构的权限。如新建文件和目录，删除此目录下的文件和目录，重命名此目录下的文件和目录，剪切（touch，rm，mv，cp）\n- x：可以进入目录（cd）\n\n<!-- more -->\n\n### 2. 权限对文件的作用\n\n- r：读取文件内容（cat，more，head，tail）\n- w：编辑、新增、修改文件内容（vi echo），但是不包含删除文件\n- x：可执行\n\n<b style=\"color:red\">对文件来讲，最高权限是 x；\n对目录来讲，最高权限是 w\n\n目录的有效权限只有 0，5（rx），7（rwx），其他都没意义</b>\n\n\n### 3. 文件的默认权限\n\numask 值：root 用户默认为 0022，普通用户默认为 0002。 `/etc/profile`\n\n- 文件默认不能建立为执行文件，必须手动赋予执行权限\n- 所以文件默认权限最大为 666\n- 默认权限需要换算成字母再相减\n- 建立文件的默认权限，是 666 减去 umask 值 （换成字母逻辑减）\n\n### 4. 目录的默认权限\n\n- 目录默认权限最大为 777\n- 默认权限需要换算成字母再相减\n- 建立目录之后的默认权限，为 777 减去 umask 值（换算成字母逻辑减）\n\n","source":"_posts/linux-权限管理.md","raw":"---\ntitle: linux 权限管理\ndate: 2018-02-22 14:37:09\ntags: Linux\n---\n\n\n## linux 权限 https://www.imooc.com/video/9434\n\n### 1. 权限对目录的作用\n- r：可以查询目录下文件名（ls）\n- w：具有修改目录结构的权限。如新建文件和目录，删除此目录下的文件和目录，重命名此目录下的文件和目录，剪切（touch，rm，mv，cp）\n- x：可以进入目录（cd）\n\n<!-- more -->\n\n### 2. 权限对文件的作用\n\n- r：读取文件内容（cat，more，head，tail）\n- w：编辑、新增、修改文件内容（vi echo），但是不包含删除文件\n- x：可执行\n\n<b style=\"color:red\">对文件来讲，最高权限是 x；\n对目录来讲，最高权限是 w\n\n目录的有效权限只有 0，5（rx），7（rwx），其他都没意义</b>\n\n\n### 3. 文件的默认权限\n\numask 值：root 用户默认为 0022，普通用户默认为 0002。 `/etc/profile`\n\n- 文件默认不能建立为执行文件，必须手动赋予执行权限\n- 所以文件默认权限最大为 666\n- 默认权限需要换算成字母再相减\n- 建立文件的默认权限，是 666 减去 umask 值 （换成字母逻辑减）\n\n### 4. 目录的默认权限\n\n- 目录默认权限最大为 777\n- 默认权限需要换算成字母再相减\n- 建立目录之后的默认权限，为 777 减去 umask 值（换算成字母逻辑减）\n\n","slug":"linux-权限管理","published":1,"updated":"2020-09-11T01:04:35.042Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9000256wo177l3bfbs","content":"<h2 id=\"linux-权限-https-www-imooc-com-video-9434\"><a href=\"#linux-权限-https-www-imooc-com-video-9434\" class=\"headerlink\" title=\"linux 权限 https://www.imooc.com/video/9434\"></a>linux 权限 <a href=\"https://www.imooc.com/video/9434\">https://www.imooc.com/video/9434</a></h2><h3 id=\"1-权限对目录的作用\"><a href=\"#1-权限对目录的作用\" class=\"headerlink\" title=\"1. 权限对目录的作用\"></a>1. 权限对目录的作用</h3><ul>\n<li>r：可以查询目录下文件名（ls）</li>\n<li>w：具有修改目录结构的权限。如新建文件和目录，删除此目录下的文件和目录，重命名此目录下的文件和目录，剪切（touch，rm，mv，cp）</li>\n<li>x：可以进入目录（cd）</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"2-权限对文件的作用\"><a href=\"#2-权限对文件的作用\" class=\"headerlink\" title=\"2. 权限对文件的作用\"></a>2. 权限对文件的作用</h3><ul>\n<li>r：读取文件内容（cat，more，head，tail）</li>\n<li>w：编辑、新增、修改文件内容（vi echo），但是不包含删除文件</li>\n<li>x：可执行</li>\n</ul>\n<p><b style=\"color:red\">对文件来讲，最高权限是 x；<br>对目录来讲，最高权限是 w</p>\n<p>目录的有效权限只有 0，5（rx），7（rwx），其他都没意义</b></p>\n<h3 id=\"3-文件的默认权限\"><a href=\"#3-文件的默认权限\" class=\"headerlink\" title=\"3. 文件的默认权限\"></a>3. 文件的默认权限</h3><p>umask 值：root 用户默认为 0022，普通用户默认为 0002。 <code>/etc/profile</code></p>\n<ul>\n<li>文件默认不能建立为执行文件，必须手动赋予执行权限</li>\n<li>所以文件默认权限最大为 666</li>\n<li>默认权限需要换算成字母再相减</li>\n<li>建立文件的默认权限，是 666 减去 umask 值 （换成字母逻辑减）</li>\n</ul>\n<h3 id=\"4-目录的默认权限\"><a href=\"#4-目录的默认权限\" class=\"headerlink\" title=\"4. 目录的默认权限\"></a>4. 目录的默认权限</h3><ul>\n<li>目录默认权限最大为 777</li>\n<li>默认权限需要换算成字母再相减</li>\n<li>建立目录之后的默认权限，为 777 减去 umask 值（换算成字母逻辑减）</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"linux-权限-https-www-imooc-com-video-9434\"><a href=\"#linux-权限-https-www-imooc-com-video-9434\" class=\"headerlink\" title=\"linux 权限 https://www.imooc.com/video/9434\"></a>linux 权限 <a href=\"https://www.imooc.com/video/9434\">https://www.imooc.com/video/9434</a></h2><h3 id=\"1-权限对目录的作用\"><a href=\"#1-权限对目录的作用\" class=\"headerlink\" title=\"1. 权限对目录的作用\"></a>1. 权限对目录的作用</h3><ul>\n<li>r：可以查询目录下文件名（ls）</li>\n<li>w：具有修改目录结构的权限。如新建文件和目录，删除此目录下的文件和目录，重命名此目录下的文件和目录，剪切（touch，rm，mv，cp）</li>\n<li>x：可以进入目录（cd）</li>\n</ul>","more":"<h3 id=\"2-权限对文件的作用\"><a href=\"#2-权限对文件的作用\" class=\"headerlink\" title=\"2. 权限对文件的作用\"></a>2. 权限对文件的作用</h3><ul>\n<li>r：读取文件内容（cat，more，head，tail）</li>\n<li>w：编辑、新增、修改文件内容（vi echo），但是不包含删除文件</li>\n<li>x：可执行</li>\n</ul>\n<p><b style=\"color:red\">对文件来讲，最高权限是 x；<br>对目录来讲，最高权限是 w</p>\n<p>目录的有效权限只有 0，5（rx），7（rwx），其他都没意义</b></p>\n<h3 id=\"3-文件的默认权限\"><a href=\"#3-文件的默认权限\" class=\"headerlink\" title=\"3. 文件的默认权限\"></a>3. 文件的默认权限</h3><p>umask 值：root 用户默认为 0022，普通用户默认为 0002。 <code>/etc/profile</code></p>\n<ul>\n<li>文件默认不能建立为执行文件，必须手动赋予执行权限</li>\n<li>所以文件默认权限最大为 666</li>\n<li>默认权限需要换算成字母再相减</li>\n<li>建立文件的默认权限，是 666 减去 umask 值 （换成字母逻辑减）</li>\n</ul>\n<h3 id=\"4-目录的默认权限\"><a href=\"#4-目录的默认权限\" class=\"headerlink\" title=\"4. 目录的默认权限\"></a>4. 目录的默认权限</h3><ul>\n<li>目录默认权限最大为 777</li>\n<li>默认权限需要换算成字母再相减</li>\n<li>建立目录之后的默认权限，为 777 减去 umask 值（换算成字母逻辑减）</li>\n</ul>"},{"title":"mac 下搭建 laravel 运行环境","date":"2016-12-22T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-e63645d2638a654a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\n1. 安装 composer\n\n```\nphp -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"\nphp -r \"if (hash_file('SHA384', 'composer-setup.php') === 'e115a8dc7871f15d853148a7fbac7da27d6c0030b848d9b3dc09e2a0388afed865e6a3d6b3c0fad45c48e2b5fc1196ae') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"\nphp composer-setup.php\nphp -r \"unlink('composer-setup.php');\"```\n可能出现 openssl 相关的错误，在之前的文章中已有解决方案。\n\n执行第一条命令下载下来的 composer-setup.php 脚本将简单的检测 php.ini 中的参数设置，如果某些参数未正确设置则会给出警告；\n然后下载最新版本的 composer.phar 文件到当前目录。\n上述 3 条命令的作用依次是：\n下载安装脚本（composer-setup.php）到当前目录。\n检验文件的 hash 值。\n执行安装过程。\n删除安装脚本 -- composer-setup.php 。\n2. 添加 composer 至全局变量\n```mv composer.phar /usr/local/bin/composer```\n现在输入 ```composer -V ```试试，就可以显示版本号了。\n\n3.使用 composer 下载 laravel 安装包\n```composer global require \"laravel/installer=~1.1\"```\n然后把 ~/.composer/vendor/bin 路径放置于您的 PATH 里， 这样 laravel 执行文件就会存在你的系统。\n具体方法为：cd 到/Users/ZouZhipeng，即.bash_profile所在的目录\n```sudo vim .bash_profile```\n 添加一行\n```export PATH=\"/Users/ZouZhipeng/.composer/vendor/bin:$PATH\"```\n\n\n","source":"_posts/mac-下搭建-laravel-运行环境.md","raw":"---\ntitle: mac 下搭建 laravel 运行环境\ndate: 2016-12-23\ntags: laravel\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-e63645d2638a654a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\n1. 安装 composer\n\n```\nphp -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"\nphp -r \"if (hash_file('SHA384', 'composer-setup.php') === 'e115a8dc7871f15d853148a7fbac7da27d6c0030b848d9b3dc09e2a0388afed865e6a3d6b3c0fad45c48e2b5fc1196ae') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"\nphp composer-setup.php\nphp -r \"unlink('composer-setup.php');\"```\n可能出现 openssl 相关的错误，在之前的文章中已有解决方案。\n\n执行第一条命令下载下来的 composer-setup.php 脚本将简单的检测 php.ini 中的参数设置，如果某些参数未正确设置则会给出警告；\n然后下载最新版本的 composer.phar 文件到当前目录。\n上述 3 条命令的作用依次是：\n下载安装脚本（composer-setup.php）到当前目录。\n检验文件的 hash 值。\n执行安装过程。\n删除安装脚本 -- composer-setup.php 。\n2. 添加 composer 至全局变量\n```mv composer.phar /usr/local/bin/composer```\n现在输入 ```composer -V ```试试，就可以显示版本号了。\n\n3.使用 composer 下载 laravel 安装包\n```composer global require \"laravel/installer=~1.1\"```\n然后把 ~/.composer/vendor/bin 路径放置于您的 PATH 里， 这样 laravel 执行文件就会存在你的系统。\n具体方法为：cd 到/Users/ZouZhipeng，即.bash_profile所在的目录\n```sudo vim .bash_profile```\n 添加一行\n```export PATH=\"/Users/ZouZhipeng/.composer/vendor/bin:$PATH\"```\n\n\n","slug":"mac-下搭建-laravel-运行环境","published":1,"updated":"2020-09-11T01:04:35.042Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9100286wo136ga2pur","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-e63645d2638a654a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n<ol>\n<li>安装 composer</li>\n</ol>\n<pre><code>php -r &quot;copy(&#39;https://getcomposer.org/installer&#39;, &#39;composer-setup.php&#39;);&quot;\nphp -r &quot;if (hash_file(&#39;SHA384&#39;, &#39;composer-setup.php&#39;) === &#39;e115a8dc7871f15d853148a7fbac7da27d6c0030b848d9b3dc09e2a0388afed865e6a3d6b3c0fad45c48e2b5fc1196ae&#39;) &#123; echo &#39;Installer verified&#39;; &#125; else &#123; echo &#39;Installer corrupt&#39;; unlink(&#39;composer-setup.php&#39;); &#125; echo PHP_EOL;&quot;\nphp composer-setup.php\nphp -r &quot;unlink(&#39;composer-setup.php&#39;);&quot;```\n可能出现 openssl 相关的错误，在之前的文章中已有解决方案。\n\n执行第一条命令下载下来的 composer-setup.php 脚本将简单的检测 php.ini 中的参数设置，如果某些参数未正确设置则会给出警告；\n然后下载最新版本的 composer.phar 文件到当前目录。\n上述 3 条命令的作用依次是：\n下载安装脚本（composer-setup.php）到当前目录。\n检验文件的 hash 值。\n执行安装过程。\n删除安装脚本 -- composer-setup.php 。\n2. 添加 composer 至全局变量\n```mv composer.phar /usr/local/bin/composer```\n现在输入 ```composer -V ```试试，就可以显示版本号了。\n\n3.使用 composer 下载 laravel 安装包\n```composer global require &quot;laravel/installer=~1.1&quot;```\n然后把 ~/.composer/vendor/bin 路径放置于您的 PATH 里， 这样 laravel 执行文件就会存在你的系统。\n具体方法为：cd 到/Users/ZouZhipeng，即.bash_profile所在的目录\n```sudo vim .bash_profile```\n 添加一行\n```export PATH=&quot;/Users/ZouZhipeng/.composer/vendor/bin:$PATH&quot;```\n\n</code></pre>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-e63645d2638a654a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<ol>\n<li>安装 composer</li>\n</ol>\n<pre><code>php -r &quot;copy(&#39;https://getcomposer.org/installer&#39;, &#39;composer-setup.php&#39;);&quot;\nphp -r &quot;if (hash_file(&#39;SHA384&#39;, &#39;composer-setup.php&#39;) === &#39;e115a8dc7871f15d853148a7fbac7da27d6c0030b848d9b3dc09e2a0388afed865e6a3d6b3c0fad45c48e2b5fc1196ae&#39;) &#123; echo &#39;Installer verified&#39;; &#125; else &#123; echo &#39;Installer corrupt&#39;; unlink(&#39;composer-setup.php&#39;); &#125; echo PHP_EOL;&quot;\nphp composer-setup.php\nphp -r &quot;unlink(&#39;composer-setup.php&#39;);&quot;```\n可能出现 openssl 相关的错误，在之前的文章中已有解决方案。\n\n执行第一条命令下载下来的 composer-setup.php 脚本将简单的检测 php.ini 中的参数设置，如果某些参数未正确设置则会给出警告；\n然后下载最新版本的 composer.phar 文件到当前目录。\n上述 3 条命令的作用依次是：\n下载安装脚本（composer-setup.php）到当前目录。\n检验文件的 hash 值。\n执行安装过程。\n删除安装脚本 -- composer-setup.php 。\n2. 添加 composer 至全局变量\n```mv composer.phar /usr/local/bin/composer```\n现在输入 ```composer -V ```试试，就可以显示版本号了。\n\n3.使用 composer 下载 laravel 安装包\n```composer global require &quot;laravel/installer=~1.1&quot;```\n然后把 ~/.composer/vendor/bin 路径放置于您的 PATH 里， 这样 laravel 执行文件就会存在你的系统。\n具体方法为：cd 到/Users/ZouZhipeng，即.bash_profile所在的目录\n```sudo vim .bash_profile```\n 添加一行\n```export PATH=&quot;/Users/ZouZhipeng/.composer/vendor/bin:$PATH&quot;```\n\n</code></pre>"},{"title":"mac 中 mamp-pro 的 localhost 显示为 403 Forbidden","date":"2016-11-14T16:00:00.000Z","description":"解决方法很简单，在 mamp pro 中，依次找到Hosts > Extended > Indexes，勾选 Indexes，重启即可。","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-04ef97fb9985702e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n<!--more-->\n解决方法很简单，在 mamp pro 中，依次找到 \n\nHosts > Extended > Indexes，勾选 Indexes，重启即可。\n\n另外一个报错可能是 500 服务器错误，解决方法如下：\n\n只需要配置php.ini即可。\n在php的安装目录中找到php.ini文件并打开，找到display_errors，\n默认情况下是display_errors = Off，把Off修改为On，保存关闭文件,然后重启apache。\n\n\n","source":"_posts/mac-中-mamp-pro-的-localhost-显示为-403-Forbidden.md","raw":"---\ntitle: mac 中 mamp-pro 的 localhost 显示为 403 Forbidden\ndate: 2016-11-15\ntags: mac\ndescription: 解决方法很简单，在 mamp pro 中，依次找到Hosts > Extended > Indexes，勾选 Indexes，重启即可。\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-04ef97fb9985702e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n<!--more-->\n解决方法很简单，在 mamp pro 中，依次找到 \n\nHosts > Extended > Indexes，勾选 Indexes，重启即可。\n\n另外一个报错可能是 500 服务器错误，解决方法如下：\n\n只需要配置php.ini即可。\n在php的安装目录中找到php.ini文件并打开，找到display_errors，\n默认情况下是display_errors = Off，把Off修改为On，保存关闭文件,然后重启apache。\n\n\n","slug":"mac-中-mamp-pro-的-localhost-显示为-403-Forbidden","published":1,"updated":"2020-09-11T01:04:35.043Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz92002a6wo1dxque872","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-04ef97fb9985702e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n<p>解决方法很简单，在 mamp pro 中，依次找到 </p>\n<p>Hosts &gt; Extended &gt; Indexes，勾选 Indexes，重启即可。</p>\n<p>另外一个报错可能是 500 服务器错误，解决方法如下：</p>\n<p>只需要配置php.ini即可。<br>在php的安装目录中找到php.ini文件并打开，找到display_errors，<br>默认情况下是display_errors = Off，把Off修改为On，保存关闭文件,然后重启apache。</p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-04ef97fb9985702e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<p>解决方法很简单，在 mamp pro 中，依次找到 </p>\n<p>Hosts &gt; Extended &gt; Indexes，勾选 Indexes，重启即可。</p>\n<p>另外一个报错可能是 500 服务器错误，解决方法如下：</p>\n<p>只需要配置php.ini即可。<br>在php的安装目录中找到php.ini文件并打开，找到display_errors，<br>默认情况下是display_errors = Off，把Off修改为On，保存关闭文件,然后重启apache。</p>"},{"title":"mac 内置 brew 安装的 openssl 冲突解决方案","date":"2016-10-07T16:00:00.000Z","description":"mac 系统自带的 openssl 信息如下： Version 0.9.8 - 位于 /usr/bin/openssl；","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-4d7763bad2f0d9ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\nmac 系统自带的 openssl 信息如下：\n```Version 0.9.8 - 位于 /usr/bin/openssl```；\nbrew 安装的 openssl 信息如下：\n```Version 1.0.2h_1 - 位于 /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl```\n\nterminal 中输入\n```which openssl```或者```openssl version```\n可以看出，都是指向系统默认安装的，现在要做的就是把这个指向改为brew 安装的新版本，也就是 PHP 要进行编译所使用的版本。\n\n方法：建立一个两版本之间的软链\n```ln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl```\n如果上述操作无法执行，只能将原来的 openssl 先重命名，然后建立软链，但这样可能带来稳定性问题。\n\n```mv /usr/bin/openssl /usr/bin/openssl_OLD\nln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl```\n但我这里上述两种方式都报错，加 sudo，改权限777也没用。\n```Operation not permitted```\n\n###寻求其他解决方案\n待添加，一个思路是更改环境变量的路径顺序\n\n\n","source":"_posts/mac-内置与-brew-安装的-openssl-冲突解决方案.md","raw":"---\ntitle: mac 内置 brew 安装的 openssl 冲突解决方案\ndate: 2016-10-08\ntags: openssl\ndescription: mac 系统自带的 openssl 信息如下： Version 0.9.8 - 位于 /usr/bin/openssl； \n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-4d7763bad2f0d9ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\nmac 系统自带的 openssl 信息如下：\n```Version 0.9.8 - 位于 /usr/bin/openssl```；\nbrew 安装的 openssl 信息如下：\n```Version 1.0.2h_1 - 位于 /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl```\n\nterminal 中输入\n```which openssl```或者```openssl version```\n可以看出，都是指向系统默认安装的，现在要做的就是把这个指向改为brew 安装的新版本，也就是 PHP 要进行编译所使用的版本。\n\n方法：建立一个两版本之间的软链\n```ln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl```\n如果上述操作无法执行，只能将原来的 openssl 先重命名，然后建立软链，但这样可能带来稳定性问题。\n\n```mv /usr/bin/openssl /usr/bin/openssl_OLD\nln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl```\n但我这里上述两种方式都报错，加 sudo，改权限777也没用。\n```Operation not permitted```\n\n###寻求其他解决方案\n待添加，一个思路是更改环境变量的路径顺序\n\n\n","slug":"mac-内置与-brew-安装的-openssl-冲突解决方案","published":1,"updated":"2020-09-11T01:04:35.043Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz94002d6wo1h70a8ivz","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-4d7763bad2f0d9ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n<p>mac 系统自带的 openssl 信息如下：<br><code>Version 0.9.8 - 位于 /usr/bin/openssl</code>；<br>brew 安装的 openssl 信息如下：<br><code>Version 1.0.2h_1 - 位于 /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl</code></p>\n<p>terminal 中输入<br><code>which openssl</code>或者<code>openssl version</code><br>可以看出，都是指向系统默认安装的，现在要做的就是把这个指向改为brew 安装的新版本，也就是 PHP 要进行编译所使用的版本。</p>\n<p>方法：建立一个两版本之间的软链<br><code>ln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl</code><br>如果上述操作无法执行，只能将原来的 openssl 先重命名，然后建立软链，但这样可能带来稳定性问题。</p>\n<pre><code class=\"mv\">ln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl```\n但我这里上述两种方式都报错，加 sudo，改权限777也没用。\n```Operation not permitted```\n\n###寻求其他解决方案\n待添加，一个思路是更改环境变量的路径顺序\n\n</code></pre>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-4d7763bad2f0d9ee.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<p>mac 系统自带的 openssl 信息如下：<br><code>Version 0.9.8 - 位于 /usr/bin/openssl</code>；<br>brew 安装的 openssl 信息如下：<br><code>Version 1.0.2h_1 - 位于 /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl</code></p>\n<p>terminal 中输入<br><code>which openssl</code>或者<code>openssl version</code><br>可以看出，都是指向系统默认安装的，现在要做的就是把这个指向改为brew 安装的新版本，也就是 PHP 要进行编译所使用的版本。</p>\n<p>方法：建立一个两版本之间的软链<br><code>ln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl</code><br>如果上述操作无法执行，只能将原来的 openssl 先重命名，然后建立软链，但这样可能带来稳定性问题。</p>\n<pre><code class=\"mv\">ln -s /usr/local/Cellar/openssl/1.0.2h_1/bin/openssl /usr/bin/openssl```\n但我这里上述两种方式都报错，加 sudo，改权限777也没用。\n```Operation not permitted```\n\n###寻求其他解决方案\n待添加，一个思路是更改环境变量的路径顺序\n\n</code></pre>"},{"title":"nginx 入门到实践 慕课网","date":"2018-02-18T09:11:16.000Z","_content":"\n\nnginx 是一个开源且高性能、可靠的HTTP中间件、代理服务。\n\n安装 `yum install nginx`\n\n<!--more-->\n\n### 1. 安装目录\n\n```\n[root@iz2ze4kikm9076bxac1noqz opt]# rpm -ql nginx\n/etc/logrotate.d/nginx\n/etc/nginx\n/etc/nginx/conf.d\n/etc/nginx/conf.d/default.conf\n/etc/nginx/fastcgi_params\n/etc/nginx/koi-utf\n/etc/nginx/koi-win\n/etc/nginx/mime.types\n/etc/nginx/modules\n/etc/nginx/nginx.conf\n/etc/nginx/scgi_params\n/etc/nginx/uwsgi_params\n/etc/nginx/win-utf\n/etc/sysconfig/nginx\n/etc/sysconfig/nginx-debug\n/usr/lib/systemd/system/nginx-debug.service\n/usr/lib/systemd/system/nginx.service\n/usr/lib64/nginx\n/usr/lib64/nginx/modules\n/usr/libexec/initscripts/legacy-actions/nginx\n/usr/libexec/initscripts/legacy-actions/nginx/check-reload\n/usr/libexec/initscripts/legacy-actions/nginx/upgrade\n/usr/sbin/nginx\n/usr/sbin/nginx-debug\n/usr/share/doc/nginx-1.12.2\n/usr/share/doc/nginx-1.12.2/COPYRIGHT\n/usr/share/man/man8/nginx.8.gz\n/usr/share/nginx\n/usr/share/nginx/html\n/usr/share/nginx/html/50x.html\n/usr/share/nginx/html/index.html\n/var/cache/nginx\n/var/log/nginx\n```\n\n\n| 路径                                                                                                                                                         | 类型 |             作用                |\n| ---------------------------------------------------------------------------------------------------------------------------------------------------------- | --- | ------------------------------- |\n| `/etc/logrotate.d/nginx`                                                                                                                                   |  配置文件 | nginx日志轮转，用于logrotate服务的日志切割 |\n| `/etc/nginx` <br/> `/etc/nginx/nginx.conf` <br/> `/etc/nginx/conf.d` <br/> `/etc/nginx/conf.d/default.conf`                                                |  目录、配置文件 | nginx主配置文件 |\n| `/etc/nginx/fastcgi_params` <br/> `/etc/nginx/uwsgi_params` <br/> `/etc/nginx/scgi_params`                                                                 |  配置文件 | cgi配置相关，fastcgi配置 |\n| `/etc/nginx/koi-utf` <br/> `/etc/nginx/koi-win` <br/> `/etc/nginx/win-utf `                                                                                |  配置文件 | 编码转换映射转化文件 很少用到 |\n| `/etc/nginx/mime.types`                                                                                                                                    |  配置文件 | 设置HTTP协议的Content-Type与扩展名对应关系 |\n| `/etc/sysconfig/nginx` <br/> `/etc/sysconfig/nginx-debug` <br/> `/usr/lib/system/system/nginx-debug.service` <br/> `/usr/lib/systemd/system/nginx.service` |  配置文件 | 用于配置出系统守护进程管理器管理方式，取代旧的init.d的脚本管理方式 |\n| `/usr/lib64/nginx/modules` <br/> `/etc/nginx/modules`                                                                                                      |  目录 | nginx 模块目录 |\n| `/usr/sbin/nginx` <br/> `/usr/sbin/nginx-debug`                                                                                                            |  命令 | nginx 服务的启动管理终端命令， nginx 服务的启动、关闭、配置、管理 |\n| `/usr/share/doc/nginx-1.12.2` <br/> `/usr/share/doc/nginx-1.12.2/COPYRIGHT` <br/> `/usr/share/man/man8/nginx.8.gz`                                         |  文件、目录 | nginx的手册和帮助文件 |\n| `/var/cache/nginx`                                                                                                                                         | 目录 | nginx的缓存目录 |\n| `/var/log/nginx`                                                                                                                                           | 目录 | nginx的日志目录 |\n\n### 2. 编译参数\n\n查看编译时所用到的参数 `nginx -V` 大写\n\n```\n[root@iz2ze4kikm9076bxac1noqz opt]# nginx -V\nnginx version: nginx/1.12.2\nbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)\nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC' --with-ld-opt='-Wl,-z,relro -Wl,-z,now -pie'\n```\n\n| 路径                                                                                                                                                                                                                                                                                                                                     |             作用                |\n| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------- |\n| `--prefix=/etc/nginx` <br/> `--sbin-path=/usr/sbin/nginx`  <br/> `--modules-path=/usr/lib64/nginx/modules` <br/> `--conf-path=/etc/nginx/nginx.conf` <br/> `--error-log-path=/var/log/nginx/error.log` <br/> `--http-log-path=/var/log/nginx/access.log` <br/> `--pid-path=/var/run/nginx.pid` <br/> `--lock-path=/var/run/nginx.lock` | 安装目的目录或路径 nginx 基础路径 |\n| `--http-client-body-temp-path=/var/cache/nginx/client_temp` <br/> `--http-proxy-temp-path=/var/cache/nginx/proxy_temp`  <br/> `--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp` <br/> `--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp` <br/> `--http-scgi-temp-path=/var/cache/nginx/scgi_temp`                             | 执行对应模块时，nginx所保留的临时文件 |\n| `--user=nginx --group=nginx`                                                                                                                                                                                                                                                                                                           | 设定nginx进程启动的用户和用户组 |\n| `--with-cc-opt= ... `                                                                                                                                                                                                                                                                                                                  | 设置额外的参数将被添加到CFLAGS变量 不需要了解 |\n| `--with-ld-opt= ... `                                                                                                                                                                                                                                                                                                                  | 设置附件的参数，链接系统库 |\n\n\n### 3. 基本配置语法 nginx.conf default.conf\n\n#### 全局性、服务级别配置\n\n|     配置     |             作用                |\n| ------------ | ------------------------------- |\n|user|设置nginx服务的系统使用用户，一般为nginx，不用修改|\n|worker_processes   | 工作进程数，一般和cpu核数保持一致即可|\n|error_log|nginx错误日志|\n|pid|nginx服务启动时的pid|\n\n#### 事件模块配置 events\n\n|     配置     |             作用                |\n| ------------ | ------------------------------- |\n|worker_connections|每个进程运行的最大连接数 最大65535，一般10000左右最多 |\n|use|工作进程数，内核模型|\n\n#### default.conf 配置\n\n``` nginx\nserver {\n    listen       80; # 监听的端口号\n    server_name  localhost; # 服务的域名\n\n    #charset koi8-r;\n    #access_log  /var/log/nginx/host.access.log  main;\n    \n    # 首页路径或子路径\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    # 错误页面\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/nginx-入门到实践-慕课网.md","raw":"---\ntitle: nginx 入门到实践 慕课网\ndate: 2018-02-18 17:11:16\ntags: nginx\n---\n\n\nnginx 是一个开源且高性能、可靠的HTTP中间件、代理服务。\n\n安装 `yum install nginx`\n\n<!--more-->\n\n### 1. 安装目录\n\n```\n[root@iz2ze4kikm9076bxac1noqz opt]# rpm -ql nginx\n/etc/logrotate.d/nginx\n/etc/nginx\n/etc/nginx/conf.d\n/etc/nginx/conf.d/default.conf\n/etc/nginx/fastcgi_params\n/etc/nginx/koi-utf\n/etc/nginx/koi-win\n/etc/nginx/mime.types\n/etc/nginx/modules\n/etc/nginx/nginx.conf\n/etc/nginx/scgi_params\n/etc/nginx/uwsgi_params\n/etc/nginx/win-utf\n/etc/sysconfig/nginx\n/etc/sysconfig/nginx-debug\n/usr/lib/systemd/system/nginx-debug.service\n/usr/lib/systemd/system/nginx.service\n/usr/lib64/nginx\n/usr/lib64/nginx/modules\n/usr/libexec/initscripts/legacy-actions/nginx\n/usr/libexec/initscripts/legacy-actions/nginx/check-reload\n/usr/libexec/initscripts/legacy-actions/nginx/upgrade\n/usr/sbin/nginx\n/usr/sbin/nginx-debug\n/usr/share/doc/nginx-1.12.2\n/usr/share/doc/nginx-1.12.2/COPYRIGHT\n/usr/share/man/man8/nginx.8.gz\n/usr/share/nginx\n/usr/share/nginx/html\n/usr/share/nginx/html/50x.html\n/usr/share/nginx/html/index.html\n/var/cache/nginx\n/var/log/nginx\n```\n\n\n| 路径                                                                                                                                                         | 类型 |             作用                |\n| ---------------------------------------------------------------------------------------------------------------------------------------------------------- | --- | ------------------------------- |\n| `/etc/logrotate.d/nginx`                                                                                                                                   |  配置文件 | nginx日志轮转，用于logrotate服务的日志切割 |\n| `/etc/nginx` <br/> `/etc/nginx/nginx.conf` <br/> `/etc/nginx/conf.d` <br/> `/etc/nginx/conf.d/default.conf`                                                |  目录、配置文件 | nginx主配置文件 |\n| `/etc/nginx/fastcgi_params` <br/> `/etc/nginx/uwsgi_params` <br/> `/etc/nginx/scgi_params`                                                                 |  配置文件 | cgi配置相关，fastcgi配置 |\n| `/etc/nginx/koi-utf` <br/> `/etc/nginx/koi-win` <br/> `/etc/nginx/win-utf `                                                                                |  配置文件 | 编码转换映射转化文件 很少用到 |\n| `/etc/nginx/mime.types`                                                                                                                                    |  配置文件 | 设置HTTP协议的Content-Type与扩展名对应关系 |\n| `/etc/sysconfig/nginx` <br/> `/etc/sysconfig/nginx-debug` <br/> `/usr/lib/system/system/nginx-debug.service` <br/> `/usr/lib/systemd/system/nginx.service` |  配置文件 | 用于配置出系统守护进程管理器管理方式，取代旧的init.d的脚本管理方式 |\n| `/usr/lib64/nginx/modules` <br/> `/etc/nginx/modules`                                                                                                      |  目录 | nginx 模块目录 |\n| `/usr/sbin/nginx` <br/> `/usr/sbin/nginx-debug`                                                                                                            |  命令 | nginx 服务的启动管理终端命令， nginx 服务的启动、关闭、配置、管理 |\n| `/usr/share/doc/nginx-1.12.2` <br/> `/usr/share/doc/nginx-1.12.2/COPYRIGHT` <br/> `/usr/share/man/man8/nginx.8.gz`                                         |  文件、目录 | nginx的手册和帮助文件 |\n| `/var/cache/nginx`                                                                                                                                         | 目录 | nginx的缓存目录 |\n| `/var/log/nginx`                                                                                                                                           | 目录 | nginx的日志目录 |\n\n### 2. 编译参数\n\n查看编译时所用到的参数 `nginx -V` 大写\n\n```\n[root@iz2ze4kikm9076bxac1noqz opt]# nginx -V\nnginx version: nginx/1.12.2\nbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)\nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC' --with-ld-opt='-Wl,-z,relro -Wl,-z,now -pie'\n```\n\n| 路径                                                                                                                                                                                                                                                                                                                                     |             作用                |\n| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------- |\n| `--prefix=/etc/nginx` <br/> `--sbin-path=/usr/sbin/nginx`  <br/> `--modules-path=/usr/lib64/nginx/modules` <br/> `--conf-path=/etc/nginx/nginx.conf` <br/> `--error-log-path=/var/log/nginx/error.log` <br/> `--http-log-path=/var/log/nginx/access.log` <br/> `--pid-path=/var/run/nginx.pid` <br/> `--lock-path=/var/run/nginx.lock` | 安装目的目录或路径 nginx 基础路径 |\n| `--http-client-body-temp-path=/var/cache/nginx/client_temp` <br/> `--http-proxy-temp-path=/var/cache/nginx/proxy_temp`  <br/> `--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp` <br/> `--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp` <br/> `--http-scgi-temp-path=/var/cache/nginx/scgi_temp`                             | 执行对应模块时，nginx所保留的临时文件 |\n| `--user=nginx --group=nginx`                                                                                                                                                                                                                                                                                                           | 设定nginx进程启动的用户和用户组 |\n| `--with-cc-opt= ... `                                                                                                                                                                                                                                                                                                                  | 设置额外的参数将被添加到CFLAGS变量 不需要了解 |\n| `--with-ld-opt= ... `                                                                                                                                                                                                                                                                                                                  | 设置附件的参数，链接系统库 |\n\n\n### 3. 基本配置语法 nginx.conf default.conf\n\n#### 全局性、服务级别配置\n\n|     配置     |             作用                |\n| ------------ | ------------------------------- |\n|user|设置nginx服务的系统使用用户，一般为nginx，不用修改|\n|worker_processes   | 工作进程数，一般和cpu核数保持一致即可|\n|error_log|nginx错误日志|\n|pid|nginx服务启动时的pid|\n\n#### 事件模块配置 events\n\n|     配置     |             作用                |\n| ------------ | ------------------------------- |\n|worker_connections|每个进程运行的最大连接数 最大65535，一般10000左右最多 |\n|use|工作进程数，内核模型|\n\n#### default.conf 配置\n\n``` nginx\nserver {\n    listen       80; # 监听的端口号\n    server_name  localhost; # 服务的域名\n\n    #charset koi8-r;\n    #access_log  /var/log/nginx/host.access.log  main;\n    \n    # 首页路径或子路径\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    # 错误页面\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ {\n    #    proxy_pass   http://127.0.0.1;\n    #}\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ {\n    #    root           html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #}\n\n    # deny access to .htaccess files, if Apache's document root\n    # concurs with nginx's one\n    #\n    #location ~ /\\.ht {\n    #    deny  all;\n    #}\n}\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"nginx-入门到实践-慕课网","published":1,"updated":"2020-09-11T01:04:35.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz95002f6wo1hmeq782v","content":"<p>nginx 是一个开源且高性能、可靠的HTTP中间件、代理服务。</p>\n<p>安装 <code>yum install nginx</code></p>\n<a id=\"more\"></a>\n\n<h3 id=\"1-安装目录\"><a href=\"#1-安装目录\" class=\"headerlink\" title=\"1. 安装目录\"></a>1. 安装目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz opt]# rpm -ql nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;logrotate.d&#x2F;nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;fastcgi_params</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;koi-utf</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;koi-win</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;mime.types</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;modules</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;scgi_params</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;uwsgi_params</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;win-utf</span><br><span class=\"line\">&#x2F;etc&#x2F;sysconfig&#x2F;nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;sysconfig&#x2F;nginx-debug</span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx-debug.service</span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class=\"line\">&#x2F;usr&#x2F;lib64&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules</span><br><span class=\"line\">&#x2F;usr&#x2F;libexec&#x2F;initscripts&#x2F;legacy-actions&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;libexec&#x2F;initscripts&#x2F;legacy-actions&#x2F;nginx&#x2F;check-reload</span><br><span class=\"line\">&#x2F;usr&#x2F;libexec&#x2F;initscripts&#x2F;legacy-actions&#x2F;nginx&#x2F;upgrade</span><br><span class=\"line\">&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;sbin&#x2F;nginx-debug</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx-1.12.2</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx-1.12.2&#x2F;COPYRIGHT</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;man&#x2F;man8&#x2F;nginx.8.gz</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;50x.html</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</span><br><span class=\"line\">&#x2F;var&#x2F;cache&#x2F;nginx</span><br><span class=\"line\">&#x2F;var&#x2F;log&#x2F;nginx</span><br></pre></td></tr></table></figure>\n\n\n<table>\n<thead>\n<tr>\n<th>路径</th>\n<th>类型</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>/etc/logrotate.d/nginx</code></td>\n<td>配置文件</td>\n<td>nginx日志轮转，用于logrotate服务的日志切割</td>\n</tr>\n<tr>\n<td><code>/etc/nginx</code> <br/> <code>/etc/nginx/nginx.conf</code> <br/> <code>/etc/nginx/conf.d</code> <br/> <code>/etc/nginx/conf.d/default.conf</code></td>\n<td>目录、配置文件</td>\n<td>nginx主配置文件</td>\n</tr>\n<tr>\n<td><code>/etc/nginx/fastcgi_params</code> <br/> <code>/etc/nginx/uwsgi_params</code> <br/> <code>/etc/nginx/scgi_params</code></td>\n<td>配置文件</td>\n<td>cgi配置相关，fastcgi配置</td>\n</tr>\n<tr>\n<td><code>/etc/nginx/koi-utf</code> <br/> <code>/etc/nginx/koi-win</code> <br/> <code>/etc/nginx/win-utf </code></td>\n<td>配置文件</td>\n<td>编码转换映射转化文件 很少用到</td>\n</tr>\n<tr>\n<td><code>/etc/nginx/mime.types</code></td>\n<td>配置文件</td>\n<td>设置HTTP协议的Content-Type与扩展名对应关系</td>\n</tr>\n<tr>\n<td><code>/etc/sysconfig/nginx</code> <br/> <code>/etc/sysconfig/nginx-debug</code> <br/> <code>/usr/lib/system/system/nginx-debug.service</code> <br/> <code>/usr/lib/systemd/system/nginx.service</code></td>\n<td>配置文件</td>\n<td>用于配置出系统守护进程管理器管理方式，取代旧的init.d的脚本管理方式</td>\n</tr>\n<tr>\n<td><code>/usr/lib64/nginx/modules</code> <br/> <code>/etc/nginx/modules</code></td>\n<td>目录</td>\n<td>nginx 模块目录</td>\n</tr>\n<tr>\n<td><code>/usr/sbin/nginx</code> <br/> <code>/usr/sbin/nginx-debug</code></td>\n<td>命令</td>\n<td>nginx 服务的启动管理终端命令， nginx 服务的启动、关闭、配置、管理</td>\n</tr>\n<tr>\n<td><code>/usr/share/doc/nginx-1.12.2</code> <br/> <code>/usr/share/doc/nginx-1.12.2/COPYRIGHT</code> <br/> <code>/usr/share/man/man8/nginx.8.gz</code></td>\n<td>文件、目录</td>\n<td>nginx的手册和帮助文件</td>\n</tr>\n<tr>\n<td><code>/var/cache/nginx</code></td>\n<td>目录</td>\n<td>nginx的缓存目录</td>\n</tr>\n<tr>\n<td><code>/var/log/nginx</code></td>\n<td>目录</td>\n<td>nginx的日志目录</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-编译参数\"><a href=\"#2-编译参数\" class=\"headerlink\" title=\"2. 编译参数\"></a>2. 编译参数</h3><p>查看编译时所用到的参数 <code>nginx -V</code> 大写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz opt]# nginx -V</span><br><span class=\"line\">nginx version: nginx&#x2F;1.12.2</span><br><span class=\"line\">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)</span><br><span class=\"line\">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">TLS SNI support enabled</span><br><span class=\"line\">configure arguments: --prefix&#x3D;&#x2F;etc&#x2F;nginx --sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx --modules-path&#x3D;&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules --conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf --error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log --http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log --pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.pid --lock-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.lock --http-client-body-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;client_temp --http-proxy-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;proxy_temp --http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;fastcgi_temp --http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;uwsgi_temp --http-scgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;scgi_temp --user&#x3D;nginx --group&#x3D;nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt&#x3D;&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE&#x3D;2 -fexceptions -fstack-protector-strong --param&#x3D;ssp-buffer-size&#x3D;4 -grecord-gcc-switches -m64 -mtune&#x3D;generic -fPIC&#39; --with-ld-opt&#x3D;&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>路径</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>--prefix=/etc/nginx</code> <br/> <code>--sbin-path=/usr/sbin/nginx</code>  <br/> <code>--modules-path=/usr/lib64/nginx/modules</code> <br/> <code>--conf-path=/etc/nginx/nginx.conf</code> <br/> <code>--error-log-path=/var/log/nginx/error.log</code> <br/> <code>--http-log-path=/var/log/nginx/access.log</code> <br/> <code>--pid-path=/var/run/nginx.pid</code> <br/> <code>--lock-path=/var/run/nginx.lock</code></td>\n<td>安装目的目录或路径 nginx 基础路径</td>\n</tr>\n<tr>\n<td><code>--http-client-body-temp-path=/var/cache/nginx/client_temp</code> <br/> <code>--http-proxy-temp-path=/var/cache/nginx/proxy_temp</code>  <br/> <code>--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp</code> <br/> <code>--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp</code> <br/> <code>--http-scgi-temp-path=/var/cache/nginx/scgi_temp</code></td>\n<td>执行对应模块时，nginx所保留的临时文件</td>\n</tr>\n<tr>\n<td><code>--user=nginx --group=nginx</code></td>\n<td>设定nginx进程启动的用户和用户组</td>\n</tr>\n<tr>\n<td><code>--with-cc-opt= ... </code></td>\n<td>设置额外的参数将被添加到CFLAGS变量 不需要了解</td>\n</tr>\n<tr>\n<td><code>--with-ld-opt= ... </code></td>\n<td>设置附件的参数，链接系统库</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-基本配置语法-nginx-conf-default-conf\"><a href=\"#3-基本配置语法-nginx-conf-default-conf\" class=\"headerlink\" title=\"3. 基本配置语法 nginx.conf default.conf\"></a>3. 基本配置语法 nginx.conf default.conf</h3><h4 id=\"全局性、服务级别配置\"><a href=\"#全局性、服务级别配置\" class=\"headerlink\" title=\"全局性、服务级别配置\"></a>全局性、服务级别配置</h4><table>\n<thead>\n<tr>\n<th>配置</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>user</td>\n<td>设置nginx服务的系统使用用户，一般为nginx，不用修改</td>\n</tr>\n<tr>\n<td>worker_processes</td>\n<td>工作进程数，一般和cpu核数保持一致即可</td>\n</tr>\n<tr>\n<td>error_log</td>\n<td>nginx错误日志</td>\n</tr>\n<tr>\n<td>pid</td>\n<td>nginx服务启动时的pid</td>\n</tr>\n</tbody></table>\n<h4 id=\"事件模块配置-events\"><a href=\"#事件模块配置-events\" class=\"headerlink\" title=\"事件模块配置 events\"></a>事件模块配置 events</h4><table>\n<thead>\n<tr>\n<th>配置</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>worker_connections</td>\n<td>每个进程运行的最大连接数 最大65535，一般10000左右最多</td>\n</tr>\n<tr>\n<td>use</td>\n<td>工作进程数，内核模型</td>\n</tr>\n</tbody></table>\n<h4 id=\"default-conf-配置\"><a href=\"#default-conf-配置\" class=\"headerlink\" title=\"default.conf 配置\"></a>default.conf 配置</h4><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span>       <span class=\"number\">80</span>; <span class=\"comment\"># 监听的端口号</span></span><br><span class=\"line\">    <span class=\"attribute\">server_name</span>  localhost; <span class=\"comment\"># 服务的域名</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#charset koi8-r;</span></span><br><span class=\"line\">    <span class=\"comment\">#access_log  /var/log/nginx/host.access.log  main;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 首页路径或子路径</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span>   /usr/share/nginx/html;</span><br><span class=\"line\">        <span class=\"attribute\">index</span>  index.html index.htm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#error_page  404              /404.html;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># redirect server error pages to the static page /50x.html</span></span><br><span class=\"line\">    <span class=\"comment\"># 错误页面</span></span><br><span class=\"line\">    <span class=\"attribute\">error_page</span>   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /50x.html;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> = /50x.html &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span>   /usr/share/nginx/html;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#location ~ \\.php$ &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    proxy_pass   http://127.0.0.1;</span></span><br><span class=\"line\">    <span class=\"comment\">#&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#location ~ \\.php$ &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    root           html;</span></span><br><span class=\"line\">    <span class=\"comment\">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class=\"line\">    <span class=\"comment\">#    fastcgi_index  index.php;</span></span><br><span class=\"line\">    <span class=\"comment\">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class=\"line\">    <span class=\"comment\">#    include        fastcgi_params;</span></span><br><span class=\"line\">    <span class=\"comment\">#&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class=\"line\">    <span class=\"comment\"># concurs with nginx&#x27;s one</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#location ~ /\\.ht &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    deny  all;</span></span><br><span class=\"line\">    <span class=\"comment\">#&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>nginx 是一个开源且高性能、可靠的HTTP中间件、代理服务。</p>\n<p>安装 <code>yum install nginx</code></p>","more":"<h3 id=\"1-安装目录\"><a href=\"#1-安装目录\" class=\"headerlink\" title=\"1. 安装目录\"></a>1. 安装目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz opt]# rpm -ql nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;logrotate.d&#x2F;nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;fastcgi_params</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;koi-utf</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;koi-win</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;mime.types</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;modules</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;scgi_params</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;uwsgi_params</span><br><span class=\"line\">&#x2F;etc&#x2F;nginx&#x2F;win-utf</span><br><span class=\"line\">&#x2F;etc&#x2F;sysconfig&#x2F;nginx</span><br><span class=\"line\">&#x2F;etc&#x2F;sysconfig&#x2F;nginx-debug</span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx-debug.service</span><br><span class=\"line\">&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class=\"line\">&#x2F;usr&#x2F;lib64&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules</span><br><span class=\"line\">&#x2F;usr&#x2F;libexec&#x2F;initscripts&#x2F;legacy-actions&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;libexec&#x2F;initscripts&#x2F;legacy-actions&#x2F;nginx&#x2F;check-reload</span><br><span class=\"line\">&#x2F;usr&#x2F;libexec&#x2F;initscripts&#x2F;legacy-actions&#x2F;nginx&#x2F;upgrade</span><br><span class=\"line\">&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;sbin&#x2F;nginx-debug</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx-1.12.2</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;doc&#x2F;nginx-1.12.2&#x2F;COPYRIGHT</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;man&#x2F;man8&#x2F;nginx.8.gz</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;50x.html</span><br><span class=\"line\">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html</span><br><span class=\"line\">&#x2F;var&#x2F;cache&#x2F;nginx</span><br><span class=\"line\">&#x2F;var&#x2F;log&#x2F;nginx</span><br></pre></td></tr></table></figure>\n\n\n<table>\n<thead>\n<tr>\n<th>路径</th>\n<th>类型</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>/etc/logrotate.d/nginx</code></td>\n<td>配置文件</td>\n<td>nginx日志轮转，用于logrotate服务的日志切割</td>\n</tr>\n<tr>\n<td><code>/etc/nginx</code> <br/> <code>/etc/nginx/nginx.conf</code> <br/> <code>/etc/nginx/conf.d</code> <br/> <code>/etc/nginx/conf.d/default.conf</code></td>\n<td>目录、配置文件</td>\n<td>nginx主配置文件</td>\n</tr>\n<tr>\n<td><code>/etc/nginx/fastcgi_params</code> <br/> <code>/etc/nginx/uwsgi_params</code> <br/> <code>/etc/nginx/scgi_params</code></td>\n<td>配置文件</td>\n<td>cgi配置相关，fastcgi配置</td>\n</tr>\n<tr>\n<td><code>/etc/nginx/koi-utf</code> <br/> <code>/etc/nginx/koi-win</code> <br/> <code>/etc/nginx/win-utf </code></td>\n<td>配置文件</td>\n<td>编码转换映射转化文件 很少用到</td>\n</tr>\n<tr>\n<td><code>/etc/nginx/mime.types</code></td>\n<td>配置文件</td>\n<td>设置HTTP协议的Content-Type与扩展名对应关系</td>\n</tr>\n<tr>\n<td><code>/etc/sysconfig/nginx</code> <br/> <code>/etc/sysconfig/nginx-debug</code> <br/> <code>/usr/lib/system/system/nginx-debug.service</code> <br/> <code>/usr/lib/systemd/system/nginx.service</code></td>\n<td>配置文件</td>\n<td>用于配置出系统守护进程管理器管理方式，取代旧的init.d的脚本管理方式</td>\n</tr>\n<tr>\n<td><code>/usr/lib64/nginx/modules</code> <br/> <code>/etc/nginx/modules</code></td>\n<td>目录</td>\n<td>nginx 模块目录</td>\n</tr>\n<tr>\n<td><code>/usr/sbin/nginx</code> <br/> <code>/usr/sbin/nginx-debug</code></td>\n<td>命令</td>\n<td>nginx 服务的启动管理终端命令， nginx 服务的启动、关闭、配置、管理</td>\n</tr>\n<tr>\n<td><code>/usr/share/doc/nginx-1.12.2</code> <br/> <code>/usr/share/doc/nginx-1.12.2/COPYRIGHT</code> <br/> <code>/usr/share/man/man8/nginx.8.gz</code></td>\n<td>文件、目录</td>\n<td>nginx的手册和帮助文件</td>\n</tr>\n<tr>\n<td><code>/var/cache/nginx</code></td>\n<td>目录</td>\n<td>nginx的缓存目录</td>\n</tr>\n<tr>\n<td><code>/var/log/nginx</code></td>\n<td>目录</td>\n<td>nginx的日志目录</td>\n</tr>\n</tbody></table>\n<h3 id=\"2-编译参数\"><a href=\"#2-编译参数\" class=\"headerlink\" title=\"2. 编译参数\"></a>2. 编译参数</h3><p>查看编译时所用到的参数 <code>nginx -V</code> 大写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz opt]# nginx -V</span><br><span class=\"line\">nginx version: nginx&#x2F;1.12.2</span><br><span class=\"line\">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)</span><br><span class=\"line\">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">TLS SNI support enabled</span><br><span class=\"line\">configure arguments: --prefix&#x3D;&#x2F;etc&#x2F;nginx --sbin-path&#x3D;&#x2F;usr&#x2F;sbin&#x2F;nginx --modules-path&#x3D;&#x2F;usr&#x2F;lib64&#x2F;nginx&#x2F;modules --conf-path&#x3D;&#x2F;etc&#x2F;nginx&#x2F;nginx.conf --error-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log --http-log-path&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log --pid-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.pid --lock-path&#x3D;&#x2F;var&#x2F;run&#x2F;nginx.lock --http-client-body-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;client_temp --http-proxy-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;proxy_temp --http-fastcgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;fastcgi_temp --http-uwsgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;uwsgi_temp --http-scgi-temp-path&#x3D;&#x2F;var&#x2F;cache&#x2F;nginx&#x2F;scgi_temp --user&#x3D;nginx --group&#x3D;nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt&#x3D;&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE&#x3D;2 -fexceptions -fstack-protector-strong --param&#x3D;ssp-buffer-size&#x3D;4 -grecord-gcc-switches -m64 -mtune&#x3D;generic -fPIC&#39; --with-ld-opt&#x3D;&#39;-Wl,-z,relro -Wl,-z,now -pie&#39;</span><br></pre></td></tr></table></figure>\n\n<table>\n<thead>\n<tr>\n<th>路径</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>--prefix=/etc/nginx</code> <br/> <code>--sbin-path=/usr/sbin/nginx</code>  <br/> <code>--modules-path=/usr/lib64/nginx/modules</code> <br/> <code>--conf-path=/etc/nginx/nginx.conf</code> <br/> <code>--error-log-path=/var/log/nginx/error.log</code> <br/> <code>--http-log-path=/var/log/nginx/access.log</code> <br/> <code>--pid-path=/var/run/nginx.pid</code> <br/> <code>--lock-path=/var/run/nginx.lock</code></td>\n<td>安装目的目录或路径 nginx 基础路径</td>\n</tr>\n<tr>\n<td><code>--http-client-body-temp-path=/var/cache/nginx/client_temp</code> <br/> <code>--http-proxy-temp-path=/var/cache/nginx/proxy_temp</code>  <br/> <code>--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp</code> <br/> <code>--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp</code> <br/> <code>--http-scgi-temp-path=/var/cache/nginx/scgi_temp</code></td>\n<td>执行对应模块时，nginx所保留的临时文件</td>\n</tr>\n<tr>\n<td><code>--user=nginx --group=nginx</code></td>\n<td>设定nginx进程启动的用户和用户组</td>\n</tr>\n<tr>\n<td><code>--with-cc-opt= ... </code></td>\n<td>设置额外的参数将被添加到CFLAGS变量 不需要了解</td>\n</tr>\n<tr>\n<td><code>--with-ld-opt= ... </code></td>\n<td>设置附件的参数，链接系统库</td>\n</tr>\n</tbody></table>\n<h3 id=\"3-基本配置语法-nginx-conf-default-conf\"><a href=\"#3-基本配置语法-nginx-conf-default-conf\" class=\"headerlink\" title=\"3. 基本配置语法 nginx.conf default.conf\"></a>3. 基本配置语法 nginx.conf default.conf</h3><h4 id=\"全局性、服务级别配置\"><a href=\"#全局性、服务级别配置\" class=\"headerlink\" title=\"全局性、服务级别配置\"></a>全局性、服务级别配置</h4><table>\n<thead>\n<tr>\n<th>配置</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>user</td>\n<td>设置nginx服务的系统使用用户，一般为nginx，不用修改</td>\n</tr>\n<tr>\n<td>worker_processes</td>\n<td>工作进程数，一般和cpu核数保持一致即可</td>\n</tr>\n<tr>\n<td>error_log</td>\n<td>nginx错误日志</td>\n</tr>\n<tr>\n<td>pid</td>\n<td>nginx服务启动时的pid</td>\n</tr>\n</tbody></table>\n<h4 id=\"事件模块配置-events\"><a href=\"#事件模块配置-events\" class=\"headerlink\" title=\"事件模块配置 events\"></a>事件模块配置 events</h4><table>\n<thead>\n<tr>\n<th>配置</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>worker_connections</td>\n<td>每个进程运行的最大连接数 最大65535，一般10000左右最多</td>\n</tr>\n<tr>\n<td>use</td>\n<td>工作进程数，内核模型</td>\n</tr>\n</tbody></table>\n<h4 id=\"default-conf-配置\"><a href=\"#default-conf-配置\" class=\"headerlink\" title=\"default.conf 配置\"></a>default.conf 配置</h4><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span>       <span class=\"number\">80</span>; <span class=\"comment\"># 监听的端口号</span></span><br><span class=\"line\">    <span class=\"attribute\">server_name</span>  localhost; <span class=\"comment\"># 服务的域名</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#charset koi8-r;</span></span><br><span class=\"line\">    <span class=\"comment\">#access_log  /var/log/nginx/host.access.log  main;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># 首页路径或子路径</span></span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span>   /usr/share/nginx/html;</span><br><span class=\"line\">        <span class=\"attribute\">index</span>  index.html index.htm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">#error_page  404              /404.html;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># redirect server error pages to the static page /50x.html</span></span><br><span class=\"line\">    <span class=\"comment\"># 错误页面</span></span><br><span class=\"line\">    <span class=\"attribute\">error_page</span>   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /50x.html;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> = /50x.html &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span>   /usr/share/nginx/html;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#location ~ \\.php$ &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    proxy_pass   http://127.0.0.1;</span></span><br><span class=\"line\">    <span class=\"comment\">#&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#location ~ \\.php$ &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    root           html;</span></span><br><span class=\"line\">    <span class=\"comment\">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class=\"line\">    <span class=\"comment\">#    fastcgi_index  index.php;</span></span><br><span class=\"line\">    <span class=\"comment\">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class=\"line\">    <span class=\"comment\">#    include        fastcgi_params;</span></span><br><span class=\"line\">    <span class=\"comment\">#&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class=\"line\">    <span class=\"comment\"># concurs with nginx&#x27;s one</span></span><br><span class=\"line\">    <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"comment\">#location ~ /\\.ht &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">#    deny  all;</span></span><br><span class=\"line\">    <span class=\"comment\">#&#125;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"php artisan 的几个命令","date":"2017-07-15T13:00:22.000Z","_content":"\n数据表添加字段\n\n```\nphp artisan make:migration alter_table_cms_articles_add_column_is_rewardable [--path=database/migrations/xxx] [--database=news]\nphp artisan migrate [--path=database/migrations/xxx] [--database=news]\n```\n\n<!--more-->\n\n生成权限项\n\n```\nphp artisan generate:perms --controller=Permission/TesterAuth\n```\n\n新建模型、控制器等\n\n```\nphp artisan make:repository AdShowApp  --model=AdShowApp\n\nphp artisan make:repository Dudao/BalanceLog --model=Dudao/BalanceLog\n\nphp artisan make:controller Backend/Setting/CurrencyController\n```\n\n\n","source":"_posts/php-artisan-的几个命令.md","raw":"---\ntitle: php artisan 的几个命令\ndate: 2017-07-15 21:00:22\ntags: laravel\ncategories: laravel\n---\n\n数据表添加字段\n\n```\nphp artisan make:migration alter_table_cms_articles_add_column_is_rewardable [--path=database/migrations/xxx] [--database=news]\nphp artisan migrate [--path=database/migrations/xxx] [--database=news]\n```\n\n<!--more-->\n\n生成权限项\n\n```\nphp artisan generate:perms --controller=Permission/TesterAuth\n```\n\n新建模型、控制器等\n\n```\nphp artisan make:repository AdShowApp  --model=AdShowApp\n\nphp artisan make:repository Dudao/BalanceLog --model=Dudao/BalanceLog\n\nphp artisan make:controller Backend/Setting/CurrencyController\n```\n\n\n","slug":"php-artisan-的几个命令","published":1,"updated":"2020-09-11T01:04:35.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz96002h6wo12lqfhd0x","content":"<p>数据表添加字段</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan make:migration alter_table_cms_articles_add_column_is_rewardable [--path&#x3D;database&#x2F;migrations&#x2F;xxx] [--database&#x3D;news]</span><br><span class=\"line\">php artisan migrate [--path&#x3D;database&#x2F;migrations&#x2F;xxx] [--database&#x3D;news]</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<p>生成权限项</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan generate:perms --controller&#x3D;Permission&#x2F;TesterAuth</span><br></pre></td></tr></table></figure>\n\n<p>新建模型、控制器等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan make:repository AdShowApp  --model&#x3D;AdShowApp</span><br><span class=\"line\"></span><br><span class=\"line\">php artisan make:repository Dudao&#x2F;BalanceLog --model&#x3D;Dudao&#x2F;BalanceLog</span><br><span class=\"line\"></span><br><span class=\"line\">php artisan make:controller Backend&#x2F;Setting&#x2F;CurrencyController</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p>数据表添加字段</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan make:migration alter_table_cms_articles_add_column_is_rewardable [--path&#x3D;database&#x2F;migrations&#x2F;xxx] [--database&#x3D;news]</span><br><span class=\"line\">php artisan migrate [--path&#x3D;database&#x2F;migrations&#x2F;xxx] [--database&#x3D;news]</span><br></pre></td></tr></table></figure>","more":"<p>生成权限项</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan generate:perms --controller&#x3D;Permission&#x2F;TesterAuth</span><br></pre></td></tr></table></figure>\n\n<p>新建模型、控制器等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan make:repository AdShowApp  --model&#x3D;AdShowApp</span><br><span class=\"line\"></span><br><span class=\"line\">php artisan make:repository Dudao&#x2F;BalanceLog --model&#x3D;Dudao&#x2F;BalanceLog</span><br><span class=\"line\"></span><br><span class=\"line\">php artisan make:controller Backend&#x2F;Setting&#x2F;CurrencyController</span><br></pre></td></tr></table></figure>"},{"title":"vagrant-docker-php-env","date":"2018-04-07T09:12:51.000Z","_content":"# vagrant-docker-php-env\n## Mac 系统下 vagrant-docker-php-env\n\n\n### 折腾了两天，备份一下\n\n在 https://github.com/kasperisager/php-dockerized 的基础上修改，感谢\n\n<!-- more -->\n\n### 1. 下载配置文件 \n\n```\ngit clone https://github.com/zzpwestlife/vagrant-docker-php-env.git\n```\n\n按需修改 Vagrantfile 的虚拟机 ip 和 共享文件目录\n\n```\n:eth1 => \"192.168.10.10\", // 这一行是虚拟机的 ip，安装完成后使用浏览器访问该 ip 即可\nconfig.vm.synced_folder \"/Users/ZouZhipeng/www\", \"/home/vagrant/www\" // 这里是共享目录，前者为本机目录，后者为虚拟机目录\n```\n\n### 2. 进入该目录\n\n```\ncd vagrant-docker-php-env\n```\n\n并将准备好的 nginx 配置放入 php-dockerized/sites/ 目录中\n\n### 3. 安装 vagrant 虚拟机\n\n```\nvagrant up\n```\n\n如果没有安装 vagrant，需要提前安装\n\n这个过程可能会比较漫长，建议开启代理\n\n### 4. 安装完成后进入虚拟机\n\n```\nvagrant status\nvagrant ssh\n```\n\n其他命令，如停止、重启、删除等\n```\nvagrant halt\nvagrant reload\nvagrant destroy\n```\n\n\n### 5. 进入 docker-compose.yml 所在的目录\n\n```\ncd /home/vagrant/www/docker/php-dockerized\n```\n\n\n将 daemon.json 复制至 /etc/docker 目录下\n\n```\nsudo cp ../daemon.json /etc/docker/\n```\n\n这个配置文件替换了 docker 镜像的下载源，使用国内的下载源速度会快些\n\n### 6. 构建镜像\n\n```\ndocker-compose build\n```\n\n### 7. 生成容器并启动\n\n```\ndocker-compose up -d\n```\n\n第一次生成也需要不少时间\n\n### 8. 在本机增加 hosts 映射\n\n```\nvim /etc/hosts\n192.168.10.10 xb.insurance.com\n```\n通过浏览器访问\n\n### 9. 其他命令\n\n```\n# 停止所有容器\ndocker-compose stop\n# 停止并删除容器\ndocker-compose down\n# 进入某个容器\ndocker-compose exec containerName bash\n# 每次修改配置都需要重新 build 一下\ndocker-compose build containerName\n```\n\n> 注意：\n\n本机目录、虚拟机目录、容器目录三者关系要搞清楚\n\nnginx 和 php-fpm 使用 socket 通信，需要设置多个位置\n\n","source":"_posts/vagrant-docker-php-env.md","raw":"---\ntitle: vagrant-docker-php-env\ndate: 2018-04-07 17:12:51\ntags: docker\n---\n# vagrant-docker-php-env\n## Mac 系统下 vagrant-docker-php-env\n\n\n### 折腾了两天，备份一下\n\n在 https://github.com/kasperisager/php-dockerized 的基础上修改，感谢\n\n<!-- more -->\n\n### 1. 下载配置文件 \n\n```\ngit clone https://github.com/zzpwestlife/vagrant-docker-php-env.git\n```\n\n按需修改 Vagrantfile 的虚拟机 ip 和 共享文件目录\n\n```\n:eth1 => \"192.168.10.10\", // 这一行是虚拟机的 ip，安装完成后使用浏览器访问该 ip 即可\nconfig.vm.synced_folder \"/Users/ZouZhipeng/www\", \"/home/vagrant/www\" // 这里是共享目录，前者为本机目录，后者为虚拟机目录\n```\n\n### 2. 进入该目录\n\n```\ncd vagrant-docker-php-env\n```\n\n并将准备好的 nginx 配置放入 php-dockerized/sites/ 目录中\n\n### 3. 安装 vagrant 虚拟机\n\n```\nvagrant up\n```\n\n如果没有安装 vagrant，需要提前安装\n\n这个过程可能会比较漫长，建议开启代理\n\n### 4. 安装完成后进入虚拟机\n\n```\nvagrant status\nvagrant ssh\n```\n\n其他命令，如停止、重启、删除等\n```\nvagrant halt\nvagrant reload\nvagrant destroy\n```\n\n\n### 5. 进入 docker-compose.yml 所在的目录\n\n```\ncd /home/vagrant/www/docker/php-dockerized\n```\n\n\n将 daemon.json 复制至 /etc/docker 目录下\n\n```\nsudo cp ../daemon.json /etc/docker/\n```\n\n这个配置文件替换了 docker 镜像的下载源，使用国内的下载源速度会快些\n\n### 6. 构建镜像\n\n```\ndocker-compose build\n```\n\n### 7. 生成容器并启动\n\n```\ndocker-compose up -d\n```\n\n第一次生成也需要不少时间\n\n### 8. 在本机增加 hosts 映射\n\n```\nvim /etc/hosts\n192.168.10.10 xb.insurance.com\n```\n通过浏览器访问\n\n### 9. 其他命令\n\n```\n# 停止所有容器\ndocker-compose stop\n# 停止并删除容器\ndocker-compose down\n# 进入某个容器\ndocker-compose exec containerName bash\n# 每次修改配置都需要重新 build 一下\ndocker-compose build containerName\n```\n\n> 注意：\n\n本机目录、虚拟机目录、容器目录三者关系要搞清楚\n\nnginx 和 php-fpm 使用 socket 通信，需要设置多个位置\n\n","slug":"vagrant-docker-php-env","published":1,"updated":"2020-09-11T01:04:35.045Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz97002k6wo1970u80aw","content":"<h1 id=\"vagrant-docker-php-env\"><a href=\"#vagrant-docker-php-env\" class=\"headerlink\" title=\"vagrant-docker-php-env\"></a>vagrant-docker-php-env</h1><h2 id=\"Mac-系统下-vagrant-docker-php-env\"><a href=\"#Mac-系统下-vagrant-docker-php-env\" class=\"headerlink\" title=\"Mac 系统下 vagrant-docker-php-env\"></a>Mac 系统下 vagrant-docker-php-env</h2><h3 id=\"折腾了两天，备份一下\"><a href=\"#折腾了两天，备份一下\" class=\"headerlink\" title=\"折腾了两天，备份一下\"></a>折腾了两天，备份一下</h3><p>在 <a href=\"https://github.com/kasperisager/php-dockerized\">https://github.com/kasperisager/php-dockerized</a> 的基础上修改，感谢</p>\n<a id=\"more\"></a>\n\n<h3 id=\"1-下载配置文件\"><a href=\"#1-下载配置文件\" class=\"headerlink\" title=\"1. 下载配置文件\"></a>1. 下载配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;zzpwestlife&#x2F;vagrant-docker-php-env.git</span><br></pre></td></tr></table></figure>\n\n<p>按需修改 Vagrantfile 的虚拟机 ip 和 共享文件目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:eth1 &#x3D;&gt; &quot;192.168.10.10&quot;, &#x2F;&#x2F; 这一行是虚拟机的 ip，安装完成后使用浏览器访问该 ip 即可</span><br><span class=\"line\">config.vm.synced_folder &quot;&#x2F;Users&#x2F;ZouZhipeng&#x2F;www&quot;, &quot;&#x2F;home&#x2F;vagrant&#x2F;www&quot; &#x2F;&#x2F; 这里是共享目录，前者为本机目录，后者为虚拟机目录</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-进入该目录\"><a href=\"#2-进入该目录\" class=\"headerlink\" title=\"2. 进入该目录\"></a>2. 进入该目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd vagrant-docker-php-env</span><br></pre></td></tr></table></figure>\n\n<p>并将准备好的 nginx 配置放入 php-dockerized/sites/ 目录中</p>\n<h3 id=\"3-安装-vagrant-虚拟机\"><a href=\"#3-安装-vagrant-虚拟机\" class=\"headerlink\" title=\"3. 安装 vagrant 虚拟机\"></a>3. 安装 vagrant 虚拟机</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant up</span><br></pre></td></tr></table></figure>\n\n<p>如果没有安装 vagrant，需要提前安装</p>\n<p>这个过程可能会比较漫长，建议开启代理</p>\n<h3 id=\"4-安装完成后进入虚拟机\"><a href=\"#4-安装完成后进入虚拟机\" class=\"headerlink\" title=\"4. 安装完成后进入虚拟机\"></a>4. 安装完成后进入虚拟机</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant status</span><br><span class=\"line\">vagrant ssh</span><br></pre></td></tr></table></figure>\n\n<p>其他命令，如停止、重启、删除等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant halt</span><br><span class=\"line\">vagrant reload</span><br><span class=\"line\">vagrant destroy</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"5-进入-docker-compose-yml-所在的目录\"><a href=\"#5-进入-docker-compose-yml-所在的目录\" class=\"headerlink\" title=\"5. 进入 docker-compose.yml 所在的目录\"></a>5. 进入 docker-compose.yml 所在的目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;home&#x2F;vagrant&#x2F;www&#x2F;docker&#x2F;php-dockerized</span><br></pre></td></tr></table></figure>\n\n\n<p>将 daemon.json 复制至 /etc/docker 目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp ..&#x2F;daemon.json &#x2F;etc&#x2F;docker&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>这个配置文件替换了 docker 镜像的下载源，使用国内的下载源速度会快些</p>\n<h3 id=\"6-构建镜像\"><a href=\"#6-构建镜像\" class=\"headerlink\" title=\"6. 构建镜像\"></a>6. 构建镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose build</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-生成容器并启动\"><a href=\"#7-生成容器并启动\" class=\"headerlink\" title=\"7. 生成容器并启动\"></a>7. 生成容器并启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<p>第一次生成也需要不少时间</p>\n<h3 id=\"8-在本机增加-hosts-映射\"><a href=\"#8-在本机增加-hosts-映射\" class=\"headerlink\" title=\"8. 在本机增加 hosts 映射\"></a>8. 在本机增加 hosts 映射</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;hosts</span><br><span class=\"line\">192.168.10.10 xb.insurance.com</span><br></pre></td></tr></table></figure>\n<p>通过浏览器访问</p>\n<h3 id=\"9-其他命令\"><a href=\"#9-其他命令\" class=\"headerlink\" title=\"9. 其他命令\"></a>9. 其他命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 停止所有容器</span><br><span class=\"line\">docker-compose stop</span><br><span class=\"line\"># 停止并删除容器</span><br><span class=\"line\">docker-compose down</span><br><span class=\"line\"># 进入某个容器</span><br><span class=\"line\">docker-compose exec containerName bash</span><br><span class=\"line\"># 每次修改配置都需要重新 build 一下</span><br><span class=\"line\">docker-compose build containerName</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：</p>\n</blockquote>\n<p>本机目录、虚拟机目录、容器目录三者关系要搞清楚</p>\n<p>nginx 和 php-fpm 使用 socket 通信，需要设置多个位置</p>\n","site":{"data":{}},"excerpt":"<h1 id=\"vagrant-docker-php-env\"><a href=\"#vagrant-docker-php-env\" class=\"headerlink\" title=\"vagrant-docker-php-env\"></a>vagrant-docker-php-env</h1><h2 id=\"Mac-系统下-vagrant-docker-php-env\"><a href=\"#Mac-系统下-vagrant-docker-php-env\" class=\"headerlink\" title=\"Mac 系统下 vagrant-docker-php-env\"></a>Mac 系统下 vagrant-docker-php-env</h2><h3 id=\"折腾了两天，备份一下\"><a href=\"#折腾了两天，备份一下\" class=\"headerlink\" title=\"折腾了两天，备份一下\"></a>折腾了两天，备份一下</h3><p>在 <a href=\"https://github.com/kasperisager/php-dockerized\">https://github.com/kasperisager/php-dockerized</a> 的基础上修改，感谢</p>","more":"<h3 id=\"1-下载配置文件\"><a href=\"#1-下载配置文件\" class=\"headerlink\" title=\"1. 下载配置文件\"></a>1. 下载配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;zzpwestlife&#x2F;vagrant-docker-php-env.git</span><br></pre></td></tr></table></figure>\n\n<p>按需修改 Vagrantfile 的虚拟机 ip 和 共享文件目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:eth1 &#x3D;&gt; &quot;192.168.10.10&quot;, &#x2F;&#x2F; 这一行是虚拟机的 ip，安装完成后使用浏览器访问该 ip 即可</span><br><span class=\"line\">config.vm.synced_folder &quot;&#x2F;Users&#x2F;ZouZhipeng&#x2F;www&quot;, &quot;&#x2F;home&#x2F;vagrant&#x2F;www&quot; &#x2F;&#x2F; 这里是共享目录，前者为本机目录，后者为虚拟机目录</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-进入该目录\"><a href=\"#2-进入该目录\" class=\"headerlink\" title=\"2. 进入该目录\"></a>2. 进入该目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd vagrant-docker-php-env</span><br></pre></td></tr></table></figure>\n\n<p>并将准备好的 nginx 配置放入 php-dockerized/sites/ 目录中</p>\n<h3 id=\"3-安装-vagrant-虚拟机\"><a href=\"#3-安装-vagrant-虚拟机\" class=\"headerlink\" title=\"3. 安装 vagrant 虚拟机\"></a>3. 安装 vagrant 虚拟机</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant up</span><br></pre></td></tr></table></figure>\n\n<p>如果没有安装 vagrant，需要提前安装</p>\n<p>这个过程可能会比较漫长，建议开启代理</p>\n<h3 id=\"4-安装完成后进入虚拟机\"><a href=\"#4-安装完成后进入虚拟机\" class=\"headerlink\" title=\"4. 安装完成后进入虚拟机\"></a>4. 安装完成后进入虚拟机</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant status</span><br><span class=\"line\">vagrant ssh</span><br></pre></td></tr></table></figure>\n\n<p>其他命令，如停止、重启、删除等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant halt</span><br><span class=\"line\">vagrant reload</span><br><span class=\"line\">vagrant destroy</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"5-进入-docker-compose-yml-所在的目录\"><a href=\"#5-进入-docker-compose-yml-所在的目录\" class=\"headerlink\" title=\"5. 进入 docker-compose.yml 所在的目录\"></a>5. 进入 docker-compose.yml 所在的目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;home&#x2F;vagrant&#x2F;www&#x2F;docker&#x2F;php-dockerized</span><br></pre></td></tr></table></figure>\n\n\n<p>将 daemon.json 复制至 /etc/docker 目录下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo cp ..&#x2F;daemon.json &#x2F;etc&#x2F;docker&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>这个配置文件替换了 docker 镜像的下载源，使用国内的下载源速度会快些</p>\n<h3 id=\"6-构建镜像\"><a href=\"#6-构建镜像\" class=\"headerlink\" title=\"6. 构建镜像\"></a>6. 构建镜像</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose build</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-生成容器并启动\"><a href=\"#7-生成容器并启动\" class=\"headerlink\" title=\"7. 生成容器并启动\"></a>7. 生成容器并启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker-compose up -d</span><br></pre></td></tr></table></figure>\n\n<p>第一次生成也需要不少时间</p>\n<h3 id=\"8-在本机增加-hosts-映射\"><a href=\"#8-在本机增加-hosts-映射\" class=\"headerlink\" title=\"8. 在本机增加 hosts 映射\"></a>8. 在本机增加 hosts 映射</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;hosts</span><br><span class=\"line\">192.168.10.10 xb.insurance.com</span><br></pre></td></tr></table></figure>\n<p>通过浏览器访问</p>\n<h3 id=\"9-其他命令\"><a href=\"#9-其他命令\" class=\"headerlink\" title=\"9. 其他命令\"></a>9. 其他命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 停止所有容器</span><br><span class=\"line\">docker-compose stop</span><br><span class=\"line\"># 停止并删除容器</span><br><span class=\"line\">docker-compose down</span><br><span class=\"line\"># 进入某个容器</span><br><span class=\"line\">docker-compose exec containerName bash</span><br><span class=\"line\"># 每次修改配置都需要重新 build 一下</span><br><span class=\"line\">docker-compose build containerName</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：</p>\n</blockquote>\n<p>本机目录、虚拟机目录、容器目录三者关系要搞清楚</p>\n<p>nginx 和 php-fpm 使用 socket 通信，需要设置多个位置</p>"},{"title":"《循序渐进学 Docker》学习 - part 1","date":"2017-06-26T05:04:29.000Z","Categories":"Docker","_content":"\n## 1. Docker 基础\n\nDocker 工作流程：首先，要在 Linux 服务器上安装 Docker 软件包，并启动 Docker Daemon 守护进程。然后，就可以通过 Docker Client 端发送各种指令，Docker Daemon 守护进程执行完指令，向 Client 端返回结果。\n\nDocker 分层：把一个应用分为任意多个层，比如操作系统是第一层，依赖的库和第三方软件是第二层，应用的软件包和配置文件是第三层。如果两个应用有相同的底层，就可以共享这些层。\n\n<!--more-->\n\nDocker 写时复制/写时拷贝策略：Docker 层次是有优先级的，上层和下层有相同的文件和配置时，上层覆盖下层，数据以上层的数据为准。给每个应用一个优先级最高的空白层，如果需要修改下层的文件，就把这个文件拷贝到这个优先级最高的空白层进行修改，保证下层的文件不做任何改变。这样，对于该应用来说，文件已经修改成功，而从其他应用的角度来看，文件没有发生任何改变。\n\n\nDocker 内核虚拟化技术：与宿主机运行在相同的 Linux 内核，不需要指令级模拟，性能消耗非常小，是非常轻量化的虚拟化容器。\n\n\nDocker 具有版本控制和增量更新功能，类似 git。\n\n生产环境的机器上可以同时缓存应用的多个版本镜像，如果新发布的版本有问题，可以快速切换回原来的版本。\n\n因为 Docker 的应用镜像包含应用运行需要的所有软件包、配置和操作系统，所以开发者打包好 Docker 镜像，测试和运维人员从私有仓库下拉，不需要做任何修改，就可以运行起来，并保证和开发者运行的环境完全一致，一处编译，到处运行。\n\n\n## 2. Docker 快速搭建 WordPress 博客网站\n\n只需要两条命令\n\n```\n$ docker run --name db --env MYSQL_ROOT_PASSWORD=example -d mariadb\n\n$ docker run --name myWordPress --link db:mysql -p 8080:80 -d wordpress\n```\n\n分析 1：\n\n> `docker run` 是一条 Docker 命令，后面的所有内容都是 Docker 指令的参数。\n\n> 这条指令的含义（从后向前）是启动一个 mariadb 数据库，并且让这个数据库在后台运行。通过环境变量设置数据库管理员root的密码，并给起了一个唯一的名字 db 进行标识。\n\n`docker run` 首先会从本机检查有没有 mariadb 程序，如果没有，就会从 Docker Hub 搜索并下载该程序， Docker Hub 就像 iPhone 是哪个的 App Store。\n\n分析 2：\n\n> WordPress 是把博客和个性化信息存储到数据库，所以需要和数据库建立连接。`--link db:mysql` 参数，把 WordPress 和数据库建立起了连接。\n\n> WordPress 是通过监听 Apache 的 80 端口对外提供服务。通过 `-p 8080:80` 参数，把原服务的 80\n 端口映射到 8080，这样就可以通过访问 8080 端口来访问服务。URL为 127.0.0.1:8080\n \n\n\n\n","source":"_posts/《循序渐进学-Docker》学习-part-1.md","raw":"---\ntitle: 《循序渐进学 Docker》学习 - part 1\ndate: 2017-06-26 13:04:29\ntags: Docker\nCategories: Docker\n---\n\n## 1. Docker 基础\n\nDocker 工作流程：首先，要在 Linux 服务器上安装 Docker 软件包，并启动 Docker Daemon 守护进程。然后，就可以通过 Docker Client 端发送各种指令，Docker Daemon 守护进程执行完指令，向 Client 端返回结果。\n\nDocker 分层：把一个应用分为任意多个层，比如操作系统是第一层，依赖的库和第三方软件是第二层，应用的软件包和配置文件是第三层。如果两个应用有相同的底层，就可以共享这些层。\n\n<!--more-->\n\nDocker 写时复制/写时拷贝策略：Docker 层次是有优先级的，上层和下层有相同的文件和配置时，上层覆盖下层，数据以上层的数据为准。给每个应用一个优先级最高的空白层，如果需要修改下层的文件，就把这个文件拷贝到这个优先级最高的空白层进行修改，保证下层的文件不做任何改变。这样，对于该应用来说，文件已经修改成功，而从其他应用的角度来看，文件没有发生任何改变。\n\n\nDocker 内核虚拟化技术：与宿主机运行在相同的 Linux 内核，不需要指令级模拟，性能消耗非常小，是非常轻量化的虚拟化容器。\n\n\nDocker 具有版本控制和增量更新功能，类似 git。\n\n生产环境的机器上可以同时缓存应用的多个版本镜像，如果新发布的版本有问题，可以快速切换回原来的版本。\n\n因为 Docker 的应用镜像包含应用运行需要的所有软件包、配置和操作系统，所以开发者打包好 Docker 镜像，测试和运维人员从私有仓库下拉，不需要做任何修改，就可以运行起来，并保证和开发者运行的环境完全一致，一处编译，到处运行。\n\n\n## 2. Docker 快速搭建 WordPress 博客网站\n\n只需要两条命令\n\n```\n$ docker run --name db --env MYSQL_ROOT_PASSWORD=example -d mariadb\n\n$ docker run --name myWordPress --link db:mysql -p 8080:80 -d wordpress\n```\n\n分析 1：\n\n> `docker run` 是一条 Docker 命令，后面的所有内容都是 Docker 指令的参数。\n\n> 这条指令的含义（从后向前）是启动一个 mariadb 数据库，并且让这个数据库在后台运行。通过环境变量设置数据库管理员root的密码，并给起了一个唯一的名字 db 进行标识。\n\n`docker run` 首先会从本机检查有没有 mariadb 程序，如果没有，就会从 Docker Hub 搜索并下载该程序， Docker Hub 就像 iPhone 是哪个的 App Store。\n\n分析 2：\n\n> WordPress 是把博客和个性化信息存储到数据库，所以需要和数据库建立连接。`--link db:mysql` 参数，把 WordPress 和数据库建立起了连接。\n\n> WordPress 是通过监听 Apache 的 80 端口对外提供服务。通过 `-p 8080:80` 参数，把原服务的 80\n 端口映射到 8080，这样就可以通过访问 8080 端口来访问服务。URL为 127.0.0.1:8080\n \n\n\n\n","slug":"《循序渐进学-Docker》学习-part-1","published":1,"updated":"2020-09-11T01:04:35.045Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz98002m6wo1f3154hqt","content":"<h2 id=\"1-Docker-基础\"><a href=\"#1-Docker-基础\" class=\"headerlink\" title=\"1. Docker 基础\"></a>1. Docker 基础</h2><p>Docker 工作流程：首先，要在 Linux 服务器上安装 Docker 软件包，并启动 Docker Daemon 守护进程。然后，就可以通过 Docker Client 端发送各种指令，Docker Daemon 守护进程执行完指令，向 Client 端返回结果。</p>\n<p>Docker 分层：把一个应用分为任意多个层，比如操作系统是第一层，依赖的库和第三方软件是第二层，应用的软件包和配置文件是第三层。如果两个应用有相同的底层，就可以共享这些层。</p>\n<a id=\"more\"></a>\n\n<p>Docker 写时复制/写时拷贝策略：Docker 层次是有优先级的，上层和下层有相同的文件和配置时，上层覆盖下层，数据以上层的数据为准。给每个应用一个优先级最高的空白层，如果需要修改下层的文件，就把这个文件拷贝到这个优先级最高的空白层进行修改，保证下层的文件不做任何改变。这样，对于该应用来说，文件已经修改成功，而从其他应用的角度来看，文件没有发生任何改变。</p>\n<p>Docker 内核虚拟化技术：与宿主机运行在相同的 Linux 内核，不需要指令级模拟，性能消耗非常小，是非常轻量化的虚拟化容器。</p>\n<p>Docker 具有版本控制和增量更新功能，类似 git。</p>\n<p>生产环境的机器上可以同时缓存应用的多个版本镜像，如果新发布的版本有问题，可以快速切换回原来的版本。</p>\n<p>因为 Docker 的应用镜像包含应用运行需要的所有软件包、配置和操作系统，所以开发者打包好 Docker 镜像，测试和运维人员从私有仓库下拉，不需要做任何修改，就可以运行起来，并保证和开发者运行的环境完全一致，一处编译，到处运行。</p>\n<h2 id=\"2-Docker-快速搭建-WordPress-博客网站\"><a href=\"#2-Docker-快速搭建-WordPress-博客网站\" class=\"headerlink\" title=\"2. Docker 快速搭建 WordPress 博客网站\"></a>2. Docker 快速搭建 WordPress 博客网站</h2><p>只需要两条命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker run --name db --env MYSQL_ROOT_PASSWORD&#x3D;example -d mariadb</span><br><span class=\"line\"></span><br><span class=\"line\">$ docker run --name myWordPress --link db:mysql -p 8080:80 -d wordpress</span><br></pre></td></tr></table></figure>\n\n<p>分析 1：</p>\n<blockquote>\n<p><code>docker run</code> 是一条 Docker 命令，后面的所有内容都是 Docker 指令的参数。</p>\n</blockquote>\n<blockquote>\n<p>这条指令的含义（从后向前）是启动一个 mariadb 数据库，并且让这个数据库在后台运行。通过环境变量设置数据库管理员root的密码，并给起了一个唯一的名字 db 进行标识。</p>\n</blockquote>\n<p><code>docker run</code> 首先会从本机检查有没有 mariadb 程序，如果没有，就会从 Docker Hub 搜索并下载该程序， Docker Hub 就像 iPhone 是哪个的 App Store。</p>\n<p>分析 2：</p>\n<blockquote>\n<p>WordPress 是把博客和个性化信息存储到数据库，所以需要和数据库建立连接。<code>--link db:mysql</code> 参数，把 WordPress 和数据库建立起了连接。</p>\n</blockquote>\n<blockquote>\n<p>WordPress 是通过监听 Apache 的 80 端口对外提供服务。通过 <code>-p 8080:80</code> 参数，把原服务的 80<br> 端口映射到 8080，这样就可以通过访问 8080 端口来访问服务。URL为 127.0.0.1:8080</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-Docker-基础\"><a href=\"#1-Docker-基础\" class=\"headerlink\" title=\"1. Docker 基础\"></a>1. Docker 基础</h2><p>Docker 工作流程：首先，要在 Linux 服务器上安装 Docker 软件包，并启动 Docker Daemon 守护进程。然后，就可以通过 Docker Client 端发送各种指令，Docker Daemon 守护进程执行完指令，向 Client 端返回结果。</p>\n<p>Docker 分层：把一个应用分为任意多个层，比如操作系统是第一层，依赖的库和第三方软件是第二层，应用的软件包和配置文件是第三层。如果两个应用有相同的底层，就可以共享这些层。</p>","more":"<p>Docker 写时复制/写时拷贝策略：Docker 层次是有优先级的，上层和下层有相同的文件和配置时，上层覆盖下层，数据以上层的数据为准。给每个应用一个优先级最高的空白层，如果需要修改下层的文件，就把这个文件拷贝到这个优先级最高的空白层进行修改，保证下层的文件不做任何改变。这样，对于该应用来说，文件已经修改成功，而从其他应用的角度来看，文件没有发生任何改变。</p>\n<p>Docker 内核虚拟化技术：与宿主机运行在相同的 Linux 内核，不需要指令级模拟，性能消耗非常小，是非常轻量化的虚拟化容器。</p>\n<p>Docker 具有版本控制和增量更新功能，类似 git。</p>\n<p>生产环境的机器上可以同时缓存应用的多个版本镜像，如果新发布的版本有问题，可以快速切换回原来的版本。</p>\n<p>因为 Docker 的应用镜像包含应用运行需要的所有软件包、配置和操作系统，所以开发者打包好 Docker 镜像，测试和运维人员从私有仓库下拉，不需要做任何修改，就可以运行起来，并保证和开发者运行的环境完全一致，一处编译，到处运行。</p>\n<h2 id=\"2-Docker-快速搭建-WordPress-博客网站\"><a href=\"#2-Docker-快速搭建-WordPress-博客网站\" class=\"headerlink\" title=\"2. Docker 快速搭建 WordPress 博客网站\"></a>2. Docker 快速搭建 WordPress 博客网站</h2><p>只需要两条命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ docker run --name db --env MYSQL_ROOT_PASSWORD&#x3D;example -d mariadb</span><br><span class=\"line\"></span><br><span class=\"line\">$ docker run --name myWordPress --link db:mysql -p 8080:80 -d wordpress</span><br></pre></td></tr></table></figure>\n\n<p>分析 1：</p>\n<blockquote>\n<p><code>docker run</code> 是一条 Docker 命令，后面的所有内容都是 Docker 指令的参数。</p>\n</blockquote>\n<blockquote>\n<p>这条指令的含义（从后向前）是启动一个 mariadb 数据库，并且让这个数据库在后台运行。通过环境变量设置数据库管理员root的密码，并给起了一个唯一的名字 db 进行标识。</p>\n</blockquote>\n<p><code>docker run</code> 首先会从本机检查有没有 mariadb 程序，如果没有，就会从 Docker Hub 搜索并下载该程序， Docker Hub 就像 iPhone 是哪个的 App Store。</p>\n<p>分析 2：</p>\n<blockquote>\n<p>WordPress 是把博客和个性化信息存储到数据库，所以需要和数据库建立连接。<code>--link db:mysql</code> 参数，把 WordPress 和数据库建立起了连接。</p>\n</blockquote>\n<blockquote>\n<p>WordPress 是通过监听 Apache 的 80 端口对外提供服务。通过 <code>-p 8080:80</code> 参数，把原服务的 80<br> 端口映射到 8080，这样就可以通过访问 8080 端口来访问服务。URL为 127.0.0.1:8080</p>\n</blockquote>"},{"title":"《财经》CMS后台查询功能的实现（基于Laravel Repository）","date":"2017-05-24T06:29:57.000Z","_content":"\n使用 [RequestCriteria](https://github.com/andersao/l5-repository) 统一搜索功能，可自动根据 url 按字段进行搜索，无需写方法\n\n<!--more-->\n\n# 第一部分 单表查询\n\n## 1. 后台搜索框的基本代码：\n\n```\n<div class=\"panel-group\">\n    <div class=\"panel panel-default\" style=\"border: none;\">\n        <div class=\"panel-heading\">\n            <h4 class=\"panel-title\">\n                <a data-toggle=\"collapse\" href=\"#wrapper_search\"\n                   aria-expanded=\"false\" @if(false == $searchMode)class=\"collapsed\" @endif >\n                    搜索相关\n                </a>\n            </h4>\n        </div>\n        <div id=\"wrapper_search\" class=\"panel-collapse collapse @if(true == $searchMode)in @endif\"\n             aria-expanded=\"false\">\n            <div class=\"panel-body\">\n                <div class=\"portlet-heading\">\n                    <form id=\"frm_search_info\" class=\"text-dark form-horizontal\" action=\"\">\n                        <input type=\"hidden\" value=\"\"/>\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"order_sn\" class=\"control-label col-sm-4\">订单号</label>\n\n                            <div class=\"col-sm-8\">\n                                <input type=\"text\" class=\"form-control\" id=\"title\" name=\"id\"\n                                       value=\"{{isset($searchCondition['id'])?$searchCondition['id']:''}}\"/>\n\n                            </div>\n                        </div>\n\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"snap_goods_name\" class=\"control-label col-sm-4\">商品名称</label>\n\n                            <div class=\"col-sm-8\">\n                                <input type=\"text\" class=\"form-control\" id=\"title\" name=\"snap_goods_name\"\n                                       value=\"{{isset($searchCondition['snap_goods_name'])?$searchCondition['snap_goods_name']:''}}\"/>\n\n                            </div>\n                        </div>\n\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"paymentInfo.payment_type\" class=\"control-label col-sm-4\">支付方式</label>\n\n                            <div class=\"col-sm-8\">\n                                <select class=\"form-control input-lg select2\" id=\"paymentInfo.payment_type\" name=\"paymentInfo.payment_type\"\n                                        style=\"width: 192px;\">\n                                    <option value=\"\">全部</option>\n                                    @if(isset($paymentType))\n                                        @foreach($paymentType as $index => $item)\n                                            <option value=\"{{$index}}\"\n                                                    @if(isset($searchCondition['paymentInfo.payment_type']) && $index == $searchCondition['paymentInfo.payment_type']) selected=\"selected\" @endif>{{$item}}</option>\n                                        @endforeach\n                                    @endif\n                                </select>\n\n                            </div>\n                        </div>\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"created_at@\" class=\"control-label col-sm-4\">至</label>\n\n                            <div class=\"col-sm-8\">\n                                <div class=\"input-group datetimepicker date\" id=\"end_time_picker\">\n                                    <input class=\"form-control\" id=\"created_at@\"\n                                           name=\"created_at@\" type=\"text\"\n                                           value=\"@if(isset($searchCondition['created_at@']) && $searchCondition['created_at@']){{$searchCondition['created_at@']}}@endif\">\n                                    <span class=\"input-group-addon\" for=\"created_at@\">\n                            <span class=\"glyphicon glyphicon-calendar\"></span>\n                        </span>\n                                </div>\n\n                            </div>\n                        </div>\n\n                        <div class=\"form-group col-sm-4 pull-right\">\n                            <button type=\"button\" class=\"btn btn-default m-l-10\" id=\"btn_clear\">清空</button>\n                            <button type=\"button\" class=\"btn btn-purple m-l-10\" id=\"btn_export\">\n                                Excel 导出\n                            </button>\n                            <button type=\"button\" class=\"btn btn-primary m-l-10\" id=\"btn_search\">搜索</button>\n\n                        </div>\n\n                        <div class=\"clearfix\"></div>\n\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</div>\n```\n要求表单中的 name 与数据表中的字段名完全一致。\n注意：这里是 button，而不是 submit\n\n\n## 2. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\n\n如：\n\n```\nprotected $fieldSearchable = [\n    'id',\n    'snap_goods_name' => 'like',\n    'username',\n    'order_status',\n    'created_at' => \">=\",\n    'created_at@' => \"<=\",\n    'source_id',\n    'paymentInfo.payment_type'\n];\n```\n注意：\n- 要列出所有需要进行搜索的字段。\n- 等于的可以省略，\n- 模糊搜索用 like，\n- 范围搜索也直接写。\n- 如果一个字段需要用一次以上，需要对 key 进行重写，加一个@\n\n其中，最后一个功能是在 BaseRepositoryEloquent 中定义的。\n\n默认的键值间的分隔符为：， 如http://prettus.local/users?search=name:John Doe;email:john@gmail.com\n可以进行自定义。\n在 BaseRepositoryEloquent.php 的构造方法中，\n`$this->keyValueSeparator = '|:'`。\n\n组件中默认不包含范围选择符，即sql中的between用法。我们进行了改写，以支持该用法。\n\nBaseRepositoryEloquent 中，添加解析搜索url的方法。\n\n```\npublic function parserSearchData($searchData)\n{\n    if (!empty($searchData) && is_array($searchData)) {\n        foreach ($searchData as $index => $item) {\n            $method = sprintf(\"parser%s4Search\", ucfirst(camel_case(str_replace('@', '', $index))));\n            $model = $this->getModel();\n            if (method_exists($model, $method)) {\n                $searchData[$index] = $model->{$method}($item);\n            }\n        }\n    }\n\n    return $searchData;\n}\n```\n\n以及解析原始搜索数据的方法\n\n```\npublic function parserOriginSearchData($search)\n{\n    $searchData = [];\n    if (stripos($search, $this->keyValueSeparator)) {\n        $fields = explode($this->paramSeparator, $search);\n\n        foreach ($fields as $row) {\n            try {\n                list($field, $value) = explode($this->keyValueSeparator, $row);\n                $searchData[trim($field)] = trim($value);\n            } catch (\\Exception $e) {\n                //Surround offset error\n            }\n        }\n    }\n    return $searchData;\n}\n```\n\n业务需要，添加了整合后的获取搜索参数的方法\n\n```\npublic function getSearchData($param = null, $is_origin = true)\n{\n    $search = $this->request->get(config('repository.criteria.params.search', 'search'), null);\n    $searchData = $this->parserOriginSearchData($search);\n    if (false == $is_origin) {\n        $searchData = $this->parserSearchData($searchData);\n    }\n    if (!empty($param)) {\n        if (isset($searchData[$param])) {\n            $searchData = $searchData[$param];\n        } else {\n            $searchData = null;\n        }\n    }\n    return $searchData;\n}\n```\n\n## 3. js 文件中添加解析url的方法。\n\n```\n// 搜索 按钮\nsearchWithParams('/magazine/order?page=1');\n\nfunction searchWithParams(url) {\n    $(\"#btn_search\").click(function () {\n        var params = {};\n        $(\"#frm_search_info select, #frm_search_info input[type=text], #frm_search_info input[type=hidden]\").each(function () {\n            var value = $(this).val();\n            if ('' != value) {\n                params[$(this).attr('name')] = value;\n            }\n        });\n\n        if (!$.isEmptyObject(params)) {\n            url += \"&search=\" + parserParams2Url(params);\n        }\n\n        location.href = url;\n    });\n\n}\n```\n\n该方法实现了对所有输入框、下拉框等搜索框内容的收集并处理，生成一个 Repository 可解析的 url。\n\n\n## 4. 回显的数据不需要通过控制器获取后回传，在模板中通过 $searchCondition 全局变量获取即可\n\n如何使用？\n控制器中的方法会非常简洁：\n\n```\npublic function getIndex(Request $request)\n{\n    $flashes = $this->repositoryInterface->paginate();\n\n    return View::make(\"flash/index\", array(\n        \"flashes\" => $flashes,\n        \"flashTypes\" => Flash::$flashTypes,\n    ));\n}\n```\n\n---\n\n# 第二部分 跨表查询\n\n上述搜索方法只是实现了单表搜索，如果搜索涉及到跨表该怎么处理？\n\n场景：在模型Order的列表页进行搜索，但搜索的关键字是模型Payment的一个字段，模型Payment有一个指向模型Order的外键 order_id。\n\n实现：\n\n## 1. 在 app/Models/Order 中，建立与 Payment 模型的关联关系。\n\n```\n/**\n * 支付信息关联关系\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\HasOne\n */\npublic function paymentInfo()\n{\n    return $this->hasOne('App\\Models\\Payment', 'order_id', 'id');\n}\n```\n\n## 2. Order 的模板文件（列表 resources/views/backend/order/index.blade.php）中，搜索相关部分的 name 和字段名都要加上关联关系的方法前缀。\n\n```\n<div class=\"form-group col-sm-4 pull-left\">\n    <label for=\"paymentInfo.payment_type\" class=\"control-label col-sm-4\">支付方式</label>\n\n    <div class=\"col-sm-8\">\n        <select class=\"form-control input-lg select2\" id=\"paymentInfo.payment_type\" name=\"paymentInfo.payment_type\"\n                style=\"width: 192px;\">\n            <option value=\"\">全部</option>\n            @if(isset($paymentType))\n                @foreach($paymentType as $index => $item)\n                    <option value=\"{{$index}}\"\n                            @if(isset($searchCondition['paymentInfo.payment_type']) && $index == $searchCondition['paymentInfo.payment_type']) selected=\"selected\" @endif>{{$item}}</option>\n                @endforeach\n            @endif\n        </select>\n\n    </div>\n</div>\n```\n\n## 3. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\n\n如：\n\n```\nprotected $fieldSearchable = [\n    'paymentInfo.payment_type'\n];\n\n要与模板文件的name一致。\n\n","source":"_posts/《财经》CMS后台查询功能的实现（基于Laravel-Repository）.md","raw":"---\ntitle: 《财经》CMS后台查询功能的实现（基于Laravel Repository）\ndate: 2017-05-24 14:29:57\ntags: laravel\ncategories: laravel\n---\n\n使用 [RequestCriteria](https://github.com/andersao/l5-repository) 统一搜索功能，可自动根据 url 按字段进行搜索，无需写方法\n\n<!--more-->\n\n# 第一部分 单表查询\n\n## 1. 后台搜索框的基本代码：\n\n```\n<div class=\"panel-group\">\n    <div class=\"panel panel-default\" style=\"border: none;\">\n        <div class=\"panel-heading\">\n            <h4 class=\"panel-title\">\n                <a data-toggle=\"collapse\" href=\"#wrapper_search\"\n                   aria-expanded=\"false\" @if(false == $searchMode)class=\"collapsed\" @endif >\n                    搜索相关\n                </a>\n            </h4>\n        </div>\n        <div id=\"wrapper_search\" class=\"panel-collapse collapse @if(true == $searchMode)in @endif\"\n             aria-expanded=\"false\">\n            <div class=\"panel-body\">\n                <div class=\"portlet-heading\">\n                    <form id=\"frm_search_info\" class=\"text-dark form-horizontal\" action=\"\">\n                        <input type=\"hidden\" value=\"\"/>\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"order_sn\" class=\"control-label col-sm-4\">订单号</label>\n\n                            <div class=\"col-sm-8\">\n                                <input type=\"text\" class=\"form-control\" id=\"title\" name=\"id\"\n                                       value=\"{{isset($searchCondition['id'])?$searchCondition['id']:''}}\"/>\n\n                            </div>\n                        </div>\n\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"snap_goods_name\" class=\"control-label col-sm-4\">商品名称</label>\n\n                            <div class=\"col-sm-8\">\n                                <input type=\"text\" class=\"form-control\" id=\"title\" name=\"snap_goods_name\"\n                                       value=\"{{isset($searchCondition['snap_goods_name'])?$searchCondition['snap_goods_name']:''}}\"/>\n\n                            </div>\n                        </div>\n\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"paymentInfo.payment_type\" class=\"control-label col-sm-4\">支付方式</label>\n\n                            <div class=\"col-sm-8\">\n                                <select class=\"form-control input-lg select2\" id=\"paymentInfo.payment_type\" name=\"paymentInfo.payment_type\"\n                                        style=\"width: 192px;\">\n                                    <option value=\"\">全部</option>\n                                    @if(isset($paymentType))\n                                        @foreach($paymentType as $index => $item)\n                                            <option value=\"{{$index}}\"\n                                                    @if(isset($searchCondition['paymentInfo.payment_type']) && $index == $searchCondition['paymentInfo.payment_type']) selected=\"selected\" @endif>{{$item}}</option>\n                                        @endforeach\n                                    @endif\n                                </select>\n\n                            </div>\n                        </div>\n                        <div class=\"form-group col-sm-4 pull-left\">\n                            <label for=\"created_at@\" class=\"control-label col-sm-4\">至</label>\n\n                            <div class=\"col-sm-8\">\n                                <div class=\"input-group datetimepicker date\" id=\"end_time_picker\">\n                                    <input class=\"form-control\" id=\"created_at@\"\n                                           name=\"created_at@\" type=\"text\"\n                                           value=\"@if(isset($searchCondition['created_at@']) && $searchCondition['created_at@']){{$searchCondition['created_at@']}}@endif\">\n                                    <span class=\"input-group-addon\" for=\"created_at@\">\n                            <span class=\"glyphicon glyphicon-calendar\"></span>\n                        </span>\n                                </div>\n\n                            </div>\n                        </div>\n\n                        <div class=\"form-group col-sm-4 pull-right\">\n                            <button type=\"button\" class=\"btn btn-default m-l-10\" id=\"btn_clear\">清空</button>\n                            <button type=\"button\" class=\"btn btn-purple m-l-10\" id=\"btn_export\">\n                                Excel 导出\n                            </button>\n                            <button type=\"button\" class=\"btn btn-primary m-l-10\" id=\"btn_search\">搜索</button>\n\n                        </div>\n\n                        <div class=\"clearfix\"></div>\n\n                    </form>\n                </div>\n            </div>\n        </div>\n    </div>\n\n</div>\n```\n要求表单中的 name 与数据表中的字段名完全一致。\n注意：这里是 button，而不是 submit\n\n\n## 2. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\n\n如：\n\n```\nprotected $fieldSearchable = [\n    'id',\n    'snap_goods_name' => 'like',\n    'username',\n    'order_status',\n    'created_at' => \">=\",\n    'created_at@' => \"<=\",\n    'source_id',\n    'paymentInfo.payment_type'\n];\n```\n注意：\n- 要列出所有需要进行搜索的字段。\n- 等于的可以省略，\n- 模糊搜索用 like，\n- 范围搜索也直接写。\n- 如果一个字段需要用一次以上，需要对 key 进行重写，加一个@\n\n其中，最后一个功能是在 BaseRepositoryEloquent 中定义的。\n\n默认的键值间的分隔符为：， 如http://prettus.local/users?search=name:John Doe;email:john@gmail.com\n可以进行自定义。\n在 BaseRepositoryEloquent.php 的构造方法中，\n`$this->keyValueSeparator = '|:'`。\n\n组件中默认不包含范围选择符，即sql中的between用法。我们进行了改写，以支持该用法。\n\nBaseRepositoryEloquent 中，添加解析搜索url的方法。\n\n```\npublic function parserSearchData($searchData)\n{\n    if (!empty($searchData) && is_array($searchData)) {\n        foreach ($searchData as $index => $item) {\n            $method = sprintf(\"parser%s4Search\", ucfirst(camel_case(str_replace('@', '', $index))));\n            $model = $this->getModel();\n            if (method_exists($model, $method)) {\n                $searchData[$index] = $model->{$method}($item);\n            }\n        }\n    }\n\n    return $searchData;\n}\n```\n\n以及解析原始搜索数据的方法\n\n```\npublic function parserOriginSearchData($search)\n{\n    $searchData = [];\n    if (stripos($search, $this->keyValueSeparator)) {\n        $fields = explode($this->paramSeparator, $search);\n\n        foreach ($fields as $row) {\n            try {\n                list($field, $value) = explode($this->keyValueSeparator, $row);\n                $searchData[trim($field)] = trim($value);\n            } catch (\\Exception $e) {\n                //Surround offset error\n            }\n        }\n    }\n    return $searchData;\n}\n```\n\n业务需要，添加了整合后的获取搜索参数的方法\n\n```\npublic function getSearchData($param = null, $is_origin = true)\n{\n    $search = $this->request->get(config('repository.criteria.params.search', 'search'), null);\n    $searchData = $this->parserOriginSearchData($search);\n    if (false == $is_origin) {\n        $searchData = $this->parserSearchData($searchData);\n    }\n    if (!empty($param)) {\n        if (isset($searchData[$param])) {\n            $searchData = $searchData[$param];\n        } else {\n            $searchData = null;\n        }\n    }\n    return $searchData;\n}\n```\n\n## 3. js 文件中添加解析url的方法。\n\n```\n// 搜索 按钮\nsearchWithParams('/magazine/order?page=1');\n\nfunction searchWithParams(url) {\n    $(\"#btn_search\").click(function () {\n        var params = {};\n        $(\"#frm_search_info select, #frm_search_info input[type=text], #frm_search_info input[type=hidden]\").each(function () {\n            var value = $(this).val();\n            if ('' != value) {\n                params[$(this).attr('name')] = value;\n            }\n        });\n\n        if (!$.isEmptyObject(params)) {\n            url += \"&search=\" + parserParams2Url(params);\n        }\n\n        location.href = url;\n    });\n\n}\n```\n\n该方法实现了对所有输入框、下拉框等搜索框内容的收集并处理，生成一个 Repository 可解析的 url。\n\n\n## 4. 回显的数据不需要通过控制器获取后回传，在模板中通过 $searchCondition 全局变量获取即可\n\n如何使用？\n控制器中的方法会非常简洁：\n\n```\npublic function getIndex(Request $request)\n{\n    $flashes = $this->repositoryInterface->paginate();\n\n    return View::make(\"flash/index\", array(\n        \"flashes\" => $flashes,\n        \"flashTypes\" => Flash::$flashTypes,\n    ));\n}\n```\n\n---\n\n# 第二部分 跨表查询\n\n上述搜索方法只是实现了单表搜索，如果搜索涉及到跨表该怎么处理？\n\n场景：在模型Order的列表页进行搜索，但搜索的关键字是模型Payment的一个字段，模型Payment有一个指向模型Order的外键 order_id。\n\n实现：\n\n## 1. 在 app/Models/Order 中，建立与 Payment 模型的关联关系。\n\n```\n/**\n * 支付信息关联关系\n * @return \\Illuminate\\Database\\Eloquent\\Relations\\HasOne\n */\npublic function paymentInfo()\n{\n    return $this->hasOne('App\\Models\\Payment', 'order_id', 'id');\n}\n```\n\n## 2. Order 的模板文件（列表 resources/views/backend/order/index.blade.php）中，搜索相关部分的 name 和字段名都要加上关联关系的方法前缀。\n\n```\n<div class=\"form-group col-sm-4 pull-left\">\n    <label for=\"paymentInfo.payment_type\" class=\"control-label col-sm-4\">支付方式</label>\n\n    <div class=\"col-sm-8\">\n        <select class=\"form-control input-lg select2\" id=\"paymentInfo.payment_type\" name=\"paymentInfo.payment_type\"\n                style=\"width: 192px;\">\n            <option value=\"\">全部</option>\n            @if(isset($paymentType))\n                @foreach($paymentType as $index => $item)\n                    <option value=\"{{$index}}\"\n                            @if(isset($searchCondition['paymentInfo.payment_type']) && $index == $searchCondition['paymentInfo.payment_type']) selected=\"selected\" @endif>{{$item}}</option>\n                @endforeach\n            @endif\n        </select>\n\n    </div>\n</div>\n```\n\n## 3. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\n\n如：\n\n```\nprotected $fieldSearchable = [\n    'paymentInfo.payment_type'\n];\n\n要与模板文件的name一致。\n\n","slug":"《财经》CMS后台查询功能的实现（基于Laravel-Repository）","published":1,"updated":"2020-09-11T01:04:35.045Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz99002p6wo14x5l30fp","content":"<p>使用 <a href=\"https://github.com/andersao/l5-repository\">RequestCriteria</a> 统一搜索功能，可自动根据 url 按字段进行搜索，无需写方法</p>\n<a id=\"more\"></a>\n\n<h1 id=\"第一部分-单表查询\"><a href=\"#第一部分-单表查询\" class=\"headerlink\" title=\"第一部分 单表查询\"></a>第一部分 单表查询</h1><h2 id=\"1-后台搜索框的基本代码：\"><a href=\"#1-后台搜索框的基本代码：\" class=\"headerlink\" title=\"1. 后台搜索框的基本代码：\"></a>1. 后台搜索框的基本代码：</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;panel-group&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;panel panel-default&quot; style&#x3D;&quot;border: none;&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class=\"line\">            &lt;h4 class&#x3D;&quot;panel-title&quot;&gt;</span><br><span class=\"line\">                &lt;a data-toggle&#x3D;&quot;collapse&quot; href&#x3D;&quot;#wrapper_search&quot;</span><br><span class=\"line\">                   aria-expanded&#x3D;&quot;false&quot; @if(false &#x3D;&#x3D; $searchMode)class&#x3D;&quot;collapsed&quot; @endif &gt;</span><br><span class=\"line\">                    搜索相关</span><br><span class=\"line\">                &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;&#x2F;h4&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div id&#x3D;&quot;wrapper_search&quot; class&#x3D;&quot;panel-collapse collapse @if(true &#x3D;&#x3D; $searchMode)in @endif&quot;</span><br><span class=\"line\">             aria-expanded&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class=\"line\">                &lt;div class&#x3D;&quot;portlet-heading&quot;&gt;</span><br><span class=\"line\">                    &lt;form id&#x3D;&quot;frm_search_info&quot; class&#x3D;&quot;text-dark form-horizontal&quot; action&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">                        &lt;input type&#x3D;&quot;hidden&quot; value&#x3D;&quot;&quot;&#x2F;&gt;</span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;order_sn&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;订单号&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;title&quot; name&#x3D;&quot;id&quot;</span><br><span class=\"line\">                                       value&#x3D;&quot;&#123;&#123;isset($searchCondition[&#39;id&#39;])?$searchCondition[&#39;id&#39;]:&#39;&#39;&#125;&#125;&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;snap_goods_name&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;商品名称&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;title&quot; name&#x3D;&quot;snap_goods_name&quot;</span><br><span class=\"line\">                                       value&#x3D;&quot;&#123;&#123;isset($searchCondition[&#39;snap_goods_name&#39;])?$searchCondition[&#39;snap_goods_name&#39;]:&#39;&#39;&#125;&#125;&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;paymentInfo.payment_type&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;支付方式&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;select class&#x3D;&quot;form-control input-lg select2&quot; id&#x3D;&quot;paymentInfo.payment_type&quot; name&#x3D;&quot;paymentInfo.payment_type&quot;</span><br><span class=\"line\">                                        style&#x3D;&quot;width: 192px;&quot;&gt;</span><br><span class=\"line\">                                    &lt;option value&#x3D;&quot;&quot;&gt;全部&lt;&#x2F;option&gt;</span><br><span class=\"line\">                                    @if(isset($paymentType))</span><br><span class=\"line\">                                        @foreach($paymentType as $index &#x3D;&gt; $item)</span><br><span class=\"line\">                                            &lt;option value&#x3D;&quot;&#123;&#123;$index&#125;&#125;&quot;</span><br><span class=\"line\">                                                    @if(isset($searchCondition[&#39;paymentInfo.payment_type&#39;]) &amp;&amp; $index &#x3D;&#x3D; $searchCondition[&#39;paymentInfo.payment_type&#39;]) selected&#x3D;&quot;selected&quot; @endif&gt;&#123;&#123;$item&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                                        @endforeach</span><br><span class=\"line\">                                    @endif</span><br><span class=\"line\">                                &lt;&#x2F;select&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;created_at@&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;至&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;div class&#x3D;&quot;input-group datetimepicker date&quot; id&#x3D;&quot;end_time_picker&quot;&gt;</span><br><span class=\"line\">                                    &lt;input class&#x3D;&quot;form-control&quot; id&#x3D;&quot;created_at@&quot;</span><br><span class=\"line\">                                           name&#x3D;&quot;created_at@&quot; type&#x3D;&quot;text&quot;</span><br><span class=\"line\">                                           value&#x3D;&quot;@if(isset($searchCondition[&#39;created_at@&#39;]) &amp;&amp; $searchCondition[&#39;created_at@&#39;])&#123;&#123;$searchCondition[&#39;created_at@&#39;]&#125;&#125;@endif&quot;&gt;</span><br><span class=\"line\">                                    &lt;span class&#x3D;&quot;input-group-addon&quot; for&#x3D;&quot;created_at@&quot;&gt;</span><br><span class=\"line\">                            &lt;span class&#x3D;&quot;glyphicon glyphicon-calendar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class=\"line\">                        &lt;&#x2F;span&gt;</span><br><span class=\"line\">                                &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-right&quot;&gt;</span><br><span class=\"line\">                            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-default m-l-10&quot; id&#x3D;&quot;btn_clear&quot;&gt;清空&lt;&#x2F;button&gt;</span><br><span class=\"line\">                            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-purple m-l-10&quot; id&#x3D;&quot;btn_export&quot;&gt;</span><br><span class=\"line\">                                Excel 导出</span><br><span class=\"line\">                            &lt;&#x2F;button&gt;</span><br><span class=\"line\">                            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-primary m-l-10&quot; id&#x3D;&quot;btn_search&quot;&gt;搜索&lt;&#x2F;button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;clearfix&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;&#x2F;div&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n<p>要求表单中的 name 与数据表中的字段名完全一致。<br>注意：这里是 button，而不是 submit</p>\n<h2 id=\"2-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\"><a href=\"#2-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\" class=\"headerlink\" title=\"2. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\"></a>2. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段</h2><p>如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected $fieldSearchable &#x3D; [</span><br><span class=\"line\">    &#39;id&#39;,</span><br><span class=\"line\">    &#39;snap_goods_name&#39; &#x3D;&gt; &#39;like&#39;,</span><br><span class=\"line\">    &#39;username&#39;,</span><br><span class=\"line\">    &#39;order_status&#39;,</span><br><span class=\"line\">    &#39;created_at&#39; &#x3D;&gt; &quot;&gt;&#x3D;&quot;,</span><br><span class=\"line\">    &#39;created_at@&#39; &#x3D;&gt; &quot;&lt;&#x3D;&quot;,</span><br><span class=\"line\">    &#39;source_id&#39;,</span><br><span class=\"line\">    &#39;paymentInfo.payment_type&#39;</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n<p>注意：</p>\n<ul>\n<li>要列出所有需要进行搜索的字段。</li>\n<li>等于的可以省略，</li>\n<li>模糊搜索用 like，</li>\n<li>范围搜索也直接写。</li>\n<li>如果一个字段需要用一次以上，需要对 key 进行重写，加一个@</li>\n</ul>\n<p>其中，最后一个功能是在 BaseRepositoryEloquent 中定义的。</p>\n<p>默认的键值间的分隔符为：， 如<a href=\"http://prettus.local/users?search=name:John\">http://prettus.local/users?search=name:John</a> Doe;email:<a href=\"mailto:&#106;&#x6f;&#104;&#110;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#x6f;&#109;\">&#106;&#x6f;&#104;&#110;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#x6f;&#109;</a><br>可以进行自定义。<br>在 BaseRepositoryEloquent.php 的构造方法中，<br><code>$this-&gt;keyValueSeparator = &#39;|:&#39;</code>。</p>\n<p>组件中默认不包含范围选择符，即sql中的between用法。我们进行了改写，以支持该用法。</p>\n<p>BaseRepositoryEloquent 中，添加解析搜索url的方法。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function parserSearchData($searchData)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (!empty($searchData) &amp;&amp; is_array($searchData)) &#123;</span><br><span class=\"line\">        foreach ($searchData as $index &#x3D;&gt; $item) &#123;</span><br><span class=\"line\">            $method &#x3D; sprintf(&quot;parser%s4Search&quot;, ucfirst(camel_case(str_replace(&#39;@&#39;, &#39;&#39;, $index))));</span><br><span class=\"line\">            $model &#x3D; $this-&gt;getModel();</span><br><span class=\"line\">            if (method_exists($model, $method)) &#123;</span><br><span class=\"line\">                $searchData[$index] &#x3D; $model-&gt;&#123;$method&#125;($item);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $searchData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以及解析原始搜索数据的方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function parserOriginSearchData($search)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $searchData &#x3D; [];</span><br><span class=\"line\">    if (stripos($search, $this-&gt;keyValueSeparator)) &#123;</span><br><span class=\"line\">        $fields &#x3D; explode($this-&gt;paramSeparator, $search);</span><br><span class=\"line\"></span><br><span class=\"line\">        foreach ($fields as $row) &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                list($field, $value) &#x3D; explode($this-&gt;keyValueSeparator, $row);</span><br><span class=\"line\">                $searchData[trim($field)] &#x3D; trim($value);</span><br><span class=\"line\">            &#125; catch (\\Exception $e) &#123;</span><br><span class=\"line\">                &#x2F;&#x2F;Surround offset error</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $searchData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>业务需要，添加了整合后的获取搜索参数的方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function getSearchData($param &#x3D; null, $is_origin &#x3D; true)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $search &#x3D; $this-&gt;request-&gt;get(config(&#39;repository.criteria.params.search&#39;, &#39;search&#39;), null);</span><br><span class=\"line\">    $searchData &#x3D; $this-&gt;parserOriginSearchData($search);</span><br><span class=\"line\">    if (false &#x3D;&#x3D; $is_origin) &#123;</span><br><span class=\"line\">        $searchData &#x3D; $this-&gt;parserSearchData($searchData);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (!empty($param)) &#123;</span><br><span class=\"line\">        if (isset($searchData[$param])) &#123;</span><br><span class=\"line\">            $searchData &#x3D; $searchData[$param];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $searchData &#x3D; null;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $searchData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-js-文件中添加解析url的方法。\"><a href=\"#3-js-文件中添加解析url的方法。\" class=\"headerlink\" title=\"3. js 文件中添加解析url的方法。\"></a>3. js 文件中添加解析url的方法。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 搜索 按钮</span><br><span class=\"line\">searchWithParams(&#39;&#x2F;magazine&#x2F;order?page&#x3D;1&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">function searchWithParams(url) &#123;</span><br><span class=\"line\">    $(&quot;#btn_search&quot;).click(function () &#123;</span><br><span class=\"line\">        var params &#x3D; &#123;&#125;;</span><br><span class=\"line\">        $(&quot;#frm_search_info select, #frm_search_info input[type&#x3D;text], #frm_search_info input[type&#x3D;hidden]&quot;).each(function () &#123;</span><br><span class=\"line\">            var value &#x3D; $(this).val();</span><br><span class=\"line\">            if (&#39;&#39; !&#x3D; value) &#123;</span><br><span class=\"line\">                params[$(this).attr(&#39;name&#39;)] &#x3D; value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (!$.isEmptyObject(params)) &#123;</span><br><span class=\"line\">            url +&#x3D; &quot;&amp;search&#x3D;&quot; + parserParams2Url(params);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location.href &#x3D; url;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该方法实现了对所有输入框、下拉框等搜索框内容的收集并处理，生成一个 Repository 可解析的 url。</p>\n<h2 id=\"4-回显的数据不需要通过控制器获取后回传，在模板中通过-searchCondition-全局变量获取即可\"><a href=\"#4-回显的数据不需要通过控制器获取后回传，在模板中通过-searchCondition-全局变量获取即可\" class=\"headerlink\" title=\"4. 回显的数据不需要通过控制器获取后回传，在模板中通过 $searchCondition 全局变量获取即可\"></a>4. 回显的数据不需要通过控制器获取后回传，在模板中通过 $searchCondition 全局变量获取即可</h2><p>如何使用？<br>控制器中的方法会非常简洁：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function getIndex(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $flashes &#x3D; $this-&gt;repositoryInterface-&gt;paginate();</span><br><span class=\"line\"></span><br><span class=\"line\">    return View::make(&quot;flash&#x2F;index&quot;, array(</span><br><span class=\"line\">        &quot;flashes&quot; &#x3D;&gt; $flashes,</span><br><span class=\"line\">        &quot;flashTypes&quot; &#x3D;&gt; Flash::$flashTypes,</span><br><span class=\"line\">    ));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h1 id=\"第二部分-跨表查询\"><a href=\"#第二部分-跨表查询\" class=\"headerlink\" title=\"第二部分 跨表查询\"></a>第二部分 跨表查询</h1><p>上述搜索方法只是实现了单表搜索，如果搜索涉及到跨表该怎么处理？</p>\n<p>场景：在模型Order的列表页进行搜索，但搜索的关键字是模型Payment的一个字段，模型Payment有一个指向模型Order的外键 order_id。</p>\n<p>实现：</p>\n<h2 id=\"1-在-app-Models-Order-中，建立与-Payment-模型的关联关系。\"><a href=\"#1-在-app-Models-Order-中，建立与-Payment-模型的关联关系。\" class=\"headerlink\" title=\"1. 在 app/Models/Order 中，建立与 Payment 模型的关联关系。\"></a>1. 在 app/Models/Order 中，建立与 Payment 模型的关联关系。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 支付信息关联关系</span><br><span class=\"line\"> * @return \\Illuminate\\Database\\Eloquent\\Relations\\HasOne</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function paymentInfo()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    return $this-&gt;hasOne(&#39;App\\Models\\Payment&#39;, &#39;order_id&#39;, &#39;id&#39;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Order-的模板文件（列表-resources-views-backend-order-index-blade-php）中，搜索相关部分的-name-和字段名都要加上关联关系的方法前缀。\"><a href=\"#2-Order-的模板文件（列表-resources-views-backend-order-index-blade-php）中，搜索相关部分的-name-和字段名都要加上关联关系的方法前缀。\" class=\"headerlink\" title=\"2. Order 的模板文件（列表 resources/views/backend/order/index.blade.php）中，搜索相关部分的 name 和字段名都要加上关联关系的方法前缀。\"></a>2. Order 的模板文件（列表 resources/views/backend/order/index.blade.php）中，搜索相关部分的 name 和字段名都要加上关联关系的方法前缀。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;paymentInfo.payment_type&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;支付方式&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">        &lt;select class&#x3D;&quot;form-control input-lg select2&quot; id&#x3D;&quot;paymentInfo.payment_type&quot; name&#x3D;&quot;paymentInfo.payment_type&quot;</span><br><span class=\"line\">                style&#x3D;&quot;width: 192px;&quot;&gt;</span><br><span class=\"line\">            &lt;option value&#x3D;&quot;&quot;&gt;全部&lt;&#x2F;option&gt;</span><br><span class=\"line\">            @if(isset($paymentType))</span><br><span class=\"line\">                @foreach($paymentType as $index &#x3D;&gt; $item)</span><br><span class=\"line\">                    &lt;option value&#x3D;&quot;&#123;&#123;$index&#125;&#125;&quot;</span><br><span class=\"line\">                            @if(isset($searchCondition[&#39;paymentInfo.payment_type&#39;]) &amp;&amp; $index &#x3D;&#x3D; $searchCondition[&#39;paymentInfo.payment_type&#39;]) selected&#x3D;&quot;selected&quot; @endif&gt;&#123;&#123;$item&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @endforeach</span><br><span class=\"line\">            @endif</span><br><span class=\"line\">        &lt;&#x2F;select&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\"><a href=\"#3-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\" class=\"headerlink\" title=\"3. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\"></a>3. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段</h2><p>如：</p>\n<pre><code>protected $fieldSearchable = [\n    &#39;paymentInfo.payment_type&#39;\n];\n\n要与模板文件的name一致。\n</code></pre>\n","site":{"data":{}},"excerpt":"<p>使用 <a href=\"https://github.com/andersao/l5-repository\">RequestCriteria</a> 统一搜索功能，可自动根据 url 按字段进行搜索，无需写方法</p>","more":"<h1 id=\"第一部分-单表查询\"><a href=\"#第一部分-单表查询\" class=\"headerlink\" title=\"第一部分 单表查询\"></a>第一部分 单表查询</h1><h2 id=\"1-后台搜索框的基本代码：\"><a href=\"#1-后台搜索框的基本代码：\" class=\"headerlink\" title=\"1. 后台搜索框的基本代码：\"></a>1. 后台搜索框的基本代码：</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;panel-group&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;panel panel-default&quot; style&#x3D;&quot;border: none;&quot;&gt;</span><br><span class=\"line\">        &lt;div class&#x3D;&quot;panel-heading&quot;&gt;</span><br><span class=\"line\">            &lt;h4 class&#x3D;&quot;panel-title&quot;&gt;</span><br><span class=\"line\">                &lt;a data-toggle&#x3D;&quot;collapse&quot; href&#x3D;&quot;#wrapper_search&quot;</span><br><span class=\"line\">                   aria-expanded&#x3D;&quot;false&quot; @if(false &#x3D;&#x3D; $searchMode)class&#x3D;&quot;collapsed&quot; @endif &gt;</span><br><span class=\"line\">                    搜索相关</span><br><span class=\"line\">                &lt;&#x2F;a&gt;</span><br><span class=\"line\">            &lt;&#x2F;h4&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;div id&#x3D;&quot;wrapper_search&quot; class&#x3D;&quot;panel-collapse collapse @if(true &#x3D;&#x3D; $searchMode)in @endif&quot;</span><br><span class=\"line\">             aria-expanded&#x3D;&quot;false&quot;&gt;</span><br><span class=\"line\">            &lt;div class&#x3D;&quot;panel-body&quot;&gt;</span><br><span class=\"line\">                &lt;div class&#x3D;&quot;portlet-heading&quot;&gt;</span><br><span class=\"line\">                    &lt;form id&#x3D;&quot;frm_search_info&quot; class&#x3D;&quot;text-dark form-horizontal&quot; action&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">                        &lt;input type&#x3D;&quot;hidden&quot; value&#x3D;&quot;&quot;&#x2F;&gt;</span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;order_sn&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;订单号&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;title&quot; name&#x3D;&quot;id&quot;</span><br><span class=\"line\">                                       value&#x3D;&quot;&#123;&#123;isset($searchCondition[&#39;id&#39;])?$searchCondition[&#39;id&#39;]:&#39;&#39;&#125;&#125;&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;snap_goods_name&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;商品名称&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;form-control&quot; id&#x3D;&quot;title&quot; name&#x3D;&quot;snap_goods_name&quot;</span><br><span class=\"line\">                                       value&#x3D;&quot;&#123;&#123;isset($searchCondition[&#39;snap_goods_name&#39;])?$searchCondition[&#39;snap_goods_name&#39;]:&#39;&#39;&#125;&#125;&quot;&#x2F;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;paymentInfo.payment_type&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;支付方式&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;select class&#x3D;&quot;form-control input-lg select2&quot; id&#x3D;&quot;paymentInfo.payment_type&quot; name&#x3D;&quot;paymentInfo.payment_type&quot;</span><br><span class=\"line\">                                        style&#x3D;&quot;width: 192px;&quot;&gt;</span><br><span class=\"line\">                                    &lt;option value&#x3D;&quot;&quot;&gt;全部&lt;&#x2F;option&gt;</span><br><span class=\"line\">                                    @if(isset($paymentType))</span><br><span class=\"line\">                                        @foreach($paymentType as $index &#x3D;&gt; $item)</span><br><span class=\"line\">                                            &lt;option value&#x3D;&quot;&#123;&#123;$index&#125;&#125;&quot;</span><br><span class=\"line\">                                                    @if(isset($searchCondition[&#39;paymentInfo.payment_type&#39;]) &amp;&amp; $index &#x3D;&#x3D; $searchCondition[&#39;paymentInfo.payment_type&#39;]) selected&#x3D;&quot;selected&quot; @endif&gt;&#123;&#123;$item&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                                        @endforeach</span><br><span class=\"line\">                                    @endif</span><br><span class=\"line\">                                &lt;&#x2F;select&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">                            &lt;label for&#x3D;&quot;created_at@&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;至&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">                                &lt;div class&#x3D;&quot;input-group datetimepicker date&quot; id&#x3D;&quot;end_time_picker&quot;&gt;</span><br><span class=\"line\">                                    &lt;input class&#x3D;&quot;form-control&quot; id&#x3D;&quot;created_at@&quot;</span><br><span class=\"line\">                                           name&#x3D;&quot;created_at@&quot; type&#x3D;&quot;text&quot;</span><br><span class=\"line\">                                           value&#x3D;&quot;@if(isset($searchCondition[&#39;created_at@&#39;]) &amp;&amp; $searchCondition[&#39;created_at@&#39;])&#123;&#123;$searchCondition[&#39;created_at@&#39;]&#125;&#125;@endif&quot;&gt;</span><br><span class=\"line\">                                    &lt;span class&#x3D;&quot;input-group-addon&quot; for&#x3D;&quot;created_at@&quot;&gt;</span><br><span class=\"line\">                            &lt;span class&#x3D;&quot;glyphicon glyphicon-calendar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class=\"line\">                        &lt;&#x2F;span&gt;</span><br><span class=\"line\">                                &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                            &lt;&#x2F;div&gt;</span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;form-group col-sm-4 pull-right&quot;&gt;</span><br><span class=\"line\">                            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-default m-l-10&quot; id&#x3D;&quot;btn_clear&quot;&gt;清空&lt;&#x2F;button&gt;</span><br><span class=\"line\">                            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-purple m-l-10&quot; id&#x3D;&quot;btn_export&quot;&gt;</span><br><span class=\"line\">                                Excel 导出</span><br><span class=\"line\">                            &lt;&#x2F;button&gt;</span><br><span class=\"line\">                            &lt;button type&#x3D;&quot;button&quot; class&#x3D;&quot;btn btn-primary m-l-10&quot; id&#x3D;&quot;btn_search&quot;&gt;搜索&lt;&#x2F;button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &lt;div class&#x3D;&quot;clearfix&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &lt;&#x2F;form&gt;</span><br><span class=\"line\">                &lt;&#x2F;div&gt;</span><br><span class=\"line\">            &lt;&#x2F;div&gt;</span><br><span class=\"line\">        &lt;&#x2F;div&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n<p>要求表单中的 name 与数据表中的字段名完全一致。<br>注意：这里是 button，而不是 submit</p>\n<h2 id=\"2-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\"><a href=\"#2-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\" class=\"headerlink\" title=\"2. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\"></a>2. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段</h2><p>如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protected $fieldSearchable &#x3D; [</span><br><span class=\"line\">    &#39;id&#39;,</span><br><span class=\"line\">    &#39;snap_goods_name&#39; &#x3D;&gt; &#39;like&#39;,</span><br><span class=\"line\">    &#39;username&#39;,</span><br><span class=\"line\">    &#39;order_status&#39;,</span><br><span class=\"line\">    &#39;created_at&#39; &#x3D;&gt; &quot;&gt;&#x3D;&quot;,</span><br><span class=\"line\">    &#39;created_at@&#39; &#x3D;&gt; &quot;&lt;&#x3D;&quot;,</span><br><span class=\"line\">    &#39;source_id&#39;,</span><br><span class=\"line\">    &#39;paymentInfo.payment_type&#39;</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n<p>注意：</p>\n<ul>\n<li>要列出所有需要进行搜索的字段。</li>\n<li>等于的可以省略，</li>\n<li>模糊搜索用 like，</li>\n<li>范围搜索也直接写。</li>\n<li>如果一个字段需要用一次以上，需要对 key 进行重写，加一个@</li>\n</ul>\n<p>其中，最后一个功能是在 BaseRepositoryEloquent 中定义的。</p>\n<p>默认的键值间的分隔符为：， 如<a href=\"http://prettus.local/users?search=name:John\">http://prettus.local/users?search=name:John</a> Doe;email:<a href=\"mailto:&#106;&#x6f;&#104;&#110;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#x6f;&#109;\">&#106;&#x6f;&#104;&#110;&#x40;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#99;&#x6f;&#109;</a><br>可以进行自定义。<br>在 BaseRepositoryEloquent.php 的构造方法中，<br><code>$this-&gt;keyValueSeparator = &#39;|:&#39;</code>。</p>\n<p>组件中默认不包含范围选择符，即sql中的between用法。我们进行了改写，以支持该用法。</p>\n<p>BaseRepositoryEloquent 中，添加解析搜索url的方法。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function parserSearchData($searchData)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (!empty($searchData) &amp;&amp; is_array($searchData)) &#123;</span><br><span class=\"line\">        foreach ($searchData as $index &#x3D;&gt; $item) &#123;</span><br><span class=\"line\">            $method &#x3D; sprintf(&quot;parser%s4Search&quot;, ucfirst(camel_case(str_replace(&#39;@&#39;, &#39;&#39;, $index))));</span><br><span class=\"line\">            $model &#x3D; $this-&gt;getModel();</span><br><span class=\"line\">            if (method_exists($model, $method)) &#123;</span><br><span class=\"line\">                $searchData[$index] &#x3D; $model-&gt;&#123;$method&#125;($item);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $searchData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>以及解析原始搜索数据的方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function parserOriginSearchData($search)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $searchData &#x3D; [];</span><br><span class=\"line\">    if (stripos($search, $this-&gt;keyValueSeparator)) &#123;</span><br><span class=\"line\">        $fields &#x3D; explode($this-&gt;paramSeparator, $search);</span><br><span class=\"line\"></span><br><span class=\"line\">        foreach ($fields as $row) &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                list($field, $value) &#x3D; explode($this-&gt;keyValueSeparator, $row);</span><br><span class=\"line\">                $searchData[trim($field)] &#x3D; trim($value);</span><br><span class=\"line\">            &#125; catch (\\Exception $e) &#123;</span><br><span class=\"line\">                &#x2F;&#x2F;Surround offset error</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $searchData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>业务需要，添加了整合后的获取搜索参数的方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function getSearchData($param &#x3D; null, $is_origin &#x3D; true)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $search &#x3D; $this-&gt;request-&gt;get(config(&#39;repository.criteria.params.search&#39;, &#39;search&#39;), null);</span><br><span class=\"line\">    $searchData &#x3D; $this-&gt;parserOriginSearchData($search);</span><br><span class=\"line\">    if (false &#x3D;&#x3D; $is_origin) &#123;</span><br><span class=\"line\">        $searchData &#x3D; $this-&gt;parserSearchData($searchData);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (!empty($param)) &#123;</span><br><span class=\"line\">        if (isset($searchData[$param])) &#123;</span><br><span class=\"line\">            $searchData &#x3D; $searchData[$param];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $searchData &#x3D; null;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $searchData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-js-文件中添加解析url的方法。\"><a href=\"#3-js-文件中添加解析url的方法。\" class=\"headerlink\" title=\"3. js 文件中添加解析url的方法。\"></a>3. js 文件中添加解析url的方法。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 搜索 按钮</span><br><span class=\"line\">searchWithParams(&#39;&#x2F;magazine&#x2F;order?page&#x3D;1&#39;);</span><br><span class=\"line\"></span><br><span class=\"line\">function searchWithParams(url) &#123;</span><br><span class=\"line\">    $(&quot;#btn_search&quot;).click(function () &#123;</span><br><span class=\"line\">        var params &#x3D; &#123;&#125;;</span><br><span class=\"line\">        $(&quot;#frm_search_info select, #frm_search_info input[type&#x3D;text], #frm_search_info input[type&#x3D;hidden]&quot;).each(function () &#123;</span><br><span class=\"line\">            var value &#x3D; $(this).val();</span><br><span class=\"line\">            if (&#39;&#39; !&#x3D; value) &#123;</span><br><span class=\"line\">                params[$(this).attr(&#39;name&#39;)] &#x3D; value;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        if (!$.isEmptyObject(params)) &#123;</span><br><span class=\"line\">            url +&#x3D; &quot;&amp;search&#x3D;&quot; + parserParams2Url(params);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        location.href &#x3D; url;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>该方法实现了对所有输入框、下拉框等搜索框内容的收集并处理，生成一个 Repository 可解析的 url。</p>\n<h2 id=\"4-回显的数据不需要通过控制器获取后回传，在模板中通过-searchCondition-全局变量获取即可\"><a href=\"#4-回显的数据不需要通过控制器获取后回传，在模板中通过-searchCondition-全局变量获取即可\" class=\"headerlink\" title=\"4. 回显的数据不需要通过控制器获取后回传，在模板中通过 $searchCondition 全局变量获取即可\"></a>4. 回显的数据不需要通过控制器获取后回传，在模板中通过 $searchCondition 全局变量获取即可</h2><p>如何使用？<br>控制器中的方法会非常简洁：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function getIndex(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $flashes &#x3D; $this-&gt;repositoryInterface-&gt;paginate();</span><br><span class=\"line\"></span><br><span class=\"line\">    return View::make(&quot;flash&#x2F;index&quot;, array(</span><br><span class=\"line\">        &quot;flashes&quot; &#x3D;&gt; $flashes,</span><br><span class=\"line\">        &quot;flashTypes&quot; &#x3D;&gt; Flash::$flashTypes,</span><br><span class=\"line\">    ));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h1 id=\"第二部分-跨表查询\"><a href=\"#第二部分-跨表查询\" class=\"headerlink\" title=\"第二部分 跨表查询\"></a>第二部分 跨表查询</h1><p>上述搜索方法只是实现了单表搜索，如果搜索涉及到跨表该怎么处理？</p>\n<p>场景：在模型Order的列表页进行搜索，但搜索的关键字是模型Payment的一个字段，模型Payment有一个指向模型Order的外键 order_id。</p>\n<p>实现：</p>\n<h2 id=\"1-在-app-Models-Order-中，建立与-Payment-模型的关联关系。\"><a href=\"#1-在-app-Models-Order-中，建立与-Payment-模型的关联关系。\" class=\"headerlink\" title=\"1. 在 app/Models/Order 中，建立与 Payment 模型的关联关系。\"></a>1. 在 app/Models/Order 中，建立与 Payment 模型的关联关系。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 支付信息关联关系</span><br><span class=\"line\"> * @return \\Illuminate\\Database\\Eloquent\\Relations\\HasOne</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">public function paymentInfo()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    return $this-&gt;hasOne(&#39;App\\Models\\Payment&#39;, &#39;order_id&#39;, &#39;id&#39;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Order-的模板文件（列表-resources-views-backend-order-index-blade-php）中，搜索相关部分的-name-和字段名都要加上关联关系的方法前缀。\"><a href=\"#2-Order-的模板文件（列表-resources-views-backend-order-index-blade-php）中，搜索相关部分的-name-和字段名都要加上关联关系的方法前缀。\" class=\"headerlink\" title=\"2. Order 的模板文件（列表 resources/views/backend/order/index.blade.php）中，搜索相关部分的 name 和字段名都要加上关联关系的方法前缀。\"></a>2. Order 的模板文件（列表 resources/views/backend/order/index.blade.php）中，搜索相关部分的 name 和字段名都要加上关联关系的方法前缀。</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;form-group col-sm-4 pull-left&quot;&gt;</span><br><span class=\"line\">    &lt;label for&#x3D;&quot;paymentInfo.payment_type&quot; class&#x3D;&quot;control-label col-sm-4&quot;&gt;支付方式&lt;&#x2F;label&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;div class&#x3D;&quot;col-sm-8&quot;&gt;</span><br><span class=\"line\">        &lt;select class&#x3D;&quot;form-control input-lg select2&quot; id&#x3D;&quot;paymentInfo.payment_type&quot; name&#x3D;&quot;paymentInfo.payment_type&quot;</span><br><span class=\"line\">                style&#x3D;&quot;width: 192px;&quot;&gt;</span><br><span class=\"line\">            &lt;option value&#x3D;&quot;&quot;&gt;全部&lt;&#x2F;option&gt;</span><br><span class=\"line\">            @if(isset($paymentType))</span><br><span class=\"line\">                @foreach($paymentType as $index &#x3D;&gt; $item)</span><br><span class=\"line\">                    &lt;option value&#x3D;&quot;&#123;&#123;$index&#125;&#125;&quot;</span><br><span class=\"line\">                            @if(isset($searchCondition[&#39;paymentInfo.payment_type&#39;]) &amp;&amp; $index &#x3D;&#x3D; $searchCondition[&#39;paymentInfo.payment_type&#39;]) selected&#x3D;&quot;selected&quot; @endif&gt;&#123;&#123;$item&#125;&#125;&lt;&#x2F;option&gt;</span><br><span class=\"line\">                @endforeach</span><br><span class=\"line\">            @endif</span><br><span class=\"line\">        &lt;&#x2F;select&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\"><a href=\"#3-在YourModelRepositoryEloquent-php-如FlashRepositoryEloquent-php-中添加-fieldSearchable-字段\" class=\"headerlink\" title=\"3. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段\"></a>3. 在YourModelRepositoryEloquent.php (如FlashRepositoryEloquent.php) 中添加 $fieldSearchable 字段</h2><p>如：</p>\n<pre><code>protected $fieldSearchable = [\n    &#39;paymentInfo.payment_type&#39;\n];\n\n要与模板文件的name一致。\n</code></pre>"},{"title":"【记录】Linux 开启 php 的 openssl 扩展","date":"2017-01-30T16:00:00.000Z","description":"php 版本升级到7.1.3后，发现 mcrypt加密算法不能用了。推荐的替代方案就是openssl，现记录一下其安装过程。","_content":"![](http://upload-images.jianshu.io/upload_images/693141-d7d7e6eb62a8ce9b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n> php 版本升级到7.1.3后，发现 mcrypt加密算法不能用了。推荐的替代方案就是openssl，现记录一下其安装过程。\n\n\n![](http://upload-images.jianshu.io/upload_images/693141-b96962a577e0f494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!-- more -->\n\n### 1. 下载php源码包\n\n首先确定使用的php版本，`php -v`，也可以在`phpinfo()`中查看。\n\n![](http://upload-images.jianshu.io/upload_images/693141-f2c96ade456c299c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n如图，我的版本是7.1.3。\n\n下载并解压，进入PHP的openssl扩展模块目录\n\n```\n$ wget http://mirrors.sohu.com/php/php-7.1.3.tar.gz\n$ tar zxvf php-7.1.3.tar.gz\n$ cd php-7.1.3/ext/openssl\n```\n\n编译安装\n\n```\n# $ which phpize 找到phpize应用位置\n/usr/bin/phpize\n# 然后执行\n$ /usr/bin/phpize\n# 执行后，发现错误 无法找到config.m4 ，config0.m4就是config.m4。直接重命名\n$ cp config0.m4 config.m4\n# 重新执行phpize\n$ /usr/bin/phpize\n# $ which php-config 找到php-config应用位置\n/usr/bin/php-config\n# 然后执行\n$ ./configure --with-openssl --with-php-config=/usr/bin/php-config\n$ make\n$ make test\n$ sudo make install\n```\n\n安装完成后，会返回一个.so文件（`openssl.so`）的目录。在此目录下把`openssl.so` 文件拷贝到你在`php.ini` 中指定的 `extension_dir` 下（在`php.ini`文件中查找：`extension_dir =` 或者打印出`phpinfo()`），我这里的目录是 `/usr/lib/php/20160303`\n\n![](http://upload-images.jianshu.io/upload_images/693141-7b85fea403ac77d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n在php配置文件添加 openssl 扩展\n\n```\n$ /etc/php/7.1/mods-available\n$ touch openssl.ini\n$ sudo vim openssl.ini\n```\n\n文件内容为\n\n```\n; configuration for php openssl module\n; priority=20\nextension=openssl.so\n```\n\n重启\n\n```\nsudo /etc/init.d/php7.1-fpm restart\nsudo service nginx restart\n```\n\n再次打印出`phpinfo()`，可以看到openssl相关的信息。\n\n![](http://upload-images.jianshu.io/upload_images/693141-d8737c97f385e984.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","source":"_posts/【记录】Linux-开启-php-的-openssl扩展.md","raw":"---\ntitle: 【记录】Linux 开启 php 的 openssl 扩展\ndate: 2017-01-31\ntags: openssl\ndescription: php 版本升级到7.1.3后，发现 mcrypt加密算法不能用了。推荐的替代方案就是openssl，现记录一下其安装过程。\n---\n![](http://upload-images.jianshu.io/upload_images/693141-d7d7e6eb62a8ce9b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n> php 版本升级到7.1.3后，发现 mcrypt加密算法不能用了。推荐的替代方案就是openssl，现记录一下其安装过程。\n\n\n![](http://upload-images.jianshu.io/upload_images/693141-b96962a577e0f494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!-- more -->\n\n### 1. 下载php源码包\n\n首先确定使用的php版本，`php -v`，也可以在`phpinfo()`中查看。\n\n![](http://upload-images.jianshu.io/upload_images/693141-f2c96ade456c299c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n如图，我的版本是7.1.3。\n\n下载并解压，进入PHP的openssl扩展模块目录\n\n```\n$ wget http://mirrors.sohu.com/php/php-7.1.3.tar.gz\n$ tar zxvf php-7.1.3.tar.gz\n$ cd php-7.1.3/ext/openssl\n```\n\n编译安装\n\n```\n# $ which phpize 找到phpize应用位置\n/usr/bin/phpize\n# 然后执行\n$ /usr/bin/phpize\n# 执行后，发现错误 无法找到config.m4 ，config0.m4就是config.m4。直接重命名\n$ cp config0.m4 config.m4\n# 重新执行phpize\n$ /usr/bin/phpize\n# $ which php-config 找到php-config应用位置\n/usr/bin/php-config\n# 然后执行\n$ ./configure --with-openssl --with-php-config=/usr/bin/php-config\n$ make\n$ make test\n$ sudo make install\n```\n\n安装完成后，会返回一个.so文件（`openssl.so`）的目录。在此目录下把`openssl.so` 文件拷贝到你在`php.ini` 中指定的 `extension_dir` 下（在`php.ini`文件中查找：`extension_dir =` 或者打印出`phpinfo()`），我这里的目录是 `/usr/lib/php/20160303`\n\n![](http://upload-images.jianshu.io/upload_images/693141-7b85fea403ac77d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n在php配置文件添加 openssl 扩展\n\n```\n$ /etc/php/7.1/mods-available\n$ touch openssl.ini\n$ sudo vim openssl.ini\n```\n\n文件内容为\n\n```\n; configuration for php openssl module\n; priority=20\nextension=openssl.so\n```\n\n重启\n\n```\nsudo /etc/init.d/php7.1-fpm restart\nsudo service nginx restart\n```\n\n再次打印出`phpinfo()`，可以看到openssl相关的信息。\n\n![](http://upload-images.jianshu.io/upload_images/693141-d8737c97f385e984.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n","slug":"【记录】Linux-开启-php-的-openssl扩展","published":1,"updated":"2020-09-11T01:04:35.046Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9f002s6wo1ey0f8kq6","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-d7d7e6eb62a8ce9b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>php 版本升级到7.1.3后，发现 mcrypt加密算法不能用了。推荐的替代方案就是openssl，现记录一下其安装过程。</p>\n</blockquote>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b96962a577e0f494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n\n<h3 id=\"1-下载php源码包\"><a href=\"#1-下载php源码包\" class=\"headerlink\" title=\"1. 下载php源码包\"></a>1. 下载php源码包</h3><p>首先确定使用的php版本，<code>php -v</code>，也可以在<code>phpinfo()</code>中查看。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-f2c96ade456c299c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>如图，我的版本是7.1.3。</p>\n<p>下载并解压，进入PHP的openssl扩展模块目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget http:&#x2F;&#x2F;mirrors.sohu.com&#x2F;php&#x2F;php-7.1.3.tar.gz</span><br><span class=\"line\">$ tar zxvf php-7.1.3.tar.gz</span><br><span class=\"line\">$ cd php-7.1.3&#x2F;ext&#x2F;openssl</span><br></pre></td></tr></table></figure>\n\n<p>编译安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># $ which phpize 找到phpize应用位置</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;phpize</span><br><span class=\"line\"># 然后执行</span><br><span class=\"line\">$ &#x2F;usr&#x2F;bin&#x2F;phpize</span><br><span class=\"line\"># 执行后，发现错误 无法找到config.m4 ，config0.m4就是config.m4。直接重命名</span><br><span class=\"line\">$ cp config0.m4 config.m4</span><br><span class=\"line\"># 重新执行phpize</span><br><span class=\"line\">$ &#x2F;usr&#x2F;bin&#x2F;phpize</span><br><span class=\"line\"># $ which php-config 找到php-config应用位置</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;php-config</span><br><span class=\"line\"># 然后执行</span><br><span class=\"line\">$ .&#x2F;configure --with-openssl --with-php-config&#x3D;&#x2F;usr&#x2F;bin&#x2F;php-config</span><br><span class=\"line\">$ make</span><br><span class=\"line\">$ make test</span><br><span class=\"line\">$ sudo make install</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，会返回一个.so文件（<code>openssl.so</code>）的目录。在此目录下把<code>openssl.so</code> 文件拷贝到你在<code>php.ini</code> 中指定的 <code>extension_dir</code> 下（在<code>php.ini</code>文件中查找：<code>extension_dir =</code> 或者打印出<code>phpinfo()</code>），我这里的目录是 <code>/usr/lib/php/20160303</code></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-7b85fea403ac77d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>在php配置文件添加 openssl 扩展</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ &#x2F;etc&#x2F;php&#x2F;7.1&#x2F;mods-available</span><br><span class=\"line\">$ touch openssl.ini</span><br><span class=\"line\">$ sudo vim openssl.ini</span><br></pre></td></tr></table></figure>\n\n<p>文件内容为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; configuration for php openssl module</span><br><span class=\"line\">; priority&#x3D;20</span><br><span class=\"line\">extension&#x3D;openssl.so</span><br></pre></td></tr></table></figure>\n\n<p>重启</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;php7.1-fpm restart</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure>\n\n<p>再次打印出<code>phpinfo()</code>，可以看到openssl相关的信息。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-d8737c97f385e984.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-d7d7e6eb62a8ce9b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>php 版本升级到7.1.3后，发现 mcrypt加密算法不能用了。推荐的替代方案就是openssl，现记录一下其安装过程。</p>\n</blockquote>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-b96962a577e0f494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<h3 id=\"1-下载php源码包\"><a href=\"#1-下载php源码包\" class=\"headerlink\" title=\"1. 下载php源码包\"></a>1. 下载php源码包</h3><p>首先确定使用的php版本，<code>php -v</code>，也可以在<code>phpinfo()</code>中查看。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-f2c96ade456c299c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>如图，我的版本是7.1.3。</p>\n<p>下载并解压，进入PHP的openssl扩展模块目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ wget http:&#x2F;&#x2F;mirrors.sohu.com&#x2F;php&#x2F;php-7.1.3.tar.gz</span><br><span class=\"line\">$ tar zxvf php-7.1.3.tar.gz</span><br><span class=\"line\">$ cd php-7.1.3&#x2F;ext&#x2F;openssl</span><br></pre></td></tr></table></figure>\n\n<p>编译安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># $ which phpize 找到phpize应用位置</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;phpize</span><br><span class=\"line\"># 然后执行</span><br><span class=\"line\">$ &#x2F;usr&#x2F;bin&#x2F;phpize</span><br><span class=\"line\"># 执行后，发现错误 无法找到config.m4 ，config0.m4就是config.m4。直接重命名</span><br><span class=\"line\">$ cp config0.m4 config.m4</span><br><span class=\"line\"># 重新执行phpize</span><br><span class=\"line\">$ &#x2F;usr&#x2F;bin&#x2F;phpize</span><br><span class=\"line\"># $ which php-config 找到php-config应用位置</span><br><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;php-config</span><br><span class=\"line\"># 然后执行</span><br><span class=\"line\">$ .&#x2F;configure --with-openssl --with-php-config&#x3D;&#x2F;usr&#x2F;bin&#x2F;php-config</span><br><span class=\"line\">$ make</span><br><span class=\"line\">$ make test</span><br><span class=\"line\">$ sudo make install</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后，会返回一个.so文件（<code>openssl.so</code>）的目录。在此目录下把<code>openssl.so</code> 文件拷贝到你在<code>php.ini</code> 中指定的 <code>extension_dir</code> 下（在<code>php.ini</code>文件中查找：<code>extension_dir =</code> 或者打印出<code>phpinfo()</code>），我这里的目录是 <code>/usr/lib/php/20160303</code></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-7b85fea403ac77d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>在php配置文件添加 openssl 扩展</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ &#x2F;etc&#x2F;php&#x2F;7.1&#x2F;mods-available</span><br><span class=\"line\">$ touch openssl.ini</span><br><span class=\"line\">$ sudo vim openssl.ini</span><br></pre></td></tr></table></figure>\n\n<p>文件内容为</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">; configuration for php openssl module</span><br><span class=\"line\">; priority&#x3D;20</span><br><span class=\"line\">extension&#x3D;openssl.so</span><br></pre></td></tr></table></figure>\n\n<p>重启</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;php7.1-fpm restart</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure>\n\n<p>再次打印出<code>phpinfo()</code>，可以看到openssl相关的信息。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-d8737c97f385e984.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>"},{"title":"【记录】PHP 项目中使用 Openssl 加密","date":"2017-04-16T16:00:00.000Z","description":null,"_content":"\n首先确保openssl已正确安装， `openssl verison`\n\n进入想要生成公钥和私钥的目录\n\n\n### 1. 生成RSA私钥\n<!--more-->\n\n```\n# 进入 openssl 客户端\n$ openssl\n\n# 生成1024位的私钥,不指定的话默认2048位\nOpenSSL> genrsa -out rsa_private_key.pem 1024\n\n# 如果提示下面的错误：unable to write 'random state'\ne is 65537 (0x10001)，执行下面的语句\n$ sudo rm ~/.rnd\n\n# 重新执行，在该目录就能看到生成的私钥\nOpenSSL> genrsa -out rsa_private_key.pem 1024\n\n```\n\n### 2. 把RSA私钥转换成PKCS8格式\n\n```\nOpenSSL> pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM –nocrypt\n\n$ touch rsa_private_key_pkcs8.pem\n# 将生成的私钥粘贴，并保存\n```\n\n### 3. 生成RSA公钥\n\n```\nOpenSSL> rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem\n```\n\n此时，我们可以看到一个文件名为`rsa_public_key.pem`的文件，打开它，可以看到`-----BEGIN PUBLIC KEY-----`开头，\n`-----END PUBLIC KEY-----`结尾的没有换行的字符串，这个就是公钥。\n\n### 4. 在项目中使用\n\n```php\npublic function opensslEncrypt($data)\n{\n    // 获取公匙\n    $publicKeyPath = app_path('Knowledge/OpensslKeys/') . 'rsa_public_key.pem';\n    //这个函数可用来判断公钥是否是可用的\n    $publicKey = openssl_pkey_get_public(file_get_contents($publicKeyPath));\n\n//        $privateKeyPath = app_path('Knowledge/OpensslKeys/') . 'rsa_private_key.pem';\n    //这个函数可用来判断私钥是否是可用的，可用返回资源id Resource id\n//        $privateKey = openssl_pkey_get_private(file_get_contents($privateKeyPath));\n\n    // 使用公钥加密，客户端使用私钥解密\n    if (!is_empty($publicKey)) {\n        $encrypted = \"\";\n        $decrypted = \"\";\n//            openssl_private_encrypt($data, $encrypted, $privateKey);//私钥加密\n//            $encrypted = base64_encode($encrypted);//加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的\n//\n//            $decrypted = \"\";\n//            openssl_public_decrypt(base64_decode($encrypted), $decrypted, $publicKey);//私钥加密的内容通过公钥可解密出来\n//            dd($decrypted);\n\n\n        openssl_public_encrypt($data, $encrypted, $publicKey);//公钥加密\n        return base64_encode($encrypted); // 加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的\n    }\n}\n        \n```\n\n\n","source":"_posts/【记录】PHP项目中使用Openssl加密.md","raw":"---\ntitle: 【记录】PHP 项目中使用 Openssl 加密\ndate: 2017-04-17\ntags: openssl\ndescription: \n---\n\n首先确保openssl已正确安装， `openssl verison`\n\n进入想要生成公钥和私钥的目录\n\n\n### 1. 生成RSA私钥\n<!--more-->\n\n```\n# 进入 openssl 客户端\n$ openssl\n\n# 生成1024位的私钥,不指定的话默认2048位\nOpenSSL> genrsa -out rsa_private_key.pem 1024\n\n# 如果提示下面的错误：unable to write 'random state'\ne is 65537 (0x10001)，执行下面的语句\n$ sudo rm ~/.rnd\n\n# 重新执行，在该目录就能看到生成的私钥\nOpenSSL> genrsa -out rsa_private_key.pem 1024\n\n```\n\n### 2. 把RSA私钥转换成PKCS8格式\n\n```\nOpenSSL> pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM –nocrypt\n\n$ touch rsa_private_key_pkcs8.pem\n# 将生成的私钥粘贴，并保存\n```\n\n### 3. 生成RSA公钥\n\n```\nOpenSSL> rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem\n```\n\n此时，我们可以看到一个文件名为`rsa_public_key.pem`的文件，打开它，可以看到`-----BEGIN PUBLIC KEY-----`开头，\n`-----END PUBLIC KEY-----`结尾的没有换行的字符串，这个就是公钥。\n\n### 4. 在项目中使用\n\n```php\npublic function opensslEncrypt($data)\n{\n    // 获取公匙\n    $publicKeyPath = app_path('Knowledge/OpensslKeys/') . 'rsa_public_key.pem';\n    //这个函数可用来判断公钥是否是可用的\n    $publicKey = openssl_pkey_get_public(file_get_contents($publicKeyPath));\n\n//        $privateKeyPath = app_path('Knowledge/OpensslKeys/') . 'rsa_private_key.pem';\n    //这个函数可用来判断私钥是否是可用的，可用返回资源id Resource id\n//        $privateKey = openssl_pkey_get_private(file_get_contents($privateKeyPath));\n\n    // 使用公钥加密，客户端使用私钥解密\n    if (!is_empty($publicKey)) {\n        $encrypted = \"\";\n        $decrypted = \"\";\n//            openssl_private_encrypt($data, $encrypted, $privateKey);//私钥加密\n//            $encrypted = base64_encode($encrypted);//加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的\n//\n//            $decrypted = \"\";\n//            openssl_public_decrypt(base64_decode($encrypted), $decrypted, $publicKey);//私钥加密的内容通过公钥可解密出来\n//            dd($decrypted);\n\n\n        openssl_public_encrypt($data, $encrypted, $publicKey);//公钥加密\n        return base64_encode($encrypted); // 加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的\n    }\n}\n        \n```\n\n\n","slug":"【记录】PHP项目中使用Openssl加密","published":1,"updated":"2020-09-11T01:04:35.046Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9h002v6wo11l1v2ubg","content":"<p>首先确保openssl已正确安装， <code>openssl verison</code></p>\n<p>进入想要生成公钥和私钥的目录</p>\n<h3 id=\"1-生成RSA私钥\"><a href=\"#1-生成RSA私钥\" class=\"headerlink\" title=\"1. 生成RSA私钥\"></a>1. 生成RSA私钥</h3><a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 进入 openssl 客户端</span><br><span class=\"line\">$ openssl</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成1024位的私钥,不指定的话默认2048位</span><br><span class=\"line\">OpenSSL&gt; genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\"></span><br><span class=\"line\"># 如果提示下面的错误：unable to write &#39;random state&#39;</span><br><span class=\"line\">e is 65537 (0x10001)，执行下面的语句</span><br><span class=\"line\">$ sudo rm ~&#x2F;.rnd</span><br><span class=\"line\"></span><br><span class=\"line\"># 重新执行，在该目录就能看到生成的私钥</span><br><span class=\"line\">OpenSSL&gt; genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-把RSA私钥转换成PKCS8格式\"><a href=\"#2-把RSA私钥转换成PKCS8格式\" class=\"headerlink\" title=\"2. 把RSA私钥转换成PKCS8格式\"></a>2. 把RSA私钥转换成PKCS8格式</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">OpenSSL&gt; pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM –nocrypt</span><br><span class=\"line\"></span><br><span class=\"line\">$ touch rsa_private_key_pkcs8.pem</span><br><span class=\"line\"># 将生成的私钥粘贴，并保存</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-生成RSA公钥\"><a href=\"#3-生成RSA公钥\" class=\"headerlink\" title=\"3. 生成RSA公钥\"></a>3. 生成RSA公钥</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">OpenSSL&gt; rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br></pre></td></tr></table></figure>\n\n<p>此时，我们可以看到一个文件名为<code>rsa_public_key.pem</code>的文件，打开它，可以看到<code>-----BEGIN PUBLIC KEY-----</code>开头，<br><code>-----END PUBLIC KEY-----</code>结尾的没有换行的字符串，这个就是公钥。</p>\n<h3 id=\"4-在项目中使用\"><a href=\"#4-在项目中使用\" class=\"headerlink\" title=\"4. 在项目中使用\"></a>4. 在项目中使用</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">opensslEncrypt</span>(<span class=\"params\">$data</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取公匙</span></span><br><span class=\"line\">    $publicKeyPath = app_path(<span class=\"string\">&#x27;Knowledge/OpensslKeys/&#x27;</span>) . <span class=\"string\">&#x27;rsa_public_key.pem&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//这个函数可用来判断公钥是否是可用的</span></span><br><span class=\"line\">    $publicKey = openssl_pkey_get_public(file_get_contents($publicKeyPath));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//        $privateKeyPath = app_path(&#x27;Knowledge/OpensslKeys/&#x27;) . &#x27;rsa_private_key.pem&#x27;;</span></span><br><span class=\"line\">    <span class=\"comment\">//这个函数可用来判断私钥是否是可用的，可用返回资源id Resource id</span></span><br><span class=\"line\"><span class=\"comment\">//        $privateKey = openssl_pkey_get_private(file_get_contents($privateKeyPath));</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用公钥加密，客户端使用私钥解密</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!is_empty($publicKey)) &#123;</span><br><span class=\"line\">        $encrypted = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        $decrypted = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//            openssl_private_encrypt($data, $encrypted, $privateKey);//私钥加密</span></span><br><span class=\"line\"><span class=\"comment\">//            $encrypted = base64_encode($encrypted);//加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//            $decrypted = &quot;&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//            openssl_public_decrypt(base64_decode($encrypted), $decrypted, $publicKey);//私钥加密的内容通过公钥可解密出来</span></span><br><span class=\"line\"><span class=\"comment\">//            dd($decrypted);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        openssl_public_encrypt($data, $encrypted, $publicKey);<span class=\"comment\">//公钥加密</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> base64_encode($encrypted); <span class=\"comment\">// 加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p>首先确保openssl已正确安装， <code>openssl verison</code></p>\n<p>进入想要生成公钥和私钥的目录</p>\n<h3 id=\"1-生成RSA私钥\"><a href=\"#1-生成RSA私钥\" class=\"headerlink\" title=\"1. 生成RSA私钥\"></a>1. 生成RSA私钥</h3>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 进入 openssl 客户端</span><br><span class=\"line\">$ openssl</span><br><span class=\"line\"></span><br><span class=\"line\"># 生成1024位的私钥,不指定的话默认2048位</span><br><span class=\"line\">OpenSSL&gt; genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\"></span><br><span class=\"line\"># 如果提示下面的错误：unable to write &#39;random state&#39;</span><br><span class=\"line\">e is 65537 (0x10001)，执行下面的语句</span><br><span class=\"line\">$ sudo rm ~&#x2F;.rnd</span><br><span class=\"line\"></span><br><span class=\"line\"># 重新执行，在该目录就能看到生成的私钥</span><br><span class=\"line\">OpenSSL&gt; genrsa -out rsa_private_key.pem 1024</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-把RSA私钥转换成PKCS8格式\"><a href=\"#2-把RSA私钥转换成PKCS8格式\" class=\"headerlink\" title=\"2. 把RSA私钥转换成PKCS8格式\"></a>2. 把RSA私钥转换成PKCS8格式</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">OpenSSL&gt; pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM –nocrypt</span><br><span class=\"line\"></span><br><span class=\"line\">$ touch rsa_private_key_pkcs8.pem</span><br><span class=\"line\"># 将生成的私钥粘贴，并保存</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-生成RSA公钥\"><a href=\"#3-生成RSA公钥\" class=\"headerlink\" title=\"3. 生成RSA公钥\"></a>3. 生成RSA公钥</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">OpenSSL&gt; rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem</span><br></pre></td></tr></table></figure>\n\n<p>此时，我们可以看到一个文件名为<code>rsa_public_key.pem</code>的文件，打开它，可以看到<code>-----BEGIN PUBLIC KEY-----</code>开头，<br><code>-----END PUBLIC KEY-----</code>结尾的没有换行的字符串，这个就是公钥。</p>\n<h3 id=\"4-在项目中使用\"><a href=\"#4-在项目中使用\" class=\"headerlink\" title=\"4. 在项目中使用\"></a>4. 在项目中使用</h3><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">opensslEncrypt</span>(<span class=\"params\">$data</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 获取公匙</span></span><br><span class=\"line\">    $publicKeyPath = app_path(<span class=\"string\">&#x27;Knowledge/OpensslKeys/&#x27;</span>) . <span class=\"string\">&#x27;rsa_public_key.pem&#x27;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//这个函数可用来判断公钥是否是可用的</span></span><br><span class=\"line\">    $publicKey = openssl_pkey_get_public(file_get_contents($publicKeyPath));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//        $privateKeyPath = app_path(&#x27;Knowledge/OpensslKeys/&#x27;) . &#x27;rsa_private_key.pem&#x27;;</span></span><br><span class=\"line\">    <span class=\"comment\">//这个函数可用来判断私钥是否是可用的，可用返回资源id Resource id</span></span><br><span class=\"line\"><span class=\"comment\">//        $privateKey = openssl_pkey_get_private(file_get_contents($privateKeyPath));</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用公钥加密，客户端使用私钥解密</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!is_empty($publicKey)) &#123;</span><br><span class=\"line\">        $encrypted = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        $decrypted = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//            openssl_private_encrypt($data, $encrypted, $privateKey);//私钥加密</span></span><br><span class=\"line\"><span class=\"comment\">//            $encrypted = base64_encode($encrypted);//加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"comment\">//            $decrypted = &quot;&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//            openssl_public_decrypt(base64_decode($encrypted), $decrypted, $publicKey);//私钥加密的内容通过公钥可解密出来</span></span><br><span class=\"line\"><span class=\"comment\">//            dd($decrypted);</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        openssl_public_encrypt($data, $encrypted, $publicKey);<span class=\"comment\">//公钥加密</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> base64_encode($encrypted); <span class=\"comment\">// 加密后的内容通常含有特殊字符，需要编码转换下，在网络间通过url传输时要注意base64编码是否是url安全的</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">        </span><br></pre></td></tr></table></figure>"},{"title":"php7 安装 mysql 扩展","date":"2017-03-05T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-5a30165323bf547c.gif?imageMogr2/auto-orient/strip)\n<!--more-->\n\nPHP7全面删除Mysql扩展支持，原本的mysql_*系列函数将在mysql中不再得到支持。导致旧的项目报错，现把扩展装回，记录一下。\n\n## 1. 首先下载[mysql扩展](http://git.php.net/?p=pecl/database/mysql.git;a=summary)\n\n## 2. 解压\n```\ntar zxvf mysql.tar.gz\n```\n## 3. cd 进解压后的目录\n```\nphpize\n./configure\nmake\n```\n在 modules 目录下生成了一个 mysql.so 文件。\n\n## 4. php 配置文件添加mysql扩展\n\n```\n# 首先打印出 phpinfo()， php的配置文件在这里\nLoaded Configuration File\t/etc/php/7.1/fpm/php.ini\nsudo vim /etc/php/7.1/fpm/php.ini\n# 添加一行\nextension=/path/to/mysql.so\n# 重启 php-fpm\nsudo /etc/init.d/php7.1-fpm restart\n```\n\n\n","source":"_posts/php7-安装-mysql-扩展.md","raw":"---\ntitle: php7 安装 mysql 扩展\ndate: 2017-03-06\ntags: mysql\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-5a30165323bf547c.gif?imageMogr2/auto-orient/strip)\n<!--more-->\n\nPHP7全面删除Mysql扩展支持，原本的mysql_*系列函数将在mysql中不再得到支持。导致旧的项目报错，现把扩展装回，记录一下。\n\n## 1. 首先下载[mysql扩展](http://git.php.net/?p=pecl/database/mysql.git;a=summary)\n\n## 2. 解压\n```\ntar zxvf mysql.tar.gz\n```\n## 3. cd 进解压后的目录\n```\nphpize\n./configure\nmake\n```\n在 modules 目录下生成了一个 mysql.so 文件。\n\n## 4. php 配置文件添加mysql扩展\n\n```\n# 首先打印出 phpinfo()， php的配置文件在这里\nLoaded Configuration File\t/etc/php/7.1/fpm/php.ini\nsudo vim /etc/php/7.1/fpm/php.ini\n# 添加一行\nextension=/path/to/mysql.so\n# 重启 php-fpm\nsudo /etc/init.d/php7.1-fpm restart\n```\n\n\n","slug":"php7-安装-mysql-扩展","published":1,"updated":"2020-09-11T01:04:35.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9j002x6wo18obv50uo","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-5a30165323bf547c.gif?imageMogr2/auto-orient/strip\"></p>\n<a id=\"more\"></a>\n\n<p>PHP7全面删除Mysql扩展支持，原本的mysql_*系列函数将在mysql中不再得到支持。导致旧的项目报错，现把扩展装回，记录一下。</p>\n<h2 id=\"1-首先下载mysql扩展\"><a href=\"#1-首先下载mysql扩展\" class=\"headerlink\" title=\"1. 首先下载mysql扩展\"></a>1. 首先下载<a href=\"http://git.php.net/?p=pecl/database/mysql.git;a=summary\">mysql扩展</a></h2><h2 id=\"2-解压\"><a href=\"#2-解压\" class=\"headerlink\" title=\"2. 解压\"></a>2. 解压</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf mysql.tar.gz</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-cd-进解压后的目录\"><a href=\"#3-cd-进解压后的目录\" class=\"headerlink\" title=\"3. cd 进解压后的目录\"></a>3. cd 进解压后的目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phpize</span><br><span class=\"line\">.&#x2F;configure</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure>\n<p>在 modules 目录下生成了一个 mysql.so 文件。</p>\n<h2 id=\"4-php-配置文件添加mysql扩展\"><a href=\"#4-php-配置文件添加mysql扩展\" class=\"headerlink\" title=\"4. php 配置文件添加mysql扩展\"></a>4. php 配置文件添加mysql扩展</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 首先打印出 phpinfo()， php的配置文件在这里</span><br><span class=\"line\">Loaded Configuration File\t&#x2F;etc&#x2F;php&#x2F;7.1&#x2F;fpm&#x2F;php.ini</span><br><span class=\"line\">sudo vim &#x2F;etc&#x2F;php&#x2F;7.1&#x2F;fpm&#x2F;php.ini</span><br><span class=\"line\"># 添加一行</span><br><span class=\"line\">extension&#x3D;&#x2F;path&#x2F;to&#x2F;mysql.so</span><br><span class=\"line\"># 重启 php-fpm</span><br><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;php7.1-fpm restart</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-5a30165323bf547c.gif?imageMogr2/auto-orient/strip\"></p>","more":"<p>PHP7全面删除Mysql扩展支持，原本的mysql_*系列函数将在mysql中不再得到支持。导致旧的项目报错，现把扩展装回，记录一下。</p>\n<h2 id=\"1-首先下载mysql扩展\"><a href=\"#1-首先下载mysql扩展\" class=\"headerlink\" title=\"1. 首先下载mysql扩展\"></a>1. 首先下载<a href=\"http://git.php.net/?p=pecl/database/mysql.git;a=summary\">mysql扩展</a></h2><h2 id=\"2-解压\"><a href=\"#2-解压\" class=\"headerlink\" title=\"2. 解压\"></a>2. 解压</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar zxvf mysql.tar.gz</span><br></pre></td></tr></table></figure>\n<h2 id=\"3-cd-进解压后的目录\"><a href=\"#3-cd-进解压后的目录\" class=\"headerlink\" title=\"3. cd 进解压后的目录\"></a>3. cd 进解压后的目录</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">phpize</span><br><span class=\"line\">.&#x2F;configure</span><br><span class=\"line\">make</span><br></pre></td></tr></table></figure>\n<p>在 modules 目录下生成了一个 mysql.so 文件。</p>\n<h2 id=\"4-php-配置文件添加mysql扩展\"><a href=\"#4-php-配置文件添加mysql扩展\" class=\"headerlink\" title=\"4. php 配置文件添加mysql扩展\"></a>4. php 配置文件添加mysql扩展</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 首先打印出 phpinfo()， php的配置文件在这里</span><br><span class=\"line\">Loaded Configuration File\t&#x2F;etc&#x2F;php&#x2F;7.1&#x2F;fpm&#x2F;php.ini</span><br><span class=\"line\">sudo vim &#x2F;etc&#x2F;php&#x2F;7.1&#x2F;fpm&#x2F;php.ini</span><br><span class=\"line\"># 添加一行</span><br><span class=\"line\">extension&#x3D;&#x2F;path&#x2F;to&#x2F;mysql.so</span><br><span class=\"line\"># 重启 php-fpm</span><br><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;php7.1-fpm restart</span><br></pre></td></tr></table></figure>"},{"title":"【记录】sed 学习","date":"2017-05-25T15:11:12.000Z","_content":"\n本文是慕课网 [《实例妙解sed 和 awk 的秘密》》](http://www.imooc.com/learn/819) 的学习记录的第二部分：sed。\n\nLinux 三大利器： grep, sed, awk.\n\n<!--more-->\n\n## 1. sed 工作原理\n\nsed 是一种流处理编辑器\n\n1. 文本或管道输入（正则选定文本）\n2. 读入一行到模式空间（临时缓冲区）\n3. sed命令处理\n4. 结果输出到屏幕\n5. 重复第2步操作\n\nsed 一次处理一行内容\n\nsed 不改变文件内容 （除非重定向）\n\n\n### 2. 使用 sed 格式\n\n- 命令行格式\n\n```\n$ sed [options] 'command' file(s)\n```\n\noptions: -e, -n\n\ncommand: 行定位（正则） + sed命令 （操作）\n\n- 脚本格式\n\n```\n$ sed -f scriptfile file(s)\n```\n\n举个栗子：\n\n```\n// p 即 print，打印命令\n$ sed -n 'root/p'\n```\n\n## 2. sed 基本操作命令\n\n### 1. -p 打印相关命令\n\n```\n$ sed 'p' passwd\n```\n\n结果每一行都被输出了两次，为什么？\n\nsed 原理为读入一行，输出一行到屏幕，现在中间又加入一个打印的步骤，所以就出现了重复。\n\n如何规避？\n\n再添加一个 -n 参数即可。该参数一般与 p 参数一起使用，表示只打印出相关的行。\n\n```\n$ sed -n 'p' passwd\n```\n\n### 2. 行定位\n\n- 定位一行： x; /pattern/;\n\n```\n// 打印第33行\n$ sed -n '33p' passwd\n_svn:*:73:73:SVN Server:/var/empty:/usr/bin/false\n```\n\n通过 nl 命令查看行号\n\n```\n// 打印第33行\n$ nl passwd | sed -n '33p'\n    33\t_svn:*:73:73:SVN Server:/var/empty:/usr/bin/false\n```\n\n```\n// 打印包含root的行\n$ sed -n '/root/p' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false\n```\n\n- 定位多行（范围）： x,y; /pattery/,x;\n\n```\n// 打印10到20行\n$ nl passwd | sed -n '10,20p'\n```\n\n```\n// 打印第一个包含root的行到第一个包含www的行之间所有的行\n$ nl passwd | sed -n '/root/,/www/p\n```\n\n都是匹配第一个\n\n- 取反操作 !\n\n\n```\n// 不打印第20行\n$ nl passwd | sed -n '20!p'\n```\n\n```\n// 不打印10到20行\n$ nl passwd | sed -n '10,20!p'\n```\n\n- 定位间隔几行 first~step\n\n```\n// 输出奇数行，Mac亲测无效，CentOS 有效\n$ nl passwd | sed -n '1~2p'\n     1\troot:x:0:0:root:/root:/bin/bash\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n     ...\n```\n\n### 3. sed 行处理命令\n\n#### 1. 基本操作命令（Mac下失效）\n\na：新增行\n\ni：插入行\n\nc：替代行\n\nd：删除行\n\n```\n// 在第5行后面添加分隔线\n$ nl passwd | sed '5a ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     ...\n```\n\n```\n// 在第1-5行后面添加分隔线\n$ nl passwd | sed '1,5a ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n===============\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n===============\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n===============\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n===============\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     ...\n```\n\n```\n// 在第1-5行之前添加分隔线\n$ nl passwd | sed '5i ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n===============\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n```\n\n```\n// 第5行替换为其他内容\n$ nl passwd | sed '5c ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n```\n\n```\n$ nl passwd | sed '1,5c ==============='\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     7\tshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n```\n\n> 注意替换规则与插入规则的区别，连续行的替换是整体替换，而不是一行一行。\n\n随意感受一下\n\n```\n$ nl passwd | sed '/nologin/c ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n===============\n===============\n===============\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     7\tshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n     8\thalt:x:7:0:halt:/sbin:/sbin/halt\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n    25\tzzp:x:1000:1000::/home/zzp:/bin/bash\n===============\n```\n\n```\n// 删除行，不会影响源文件\n$ nl passwd | sed '/root/d'\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n\n```\n#### 2. 案例1 修改配置文件\n\n简单的操作就可以替代 vim 了\n\n```\n// 在文档末尾增加一些内容\n$ sed '$a new line \\nnew line'\n```\n\n#### 3. 案例2 删除文本中的空行\n\n```\n$ sed '/^$/d' file\n```\n\n#### 4. 案例3 log 中提取 error\n\n```\n$ sed -n '/Error/p' file\n```\n\n### 4. sed 替换命令 s （核心，重点）\n\n```\n$ sed 's/nologin/login/' passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/login\ndaemon:x:2:2:daemon:/sbin:/sbin/login\nadm:x:3:4:adm:/var/adm:/sbin/login\nlp:x:4:7:lp:/var/spool/lpd:/sbin/login\n```\n```\n$ sed 's/:/%/' passwd\nroot%x:0:0:root:/root:/bin/bash\nbin%x:1:1:bin:/bin:/sbin/nologin\ndaemon%x:2:2:daemon:/sbin:/sbin/nologin\nadm%x:3:4:adm:/var/adm:/sbin/nologin\nlp%x:4:7:lp:/var/spool/lpd:/sbin/nologin\n```\n\n这里出现了一个问题，每一行只替换了第一个匹配。\n\n添加全局标记 g 即可\n\n```\n$ sed 's/:/%/g' passwd\nroot%x%0%0%root%/root%/bin/bash\nbin%x%1%1%bin%/bin%/sbin/nologin\ndaemon%x%2%2%daemon%/sbin%/sbin/nologin\nadm%x%3%4%adm%/var/adm%/sbin/nologin\nlp%x%4%7%lp%/var/spool/lpd%/sbin/nologin\n```\n\n#### 1. 案例：获取网卡中的ip\n\n思路：首先取出 ifconfig 命令输出的第二行，然后将 ip 前后两部分无用的信息分别替换为空即可。\n\n```\n// 取出所需行\n$ ifconfig | sed -n '/inet .*broadcast.*/p'\n        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255\n```\n\n```\n// 替换ip前的字符为空\n$ ifconfig | sed -n '/inet .*broadcast.*/p' | sed 's/inet //'\n        172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255\n```\n\n```\n// 替换ip后的字符为空\n$ ifconfig | sed -n '/inet .*broadcast.*/p' | sed 's/inet //' | sed 's/netmask.*//'\n        172.17.147.89\n```\n\n```\n// 替换可能漏掉的空格\n$ ifconfig | sed -n '/inet .*broadcast.*/p' | sed 's/inet //' | sed 's/netmask.*//' | sed 's/\\ //'\n       172.17.147.89\n```\n\n## 3. sed 高级操作命令\n\n### 1. -{ }： 多个sed命令，用；分开\n\n```\n// 先将2-10行删除，然后将false替换为true，两个命令写到一起，这里{}不用转义\n$ nl passwd | sed '{2,10d;s/false/true/}'\n     1\troot:x:0:0:root:/root:/bin/bash\n    11\tgames:x:12:100:games:/usr/games:/sbin/nologin\n    12\tftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\n    13\tnobody:x:99:99:Nobody:/:/sbin/nologin\n```\n\n### 2. -n 读取下一个输入行（用下一个命令处理）\n\n有一个跳行的过程\n\n```\n$ nl passwd | sed -n '{n;p}'\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     8\thalt:x:7:0:halt:/sbin:/sbin/halt\n```\n\n这就实现了偶数行输出。如何输出奇数行？先输入p后跳行即可。\n\n```\n$ nl passwd | sed -n '{p;n}'\n     1\troot:x:0:0:root:/root:/bin/bash\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n     7\tshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n```\n\n之前的等效做法\n\n```\n$ nl passwd | sed -n '1~2p'\n$ nl passwd | sed -n '2~2p'\n```\n\n2,5,8... 这样输出呢？\n\n```\n// 两种方法等效，推荐使用前者\n$ nl passwd | sed -n '2~3p'\n$ nl passwd | sed -n '{n;p;n}'\n```\n\n### 3. & 符号使用\n\n-&: 替换固定字符串\n优化替换操作。\n\n案例： passwd 文件中的用户名后面添加空格，便于阅读。\n\n分析：\n- 用户名都是在行首，可以包含字母，中划线和下划线。\n\n使用 &，就没有必要在替换后的字符串中将替换前的正则重新再写一遍。\n\n```\n$ sed 's/^[a-z_-]\\+/&   /' passwd\nroot   :x:0:0:root:/root:/bin/bash\nbin   :x:1:1:bin:/bin:/sbin/nologin\ndaemon   :x:2:2:daemon:/sbin:/sbin/nologin\n```\n\n原来的写法可能是这样的，还不一定能实现。\n\n```\n$ sed 's/^[a-z_-]\\+/^[a-z_-]\\+  /' passwd\n```\n\n#### 案例： 大小写转换\n\n将用户名的首字母转化为大写/小写\n\n元字符 \n- \\u \\l (首字母转换) \n- \\U \\L (字符串转换) \n- uppercase, lowercase\n\n```\n$ sed 's/^[a-z_-]\\+/\\u&/' passwd\nRoot:x:0:0:root:/root:/bin/bash\nBin:x:1:1:bin:/bin:/sbin/nologin\nDaemon:x:2:2:daemon:/sbin:/sbin/nologin\nAdm:x:3:4:adm:/var/adm:/sbin/nologin\n```\n\n```\n$ sed 's/^[a-z_-]\\+/\\U&/' passwd\nROOT:x:0:0:root:/root:/bin/bash\nBIN:x:1:1:bin:/bin:/sbin/nologin\nDAEMON:x:2:2:daemon:/sbin:/sbin/nologin\n```\n\n文件名转大写\n\n```\n$ ls *.txt | sed 's/^\\w\\+/\\U&/'\n```\n\n\n### 4. （）符号\n\n一个括号代表一个要被替换的部分。注意转义括号。\n\n示例：数据筛选，获取passwd中 USER, UID  和 GID\n\n一个一个获取\n\n```\n$ sed 's/\\(^[a-z_-]\\+\\):.*$/\\1/' passwd\nroot\nbin\ndaemon\nadm\n```\n\n```\n$ sed 's/\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\).*$/\\1 \\2/' passwd\nroot 0\nbin 1\ndaemon 2\nadm 3\nlp 4\nsync 5\nshutdown 6\nhalt 7\nmail 8\noperator 11\ngames 12\nftp 14\nnobody 99\n```\n\n```\n$ $ sed 's/\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\):\\([0-9]\\+\\).*$/USER:\\1 UID:\\2 GID:\\3/' passwd\nUSER:root UID:0 GID:0\nUSER:bin UID:1 GID:1\nUSER:daemon UID:2 GID:2\nUSER:adm UID:3 GID:4\nUSER:lp UID:4 GID:7\nUSER:sync UID:5 GID:0\nUSER:shutdown UID:6 GID:0\nUSER:halt UID:7 GID:0\nUSER:mail UID:8 GID:12\nUSER:operator UID:11 GID:0\nUSER:games UID:12 GID:100\nUSER:ftp UID:14 GID:50\nUSER:nobody UID:99 GID:99\n```\n\n示例： 获取网卡IP\n\n分析：之前我们是将IP行分为三段，分别将前后两段无用的信息替换为空。现在我们还是将该行分为三段，但是只要获取第二段即可。\n\n先找到IP所在的行，匹配第一部分，注意别漏了空格。第二部分用括号括起来，用于输出，第三部分不用管。最后将第二部分打印输出即可。\n\n```\n$ ifconfig | sed -n '/inet /p' | sed -n '1p' | sed 's/[a-z ]\\+\\([0-9.]\\+\\) .*$/\\1/'\n172.17.147.89\n```\n\n### 5. rw 命令\n\n读和写命令，文件互操作\n\nr: 复制指定文件插入到匹配行\n\nw: 复制匹配行拷贝至指定文件\n\n```\n$ echo -e '11111\\n22222\\n33333' > 123.txt\n$ echo -e 'aaaa\\nbbbbb\\ncccc' > abc.txt\n```\n\n```\n// 读取文件123.txt，将结果放入到abc.txt 中，放置位置为第一行后。\n$ sed '1r 123.txt' abc.txt\naaaa\n11111\n22222\n33333\nbbbbb\ncccc\n```\n\n如果不指定行号，将会在目录文件的每一行后面插入读取到的文件内容。\n\n读文件后，两个文件的内容都没有发生改变。\n\n```\n// 将123.txt文件的第一行写入abc.txt\n$ sed '1w abc.txt' 123.txt\n```\n\n写操作后，abc.txt内容受影响，原内容消失，只剩下本次操作写入的内容。不指定行号就相当于文件内容拷贝。\n\n引号中是rw直接操作的文件。使用w的时候要格外小心。\n\n### 6. q 命令\n\n退出 sed\n\n在执行中间提前退出sed，没必要每次都执行到最后一行。\n\n```\n// 执行到第5行退出sed\n$ nl passwd | sed '5q'\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n// 找到第一个 nologin 就退出 sed\n$ nl passwd | sed '/nologin/q'\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n```\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-25/45710249.jpg)\n\n\n","source":"_posts/【记录】sed 学习.md","raw":"---\ntitle: 【记录】sed 学习\ndate: 2017-05-25 23:11:12\ntags: sed\ncategories: Linux\n---\n\n本文是慕课网 [《实例妙解sed 和 awk 的秘密》》](http://www.imooc.com/learn/819) 的学习记录的第二部分：sed。\n\nLinux 三大利器： grep, sed, awk.\n\n<!--more-->\n\n## 1. sed 工作原理\n\nsed 是一种流处理编辑器\n\n1. 文本或管道输入（正则选定文本）\n2. 读入一行到模式空间（临时缓冲区）\n3. sed命令处理\n4. 结果输出到屏幕\n5. 重复第2步操作\n\nsed 一次处理一行内容\n\nsed 不改变文件内容 （除非重定向）\n\n\n### 2. 使用 sed 格式\n\n- 命令行格式\n\n```\n$ sed [options] 'command' file(s)\n```\n\noptions: -e, -n\n\ncommand: 行定位（正则） + sed命令 （操作）\n\n- 脚本格式\n\n```\n$ sed -f scriptfile file(s)\n```\n\n举个栗子：\n\n```\n// p 即 print，打印命令\n$ sed -n 'root/p'\n```\n\n## 2. sed 基本操作命令\n\n### 1. -p 打印相关命令\n\n```\n$ sed 'p' passwd\n```\n\n结果每一行都被输出了两次，为什么？\n\nsed 原理为读入一行，输出一行到屏幕，现在中间又加入一个打印的步骤，所以就出现了重复。\n\n如何规避？\n\n再添加一个 -n 参数即可。该参数一般与 p 参数一起使用，表示只打印出相关的行。\n\n```\n$ sed -n 'p' passwd\n```\n\n### 2. 行定位\n\n- 定位一行： x; /pattern/;\n\n```\n// 打印第33行\n$ sed -n '33p' passwd\n_svn:*:73:73:SVN Server:/var/empty:/usr/bin/false\n```\n\n通过 nl 命令查看行号\n\n```\n// 打印第33行\n$ nl passwd | sed -n '33p'\n    33\t_svn:*:73:73:SVN Server:/var/empty:/usr/bin/false\n```\n\n```\n// 打印包含root的行\n$ sed -n '/root/p' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false\n```\n\n- 定位多行（范围）： x,y; /pattery/,x;\n\n```\n// 打印10到20行\n$ nl passwd | sed -n '10,20p'\n```\n\n```\n// 打印第一个包含root的行到第一个包含www的行之间所有的行\n$ nl passwd | sed -n '/root/,/www/p\n```\n\n都是匹配第一个\n\n- 取反操作 !\n\n\n```\n// 不打印第20行\n$ nl passwd | sed -n '20!p'\n```\n\n```\n// 不打印10到20行\n$ nl passwd | sed -n '10,20!p'\n```\n\n- 定位间隔几行 first~step\n\n```\n// 输出奇数行，Mac亲测无效，CentOS 有效\n$ nl passwd | sed -n '1~2p'\n     1\troot:x:0:0:root:/root:/bin/bash\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n     ...\n```\n\n### 3. sed 行处理命令\n\n#### 1. 基本操作命令（Mac下失效）\n\na：新增行\n\ni：插入行\n\nc：替代行\n\nd：删除行\n\n```\n// 在第5行后面添加分隔线\n$ nl passwd | sed '5a ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     ...\n```\n\n```\n// 在第1-5行后面添加分隔线\n$ nl passwd | sed '1,5a ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n===============\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n===============\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n===============\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n===============\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     ...\n```\n\n```\n// 在第1-5行之前添加分隔线\n$ nl passwd | sed '5i ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n===============\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n```\n\n```\n// 第5行替换为其他内容\n$ nl passwd | sed '5c ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n```\n\n```\n$ nl passwd | sed '1,5c ==============='\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     7\tshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n```\n\n> 注意替换规则与插入规则的区别，连续行的替换是整体替换，而不是一行一行。\n\n随意感受一下\n\n```\n$ nl passwd | sed '/nologin/c ==============='\n     1\troot:x:0:0:root:/root:/bin/bash\n===============\n===============\n===============\n===============\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     7\tshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n     8\thalt:x:7:0:halt:/sbin:/sbin/halt\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n===============\n    25\tzzp:x:1000:1000::/home/zzp:/bin/bash\n===============\n```\n\n```\n// 删除行，不会影响源文件\n$ nl passwd | sed '/root/d'\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n\n```\n#### 2. 案例1 修改配置文件\n\n简单的操作就可以替代 vim 了\n\n```\n// 在文档末尾增加一些内容\n$ sed '$a new line \\nnew line'\n```\n\n#### 3. 案例2 删除文本中的空行\n\n```\n$ sed '/^$/d' file\n```\n\n#### 4. 案例3 log 中提取 error\n\n```\n$ sed -n '/Error/p' file\n```\n\n### 4. sed 替换命令 s （核心，重点）\n\n```\n$ sed 's/nologin/login/' passwd\nroot:x:0:0:root:/root:/bin/bash\nbin:x:1:1:bin:/bin:/sbin/login\ndaemon:x:2:2:daemon:/sbin:/sbin/login\nadm:x:3:4:adm:/var/adm:/sbin/login\nlp:x:4:7:lp:/var/spool/lpd:/sbin/login\n```\n```\n$ sed 's/:/%/' passwd\nroot%x:0:0:root:/root:/bin/bash\nbin%x:1:1:bin:/bin:/sbin/nologin\ndaemon%x:2:2:daemon:/sbin:/sbin/nologin\nadm%x:3:4:adm:/var/adm:/sbin/nologin\nlp%x:4:7:lp:/var/spool/lpd:/sbin/nologin\n```\n\n这里出现了一个问题，每一行只替换了第一个匹配。\n\n添加全局标记 g 即可\n\n```\n$ sed 's/:/%/g' passwd\nroot%x%0%0%root%/root%/bin/bash\nbin%x%1%1%bin%/bin%/sbin/nologin\ndaemon%x%2%2%daemon%/sbin%/sbin/nologin\nadm%x%3%4%adm%/var/adm%/sbin/nologin\nlp%x%4%7%lp%/var/spool/lpd%/sbin/nologin\n```\n\n#### 1. 案例：获取网卡中的ip\n\n思路：首先取出 ifconfig 命令输出的第二行，然后将 ip 前后两部分无用的信息分别替换为空即可。\n\n```\n// 取出所需行\n$ ifconfig | sed -n '/inet .*broadcast.*/p'\n        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255\n```\n\n```\n// 替换ip前的字符为空\n$ ifconfig | sed -n '/inet .*broadcast.*/p' | sed 's/inet //'\n        172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255\n```\n\n```\n// 替换ip后的字符为空\n$ ifconfig | sed -n '/inet .*broadcast.*/p' | sed 's/inet //' | sed 's/netmask.*//'\n        172.17.147.89\n```\n\n```\n// 替换可能漏掉的空格\n$ ifconfig | sed -n '/inet .*broadcast.*/p' | sed 's/inet //' | sed 's/netmask.*//' | sed 's/\\ //'\n       172.17.147.89\n```\n\n## 3. sed 高级操作命令\n\n### 1. -{ }： 多个sed命令，用；分开\n\n```\n// 先将2-10行删除，然后将false替换为true，两个命令写到一起，这里{}不用转义\n$ nl passwd | sed '{2,10d;s/false/true/}'\n     1\troot:x:0:0:root:/root:/bin/bash\n    11\tgames:x:12:100:games:/usr/games:/sbin/nologin\n    12\tftp:x:14:50:FTP User:/var/ftp:/sbin/nologin\n    13\tnobody:x:99:99:Nobody:/:/sbin/nologin\n```\n\n### 2. -n 读取下一个输入行（用下一个命令处理）\n\n有一个跳行的过程\n\n```\n$ nl passwd | sed -n '{n;p}'\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     6\tsync:x:5:0:sync:/sbin:/bin/sync\n     8\thalt:x:7:0:halt:/sbin:/sbin/halt\n```\n\n这就实现了偶数行输出。如何输出奇数行？先输入p后跳行即可。\n\n```\n$ nl passwd | sed -n '{p;n}'\n     1\troot:x:0:0:root:/root:/bin/bash\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n     7\tshutdown:x:6:0:shutdown:/sbin:/sbin/shutdown\n```\n\n之前的等效做法\n\n```\n$ nl passwd | sed -n '1~2p'\n$ nl passwd | sed -n '2~2p'\n```\n\n2,5,8... 这样输出呢？\n\n```\n// 两种方法等效，推荐使用前者\n$ nl passwd | sed -n '2~3p'\n$ nl passwd | sed -n '{n;p;n}'\n```\n\n### 3. & 符号使用\n\n-&: 替换固定字符串\n优化替换操作。\n\n案例： passwd 文件中的用户名后面添加空格，便于阅读。\n\n分析：\n- 用户名都是在行首，可以包含字母，中划线和下划线。\n\n使用 &，就没有必要在替换后的字符串中将替换前的正则重新再写一遍。\n\n```\n$ sed 's/^[a-z_-]\\+/&   /' passwd\nroot   :x:0:0:root:/root:/bin/bash\nbin   :x:1:1:bin:/bin:/sbin/nologin\ndaemon   :x:2:2:daemon:/sbin:/sbin/nologin\n```\n\n原来的写法可能是这样的，还不一定能实现。\n\n```\n$ sed 's/^[a-z_-]\\+/^[a-z_-]\\+  /' passwd\n```\n\n#### 案例： 大小写转换\n\n将用户名的首字母转化为大写/小写\n\n元字符 \n- \\u \\l (首字母转换) \n- \\U \\L (字符串转换) \n- uppercase, lowercase\n\n```\n$ sed 's/^[a-z_-]\\+/\\u&/' passwd\nRoot:x:0:0:root:/root:/bin/bash\nBin:x:1:1:bin:/bin:/sbin/nologin\nDaemon:x:2:2:daemon:/sbin:/sbin/nologin\nAdm:x:3:4:adm:/var/adm:/sbin/nologin\n```\n\n```\n$ sed 's/^[a-z_-]\\+/\\U&/' passwd\nROOT:x:0:0:root:/root:/bin/bash\nBIN:x:1:1:bin:/bin:/sbin/nologin\nDAEMON:x:2:2:daemon:/sbin:/sbin/nologin\n```\n\n文件名转大写\n\n```\n$ ls *.txt | sed 's/^\\w\\+/\\U&/'\n```\n\n\n### 4. （）符号\n\n一个括号代表一个要被替换的部分。注意转义括号。\n\n示例：数据筛选，获取passwd中 USER, UID  和 GID\n\n一个一个获取\n\n```\n$ sed 's/\\(^[a-z_-]\\+\\):.*$/\\1/' passwd\nroot\nbin\ndaemon\nadm\n```\n\n```\n$ sed 's/\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\).*$/\\1 \\2/' passwd\nroot 0\nbin 1\ndaemon 2\nadm 3\nlp 4\nsync 5\nshutdown 6\nhalt 7\nmail 8\noperator 11\ngames 12\nftp 14\nnobody 99\n```\n\n```\n$ $ sed 's/\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\):\\([0-9]\\+\\).*$/USER:\\1 UID:\\2 GID:\\3/' passwd\nUSER:root UID:0 GID:0\nUSER:bin UID:1 GID:1\nUSER:daemon UID:2 GID:2\nUSER:adm UID:3 GID:4\nUSER:lp UID:4 GID:7\nUSER:sync UID:5 GID:0\nUSER:shutdown UID:6 GID:0\nUSER:halt UID:7 GID:0\nUSER:mail UID:8 GID:12\nUSER:operator UID:11 GID:0\nUSER:games UID:12 GID:100\nUSER:ftp UID:14 GID:50\nUSER:nobody UID:99 GID:99\n```\n\n示例： 获取网卡IP\n\n分析：之前我们是将IP行分为三段，分别将前后两段无用的信息替换为空。现在我们还是将该行分为三段，但是只要获取第二段即可。\n\n先找到IP所在的行，匹配第一部分，注意别漏了空格。第二部分用括号括起来，用于输出，第三部分不用管。最后将第二部分打印输出即可。\n\n```\n$ ifconfig | sed -n '/inet /p' | sed -n '1p' | sed 's/[a-z ]\\+\\([0-9.]\\+\\) .*$/\\1/'\n172.17.147.89\n```\n\n### 5. rw 命令\n\n读和写命令，文件互操作\n\nr: 复制指定文件插入到匹配行\n\nw: 复制匹配行拷贝至指定文件\n\n```\n$ echo -e '11111\\n22222\\n33333' > 123.txt\n$ echo -e 'aaaa\\nbbbbb\\ncccc' > abc.txt\n```\n\n```\n// 读取文件123.txt，将结果放入到abc.txt 中，放置位置为第一行后。\n$ sed '1r 123.txt' abc.txt\naaaa\n11111\n22222\n33333\nbbbbb\ncccc\n```\n\n如果不指定行号，将会在目录文件的每一行后面插入读取到的文件内容。\n\n读文件后，两个文件的内容都没有发生改变。\n\n```\n// 将123.txt文件的第一行写入abc.txt\n$ sed '1w abc.txt' 123.txt\n```\n\n写操作后，abc.txt内容受影响，原内容消失，只剩下本次操作写入的内容。不指定行号就相当于文件内容拷贝。\n\n引号中是rw直接操作的文件。使用w的时候要格外小心。\n\n### 6. q 命令\n\n退出 sed\n\n在执行中间提前退出sed，没必要每次都执行到最后一行。\n\n```\n// 执行到第5行退出sed\n$ nl passwd | sed '5q'\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n     3\tdaemon:x:2:2:daemon:/sbin:/sbin/nologin\n     4\tadm:x:3:4:adm:/var/adm:/sbin/nologin\n     5\tlp:x:4:7:lp:/var/spool/lpd:/sbin/nologin\n// 找到第一个 nologin 就退出 sed\n$ nl passwd | sed '/nologin/q'\n     1\troot:x:0:0:root:/root:/bin/bash\n     2\tbin:x:1:1:bin:/bin:/sbin/nologin\n```\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-25/45710249.jpg)\n\n\n","slug":"【记录】sed 学习","published":1,"updated":"2020-09-11T01:04:35.046Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9l00306wo1aqo3aac7","content":"<p>本文是慕课网 <a href=\"http://www.imooc.com/learn/819\">《实例妙解sed 和 awk 的秘密》》</a> 的学习记录的第二部分：sed。</p>\n<p>Linux 三大利器： grep, sed, awk.</p>\n<a id=\"more\"></a>\n\n<h2 id=\"1-sed-工作原理\"><a href=\"#1-sed-工作原理\" class=\"headerlink\" title=\"1. sed 工作原理\"></a>1. sed 工作原理</h2><p>sed 是一种流处理编辑器</p>\n<ol>\n<li>文本或管道输入（正则选定文本）</li>\n<li>读入一行到模式空间（临时缓冲区）</li>\n<li>sed命令处理</li>\n<li>结果输出到屏幕</li>\n<li>重复第2步操作</li>\n</ol>\n<p>sed 一次处理一行内容</p>\n<p>sed 不改变文件内容 （除非重定向）</p>\n<h3 id=\"2-使用-sed-格式\"><a href=\"#2-使用-sed-格式\" class=\"headerlink\" title=\"2. 使用 sed 格式\"></a>2. 使用 sed 格式</h3><ul>\n<li>命令行格式</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed [options] &#39;command&#39; file(s)</span><br></pre></td></tr></table></figure>\n\n<p>options: -e, -n</p>\n<p>command: 行定位（正则） + sed命令 （操作）</p>\n<ul>\n<li>脚本格式</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -f scriptfile file(s)</span><br></pre></td></tr></table></figure>\n\n<p>举个栗子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; p 即 print，打印命令</span><br><span class=\"line\">$ sed -n &#39;root&#x2F;p&#39;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-sed-基本操作命令\"><a href=\"#2-sed-基本操作命令\" class=\"headerlink\" title=\"2. sed 基本操作命令\"></a>2. sed 基本操作命令</h2><h3 id=\"1-p-打印相关命令\"><a href=\"#1-p-打印相关命令\" class=\"headerlink\" title=\"1. -p 打印相关命令\"></a>1. -p 打印相关命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;p&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>结果每一行都被输出了两次，为什么？</p>\n<p>sed 原理为读入一行，输出一行到屏幕，现在中间又加入一个打印的步骤，所以就出现了重复。</p>\n<p>如何规避？</p>\n<p>再添加一个 -n 参数即可。该参数一般与 p 参数一起使用，表示只打印出相关的行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -n &#39;p&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-行定位\"><a href=\"#2-行定位\" class=\"headerlink\" title=\"2. 行定位\"></a>2. 行定位</h3><ul>\n<li>定位一行： x; /pattern/;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印第33行</span><br><span class=\"line\">$ sed -n &#39;33p&#39; passwd</span><br><span class=\"line\">_svn:*:73:73:SVN Server:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<p>通过 nl 命令查看行号</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印第33行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;33p&#39;</span><br><span class=\"line\">    33\t_svn:*:73:73:SVN Server:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印包含root的行</span><br><span class=\"line\">$ sed -n &#39;&#x2F;root&#x2F;p&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_cvmsroot:*:212:212:CVMS Root:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>定位多行（范围）： x,y; /pattery/,x;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印10到20行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;10,20p&#39;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印第一个包含root的行到第一个包含www的行之间所有的行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;&#x2F;root&#x2F;,&#x2F;www&#x2F;p</span><br></pre></td></tr></table></figure>\n\n<p>都是匹配第一个</p>\n<ul>\n<li>取反操作 !</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 不打印第20行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;20!p&#39;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 不打印10到20行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;10,20!p&#39;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>定位间隔几行 first~step</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 输出奇数行，Mac亲测无效，CentOS 有效</span><br><span class=\"line\">$ nl passwd | sed -n &#39;1~2p&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     ...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-sed-行处理命令\"><a href=\"#3-sed-行处理命令\" class=\"headerlink\" title=\"3. sed 行处理命令\"></a>3. sed 行处理命令</h3><h4 id=\"1-基本操作命令（Mac下失效）\"><a href=\"#1-基本操作命令（Mac下失效）\" class=\"headerlink\" title=\"1. 基本操作命令（Mac下失效）\"></a>1. 基本操作命令（Mac下失效）</h4><p>a：新增行</p>\n<p>i：插入行</p>\n<p>c：替代行</p>\n<p>d：删除行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在第5行后面添加分隔线</span><br><span class=\"line\">$ nl passwd | sed &#39;5a &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     ...</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在第1-5行后面添加分隔线</span><br><span class=\"line\">$ nl passwd | sed &#39;1,5a &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     ...</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在第1-5行之前添加分隔线</span><br><span class=\"line\">$ nl passwd | sed &#39;5i &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 第5行替换为其他内容</span><br><span class=\"line\">$ nl passwd | sed &#39;5c &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed &#39;1,5c &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     7\tshutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意替换规则与插入规则的区别，连续行的替换是整体替换，而不是一行一行。</p>\n</blockquote>\n<p>随意感受一下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed &#39;&#x2F;nologin&#x2F;c &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     7\tshutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br><span class=\"line\">     8\thalt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">    25\tzzp:x:1000:1000::&#x2F;home&#x2F;zzp:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 删除行，不会影响源文件</span><br><span class=\"line\">$ nl passwd | sed &#39;&#x2F;root&#x2F;d&#39;</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"2-案例1-修改配置文件\"><a href=\"#2-案例1-修改配置文件\" class=\"headerlink\" title=\"2. 案例1 修改配置文件\"></a>2. 案例1 修改配置文件</h4><p>简单的操作就可以替代 vim 了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在文档末尾增加一些内容</span><br><span class=\"line\">$ sed &#39;$a new line \\nnew line&#39;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-案例2-删除文本中的空行\"><a href=\"#3-案例2-删除文本中的空行\" class=\"headerlink\" title=\"3. 案例2 删除文本中的空行\"></a>3. 案例2 删除文本中的空行</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;&#x2F;^$&#x2F;d&#39; file</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-案例3-log-中提取-error\"><a href=\"#4-案例3-log-中提取-error\" class=\"headerlink\" title=\"4. 案例3 log 中提取 error\"></a>4. 案例3 log 中提取 error</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -n &#39;&#x2F;Error&#x2F;p&#39; file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-sed-替换命令-s-（核心，重点）\"><a href=\"#4-sed-替换命令-s-（核心，重点）\" class=\"headerlink\" title=\"4. sed 替换命令 s （核心，重点）\"></a>4. sed 替换命令 s （核心，重点）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;nologin&#x2F;login&#x2F;&#39; passwd</span><br><span class=\"line\">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;login</span><br><span class=\"line\">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;login</span><br><span class=\"line\">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;login</span><br><span class=\"line\">lp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;login</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;:&#x2F;%&#x2F;&#39; passwd</span><br><span class=\"line\">root%x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin%x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">daemon%x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">adm%x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">lp%x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p>这里出现了一个问题，每一行只替换了第一个匹配。</p>\n<p>添加全局标记 g 即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;:&#x2F;%&#x2F;g&#39; passwd</span><br><span class=\"line\">root%x%0%0%root%&#x2F;root%&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin%x%1%1%bin%&#x2F;bin%&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">daemon%x%2%2%daemon%&#x2F;sbin%&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">adm%x%3%4%adm%&#x2F;var&#x2F;adm%&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">lp%x%4%7%lp%&#x2F;var&#x2F;spool&#x2F;lpd%&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-案例：获取网卡中的ip\"><a href=\"#1-案例：获取网卡中的ip\" class=\"headerlink\" title=\"1. 案例：获取网卡中的ip\"></a>1. 案例：获取网卡中的ip</h4><p>思路：首先取出 ifconfig 命令输出的第二行，然后将 ip 前后两部分无用的信息分别替换为空即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 取出所需行</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39;</span><br><span class=\"line\">        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 替换ip前的字符为空</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39; | sed &#39;s&#x2F;inet &#x2F;&#x2F;&#39;</span><br><span class=\"line\">        172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 替换ip后的字符为空</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39; | sed &#39;s&#x2F;inet &#x2F;&#x2F;&#39; | sed &#39;s&#x2F;netmask.*&#x2F;&#x2F;&#39;</span><br><span class=\"line\">        172.17.147.89</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 替换可能漏掉的空格</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39; | sed &#39;s&#x2F;inet &#x2F;&#x2F;&#39; | sed &#39;s&#x2F;netmask.*&#x2F;&#x2F;&#39; | sed &#39;s&#x2F;\\ &#x2F;&#x2F;&#39;</span><br><span class=\"line\">       172.17.147.89</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-sed-高级操作命令\"><a href=\"#3-sed-高级操作命令\" class=\"headerlink\" title=\"3. sed 高级操作命令\"></a>3. sed 高级操作命令</h2><h3 id=\"1-：-多个sed命令，用；分开\"><a href=\"#1-：-多个sed命令，用；分开\" class=\"headerlink\" title=\"1. -{ }： 多个sed命令，用；分开\"></a>1. -{ }： 多个sed命令，用；分开</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 先将2-10行删除，然后将false替换为true，两个命令写到一起，这里&#123;&#125;不用转义</span><br><span class=\"line\">$ nl passwd | sed &#39;&#123;2,10d;s&#x2F;false&#x2F;true&#x2F;&#125;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">    11\tgames:x:12:100:games:&#x2F;usr&#x2F;games:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">    12\tftp:x:14:50:FTP User:&#x2F;var&#x2F;ftp:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">    13\tnobody:x:99:99:Nobody:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-n-读取下一个输入行（用下一个命令处理）\"><a href=\"#2-n-读取下一个输入行（用下一个命令处理）\" class=\"headerlink\" title=\"2. -n 读取下一个输入行（用下一个命令处理）\"></a>2. -n 读取下一个输入行（用下一个命令处理）</h3><p>有一个跳行的过程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed -n &#39;&#123;n;p&#125;&#39;</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     8\thalt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br></pre></td></tr></table></figure>\n\n<p>这就实现了偶数行输出。如何输出奇数行？先输入p后跳行即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed -n &#39;&#123;p;n&#125;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     7\tshutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br></pre></td></tr></table></figure>\n\n<p>之前的等效做法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed -n &#39;1~2p&#39;</span><br><span class=\"line\">$ nl passwd | sed -n &#39;2~2p&#39;</span><br></pre></td></tr></table></figure>\n\n<p>2,5,8… 这样输出呢？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 两种方法等效，推荐使用前者</span><br><span class=\"line\">$ nl passwd | sed -n &#39;2~3p&#39;</span><br><span class=\"line\">$ nl passwd | sed -n &#39;&#123;n;p;n&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-amp-符号使用\"><a href=\"#3-amp-符号使用\" class=\"headerlink\" title=\"3. &amp; 符号使用\"></a>3. &amp; 符号使用</h3><p>-&amp;: 替换固定字符串<br>优化替换操作。</p>\n<p>案例： passwd 文件中的用户名后面添加空格，便于阅读。</p>\n<p>分析：</p>\n<ul>\n<li>用户名都是在行首，可以包含字母，中划线和下划线。</li>\n</ul>\n<p>使用 &amp;，就没有必要在替换后的字符串中将替换前的正则重新再写一遍。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;&amp;   &#x2F;&#39; passwd</span><br><span class=\"line\">root   :x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin   :x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">daemon   :x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p>原来的写法可能是这样的，还不一定能实现。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;^[a-z_-]\\+  &#x2F;&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"案例：-大小写转换\"><a href=\"#案例：-大小写转换\" class=\"headerlink\" title=\"案例： 大小写转换\"></a>案例： 大小写转换</h4><p>将用户名的首字母转化为大写/小写</p>\n<p>元字符 </p>\n<ul>\n<li>\\u \\l (首字母转换) </li>\n<li>\\U \\L (字符串转换) </li>\n<li>uppercase, lowercase</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;\\u&amp;&#x2F;&#39; passwd</span><br><span class=\"line\">Root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">Bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">Daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">Adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;\\U&amp;&#x2F;&#39; passwd</span><br><span class=\"line\">ROOT:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">BIN:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">DAEMON:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p>文件名转大写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ls *.txt | sed &#39;s&#x2F;^\\w\\+&#x2F;\\U&amp;&#x2F;&#39;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"4-（）符号\"><a href=\"#4-（）符号\" class=\"headerlink\" title=\"4. （）符号\"></a>4. （）符号</h3><p>一个括号代表一个要被替换的部分。注意转义括号。</p>\n<p>示例：数据筛选，获取passwd中 USER, UID  和 GID</p>\n<p>一个一个获取</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;\\(^[a-z_-]\\+\\):.*$&#x2F;\\1&#x2F;&#39; passwd</span><br><span class=\"line\">root</span><br><span class=\"line\">bin</span><br><span class=\"line\">daemon</span><br><span class=\"line\">adm</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\).*$&#x2F;\\1 \\2&#x2F;&#39; passwd</span><br><span class=\"line\">root 0</span><br><span class=\"line\">bin 1</span><br><span class=\"line\">daemon 2</span><br><span class=\"line\">adm 3</span><br><span class=\"line\">lp 4</span><br><span class=\"line\">sync 5</span><br><span class=\"line\">shutdown 6</span><br><span class=\"line\">halt 7</span><br><span class=\"line\">mail 8</span><br><span class=\"line\">operator 11</span><br><span class=\"line\">games 12</span><br><span class=\"line\">ftp 14</span><br><span class=\"line\">nobody 99</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ $ sed &#39;s&#x2F;\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\):\\([0-9]\\+\\).*$&#x2F;USER:\\1 UID:\\2 GID:\\3&#x2F;&#39; passwd</span><br><span class=\"line\">USER:root UID:0 GID:0</span><br><span class=\"line\">USER:bin UID:1 GID:1</span><br><span class=\"line\">USER:daemon UID:2 GID:2</span><br><span class=\"line\">USER:adm UID:3 GID:4</span><br><span class=\"line\">USER:lp UID:4 GID:7</span><br><span class=\"line\">USER:sync UID:5 GID:0</span><br><span class=\"line\">USER:shutdown UID:6 GID:0</span><br><span class=\"line\">USER:halt UID:7 GID:0</span><br><span class=\"line\">USER:mail UID:8 GID:12</span><br><span class=\"line\">USER:operator UID:11 GID:0</span><br><span class=\"line\">USER:games UID:12 GID:100</span><br><span class=\"line\">USER:ftp UID:14 GID:50</span><br><span class=\"line\">USER:nobody UID:99 GID:99</span><br></pre></td></tr></table></figure>\n\n<p>示例： 获取网卡IP</p>\n<p>分析：之前我们是将IP行分为三段，分别将前后两段无用的信息替换为空。现在我们还是将该行分为三段，但是只要获取第二段即可。</p>\n<p>先找到IP所在的行，匹配第一部分，注意别漏了空格。第二部分用括号括起来，用于输出，第三部分不用管。最后将第二部分打印输出即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet &#x2F;p&#39; | sed -n &#39;1p&#39; | sed &#39;s&#x2F;[a-z ]\\+\\([0-9.]\\+\\) .*$&#x2F;\\1&#x2F;&#39;</span><br><span class=\"line\">172.17.147.89</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-rw-命令\"><a href=\"#5-rw-命令\" class=\"headerlink\" title=\"5. rw 命令\"></a>5. rw 命令</h3><p>读和写命令，文件互操作</p>\n<p>r: 复制指定文件插入到匹配行</p>\n<p>w: 复制匹配行拷贝至指定文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ echo -e &#39;11111\\n22222\\n33333&#39; &gt; 123.txt</span><br><span class=\"line\">$ echo -e &#39;aaaa\\nbbbbb\\ncccc&#39; &gt; abc.txt</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 读取文件123.txt，将结果放入到abc.txt 中，放置位置为第一行后。</span><br><span class=\"line\">$ sed &#39;1r 123.txt&#39; abc.txt</span><br><span class=\"line\">aaaa</span><br><span class=\"line\">11111</span><br><span class=\"line\">22222</span><br><span class=\"line\">33333</span><br><span class=\"line\">bbbbb</span><br><span class=\"line\">cccc</span><br></pre></td></tr></table></figure>\n\n<p>如果不指定行号，将会在目录文件的每一行后面插入读取到的文件内容。</p>\n<p>读文件后，两个文件的内容都没有发生改变。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 将123.txt文件的第一行写入abc.txt</span><br><span class=\"line\">$ sed &#39;1w abc.txt&#39; 123.txt</span><br></pre></td></tr></table></figure>\n\n<p>写操作后，abc.txt内容受影响，原内容消失，只剩下本次操作写入的内容。不指定行号就相当于文件内容拷贝。</p>\n<p>引号中是rw直接操作的文件。使用w的时候要格外小心。</p>\n<h3 id=\"6-q-命令\"><a href=\"#6-q-命令\" class=\"headerlink\" title=\"6. q 命令\"></a>6. q 命令</h3><p>退出 sed</p>\n<p>在执行中间提前退出sed，没必要每次都执行到最后一行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 执行到第5行退出sed</span><br><span class=\"line\">$ nl passwd | sed &#39;5q&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x2F;&#x2F; 找到第一个 nologin 就退出 sed</span><br><span class=\"line\">$ nl passwd | sed &#39;&#x2F;nologin&#x2F;q&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-25/45710249.jpg\"></p>\n","site":{"data":{}},"excerpt":"<p>本文是慕课网 <a href=\"http://www.imooc.com/learn/819\">《实例妙解sed 和 awk 的秘密》》</a> 的学习记录的第二部分：sed。</p>\n<p>Linux 三大利器： grep, sed, awk.</p>","more":"<h2 id=\"1-sed-工作原理\"><a href=\"#1-sed-工作原理\" class=\"headerlink\" title=\"1. sed 工作原理\"></a>1. sed 工作原理</h2><p>sed 是一种流处理编辑器</p>\n<ol>\n<li>文本或管道输入（正则选定文本）</li>\n<li>读入一行到模式空间（临时缓冲区）</li>\n<li>sed命令处理</li>\n<li>结果输出到屏幕</li>\n<li>重复第2步操作</li>\n</ol>\n<p>sed 一次处理一行内容</p>\n<p>sed 不改变文件内容 （除非重定向）</p>\n<h3 id=\"2-使用-sed-格式\"><a href=\"#2-使用-sed-格式\" class=\"headerlink\" title=\"2. 使用 sed 格式\"></a>2. 使用 sed 格式</h3><ul>\n<li>命令行格式</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed [options] &#39;command&#39; file(s)</span><br></pre></td></tr></table></figure>\n\n<p>options: -e, -n</p>\n<p>command: 行定位（正则） + sed命令 （操作）</p>\n<ul>\n<li>脚本格式</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -f scriptfile file(s)</span><br></pre></td></tr></table></figure>\n\n<p>举个栗子：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; p 即 print，打印命令</span><br><span class=\"line\">$ sed -n &#39;root&#x2F;p&#39;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-sed-基本操作命令\"><a href=\"#2-sed-基本操作命令\" class=\"headerlink\" title=\"2. sed 基本操作命令\"></a>2. sed 基本操作命令</h2><h3 id=\"1-p-打印相关命令\"><a href=\"#1-p-打印相关命令\" class=\"headerlink\" title=\"1. -p 打印相关命令\"></a>1. -p 打印相关命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;p&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>结果每一行都被输出了两次，为什么？</p>\n<p>sed 原理为读入一行，输出一行到屏幕，现在中间又加入一个打印的步骤，所以就出现了重复。</p>\n<p>如何规避？</p>\n<p>再添加一个 -n 参数即可。该参数一般与 p 参数一起使用，表示只打印出相关的行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -n &#39;p&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-行定位\"><a href=\"#2-行定位\" class=\"headerlink\" title=\"2. 行定位\"></a>2. 行定位</h3><ul>\n<li>定位一行： x; /pattern/;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印第33行</span><br><span class=\"line\">$ sed -n &#39;33p&#39; passwd</span><br><span class=\"line\">_svn:*:73:73:SVN Server:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<p>通过 nl 命令查看行号</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印第33行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;33p&#39;</span><br><span class=\"line\">    33\t_svn:*:73:73:SVN Server:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印包含root的行</span><br><span class=\"line\">$ sed -n &#39;&#x2F;root&#x2F;p&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_cvmsroot:*:212:212:CVMS Root:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>定位多行（范围）： x,y; /pattery/,x;</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印10到20行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;10,20p&#39;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 打印第一个包含root的行到第一个包含www的行之间所有的行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;&#x2F;root&#x2F;,&#x2F;www&#x2F;p</span><br></pre></td></tr></table></figure>\n\n<p>都是匹配第一个</p>\n<ul>\n<li>取反操作 !</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 不打印第20行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;20!p&#39;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 不打印10到20行</span><br><span class=\"line\">$ nl passwd | sed -n &#39;10,20!p&#39;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>定位间隔几行 first~step</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 输出奇数行，Mac亲测无效，CentOS 有效</span><br><span class=\"line\">$ nl passwd | sed -n &#39;1~2p&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     ...</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-sed-行处理命令\"><a href=\"#3-sed-行处理命令\" class=\"headerlink\" title=\"3. sed 行处理命令\"></a>3. sed 行处理命令</h3><h4 id=\"1-基本操作命令（Mac下失效）\"><a href=\"#1-基本操作命令（Mac下失效）\" class=\"headerlink\" title=\"1. 基本操作命令（Mac下失效）\"></a>1. 基本操作命令（Mac下失效）</h4><p>a：新增行</p>\n<p>i：插入行</p>\n<p>c：替代行</p>\n<p>d：删除行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在第5行后面添加分隔线</span><br><span class=\"line\">$ nl passwd | sed &#39;5a &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     ...</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在第1-5行后面添加分隔线</span><br><span class=\"line\">$ nl passwd | sed &#39;1,5a &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     ...</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在第1-5行之前添加分隔线</span><br><span class=\"line\">$ nl passwd | sed &#39;5i &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 第5行替换为其他内容</span><br><span class=\"line\">$ nl passwd | sed &#39;5c &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed &#39;1,5c &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     7\tshutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意替换规则与插入规则的区别，连续行的替换是整体替换，而不是一行一行。</p>\n</blockquote>\n<p>随意感受一下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed &#39;&#x2F;nologin&#x2F;c &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     7\tshutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br><span class=\"line\">     8\thalt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">    25\tzzp:x:1000:1000::&#x2F;home&#x2F;zzp:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 删除行，不会影响源文件</span><br><span class=\"line\">$ nl passwd | sed &#39;&#x2F;root&#x2F;d&#39;</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"2-案例1-修改配置文件\"><a href=\"#2-案例1-修改配置文件\" class=\"headerlink\" title=\"2. 案例1 修改配置文件\"></a>2. 案例1 修改配置文件</h4><p>简单的操作就可以替代 vim 了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 在文档末尾增加一些内容</span><br><span class=\"line\">$ sed &#39;$a new line \\nnew line&#39;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-案例2-删除文本中的空行\"><a href=\"#3-案例2-删除文本中的空行\" class=\"headerlink\" title=\"3. 案例2 删除文本中的空行\"></a>3. 案例2 删除文本中的空行</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;&#x2F;^$&#x2F;d&#39; file</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-案例3-log-中提取-error\"><a href=\"#4-案例3-log-中提取-error\" class=\"headerlink\" title=\"4. 案例3 log 中提取 error\"></a>4. 案例3 log 中提取 error</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed -n &#39;&#x2F;Error&#x2F;p&#39; file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-sed-替换命令-s-（核心，重点）\"><a href=\"#4-sed-替换命令-s-（核心，重点）\" class=\"headerlink\" title=\"4. sed 替换命令 s （核心，重点）\"></a>4. sed 替换命令 s （核心，重点）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;nologin&#x2F;login&#x2F;&#39; passwd</span><br><span class=\"line\">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;login</span><br><span class=\"line\">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;login</span><br><span class=\"line\">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;login</span><br><span class=\"line\">lp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;login</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;:&#x2F;%&#x2F;&#39; passwd</span><br><span class=\"line\">root%x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin%x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">daemon%x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">adm%x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">lp%x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p>这里出现了一个问题，每一行只替换了第一个匹配。</p>\n<p>添加全局标记 g 即可</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;:&#x2F;%&#x2F;g&#39; passwd</span><br><span class=\"line\">root%x%0%0%root%&#x2F;root%&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin%x%1%1%bin%&#x2F;bin%&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">daemon%x%2%2%daemon%&#x2F;sbin%&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">adm%x%3%4%adm%&#x2F;var&#x2F;adm%&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">lp%x%4%7%lp%&#x2F;var&#x2F;spool&#x2F;lpd%&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-案例：获取网卡中的ip\"><a href=\"#1-案例：获取网卡中的ip\" class=\"headerlink\" title=\"1. 案例：获取网卡中的ip\"></a>1. 案例：获取网卡中的ip</h4><p>思路：首先取出 ifconfig 命令输出的第二行，然后将 ip 前后两部分无用的信息分别替换为空即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 取出所需行</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39;</span><br><span class=\"line\">        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 替换ip前的字符为空</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39; | sed &#39;s&#x2F;inet &#x2F;&#x2F;&#39;</span><br><span class=\"line\">        172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 替换ip后的字符为空</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39; | sed &#39;s&#x2F;inet &#x2F;&#x2F;&#39; | sed &#39;s&#x2F;netmask.*&#x2F;&#x2F;&#39;</span><br><span class=\"line\">        172.17.147.89</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 替换可能漏掉的空格</span><br><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet .*broadcast.*&#x2F;p&#39; | sed &#39;s&#x2F;inet &#x2F;&#x2F;&#39; | sed &#39;s&#x2F;netmask.*&#x2F;&#x2F;&#39; | sed &#39;s&#x2F;\\ &#x2F;&#x2F;&#39;</span><br><span class=\"line\">       172.17.147.89</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-sed-高级操作命令\"><a href=\"#3-sed-高级操作命令\" class=\"headerlink\" title=\"3. sed 高级操作命令\"></a>3. sed 高级操作命令</h2><h3 id=\"1-：-多个sed命令，用；分开\"><a href=\"#1-：-多个sed命令，用；分开\" class=\"headerlink\" title=\"1. -{ }： 多个sed命令，用；分开\"></a>1. -{ }： 多个sed命令，用；分开</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 先将2-10行删除，然后将false替换为true，两个命令写到一起，这里&#123;&#125;不用转义</span><br><span class=\"line\">$ nl passwd | sed &#39;&#123;2,10d;s&#x2F;false&#x2F;true&#x2F;&#125;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">    11\tgames:x:12:100:games:&#x2F;usr&#x2F;games:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">    12\tftp:x:14:50:FTP User:&#x2F;var&#x2F;ftp:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">    13\tnobody:x:99:99:Nobody:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-n-读取下一个输入行（用下一个命令处理）\"><a href=\"#2-n-读取下一个输入行（用下一个命令处理）\" class=\"headerlink\" title=\"2. -n 读取下一个输入行（用下一个命令处理）\"></a>2. -n 读取下一个输入行（用下一个命令处理）</h3><p>有一个跳行的过程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed -n &#39;&#123;n;p&#125;&#39;</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     6\tsync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class=\"line\">     8\thalt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br></pre></td></tr></table></figure>\n\n<p>这就实现了偶数行输出。如何输出奇数行？先输入p后跳行即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed -n &#39;&#123;p;n&#125;&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     7\tshutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br></pre></td></tr></table></figure>\n\n<p>之前的等效做法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nl passwd | sed -n &#39;1~2p&#39;</span><br><span class=\"line\">$ nl passwd | sed -n &#39;2~2p&#39;</span><br></pre></td></tr></table></figure>\n\n<p>2,5,8… 这样输出呢？</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 两种方法等效，推荐使用前者</span><br><span class=\"line\">$ nl passwd | sed -n &#39;2~3p&#39;</span><br><span class=\"line\">$ nl passwd | sed -n &#39;&#123;n;p;n&#125;&#39;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-amp-符号使用\"><a href=\"#3-amp-符号使用\" class=\"headerlink\" title=\"3. &amp; 符号使用\"></a>3. &amp; 符号使用</h3><p>-&amp;: 替换固定字符串<br>优化替换操作。</p>\n<p>案例： passwd 文件中的用户名后面添加空格，便于阅读。</p>\n<p>分析：</p>\n<ul>\n<li>用户名都是在行首，可以包含字母，中划线和下划线。</li>\n</ul>\n<p>使用 &amp;，就没有必要在替换后的字符串中将替换前的正则重新再写一遍。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;&amp;   &#x2F;&#39; passwd</span><br><span class=\"line\">root   :x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">bin   :x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">daemon   :x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p>原来的写法可能是这样的，还不一定能实现。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;^[a-z_-]\\+  &#x2F;&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"案例：-大小写转换\"><a href=\"#案例：-大小写转换\" class=\"headerlink\" title=\"案例： 大小写转换\"></a>案例： 大小写转换</h4><p>将用户名的首字母转化为大写/小写</p>\n<p>元字符 </p>\n<ul>\n<li>\\u \\l (首字母转换) </li>\n<li>\\U \\L (字符串转换) </li>\n<li>uppercase, lowercase</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;\\u&amp;&#x2F;&#39; passwd</span><br><span class=\"line\">Root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">Bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">Daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">Adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;^[a-z_-]\\+&#x2F;\\U&amp;&#x2F;&#39; passwd</span><br><span class=\"line\">ROOT:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">BIN:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">DAEMON:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p>文件名转大写</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ls *.txt | sed &#39;s&#x2F;^\\w\\+&#x2F;\\U&amp;&#x2F;&#39;</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"4-（）符号\"><a href=\"#4-（）符号\" class=\"headerlink\" title=\"4. （）符号\"></a>4. （）符号</h3><p>一个括号代表一个要被替换的部分。注意转义括号。</p>\n<p>示例：数据筛选，获取passwd中 USER, UID  和 GID</p>\n<p>一个一个获取</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;\\(^[a-z_-]\\+\\):.*$&#x2F;\\1&#x2F;&#39; passwd</span><br><span class=\"line\">root</span><br><span class=\"line\">bin</span><br><span class=\"line\">daemon</span><br><span class=\"line\">adm</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sed &#39;s&#x2F;\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\).*$&#x2F;\\1 \\2&#x2F;&#39; passwd</span><br><span class=\"line\">root 0</span><br><span class=\"line\">bin 1</span><br><span class=\"line\">daemon 2</span><br><span class=\"line\">adm 3</span><br><span class=\"line\">lp 4</span><br><span class=\"line\">sync 5</span><br><span class=\"line\">shutdown 6</span><br><span class=\"line\">halt 7</span><br><span class=\"line\">mail 8</span><br><span class=\"line\">operator 11</span><br><span class=\"line\">games 12</span><br><span class=\"line\">ftp 14</span><br><span class=\"line\">nobody 99</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ $ sed &#39;s&#x2F;\\(^[a-z_-]\\+\\):x:\\([0-9]\\+\\):\\([0-9]\\+\\).*$&#x2F;USER:\\1 UID:\\2 GID:\\3&#x2F;&#39; passwd</span><br><span class=\"line\">USER:root UID:0 GID:0</span><br><span class=\"line\">USER:bin UID:1 GID:1</span><br><span class=\"line\">USER:daemon UID:2 GID:2</span><br><span class=\"line\">USER:adm UID:3 GID:4</span><br><span class=\"line\">USER:lp UID:4 GID:7</span><br><span class=\"line\">USER:sync UID:5 GID:0</span><br><span class=\"line\">USER:shutdown UID:6 GID:0</span><br><span class=\"line\">USER:halt UID:7 GID:0</span><br><span class=\"line\">USER:mail UID:8 GID:12</span><br><span class=\"line\">USER:operator UID:11 GID:0</span><br><span class=\"line\">USER:games UID:12 GID:100</span><br><span class=\"line\">USER:ftp UID:14 GID:50</span><br><span class=\"line\">USER:nobody UID:99 GID:99</span><br></pre></td></tr></table></figure>\n\n<p>示例： 获取网卡IP</p>\n<p>分析：之前我们是将IP行分为三段，分别将前后两段无用的信息替换为空。现在我们还是将该行分为三段，但是只要获取第二段即可。</p>\n<p>先找到IP所在的行，匹配第一部分，注意别漏了空格。第二部分用括号括起来，用于输出，第三部分不用管。最后将第二部分打印输出即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ifconfig | sed -n &#39;&#x2F;inet &#x2F;p&#39; | sed -n &#39;1p&#39; | sed &#39;s&#x2F;[a-z ]\\+\\([0-9.]\\+\\) .*$&#x2F;\\1&#x2F;&#39;</span><br><span class=\"line\">172.17.147.89</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-rw-命令\"><a href=\"#5-rw-命令\" class=\"headerlink\" title=\"5. rw 命令\"></a>5. rw 命令</h3><p>读和写命令，文件互操作</p>\n<p>r: 复制指定文件插入到匹配行</p>\n<p>w: 复制匹配行拷贝至指定文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ echo -e &#39;11111\\n22222\\n33333&#39; &gt; 123.txt</span><br><span class=\"line\">$ echo -e &#39;aaaa\\nbbbbb\\ncccc&#39; &gt; abc.txt</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 读取文件123.txt，将结果放入到abc.txt 中，放置位置为第一行后。</span><br><span class=\"line\">$ sed &#39;1r 123.txt&#39; abc.txt</span><br><span class=\"line\">aaaa</span><br><span class=\"line\">11111</span><br><span class=\"line\">22222</span><br><span class=\"line\">33333</span><br><span class=\"line\">bbbbb</span><br><span class=\"line\">cccc</span><br></pre></td></tr></table></figure>\n\n<p>如果不指定行号，将会在目录文件的每一行后面插入读取到的文件内容。</p>\n<p>读文件后，两个文件的内容都没有发生改变。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 将123.txt文件的第一行写入abc.txt</span><br><span class=\"line\">$ sed &#39;1w abc.txt&#39; 123.txt</span><br></pre></td></tr></table></figure>\n\n<p>写操作后，abc.txt内容受影响，原内容消失，只剩下本次操作写入的内容。不指定行号就相当于文件内容拷贝。</p>\n<p>引号中是rw直接操作的文件。使用w的时候要格外小心。</p>\n<h3 id=\"6-q-命令\"><a href=\"#6-q-命令\" class=\"headerlink\" title=\"6. q 命令\"></a>6. q 命令</h3><p>退出 sed</p>\n<p>在执行中间提前退出sed，没必要每次都执行到最后一行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 执行到第5行退出sed</span><br><span class=\"line\">$ nl passwd | sed &#39;5q&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     3\tdaemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     4\tadm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">     5\tlp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class=\"line\">&#x2F;&#x2F; 找到第一个 nologin 就退出 sed</span><br><span class=\"line\">$ nl passwd | sed &#39;&#x2F;nologin&#x2F;q&#39;</span><br><span class=\"line\">     1\troot:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class=\"line\">     2\tbin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-25/45710249.jpg\"></p>"},{"title":"【记录】最近的一些琐碎 trivia 201710","date":"2017-10-08T08:01:20.000Z","_content":"\n## 1. Docker 相关\n\n进入docker容器\n```\ndocker exec -it CONTAINER_ID/name bash\ndocker exec -it nginx bash\ndocker-compose exec nginx bash\n```\n\n<!--more-->\n\n用到的几个别名，添加到 .zshrc 或 .bashrc 等\n```\nalias ll='ls -lG'\nalias dco='docker-compose'\nalias dce='docker-compose exec'\n```\n\ndocker 启动 需先进入 laravel_docker 目录\n```\nj lar\ndco up -d mysql redis nginx\n```\n\n看队列执行情况\n```\ntail -f /var/log/supervisor/worker_message.log\ntail -f /data/www/caijing/cms/storage/logs/admai/20170809.log\ntail -f /data/www/caijing/cms/storage/logs/ad_sogou/20170809.log\n```\n\n## 2. Linux\n\n1.CPU占用最多的前10个进程：\n\n```\nps auxw|head -1;ps auxw|sort -rn -k3|head -10\n```\n\n2.内存消耗最多的前10个进程\n\n```\nps auxw|head -1;ps auxw|sort -rn -k4|head -10\n```\n\n3. Linux 搜索某个文件夹内的所有文件\n\n```\nfind ./ -name \"*\" | xargs grep \"495043143\"\n```\n\nvim 查找统计次数\n\n```\n:%s/失败/&/gn\n```\n\n## 3. 正则表达式\n\n匹配中文字符的正则表达式: `[\\u4e00-\\u9fa5]`\n匹配双字节字符(包含汉字):  `[^\\x00-\\xff]`\n匹配任何空白字符，包括空格、制表符、换页符等等:  `\\s`。\n\n## 4. nginx\n\n最简单的 nginx 配置\n\n```\nserver {\n    listen       443;\n    server_name  localhost;\n\n    ssl                  on;\n    ssl_certificate      server.crt;\n    ssl_certificate_key  server.key;\n\n    ssl_session_timeout  5m;\n\n    ssl_protocols  SSLv2 SSLv3 TLSv1;\n    ssl_ciphers  HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers   on;\n\n    location / {\n        root   html;\n        index  index.html index.htm;\n    }\n}\n```\n\n## 5. Laravel \n\n1. tinker 生成测试数据\n\n```\nphp artisan tinker\nfactory(App\\User::class, 500)->create();\n```\n\n2. 编辑完composer.json文件，执行\n\n```\ncomposer dump-autoload -o\n```\n\n\n## 6. lrzsz\n\n1. 安装\n\n```\t\n# yum install lrzsz\t\n或者 apt-get install lrzsz\n```\n\n使用SecureCRT来上传和下载文件了。\n打开SecureCRT软件 -> Options -> session options -> X/Y/Zmodem 下可以设置上传和下载的目录;\n然后在用SecureCRT登陆linux终端的时候:\n\n```\n# sz filename (发送文件到客户端,zmodem接收可以自行启动)\n# rz (从客户端上传文件到linux服务端)\n```\n\nrz命令也可以在SecureCRT中使用UI来上传。\n\n## 7. localhost与127.0.0.1的区别是什么?\n\n相信有人会说是本地ip，曾有人说，用127.0.0.1比localhost好，可以减少一次解析。\n看来这个问题还有人不清楚，其实这两者是有区别的。\nlocalhost也叫local ，正确的解释是：本地服务器\n127.0.0.1在windows等系统的正确解释是：本机地址（本机服务器）\n他们的解析通过本机的host文件，windows自动将localhost解析为127.0.0.1\n \nlocalhot（local）是不经网卡传输！这点很重要，它不受网络防火墙和网卡相关的的限制。\n127.0.0.1是通过网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制。\n一般设置程序时本地服务用localhost是最好的，localhost不会解析成ip，也不会占用网卡、网络资源。\n有时候用localhost可以，但用127.0.0.1就不可以的情况就是在于此。猜想localhost访问时，系统带的本机当前用户的权限去访问，而用ip的时候，等于本机是通过网络再去访问本机，可能涉及到网络用户的权限。\n￼\n这里一张图\n\n## 8. Mac \n\n装机\n\n```\nbrew cask install alfred\nbrew cask install the-unarchiver\nbrew cask install qq\nbrew cask install line\nbrew cask install skype\nbrew cask install thunder\nbrew cask install mplayerx\nbrew cask install evernote\nbrew cask install skitch\nbrew cask install dropbox\nbrew cask install google-chrome\nbrew cask install mou\nbrew cask install iterm2\nbrew cask install sublime-text\nbrew cask install virtualbox\n```\n\n2. mac下显示隐藏文件夹\n\n显示：\n```\ndefaults write com.apple.finder AppleShowAllFiles -bool true\n```\n隐藏：\n```\ndefaults write com.apple.finder AppleShowAllFiles -bool false\n```\n重启生效\n\n3. 瘦身 mac 的 office\n\n```\nsudo bash -c \"curl -s https://raw.githubusercontent.com/goodbest/OfficeThinner/master/OfficeThinner.sh | bash\"\n```\n\n根据要求输入密码，回车，等待处理，一般需要1分钟左右。\n\n然后检查是否瘦身成功，在应用程序里可以看到Office组件大小\n\n\n","source":"_posts/【记录】最近的一些琐碎.md","raw":"---\ntitle: 【记录】最近的一些琐碎 trivia 201710\ndate: 2017-10-08 16:01:20\ntags: trivia\ncategories: Linux\n---\n\n## 1. Docker 相关\n\n进入docker容器\n```\ndocker exec -it CONTAINER_ID/name bash\ndocker exec -it nginx bash\ndocker-compose exec nginx bash\n```\n\n<!--more-->\n\n用到的几个别名，添加到 .zshrc 或 .bashrc 等\n```\nalias ll='ls -lG'\nalias dco='docker-compose'\nalias dce='docker-compose exec'\n```\n\ndocker 启动 需先进入 laravel_docker 目录\n```\nj lar\ndco up -d mysql redis nginx\n```\n\n看队列执行情况\n```\ntail -f /var/log/supervisor/worker_message.log\ntail -f /data/www/caijing/cms/storage/logs/admai/20170809.log\ntail -f /data/www/caijing/cms/storage/logs/ad_sogou/20170809.log\n```\n\n## 2. Linux\n\n1.CPU占用最多的前10个进程：\n\n```\nps auxw|head -1;ps auxw|sort -rn -k3|head -10\n```\n\n2.内存消耗最多的前10个进程\n\n```\nps auxw|head -1;ps auxw|sort -rn -k4|head -10\n```\n\n3. Linux 搜索某个文件夹内的所有文件\n\n```\nfind ./ -name \"*\" | xargs grep \"495043143\"\n```\n\nvim 查找统计次数\n\n```\n:%s/失败/&/gn\n```\n\n## 3. 正则表达式\n\n匹配中文字符的正则表达式: `[\\u4e00-\\u9fa5]`\n匹配双字节字符(包含汉字):  `[^\\x00-\\xff]`\n匹配任何空白字符，包括空格、制表符、换页符等等:  `\\s`。\n\n## 4. nginx\n\n最简单的 nginx 配置\n\n```\nserver {\n    listen       443;\n    server_name  localhost;\n\n    ssl                  on;\n    ssl_certificate      server.crt;\n    ssl_certificate_key  server.key;\n\n    ssl_session_timeout  5m;\n\n    ssl_protocols  SSLv2 SSLv3 TLSv1;\n    ssl_ciphers  HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers   on;\n\n    location / {\n        root   html;\n        index  index.html index.htm;\n    }\n}\n```\n\n## 5. Laravel \n\n1. tinker 生成测试数据\n\n```\nphp artisan tinker\nfactory(App\\User::class, 500)->create();\n```\n\n2. 编辑完composer.json文件，执行\n\n```\ncomposer dump-autoload -o\n```\n\n\n## 6. lrzsz\n\n1. 安装\n\n```\t\n# yum install lrzsz\t\n或者 apt-get install lrzsz\n```\n\n使用SecureCRT来上传和下载文件了。\n打开SecureCRT软件 -> Options -> session options -> X/Y/Zmodem 下可以设置上传和下载的目录;\n然后在用SecureCRT登陆linux终端的时候:\n\n```\n# sz filename (发送文件到客户端,zmodem接收可以自行启动)\n# rz (从客户端上传文件到linux服务端)\n```\n\nrz命令也可以在SecureCRT中使用UI来上传。\n\n## 7. localhost与127.0.0.1的区别是什么?\n\n相信有人会说是本地ip，曾有人说，用127.0.0.1比localhost好，可以减少一次解析。\n看来这个问题还有人不清楚，其实这两者是有区别的。\nlocalhost也叫local ，正确的解释是：本地服务器\n127.0.0.1在windows等系统的正确解释是：本机地址（本机服务器）\n他们的解析通过本机的host文件，windows自动将localhost解析为127.0.0.1\n \nlocalhot（local）是不经网卡传输！这点很重要，它不受网络防火墙和网卡相关的的限制。\n127.0.0.1是通过网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制。\n一般设置程序时本地服务用localhost是最好的，localhost不会解析成ip，也不会占用网卡、网络资源。\n有时候用localhost可以，但用127.0.0.1就不可以的情况就是在于此。猜想localhost访问时，系统带的本机当前用户的权限去访问，而用ip的时候，等于本机是通过网络再去访问本机，可能涉及到网络用户的权限。\n￼\n这里一张图\n\n## 8. Mac \n\n装机\n\n```\nbrew cask install alfred\nbrew cask install the-unarchiver\nbrew cask install qq\nbrew cask install line\nbrew cask install skype\nbrew cask install thunder\nbrew cask install mplayerx\nbrew cask install evernote\nbrew cask install skitch\nbrew cask install dropbox\nbrew cask install google-chrome\nbrew cask install mou\nbrew cask install iterm2\nbrew cask install sublime-text\nbrew cask install virtualbox\n```\n\n2. mac下显示隐藏文件夹\n\n显示：\n```\ndefaults write com.apple.finder AppleShowAllFiles -bool true\n```\n隐藏：\n```\ndefaults write com.apple.finder AppleShowAllFiles -bool false\n```\n重启生效\n\n3. 瘦身 mac 的 office\n\n```\nsudo bash -c \"curl -s https://raw.githubusercontent.com/goodbest/OfficeThinner/master/OfficeThinner.sh | bash\"\n```\n\n根据要求输入密码，回车，等待处理，一般需要1分钟左右。\n\n然后检查是否瘦身成功，在应用程序里可以看到Office组件大小\n\n\n","slug":"【记录】最近的一些琐碎","published":1,"updated":"2020-09-11T01:04:35.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9m00326wo11vi01p67","content":"<h2 id=\"1-Docker-相关\"><a href=\"#1-Docker-相关\" class=\"headerlink\" title=\"1. Docker 相关\"></a>1. Docker 相关</h2><p>进入docker容器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it CONTAINER_ID&#x2F;name bash</span><br><span class=\"line\">docker exec -it nginx bash</span><br><span class=\"line\">docker-compose exec nginx bash</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<p>用到的几个别名，添加到 .zshrc 或 .bashrc 等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alias ll&#x3D;&#39;ls -lG&#39;</span><br><span class=\"line\">alias dco&#x3D;&#39;docker-compose&#39;</span><br><span class=\"line\">alias dce&#x3D;&#39;docker-compose exec&#39;</span><br></pre></td></tr></table></figure>\n\n<p>docker 启动 需先进入 laravel_docker 目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">j lar</span><br><span class=\"line\">dco up -d mysql redis nginx</span><br></pre></td></tr></table></figure>\n\n<p>看队列执行情况</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;supervisor&#x2F;worker_message.log</span><br><span class=\"line\">tail -f &#x2F;data&#x2F;www&#x2F;caijing&#x2F;cms&#x2F;storage&#x2F;logs&#x2F;admai&#x2F;20170809.log</span><br><span class=\"line\">tail -f &#x2F;data&#x2F;www&#x2F;caijing&#x2F;cms&#x2F;storage&#x2F;logs&#x2F;ad_sogou&#x2F;20170809.log</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Linux\"><a href=\"#2-Linux\" class=\"headerlink\" title=\"2. Linux\"></a>2. Linux</h2><p>1.CPU占用最多的前10个进程：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps auxw|head -1;ps auxw|sort -rn -k3|head -10</span><br></pre></td></tr></table></figure>\n\n<p>2.内存消耗最多的前10个进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps auxw|head -1;ps auxw|sort -rn -k4|head -10</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Linux 搜索某个文件夹内的所有文件</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find .&#x2F; -name &quot;*&quot; | xargs grep &quot;495043143&quot;</span><br></pre></td></tr></table></figure>\n\n<p>vim 查找统计次数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:%s&#x2F;失败&#x2F;&amp;&#x2F;gn</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-正则表达式\"><a href=\"#3-正则表达式\" class=\"headerlink\" title=\"3. 正则表达式\"></a>3. 正则表达式</h2><p>匹配中文字符的正则表达式: <code>[\\u4e00-\\u9fa5]</code><br>匹配双字节字符(包含汉字):  <code>[^\\x00-\\xff]</code><br>匹配任何空白字符，包括空格、制表符、换页符等等:  <code>\\s</code>。</p>\n<h2 id=\"4-nginx\"><a href=\"#4-nginx\" class=\"headerlink\" title=\"4. nginx\"></a>4. nginx</h2><p>最简单的 nginx 配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       443;</span><br><span class=\"line\">    server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl                  on;</span><br><span class=\"line\">    ssl_certificate      server.crt;</span><br><span class=\"line\">    ssl_certificate_key  server.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_protocols  SSLv2 SSLv3 TLSv1;</span><br><span class=\"line\">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    ssl_prefer_server_ciphers   on;</span><br><span class=\"line\"></span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        root   html;</span><br><span class=\"line\">        index  index.html index.htm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-Laravel\"><a href=\"#5-Laravel\" class=\"headerlink\" title=\"5. Laravel\"></a>5. Laravel</h2><ol>\n<li>tinker 生成测试数据</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan tinker</span><br><span class=\"line\">factory(App\\User::class, 500)-&gt;create();</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>编辑完composer.json文件，执行</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">composer dump-autoload -o</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-lrzsz\"><a href=\"#6-lrzsz\" class=\"headerlink\" title=\"6. lrzsz\"></a>6. lrzsz</h2><ol>\n<li>安装</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install lrzsz\t</span><br><span class=\"line\">或者 apt-get install lrzsz</span><br></pre></td></tr></table></figure>\n\n<p>使用SecureCRT来上传和下载文件了。<br>打开SecureCRT软件 -&gt; Options -&gt; session options -&gt; X/Y/Zmodem 下可以设置上传和下载的目录;<br>然后在用SecureCRT登陆linux终端的时候:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sz filename (发送文件到客户端,zmodem接收可以自行启动)</span><br><span class=\"line\"># rz (从客户端上传文件到linux服务端)</span><br></pre></td></tr></table></figure>\n\n<p>rz命令也可以在SecureCRT中使用UI来上传。</p>\n<h2 id=\"7-localhost与127-0-0-1的区别是什么\"><a href=\"#7-localhost与127-0-0-1的区别是什么\" class=\"headerlink\" title=\"7. localhost与127.0.0.1的区别是什么?\"></a>7. localhost与127.0.0.1的区别是什么?</h2><p>相信有人会说是本地ip，曾有人说，用127.0.0.1比localhost好，可以减少一次解析。<br>看来这个问题还有人不清楚，其实这两者是有区别的。<br>localhost也叫local ，正确的解释是：本地服务器<br>127.0.0.1在windows等系统的正确解释是：本机地址（本机服务器）<br>他们的解析通过本机的host文件，windows自动将localhost解析为127.0.0.1<br> <br>localhot（local）是不经网卡传输！这点很重要，它不受网络防火墙和网卡相关的的限制。<br>127.0.0.1是通过网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制。<br>一般设置程序时本地服务用localhost是最好的，localhost不会解析成ip，也不会占用网卡、网络资源。<br>有时候用localhost可以，但用127.0.0.1就不可以的情况就是在于此。猜想localhost访问时，系统带的本机当前用户的权限去访问，而用ip的时候，等于本机是通过网络再去访问本机，可能涉及到网络用户的权限。<br>￼<br>这里一张图</p>\n<h2 id=\"8-Mac\"><a href=\"#8-Mac\" class=\"headerlink\" title=\"8. Mac\"></a>8. Mac</h2><p>装机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew cask install alfred</span><br><span class=\"line\">brew cask install the-unarchiver</span><br><span class=\"line\">brew cask install qq</span><br><span class=\"line\">brew cask install line</span><br><span class=\"line\">brew cask install skype</span><br><span class=\"line\">brew cask install thunder</span><br><span class=\"line\">brew cask install mplayerx</span><br><span class=\"line\">brew cask install evernote</span><br><span class=\"line\">brew cask install skitch</span><br><span class=\"line\">brew cask install dropbox</span><br><span class=\"line\">brew cask install google-chrome</span><br><span class=\"line\">brew cask install mou</span><br><span class=\"line\">brew cask install iterm2</span><br><span class=\"line\">brew cask install sublime-text</span><br><span class=\"line\">brew cask install virtualbox</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>mac下显示隐藏文件夹</li>\n</ol>\n<p>显示：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -bool true</span><br></pre></td></tr></table></figure>\n<p>隐藏：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -bool false</span><br></pre></td></tr></table></figure>\n<p>重启生效</p>\n<ol start=\"3\">\n<li>瘦身 mac 的 office</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bash -c &quot;curl -s https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;goodbest&#x2F;OfficeThinner&#x2F;master&#x2F;OfficeThinner.sh | bash&quot;</span><br></pre></td></tr></table></figure>\n\n<p>根据要求输入密码，回车，等待处理，一般需要1分钟左右。</p>\n<p>然后检查是否瘦身成功，在应用程序里可以看到Office组件大小</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-Docker-相关\"><a href=\"#1-Docker-相关\" class=\"headerlink\" title=\"1. Docker 相关\"></a>1. Docker 相关</h2><p>进入docker容器</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it CONTAINER_ID&#x2F;name bash</span><br><span class=\"line\">docker exec -it nginx bash</span><br><span class=\"line\">docker-compose exec nginx bash</span><br></pre></td></tr></table></figure>","more":"<p>用到的几个别名，添加到 .zshrc 或 .bashrc 等</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alias ll&#x3D;&#39;ls -lG&#39;</span><br><span class=\"line\">alias dco&#x3D;&#39;docker-compose&#39;</span><br><span class=\"line\">alias dce&#x3D;&#39;docker-compose exec&#39;</span><br></pre></td></tr></table></figure>\n\n<p>docker 启动 需先进入 laravel_docker 目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">j lar</span><br><span class=\"line\">dco up -d mysql redis nginx</span><br></pre></td></tr></table></figure>\n\n<p>看队列执行情况</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;supervisor&#x2F;worker_message.log</span><br><span class=\"line\">tail -f &#x2F;data&#x2F;www&#x2F;caijing&#x2F;cms&#x2F;storage&#x2F;logs&#x2F;admai&#x2F;20170809.log</span><br><span class=\"line\">tail -f &#x2F;data&#x2F;www&#x2F;caijing&#x2F;cms&#x2F;storage&#x2F;logs&#x2F;ad_sogou&#x2F;20170809.log</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Linux\"><a href=\"#2-Linux\" class=\"headerlink\" title=\"2. Linux\"></a>2. Linux</h2><p>1.CPU占用最多的前10个进程：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps auxw|head -1;ps auxw|sort -rn -k3|head -10</span><br></pre></td></tr></table></figure>\n\n<p>2.内存消耗最多的前10个进程</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps auxw|head -1;ps auxw|sort -rn -k4|head -10</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Linux 搜索某个文件夹内的所有文件</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find .&#x2F; -name &quot;*&quot; | xargs grep &quot;495043143&quot;</span><br></pre></td></tr></table></figure>\n\n<p>vim 查找统计次数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:%s&#x2F;失败&#x2F;&amp;&#x2F;gn</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-正则表达式\"><a href=\"#3-正则表达式\" class=\"headerlink\" title=\"3. 正则表达式\"></a>3. 正则表达式</h2><p>匹配中文字符的正则表达式: <code>[\\u4e00-\\u9fa5]</code><br>匹配双字节字符(包含汉字):  <code>[^\\x00-\\xff]</code><br>匹配任何空白字符，包括空格、制表符、换页符等等:  <code>\\s</code>。</p>\n<h2 id=\"4-nginx\"><a href=\"#4-nginx\" class=\"headerlink\" title=\"4. nginx\"></a>4. nginx</h2><p>最简单的 nginx 配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       443;</span><br><span class=\"line\">    server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl                  on;</span><br><span class=\"line\">    ssl_certificate      server.crt;</span><br><span class=\"line\">    ssl_certificate_key  server.key;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_session_timeout  5m;</span><br><span class=\"line\"></span><br><span class=\"line\">    ssl_protocols  SSLv2 SSLv3 TLSv1;</span><br><span class=\"line\">    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    ssl_prefer_server_ciphers   on;</span><br><span class=\"line\"></span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        root   html;</span><br><span class=\"line\">        index  index.html index.htm;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-Laravel\"><a href=\"#5-Laravel\" class=\"headerlink\" title=\"5. Laravel\"></a>5. Laravel</h2><ol>\n<li>tinker 生成测试数据</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan tinker</span><br><span class=\"line\">factory(App\\User::class, 500)-&gt;create();</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>编辑完composer.json文件，执行</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">composer dump-autoload -o</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-lrzsz\"><a href=\"#6-lrzsz\" class=\"headerlink\" title=\"6. lrzsz\"></a>6. lrzsz</h2><ol>\n<li>安装</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install lrzsz\t</span><br><span class=\"line\">或者 apt-get install lrzsz</span><br></pre></td></tr></table></figure>\n\n<p>使用SecureCRT来上传和下载文件了。<br>打开SecureCRT软件 -&gt; Options -&gt; session options -&gt; X/Y/Zmodem 下可以设置上传和下载的目录;<br>然后在用SecureCRT登陆linux终端的时候:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># sz filename (发送文件到客户端,zmodem接收可以自行启动)</span><br><span class=\"line\"># rz (从客户端上传文件到linux服务端)</span><br></pre></td></tr></table></figure>\n\n<p>rz命令也可以在SecureCRT中使用UI来上传。</p>\n<h2 id=\"7-localhost与127-0-0-1的区别是什么\"><a href=\"#7-localhost与127-0-0-1的区别是什么\" class=\"headerlink\" title=\"7. localhost与127.0.0.1的区别是什么?\"></a>7. localhost与127.0.0.1的区别是什么?</h2><p>相信有人会说是本地ip，曾有人说，用127.0.0.1比localhost好，可以减少一次解析。<br>看来这个问题还有人不清楚，其实这两者是有区别的。<br>localhost也叫local ，正确的解释是：本地服务器<br>127.0.0.1在windows等系统的正确解释是：本机地址（本机服务器）<br>他们的解析通过本机的host文件，windows自动将localhost解析为127.0.0.1<br> <br>localhot（local）是不经网卡传输！这点很重要，它不受网络防火墙和网卡相关的的限制。<br>127.0.0.1是通过网卡传输，依赖网卡，并受到网络防火墙和网卡相关的限制。<br>一般设置程序时本地服务用localhost是最好的，localhost不会解析成ip，也不会占用网卡、网络资源。<br>有时候用localhost可以，但用127.0.0.1就不可以的情况就是在于此。猜想localhost访问时，系统带的本机当前用户的权限去访问，而用ip的时候，等于本机是通过网络再去访问本机，可能涉及到网络用户的权限。<br>￼<br>这里一张图</p>\n<h2 id=\"8-Mac\"><a href=\"#8-Mac\" class=\"headerlink\" title=\"8. Mac\"></a>8. Mac</h2><p>装机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew cask install alfred</span><br><span class=\"line\">brew cask install the-unarchiver</span><br><span class=\"line\">brew cask install qq</span><br><span class=\"line\">brew cask install line</span><br><span class=\"line\">brew cask install skype</span><br><span class=\"line\">brew cask install thunder</span><br><span class=\"line\">brew cask install mplayerx</span><br><span class=\"line\">brew cask install evernote</span><br><span class=\"line\">brew cask install skitch</span><br><span class=\"line\">brew cask install dropbox</span><br><span class=\"line\">brew cask install google-chrome</span><br><span class=\"line\">brew cask install mou</span><br><span class=\"line\">brew cask install iterm2</span><br><span class=\"line\">brew cask install sublime-text</span><br><span class=\"line\">brew cask install virtualbox</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>mac下显示隐藏文件夹</li>\n</ol>\n<p>显示：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -bool true</span><br></pre></td></tr></table></figure>\n<p>隐藏：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">defaults write com.apple.finder AppleShowAllFiles -bool false</span><br></pre></td></tr></table></figure>\n<p>重启生效</p>\n<ol start=\"3\">\n<li>瘦身 mac 的 office</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo bash -c &quot;curl -s https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;goodbest&#x2F;OfficeThinner&#x2F;master&#x2F;OfficeThinner.sh | bash&quot;</span><br></pre></td></tr></table></figure>\n\n<p>根据要求输入密码，回车，等待处理，一般需要1分钟左右。</p>\n<p>然后检查是否瘦身成功，在应用程序里可以看到Office组件大小</p>"},{"title":"【记录】正则表达式学习","date":"2017-05-24T14:28:26.000Z","_content":"\n本文是慕课网 [《实例妙解sed 和 awk 的秘密》](http://www.imooc.com/learn/819) 的学习记录的第一部分：正则表达式。\n\nLinux 三大利器： grep, sed, awk.\n\n<!--more-->\n\n## 1. 准备工作\n正则表达式应用场景：查找、取出、匹配符合条件的字符或字符串\n\n学习方法：从小到大、组合的过程。单个字符->字符串->表达式。\n\ngrep 搜索命令匹配正则表达式例子\n\n```\n$ grep 'root' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false\n```\n\n## 2. 正则单个字符的表示方式\n\n### 1. 特定字符\n\n某个具体的字符，如 '1', 'a'\n\n使用 grep 搜索命令进行正则表达式的匹配\n\n```\n$ grep '1' passwd\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_taskgated:*:13:13:Task Gate Daemon:/var/empty:/usr/bin/false\n_scsd:*:31:31:Service Configuration Service:/var/empty:/usr/bin/false\n_eppc:*:71:71:Apple Events User:/var/empty:/usr/bin/false\n...\n```\n\n匹配结果被标红\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-24/6251408.jpg)\n\n### 2. 范围内字符\n\n- **单个**字符 []\n\n数字字符：[0-9], [278], 表示2/7/8, 注意只匹配一个字符。\n\n```\n$ grep '[0-9]' passwd\n```\n\n- 小写字符：[a-z]\n\n- 大写字符：[A-Z]\n\n- 大小写：[a-zA-Z]\n\n- 符号： [,:!%-().]\n\n- 反向字符： ^, **必须放在范围之前，[]内部**，如\n\n```\n$ grep '[^0-9]' passwd\n```\n\n### 3. 任意字符\n\n代表任何一个字符： .\n\n注意 ., \\\\.,  [.] 的区别，其中后两个的作用是一样的。\n\n### 4. 其他常用字符\n\n- 边界字符/头尾字符\n\n头字符 ^root, 表示以root开头的行，注意与取反字符 [^0-9] 的区别\n\n尾字符 false$, 表示以false结尾的行。\n\n```\n$ grep '^root' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\n\n$ grep 'false$' passwd\nnobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n...\n```\n\n空行： ^$, 头尾相接。\n\n- 元字符（代表普通字符或特殊字符）\n\n实质上起替代的作用\n\n\\w: 匹配任何字类字符，即字母数字下划线 [a-zA-Z0-9_]\n\n\\W: 匹配任何非字类字符，即 [^a-zA-Z0-9_]\n\n\\b: 代表单词的分隔\n\n```\ngrep '\\btime\\b' file\n```\n\n只匹配包含单词 time 的行，不匹配 timezone，showtime 等。\n\n\n## 3. 字符组合\n\n### 1. 字符串\n\n'root', '1000', 'r..t' (r开头，t结束，长度为4的字符串)\n\n'[A-Z][a-z]' (一个大写字母加一个小写字母)\n\n'[0-9][0-9]' (两个连续的数字，**正则为最大化匹配，所以四位数也会匹配，五位数也会匹配前四位**)\n\n### 2. 重复\n\n- \\*: 0-n 次匹配前面的字符或表达式\n\n- \\+: 1-n 次匹配\n\n- ?: 0-1 次匹配\n\n```\n// 可能的匹配结果： s, se, see, seee...\n$ grep 'se*' passwd\n// 可能的匹配结果： se, see, seee...\n$ grep 'se\\+' passwd\n// 可能的匹配结果： s, se, 只有两种\n$ grep 'se\\?' passwd\n```\n\n后两者注意要进行转义。\n\n```\n// 匹配字符串，要加括号 se, sese, sese...\n$ grep '\\(se\\)\\+' passwd\n```\n\n注意括号也要进行转义。\n\n\n- 重复特定次数 {n,m}\n\n\\*: 相当于 {0,} \n\n\\+: 相当于 {1,}\n\n?: 相当于 {0,1}\n\n```\n// 匹配两到三位数字\n$ grep '[0-9]\\{2,3\\}' passwd\n```\n\n注意大括号也要转义。\n\n- 任意字符串： .\\*\n(即任意单字符重复0-n次)\n \n\n如： ^r.\\*,  r.\\*t\n\n```\n$ grep '^r.*' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\n```\n\n**注意**：正则贪婪匹配的规则。\n\n```\n$ grep '\\bd.*e\\b' passwd\n```\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-24/65316894.jpg)\n\n多么贪婪，我只想要匹配类似 dislike 这种词。\n\n这时候就不能重复任意字符了。\n\n```\n$ grep '\\bd[a-z]*e\\b' passwd\n```\n\n这样改就好了。\n\n尽量去缩小要匹配的范围，才能避免踩这些坑。\n\n\n### 3. 逻辑\n\n- 逻辑或 \\|\n\n```\n$ grep 'bin/\\(false\\|true\\)' passwd\n```\n\n## 4. 正则案例\n\n### 1. 匹配4-10位QQ号\n\n```\n$ grep '^[0-9]\\{4,10\\}$' file\n```\n\n### 2. 匹配15或18位身份证号，包括X\n\n分析：\n\n* 第一位不能为0\n* 最后一位的范围要扩大\n* 中间为13或16位重复数字\n\n```\n// 先写逻辑，最后加头尾和转义\n$ grep '^[1-9]\\([0-9]\\{13\\}\\|[0-9]\\{16\\}\\)[0-9xX]$' file\n```\n\n### 3. 匹配密码\n\n分析：\n\n* 密码保护字母数字下划线，使用元字符 \\w\n* 可1次或多次重复 \\+\n\n```\n$ grep '^\\w\\+$' file\n```\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-24/91639479.jpg)\n\n\n\n\n","source":"_posts/【记录】正则表达式学习.md","raw":"---\ntitle: 【记录】正则表达式学习\ndate: 2017-05-24 22:28:26\ntags: 正则表达式\ncategories: Linux\n---\n\n本文是慕课网 [《实例妙解sed 和 awk 的秘密》](http://www.imooc.com/learn/819) 的学习记录的第一部分：正则表达式。\n\nLinux 三大利器： grep, sed, awk.\n\n<!--more-->\n\n## 1. 准备工作\n正则表达式应用场景：查找、取出、匹配符合条件的字符或字符串\n\n学习方法：从小到大、组合的过程。单个字符->字符串->表达式。\n\ngrep 搜索命令匹配正则表达式例子\n\n```\n$ grep 'root' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false\n```\n\n## 2. 正则单个字符的表示方式\n\n### 1. 特定字符\n\n某个具体的字符，如 '1', 'a'\n\n使用 grep 搜索命令进行正则表达式的匹配\n\n```\n$ grep '1' passwd\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n_taskgated:*:13:13:Task Gate Daemon:/var/empty:/usr/bin/false\n_scsd:*:31:31:Service Configuration Service:/var/empty:/usr/bin/false\n_eppc:*:71:71:Apple Events User:/var/empty:/usr/bin/false\n...\n```\n\n匹配结果被标红\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-24/6251408.jpg)\n\n### 2. 范围内字符\n\n- **单个**字符 []\n\n数字字符：[0-9], [278], 表示2/7/8, 注意只匹配一个字符。\n\n```\n$ grep '[0-9]' passwd\n```\n\n- 小写字符：[a-z]\n\n- 大写字符：[A-Z]\n\n- 大小写：[a-zA-Z]\n\n- 符号： [,:!%-().]\n\n- 反向字符： ^, **必须放在范围之前，[]内部**，如\n\n```\n$ grep '[^0-9]' passwd\n```\n\n### 3. 任意字符\n\n代表任何一个字符： .\n\n注意 ., \\\\.,  [.] 的区别，其中后两个的作用是一样的。\n\n### 4. 其他常用字符\n\n- 边界字符/头尾字符\n\n头字符 ^root, 表示以root开头的行，注意与取反字符 [^0-9] 的区别\n\n尾字符 false$, 表示以false结尾的行。\n\n```\n$ grep '^root' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\n\n$ grep 'false$' passwd\nnobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false\ndaemon:*:1:1:System Services:/var/root:/usr/bin/false\n...\n```\n\n空行： ^$, 头尾相接。\n\n- 元字符（代表普通字符或特殊字符）\n\n实质上起替代的作用\n\n\\w: 匹配任何字类字符，即字母数字下划线 [a-zA-Z0-9_]\n\n\\W: 匹配任何非字类字符，即 [^a-zA-Z0-9_]\n\n\\b: 代表单词的分隔\n\n```\ngrep '\\btime\\b' file\n```\n\n只匹配包含单词 time 的行，不匹配 timezone，showtime 等。\n\n\n## 3. 字符组合\n\n### 1. 字符串\n\n'root', '1000', 'r..t' (r开头，t结束，长度为4的字符串)\n\n'[A-Z][a-z]' (一个大写字母加一个小写字母)\n\n'[0-9][0-9]' (两个连续的数字，**正则为最大化匹配，所以四位数也会匹配，五位数也会匹配前四位**)\n\n### 2. 重复\n\n- \\*: 0-n 次匹配前面的字符或表达式\n\n- \\+: 1-n 次匹配\n\n- ?: 0-1 次匹配\n\n```\n// 可能的匹配结果： s, se, see, seee...\n$ grep 'se*' passwd\n// 可能的匹配结果： se, see, seee...\n$ grep 'se\\+' passwd\n// 可能的匹配结果： s, se, 只有两种\n$ grep 'se\\?' passwd\n```\n\n后两者注意要进行转义。\n\n```\n// 匹配字符串，要加括号 se, sese, sese...\n$ grep '\\(se\\)\\+' passwd\n```\n\n注意括号也要进行转义。\n\n\n- 重复特定次数 {n,m}\n\n\\*: 相当于 {0,} \n\n\\+: 相当于 {1,}\n\n?: 相当于 {0,1}\n\n```\n// 匹配两到三位数字\n$ grep '[0-9]\\{2,3\\}' passwd\n```\n\n注意大括号也要转义。\n\n- 任意字符串： .\\*\n(即任意单字符重复0-n次)\n \n\n如： ^r.\\*,  r.\\*t\n\n```\n$ grep '^r.*' passwd\nroot:*:0:0:System Administrator:/var/root:/bin/sh\n```\n\n**注意**：正则贪婪匹配的规则。\n\n```\n$ grep '\\bd.*e\\b' passwd\n```\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-24/65316894.jpg)\n\n多么贪婪，我只想要匹配类似 dislike 这种词。\n\n这时候就不能重复任意字符了。\n\n```\n$ grep '\\bd[a-z]*e\\b' passwd\n```\n\n这样改就好了。\n\n尽量去缩小要匹配的范围，才能避免踩这些坑。\n\n\n### 3. 逻辑\n\n- 逻辑或 \\|\n\n```\n$ grep 'bin/\\(false\\|true\\)' passwd\n```\n\n## 4. 正则案例\n\n### 1. 匹配4-10位QQ号\n\n```\n$ grep '^[0-9]\\{4,10\\}$' file\n```\n\n### 2. 匹配15或18位身份证号，包括X\n\n分析：\n\n* 第一位不能为0\n* 最后一位的范围要扩大\n* 中间为13或16位重复数字\n\n```\n// 先写逻辑，最后加头尾和转义\n$ grep '^[1-9]\\([0-9]\\{13\\}\\|[0-9]\\{16\\}\\)[0-9xX]$' file\n```\n\n### 3. 匹配密码\n\n分析：\n\n* 密码保护字母数字下划线，使用元字符 \\w\n* 可1次或多次重复 \\+\n\n```\n$ grep '^\\w\\+$' file\n```\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-24/91639479.jpg)\n\n\n\n\n","slug":"【记录】正则表达式学习","published":1,"updated":"2020-09-11T01:04:35.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9n00346wo1boee5bl0","content":"<p>本文是慕课网 <a href=\"http://www.imooc.com/learn/819\">《实例妙解sed 和 awk 的秘密》</a> 的学习记录的第一部分：正则表达式。</p>\n<p>Linux 三大利器： grep, sed, awk.</p>\n<a id=\"more\"></a>\n\n<h2 id=\"1-准备工作\"><a href=\"#1-准备工作\" class=\"headerlink\" title=\"1. 准备工作\"></a>1. 准备工作</h2><p>正则表达式应用场景：查找、取出、匹配符合条件的字符或字符串</p>\n<p>学习方法：从小到大、组合的过程。单个字符-&gt;字符串-&gt;表达式。</p>\n<p>grep 搜索命令匹配正则表达式例子</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;root&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_cvmsroot:*:212:212:CVMS Root:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-正则单个字符的表示方式\"><a href=\"#2-正则单个字符的表示方式\" class=\"headerlink\" title=\"2. 正则单个字符的表示方式\"></a>2. 正则单个字符的表示方式</h2><h3 id=\"1-特定字符\"><a href=\"#1-特定字符\" class=\"headerlink\" title=\"1. 特定字符\"></a>1. 特定字符</h3><p>某个具体的字符，如 ‘1’, ‘a’</p>\n<p>使用 grep 搜索命令进行正则表达式的匹配</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;1&#39; passwd</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_taskgated:*:13:13:Task Gate Daemon:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_scsd:*:31:31:Service Configuration Service:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_eppc:*:71:71:Apple Events User:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>匹配结果被标红</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-24/6251408.jpg\"></p>\n<h3 id=\"2-范围内字符\"><a href=\"#2-范围内字符\" class=\"headerlink\" title=\"2. 范围内字符\"></a>2. 范围内字符</h3><ul>\n<li><strong>单个</strong>字符 []</li>\n</ul>\n<p>数字字符：[0-9], [278], 表示2/7/8, 注意只匹配一个字符。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;[0-9]&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>小写字符：[a-z]</p>\n</li>\n<li><p>大写字符：[A-Z]</p>\n</li>\n<li><p>大小写：[a-zA-Z]</p>\n</li>\n<li><p>符号： [,:!%-().]</p>\n</li>\n<li><p>反向字符： ^, <strong>必须放在范围之前，[]内部</strong>，如</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;[^0-9]&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-任意字符\"><a href=\"#3-任意字符\" class=\"headerlink\" title=\"3. 任意字符\"></a>3. 任意字符</h3><p>代表任何一个字符： .</p>\n<p>注意 ., \\.,  [.] 的区别，其中后两个的作用是一样的。</p>\n<h3 id=\"4-其他常用字符\"><a href=\"#4-其他常用字符\" class=\"headerlink\" title=\"4. 其他常用字符\"></a>4. 其他常用字符</h3><ul>\n<li>边界字符/头尾字符</li>\n</ul>\n<p>头字符 ^root, 表示以root开头的行，注意与取反字符 [^0-9] 的区别</p>\n<p>尾字符 false$, 表示以false结尾的行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^root&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br><span class=\"line\"></span><br><span class=\"line\">$ grep &#39;false$&#39; passwd</span><br><span class=\"line\">nobody:*:-2:-2:Unprivileged User:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>空行： ^$, 头尾相接。</p>\n<ul>\n<li>元字符（代表普通字符或特殊字符）</li>\n</ul>\n<p>实质上起替代的作用</p>\n<p>\\w: 匹配任何字类字符，即字母数字下划线 [a-zA-Z0-9_]</p>\n<p>\\W: 匹配任何非字类字符，即 [^a-zA-Z0-9_]</p>\n<p>\\b: 代表单词的分隔</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &#39;\\btime\\b&#39; file</span><br></pre></td></tr></table></figure>\n\n<p>只匹配包含单词 time 的行，不匹配 timezone，showtime 等。</p>\n<h2 id=\"3-字符组合\"><a href=\"#3-字符组合\" class=\"headerlink\" title=\"3. 字符组合\"></a>3. 字符组合</h2><h3 id=\"1-字符串\"><a href=\"#1-字符串\" class=\"headerlink\" title=\"1. 字符串\"></a>1. 字符串</h3><p>‘root’, ‘1000’, ‘r..t’ (r开头，t结束，长度为4的字符串)</p>\n<p>‘[A-Z][a-z]’ (一个大写字母加一个小写字母)</p>\n<p>‘[0-9][0-9]’ (两个连续的数字，<strong>正则为最大化匹配，所以四位数也会匹配，五位数也会匹配前四位</strong>)</p>\n<h3 id=\"2-重复\"><a href=\"#2-重复\" class=\"headerlink\" title=\"2. 重复\"></a>2. 重复</h3><ul>\n<li><p>*: 0-n 次匹配前面的字符或表达式</p>\n</li>\n<li><p>+: 1-n 次匹配</p>\n</li>\n<li><p>?: 0-1 次匹配</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 可能的匹配结果： s, se, see, seee...</span><br><span class=\"line\">$ grep &#39;se*&#39; passwd</span><br><span class=\"line\">&#x2F;&#x2F; 可能的匹配结果： se, see, seee...</span><br><span class=\"line\">$ grep &#39;se\\+&#39; passwd</span><br><span class=\"line\">&#x2F;&#x2F; 可能的匹配结果： s, se, 只有两种</span><br><span class=\"line\">$ grep &#39;se\\?&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>后两者注意要进行转义。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 匹配字符串，要加括号 se, sese, sese...</span><br><span class=\"line\">$ grep &#39;\\(se\\)\\+&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>注意括号也要进行转义。</p>\n<ul>\n<li>重复特定次数 {n,m}</li>\n</ul>\n<p>*: 相当于 {0,} </p>\n<p>+: 相当于 {1,}</p>\n<p>?: 相当于 {0,1}</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 匹配两到三位数字</span><br><span class=\"line\">$ grep &#39;[0-9]\\&#123;2,3\\&#125;&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>注意大括号也要转义。</p>\n<ul>\n<li>任意字符串： .*<br>(即任意单字符重复0-n次)</li>\n</ul>\n<p>如： ^r.*,  r.*t</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^r.*&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：正则贪婪匹配的规则。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;\\bd.*e\\b&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-24/65316894.jpg\"></p>\n<p>多么贪婪，我只想要匹配类似 dislike 这种词。</p>\n<p>这时候就不能重复任意字符了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;\\bd[a-z]*e\\b&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>这样改就好了。</p>\n<p>尽量去缩小要匹配的范围，才能避免踩这些坑。</p>\n<h3 id=\"3-逻辑\"><a href=\"#3-逻辑\" class=\"headerlink\" title=\"3. 逻辑\"></a>3. 逻辑</h3><ul>\n<li>逻辑或 |</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;bin&#x2F;\\(false\\|true\\)&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-正则案例\"><a href=\"#4-正则案例\" class=\"headerlink\" title=\"4. 正则案例\"></a>4. 正则案例</h2><h3 id=\"1-匹配4-10位QQ号\"><a href=\"#1-匹配4-10位QQ号\" class=\"headerlink\" title=\"1. 匹配4-10位QQ号\"></a>1. 匹配4-10位QQ号</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^[0-9]\\&#123;4,10\\&#125;$&#39; file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-匹配15或18位身份证号，包括X\"><a href=\"#2-匹配15或18位身份证号，包括X\" class=\"headerlink\" title=\"2. 匹配15或18位身份证号，包括X\"></a>2. 匹配15或18位身份证号，包括X</h3><p>分析：</p>\n<ul>\n<li>第一位不能为0</li>\n<li>最后一位的范围要扩大</li>\n<li>中间为13或16位重复数字</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 先写逻辑，最后加头尾和转义</span><br><span class=\"line\">$ grep &#39;^[1-9]\\([0-9]\\&#123;13\\&#125;\\|[0-9]\\&#123;16\\&#125;\\)[0-9xX]$&#39; file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-匹配密码\"><a href=\"#3-匹配密码\" class=\"headerlink\" title=\"3. 匹配密码\"></a>3. 匹配密码</h3><p>分析：</p>\n<ul>\n<li>密码保护字母数字下划线，使用元字符 \\w</li>\n<li>可1次或多次重复 +</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^\\w\\+$&#39; file</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-24/91639479.jpg\"></p>\n","site":{"data":{}},"excerpt":"<p>本文是慕课网 <a href=\"http://www.imooc.com/learn/819\">《实例妙解sed 和 awk 的秘密》</a> 的学习记录的第一部分：正则表达式。</p>\n<p>Linux 三大利器： grep, sed, awk.</p>","more":"<h2 id=\"1-准备工作\"><a href=\"#1-准备工作\" class=\"headerlink\" title=\"1. 准备工作\"></a>1. 准备工作</h2><p>正则表达式应用场景：查找、取出、匹配符合条件的字符或字符串</p>\n<p>学习方法：从小到大、组合的过程。单个字符-&gt;字符串-&gt;表达式。</p>\n<p>grep 搜索命令匹配正则表达式例子</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;root&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_cvmsroot:*:212:212:CVMS Root:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-正则单个字符的表示方式\"><a href=\"#2-正则单个字符的表示方式\" class=\"headerlink\" title=\"2. 正则单个字符的表示方式\"></a>2. 正则单个字符的表示方式</h2><h3 id=\"1-特定字符\"><a href=\"#1-特定字符\" class=\"headerlink\" title=\"1. 特定字符\"></a>1. 特定字符</h3><p>某个具体的字符，如 ‘1’, ‘a’</p>\n<p>使用 grep 搜索命令进行正则表达式的匹配</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;1&#39; passwd</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_taskgated:*:13:13:Task Gate Daemon:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_scsd:*:31:31:Service Configuration Service:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">_eppc:*:71:71:Apple Events User:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>匹配结果被标红</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-24/6251408.jpg\"></p>\n<h3 id=\"2-范围内字符\"><a href=\"#2-范围内字符\" class=\"headerlink\" title=\"2. 范围内字符\"></a>2. 范围内字符</h3><ul>\n<li><strong>单个</strong>字符 []</li>\n</ul>\n<p>数字字符：[0-9], [278], 表示2/7/8, 注意只匹配一个字符。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;[0-9]&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>小写字符：[a-z]</p>\n</li>\n<li><p>大写字符：[A-Z]</p>\n</li>\n<li><p>大小写：[a-zA-Z]</p>\n</li>\n<li><p>符号： [,:!%-().]</p>\n</li>\n<li><p>反向字符： ^, <strong>必须放在范围之前，[]内部</strong>，如</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;[^0-9]&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-任意字符\"><a href=\"#3-任意字符\" class=\"headerlink\" title=\"3. 任意字符\"></a>3. 任意字符</h3><p>代表任何一个字符： .</p>\n<p>注意 ., \\.,  [.] 的区别，其中后两个的作用是一样的。</p>\n<h3 id=\"4-其他常用字符\"><a href=\"#4-其他常用字符\" class=\"headerlink\" title=\"4. 其他常用字符\"></a>4. 其他常用字符</h3><ul>\n<li>边界字符/头尾字符</li>\n</ul>\n<p>头字符 ^root, 表示以root开头的行，注意与取反字符 [^0-9] 的区别</p>\n<p>尾字符 false$, 表示以false结尾的行。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^root&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br><span class=\"line\"></span><br><span class=\"line\">$ grep &#39;false$&#39; passwd</span><br><span class=\"line\">nobody:*:-2:-2:Unprivileged User:&#x2F;var&#x2F;empty:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">daemon:*:1:1:System Services:&#x2F;var&#x2F;root:&#x2F;usr&#x2F;bin&#x2F;false</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<p>空行： ^$, 头尾相接。</p>\n<ul>\n<li>元字符（代表普通字符或特殊字符）</li>\n</ul>\n<p>实质上起替代的作用</p>\n<p>\\w: 匹配任何字类字符，即字母数字下划线 [a-zA-Z0-9_]</p>\n<p>\\W: 匹配任何非字类字符，即 [^a-zA-Z0-9_]</p>\n<p>\\b: 代表单词的分隔</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grep &#39;\\btime\\b&#39; file</span><br></pre></td></tr></table></figure>\n\n<p>只匹配包含单词 time 的行，不匹配 timezone，showtime 等。</p>\n<h2 id=\"3-字符组合\"><a href=\"#3-字符组合\" class=\"headerlink\" title=\"3. 字符组合\"></a>3. 字符组合</h2><h3 id=\"1-字符串\"><a href=\"#1-字符串\" class=\"headerlink\" title=\"1. 字符串\"></a>1. 字符串</h3><p>‘root’, ‘1000’, ‘r..t’ (r开头，t结束，长度为4的字符串)</p>\n<p>‘[A-Z][a-z]’ (一个大写字母加一个小写字母)</p>\n<p>‘[0-9][0-9]’ (两个连续的数字，<strong>正则为最大化匹配，所以四位数也会匹配，五位数也会匹配前四位</strong>)</p>\n<h3 id=\"2-重复\"><a href=\"#2-重复\" class=\"headerlink\" title=\"2. 重复\"></a>2. 重复</h3><ul>\n<li><p>*: 0-n 次匹配前面的字符或表达式</p>\n</li>\n<li><p>+: 1-n 次匹配</p>\n</li>\n<li><p>?: 0-1 次匹配</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 可能的匹配结果： s, se, see, seee...</span><br><span class=\"line\">$ grep &#39;se*&#39; passwd</span><br><span class=\"line\">&#x2F;&#x2F; 可能的匹配结果： se, see, seee...</span><br><span class=\"line\">$ grep &#39;se\\+&#39; passwd</span><br><span class=\"line\">&#x2F;&#x2F; 可能的匹配结果： s, se, 只有两种</span><br><span class=\"line\">$ grep &#39;se\\?&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>后两者注意要进行转义。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 匹配字符串，要加括号 se, sese, sese...</span><br><span class=\"line\">$ grep &#39;\\(se\\)\\+&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>注意括号也要进行转义。</p>\n<ul>\n<li>重复特定次数 {n,m}</li>\n</ul>\n<p>*: 相当于 {0,} </p>\n<p>+: 相当于 {1,}</p>\n<p>?: 相当于 {0,1}</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 匹配两到三位数字</span><br><span class=\"line\">$ grep &#39;[0-9]\\&#123;2,3\\&#125;&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>注意大括号也要转义。</p>\n<ul>\n<li>任意字符串： .*<br>(即任意单字符重复0-n次)</li>\n</ul>\n<p>如： ^r.*,  r.*t</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^r.*&#39; passwd</span><br><span class=\"line\">root:*:0:0:System Administrator:&#x2F;var&#x2F;root:&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>\n\n<p><strong>注意</strong>：正则贪婪匹配的规则。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;\\bd.*e\\b&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-24/65316894.jpg\"></p>\n<p>多么贪婪，我只想要匹配类似 dislike 这种词。</p>\n<p>这时候就不能重复任意字符了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;\\bd[a-z]*e\\b&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<p>这样改就好了。</p>\n<p>尽量去缩小要匹配的范围，才能避免踩这些坑。</p>\n<h3 id=\"3-逻辑\"><a href=\"#3-逻辑\" class=\"headerlink\" title=\"3. 逻辑\"></a>3. 逻辑</h3><ul>\n<li>逻辑或 |</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;bin&#x2F;\\(false\\|true\\)&#39; passwd</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-正则案例\"><a href=\"#4-正则案例\" class=\"headerlink\" title=\"4. 正则案例\"></a>4. 正则案例</h2><h3 id=\"1-匹配4-10位QQ号\"><a href=\"#1-匹配4-10位QQ号\" class=\"headerlink\" title=\"1. 匹配4-10位QQ号\"></a>1. 匹配4-10位QQ号</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^[0-9]\\&#123;4,10\\&#125;$&#39; file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-匹配15或18位身份证号，包括X\"><a href=\"#2-匹配15或18位身份证号，包括X\" class=\"headerlink\" title=\"2. 匹配15或18位身份证号，包括X\"></a>2. 匹配15或18位身份证号，包括X</h3><p>分析：</p>\n<ul>\n<li>第一位不能为0</li>\n<li>最后一位的范围要扩大</li>\n<li>中间为13或16位重复数字</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 先写逻辑，最后加头尾和转义</span><br><span class=\"line\">$ grep &#39;^[1-9]\\([0-9]\\&#123;13\\&#125;\\|[0-9]\\&#123;16\\&#125;\\)[0-9xX]$&#39; file</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-匹配密码\"><a href=\"#3-匹配密码\" class=\"headerlink\" title=\"3. 匹配密码\"></a>3. 匹配密码</h3><p>分析：</p>\n<ul>\n<li>密码保护字母数字下划线，使用元字符 \\w</li>\n<li>可1次或多次重复 +</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ grep &#39;^\\w\\+$&#39; file</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-24/91639479.jpg\"></p>"},{"title":"使用终端卸载 Ubuntu 应用","date":"2016-11-11T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-22922c208e54a6ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n> 一直以来，只是知道安装程序，而不知道怎么卸载。\n\n<!--more-->\n\n1. 打开终端。你将使用`apt-get`命令，这是用于管理已安装程序的通用命令。在卸载程序时，你可能需要输入管理员密码。\n\n    当你输入密码时，密码将不会被显示。完成输入后按回车即可。\n2. 浏览已安装的程序。要查看已安装的软件包列表，请输入以下命令。请注意你希望卸载的软件包的名称。\n\n    ```\n    dpkg --list | grep <programname>\n    ```\n\n3. 卸载程序和所有配置文件。在终端中输入以下命令，把<programname>替换成你希望完全移除的程序：\n \n    ```\n    sudo apt-get --purge remove <programname>\n    ```\n4. 只卸载程序。如果你移除程序但保留配置文件，请输入以下命令：\n\n    ```\n    sudo apt-get remove <programname>\n    ```\n\n\n","source":"_posts/使用终端卸载-Ubuntu-应用.md","raw":"---\ntitle: 使用终端卸载 Ubuntu 应用\ndate: 2016-11-12\ntags: ubuntu\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-22922c208e54a6ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n> 一直以来，只是知道安装程序，而不知道怎么卸载。\n\n<!--more-->\n\n1. 打开终端。你将使用`apt-get`命令，这是用于管理已安装程序的通用命令。在卸载程序时，你可能需要输入管理员密码。\n\n    当你输入密码时，密码将不会被显示。完成输入后按回车即可。\n2. 浏览已安装的程序。要查看已安装的软件包列表，请输入以下命令。请注意你希望卸载的软件包的名称。\n\n    ```\n    dpkg --list | grep <programname>\n    ```\n\n3. 卸载程序和所有配置文件。在终端中输入以下命令，把<programname>替换成你希望完全移除的程序：\n \n    ```\n    sudo apt-get --purge remove <programname>\n    ```\n4. 只卸载程序。如果你移除程序但保留配置文件，请输入以下命令：\n\n    ```\n    sudo apt-get remove <programname>\n    ```\n\n\n","slug":"使用终端卸载-Ubuntu-应用","published":1,"updated":"2020-09-11T01:04:35.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9o00366wo10b7gaxpc","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-22922c208e54a6ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>一直以来，只是知道安装程序，而不知道怎么卸载。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<ol>\n<li><p>打开终端。你将使用<code>apt-get</code>命令，这是用于管理已安装程序的通用命令。在卸载程序时，你可能需要输入管理员密码。</p>\n<p> 当你输入密码时，密码将不会被显示。完成输入后按回车即可。</p>\n</li>\n<li><p>浏览已安装的程序。要查看已安装的软件包列表，请输入以下命令。请注意你希望卸载的软件包的名称。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg --list | grep &lt;programname&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>卸载程序和所有配置文件。在终端中输入以下命令，把<programname>替换成你希望完全移除的程序：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get --purge remove &lt;programname&gt;</span><br></pre></td></tr></table></figure></li>\n<li><p>只卸载程序。如果你移除程序但保留配置文件，请输入以下命令：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove &lt;programname&gt;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-22922c208e54a6ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>一直以来，只是知道安装程序，而不知道怎么卸载。</p>\n</blockquote>","more":"<ol>\n<li><p>打开终端。你将使用<code>apt-get</code>命令，这是用于管理已安装程序的通用命令。在卸载程序时，你可能需要输入管理员密码。</p>\n<p> 当你输入密码时，密码将不会被显示。完成输入后按回车即可。</p>\n</li>\n<li><p>浏览已安装的程序。要查看已安装的软件包列表，请输入以下命令。请注意你希望卸载的软件包的名称。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dpkg --list | grep &lt;programname&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>卸载程序和所有配置文件。在终端中输入以下命令，把<programname>替换成你希望完全移除的程序：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get --purge remove &lt;programname&gt;</span><br></pre></td></tr></table></figure></li>\n<li><p>只卸载程序。如果你移除程序但保留配置文件，请输入以下命令：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get remove &lt;programname&gt;</span><br></pre></td></tr></table></figure>\n\n\n</li>\n</ol>"},{"title":"使用-Sublime-替换文本中的换行-回车符等特殊符号","date":"2017-01-08T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-93b3a892a145f176.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n> 这个功能使用的比较频繁，但一直没有记住。在这里简单记录一下。\n\n<!--more-->\n\n1. 首先， `Cmd + Shift + F`打开查找替换框。\n\n2. 单击选中最左侧的正则匹配，图中的红框位置。\n\n![](http://upload-images.jianshu.io/upload_images/693141-ba7e7df576291fe0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n3. 输入想要被替换的正则表达式，如`\\n`。表达式会以橙色高亮显示。\n\n4. 输入想要替换的内容， 如`,\\n`。\n\n\n就是这么简单。\n\n\n","source":"_posts/使用-Sublime-替换文本中的换行-回车符等特殊符号.md","raw":"\n---\ntitle: 使用-Sublime-替换文本中的换行-回车符等特殊符号\ndate: 2017-01-09\ntags: sublime\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-93b3a892a145f176.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n> 这个功能使用的比较频繁，但一直没有记住。在这里简单记录一下。\n\n<!--more-->\n\n1. 首先， `Cmd + Shift + F`打开查找替换框。\n\n2. 单击选中最左侧的正则匹配，图中的红框位置。\n\n![](http://upload-images.jianshu.io/upload_images/693141-ba7e7df576291fe0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n3. 输入想要被替换的正则表达式，如`\\n`。表达式会以橙色高亮显示。\n\n4. 输入想要替换的内容， 如`,\\n`。\n\n\n就是这么简单。\n\n\n","slug":"使用-Sublime-替换文本中的换行-回车符等特殊符号","published":1,"updated":"2020-09-11T01:04:35.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9q003a6wo16rza62ug","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-93b3a892a145f176.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>这个功能使用的比较频繁，但一直没有记住。在这里简单记录一下。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<ol>\n<li><p>首先， <code>Cmd + Shift + F</code>打开查找替换框。</p>\n</li>\n<li><p>单击选中最左侧的正则匹配，图中的红框位置。</p>\n</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-ba7e7df576291fe0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<ol start=\"3\">\n<li><p>输入想要被替换的正则表达式，如<code>\\n</code>。表达式会以橙色高亮显示。</p>\n</li>\n<li><p>输入想要替换的内容， 如<code>,\\n</code>。</p>\n</li>\n</ol>\n<p>就是这么简单。</p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-93b3a892a145f176.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>这个功能使用的比较频繁，但一直没有记住。在这里简单记录一下。</p>\n</blockquote>","more":"<ol>\n<li><p>首先， <code>Cmd + Shift + F</code>打开查找替换框。</p>\n</li>\n<li><p>单击选中最左侧的正则匹配，图中的红框位置。</p>\n</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-ba7e7df576291fe0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<ol start=\"3\">\n<li><p>输入想要被替换的正则表达式，如<code>\\n</code>。表达式会以橙色高亮显示。</p>\n</li>\n<li><p>输入想要替换的内容， 如<code>,\\n</code>。</p>\n</li>\n</ol>\n<p>就是这么简单。</p>"},{"title":"全新离线安装 Laravel Homestead 记录","date":"2016-12-02T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-3263c5e58700a808.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n> 之前安装的homestead系统版本为Ubuntu14.04，现业务需要，需升级为16.04，在虚拟机中直接升级完成后，无法启动。正好趁这个机会把所有需要升级的都升级一遍，全新安装并Laravel运行环境。\n<!--more-->\n\n## 1. 准备工作\n1. 备份好数据后，彻底删除原来的运行环境，包括Homestead文件夹，虚拟机目录，.homestead 文件夹，box（```vagrant box remove boxname```）等。\n2. 下载并安装 [Virtualbox](https://www.virtualbox.org/wiki/Downloads)\n3. 下载并安装 [vagrant](https://www.vagrantup.com/downloads.html)\n4. 下载homestead离线安装包 [virtualbox](https://atlas.hashicorp.com/laravel/boxes/homestead/versions/2.0.0/providers/virtualbox.box)，版本号的数字自行修改，如2.0.1 \n5. virtualbox 可启动，命令行中 ```vagrant -v``` 显示vagrant版本号，准备工作完成。\n\n\n## 2. 开始安装\n[官方文档](http://www.golaravel.com/laravel/docs/5.0/homestead/)给出的安装方式为在线安装，蛋疼的网速想要在短时间内安装成功非常困难，所以这里采用离线安装方式。\n1. 新建一个目录，我这里命名为 vagrant，将准备工作下载好的 virtualbox.box 拷贝到该目录下\n2. 添加box，这里步骤2与步骤3实现的效果一致，但步骤2添加成功后可能会有更新问题，**推荐跳过此步骤直接执行步骤3**.\n```vagrant box list```查看目前系统中已有的box，新加的box尽量不要与原有的box重名。\n    ```vagrant vagrant box add  laravel/homestead virtualbox.box```，如果box文件在当前目录下，直接添加文件即可，如果不在，需要写明全路径。\n    \n    看到success添加盒子就成功了。\n3. 在virtualbox.box镜像所在目录创建metadata.json，输入以下内容\n    ```\n    {\n        \"name\": \"laravel/homestead\",\n        \"versions\": [{\n            \"version\": \"2.0.0\",\n            \"providers\": [{\n                \"name\": \"virtualbox\",\n                \"url\": \"file://virtualbox.box\"\n            }]\n        }]\n    }\n    ```\n    其中，url最好写box的全路径。然后输入以下命令添加box\n    ```\n    vagrant box add metadata.json\n    ```\n    查看已安装的box\n    ```\n    vagrant box list\n    ```\n\n\n## 3. 克隆官方仓库\nhomestead，vagrant，virtualbox之间的关系梳理\n1. homestead镜像就是laravel官方为了方便开发者，将一系列的开发环境、软件打包成一个镜像供大家使用，当前homestead包含[以下内容](https://laravel.com/docs/5.4/homestead)：Ubuntu 16.04，Git，PHP 7.1，Nginx，MySQL，Postgres，Composer，Node (With Yarn, Bower, Grunt, Gulp) 等。\n2. vagrant可以看作是对virtualbox或vmware的一个高级封装，本质就是调用了一些virtualbox和vmware开放出来的api\n3. homestead git仓库呢则是laravel官方对于homestead虚拟机的一些配置文件，里面有一些方便的Linux脚本\n\nclone [版本库](https://github.com/laravel/homestead)\n```\ngit clone https://github.com/laravel/homestead.git Homestead\n```\n\n## 4. 配置 Homestead\n1. 进入到clone的目录中运行 init.sh，这样就在家目录中生成一个.homestead 的目录，里面包含homestead虚拟机的配置文件 Homestead.yaml (homestead在github上的版本已更新到5.1，有一些文件发生了变动。最主要的变动是当运行init.bat或init.sh时候，几个文件将不再复制到家目录的.homestead文件，而是直接被复制到homestead项目的根目录中。原先家目录下的.homestead可以直接删掉了！)\n2. 修改该文件\n    ```\n    ip: \"192.168.10.10\"\n    memory: 2048\n    cpus: 1\n    provider: virtualbox\n    \n    authorize: ~/.ssh/id_rsa.pub\n    \n    keys:\n        - ~/.ssh/id_rsa\n    \n    folders:\n        - map: /myCodeDir\n          to: /home/vagrant/www\n    \n    sites:\n        - map: homestead.app\n          to: /home/vagrant/www/Laravel/public\n    \n    databases:\n        - homestead\n    \n    # blackfire:\n    #     - id: foo\n    #       token: bar\n    #       client-id: foo\n    #       client-token: bar\n    \n    # ports:\n    #     - send: 50000\n    #       to: 5000\n    #     - send: 7777\n    #       to: 777\n    #       protocol: udp\n    ```\n    主要需要改动的就是 folders这一项，将本机的一个目录共享给虚拟机。\n    rsa 公钥私钥路径一定要对，不然无法启动，没有的话通过git bash或其他Linux环境输入以下命令生成\n    ```\n    ssh-keygen -t rsa -C \"vagrant@homestead\"\n    ```\n\n## 5. 启动 homestead\n1. 进入到homestead目录(git clone的那个) ```vagrant up```，耐心等待一会就可以。\n2. 修改本地的hosts文件，添加homestead虚拟机的DNS\n3. 没有报错就正常启动了。 输入命令 ```vagrant ssh```进入虚拟机。\n4. 升级，配置nginx等。\n\n## 6. 参考资料\n1. [离线安装&配置laravel开发环境homestead\n](https://www.alwayscoder.com/offline-install-laravel-homestead/)\n2. [私钥问题](http://stackoverflow.com/questions/22922891/vagrant-ssh-authentication-failure)\n3. [连接超时问题](http://stackoverflow.com/questions/22575261/vagrant-stuck-connection-timeout-retrying)\n4. [Vagrant入门](http://www.cnblogs.com/davenkin/p/vagrant-virtualbox.html)\n\n\n","source":"_posts/全新离线安装Laravel-Homestead-记录.md","raw":"---\ntitle: 全新离线安装 Laravel Homestead 记录\ndate: 2016-12-03\ntags: laravel\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-3263c5e58700a808.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n> 之前安装的homestead系统版本为Ubuntu14.04，现业务需要，需升级为16.04，在虚拟机中直接升级完成后，无法启动。正好趁这个机会把所有需要升级的都升级一遍，全新安装并Laravel运行环境。\n<!--more-->\n\n## 1. 准备工作\n1. 备份好数据后，彻底删除原来的运行环境，包括Homestead文件夹，虚拟机目录，.homestead 文件夹，box（```vagrant box remove boxname```）等。\n2. 下载并安装 [Virtualbox](https://www.virtualbox.org/wiki/Downloads)\n3. 下载并安装 [vagrant](https://www.vagrantup.com/downloads.html)\n4. 下载homestead离线安装包 [virtualbox](https://atlas.hashicorp.com/laravel/boxes/homestead/versions/2.0.0/providers/virtualbox.box)，版本号的数字自行修改，如2.0.1 \n5. virtualbox 可启动，命令行中 ```vagrant -v``` 显示vagrant版本号，准备工作完成。\n\n\n## 2. 开始安装\n[官方文档](http://www.golaravel.com/laravel/docs/5.0/homestead/)给出的安装方式为在线安装，蛋疼的网速想要在短时间内安装成功非常困难，所以这里采用离线安装方式。\n1. 新建一个目录，我这里命名为 vagrant，将准备工作下载好的 virtualbox.box 拷贝到该目录下\n2. 添加box，这里步骤2与步骤3实现的效果一致，但步骤2添加成功后可能会有更新问题，**推荐跳过此步骤直接执行步骤3**.\n```vagrant box list```查看目前系统中已有的box，新加的box尽量不要与原有的box重名。\n    ```vagrant vagrant box add  laravel/homestead virtualbox.box```，如果box文件在当前目录下，直接添加文件即可，如果不在，需要写明全路径。\n    \n    看到success添加盒子就成功了。\n3. 在virtualbox.box镜像所在目录创建metadata.json，输入以下内容\n    ```\n    {\n        \"name\": \"laravel/homestead\",\n        \"versions\": [{\n            \"version\": \"2.0.0\",\n            \"providers\": [{\n                \"name\": \"virtualbox\",\n                \"url\": \"file://virtualbox.box\"\n            }]\n        }]\n    }\n    ```\n    其中，url最好写box的全路径。然后输入以下命令添加box\n    ```\n    vagrant box add metadata.json\n    ```\n    查看已安装的box\n    ```\n    vagrant box list\n    ```\n\n\n## 3. 克隆官方仓库\nhomestead，vagrant，virtualbox之间的关系梳理\n1. homestead镜像就是laravel官方为了方便开发者，将一系列的开发环境、软件打包成一个镜像供大家使用，当前homestead包含[以下内容](https://laravel.com/docs/5.4/homestead)：Ubuntu 16.04，Git，PHP 7.1，Nginx，MySQL，Postgres，Composer，Node (With Yarn, Bower, Grunt, Gulp) 等。\n2. vagrant可以看作是对virtualbox或vmware的一个高级封装，本质就是调用了一些virtualbox和vmware开放出来的api\n3. homestead git仓库呢则是laravel官方对于homestead虚拟机的一些配置文件，里面有一些方便的Linux脚本\n\nclone [版本库](https://github.com/laravel/homestead)\n```\ngit clone https://github.com/laravel/homestead.git Homestead\n```\n\n## 4. 配置 Homestead\n1. 进入到clone的目录中运行 init.sh，这样就在家目录中生成一个.homestead 的目录，里面包含homestead虚拟机的配置文件 Homestead.yaml (homestead在github上的版本已更新到5.1，有一些文件发生了变动。最主要的变动是当运行init.bat或init.sh时候，几个文件将不再复制到家目录的.homestead文件，而是直接被复制到homestead项目的根目录中。原先家目录下的.homestead可以直接删掉了！)\n2. 修改该文件\n    ```\n    ip: \"192.168.10.10\"\n    memory: 2048\n    cpus: 1\n    provider: virtualbox\n    \n    authorize: ~/.ssh/id_rsa.pub\n    \n    keys:\n        - ~/.ssh/id_rsa\n    \n    folders:\n        - map: /myCodeDir\n          to: /home/vagrant/www\n    \n    sites:\n        - map: homestead.app\n          to: /home/vagrant/www/Laravel/public\n    \n    databases:\n        - homestead\n    \n    # blackfire:\n    #     - id: foo\n    #       token: bar\n    #       client-id: foo\n    #       client-token: bar\n    \n    # ports:\n    #     - send: 50000\n    #       to: 5000\n    #     - send: 7777\n    #       to: 777\n    #       protocol: udp\n    ```\n    主要需要改动的就是 folders这一项，将本机的一个目录共享给虚拟机。\n    rsa 公钥私钥路径一定要对，不然无法启动，没有的话通过git bash或其他Linux环境输入以下命令生成\n    ```\n    ssh-keygen -t rsa -C \"vagrant@homestead\"\n    ```\n\n## 5. 启动 homestead\n1. 进入到homestead目录(git clone的那个) ```vagrant up```，耐心等待一会就可以。\n2. 修改本地的hosts文件，添加homestead虚拟机的DNS\n3. 没有报错就正常启动了。 输入命令 ```vagrant ssh```进入虚拟机。\n4. 升级，配置nginx等。\n\n## 6. 参考资料\n1. [离线安装&配置laravel开发环境homestead\n](https://www.alwayscoder.com/offline-install-laravel-homestead/)\n2. [私钥问题](http://stackoverflow.com/questions/22922891/vagrant-ssh-authentication-failure)\n3. [连接超时问题](http://stackoverflow.com/questions/22575261/vagrant-stuck-connection-timeout-retrying)\n4. [Vagrant入门](http://www.cnblogs.com/davenkin/p/vagrant-virtualbox.html)\n\n\n","slug":"全新离线安装Laravel-Homestead-记录","published":1,"updated":"2020-09-11T01:04:35.047Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9r003d6wo13ixw02fy","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-3263c5e58700a808.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>之前安装的homestead系统版本为Ubuntu14.04，现业务需要，需升级为16.04，在虚拟机中直接升级完成后，无法启动。正好趁这个机会把所有需要升级的都升级一遍，全新安装并Laravel运行环境。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h2 id=\"1-准备工作\"><a href=\"#1-准备工作\" class=\"headerlink\" title=\"1. 准备工作\"></a>1. 准备工作</h2><ol>\n<li>备份好数据后，彻底删除原来的运行环境，包括Homestead文件夹，虚拟机目录，.homestead 文件夹，box（<code>vagrant box remove boxname</code>）等。</li>\n<li>下载并安装 <a href=\"https://www.virtualbox.org/wiki/Downloads\">Virtualbox</a></li>\n<li>下载并安装 <a href=\"https://www.vagrantup.com/downloads.html\">vagrant</a></li>\n<li>下载homestead离线安装包 <a href=\"https://atlas.hashicorp.com/laravel/boxes/homestead/versions/2.0.0/providers/virtualbox.box\">virtualbox</a>，版本号的数字自行修改，如2.0.1 </li>\n<li>virtualbox 可启动，命令行中 <code>vagrant -v</code> 显示vagrant版本号，准备工作完成。</li>\n</ol>\n<h2 id=\"2-开始安装\"><a href=\"#2-开始安装\" class=\"headerlink\" title=\"2. 开始安装\"></a>2. 开始安装</h2><p><a href=\"http://www.golaravel.com/laravel/docs/5.0/homestead/\">官方文档</a>给出的安装方式为在线安装，蛋疼的网速想要在短时间内安装成功非常困难，所以这里采用离线安装方式。</p>\n<ol>\n<li><p>新建一个目录，我这里命名为 vagrant，将准备工作下载好的 virtualbox.box 拷贝到该目录下</p>\n</li>\n<li><p>添加box，这里步骤2与步骤3实现的效果一致，但步骤2添加成功后可能会有更新问题，<strong>推荐跳过此步骤直接执行步骤3</strong>.</p>\n<figure class=\"highlight plain\"><figcaption><span>box list```查看目前系统中已有的box，新加的box尽量不要与原有的box重名。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &#96;&#96;&#96;vagrant vagrant box add  laravel&#x2F;homestead virtualbox.box&#96;&#96;&#96;，如果box文件在当前目录下，直接添加文件即可，如果不在，需要写明全路径。</span><br><span class=\"line\">    </span><br><span class=\"line\">    看到success添加盒子就成功了。</span><br><span class=\"line\">3. 在virtualbox.box镜像所在目录创建metadata.json，输入以下内容</span><br></pre></td></tr></table></figure>\n<p> {</p>\n<pre><code> &quot;name&quot;: &quot;laravel/homestead&quot;,\n &quot;versions&quot;: [&#123;\n     &quot;version&quot;: &quot;2.0.0&quot;,\n     &quot;providers&quot;: [&#123;\n         &quot;name&quot;: &quot;virtualbox&quot;,\n         &quot;url&quot;: &quot;file://virtualbox.box&quot;\n     &#125;]\n &#125;]</code></pre>\n<p> }</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">其中，url最好写box的全路径。然后输入以下命令添加box</span><br></pre></td></tr></table></figure>\n<p> vagrant box add metadata.json</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看已安装的box</span><br></pre></td></tr></table></figure>\n<p> vagrant box list</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 3. 克隆官方仓库</span><br><span class=\"line\">homestead，vagrant，virtualbox之间的关系梳理</span><br><span class=\"line\">1. homestead镜像就是laravel官方为了方便开发者，将一系列的开发环境、软件打包成一个镜像供大家使用，当前homestead包含[以下内容](https:&#x2F;&#x2F;laravel.com&#x2F;docs&#x2F;5.4&#x2F;homestead)：Ubuntu 16.04，Git，PHP 7.1，Nginx，MySQL，Postgres，Composer，Node (With Yarn, Bower, Grunt, Gulp) 等。</span><br><span class=\"line\">2. vagrant可以看作是对virtualbox或vmware的一个高级封装，本质就是调用了一些virtualbox和vmware开放出来的api</span><br><span class=\"line\">3. homestead git仓库呢则是laravel官方对于homestead虚拟机的一些配置文件，里面有一些方便的Linux脚本</span><br><span class=\"line\"></span><br><span class=\"line\">clone [版本库](https:&#x2F;&#x2F;github.com&#x2F;laravel&#x2F;homestead)</span><br></pre></td></tr></table></figure>\n<p>git clone <a href=\"https://github.com/laravel/homestead.git\">https://github.com/laravel/homestead.git</a> Homestead</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## 4. 配置 Homestead</span><br><span class=\"line\">1. 进入到clone的目录中运行 init.sh，这样就在家目录中生成一个.homestead 的目录，里面包含homestead虚拟机的配置文件 Homestead.yaml (homestead在github上的版本已更新到5.1，有一些文件发生了变动。最主要的变动是当运行init.bat或init.sh时候，几个文件将不再复制到家目录的.homestead文件，而是直接被复制到homestead项目的根目录中。原先家目录下的.homestead可以直接删掉了！)</span><br><span class=\"line\">2. 修改该文件</span><br></pre></td></tr></table></figure>\n<p> ip: “192.168.10.10”<br> memory: 2048<br> cpus: 1<br> provider: virtualbox</p>\n<p> authorize: ~/.ssh/id_rsa.pub</p>\n<p> keys:</p>\n<pre><code> - ~/.ssh/id_rsa</code></pre>\n<p> folders:</p>\n<pre><code> - map: /myCodeDir\n   to: /home/vagrant/www</code></pre>\n<p> sites:</p>\n<pre><code> - map: homestead.app\n   to: /home/vagrant/www/Laravel/public</code></pre>\n<p> databases:</p>\n<pre><code> - homestead</code></pre>\n<h1 id=\"blackfire\"><a href=\"#blackfire\" class=\"headerlink\" title=\"blackfire:\"></a>blackfire:</h1><h1 id=\"id-foo\"><a href=\"#id-foo\" class=\"headerlink\" title=\"- id: foo\"></a>- id: foo</h1><h1 id=\"token-bar\"><a href=\"#token-bar\" class=\"headerlink\" title=\"token: bar\"></a>token: bar</h1><h1 id=\"client-id-foo\"><a href=\"#client-id-foo\" class=\"headerlink\" title=\"client-id: foo\"></a>client-id: foo</h1><h1 id=\"client-token-bar\"><a href=\"#client-token-bar\" class=\"headerlink\" title=\"client-token: bar\"></a>client-token: bar</h1><h1 id=\"ports\"><a href=\"#ports\" class=\"headerlink\" title=\"ports:\"></a>ports:</h1><h1 id=\"send-50000\"><a href=\"#send-50000\" class=\"headerlink\" title=\"- send: 50000\"></a>- send: 50000</h1><h1 id=\"to-5000\"><a href=\"#to-5000\" class=\"headerlink\" title=\"to: 5000\"></a>to: 5000</h1><h1 id=\"send-7777\"><a href=\"#send-7777\" class=\"headerlink\" title=\"- send: 7777\"></a>- send: 7777</h1><h1 id=\"to-777\"><a href=\"#to-777\" class=\"headerlink\" title=\"to: 777\"></a>to: 777</h1><h1 id=\"protocol-udp\"><a href=\"#protocol-udp\" class=\"headerlink\" title=\"protocol: udp\"></a>protocol: udp</h1> <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">主要需要改动的就是 folders这一项，将本机的一个目录共享给虚拟机。</span><br><span class=\"line\">rsa 公钥私钥路径一定要对，不然无法启动，没有的话通过git bash或其他Linux环境输入以下命令生成</span><br></pre></td></tr></table></figure>\n<p> ssh-keygen -t rsa -C “vagrant@homestead”</p>\n<pre><code></code></pre>\n</li>\n</ol>\n<h2 id=\"5-启动-homestead\"><a href=\"#5-启动-homestead\" class=\"headerlink\" title=\"5. 启动 homestead\"></a>5. 启动 homestead</h2><ol>\n<li>进入到homestead目录(git clone的那个) <code>vagrant up</code>，耐心等待一会就可以。</li>\n<li>修改本地的hosts文件，添加homestead虚拟机的DNS</li>\n<li>没有报错就正常启动了。 输入命令 <code>vagrant ssh</code>进入虚拟机。</li>\n<li>升级，配置nginx等。</li>\n</ol>\n<h2 id=\"6-参考资料\"><a href=\"#6-参考资料\" class=\"headerlink\" title=\"6. 参考资料\"></a>6. 参考资料</h2><ol>\n<li><a href=\"https://www.alwayscoder.com/offline-install-laravel-homestead/\">离线安装&amp;配置laravel开发环境homestead\n</a></li>\n<li><a href=\"http://stackoverflow.com/questions/22922891/vagrant-ssh-authentication-failure\">私钥问题</a></li>\n<li><a href=\"http://stackoverflow.com/questions/22575261/vagrant-stuck-connection-timeout-retrying\">连接超时问题</a></li>\n<li><a href=\"http://www.cnblogs.com/davenkin/p/vagrant-virtualbox.html\">Vagrant入门</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-3263c5e58700a808.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<blockquote>\n<p>之前安装的homestead系统版本为Ubuntu14.04，现业务需要，需升级为16.04，在虚拟机中直接升级完成后，无法启动。正好趁这个机会把所有需要升级的都升级一遍，全新安装并Laravel运行环境。</p>\n</blockquote>","more":"<h2 id=\"1-准备工作\"><a href=\"#1-准备工作\" class=\"headerlink\" title=\"1. 准备工作\"></a>1. 准备工作</h2><ol>\n<li>备份好数据后，彻底删除原来的运行环境，包括Homestead文件夹，虚拟机目录，.homestead 文件夹，box（<code>vagrant box remove boxname</code>）等。</li>\n<li>下载并安装 <a href=\"https://www.virtualbox.org/wiki/Downloads\">Virtualbox</a></li>\n<li>下载并安装 <a href=\"https://www.vagrantup.com/downloads.html\">vagrant</a></li>\n<li>下载homestead离线安装包 <a href=\"https://atlas.hashicorp.com/laravel/boxes/homestead/versions/2.0.0/providers/virtualbox.box\">virtualbox</a>，版本号的数字自行修改，如2.0.1 </li>\n<li>virtualbox 可启动，命令行中 <code>vagrant -v</code> 显示vagrant版本号，准备工作完成。</li>\n</ol>\n<h2 id=\"2-开始安装\"><a href=\"#2-开始安装\" class=\"headerlink\" title=\"2. 开始安装\"></a>2. 开始安装</h2><p><a href=\"http://www.golaravel.com/laravel/docs/5.0/homestead/\">官方文档</a>给出的安装方式为在线安装，蛋疼的网速想要在短时间内安装成功非常困难，所以这里采用离线安装方式。</p>\n<ol>\n<li><p>新建一个目录，我这里命名为 vagrant，将准备工作下载好的 virtualbox.box 拷贝到该目录下</p>\n</li>\n<li><p>添加box，这里步骤2与步骤3实现的效果一致，但步骤2添加成功后可能会有更新问题，<strong>推荐跳过此步骤直接执行步骤3</strong>.</p>\n<figure class=\"highlight plain\"><figcaption><span>box list```查看目前系统中已有的box，新加的box尽量不要与原有的box重名。</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    &#96;&#96;&#96;vagrant vagrant box add  laravel&#x2F;homestead virtualbox.box&#96;&#96;&#96;，如果box文件在当前目录下，直接添加文件即可，如果不在，需要写明全路径。</span><br><span class=\"line\">    </span><br><span class=\"line\">    看到success添加盒子就成功了。</span><br><span class=\"line\">3. 在virtualbox.box镜像所在目录创建metadata.json，输入以下内容</span><br></pre></td></tr></table></figure>\n<p> {</p>\n<pre><code> &quot;name&quot;: &quot;laravel/homestead&quot;,\n &quot;versions&quot;: [&#123;\n     &quot;version&quot;: &quot;2.0.0&quot;,\n     &quot;providers&quot;: [&#123;\n         &quot;name&quot;: &quot;virtualbox&quot;,\n         &quot;url&quot;: &quot;file://virtualbox.box&quot;\n     &#125;]\n &#125;]</code></pre>\n<p> }</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">其中，url最好写box的全路径。然后输入以下命令添加box</span><br></pre></td></tr></table></figure>\n<p> vagrant box add metadata.json</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看已安装的box</span><br></pre></td></tr></table></figure>\n<p> vagrant box list</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## 3. 克隆官方仓库</span><br><span class=\"line\">homestead，vagrant，virtualbox之间的关系梳理</span><br><span class=\"line\">1. homestead镜像就是laravel官方为了方便开发者，将一系列的开发环境、软件打包成一个镜像供大家使用，当前homestead包含[以下内容](https:&#x2F;&#x2F;laravel.com&#x2F;docs&#x2F;5.4&#x2F;homestead)：Ubuntu 16.04，Git，PHP 7.1，Nginx，MySQL，Postgres，Composer，Node (With Yarn, Bower, Grunt, Gulp) 等。</span><br><span class=\"line\">2. vagrant可以看作是对virtualbox或vmware的一个高级封装，本质就是调用了一些virtualbox和vmware开放出来的api</span><br><span class=\"line\">3. homestead git仓库呢则是laravel官方对于homestead虚拟机的一些配置文件，里面有一些方便的Linux脚本</span><br><span class=\"line\"></span><br><span class=\"line\">clone [版本库](https:&#x2F;&#x2F;github.com&#x2F;laravel&#x2F;homestead)</span><br></pre></td></tr></table></figure>\n<p>git clone <a href=\"https://github.com/laravel/homestead.git\">https://github.com/laravel/homestead.git</a> Homestead</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## 4. 配置 Homestead</span><br><span class=\"line\">1. 进入到clone的目录中运行 init.sh，这样就在家目录中生成一个.homestead 的目录，里面包含homestead虚拟机的配置文件 Homestead.yaml (homestead在github上的版本已更新到5.1，有一些文件发生了变动。最主要的变动是当运行init.bat或init.sh时候，几个文件将不再复制到家目录的.homestead文件，而是直接被复制到homestead项目的根目录中。原先家目录下的.homestead可以直接删掉了！)</span><br><span class=\"line\">2. 修改该文件</span><br></pre></td></tr></table></figure>\n<p> ip: “192.168.10.10”<br> memory: 2048<br> cpus: 1<br> provider: virtualbox</p>\n<p> authorize: ~/.ssh/id_rsa.pub</p>\n<p> keys:</p>\n<pre><code> - ~/.ssh/id_rsa</code></pre>\n<p> folders:</p>\n<pre><code> - map: /myCodeDir\n   to: /home/vagrant/www</code></pre>\n<p> sites:</p>\n<pre><code> - map: homestead.app\n   to: /home/vagrant/www/Laravel/public</code></pre>\n<p> databases:</p>\n<pre><code> - homestead</code></pre>\n<h1 id=\"blackfire\"><a href=\"#blackfire\" class=\"headerlink\" title=\"blackfire:\"></a>blackfire:</h1><h1 id=\"id-foo\"><a href=\"#id-foo\" class=\"headerlink\" title=\"- id: foo\"></a>- id: foo</h1><h1 id=\"token-bar\"><a href=\"#token-bar\" class=\"headerlink\" title=\"token: bar\"></a>token: bar</h1><h1 id=\"client-id-foo\"><a href=\"#client-id-foo\" class=\"headerlink\" title=\"client-id: foo\"></a>client-id: foo</h1><h1 id=\"client-token-bar\"><a href=\"#client-token-bar\" class=\"headerlink\" title=\"client-token: bar\"></a>client-token: bar</h1><h1 id=\"ports\"><a href=\"#ports\" class=\"headerlink\" title=\"ports:\"></a>ports:</h1><h1 id=\"send-50000\"><a href=\"#send-50000\" class=\"headerlink\" title=\"- send: 50000\"></a>- send: 50000</h1><h1 id=\"to-5000\"><a href=\"#to-5000\" class=\"headerlink\" title=\"to: 5000\"></a>to: 5000</h1><h1 id=\"send-7777\"><a href=\"#send-7777\" class=\"headerlink\" title=\"- send: 7777\"></a>- send: 7777</h1><h1 id=\"to-777\"><a href=\"#to-777\" class=\"headerlink\" title=\"to: 777\"></a>to: 777</h1><h1 id=\"protocol-udp\"><a href=\"#protocol-udp\" class=\"headerlink\" title=\"protocol: udp\"></a>protocol: udp</h1> <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">主要需要改动的就是 folders这一项，将本机的一个目录共享给虚拟机。</span><br><span class=\"line\">rsa 公钥私钥路径一定要对，不然无法启动，没有的话通过git bash或其他Linux环境输入以下命令生成</span><br></pre></td></tr></table></figure>\n<p> ssh-keygen -t rsa -C “vagrant@homestead”</p>\n<pre><code></code></pre>\n</li>\n</ol>\n<h2 id=\"5-启动-homestead\"><a href=\"#5-启动-homestead\" class=\"headerlink\" title=\"5. 启动 homestead\"></a>5. 启动 homestead</h2><ol>\n<li>进入到homestead目录(git clone的那个) <code>vagrant up</code>，耐心等待一会就可以。</li>\n<li>修改本地的hosts文件，添加homestead虚拟机的DNS</li>\n<li>没有报错就正常启动了。 输入命令 <code>vagrant ssh</code>进入虚拟机。</li>\n<li>升级，配置nginx等。</li>\n</ol>\n<h2 id=\"6-参考资料\"><a href=\"#6-参考资料\" class=\"headerlink\" title=\"6. 参考资料\"></a>6. 参考资料</h2><ol>\n<li><a href=\"https://www.alwayscoder.com/offline-install-laravel-homestead/\">离线安装&amp;配置laravel开发环境homestead\n</a></li>\n<li><a href=\"http://stackoverflow.com/questions/22922891/vagrant-ssh-authentication-failure\">私钥问题</a></li>\n<li><a href=\"http://stackoverflow.com/questions/22575261/vagrant-stuck-connection-timeout-retrying\">连接超时问题</a></li>\n<li><a href=\"http://www.cnblogs.com/davenkin/p/vagrant-virtualbox.html\">Vagrant入门</a></li>\n</ol>"},{"title":"几个PHP数组处理方法 & 几个常用的其他方法","date":"2017-12-05T08:45:37.000Z","_content":"\n记录几个常用的处理PHP数组的方法，方便查用。\n1. 二维数组按某一字段去重\n2. 二维数组按多个字段去重\n2. 二维数组按某一字段排序\n3. 二维数组按多个字段排序\n\n<!-- more -->\n\n## 1. 二维数组按某一字段去重\n\n```\n/**\n * @comment 二维数组按某一字段去重\n * @param array $arr\n * @param string $field\n * @return array\n * @author zzp\n * @date 2017-12-05\n */\nfunction getUniqueFromTwoDimensionalArray($arr, $field)\n{\n    $result = [];\n    foreach ($arr as $item) {\n        if (is_array($item)) {\n            $rKey = $item[$field];\n        } else {\n            $rKey = $item->$field;\n        }\n        $result[$rKey] = $item;\n    }\n\n    return array_values($result);\n}\n\n```\n\n\n## 2. 二维数组按多个字段去重\n\n```\n/**\n * @comment 二维数组/对象按一个/多个字段去重\n * @param array|object $arr\n * @param string|array $filed\n * @return array\n * @author zzp\n * @date 2017-12-14\n */\nfunction getUniqueArr($arr, $filed)\n{\n    $result = [];\n    if (is_string($filed)) {\n        $filed = [$filed];\n    }\n\n    foreach ($arr as $item) {\n        if (is_array($item)) {\n            $rKey = '';\n            foreach ($filed as $key) {\n                $rKey .= md5($item[$key]);\n            }\n        } else {\n            // 对象\n            $rKey = '';\n            foreach ($filed as $key) {\n                $rKey .= md5($item->$key);\n            }\n        }\n        $result[$rKey] = $item;\n    }\n\n    return array_values($result);\n}\n```\n\n## 3. 二维数组按某一字段排序\n\n```\n/**\n * @comment 二维数组排序\n * 用法：sortTwoDimensionalArray($arr, $filed, $direction = 'SORT_DESC')\n * @param array $arr\n * @param string $filed 排序字段\n * @param string $direction 排序顺序标志 SORT_DESC 降序；SORT_ASC 升序\n * @author zzp\n * @date 2017-12-05\n */\nfunction sortTwoDimensionalArray($arr, $filed, $direction = 'SORT_DESC')\n{\n    $args = func_get_args();\n    $arrSort = [];\n    foreach ($arr AS $uniqid => $row) {\n        foreach ($row AS $key => $value) {\n            $arrSort[$key][$uniqid] = $value;\n        }\n    }\n    if ($direction) {\n        array_multisort($arrSort[$filed], constant($direction), $arr);\n    }\n\n    return $arr;\n}\n```\n\n## 4. 二维数组按多个字段排序\n\n```\n/**\n * @comment 二维数组根据多个字段排序，类似mysql中的多个 order by\n * 用法： sortArrByManyField($arr, 'age', SORT_DESC, 'id', SORT_ASC, 'id', SORT_DESC)\n * @return mixed|null\n * @throws Exception\n * @author zzp\n * @date 2017-12-05\n */\nfunction sortArrByManyField()\n{\n    $args = func_get_args();\n    if (empty($args)) {\n        return null;\n    }\n    $arr = array_shift($args);\n    if (!is_array($arr)) {\n        throw new Exception(\"第一个参数不为数组\");\n    }\n\n    foreach ($args as $key => $field) {\n        if (is_string($field)) {\n            $temp = [];\n            foreach ($arr as $index => $val) {\n                $temp[$index] = $val[$field];\n            }\n            $args[$key] = $temp;\n        }\n    }\n    $args[] = &$arr; // 引用值\n    call_user_func_array('array_multisort', $args);\n    return array_pop($args);\n}\n```\n\n\n## 5. 如果路径不存在，自动创建\n\n```\n/**\n * 如果路径不存在，自动创建\n * @param $filePath\n * User: zzp\n * Date: 2017-03-13\n * @return bool\n */\nfunction autoMakeDir($filePath)\n{\n    if (!file_exists($filePath)) {\n        mkdir($filePath, 0777, true);\n    }\n}\n\n```\n\n## 6. 自动删除文件 \n\n```\nfunction autoUnlink($file)\n{\n    if (file_exists($file)) {\n        unlink($file);\n    }\n}\n\n```\n\n\n## 7. 获取IP地址\n\n由于服务器nginx代理的缘故 先通过 header 拿到真实ip\n```\nfunction getClientIp()\n{\n    if (isset($_SERVER['HTTP_X_REAL_IP'])) {\n        return $_SERVER['HTTP_X_REAL_IP'];\n    } elseif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n        return $_SERVER['HTTP_X_FORWARDED_FOR'];\n    }\n\n    return request()->getClientIp();\n}\n\n```\n\n## 8. 递归显示当前指定目录下所有文件\n\n```\n/**\n * 使用dir函数\n * @param string $dir 目录地址\n * @param boolean $recursion 是否递归\n * @return array $files 文件列表\n */\nfunction getFiles($dir, $recursion = false)\n{\n    $files = array();\n\n    if (!is_dir($dir)) {\n        return $files;\n    }\n\n    $d = dir($dir);\n    while (false !== ($file = $d->read())) {\n        if ($file != '.' && $file != '..') {\n            $filename = $dir . \"/\" . $file;\n\n            if (is_file($filename)) {\n                $files[] = $filename;\n            } else {\n                if ($recursion) {\n                    $files = array_merge($files, getFiles($filename, $recursion));\n                }\n            }\n        }\n    }\n    $d->close();\n    return $files;\n}\n\n```\n\n\n## 9. 文章的分享内容\n\n```\nfunction getShareContent($str, $length = 0)\n{\n    // 把 video 标签中的 \"你的浏览器不支持Video标签\" 文字去掉\n    $pattern = '/<video[\\s\\S]*<\\/video>/';\n    $str = preg_replace($pattern, '', $str);\n    $str = html_entity_decode(strip_tags($str));\n    $str = str_replace(PHP_EOL, '', $str);\n    $strArray = array(\" \", \"　\", \"\\t\", \"\\n\", \"\\r\", \"&hellip;\", \"&mdash;\");\n    $str = str_replace($strArray, '', $str);\n    $str = str_replace(\"'\", '\"', $str);\n    $str = trim(str_replace(chr(194) . chr(160), '', $str)); //shungao20171124 修复UFT8转码特殊字符问题\n    if (empty($length) && mb_strlen($str) > 120) {\n        $str = mb_substr($str, 0, 120, 'utf-8') . '...';\n    }\n    if (empty($str)) {\n        $str = '来自...';\n    }\n    return $str;\n}\n\n```\n\n## 10. 是否为微信内\n\n```\nfunction isWechat()\n{\n    $ua = isset($_SERVER['HTTP_USER_AGENT']) ? $_SERVER['HTTP_USER_AGENT'] : \"\";\n    return true == strpos($ua, 'MicroMessenger');\n}\n\n```\n\n\n## 11. mm\n\n```\nif (!function_exists('mm')) {\n    /**\n     * Dump the passed variables and end the script.\n     *\n     * @param  mixed\n     * @return void\n     */\n    function mm()\n    {\n        array_map(function ($x) {\n            (new \\Illuminate\\Support\\Debug\\Dumper)->dump($x);\n        }, func_get_args());\n    }\n}\n\n```\n\n## 12. is_empty\n\n```\nif (!function_exists('is_empty')) {\n    function is_empty($obj)\n    {\n        if (empty($obj)) {\n            return true;\n        }\n\n        if ($obj instanceof Illuminate\\Support\\Collection) {\n            $items = $obj->all();\n            return empty($items);\n        }\n        return false;\n    }\n}\n\n```\n\n## 13. 字符串转16进制\n\n```\n/**\n * @comment 字符串转16进制\n * @param $string\n * @return string\n * @author zzp\n * @date 2017-12-12\n */\nfunction strToHex($string)\n{\n    $hex = '';\n    for ($i = 0; $i < strlen($string); $i++) {\n        $ord = ord($string[$i]);\n        $hexCode = dechex($ord);\n        $hex .= substr('0' . $hexCode, -2);\n    }\n    return strToUpper($hex);\n}\n```\n\n## 14. 判断两个时间段是否有重叠\n```\n// https://jjyy.de/post/judge-two-date-range-is-overlap.html\nfunction timeIsOverlap($timeAStart, $timeAEnd, $timeBStart, $timeBEnd)\n{\n    return !($timeAEnd < $timeBStart || $timeBEnd < $timeAStart);\n}\n```\n\n","source":"_posts/几个PHP数组处理方法.md","raw":"---\ntitle: 几个PHP数组处理方法 & 几个常用的其他方法\ndate: 2017-12-05 16:45:37\ntags: PHP\ncategories: PHP\n---\n\n记录几个常用的处理PHP数组的方法，方便查用。\n1. 二维数组按某一字段去重\n2. 二维数组按多个字段去重\n2. 二维数组按某一字段排序\n3. 二维数组按多个字段排序\n\n<!-- more -->\n\n## 1. 二维数组按某一字段去重\n\n```\n/**\n * @comment 二维数组按某一字段去重\n * @param array $arr\n * @param string $field\n * @return array\n * @author zzp\n * @date 2017-12-05\n */\nfunction getUniqueFromTwoDimensionalArray($arr, $field)\n{\n    $result = [];\n    foreach ($arr as $item) {\n        if (is_array($item)) {\n            $rKey = $item[$field];\n        } else {\n            $rKey = $item->$field;\n        }\n        $result[$rKey] = $item;\n    }\n\n    return array_values($result);\n}\n\n```\n\n\n## 2. 二维数组按多个字段去重\n\n```\n/**\n * @comment 二维数组/对象按一个/多个字段去重\n * @param array|object $arr\n * @param string|array $filed\n * @return array\n * @author zzp\n * @date 2017-12-14\n */\nfunction getUniqueArr($arr, $filed)\n{\n    $result = [];\n    if (is_string($filed)) {\n        $filed = [$filed];\n    }\n\n    foreach ($arr as $item) {\n        if (is_array($item)) {\n            $rKey = '';\n            foreach ($filed as $key) {\n                $rKey .= md5($item[$key]);\n            }\n        } else {\n            // 对象\n            $rKey = '';\n            foreach ($filed as $key) {\n                $rKey .= md5($item->$key);\n            }\n        }\n        $result[$rKey] = $item;\n    }\n\n    return array_values($result);\n}\n```\n\n## 3. 二维数组按某一字段排序\n\n```\n/**\n * @comment 二维数组排序\n * 用法：sortTwoDimensionalArray($arr, $filed, $direction = 'SORT_DESC')\n * @param array $arr\n * @param string $filed 排序字段\n * @param string $direction 排序顺序标志 SORT_DESC 降序；SORT_ASC 升序\n * @author zzp\n * @date 2017-12-05\n */\nfunction sortTwoDimensionalArray($arr, $filed, $direction = 'SORT_DESC')\n{\n    $args = func_get_args();\n    $arrSort = [];\n    foreach ($arr AS $uniqid => $row) {\n        foreach ($row AS $key => $value) {\n            $arrSort[$key][$uniqid] = $value;\n        }\n    }\n    if ($direction) {\n        array_multisort($arrSort[$filed], constant($direction), $arr);\n    }\n\n    return $arr;\n}\n```\n\n## 4. 二维数组按多个字段排序\n\n```\n/**\n * @comment 二维数组根据多个字段排序，类似mysql中的多个 order by\n * 用法： sortArrByManyField($arr, 'age', SORT_DESC, 'id', SORT_ASC, 'id', SORT_DESC)\n * @return mixed|null\n * @throws Exception\n * @author zzp\n * @date 2017-12-05\n */\nfunction sortArrByManyField()\n{\n    $args = func_get_args();\n    if (empty($args)) {\n        return null;\n    }\n    $arr = array_shift($args);\n    if (!is_array($arr)) {\n        throw new Exception(\"第一个参数不为数组\");\n    }\n\n    foreach ($args as $key => $field) {\n        if (is_string($field)) {\n            $temp = [];\n            foreach ($arr as $index => $val) {\n                $temp[$index] = $val[$field];\n            }\n            $args[$key] = $temp;\n        }\n    }\n    $args[] = &$arr; // 引用值\n    call_user_func_array('array_multisort', $args);\n    return array_pop($args);\n}\n```\n\n\n## 5. 如果路径不存在，自动创建\n\n```\n/**\n * 如果路径不存在，自动创建\n * @param $filePath\n * User: zzp\n * Date: 2017-03-13\n * @return bool\n */\nfunction autoMakeDir($filePath)\n{\n    if (!file_exists($filePath)) {\n        mkdir($filePath, 0777, true);\n    }\n}\n\n```\n\n## 6. 自动删除文件 \n\n```\nfunction autoUnlink($file)\n{\n    if (file_exists($file)) {\n        unlink($file);\n    }\n}\n\n```\n\n\n## 7. 获取IP地址\n\n由于服务器nginx代理的缘故 先通过 header 拿到真实ip\n```\nfunction getClientIp()\n{\n    if (isset($_SERVER['HTTP_X_REAL_IP'])) {\n        return $_SERVER['HTTP_X_REAL_IP'];\n    } elseif (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {\n        return $_SERVER['HTTP_X_FORWARDED_FOR'];\n    }\n\n    return request()->getClientIp();\n}\n\n```\n\n## 8. 递归显示当前指定目录下所有文件\n\n```\n/**\n * 使用dir函数\n * @param string $dir 目录地址\n * @param boolean $recursion 是否递归\n * @return array $files 文件列表\n */\nfunction getFiles($dir, $recursion = false)\n{\n    $files = array();\n\n    if (!is_dir($dir)) {\n        return $files;\n    }\n\n    $d = dir($dir);\n    while (false !== ($file = $d->read())) {\n        if ($file != '.' && $file != '..') {\n            $filename = $dir . \"/\" . $file;\n\n            if (is_file($filename)) {\n                $files[] = $filename;\n            } else {\n                if ($recursion) {\n                    $files = array_merge($files, getFiles($filename, $recursion));\n                }\n            }\n        }\n    }\n    $d->close();\n    return $files;\n}\n\n```\n\n\n## 9. 文章的分享内容\n\n```\nfunction getShareContent($str, $length = 0)\n{\n    // 把 video 标签中的 \"你的浏览器不支持Video标签\" 文字去掉\n    $pattern = '/<video[\\s\\S]*<\\/video>/';\n    $str = preg_replace($pattern, '', $str);\n    $str = html_entity_decode(strip_tags($str));\n    $str = str_replace(PHP_EOL, '', $str);\n    $strArray = array(\" \", \"　\", \"\\t\", \"\\n\", \"\\r\", \"&hellip;\", \"&mdash;\");\n    $str = str_replace($strArray, '', $str);\n    $str = str_replace(\"'\", '\"', $str);\n    $str = trim(str_replace(chr(194) . chr(160), '', $str)); //shungao20171124 修复UFT8转码特殊字符问题\n    if (empty($length) && mb_strlen($str) > 120) {\n        $str = mb_substr($str, 0, 120, 'utf-8') . '...';\n    }\n    if (empty($str)) {\n        $str = '来自...';\n    }\n    return $str;\n}\n\n```\n\n## 10. 是否为微信内\n\n```\nfunction isWechat()\n{\n    $ua = isset($_SERVER['HTTP_USER_AGENT']) ? $_SERVER['HTTP_USER_AGENT'] : \"\";\n    return true == strpos($ua, 'MicroMessenger');\n}\n\n```\n\n\n## 11. mm\n\n```\nif (!function_exists('mm')) {\n    /**\n     * Dump the passed variables and end the script.\n     *\n     * @param  mixed\n     * @return void\n     */\n    function mm()\n    {\n        array_map(function ($x) {\n            (new \\Illuminate\\Support\\Debug\\Dumper)->dump($x);\n        }, func_get_args());\n    }\n}\n\n```\n\n## 12. is_empty\n\n```\nif (!function_exists('is_empty')) {\n    function is_empty($obj)\n    {\n        if (empty($obj)) {\n            return true;\n        }\n\n        if ($obj instanceof Illuminate\\Support\\Collection) {\n            $items = $obj->all();\n            return empty($items);\n        }\n        return false;\n    }\n}\n\n```\n\n## 13. 字符串转16进制\n\n```\n/**\n * @comment 字符串转16进制\n * @param $string\n * @return string\n * @author zzp\n * @date 2017-12-12\n */\nfunction strToHex($string)\n{\n    $hex = '';\n    for ($i = 0; $i < strlen($string); $i++) {\n        $ord = ord($string[$i]);\n        $hexCode = dechex($ord);\n        $hex .= substr('0' . $hexCode, -2);\n    }\n    return strToUpper($hex);\n}\n```\n\n## 14. 判断两个时间段是否有重叠\n```\n// https://jjyy.de/post/judge-two-date-range-is-overlap.html\nfunction timeIsOverlap($timeAStart, $timeAEnd, $timeBStart, $timeBEnd)\n{\n    return !($timeAEnd < $timeBStart || $timeBEnd < $timeAStart);\n}\n```\n\n","slug":"几个PHP数组处理方法","published":1,"updated":"2020-09-11T01:04:35.048Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9s003f6wo1a49vgkd3","content":"<p>记录几个常用的处理PHP数组的方法，方便查用。</p>\n<ol>\n<li>二维数组按某一字段去重</li>\n<li>二维数组按多个字段去重</li>\n<li>二维数组按某一字段排序</li>\n<li>二维数组按多个字段排序</li>\n</ol>\n<a id=\"more\"></a>\n\n<h2 id=\"1-二维数组按某一字段去重\"><a href=\"#1-二维数组按某一字段去重\" class=\"headerlink\" title=\"1. 二维数组按某一字段去重\"></a>1. 二维数组按某一字段去重</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组按某一字段去重</span><br><span class=\"line\"> * @param array $arr</span><br><span class=\"line\"> * @param string $field</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-05</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function getUniqueFromTwoDimensionalArray($arr, $field)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $result &#x3D; [];</span><br><span class=\"line\">    foreach ($arr as $item) &#123;</span><br><span class=\"line\">        if (is_array($item)) &#123;</span><br><span class=\"line\">            $rKey &#x3D; $item[$field];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $rKey &#x3D; $item-&gt;$field;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result[$rKey] &#x3D; $item;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return array_values($result);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"2-二维数组按多个字段去重\"><a href=\"#2-二维数组按多个字段去重\" class=\"headerlink\" title=\"2. 二维数组按多个字段去重\"></a>2. 二维数组按多个字段去重</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组&#x2F;对象按一个&#x2F;多个字段去重</span><br><span class=\"line\"> * @param array|object $arr</span><br><span class=\"line\"> * @param string|array $filed</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-14</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function getUniqueArr($arr, $filed)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $result &#x3D; [];</span><br><span class=\"line\">    if (is_string($filed)) &#123;</span><br><span class=\"line\">        $filed &#x3D; [$filed];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    foreach ($arr as $item) &#123;</span><br><span class=\"line\">        if (is_array($item)) &#123;</span><br><span class=\"line\">            $rKey &#x3D; &#39;&#39;;</span><br><span class=\"line\">            foreach ($filed as $key) &#123;</span><br><span class=\"line\">                $rKey .&#x3D; md5($item[$key]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; 对象</span><br><span class=\"line\">            $rKey &#x3D; &#39;&#39;;</span><br><span class=\"line\">            foreach ($filed as $key) &#123;</span><br><span class=\"line\">                $rKey .&#x3D; md5($item-&gt;$key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result[$rKey] &#x3D; $item;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return array_values($result);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-二维数组按某一字段排序\"><a href=\"#3-二维数组按某一字段排序\" class=\"headerlink\" title=\"3. 二维数组按某一字段排序\"></a>3. 二维数组按某一字段排序</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组排序</span><br><span class=\"line\"> * 用法：sortTwoDimensionalArray($arr, $filed, $direction &#x3D; &#39;SORT_DESC&#39;)</span><br><span class=\"line\"> * @param array $arr</span><br><span class=\"line\"> * @param string $filed 排序字段</span><br><span class=\"line\"> * @param string $direction 排序顺序标志 SORT_DESC 降序；SORT_ASC 升序</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-05</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function sortTwoDimensionalArray($arr, $filed, $direction &#x3D; &#39;SORT_DESC&#39;)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $args &#x3D; func_get_args();</span><br><span class=\"line\">    $arrSort &#x3D; [];</span><br><span class=\"line\">    foreach ($arr AS $uniqid &#x3D;&gt; $row) &#123;</span><br><span class=\"line\">        foreach ($row AS $key &#x3D;&gt; $value) &#123;</span><br><span class=\"line\">            $arrSort[$key][$uniqid] &#x3D; $value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if ($direction) &#123;</span><br><span class=\"line\">        array_multisort($arrSort[$filed], constant($direction), $arr);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $arr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-二维数组按多个字段排序\"><a href=\"#4-二维数组按多个字段排序\" class=\"headerlink\" title=\"4. 二维数组按多个字段排序\"></a>4. 二维数组按多个字段排序</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组根据多个字段排序，类似mysql中的多个 order by</span><br><span class=\"line\"> * 用法： sortArrByManyField($arr, &#39;age&#39;, SORT_DESC, &#39;id&#39;, SORT_ASC, &#39;id&#39;, SORT_DESC)</span><br><span class=\"line\"> * @return mixed|null</span><br><span class=\"line\"> * @throws Exception</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-05</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function sortArrByManyField()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $args &#x3D; func_get_args();</span><br><span class=\"line\">    if (empty($args)) &#123;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $arr &#x3D; array_shift($args);</span><br><span class=\"line\">    if (!is_array($arr)) &#123;</span><br><span class=\"line\">        throw new Exception(&quot;第一个参数不为数组&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    foreach ($args as $key &#x3D;&gt; $field) &#123;</span><br><span class=\"line\">        if (is_string($field)) &#123;</span><br><span class=\"line\">            $temp &#x3D; [];</span><br><span class=\"line\">            foreach ($arr as $index &#x3D;&gt; $val) &#123;</span><br><span class=\"line\">                $temp[$index] &#x3D; $val[$field];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $args[$key] &#x3D; $temp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $args[] &#x3D; &amp;$arr; &#x2F;&#x2F; 引用值</span><br><span class=\"line\">    call_user_func_array(&#39;array_multisort&#39;, $args);</span><br><span class=\"line\">    return array_pop($args);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"5-如果路径不存在，自动创建\"><a href=\"#5-如果路径不存在，自动创建\" class=\"headerlink\" title=\"5. 如果路径不存在，自动创建\"></a>5. 如果路径不存在，自动创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 如果路径不存在，自动创建</span><br><span class=\"line\"> * @param $filePath</span><br><span class=\"line\"> * User: zzp</span><br><span class=\"line\"> * Date: 2017-03-13</span><br><span class=\"line\"> * @return bool</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function autoMakeDir($filePath)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (!file_exists($filePath)) &#123;</span><br><span class=\"line\">        mkdir($filePath, 0777, true);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-自动删除文件\"><a href=\"#6-自动删除文件\" class=\"headerlink\" title=\"6. 自动删除文件\"></a>6. 自动删除文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function autoUnlink($file)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (file_exists($file)) &#123;</span><br><span class=\"line\">        unlink($file);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"7-获取IP地址\"><a href=\"#7-获取IP地址\" class=\"headerlink\" title=\"7. 获取IP地址\"></a>7. 获取IP地址</h2><p>由于服务器nginx代理的缘故 先通过 header 拿到真实ip</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getClientIp()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (isset($_SERVER[&#39;HTTP_X_REAL_IP&#39;])) &#123;</span><br><span class=\"line\">        return $_SERVER[&#39;HTTP_X_REAL_IP&#39;];</span><br><span class=\"line\">    &#125; elseif (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;</span><br><span class=\"line\">        return $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return request()-&gt;getClientIp();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-递归显示当前指定目录下所有文件\"><a href=\"#8-递归显示当前指定目录下所有文件\" class=\"headerlink\" title=\"8. 递归显示当前指定目录下所有文件\"></a>8. 递归显示当前指定目录下所有文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 使用dir函数</span><br><span class=\"line\"> * @param string $dir 目录地址</span><br><span class=\"line\"> * @param boolean $recursion 是否递归</span><br><span class=\"line\"> * @return array $files 文件列表</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function getFiles($dir, $recursion &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $files &#x3D; array();</span><br><span class=\"line\"></span><br><span class=\"line\">    if (!is_dir($dir)) &#123;</span><br><span class=\"line\">        return $files;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $d &#x3D; dir($dir);</span><br><span class=\"line\">    while (false !&#x3D;&#x3D; ($file &#x3D; $d-&gt;read())) &#123;</span><br><span class=\"line\">        if ($file !&#x3D; &#39;.&#39; &amp;&amp; $file !&#x3D; &#39;..&#39;) &#123;</span><br><span class=\"line\">            $filename &#x3D; $dir . &quot;&#x2F;&quot; . $file;</span><br><span class=\"line\"></span><br><span class=\"line\">            if (is_file($filename)) &#123;</span><br><span class=\"line\">                $files[] &#x3D; $filename;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                if ($recursion) &#123;</span><br><span class=\"line\">                    $files &#x3D; array_merge($files, getFiles($filename, $recursion));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $d-&gt;close();</span><br><span class=\"line\">    return $files;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"9-文章的分享内容\"><a href=\"#9-文章的分享内容\" class=\"headerlink\" title=\"9. 文章的分享内容\"></a>9. 文章的分享内容</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getShareContent($str, $length &#x3D; 0)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 把 video 标签中的 &quot;你的浏览器不支持Video标签&quot; 文字去掉</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;&lt;video[\\s\\S]*&lt;\\&#x2F;video&gt;&#x2F;&#39;;</span><br><span class=\"line\">    $str &#x3D; preg_replace($pattern, &#39;&#39;, $str);</span><br><span class=\"line\">    $str &#x3D; html_entity_decode(strip_tags($str));</span><br><span class=\"line\">    $str &#x3D; str_replace(PHP_EOL, &#39;&#39;, $str);</span><br><span class=\"line\">    $strArray &#x3D; array(&quot; &quot;, &quot;　&quot;, &quot;\\t&quot;, &quot;\\n&quot;, &quot;\\r&quot;, &quot;&amp;hellip;&quot;, &quot;&amp;mdash;&quot;);</span><br><span class=\"line\">    $str &#x3D; str_replace($strArray, &#39;&#39;, $str);</span><br><span class=\"line\">    $str &#x3D; str_replace(&quot;&#39;&quot;, &#39;&quot;&#39;, $str);</span><br><span class=\"line\">    $str &#x3D; trim(str_replace(chr(194) . chr(160), &#39;&#39;, $str)); &#x2F;&#x2F;shungao20171124 修复UFT8转码特殊字符问题</span><br><span class=\"line\">    if (empty($length) &amp;&amp; mb_strlen($str) &gt; 120) &#123;</span><br><span class=\"line\">        $str &#x3D; mb_substr($str, 0, 120, &#39;utf-8&#39;) . &#39;...&#39;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (empty($str)) &#123;</span><br><span class=\"line\">        $str &#x3D; &#39;来自...&#39;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $str;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-是否为微信内\"><a href=\"#10-是否为微信内\" class=\"headerlink\" title=\"10. 是否为微信内\"></a>10. 是否为微信内</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function isWechat()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $ua &#x3D; isset($_SERVER[&#39;HTTP_USER_AGENT&#39;]) ? $_SERVER[&#39;HTTP_USER_AGENT&#39;] : &quot;&quot;;</span><br><span class=\"line\">    return true &#x3D;&#x3D; strpos($ua, &#39;MicroMessenger&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"11-mm\"><a href=\"#11-mm\" class=\"headerlink\" title=\"11. mm\"></a>11. mm</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!function_exists(&#39;mm&#39;)) &#123;</span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * Dump the passed variables and end the script.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param  mixed</span><br><span class=\"line\">     * @return void</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    function mm()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        array_map(function ($x) &#123;</span><br><span class=\"line\">            (new \\Illuminate\\Support\\Debug\\Dumper)-&gt;dump($x);</span><br><span class=\"line\">        &#125;, func_get_args());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"12-is-empty\"><a href=\"#12-is-empty\" class=\"headerlink\" title=\"12. is_empty\"></a>12. is_empty</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!function_exists(&#39;is_empty&#39;)) &#123;</span><br><span class=\"line\">    function is_empty($obj)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        if (empty($obj)) &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        if ($obj instanceof Illuminate\\Support\\Collection) &#123;</span><br><span class=\"line\">            $items &#x3D; $obj-&gt;all();</span><br><span class=\"line\">            return empty($items);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"13-字符串转16进制\"><a href=\"#13-字符串转16进制\" class=\"headerlink\" title=\"13. 字符串转16进制\"></a>13. 字符串转16进制</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 字符串转16进制</span><br><span class=\"line\"> * @param $string</span><br><span class=\"line\"> * @return string</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-12</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function strToHex($string)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $hex &#x3D; &#39;&#39;;</span><br><span class=\"line\">    for ($i &#x3D; 0; $i &lt; strlen($string); $i++) &#123;</span><br><span class=\"line\">        $ord &#x3D; ord($string[$i]);</span><br><span class=\"line\">        $hexCode &#x3D; dechex($ord);</span><br><span class=\"line\">        $hex .&#x3D; substr(&#39;0&#39; . $hexCode, -2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return strToUpper($hex);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"14-判断两个时间段是否有重叠\"><a href=\"#14-判断两个时间段是否有重叠\" class=\"headerlink\" title=\"14. 判断两个时间段是否有重叠\"></a>14. 判断两个时间段是否有重叠</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; https:&#x2F;&#x2F;jjyy.de&#x2F;post&#x2F;judge-two-date-range-is-overlap.html</span><br><span class=\"line\">function timeIsOverlap($timeAStart, $timeAEnd, $timeBStart, $timeBEnd)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    return !($timeAEnd &lt; $timeBStart || $timeBEnd &lt; $timeAStart);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"<p>记录几个常用的处理PHP数组的方法，方便查用。</p>\n<ol>\n<li>二维数组按某一字段去重</li>\n<li>二维数组按多个字段去重</li>\n<li>二维数组按某一字段排序</li>\n<li>二维数组按多个字段排序</li>\n</ol>","more":"<h2 id=\"1-二维数组按某一字段去重\"><a href=\"#1-二维数组按某一字段去重\" class=\"headerlink\" title=\"1. 二维数组按某一字段去重\"></a>1. 二维数组按某一字段去重</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组按某一字段去重</span><br><span class=\"line\"> * @param array $arr</span><br><span class=\"line\"> * @param string $field</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-05</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function getUniqueFromTwoDimensionalArray($arr, $field)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $result &#x3D; [];</span><br><span class=\"line\">    foreach ($arr as $item) &#123;</span><br><span class=\"line\">        if (is_array($item)) &#123;</span><br><span class=\"line\">            $rKey &#x3D; $item[$field];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $rKey &#x3D; $item-&gt;$field;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result[$rKey] &#x3D; $item;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return array_values($result);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"2-二维数组按多个字段去重\"><a href=\"#2-二维数组按多个字段去重\" class=\"headerlink\" title=\"2. 二维数组按多个字段去重\"></a>2. 二维数组按多个字段去重</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组&#x2F;对象按一个&#x2F;多个字段去重</span><br><span class=\"line\"> * @param array|object $arr</span><br><span class=\"line\"> * @param string|array $filed</span><br><span class=\"line\"> * @return array</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-14</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function getUniqueArr($arr, $filed)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $result &#x3D; [];</span><br><span class=\"line\">    if (is_string($filed)) &#123;</span><br><span class=\"line\">        $filed &#x3D; [$filed];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    foreach ($arr as $item) &#123;</span><br><span class=\"line\">        if (is_array($item)) &#123;</span><br><span class=\"line\">            $rKey &#x3D; &#39;&#39;;</span><br><span class=\"line\">            foreach ($filed as $key) &#123;</span><br><span class=\"line\">                $rKey .&#x3D; md5($item[$key]);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; 对象</span><br><span class=\"line\">            $rKey &#x3D; &#39;&#39;;</span><br><span class=\"line\">            foreach ($filed as $key) &#123;</span><br><span class=\"line\">                $rKey .&#x3D; md5($item-&gt;$key);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        $result[$rKey] &#x3D; $item;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return array_values($result);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-二维数组按某一字段排序\"><a href=\"#3-二维数组按某一字段排序\" class=\"headerlink\" title=\"3. 二维数组按某一字段排序\"></a>3. 二维数组按某一字段排序</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组排序</span><br><span class=\"line\"> * 用法：sortTwoDimensionalArray($arr, $filed, $direction &#x3D; &#39;SORT_DESC&#39;)</span><br><span class=\"line\"> * @param array $arr</span><br><span class=\"line\"> * @param string $filed 排序字段</span><br><span class=\"line\"> * @param string $direction 排序顺序标志 SORT_DESC 降序；SORT_ASC 升序</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-05</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function sortTwoDimensionalArray($arr, $filed, $direction &#x3D; &#39;SORT_DESC&#39;)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $args &#x3D; func_get_args();</span><br><span class=\"line\">    $arrSort &#x3D; [];</span><br><span class=\"line\">    foreach ($arr AS $uniqid &#x3D;&gt; $row) &#123;</span><br><span class=\"line\">        foreach ($row AS $key &#x3D;&gt; $value) &#123;</span><br><span class=\"line\">            $arrSort[$key][$uniqid] &#x3D; $value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if ($direction) &#123;</span><br><span class=\"line\">        array_multisort($arrSort[$filed], constant($direction), $arr);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $arr;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-二维数组按多个字段排序\"><a href=\"#4-二维数组按多个字段排序\" class=\"headerlink\" title=\"4. 二维数组按多个字段排序\"></a>4. 二维数组按多个字段排序</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 二维数组根据多个字段排序，类似mysql中的多个 order by</span><br><span class=\"line\"> * 用法： sortArrByManyField($arr, &#39;age&#39;, SORT_DESC, &#39;id&#39;, SORT_ASC, &#39;id&#39;, SORT_DESC)</span><br><span class=\"line\"> * @return mixed|null</span><br><span class=\"line\"> * @throws Exception</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-05</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function sortArrByManyField()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $args &#x3D; func_get_args();</span><br><span class=\"line\">    if (empty($args)) &#123;</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $arr &#x3D; array_shift($args);</span><br><span class=\"line\">    if (!is_array($arr)) &#123;</span><br><span class=\"line\">        throw new Exception(&quot;第一个参数不为数组&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    foreach ($args as $key &#x3D;&gt; $field) &#123;</span><br><span class=\"line\">        if (is_string($field)) &#123;</span><br><span class=\"line\">            $temp &#x3D; [];</span><br><span class=\"line\">            foreach ($arr as $index &#x3D;&gt; $val) &#123;</span><br><span class=\"line\">                $temp[$index] &#x3D; $val[$field];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $args[$key] &#x3D; $temp;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $args[] &#x3D; &amp;$arr; &#x2F;&#x2F; 引用值</span><br><span class=\"line\">    call_user_func_array(&#39;array_multisort&#39;, $args);</span><br><span class=\"line\">    return array_pop($args);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"5-如果路径不存在，自动创建\"><a href=\"#5-如果路径不存在，自动创建\" class=\"headerlink\" title=\"5. 如果路径不存在，自动创建\"></a>5. 如果路径不存在，自动创建</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 如果路径不存在，自动创建</span><br><span class=\"line\"> * @param $filePath</span><br><span class=\"line\"> * User: zzp</span><br><span class=\"line\"> * Date: 2017-03-13</span><br><span class=\"line\"> * @return bool</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function autoMakeDir($filePath)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (!file_exists($filePath)) &#123;</span><br><span class=\"line\">        mkdir($filePath, 0777, true);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"6-自动删除文件\"><a href=\"#6-自动删除文件\" class=\"headerlink\" title=\"6. 自动删除文件\"></a>6. 自动删除文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function autoUnlink($file)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (file_exists($file)) &#123;</span><br><span class=\"line\">        unlink($file);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"7-获取IP地址\"><a href=\"#7-获取IP地址\" class=\"headerlink\" title=\"7. 获取IP地址\"></a>7. 获取IP地址</h2><p>由于服务器nginx代理的缘故 先通过 header 拿到真实ip</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getClientIp()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (isset($_SERVER[&#39;HTTP_X_REAL_IP&#39;])) &#123;</span><br><span class=\"line\">        return $_SERVER[&#39;HTTP_X_REAL_IP&#39;];</span><br><span class=\"line\">    &#125; elseif (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;</span><br><span class=\"line\">        return $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return request()-&gt;getClientIp();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"8-递归显示当前指定目录下所有文件\"><a href=\"#8-递归显示当前指定目录下所有文件\" class=\"headerlink\" title=\"8. 递归显示当前指定目录下所有文件\"></a>8. 递归显示当前指定目录下所有文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * 使用dir函数</span><br><span class=\"line\"> * @param string $dir 目录地址</span><br><span class=\"line\"> * @param boolean $recursion 是否递归</span><br><span class=\"line\"> * @return array $files 文件列表</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function getFiles($dir, $recursion &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $files &#x3D; array();</span><br><span class=\"line\"></span><br><span class=\"line\">    if (!is_dir($dir)) &#123;</span><br><span class=\"line\">        return $files;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $d &#x3D; dir($dir);</span><br><span class=\"line\">    while (false !&#x3D;&#x3D; ($file &#x3D; $d-&gt;read())) &#123;</span><br><span class=\"line\">        if ($file !&#x3D; &#39;.&#39; &amp;&amp; $file !&#x3D; &#39;..&#39;) &#123;</span><br><span class=\"line\">            $filename &#x3D; $dir . &quot;&#x2F;&quot; . $file;</span><br><span class=\"line\"></span><br><span class=\"line\">            if (is_file($filename)) &#123;</span><br><span class=\"line\">                $files[] &#x3D; $filename;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                if ($recursion) &#123;</span><br><span class=\"line\">                    $files &#x3D; array_merge($files, getFiles($filename, $recursion));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    $d-&gt;close();</span><br><span class=\"line\">    return $files;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"9-文章的分享内容\"><a href=\"#9-文章的分享内容\" class=\"headerlink\" title=\"9. 文章的分享内容\"></a>9. 文章的分享内容</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getShareContent($str, $length &#x3D; 0)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &#x2F;&#x2F; 把 video 标签中的 &quot;你的浏览器不支持Video标签&quot; 文字去掉</span><br><span class=\"line\">    $pattern &#x3D; &#39;&#x2F;&lt;video[\\s\\S]*&lt;\\&#x2F;video&gt;&#x2F;&#39;;</span><br><span class=\"line\">    $str &#x3D; preg_replace($pattern, &#39;&#39;, $str);</span><br><span class=\"line\">    $str &#x3D; html_entity_decode(strip_tags($str));</span><br><span class=\"line\">    $str &#x3D; str_replace(PHP_EOL, &#39;&#39;, $str);</span><br><span class=\"line\">    $strArray &#x3D; array(&quot; &quot;, &quot;　&quot;, &quot;\\t&quot;, &quot;\\n&quot;, &quot;\\r&quot;, &quot;&amp;hellip;&quot;, &quot;&amp;mdash;&quot;);</span><br><span class=\"line\">    $str &#x3D; str_replace($strArray, &#39;&#39;, $str);</span><br><span class=\"line\">    $str &#x3D; str_replace(&quot;&#39;&quot;, &#39;&quot;&#39;, $str);</span><br><span class=\"line\">    $str &#x3D; trim(str_replace(chr(194) . chr(160), &#39;&#39;, $str)); &#x2F;&#x2F;shungao20171124 修复UFT8转码特殊字符问题</span><br><span class=\"line\">    if (empty($length) &amp;&amp; mb_strlen($str) &gt; 120) &#123;</span><br><span class=\"line\">        $str &#x3D; mb_substr($str, 0, 120, &#39;utf-8&#39;) . &#39;...&#39;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if (empty($str)) &#123;</span><br><span class=\"line\">        $str &#x3D; &#39;来自...&#39;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return $str;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"10-是否为微信内\"><a href=\"#10-是否为微信内\" class=\"headerlink\" title=\"10. 是否为微信内\"></a>10. 是否为微信内</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function isWechat()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $ua &#x3D; isset($_SERVER[&#39;HTTP_USER_AGENT&#39;]) ? $_SERVER[&#39;HTTP_USER_AGENT&#39;] : &quot;&quot;;</span><br><span class=\"line\">    return true &#x3D;&#x3D; strpos($ua, &#39;MicroMessenger&#39;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"11-mm\"><a href=\"#11-mm\" class=\"headerlink\" title=\"11. mm\"></a>11. mm</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!function_exists(&#39;mm&#39;)) &#123;</span><br><span class=\"line\">    &#x2F;**</span><br><span class=\"line\">     * Dump the passed variables and end the script.</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @param  mixed</span><br><span class=\"line\">     * @return void</span><br><span class=\"line\">     *&#x2F;</span><br><span class=\"line\">    function mm()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        array_map(function ($x) &#123;</span><br><span class=\"line\">            (new \\Illuminate\\Support\\Debug\\Dumper)-&gt;dump($x);</span><br><span class=\"line\">        &#125;, func_get_args());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"12-is-empty\"><a href=\"#12-is-empty\" class=\"headerlink\" title=\"12. is_empty\"></a>12. is_empty</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (!function_exists(&#39;is_empty&#39;)) &#123;</span><br><span class=\"line\">    function is_empty($obj)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        if (empty($obj)) &#123;</span><br><span class=\"line\">            return true;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        if ($obj instanceof Illuminate\\Support\\Collection) &#123;</span><br><span class=\"line\">            $items &#x3D; $obj-&gt;all();</span><br><span class=\"line\">            return empty($items);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"13-字符串转16进制\"><a href=\"#13-字符串转16进制\" class=\"headerlink\" title=\"13. 字符串转16进制\"></a>13. 字符串转16进制</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;**</span><br><span class=\"line\"> * @comment 字符串转16进制</span><br><span class=\"line\"> * @param $string</span><br><span class=\"line\"> * @return string</span><br><span class=\"line\"> * @author zzp</span><br><span class=\"line\"> * @date 2017-12-12</span><br><span class=\"line\"> *&#x2F;</span><br><span class=\"line\">function strToHex($string)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $hex &#x3D; &#39;&#39;;</span><br><span class=\"line\">    for ($i &#x3D; 0; $i &lt; strlen($string); $i++) &#123;</span><br><span class=\"line\">        $ord &#x3D; ord($string[$i]);</span><br><span class=\"line\">        $hexCode &#x3D; dechex($ord);</span><br><span class=\"line\">        $hex .&#x3D; substr(&#39;0&#39; . $hexCode, -2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return strToUpper($hex);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"14-判断两个时间段是否有重叠\"><a href=\"#14-判断两个时间段是否有重叠\" class=\"headerlink\" title=\"14. 判断两个时间段是否有重叠\"></a>14. 判断两个时间段是否有重叠</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; https:&#x2F;&#x2F;jjyy.de&#x2F;post&#x2F;judge-two-date-range-is-overlap.html</span><br><span class=\"line\">function timeIsOverlap($timeAStart, $timeAEnd, $timeBStart, $timeBEnd)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    return !($timeAEnd &lt; $timeBStart || $timeBEnd &lt; $timeAStart);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"在iTerm2中使用Zmodem传输文件","date":"2017-05-12T02:23:48.000Z","_content":"\n> rz,sz命令传输文件，比使用scp要方便得多，特别是在图形界面打开终端，SSH登陆到远程机器需要传输文件的时候。但是MacOS里Terminal.app并不支持Zmodel传输。好在iTerm2具备较强的扩展性可以通过简单的配置支持Zmodem传输。\n\n<!--more-->\n\nZmodem 是跨平台的文件传输协议，可以很方便的在不同的操作系统之间接传输文件。lzrsz 是该协议的实现方式：https://ohse.de/uwe/software/lrzsz.html 。安装后，在 Mac 的 ITerm2 中用 SSH 登陆远程的 Linux 主机，然后用 rz 、sz 命令传输文件。\n\n## 1. 安装 lrzsz\n\n在 Ubuntu 中安装:\n\n```\n$ sudo apt-get install lrzsz\n```\n\n在 CentOS 中安装:\n\n```\n$ yum -y install lrzsz\n```\n\n在 Mac 中安装：\n\n```\n$ brew install lrzsz\n```\n\n## 2. 下载脚本文件\n\n从[这里](https://github.com/mmastrac/iterm2-zmodem)下载。复制到 /usr/local/bin/，并增加执行权限。\n\n```\n$ git clone https://github.com/mmastrac/iterm2-zmodem.git\n$ cp iterm2-zmodem/iterm2-send-zmodem.sh /usr/local/bin/iterm2-send-zmodem.sh\n$ cp iterm2-zmodem/iterm2-recv-zmodem.sh /usr/local/bin/iterm2-recv-zmodem.sh\n$ chmod +x /usr/local/bin/iterm2-send-zmodem.sh\n$ chmod +x /usr/local/bin/iterm2-recv-zmodem.sh\n```\n\n## 3. 配置 iTerm2\n\niTerm2 -> Profiles -> Default ->Advanced -> Triggers -> edit\n\n```\nRegular expression: rz waiting to receive.\\*\\*B0100\nAction: Run Silent Coprocess\nParameters: /usr/local/bin/iterm2-send-zmodem.sh\nInstant: checked\n\nRegular expression: \\*\\*B00000000000000\nAction: Run Silent Coprocess\nParameters: /usr/local/bin/iterm2-recv-zmodem.sh\nInstant: checked\n```\n\n## 4. 使用\n\n发送文件：\n\n1. 登录服务器\n2. `$ rz`\n3. 在弹窗中从本地选择文件\n4. 确定，等待\n\n接收文件：\n\n1. 登录服务器\n2. `$ sz filename1 filename2 ... filenameN`\n3. 在弹窗中选择接收的本地目录\n4. 确定，等待","source":"_posts/在iTerm2中使用Zmodem传输文件.md","raw":"---\ntitle: 在iTerm2中使用Zmodem传输文件\ndate: 2017-05-12 10:23:48\ntags: Linux\ncategories: Linux\n---\n\n> rz,sz命令传输文件，比使用scp要方便得多，特别是在图形界面打开终端，SSH登陆到远程机器需要传输文件的时候。但是MacOS里Terminal.app并不支持Zmodel传输。好在iTerm2具备较强的扩展性可以通过简单的配置支持Zmodem传输。\n\n<!--more-->\n\nZmodem 是跨平台的文件传输协议，可以很方便的在不同的操作系统之间接传输文件。lzrsz 是该协议的实现方式：https://ohse.de/uwe/software/lrzsz.html 。安装后，在 Mac 的 ITerm2 中用 SSH 登陆远程的 Linux 主机，然后用 rz 、sz 命令传输文件。\n\n## 1. 安装 lrzsz\n\n在 Ubuntu 中安装:\n\n```\n$ sudo apt-get install lrzsz\n```\n\n在 CentOS 中安装:\n\n```\n$ yum -y install lrzsz\n```\n\n在 Mac 中安装：\n\n```\n$ brew install lrzsz\n```\n\n## 2. 下载脚本文件\n\n从[这里](https://github.com/mmastrac/iterm2-zmodem)下载。复制到 /usr/local/bin/，并增加执行权限。\n\n```\n$ git clone https://github.com/mmastrac/iterm2-zmodem.git\n$ cp iterm2-zmodem/iterm2-send-zmodem.sh /usr/local/bin/iterm2-send-zmodem.sh\n$ cp iterm2-zmodem/iterm2-recv-zmodem.sh /usr/local/bin/iterm2-recv-zmodem.sh\n$ chmod +x /usr/local/bin/iterm2-send-zmodem.sh\n$ chmod +x /usr/local/bin/iterm2-recv-zmodem.sh\n```\n\n## 3. 配置 iTerm2\n\niTerm2 -> Profiles -> Default ->Advanced -> Triggers -> edit\n\n```\nRegular expression: rz waiting to receive.\\*\\*B0100\nAction: Run Silent Coprocess\nParameters: /usr/local/bin/iterm2-send-zmodem.sh\nInstant: checked\n\nRegular expression: \\*\\*B00000000000000\nAction: Run Silent Coprocess\nParameters: /usr/local/bin/iterm2-recv-zmodem.sh\nInstant: checked\n```\n\n## 4. 使用\n\n发送文件：\n\n1. 登录服务器\n2. `$ rz`\n3. 在弹窗中从本地选择文件\n4. 确定，等待\n\n接收文件：\n\n1. 登录服务器\n2. `$ sz filename1 filename2 ... filenameN`\n3. 在弹窗中选择接收的本地目录\n4. 确定，等待","slug":"在iTerm2中使用Zmodem传输文件","published":1,"updated":"2020-09-11T01:04:35.048Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9t003i6wo157behmtf","content":"<blockquote>\n<p>rz,sz命令传输文件，比使用scp要方便得多，特别是在图形界面打开终端，SSH登陆到远程机器需要传输文件的时候。但是MacOS里Terminal.app并不支持Zmodel传输。好在iTerm2具备较强的扩展性可以通过简单的配置支持Zmodem传输。</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p>Zmodem 是跨平台的文件传输协议，可以很方便的在不同的操作系统之间接传输文件。lzrsz 是该协议的实现方式：<a href=\"https://ohse.de/uwe/software/lrzsz.html\">https://ohse.de/uwe/software/lrzsz.html</a> 。安装后，在 Mac 的 ITerm2 中用 SSH 登陆远程的 Linux 主机，然后用 rz 、sz 命令传输文件。</p>\n<h2 id=\"1-安装-lrzsz\"><a href=\"#1-安装-lrzsz\" class=\"headerlink\" title=\"1. 安装 lrzsz\"></a>1. 安装 lrzsz</h2><p>在 Ubuntu 中安装:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install lrzsz</span><br></pre></td></tr></table></figure>\n\n<p>在 CentOS 中安装:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum -y install lrzsz</span><br></pre></td></tr></table></figure>\n\n<p>在 Mac 中安装：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew install lrzsz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-下载脚本文件\"><a href=\"#2-下载脚本文件\" class=\"headerlink\" title=\"2. 下载脚本文件\"></a>2. 下载脚本文件</h2><p>从<a href=\"https://github.com/mmastrac/iterm2-zmodem\">这里</a>下载。复制到 /usr/local/bin/，并增加执行权限。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git clone https:&#x2F;&#x2F;github.com&#x2F;mmastrac&#x2F;iterm2-zmodem.git</span><br><span class=\"line\">$ cp iterm2-zmodem&#x2F;iterm2-send-zmodem.sh &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-send-zmodem.sh</span><br><span class=\"line\">$ cp iterm2-zmodem&#x2F;iterm2-recv-zmodem.sh &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-recv-zmodem.sh</span><br><span class=\"line\">$ chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-send-zmodem.sh</span><br><span class=\"line\">$ chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-recv-zmodem.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-配置-iTerm2\"><a href=\"#3-配置-iTerm2\" class=\"headerlink\" title=\"3. 配置 iTerm2\"></a>3. 配置 iTerm2</h2><p>iTerm2 -&gt; Profiles -&gt; Default -&gt;Advanced -&gt; Triggers -&gt; edit</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Regular expression: rz waiting to receive.\\*\\*B0100</span><br><span class=\"line\">Action: Run Silent Coprocess</span><br><span class=\"line\">Parameters: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-send-zmodem.sh</span><br><span class=\"line\">Instant: checked</span><br><span class=\"line\"></span><br><span class=\"line\">Regular expression: \\*\\*B00000000000000</span><br><span class=\"line\">Action: Run Silent Coprocess</span><br><span class=\"line\">Parameters: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-recv-zmodem.sh</span><br><span class=\"line\">Instant: checked</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-使用\"><a href=\"#4-使用\" class=\"headerlink\" title=\"4. 使用\"></a>4. 使用</h2><p>发送文件：</p>\n<ol>\n<li>登录服务器</li>\n<li><code>$ rz</code></li>\n<li>在弹窗中从本地选择文件</li>\n<li>确定，等待</li>\n</ol>\n<p>接收文件：</p>\n<ol>\n<li>登录服务器</li>\n<li><code>$ sz filename1 filename2 ... filenameN</code></li>\n<li>在弹窗中选择接收的本地目录</li>\n<li>确定，等待</li>\n</ol>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>rz,sz命令传输文件，比使用scp要方便得多，特别是在图形界面打开终端，SSH登陆到远程机器需要传输文件的时候。但是MacOS里Terminal.app并不支持Zmodel传输。好在iTerm2具备较强的扩展性可以通过简单的配置支持Zmodem传输。</p>\n</blockquote>","more":"<p>Zmodem 是跨平台的文件传输协议，可以很方便的在不同的操作系统之间接传输文件。lzrsz 是该协议的实现方式：<a href=\"https://ohse.de/uwe/software/lrzsz.html\">https://ohse.de/uwe/software/lrzsz.html</a> 。安装后，在 Mac 的 ITerm2 中用 SSH 登陆远程的 Linux 主机，然后用 rz 、sz 命令传输文件。</p>\n<h2 id=\"1-安装-lrzsz\"><a href=\"#1-安装-lrzsz\" class=\"headerlink\" title=\"1. 安装 lrzsz\"></a>1. 安装 lrzsz</h2><p>在 Ubuntu 中安装:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install lrzsz</span><br></pre></td></tr></table></figure>\n\n<p>在 CentOS 中安装:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum -y install lrzsz</span><br></pre></td></tr></table></figure>\n\n<p>在 Mac 中安装：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brew install lrzsz</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-下载脚本文件\"><a href=\"#2-下载脚本文件\" class=\"headerlink\" title=\"2. 下载脚本文件\"></a>2. 下载脚本文件</h2><p>从<a href=\"https://github.com/mmastrac/iterm2-zmodem\">这里</a>下载。复制到 /usr/local/bin/，并增加执行权限。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ git clone https:&#x2F;&#x2F;github.com&#x2F;mmastrac&#x2F;iterm2-zmodem.git</span><br><span class=\"line\">$ cp iterm2-zmodem&#x2F;iterm2-send-zmodem.sh &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-send-zmodem.sh</span><br><span class=\"line\">$ cp iterm2-zmodem&#x2F;iterm2-recv-zmodem.sh &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-recv-zmodem.sh</span><br><span class=\"line\">$ chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-send-zmodem.sh</span><br><span class=\"line\">$ chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-recv-zmodem.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-配置-iTerm2\"><a href=\"#3-配置-iTerm2\" class=\"headerlink\" title=\"3. 配置 iTerm2\"></a>3. 配置 iTerm2</h2><p>iTerm2 -&gt; Profiles -&gt; Default -&gt;Advanced -&gt; Triggers -&gt; edit</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Regular expression: rz waiting to receive.\\*\\*B0100</span><br><span class=\"line\">Action: Run Silent Coprocess</span><br><span class=\"line\">Parameters: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-send-zmodem.sh</span><br><span class=\"line\">Instant: checked</span><br><span class=\"line\"></span><br><span class=\"line\">Regular expression: \\*\\*B00000000000000</span><br><span class=\"line\">Action: Run Silent Coprocess</span><br><span class=\"line\">Parameters: &#x2F;usr&#x2F;local&#x2F;bin&#x2F;iterm2-recv-zmodem.sh</span><br><span class=\"line\">Instant: checked</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-使用\"><a href=\"#4-使用\" class=\"headerlink\" title=\"4. 使用\"></a>4. 使用</h2><p>发送文件：</p>\n<ol>\n<li>登录服务器</li>\n<li><code>$ rz</code></li>\n<li>在弹窗中从本地选择文件</li>\n<li>确定，等待</li>\n</ol>\n<p>接收文件：</p>\n<ol>\n<li>登录服务器</li>\n<li><code>$ sz filename1 filename2 ... filenameN</code></li>\n<li>在弹窗中选择接收的本地目录</li>\n<li>确定，等待</li>\n</ol>"},{"title":"小程序用户登录授权逻辑及踩坑","date":"2018-01-18T14:07:09.000Z","_content":"\n小程序的微信登录授权前前后后折腾了有两周，这里记录一下整个流程和踩坑记录。\n\n# 1. 登录时序图\n\n首先祭出官方提供的登录时序图，登录流程主要按照时序图来完成。\n\n<!-- more -->\n\n![](http://omp48p40q.bkt.clouddn.com/18-1-18/77955544.jpg)\n\n# 2. 静默获取用户数据\n\n## 1. wx.login() 登录接口\n\n调用接口获取登录凭证（code）进而换取用户登录态信息，包括用户的唯一标识（openid） 及本次登录的 会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。\n\n注：调用 login 会引起登录态的刷新，之前的 sessionKey 可能会失效。\n\n## 2. wx.checkSession(OBJECT)\n\n通过上述接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用wx.checkSession接口检测当前用户登录态是否有效。登录态过期后开发者可以再调用wx.login获取新的用户登录态。\n\n> 以上两个方法静默调用，直接在 app.js 的 onLaunch 方法使用即可。\n\n```\n//app.js\nApp({\n  onLaunch: function () {\n    wx.checkSession({\n      success: function () {\n        //session 未过期，并且在本生命周期一直有效\n      },\n      fail: function () {\n        //登录态过期\n        wx.login({ //重新登录\n          success: function (res) {\n            if (res.code) {\n              //发起网络请求\n              this.getSessionKeyFromServer(res.code);\n            } else {\n              console.log('获取用户登录态失败！' + res.errMsg)\n            }\n          }\n        });\n      }\n    })\n  }\n})\n```\n\n## 3. login 方法成功后返回 code， 为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 api，使用 code 换取 openid 和 session_key 等信息\n\n> 小程序端代码\n\n```\ngetSessionKeyFromServer: function (code) {\n    var that = this;\n    wx.request({\n      url: 'api address', // 我们自己服务器定义的接口地址\n      method: 'POST',\n      data: {\n        code: code,\n      },\n      success: function (res) {\n        console.log('get session key: ', res.data);\n        if (res.data.code == 200) {\n          // 满足一定条件的用户，可以直接获取到 union_id，无需再次去解密\n          if (res.data.data.union_id) {\n            that.globalData.unionId = res.data.data.union_id;\n          } else {\n            if (res.data.data.cj_session_key) {\n              var cjSessionKey = res.data.data.cj_session_key;\n              // 存入全局变量中，后续获取用户信息会使用到\n              that.globalData.cjSessionKey = res.data.data.cj_session_key;\n              that.globalData.sessionKeyExpiresAt = res.data.data.expiresAt;\n              // that.getUserInfoFromServer(cjSessionKey);\n            }\n          }\n        } else {\n          wx.showToast({\n            title: 'session 获取失败',\n          })\n        }\n      },\n      fail: function (res) {\n        wx.showToast({\n          title: 'session 获取失败',\n        })\n      }\n    });\n  },\n```\n\n> server 端代码\n\n```\npublic function postSessionKey(Request $request)\n{\n    $timestamp = (new Carbon())->timestamp;\n    $code = trim($request->input('code', ''));\n    $flag = true;\n    $returnData = [];\n\n    if (empty($code)) {\n        $this->markFailed(301, 'code 不能为空');\n        $flag = false;\n    }\n\n    if ($flag) {\n        $url = 'https://api.weixin.qq.com/sns/jscode2session';\n        $curl = new Curl();\n\n        $getData = [\n            'appid' => 'app id',\n            'secret' => 'app secret',\n            'js_code' => $code,\n            'grant_type' => 'authorization_code',\n        ];\n        $curl->get($url, $getData);\n\n        if ($curl->httpStatusCode != 200) {\n            $this->markFailed(302, '获取session_key失败');\n        } else {\n            $response = json_decode($curl->rawResponse, true);\n            if (isset($response['openid']) && !empty($response['openid'])) {\n                $openId = $response['openid'];\n                $unionId = isset($response['unionid']) ? $response['unionid'] : '';\n                $wechatAppUserData = [\n                    'open_id' => trim($openId),\n                    'expires_at' => $response['expires_in'] + $timestamp,\n                    'session_key' => trim($response['session_key']),\n                    'union_id' => $unionId\n                ];\n\n                // 生成 3rd_session\n                $cjSessionKey = $this->wechatAppUserRepository->opensslEncrypt($openId . $timestamp);\n                $expiresAt = Carbon::now()->addSeconds($response['expires_in'])->addWeek();\n                // 所需的数据存入 redis 缓存\n                Cache::put(md5($cjSessionKey), $wechatAppUserData, $expiresAt);\n                $returnData = [\n                    'cj_session_key' => $cjSessionKey, \n                    'expiresAt' => $expiresAt, \n                    'union_id' => $unionId\n                ];\n                $this->markSuccess();\n            } else {\n                $this->markFailed(302, '获取session_key失败');\n            }\n        }\n    }\n\n    $this->returnData['data'] = $returnData;\n    return $this->returnData;\n}\n```\n\n#  3. 如果需要获取 openid，unionid 等更多用户数据需要用户授权后才能拿到\n\n\n## 1. wx.authorize(OBJECT)\n\n提前向用户发起授权请求。调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口。如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。\n\n```\n// 可以通过 wx.getSetting 先查询一下用户是否授权了 \"scope.userInfo\" 这个 scope\nwx.getSetting({\n  success(res) {\n    if (!res.authSetting['scope.userInfo']) {\n      wx.authorize({\n        scope: 'scope.userInfo',\n        success() {\n          // 用户已经同意小程序使用用户信息功能，后续调用 wx.getUserInfo 接口不会弹窗询问\n          wx.getUserInfo()\n        }\n      })\n    }\n  }\n})\n```\n\n## 2. wx.getUserInfo(OBJECT)\n\n获取用户信息，withCredentials 为 true 时需要先调用 wx.login 接口。\n\n在合适的时机，调用该方法，弹窗用户授权窗口，用户点击同意后进行后续操作。同时必须要完成用户拒绝的逻辑。\n\n需要传入小程序本地的 sessionKey （全局变量中， 先根据全局变量的 sessionKeyExpiresAt 判断是否过期，如已过期，需要重新调用 login 方法获取新的），服务端拿到sessionKey后从缓存中取得用户的 session_key，才可以进行后续的操作。\n\n> 小程序端代码\n\n```\ngetUserInfoFromServer: function (cjSessionKey) {\n    var that = this;\n    wx.getUserInfo({\n      withCredentials: true,\n      success: function (res) {\n        that.globalData.userInfo = res.userInfo;\n        wx.request({\n          url: 'api userinfo address',\n          method: 'POST',\n          data: {\n            iv: res.iv,\n            cjSessionKey: cjSessionKey,\n            encryptedData: res.encryptedData\n          },\n          success: function (res) {\n            if (res.data.code != 200) {\n              wx.showToast({\n                title: res.data.msg,\n              });\n            } else {\n              that.globalData.unionId = res.data.data.union_id;\n              that.globalData.userId = res.data.data.user_id;\n              that.globalData.password = res.data.data.password;\n              that.globalData.username = res.data.data.username;\n            }\n          },\n          fail: function () {\n            wx.showToast({\n              title: '服务器连接失败',\n            })\n          }\n        })\n      },\n      fail: function (res) {\n        console.log(res);\n      }\n    })\n}\n```\n\n> 服务端代码\n\n```\npublic function postUserInfo(Request $request)\n{\n    $iv = trim($request->input('iv', ''));\n    $cjSessionKey = trim($request->input('cjSessionKey', ''));\n    $encryptedData = trim($request->input('encryptedData', ''));\n    $ip = getClientIp();\n    $flag = true;\n    $source = 'mina';\n    $returnData = [];\n\n    if (empty($iv)) {\n        $this->markFailed(303, 'iv 不能为空');\n        $flag = false;\n    } elseif (empty($cjSessionKey)) {\n        $this->markFailed(304, 'cjSessionKey 不能为空');\n        $flag = false;\n    } elseif (empty($encryptedData)) {\n        $this->markFailed(305, 'encryptedData 不能为空');\n        $flag = false;\n    }\n\n    if ($flag) {\n        $sessionData = Cache::get(md5($cjSessionKey));\n        if (empty($sessionData)) {\n            $this->markFailed(306, 'session 信息已过期');\n        } else {\n            $sessionKey = $sessionData['session_key'];\n            $configData = config('mina');\n            $data = null;\n\n            $pc = new WXBizDataCrypt($configData['app_id'], trim($sessionKey));\n            $errorCode = $pc->decryptData($encryptedData, $iv, $data);\n\n            $cLogModel->addInfo('解密后的 code: ' . $errorCode);\n            $cLogModel->addInfo('解密后的 data: ' . $data);\n\n            if ($errorCode == 0) {\n                $userInfo = json_decode($data, true);\n                // 处理自己的业务逻辑，这里没有 unionId 不处理\n                if (isset($userInfo['unionId']) &&\n                    !empty($userInfo['unionId']) &&\n                    !empty($userInfo['watermark']) &&\n                    !empty($userInfo['watermark']['appid']) &&\n                    $userInfo['watermark']['appid'] == $configData['app_id']\n                ) {\n                    $unionId = $userInfo['unionId'];\n                    \n                    if (condition) {\n                        // 已经在平台注册，取出用户基本数据并返回\n                        $returnData = [\n                            'user_id' => 'data user id',\n                            'username' => 'data username',\n                            'password' => 'data password',\n                            'union_id' => $unionId\n                        ];\n                        $this->markSuccess();\n                    } else {\n                        // 没有在平台注册，模拟注册，基本数据返回\n                        $returnData = [\n                            'user_id' => 'data user id',\n                            'username' => 'data username',\n                            'password' => 'data password',\n                            'union_id' => $unionId\n                        ];\n                        $this->markSuccess();\n                    }\n                } else {\n                    $this->markFailed(310, 'appid 不匹配');\n                }\n            } else {\n                $this->markFailed(307, 'encryptedData 解密失败');\n            }\n        }\n    }\n\n    $this->returnData['data'] = $returnData;\n    return $this->returnData;\n}\n```\n\n\n# 4. 大坑\n\n## 1. UnionID机制说明\n\n如果开发者拥有多个移动应用、网站应用、和公众帐号（包括小程序），可通过unionid来区分用户的唯一性，因为只要是同一个微信开放平台帐号下的移动应用、网站应用和公众帐号（包括小程序），用户的unionid是唯一的。换句话说，同一用户，对同一个微信开放平台下的不同应用，unionid是相同的。\n\n同一个微信开放平台下的相同主体的App、公众号、小程序，如果用户已经关注公众号，或者曾经登录过App或公众号，则用户打开小程序时，开发者可以直接通过wx.login获取到该用户UnionID，无须用户再次授权。\n\n> 需要到微信开发平台绑定小程序之后才能拿到 unionid\n\n## 2. 加密数据解密算法\n\n微信官方提供了多种编程语言的示例代码（[点击下载](https://mp.weixin.qq.com/debug/wxadoc/dev/demo/aes-sample.zip)）。每种语言类型的接口名字均一致。调用方式可以参照示例。\n\n这里提供的PHP代码，首先编码格式就有问题，完全无法使用。需要复制出来以项目所用的编码方式重新进行保存。\n\n类 WXBizDataCrypt 的构造方法需要改为：\n\n```\npublic function __construct($appid, $sessionKey)\n{\n    $this->sessionKey = $sessionKey;\n    $this->appid = $appid;\n}\n```\n\n使用方法见上面的服务端代码。\n\n","source":"_posts/小程序用户登录授权逻辑及踩坑.md","raw":"---\ntitle: 小程序用户登录授权逻辑及踩坑\ndate: 2018-01-18 22:07:09\ntags: 小程序\n---\n\n小程序的微信登录授权前前后后折腾了有两周，这里记录一下整个流程和踩坑记录。\n\n# 1. 登录时序图\n\n首先祭出官方提供的登录时序图，登录流程主要按照时序图来完成。\n\n<!-- more -->\n\n![](http://omp48p40q.bkt.clouddn.com/18-1-18/77955544.jpg)\n\n# 2. 静默获取用户数据\n\n## 1. wx.login() 登录接口\n\n调用接口获取登录凭证（code）进而换取用户登录态信息，包括用户的唯一标识（openid） 及本次登录的 会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。\n\n注：调用 login 会引起登录态的刷新，之前的 sessionKey 可能会失效。\n\n## 2. wx.checkSession(OBJECT)\n\n通过上述接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用wx.checkSession接口检测当前用户登录态是否有效。登录态过期后开发者可以再调用wx.login获取新的用户登录态。\n\n> 以上两个方法静默调用，直接在 app.js 的 onLaunch 方法使用即可。\n\n```\n//app.js\nApp({\n  onLaunch: function () {\n    wx.checkSession({\n      success: function () {\n        //session 未过期，并且在本生命周期一直有效\n      },\n      fail: function () {\n        //登录态过期\n        wx.login({ //重新登录\n          success: function (res) {\n            if (res.code) {\n              //发起网络请求\n              this.getSessionKeyFromServer(res.code);\n            } else {\n              console.log('获取用户登录态失败！' + res.errMsg)\n            }\n          }\n        });\n      }\n    })\n  }\n})\n```\n\n## 3. login 方法成功后返回 code， 为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 api，使用 code 换取 openid 和 session_key 等信息\n\n> 小程序端代码\n\n```\ngetSessionKeyFromServer: function (code) {\n    var that = this;\n    wx.request({\n      url: 'api address', // 我们自己服务器定义的接口地址\n      method: 'POST',\n      data: {\n        code: code,\n      },\n      success: function (res) {\n        console.log('get session key: ', res.data);\n        if (res.data.code == 200) {\n          // 满足一定条件的用户，可以直接获取到 union_id，无需再次去解密\n          if (res.data.data.union_id) {\n            that.globalData.unionId = res.data.data.union_id;\n          } else {\n            if (res.data.data.cj_session_key) {\n              var cjSessionKey = res.data.data.cj_session_key;\n              // 存入全局变量中，后续获取用户信息会使用到\n              that.globalData.cjSessionKey = res.data.data.cj_session_key;\n              that.globalData.sessionKeyExpiresAt = res.data.data.expiresAt;\n              // that.getUserInfoFromServer(cjSessionKey);\n            }\n          }\n        } else {\n          wx.showToast({\n            title: 'session 获取失败',\n          })\n        }\n      },\n      fail: function (res) {\n        wx.showToast({\n          title: 'session 获取失败',\n        })\n      }\n    });\n  },\n```\n\n> server 端代码\n\n```\npublic function postSessionKey(Request $request)\n{\n    $timestamp = (new Carbon())->timestamp;\n    $code = trim($request->input('code', ''));\n    $flag = true;\n    $returnData = [];\n\n    if (empty($code)) {\n        $this->markFailed(301, 'code 不能为空');\n        $flag = false;\n    }\n\n    if ($flag) {\n        $url = 'https://api.weixin.qq.com/sns/jscode2session';\n        $curl = new Curl();\n\n        $getData = [\n            'appid' => 'app id',\n            'secret' => 'app secret',\n            'js_code' => $code,\n            'grant_type' => 'authorization_code',\n        ];\n        $curl->get($url, $getData);\n\n        if ($curl->httpStatusCode != 200) {\n            $this->markFailed(302, '获取session_key失败');\n        } else {\n            $response = json_decode($curl->rawResponse, true);\n            if (isset($response['openid']) && !empty($response['openid'])) {\n                $openId = $response['openid'];\n                $unionId = isset($response['unionid']) ? $response['unionid'] : '';\n                $wechatAppUserData = [\n                    'open_id' => trim($openId),\n                    'expires_at' => $response['expires_in'] + $timestamp,\n                    'session_key' => trim($response['session_key']),\n                    'union_id' => $unionId\n                ];\n\n                // 生成 3rd_session\n                $cjSessionKey = $this->wechatAppUserRepository->opensslEncrypt($openId . $timestamp);\n                $expiresAt = Carbon::now()->addSeconds($response['expires_in'])->addWeek();\n                // 所需的数据存入 redis 缓存\n                Cache::put(md5($cjSessionKey), $wechatAppUserData, $expiresAt);\n                $returnData = [\n                    'cj_session_key' => $cjSessionKey, \n                    'expiresAt' => $expiresAt, \n                    'union_id' => $unionId\n                ];\n                $this->markSuccess();\n            } else {\n                $this->markFailed(302, '获取session_key失败');\n            }\n        }\n    }\n\n    $this->returnData['data'] = $returnData;\n    return $this->returnData;\n}\n```\n\n#  3. 如果需要获取 openid，unionid 等更多用户数据需要用户授权后才能拿到\n\n\n## 1. wx.authorize(OBJECT)\n\n提前向用户发起授权请求。调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口。如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。\n\n```\n// 可以通过 wx.getSetting 先查询一下用户是否授权了 \"scope.userInfo\" 这个 scope\nwx.getSetting({\n  success(res) {\n    if (!res.authSetting['scope.userInfo']) {\n      wx.authorize({\n        scope: 'scope.userInfo',\n        success() {\n          // 用户已经同意小程序使用用户信息功能，后续调用 wx.getUserInfo 接口不会弹窗询问\n          wx.getUserInfo()\n        }\n      })\n    }\n  }\n})\n```\n\n## 2. wx.getUserInfo(OBJECT)\n\n获取用户信息，withCredentials 为 true 时需要先调用 wx.login 接口。\n\n在合适的时机，调用该方法，弹窗用户授权窗口，用户点击同意后进行后续操作。同时必须要完成用户拒绝的逻辑。\n\n需要传入小程序本地的 sessionKey （全局变量中， 先根据全局变量的 sessionKeyExpiresAt 判断是否过期，如已过期，需要重新调用 login 方法获取新的），服务端拿到sessionKey后从缓存中取得用户的 session_key，才可以进行后续的操作。\n\n> 小程序端代码\n\n```\ngetUserInfoFromServer: function (cjSessionKey) {\n    var that = this;\n    wx.getUserInfo({\n      withCredentials: true,\n      success: function (res) {\n        that.globalData.userInfo = res.userInfo;\n        wx.request({\n          url: 'api userinfo address',\n          method: 'POST',\n          data: {\n            iv: res.iv,\n            cjSessionKey: cjSessionKey,\n            encryptedData: res.encryptedData\n          },\n          success: function (res) {\n            if (res.data.code != 200) {\n              wx.showToast({\n                title: res.data.msg,\n              });\n            } else {\n              that.globalData.unionId = res.data.data.union_id;\n              that.globalData.userId = res.data.data.user_id;\n              that.globalData.password = res.data.data.password;\n              that.globalData.username = res.data.data.username;\n            }\n          },\n          fail: function () {\n            wx.showToast({\n              title: '服务器连接失败',\n            })\n          }\n        })\n      },\n      fail: function (res) {\n        console.log(res);\n      }\n    })\n}\n```\n\n> 服务端代码\n\n```\npublic function postUserInfo(Request $request)\n{\n    $iv = trim($request->input('iv', ''));\n    $cjSessionKey = trim($request->input('cjSessionKey', ''));\n    $encryptedData = trim($request->input('encryptedData', ''));\n    $ip = getClientIp();\n    $flag = true;\n    $source = 'mina';\n    $returnData = [];\n\n    if (empty($iv)) {\n        $this->markFailed(303, 'iv 不能为空');\n        $flag = false;\n    } elseif (empty($cjSessionKey)) {\n        $this->markFailed(304, 'cjSessionKey 不能为空');\n        $flag = false;\n    } elseif (empty($encryptedData)) {\n        $this->markFailed(305, 'encryptedData 不能为空');\n        $flag = false;\n    }\n\n    if ($flag) {\n        $sessionData = Cache::get(md5($cjSessionKey));\n        if (empty($sessionData)) {\n            $this->markFailed(306, 'session 信息已过期');\n        } else {\n            $sessionKey = $sessionData['session_key'];\n            $configData = config('mina');\n            $data = null;\n\n            $pc = new WXBizDataCrypt($configData['app_id'], trim($sessionKey));\n            $errorCode = $pc->decryptData($encryptedData, $iv, $data);\n\n            $cLogModel->addInfo('解密后的 code: ' . $errorCode);\n            $cLogModel->addInfo('解密后的 data: ' . $data);\n\n            if ($errorCode == 0) {\n                $userInfo = json_decode($data, true);\n                // 处理自己的业务逻辑，这里没有 unionId 不处理\n                if (isset($userInfo['unionId']) &&\n                    !empty($userInfo['unionId']) &&\n                    !empty($userInfo['watermark']) &&\n                    !empty($userInfo['watermark']['appid']) &&\n                    $userInfo['watermark']['appid'] == $configData['app_id']\n                ) {\n                    $unionId = $userInfo['unionId'];\n                    \n                    if (condition) {\n                        // 已经在平台注册，取出用户基本数据并返回\n                        $returnData = [\n                            'user_id' => 'data user id',\n                            'username' => 'data username',\n                            'password' => 'data password',\n                            'union_id' => $unionId\n                        ];\n                        $this->markSuccess();\n                    } else {\n                        // 没有在平台注册，模拟注册，基本数据返回\n                        $returnData = [\n                            'user_id' => 'data user id',\n                            'username' => 'data username',\n                            'password' => 'data password',\n                            'union_id' => $unionId\n                        ];\n                        $this->markSuccess();\n                    }\n                } else {\n                    $this->markFailed(310, 'appid 不匹配');\n                }\n            } else {\n                $this->markFailed(307, 'encryptedData 解密失败');\n            }\n        }\n    }\n\n    $this->returnData['data'] = $returnData;\n    return $this->returnData;\n}\n```\n\n\n# 4. 大坑\n\n## 1. UnionID机制说明\n\n如果开发者拥有多个移动应用、网站应用、和公众帐号（包括小程序），可通过unionid来区分用户的唯一性，因为只要是同一个微信开放平台帐号下的移动应用、网站应用和公众帐号（包括小程序），用户的unionid是唯一的。换句话说，同一用户，对同一个微信开放平台下的不同应用，unionid是相同的。\n\n同一个微信开放平台下的相同主体的App、公众号、小程序，如果用户已经关注公众号，或者曾经登录过App或公众号，则用户打开小程序时，开发者可以直接通过wx.login获取到该用户UnionID，无须用户再次授权。\n\n> 需要到微信开发平台绑定小程序之后才能拿到 unionid\n\n## 2. 加密数据解密算法\n\n微信官方提供了多种编程语言的示例代码（[点击下载](https://mp.weixin.qq.com/debug/wxadoc/dev/demo/aes-sample.zip)）。每种语言类型的接口名字均一致。调用方式可以参照示例。\n\n这里提供的PHP代码，首先编码格式就有问题，完全无法使用。需要复制出来以项目所用的编码方式重新进行保存。\n\n类 WXBizDataCrypt 的构造方法需要改为：\n\n```\npublic function __construct($appid, $sessionKey)\n{\n    $this->sessionKey = $sessionKey;\n    $this->appid = $appid;\n}\n```\n\n使用方法见上面的服务端代码。\n\n","slug":"小程序用户登录授权逻辑及踩坑","published":1,"updated":"2020-09-11T01:04:35.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9u003k6wo1b6ia7wav","content":"<p>小程序的微信登录授权前前后后折腾了有两周，这里记录一下整个流程和踩坑记录。</p>\n<h1 id=\"1-登录时序图\"><a href=\"#1-登录时序图\" class=\"headerlink\" title=\"1. 登录时序图\"></a>1. 登录时序图</h1><p>首先祭出官方提供的登录时序图，登录流程主要按照时序图来完成。</p>\n<a id=\"more\"></a>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-1-18/77955544.jpg\"></p>\n<h1 id=\"2-静默获取用户数据\"><a href=\"#2-静默获取用户数据\" class=\"headerlink\" title=\"2. 静默获取用户数据\"></a>2. 静默获取用户数据</h1><h2 id=\"1-wx-login-登录接口\"><a href=\"#1-wx-login-登录接口\" class=\"headerlink\" title=\"1. wx.login() 登录接口\"></a>1. wx.login() 登录接口</h2><p>调用接口获取登录凭证（code）进而换取用户登录态信息，包括用户的唯一标识（openid） 及本次登录的 会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。</p>\n<p>注：调用 login 会引起登录态的刷新，之前的 sessionKey 可能会失效。</p>\n<h2 id=\"2-wx-checkSession-OBJECT\"><a href=\"#2-wx-checkSession-OBJECT\" class=\"headerlink\" title=\"2. wx.checkSession(OBJECT)\"></a>2. wx.checkSession(OBJECT)</h2><p>通过上述接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用wx.checkSession接口检测当前用户登录态是否有效。登录态过期后开发者可以再调用wx.login获取新的用户登录态。</p>\n<blockquote>\n<p>以上两个方法静默调用，直接在 app.js 的 onLaunch 方法使用即可。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;app.js</span><br><span class=\"line\">App(&#123;</span><br><span class=\"line\">  onLaunch: function () &#123;</span><br><span class=\"line\">    wx.checkSession(&#123;</span><br><span class=\"line\">      success: function () &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;session 未过期，并且在本生命周期一直有效</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: function () &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;登录态过期</span><br><span class=\"line\">        wx.login(&#123; &#x2F;&#x2F;重新登录</span><br><span class=\"line\">          success: function (res) &#123;</span><br><span class=\"line\">            if (res.code) &#123;</span><br><span class=\"line\">              &#x2F;&#x2F;发起网络请求</span><br><span class=\"line\">              this.getSessionKeyFromServer(res.code);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">              console.log(&#39;获取用户登录态失败！&#39; + res.errMsg)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-login-方法成功后返回-code，-为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用-api，使用-code-换取-openid-和-session-key-等信息\"><a href=\"#3-login-方法成功后返回-code，-为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用-api，使用-code-换取-openid-和-session-key-等信息\" class=\"headerlink\" title=\"3. login 方法成功后返回 code， 为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 api，使用 code 换取 openid 和 session_key 等信息\"></a>3. login 方法成功后返回 code， 为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 api，使用 code 换取 openid 和 session_key 等信息</h2><blockquote>\n<p>小程序端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getSessionKeyFromServer: function (code) &#123;</span><br><span class=\"line\">    var that &#x3D; this;</span><br><span class=\"line\">    wx.request(&#123;</span><br><span class=\"line\">      url: &#39;api address&#39;, &#x2F;&#x2F; 我们自己服务器定义的接口地址</span><br><span class=\"line\">      method: &#39;POST&#39;,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        code: code,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      success: function (res) &#123;</span><br><span class=\"line\">        console.log(&#39;get session key: &#39;, res.data);</span><br><span class=\"line\">        if (res.data.code &#x3D;&#x3D; 200) &#123;</span><br><span class=\"line\">          &#x2F;&#x2F; 满足一定条件的用户，可以直接获取到 union_id，无需再次去解密</span><br><span class=\"line\">          if (res.data.data.union_id) &#123;</span><br><span class=\"line\">            that.globalData.unionId &#x3D; res.data.data.union_id;</span><br><span class=\"line\">          &#125; else &#123;</span><br><span class=\"line\">            if (res.data.data.cj_session_key) &#123;</span><br><span class=\"line\">              var cjSessionKey &#x3D; res.data.data.cj_session_key;</span><br><span class=\"line\">              &#x2F;&#x2F; 存入全局变量中，后续获取用户信息会使用到</span><br><span class=\"line\">              that.globalData.cjSessionKey &#x3D; res.data.data.cj_session_key;</span><br><span class=\"line\">              that.globalData.sessionKeyExpiresAt &#x3D; res.data.data.expiresAt;</span><br><span class=\"line\">              &#x2F;&#x2F; that.getUserInfoFromServer(cjSessionKey);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: &#39;session 获取失败&#39;,</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: function (res) &#123;</span><br><span class=\"line\">        wx.showToast(&#123;</span><br><span class=\"line\">          title: &#39;session 获取失败&#39;,</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>server 端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function postSessionKey(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $timestamp &#x3D; (new Carbon())-&gt;timestamp;</span><br><span class=\"line\">    $code &#x3D; trim($request-&gt;input(&#39;code&#39;, &#39;&#39;));</span><br><span class=\"line\">    $flag &#x3D; true;</span><br><span class=\"line\">    $returnData &#x3D; [];</span><br><span class=\"line\"></span><br><span class=\"line\">    if (empty($code)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(301, &#39;code 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($flag) &#123;</span><br><span class=\"line\">        $url &#x3D; &#39;https:&#x2F;&#x2F;api.weixin.qq.com&#x2F;sns&#x2F;jscode2session&#39;;</span><br><span class=\"line\">        $curl &#x3D; new Curl();</span><br><span class=\"line\"></span><br><span class=\"line\">        $getData &#x3D; [</span><br><span class=\"line\">            &#39;appid&#39; &#x3D;&gt; &#39;app id&#39;,</span><br><span class=\"line\">            &#39;secret&#39; &#x3D;&gt; &#39;app secret&#39;,</span><br><span class=\"line\">            &#39;js_code&#39; &#x3D;&gt; $code,</span><br><span class=\"line\">            &#39;grant_type&#39; &#x3D;&gt; &#39;authorization_code&#39;,</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        $curl-&gt;get($url, $getData);</span><br><span class=\"line\"></span><br><span class=\"line\">        if ($curl-&gt;httpStatusCode !&#x3D; 200) &#123;</span><br><span class=\"line\">            $this-&gt;markFailed(302, &#39;获取session_key失败&#39;);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $response &#x3D; json_decode($curl-&gt;rawResponse, true);</span><br><span class=\"line\">            if (isset($response[&#39;openid&#39;]) &amp;&amp; !empty($response[&#39;openid&#39;])) &#123;</span><br><span class=\"line\">                $openId &#x3D; $response[&#39;openid&#39;];</span><br><span class=\"line\">                $unionId &#x3D; isset($response[&#39;unionid&#39;]) ? $response[&#39;unionid&#39;] : &#39;&#39;;</span><br><span class=\"line\">                $wechatAppUserData &#x3D; [</span><br><span class=\"line\">                    &#39;open_id&#39; &#x3D;&gt; trim($openId),</span><br><span class=\"line\">                    &#39;expires_at&#39; &#x3D;&gt; $response[&#39;expires_in&#39;] + $timestamp,</span><br><span class=\"line\">                    &#39;session_key&#39; &#x3D;&gt; trim($response[&#39;session_key&#39;]),</span><br><span class=\"line\">                    &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                ];</span><br><span class=\"line\"></span><br><span class=\"line\">                &#x2F;&#x2F; 生成 3rd_session</span><br><span class=\"line\">                $cjSessionKey &#x3D; $this-&gt;wechatAppUserRepository-&gt;opensslEncrypt($openId . $timestamp);</span><br><span class=\"line\">                $expiresAt &#x3D; Carbon::now()-&gt;addSeconds($response[&#39;expires_in&#39;])-&gt;addWeek();</span><br><span class=\"line\">                &#x2F;&#x2F; 所需的数据存入 redis 缓存</span><br><span class=\"line\">                Cache::put(md5($cjSessionKey), $wechatAppUserData, $expiresAt);</span><br><span class=\"line\">                $returnData &#x3D; [</span><br><span class=\"line\">                    &#39;cj_session_key&#39; &#x3D;&gt; $cjSessionKey, </span><br><span class=\"line\">                    &#39;expiresAt&#39; &#x3D;&gt; $expiresAt, </span><br><span class=\"line\">                    &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                ];</span><br><span class=\"line\">                $this-&gt;markSuccess();</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                $this-&gt;markFailed(302, &#39;获取session_key失败&#39;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $this-&gt;returnData[&#39;data&#39;] &#x3D; $returnData;</span><br><span class=\"line\">    return $this-&gt;returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3-如果需要获取-openid，unionid-等更多用户数据需要用户授权后才能拿到\"><a href=\"#3-如果需要获取-openid，unionid-等更多用户数据需要用户授权后才能拿到\" class=\"headerlink\" title=\"3. 如果需要获取 openid，unionid 等更多用户数据需要用户授权后才能拿到\"></a>3. 如果需要获取 openid，unionid 等更多用户数据需要用户授权后才能拿到</h1><h2 id=\"1-wx-authorize-OBJECT\"><a href=\"#1-wx-authorize-OBJECT\" class=\"headerlink\" title=\"1. wx.authorize(OBJECT)\"></a>1. wx.authorize(OBJECT)</h2><p>提前向用户发起授权请求。调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口。如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 可以通过 wx.getSetting 先查询一下用户是否授权了 &quot;scope.userInfo&quot; 这个 scope</span><br><span class=\"line\">wx.getSetting(&#123;</span><br><span class=\"line\">  success(res) &#123;</span><br><span class=\"line\">    if (!res.authSetting[&#39;scope.userInfo&#39;]) &#123;</span><br><span class=\"line\">      wx.authorize(&#123;</span><br><span class=\"line\">        scope: &#39;scope.userInfo&#39;,</span><br><span class=\"line\">        success() &#123;</span><br><span class=\"line\">          &#x2F;&#x2F; 用户已经同意小程序使用用户信息功能，后续调用 wx.getUserInfo 接口不会弹窗询问</span><br><span class=\"line\">          wx.getUserInfo()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-wx-getUserInfo-OBJECT\"><a href=\"#2-wx-getUserInfo-OBJECT\" class=\"headerlink\" title=\"2. wx.getUserInfo(OBJECT)\"></a>2. wx.getUserInfo(OBJECT)</h2><p>获取用户信息，withCredentials 为 true 时需要先调用 wx.login 接口。</p>\n<p>在合适的时机，调用该方法，弹窗用户授权窗口，用户点击同意后进行后续操作。同时必须要完成用户拒绝的逻辑。</p>\n<p>需要传入小程序本地的 sessionKey （全局变量中， 先根据全局变量的 sessionKeyExpiresAt 判断是否过期，如已过期，需要重新调用 login 方法获取新的），服务端拿到sessionKey后从缓存中取得用户的 session_key，才可以进行后续的操作。</p>\n<blockquote>\n<p>小程序端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUserInfoFromServer: function (cjSessionKey) &#123;</span><br><span class=\"line\">    var that &#x3D; this;</span><br><span class=\"line\">    wx.getUserInfo(&#123;</span><br><span class=\"line\">      withCredentials: true,</span><br><span class=\"line\">      success: function (res) &#123;</span><br><span class=\"line\">        that.globalData.userInfo &#x3D; res.userInfo;</span><br><span class=\"line\">        wx.request(&#123;</span><br><span class=\"line\">          url: &#39;api userinfo address&#39;,</span><br><span class=\"line\">          method: &#39;POST&#39;,</span><br><span class=\"line\">          data: &#123;</span><br><span class=\"line\">            iv: res.iv,</span><br><span class=\"line\">            cjSessionKey: cjSessionKey,</span><br><span class=\"line\">            encryptedData: res.encryptedData</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          success: function (res) &#123;</span><br><span class=\"line\">            if (res.data.code !&#x3D; 200) &#123;</span><br><span class=\"line\">              wx.showToast(&#123;</span><br><span class=\"line\">                title: res.data.msg,</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">              that.globalData.unionId &#x3D; res.data.data.union_id;</span><br><span class=\"line\">              that.globalData.userId &#x3D; res.data.data.user_id;</span><br><span class=\"line\">              that.globalData.password &#x3D; res.data.data.password;</span><br><span class=\"line\">              that.globalData.username &#x3D; res.data.data.username;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          fail: function () &#123;</span><br><span class=\"line\">            wx.showToast(&#123;</span><br><span class=\"line\">              title: &#39;服务器连接失败&#39;,</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: function (res) &#123;</span><br><span class=\"line\">        console.log(res);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>服务端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function postUserInfo(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $iv &#x3D; trim($request-&gt;input(&#39;iv&#39;, &#39;&#39;));</span><br><span class=\"line\">    $cjSessionKey &#x3D; trim($request-&gt;input(&#39;cjSessionKey&#39;, &#39;&#39;));</span><br><span class=\"line\">    $encryptedData &#x3D; trim($request-&gt;input(&#39;encryptedData&#39;, &#39;&#39;));</span><br><span class=\"line\">    $ip &#x3D; getClientIp();</span><br><span class=\"line\">    $flag &#x3D; true;</span><br><span class=\"line\">    $source &#x3D; &#39;mina&#39;;</span><br><span class=\"line\">    $returnData &#x3D; [];</span><br><span class=\"line\"></span><br><span class=\"line\">    if (empty($iv)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(303, &#39;iv 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125; elseif (empty($cjSessionKey)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(304, &#39;cjSessionKey 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125; elseif (empty($encryptedData)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(305, &#39;encryptedData 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($flag) &#123;</span><br><span class=\"line\">        $sessionData &#x3D; Cache::get(md5($cjSessionKey));</span><br><span class=\"line\">        if (empty($sessionData)) &#123;</span><br><span class=\"line\">            $this-&gt;markFailed(306, &#39;session 信息已过期&#39;);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $sessionKey &#x3D; $sessionData[&#39;session_key&#39;];</span><br><span class=\"line\">            $configData &#x3D; config(&#39;mina&#39;);</span><br><span class=\"line\">            $data &#x3D; null;</span><br><span class=\"line\"></span><br><span class=\"line\">            $pc &#x3D; new WXBizDataCrypt($configData[&#39;app_id&#39;], trim($sessionKey));</span><br><span class=\"line\">            $errorCode &#x3D; $pc-&gt;decryptData($encryptedData, $iv, $data);</span><br><span class=\"line\"></span><br><span class=\"line\">            $cLogModel-&gt;addInfo(&#39;解密后的 code: &#39; . $errorCode);</span><br><span class=\"line\">            $cLogModel-&gt;addInfo(&#39;解密后的 data: &#39; . $data);</span><br><span class=\"line\"></span><br><span class=\"line\">            if ($errorCode &#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">                $userInfo &#x3D; json_decode($data, true);</span><br><span class=\"line\">                &#x2F;&#x2F; 处理自己的业务逻辑，这里没有 unionId 不处理</span><br><span class=\"line\">                if (isset($userInfo[&#39;unionId&#39;]) &amp;&amp;</span><br><span class=\"line\">                    !empty($userInfo[&#39;unionId&#39;]) &amp;&amp;</span><br><span class=\"line\">                    !empty($userInfo[&#39;watermark&#39;]) &amp;&amp;</span><br><span class=\"line\">                    !empty($userInfo[&#39;watermark&#39;][&#39;appid&#39;]) &amp;&amp;</span><br><span class=\"line\">                    $userInfo[&#39;watermark&#39;][&#39;appid&#39;] &#x3D;&#x3D; $configData[&#39;app_id&#39;]</span><br><span class=\"line\">                ) &#123;</span><br><span class=\"line\">                    $unionId &#x3D; $userInfo[&#39;unionId&#39;];</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    if (condition) &#123;</span><br><span class=\"line\">                        &#x2F;&#x2F; 已经在平台注册，取出用户基本数据并返回</span><br><span class=\"line\">                        $returnData &#x3D; [</span><br><span class=\"line\">                            &#39;user_id&#39; &#x3D;&gt; &#39;data user id&#39;,</span><br><span class=\"line\">                            &#39;username&#39; &#x3D;&gt; &#39;data username&#39;,</span><br><span class=\"line\">                            &#39;password&#39; &#x3D;&gt; &#39;data password&#39;,</span><br><span class=\"line\">                            &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                        ];</span><br><span class=\"line\">                        $this-&gt;markSuccess();</span><br><span class=\"line\">                    &#125; else &#123;</span><br><span class=\"line\">                        &#x2F;&#x2F; 没有在平台注册，模拟注册，基本数据返回</span><br><span class=\"line\">                        $returnData &#x3D; [</span><br><span class=\"line\">                            &#39;user_id&#39; &#x3D;&gt; &#39;data user id&#39;,</span><br><span class=\"line\">                            &#39;username&#39; &#x3D;&gt; &#39;data username&#39;,</span><br><span class=\"line\">                            &#39;password&#39; &#x3D;&gt; &#39;data password&#39;,</span><br><span class=\"line\">                            &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                        ];</span><br><span class=\"line\">                        $this-&gt;markSuccess();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    $this-&gt;markFailed(310, &#39;appid 不匹配&#39;);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                $this-&gt;markFailed(307, &#39;encryptedData 解密失败&#39;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $this-&gt;returnData[&#39;data&#39;] &#x3D; $returnData;</span><br><span class=\"line\">    return $this-&gt;returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"4-大坑\"><a href=\"#4-大坑\" class=\"headerlink\" title=\"4. 大坑\"></a>4. 大坑</h1><h2 id=\"1-UnionID机制说明\"><a href=\"#1-UnionID机制说明\" class=\"headerlink\" title=\"1. UnionID机制说明\"></a>1. UnionID机制说明</h2><p>如果开发者拥有多个移动应用、网站应用、和公众帐号（包括小程序），可通过unionid来区分用户的唯一性，因为只要是同一个微信开放平台帐号下的移动应用、网站应用和公众帐号（包括小程序），用户的unionid是唯一的。换句话说，同一用户，对同一个微信开放平台下的不同应用，unionid是相同的。</p>\n<p>同一个微信开放平台下的相同主体的App、公众号、小程序，如果用户已经关注公众号，或者曾经登录过App或公众号，则用户打开小程序时，开发者可以直接通过wx.login获取到该用户UnionID，无须用户再次授权。</p>\n<blockquote>\n<p>需要到微信开发平台绑定小程序之后才能拿到 unionid</p>\n</blockquote>\n<h2 id=\"2-加密数据解密算法\"><a href=\"#2-加密数据解密算法\" class=\"headerlink\" title=\"2. 加密数据解密算法\"></a>2. 加密数据解密算法</h2><p>微信官方提供了多种编程语言的示例代码（<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/demo/aes-sample.zip\">点击下载</a>）。每种语言类型的接口名字均一致。调用方式可以参照示例。</p>\n<p>这里提供的PHP代码，首先编码格式就有问题，完全无法使用。需要复制出来以项目所用的编码方式重新进行保存。</p>\n<p>类 WXBizDataCrypt 的构造方法需要改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function __construct($appid, $sessionKey)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $this-&gt;sessionKey &#x3D; $sessionKey;</span><br><span class=\"line\">    $this-&gt;appid &#x3D; $appid;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用方法见上面的服务端代码。</p>\n","site":{"data":{}},"excerpt":"<p>小程序的微信登录授权前前后后折腾了有两周，这里记录一下整个流程和踩坑记录。</p>\n<h1 id=\"1-登录时序图\"><a href=\"#1-登录时序图\" class=\"headerlink\" title=\"1. 登录时序图\"></a>1. 登录时序图</h1><p>首先祭出官方提供的登录时序图，登录流程主要按照时序图来完成。</p>","more":"<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-1-18/77955544.jpg\"></p>\n<h1 id=\"2-静默获取用户数据\"><a href=\"#2-静默获取用户数据\" class=\"headerlink\" title=\"2. 静默获取用户数据\"></a>2. 静默获取用户数据</h1><h2 id=\"1-wx-login-登录接口\"><a href=\"#1-wx-login-登录接口\" class=\"headerlink\" title=\"1. wx.login() 登录接口\"></a>1. wx.login() 登录接口</h2><p>调用接口获取登录凭证（code）进而换取用户登录态信息，包括用户的唯一标识（openid） 及本次登录的 会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。</p>\n<p>注：调用 login 会引起登录态的刷新，之前的 sessionKey 可能会失效。</p>\n<h2 id=\"2-wx-checkSession-OBJECT\"><a href=\"#2-wx-checkSession-OBJECT\" class=\"headerlink\" title=\"2. wx.checkSession(OBJECT)\"></a>2. wx.checkSession(OBJECT)</h2><p>通过上述接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用wx.checkSession接口检测当前用户登录态是否有效。登录态过期后开发者可以再调用wx.login获取新的用户登录态。</p>\n<blockquote>\n<p>以上两个方法静默调用，直接在 app.js 的 onLaunch 方法使用即可。</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F;app.js</span><br><span class=\"line\">App(&#123;</span><br><span class=\"line\">  onLaunch: function () &#123;</span><br><span class=\"line\">    wx.checkSession(&#123;</span><br><span class=\"line\">      success: function () &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;session 未过期，并且在本生命周期一直有效</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: function () &#123;</span><br><span class=\"line\">        &#x2F;&#x2F;登录态过期</span><br><span class=\"line\">        wx.login(&#123; &#x2F;&#x2F;重新登录</span><br><span class=\"line\">          success: function (res) &#123;</span><br><span class=\"line\">            if (res.code) &#123;</span><br><span class=\"line\">              &#x2F;&#x2F;发起网络请求</span><br><span class=\"line\">              this.getSessionKeyFromServer(res.code);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">              console.log(&#39;获取用户登录态失败！&#39; + res.errMsg)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-login-方法成功后返回-code，-为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用-api，使用-code-换取-openid-和-session-key-等信息\"><a href=\"#3-login-方法成功后返回-code，-为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用-api，使用-code-换取-openid-和-session-key-等信息\" class=\"headerlink\" title=\"3. login 方法成功后返回 code， 为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 api，使用 code 换取 openid 和 session_key 等信息\"></a>3. login 方法成功后返回 code， 为用户登录凭证（有效期五分钟）。开发者需要在开发者服务器后台调用 api，使用 code 换取 openid 和 session_key 等信息</h2><blockquote>\n<p>小程序端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getSessionKeyFromServer: function (code) &#123;</span><br><span class=\"line\">    var that &#x3D; this;</span><br><span class=\"line\">    wx.request(&#123;</span><br><span class=\"line\">      url: &#39;api address&#39;, &#x2F;&#x2F; 我们自己服务器定义的接口地址</span><br><span class=\"line\">      method: &#39;POST&#39;,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        code: code,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      success: function (res) &#123;</span><br><span class=\"line\">        console.log(&#39;get session key: &#39;, res.data);</span><br><span class=\"line\">        if (res.data.code &#x3D;&#x3D; 200) &#123;</span><br><span class=\"line\">          &#x2F;&#x2F; 满足一定条件的用户，可以直接获取到 union_id，无需再次去解密</span><br><span class=\"line\">          if (res.data.data.union_id) &#123;</span><br><span class=\"line\">            that.globalData.unionId &#x3D; res.data.data.union_id;</span><br><span class=\"line\">          &#125; else &#123;</span><br><span class=\"line\">            if (res.data.data.cj_session_key) &#123;</span><br><span class=\"line\">              var cjSessionKey &#x3D; res.data.data.cj_session_key;</span><br><span class=\"line\">              &#x2F;&#x2F; 存入全局变量中，后续获取用户信息会使用到</span><br><span class=\"line\">              that.globalData.cjSessionKey &#x3D; res.data.data.cj_session_key;</span><br><span class=\"line\">              that.globalData.sessionKeyExpiresAt &#x3D; res.data.data.expiresAt;</span><br><span class=\"line\">              &#x2F;&#x2F; that.getUserInfoFromServer(cjSessionKey);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">          wx.showToast(&#123;</span><br><span class=\"line\">            title: &#39;session 获取失败&#39;,</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: function (res) &#123;</span><br><span class=\"line\">        wx.showToast(&#123;</span><br><span class=\"line\">          title: &#39;session 获取失败&#39;,</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>server 端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function postSessionKey(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $timestamp &#x3D; (new Carbon())-&gt;timestamp;</span><br><span class=\"line\">    $code &#x3D; trim($request-&gt;input(&#39;code&#39;, &#39;&#39;));</span><br><span class=\"line\">    $flag &#x3D; true;</span><br><span class=\"line\">    $returnData &#x3D; [];</span><br><span class=\"line\"></span><br><span class=\"line\">    if (empty($code)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(301, &#39;code 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($flag) &#123;</span><br><span class=\"line\">        $url &#x3D; &#39;https:&#x2F;&#x2F;api.weixin.qq.com&#x2F;sns&#x2F;jscode2session&#39;;</span><br><span class=\"line\">        $curl &#x3D; new Curl();</span><br><span class=\"line\"></span><br><span class=\"line\">        $getData &#x3D; [</span><br><span class=\"line\">            &#39;appid&#39; &#x3D;&gt; &#39;app id&#39;,</span><br><span class=\"line\">            &#39;secret&#39; &#x3D;&gt; &#39;app secret&#39;,</span><br><span class=\"line\">            &#39;js_code&#39; &#x3D;&gt; $code,</span><br><span class=\"line\">            &#39;grant_type&#39; &#x3D;&gt; &#39;authorization_code&#39;,</span><br><span class=\"line\">        ];</span><br><span class=\"line\">        $curl-&gt;get($url, $getData);</span><br><span class=\"line\"></span><br><span class=\"line\">        if ($curl-&gt;httpStatusCode !&#x3D; 200) &#123;</span><br><span class=\"line\">            $this-&gt;markFailed(302, &#39;获取session_key失败&#39;);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $response &#x3D; json_decode($curl-&gt;rawResponse, true);</span><br><span class=\"line\">            if (isset($response[&#39;openid&#39;]) &amp;&amp; !empty($response[&#39;openid&#39;])) &#123;</span><br><span class=\"line\">                $openId &#x3D; $response[&#39;openid&#39;];</span><br><span class=\"line\">                $unionId &#x3D; isset($response[&#39;unionid&#39;]) ? $response[&#39;unionid&#39;] : &#39;&#39;;</span><br><span class=\"line\">                $wechatAppUserData &#x3D; [</span><br><span class=\"line\">                    &#39;open_id&#39; &#x3D;&gt; trim($openId),</span><br><span class=\"line\">                    &#39;expires_at&#39; &#x3D;&gt; $response[&#39;expires_in&#39;] + $timestamp,</span><br><span class=\"line\">                    &#39;session_key&#39; &#x3D;&gt; trim($response[&#39;session_key&#39;]),</span><br><span class=\"line\">                    &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                ];</span><br><span class=\"line\"></span><br><span class=\"line\">                &#x2F;&#x2F; 生成 3rd_session</span><br><span class=\"line\">                $cjSessionKey &#x3D; $this-&gt;wechatAppUserRepository-&gt;opensslEncrypt($openId . $timestamp);</span><br><span class=\"line\">                $expiresAt &#x3D; Carbon::now()-&gt;addSeconds($response[&#39;expires_in&#39;])-&gt;addWeek();</span><br><span class=\"line\">                &#x2F;&#x2F; 所需的数据存入 redis 缓存</span><br><span class=\"line\">                Cache::put(md5($cjSessionKey), $wechatAppUserData, $expiresAt);</span><br><span class=\"line\">                $returnData &#x3D; [</span><br><span class=\"line\">                    &#39;cj_session_key&#39; &#x3D;&gt; $cjSessionKey, </span><br><span class=\"line\">                    &#39;expiresAt&#39; &#x3D;&gt; $expiresAt, </span><br><span class=\"line\">                    &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                ];</span><br><span class=\"line\">                $this-&gt;markSuccess();</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                $this-&gt;markFailed(302, &#39;获取session_key失败&#39;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $this-&gt;returnData[&#39;data&#39;] &#x3D; $returnData;</span><br><span class=\"line\">    return $this-&gt;returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"3-如果需要获取-openid，unionid-等更多用户数据需要用户授权后才能拿到\"><a href=\"#3-如果需要获取-openid，unionid-等更多用户数据需要用户授权后才能拿到\" class=\"headerlink\" title=\"3. 如果需要获取 openid，unionid 等更多用户数据需要用户授权后才能拿到\"></a>3. 如果需要获取 openid，unionid 等更多用户数据需要用户授权后才能拿到</h1><h2 id=\"1-wx-authorize-OBJECT\"><a href=\"#1-wx-authorize-OBJECT\" class=\"headerlink\" title=\"1. wx.authorize(OBJECT)\"></a>1. wx.authorize(OBJECT)</h2><p>提前向用户发起授权请求。调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口。如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 可以通过 wx.getSetting 先查询一下用户是否授权了 &quot;scope.userInfo&quot; 这个 scope</span><br><span class=\"line\">wx.getSetting(&#123;</span><br><span class=\"line\">  success(res) &#123;</span><br><span class=\"line\">    if (!res.authSetting[&#39;scope.userInfo&#39;]) &#123;</span><br><span class=\"line\">      wx.authorize(&#123;</span><br><span class=\"line\">        scope: &#39;scope.userInfo&#39;,</span><br><span class=\"line\">        success() &#123;</span><br><span class=\"line\">          &#x2F;&#x2F; 用户已经同意小程序使用用户信息功能，后续调用 wx.getUserInfo 接口不会弹窗询问</span><br><span class=\"line\">          wx.getUserInfo()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-wx-getUserInfo-OBJECT\"><a href=\"#2-wx-getUserInfo-OBJECT\" class=\"headerlink\" title=\"2. wx.getUserInfo(OBJECT)\"></a>2. wx.getUserInfo(OBJECT)</h2><p>获取用户信息，withCredentials 为 true 时需要先调用 wx.login 接口。</p>\n<p>在合适的时机，调用该方法，弹窗用户授权窗口，用户点击同意后进行后续操作。同时必须要完成用户拒绝的逻辑。</p>\n<p>需要传入小程序本地的 sessionKey （全局变量中， 先根据全局变量的 sessionKeyExpiresAt 判断是否过期，如已过期，需要重新调用 login 方法获取新的），服务端拿到sessionKey后从缓存中取得用户的 session_key，才可以进行后续的操作。</p>\n<blockquote>\n<p>小程序端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getUserInfoFromServer: function (cjSessionKey) &#123;</span><br><span class=\"line\">    var that &#x3D; this;</span><br><span class=\"line\">    wx.getUserInfo(&#123;</span><br><span class=\"line\">      withCredentials: true,</span><br><span class=\"line\">      success: function (res) &#123;</span><br><span class=\"line\">        that.globalData.userInfo &#x3D; res.userInfo;</span><br><span class=\"line\">        wx.request(&#123;</span><br><span class=\"line\">          url: &#39;api userinfo address&#39;,</span><br><span class=\"line\">          method: &#39;POST&#39;,</span><br><span class=\"line\">          data: &#123;</span><br><span class=\"line\">            iv: res.iv,</span><br><span class=\"line\">            cjSessionKey: cjSessionKey,</span><br><span class=\"line\">            encryptedData: res.encryptedData</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          success: function (res) &#123;</span><br><span class=\"line\">            if (res.data.code !&#x3D; 200) &#123;</span><br><span class=\"line\">              wx.showToast(&#123;</span><br><span class=\"line\">                title: res.data.msg,</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">              that.globalData.unionId &#x3D; res.data.data.union_id;</span><br><span class=\"line\">              that.globalData.userId &#x3D; res.data.data.user_id;</span><br><span class=\"line\">              that.globalData.password &#x3D; res.data.data.password;</span><br><span class=\"line\">              that.globalData.username &#x3D; res.data.data.username;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          fail: function () &#123;</span><br><span class=\"line\">            wx.showToast(&#123;</span><br><span class=\"line\">              title: &#39;服务器连接失败&#39;,</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      fail: function (res) &#123;</span><br><span class=\"line\">        console.log(res);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>服务端代码</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function postUserInfo(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $iv &#x3D; trim($request-&gt;input(&#39;iv&#39;, &#39;&#39;));</span><br><span class=\"line\">    $cjSessionKey &#x3D; trim($request-&gt;input(&#39;cjSessionKey&#39;, &#39;&#39;));</span><br><span class=\"line\">    $encryptedData &#x3D; trim($request-&gt;input(&#39;encryptedData&#39;, &#39;&#39;));</span><br><span class=\"line\">    $ip &#x3D; getClientIp();</span><br><span class=\"line\">    $flag &#x3D; true;</span><br><span class=\"line\">    $source &#x3D; &#39;mina&#39;;</span><br><span class=\"line\">    $returnData &#x3D; [];</span><br><span class=\"line\"></span><br><span class=\"line\">    if (empty($iv)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(303, &#39;iv 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125; elseif (empty($cjSessionKey)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(304, &#39;cjSessionKey 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125; elseif (empty($encryptedData)) &#123;</span><br><span class=\"line\">        $this-&gt;markFailed(305, &#39;encryptedData 不能为空&#39;);</span><br><span class=\"line\">        $flag &#x3D; false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    if ($flag) &#123;</span><br><span class=\"line\">        $sessionData &#x3D; Cache::get(md5($cjSessionKey));</span><br><span class=\"line\">        if (empty($sessionData)) &#123;</span><br><span class=\"line\">            $this-&gt;markFailed(306, &#39;session 信息已过期&#39;);</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $sessionKey &#x3D; $sessionData[&#39;session_key&#39;];</span><br><span class=\"line\">            $configData &#x3D; config(&#39;mina&#39;);</span><br><span class=\"line\">            $data &#x3D; null;</span><br><span class=\"line\"></span><br><span class=\"line\">            $pc &#x3D; new WXBizDataCrypt($configData[&#39;app_id&#39;], trim($sessionKey));</span><br><span class=\"line\">            $errorCode &#x3D; $pc-&gt;decryptData($encryptedData, $iv, $data);</span><br><span class=\"line\"></span><br><span class=\"line\">            $cLogModel-&gt;addInfo(&#39;解密后的 code: &#39; . $errorCode);</span><br><span class=\"line\">            $cLogModel-&gt;addInfo(&#39;解密后的 data: &#39; . $data);</span><br><span class=\"line\"></span><br><span class=\"line\">            if ($errorCode &#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">                $userInfo &#x3D; json_decode($data, true);</span><br><span class=\"line\">                &#x2F;&#x2F; 处理自己的业务逻辑，这里没有 unionId 不处理</span><br><span class=\"line\">                if (isset($userInfo[&#39;unionId&#39;]) &amp;&amp;</span><br><span class=\"line\">                    !empty($userInfo[&#39;unionId&#39;]) &amp;&amp;</span><br><span class=\"line\">                    !empty($userInfo[&#39;watermark&#39;]) &amp;&amp;</span><br><span class=\"line\">                    !empty($userInfo[&#39;watermark&#39;][&#39;appid&#39;]) &amp;&amp;</span><br><span class=\"line\">                    $userInfo[&#39;watermark&#39;][&#39;appid&#39;] &#x3D;&#x3D; $configData[&#39;app_id&#39;]</span><br><span class=\"line\">                ) &#123;</span><br><span class=\"line\">                    $unionId &#x3D; $userInfo[&#39;unionId&#39;];</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    if (condition) &#123;</span><br><span class=\"line\">                        &#x2F;&#x2F; 已经在平台注册，取出用户基本数据并返回</span><br><span class=\"line\">                        $returnData &#x3D; [</span><br><span class=\"line\">                            &#39;user_id&#39; &#x3D;&gt; &#39;data user id&#39;,</span><br><span class=\"line\">                            &#39;username&#39; &#x3D;&gt; &#39;data username&#39;,</span><br><span class=\"line\">                            &#39;password&#39; &#x3D;&gt; &#39;data password&#39;,</span><br><span class=\"line\">                            &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                        ];</span><br><span class=\"line\">                        $this-&gt;markSuccess();</span><br><span class=\"line\">                    &#125; else &#123;</span><br><span class=\"line\">                        &#x2F;&#x2F; 没有在平台注册，模拟注册，基本数据返回</span><br><span class=\"line\">                        $returnData &#x3D; [</span><br><span class=\"line\">                            &#39;user_id&#39; &#x3D;&gt; &#39;data user id&#39;,</span><br><span class=\"line\">                            &#39;username&#39; &#x3D;&gt; &#39;data username&#39;,</span><br><span class=\"line\">                            &#39;password&#39; &#x3D;&gt; &#39;data password&#39;,</span><br><span class=\"line\">                            &#39;union_id&#39; &#x3D;&gt; $unionId</span><br><span class=\"line\">                        ];</span><br><span class=\"line\">                        $this-&gt;markSuccess();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    $this-&gt;markFailed(310, &#39;appid 不匹配&#39;);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">                $this-&gt;markFailed(307, &#39;encryptedData 解密失败&#39;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    $this-&gt;returnData[&#39;data&#39;] &#x3D; $returnData;</span><br><span class=\"line\">    return $this-&gt;returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"4-大坑\"><a href=\"#4-大坑\" class=\"headerlink\" title=\"4. 大坑\"></a>4. 大坑</h1><h2 id=\"1-UnionID机制说明\"><a href=\"#1-UnionID机制说明\" class=\"headerlink\" title=\"1. UnionID机制说明\"></a>1. UnionID机制说明</h2><p>如果开发者拥有多个移动应用、网站应用、和公众帐号（包括小程序），可通过unionid来区分用户的唯一性，因为只要是同一个微信开放平台帐号下的移动应用、网站应用和公众帐号（包括小程序），用户的unionid是唯一的。换句话说，同一用户，对同一个微信开放平台下的不同应用，unionid是相同的。</p>\n<p>同一个微信开放平台下的相同主体的App、公众号、小程序，如果用户已经关注公众号，或者曾经登录过App或公众号，则用户打开小程序时，开发者可以直接通过wx.login获取到该用户UnionID，无须用户再次授权。</p>\n<blockquote>\n<p>需要到微信开发平台绑定小程序之后才能拿到 unionid</p>\n</blockquote>\n<h2 id=\"2-加密数据解密算法\"><a href=\"#2-加密数据解密算法\" class=\"headerlink\" title=\"2. 加密数据解密算法\"></a>2. 加密数据解密算法</h2><p>微信官方提供了多种编程语言的示例代码（<a href=\"https://mp.weixin.qq.com/debug/wxadoc/dev/demo/aes-sample.zip\">点击下载</a>）。每种语言类型的接口名字均一致。调用方式可以参照示例。</p>\n<p>这里提供的PHP代码，首先编码格式就有问题，完全无法使用。需要复制出来以项目所用的编码方式重新进行保存。</p>\n<p>类 WXBizDataCrypt 的构造方法需要改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function __construct($appid, $sessionKey)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $this-&gt;sessionKey &#x3D; $sessionKey;</span><br><span class=\"line\">    $this-&gt;appid &#x3D; $appid;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用方法见上面的服务端代码。</p>"},{"title":"常见算法","date":"2018-02-16T11:36:39.000Z","_content":"\n> 写出常见的排序算法，并用 PHP 实现冒泡排序，将数组按照从小到大的方式进行排序\n\n<!--more-->\n\n考点：\n- 冒泡排序的原理和实现\n- 延伸：算法的概念\n- 延伸：时间复杂度和空间复杂度的概念\n- 延伸：常见排序算法\n- 延伸：常见查找算法\n\n### 1. 算法概念\n解决特定问题求解步骤的描述，在计算机中表现为指令的有限序列，并且每条指令表示一个或多个操作\n\n一个问题可以有多种算法，每种算法都有不同的效率\n\n一个算法具有 5 个特性：有穷性（算法能计算完，不能是死循环）、确切性（每一步都要有意义）、输入项、输出项、可行性（可以执行，每一步都是正确的）。\n\n### 2. 算法评定\n算法分析的目的在于选择合适的算法和改进算法\n\n一个算法的评价主要是从时间复杂度和空间复杂度来考虑\n\n#### 1. 时间复杂度\n执行算法所需要的计算工作量，也就是时间消耗的效率。一般来说，计算机算法是问题规模 $$n$$ 的函数 $$f(n)$$，算法的时间复杂度也一次记作 $$T(n)=O(f(n))$$\n\n问题的规模 $$n$$ 越大，算法执行的时间的增长率与 $$f(n)$$ 的增长率正相关，称作渐进时间复杂度。\n\n##### 计算方式\n1. 得出算法的计算次数公式\n2. 用常数 $$1$$ 来取代所有时间中的所有加法常数，如 $$O(3)$$ 要写成 $$O(1)$$\n3. 在修改后的运行次数函数中，只保留最高阶项，如 $$O(n^2+n+1)$$ 要写成 $$O(n^2)$$\n4. 如果最高阶存在且不是1，则去除与这个项相乘的常数，如 $$O(3n)$$ 要写成 $$O(n)$$\n\n\n##### 举例\n\n1. 常数阶：$$O(1)$$\n``` php\n<?php\n$n = 3;\necho $n;\necho $n;\necho $n;\n```\n\n2. 线性阶：$$O(n)$$\n``` php\n<?php\n$n = 100;\n$sum = 0;\nfor ($i = 0; $i < $n; ++$i) {\n\t$sum += $n;\n}\necho $sum;\n```\n\n3. 平（立）方阶：$$O(n^2)/O(n^3)$$\n``` php\n<?php\n$n = 100;\n$sum = 0;\nfor ($i = 0; $i < $n; ++$i) {\n\tfor ($j = 0; $j < $n; ++$j) {\n\t\t$sum += $j;\n\t}\n}\necho $sum;\n```\n\n4. 对数阶：$$O(log_2n)$$\n\n``` php\n<?php\n$n = 1000;\nwhile ($n >= 1) {\n\t$n = $n/2;\n}\n```\n\n效率对比\n$$$\nO(1) > O(log_2n) > O(n) > O(nlog_2n) > O(n^2) > O(n^3) > O(2^n) > O(n!) > O(n^n)\n$$$\n\n最坏情况，如果没有特别说明，时间复杂度就是指最坏情况下的时间复杂度\n\n\n#### 2. 空间复杂度\n\n算法需要消耗的内存空间，记作 $$S(n)=O(f(n))$$\n\n包括程序代码所占用的空间，输入数据所占用的空间和辅助变量所占用的空间三部分\n\n计算和表示方法与时间复杂度类似，一般用复杂度的渐进性来表示\n\n有时用空间换取时间\n\n冒泡排序的元素交换，空间复杂度$$O(1)$$\n\n排序算法：冒泡排序、直接插入排序、希尔排序、选择排序、快速排序、堆排序、归并排序\n\n### 3. 排序算法\n\n#### 1. 冒泡排序\n原理：两两相邻的数进行比较，如果反序就交换，否则不交换\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$\n\n空间复杂度：$$O(1)$$\n\n对于一个长度为 N 的数组，我们需要排序 N-1 轮，每 i 轮 要比较 N-i 次。对此我们可以用双重循环语句，外层循环控制循环轮次，内层循环控制每轮的比较次数。\n\n``` php\n<?php \nfunction order($arr) {\n  　　$count = count($arr);\n  　　$temp = 0; \n 　　 // 外层控制排序轮次\n  　　for ($i = 0; $i < $count - 1; $i++) {\n      　　// 内层控制每轮比较次数\n      　　for ($j = 0; $j < $count - 1- $i; $j++){\n            　　if ($arr[$j] > $arr[$j + 1]) {\n                　　$temp = $arr[$j];\n                　　$arr[$j] = $arr[$j + 1];\n                　　$arr[$j + 1] = $temp;\n           　　}\n     　　 }\n  　　} \n    return $arr;\n   }     \n\n\n $arr= array(6, 3, 8, 2, 9, 1);\n$res =  order($arr);\nvar_dump($res);\n```\n\n#### 2. 直接插入排序\n\n原理：每次从无序表中取出第一个元素，把它出入到有序表的合适位置，使有序表仍然有序\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$\n\n空间复杂度：$$O(1)$$\n\n#### 3. 希尔排序（shell sort）\n希尔排序是基于插入排序的，区别在于插入排序是相邻的一个个比较（类似于希尔中 h=1 的情形），而希尔排序是距离 h 的比较和替换。\n\n希尔排序中一个常数因子 n，原数组被分成各个小组，每个小组由 h 个元素组成，很可能会有多余的元素。当然每次循环的时候，h 也是递减的（h=h/n）。第一次循环就是从下标为 h 开始。希尔排序的一个思想就是，分成小组去排序。\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n*log_2n)$$\n\n空间复杂度：$$O(1)$$\n\n#### 4. 选择排序\n\n原理：每次从待排序的数据元素中选出最小（或最大）的一个元素，存放在序列的起始位置，直到全部待排序的数据元素排完\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$\n\n空间复杂度：$$O(1)$$\n\n#### 5. 快速排序\n\n原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，\n如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作，\n不难发现，这里符合递归的原理，所以我们可以用递归来实现。\n使用递归，则需要找到递归点和递归出口：\n递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1\n递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(nlog_2n)$$\n\n空间复杂度：最坏 $$O(n)$$，平均 $$O(log_2n)$$\n\n#### 6 .堆排序\n\n二叉树。。。\n\n时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$\n\n空间复杂度：$$O(1)$$\n\n#### 7. 归并排序\n就是利用归并（合并）的思想实现的排序方法。它的原理是假设初始序列含有 n 个元素，则可以看成是 n 个有序的子序列，每个子序列的长度为 1，然后两两归并，得到 ⌈ n / 2⌉ （⌈ x ⌉ 表示不小于 x 的最小整数）个长度为 2 或 1 的有序序列；再两两归并，······，如此重复，直至得到一个长度为 n 的有序序列为止，这种排序方法就成为 2 路归并排序。\n\n\n时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$\n\n空间复杂度：$$O(n)$$\n\n#### 8. 总结\n\n快速排序、归并排序的理想时间复杂度都是 $$O(nlog_2n)$$，但是快速排序的时间复杂度并不稳定，最坏情况下复杂度为 $$O(n^2)$$，所以最理想的算法还是归并排序。\n\n\n### 4. 查找方法\n\n#### 1. 二分查找\n\n原理：从数组的中间元素开始，如果中间元素正好是要查找的元素，搜索结束，如果某一个特定的元素大于有这小鱼中间元素，则在数组大于或者小于中间元素的那一半中查找，而且跟开始一样从中间开始比较，如果某一步骤数组为空，表示找不到。\n\n时间复杂度：最坏 $$O(log_2n)$$，平均 $$O(log_2n)$$\n\n空间复杂度：迭代 $$O(1)$$，递归 $$O(log_2n)$$\n\n#### 2. 顺序查找\n\n原理：按一定的顺序检查数组中的每一个元素，直到找到所要寻找的特定值为止。\n\n时间复杂度：最差 $$O(n)$$，平均 $$O(n)$$\n\n空间复杂度：$$O(1)$$\n\n#### 3. 总结\n\n二分查找算法的时间复杂度最差是 $$O(log_2n)$$，顺序查找的时间复杂度最差为 $$O(n)$$，所以二分查找更快，但是递归条件下，二分查找更消耗内存。\n\n\n### 5. 解题方法\n\n需要充分理解各种排序算法和查找算法的原理以及实现方式，另外还需要理解时间复杂度和空间复杂度的计算方式和概念，考察的是逻辑思维能力，需要仔细研究各种算法的实现方式。\n\n\n### 6. 真题\n\n#### 1. 简述时间复杂度和空间复杂度的概念\n\n#### 2. 对无序数组排序，最优的时间复杂度是什么，用 PHP 或者 JavaScript 写出一个实际的例子，该算法的空间复杂度是多少？\n\n快速或归并\n\n#### 3. 一个有序数组中，查询特定 item 是否存在的最优算法是什么？时间复杂度多少？","source":"_posts/常见算法.md","raw":"---\ntitle: 常见算法\ndate: 2018-02-16 19:36:39\ntags: 算法\n---\n\n> 写出常见的排序算法，并用 PHP 实现冒泡排序，将数组按照从小到大的方式进行排序\n\n<!--more-->\n\n考点：\n- 冒泡排序的原理和实现\n- 延伸：算法的概念\n- 延伸：时间复杂度和空间复杂度的概念\n- 延伸：常见排序算法\n- 延伸：常见查找算法\n\n### 1. 算法概念\n解决特定问题求解步骤的描述，在计算机中表现为指令的有限序列，并且每条指令表示一个或多个操作\n\n一个问题可以有多种算法，每种算法都有不同的效率\n\n一个算法具有 5 个特性：有穷性（算法能计算完，不能是死循环）、确切性（每一步都要有意义）、输入项、输出项、可行性（可以执行，每一步都是正确的）。\n\n### 2. 算法评定\n算法分析的目的在于选择合适的算法和改进算法\n\n一个算法的评价主要是从时间复杂度和空间复杂度来考虑\n\n#### 1. 时间复杂度\n执行算法所需要的计算工作量，也就是时间消耗的效率。一般来说，计算机算法是问题规模 $$n$$ 的函数 $$f(n)$$，算法的时间复杂度也一次记作 $$T(n)=O(f(n))$$\n\n问题的规模 $$n$$ 越大，算法执行的时间的增长率与 $$f(n)$$ 的增长率正相关，称作渐进时间复杂度。\n\n##### 计算方式\n1. 得出算法的计算次数公式\n2. 用常数 $$1$$ 来取代所有时间中的所有加法常数，如 $$O(3)$$ 要写成 $$O(1)$$\n3. 在修改后的运行次数函数中，只保留最高阶项，如 $$O(n^2+n+1)$$ 要写成 $$O(n^2)$$\n4. 如果最高阶存在且不是1，则去除与这个项相乘的常数，如 $$O(3n)$$ 要写成 $$O(n)$$\n\n\n##### 举例\n\n1. 常数阶：$$O(1)$$\n``` php\n<?php\n$n = 3;\necho $n;\necho $n;\necho $n;\n```\n\n2. 线性阶：$$O(n)$$\n``` php\n<?php\n$n = 100;\n$sum = 0;\nfor ($i = 0; $i < $n; ++$i) {\n\t$sum += $n;\n}\necho $sum;\n```\n\n3. 平（立）方阶：$$O(n^2)/O(n^3)$$\n``` php\n<?php\n$n = 100;\n$sum = 0;\nfor ($i = 0; $i < $n; ++$i) {\n\tfor ($j = 0; $j < $n; ++$j) {\n\t\t$sum += $j;\n\t}\n}\necho $sum;\n```\n\n4. 对数阶：$$O(log_2n)$$\n\n``` php\n<?php\n$n = 1000;\nwhile ($n >= 1) {\n\t$n = $n/2;\n}\n```\n\n效率对比\n$$$\nO(1) > O(log_2n) > O(n) > O(nlog_2n) > O(n^2) > O(n^3) > O(2^n) > O(n!) > O(n^n)\n$$$\n\n最坏情况，如果没有特别说明，时间复杂度就是指最坏情况下的时间复杂度\n\n\n#### 2. 空间复杂度\n\n算法需要消耗的内存空间，记作 $$S(n)=O(f(n))$$\n\n包括程序代码所占用的空间，输入数据所占用的空间和辅助变量所占用的空间三部分\n\n计算和表示方法与时间复杂度类似，一般用复杂度的渐进性来表示\n\n有时用空间换取时间\n\n冒泡排序的元素交换，空间复杂度$$O(1)$$\n\n排序算法：冒泡排序、直接插入排序、希尔排序、选择排序、快速排序、堆排序、归并排序\n\n### 3. 排序算法\n\n#### 1. 冒泡排序\n原理：两两相邻的数进行比较，如果反序就交换，否则不交换\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$\n\n空间复杂度：$$O(1)$$\n\n对于一个长度为 N 的数组，我们需要排序 N-1 轮，每 i 轮 要比较 N-i 次。对此我们可以用双重循环语句，外层循环控制循环轮次，内层循环控制每轮的比较次数。\n\n``` php\n<?php \nfunction order($arr) {\n  　　$count = count($arr);\n  　　$temp = 0; \n 　　 // 外层控制排序轮次\n  　　for ($i = 0; $i < $count - 1; $i++) {\n      　　// 内层控制每轮比较次数\n      　　for ($j = 0; $j < $count - 1- $i; $j++){\n            　　if ($arr[$j] > $arr[$j + 1]) {\n                　　$temp = $arr[$j];\n                　　$arr[$j] = $arr[$j + 1];\n                　　$arr[$j + 1] = $temp;\n           　　}\n     　　 }\n  　　} \n    return $arr;\n   }     \n\n\n $arr= array(6, 3, 8, 2, 9, 1);\n$res =  order($arr);\nvar_dump($res);\n```\n\n#### 2. 直接插入排序\n\n原理：每次从无序表中取出第一个元素，把它出入到有序表的合适位置，使有序表仍然有序\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$\n\n空间复杂度：$$O(1)$$\n\n#### 3. 希尔排序（shell sort）\n希尔排序是基于插入排序的，区别在于插入排序是相邻的一个个比较（类似于希尔中 h=1 的情形），而希尔排序是距离 h 的比较和替换。\n\n希尔排序中一个常数因子 n，原数组被分成各个小组，每个小组由 h 个元素组成，很可能会有多余的元素。当然每次循环的时候，h 也是递减的（h=h/n）。第一次循环就是从下标为 h 开始。希尔排序的一个思想就是，分成小组去排序。\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n*log_2n)$$\n\n空间复杂度：$$O(1)$$\n\n#### 4. 选择排序\n\n原理：每次从待排序的数据元素中选出最小（或最大）的一个元素，存放在序列的起始位置，直到全部待排序的数据元素排完\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$\n\n空间复杂度：$$O(1)$$\n\n#### 5. 快速排序\n\n原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，\n如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作，\n不难发现，这里符合递归的原理，所以我们可以用递归来实现。\n使用递归，则需要找到递归点和递归出口：\n递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1\n递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。\n\n时间复杂度：最坏 $$O(n^2)$$，平均 $$O(nlog_2n)$$\n\n空间复杂度：最坏 $$O(n)$$，平均 $$O(log_2n)$$\n\n#### 6 .堆排序\n\n二叉树。。。\n\n时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$\n\n空间复杂度：$$O(1)$$\n\n#### 7. 归并排序\n就是利用归并（合并）的思想实现的排序方法。它的原理是假设初始序列含有 n 个元素，则可以看成是 n 个有序的子序列，每个子序列的长度为 1，然后两两归并，得到 ⌈ n / 2⌉ （⌈ x ⌉ 表示不小于 x 的最小整数）个长度为 2 或 1 的有序序列；再两两归并，······，如此重复，直至得到一个长度为 n 的有序序列为止，这种排序方法就成为 2 路归并排序。\n\n\n时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$\n\n空间复杂度：$$O(n)$$\n\n#### 8. 总结\n\n快速排序、归并排序的理想时间复杂度都是 $$O(nlog_2n)$$，但是快速排序的时间复杂度并不稳定，最坏情况下复杂度为 $$O(n^2)$$，所以最理想的算法还是归并排序。\n\n\n### 4. 查找方法\n\n#### 1. 二分查找\n\n原理：从数组的中间元素开始，如果中间元素正好是要查找的元素，搜索结束，如果某一个特定的元素大于有这小鱼中间元素，则在数组大于或者小于中间元素的那一半中查找，而且跟开始一样从中间开始比较，如果某一步骤数组为空，表示找不到。\n\n时间复杂度：最坏 $$O(log_2n)$$，平均 $$O(log_2n)$$\n\n空间复杂度：迭代 $$O(1)$$，递归 $$O(log_2n)$$\n\n#### 2. 顺序查找\n\n原理：按一定的顺序检查数组中的每一个元素，直到找到所要寻找的特定值为止。\n\n时间复杂度：最差 $$O(n)$$，平均 $$O(n)$$\n\n空间复杂度：$$O(1)$$\n\n#### 3. 总结\n\n二分查找算法的时间复杂度最差是 $$O(log_2n)$$，顺序查找的时间复杂度最差为 $$O(n)$$，所以二分查找更快，但是递归条件下，二分查找更消耗内存。\n\n\n### 5. 解题方法\n\n需要充分理解各种排序算法和查找算法的原理以及实现方式，另外还需要理解时间复杂度和空间复杂度的计算方式和概念，考察的是逻辑思维能力，需要仔细研究各种算法的实现方式。\n\n\n### 6. 真题\n\n#### 1. 简述时间复杂度和空间复杂度的概念\n\n#### 2. 对无序数组排序，最优的时间复杂度是什么，用 PHP 或者 JavaScript 写出一个实际的例子，该算法的空间复杂度是多少？\n\n快速或归并\n\n#### 3. 一个有序数组中，查询特定 item 是否存在的最优算法是什么？时间复杂度多少？","slug":"常见算法","published":1,"updated":"2020-09-11T01:04:35.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9v003n6wo15j6mdbl4","content":"<blockquote>\n<p>写出常见的排序算法，并用 PHP 实现冒泡排序，将数组按照从小到大的方式进行排序</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p>考点：</p>\n<ul>\n<li>冒泡排序的原理和实现</li>\n<li>延伸：算法的概念</li>\n<li>延伸：时间复杂度和空间复杂度的概念</li>\n<li>延伸：常见排序算法</li>\n<li>延伸：常见查找算法</li>\n</ul>\n<h3 id=\"1-算法概念\"><a href=\"#1-算法概念\" class=\"headerlink\" title=\"1. 算法概念\"></a>1. 算法概念</h3><p>解决特定问题求解步骤的描述，在计算机中表现为指令的有限序列，并且每条指令表示一个或多个操作</p>\n<p>一个问题可以有多种算法，每种算法都有不同的效率</p>\n<p>一个算法具有 5 个特性：有穷性（算法能计算完，不能是死循环）、确切性（每一步都要有意义）、输入项、输出项、可行性（可以执行，每一步都是正确的）。</p>\n<h3 id=\"2-算法评定\"><a href=\"#2-算法评定\" class=\"headerlink\" title=\"2. 算法评定\"></a>2. 算法评定</h3><p>算法分析的目的在于选择合适的算法和改进算法</p>\n<p>一个算法的评价主要是从时间复杂度和空间复杂度来考虑</p>\n<h4 id=\"1-时间复杂度\"><a href=\"#1-时间复杂度\" class=\"headerlink\" title=\"1. 时间复杂度\"></a>1. 时间复杂度</h4><p>执行算法所需要的计算工作量，也就是时间消耗的效率。一般来说，计算机算法是问题规模 $$n$$ 的函数 $$f(n)$$，算法的时间复杂度也一次记作 $$T(n)=O(f(n))$$</p>\n<p>问题的规模 $$n$$ 越大，算法执行的时间的增长率与 $$f(n)$$ 的增长率正相关，称作渐进时间复杂度。</p>\n<h5 id=\"计算方式\"><a href=\"#计算方式\" class=\"headerlink\" title=\"计算方式\"></a>计算方式</h5><ol>\n<li>得出算法的计算次数公式</li>\n<li>用常数 $$1$$ 来取代所有时间中的所有加法常数，如 $$O(3)$$ 要写成 $$O(1)$$</li>\n<li>在修改后的运行次数函数中，只保留最高阶项，如 $$O(n^2+n+1)$$ 要写成 $$O(n^2)$$</li>\n<li>如果最高阶存在且不是1，则去除与这个项相乘的常数，如 $$O(3n)$$ 要写成 $$O(n)$$</li>\n</ol>\n<h5 id=\"举例\"><a href=\"#举例\" class=\"headerlink\" title=\"举例\"></a>举例</h5><ol>\n<li><p>常数阶：$$O(1)$$</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $n;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $n;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $n;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>线性阶：$$O(n)$$</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">100</span>;</span><br><span class=\"line\">$sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $n; ++$i) &#123;</span><br><span class=\"line\">\t$sum += $n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $sum;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>平（立）方阶：$$O(n^2)/O(n^3)$$</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">100</span>;</span><br><span class=\"line\">$sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $n; ++$i) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ($j = <span class=\"number\">0</span>; $j &lt; $n; ++$j) &#123;</span><br><span class=\"line\">\t\t$sum += $j;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $sum;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>对数阶：$$O(log_2n)$$</p>\n</li>\n</ol>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">1000</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ($n &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t$n = $n/<span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>效率对比<br>$$$<br>O(1) &gt; O(log_2n) &gt; O(n) &gt; O(nlog_2n) &gt; O(n^2) &gt; O(n^3) &gt; O(2^n) &gt; O(n!) &gt; O(n^n)<br>$$$</p>\n<p>最坏情况，如果没有特别说明，时间复杂度就是指最坏情况下的时间复杂度</p>\n<h4 id=\"2-空间复杂度\"><a href=\"#2-空间复杂度\" class=\"headerlink\" title=\"2. 空间复杂度\"></a>2. 空间复杂度</h4><p>算法需要消耗的内存空间，记作 $$S(n)=O(f(n))$$</p>\n<p>包括程序代码所占用的空间，输入数据所占用的空间和辅助变量所占用的空间三部分</p>\n<p>计算和表示方法与时间复杂度类似，一般用复杂度的渐进性来表示</p>\n<p>有时用空间换取时间</p>\n<p>冒泡排序的元素交换，空间复杂度$$O(1)$$</p>\n<p>排序算法：冒泡排序、直接插入排序、希尔排序、选择排序、快速排序、堆排序、归并排序</p>\n<h3 id=\"3-排序算法\"><a href=\"#3-排序算法\" class=\"headerlink\" title=\"3. 排序算法\"></a>3. 排序算法</h3><h4 id=\"1-冒泡排序\"><a href=\"#1-冒泡排序\" class=\"headerlink\" title=\"1. 冒泡排序\"></a>1. 冒泡排序</h4><p>原理：两两相邻的数进行比较，如果反序就交换，否则不交换</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<p>对于一个长度为 N 的数组，我们需要排序 N-1 轮，每 i 轮 要比较 N-i 次。对此我们可以用双重循环语句，外层循环控制循环轮次，内层循环控制每轮的比较次数。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">order</span>(<span class=\"params\">$arr</span>) </span>&#123;</span><br><span class=\"line\">  　　$count = count($arr);</span><br><span class=\"line\">  　　$temp = <span class=\"number\">0</span>; </span><br><span class=\"line\"> 　　 <span class=\"comment\">// 外层控制排序轮次</span></span><br><span class=\"line\">  　　<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $count - <span class=\"number\">1</span>; $i++) &#123;</span><br><span class=\"line\">      　　<span class=\"comment\">// 内层控制每轮比较次数</span></span><br><span class=\"line\">      　　<span class=\"keyword\">for</span> ($j = <span class=\"number\">0</span>; $j &lt; $count - <span class=\"number\">1</span>- $i; $j++)&#123;</span><br><span class=\"line\">            　　<span class=\"keyword\">if</span> ($arr[$j] &gt; $arr[$j + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                　　$temp = $arr[$j];</span><br><span class=\"line\">                　　$arr[$j] = $arr[$j + <span class=\"number\">1</span>];</span><br><span class=\"line\">                　　$arr[$j + <span class=\"number\">1</span>] = $temp;</span><br><span class=\"line\">           　　&#125;</span><br><span class=\"line\">     　　 &#125;</span><br><span class=\"line\">  　　&#125; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> $arr;</span><br><span class=\"line\">   &#125;     </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> $arr= <span class=\"keyword\">array</span>(<span class=\"number\">6</span>, <span class=\"number\">3</span>, <span class=\"number\">8</span>, <span class=\"number\">2</span>, <span class=\"number\">9</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">$res =  order($arr);</span><br><span class=\"line\">var_dump($res);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-直接插入排序\"><a href=\"#2-直接插入排序\" class=\"headerlink\" title=\"2. 直接插入排序\"></a>2. 直接插入排序</h4><p>原理：每次从无序表中取出第一个元素，把它出入到有序表的合适位置，使有序表仍然有序</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"3-希尔排序（shell-sort）\"><a href=\"#3-希尔排序（shell-sort）\" class=\"headerlink\" title=\"3. 希尔排序（shell sort）\"></a>3. 希尔排序（shell sort）</h4><p>希尔排序是基于插入排序的，区别在于插入排序是相邻的一个个比较（类似于希尔中 h=1 的情形），而希尔排序是距离 h 的比较和替换。</p>\n<p>希尔排序中一个常数因子 n，原数组被分成各个小组，每个小组由 h 个元素组成，很可能会有多余的元素。当然每次循环的时候，h 也是递减的（h=h/n）。第一次循环就是从下标为 h 开始。希尔排序的一个思想就是，分成小组去排序。</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n*log_2n)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"4-选择排序\"><a href=\"#4-选择排序\" class=\"headerlink\" title=\"4. 选择排序\"></a>4. 选择排序</h4><p>原理：每次从待排序的数据元素中选出最小（或最大）的一个元素，存放在序列的起始位置，直到全部待排序的数据元素排完</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"5-快速排序\"><a href=\"#5-快速排序\" class=\"headerlink\" title=\"5. 快速排序\"></a>5. 快速排序</h4><p>原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，<br>如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作，<br>不难发现，这里符合递归的原理，所以我们可以用递归来实现。<br>使用递归，则需要找到递归点和递归出口：<br>递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1<br>递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(nlog_2n)$$</p>\n<p>空间复杂度：最坏 $$O(n)$$，平均 $$O(log_2n)$$</p>\n<h4 id=\"6-堆排序\"><a href=\"#6-堆排序\" class=\"headerlink\" title=\"6 .堆排序\"></a>6 .堆排序</h4><p>二叉树。。。</p>\n<p>时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"7-归并排序\"><a href=\"#7-归并排序\" class=\"headerlink\" title=\"7. 归并排序\"></a>7. 归并排序</h4><p>就是利用归并（合并）的思想实现的排序方法。它的原理是假设初始序列含有 n 个元素，则可以看成是 n 个有序的子序列，每个子序列的长度为 1，然后两两归并，得到 ⌈ n / 2⌉ （⌈ x ⌉ 表示不小于 x 的最小整数）个长度为 2 或 1 的有序序列；再两两归并，······，如此重复，直至得到一个长度为 n 的有序序列为止，这种排序方法就成为 2 路归并排序。</p>\n<p>时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$</p>\n<p>空间复杂度：$$O(n)$$</p>\n<h4 id=\"8-总结\"><a href=\"#8-总结\" class=\"headerlink\" title=\"8. 总结\"></a>8. 总结</h4><p>快速排序、归并排序的理想时间复杂度都是 $$O(nlog_2n)$$，但是快速排序的时间复杂度并不稳定，最坏情况下复杂度为 $$O(n^2)$$，所以最理想的算法还是归并排序。</p>\n<h3 id=\"4-查找方法\"><a href=\"#4-查找方法\" class=\"headerlink\" title=\"4. 查找方法\"></a>4. 查找方法</h3><h4 id=\"1-二分查找\"><a href=\"#1-二分查找\" class=\"headerlink\" title=\"1. 二分查找\"></a>1. 二分查找</h4><p>原理：从数组的中间元素开始，如果中间元素正好是要查找的元素，搜索结束，如果某一个特定的元素大于有这小鱼中间元素，则在数组大于或者小于中间元素的那一半中查找，而且跟开始一样从中间开始比较，如果某一步骤数组为空，表示找不到。</p>\n<p>时间复杂度：最坏 $$O(log_2n)$$，平均 $$O(log_2n)$$</p>\n<p>空间复杂度：迭代 $$O(1)$$，递归 $$O(log_2n)$$</p>\n<h4 id=\"2-顺序查找\"><a href=\"#2-顺序查找\" class=\"headerlink\" title=\"2. 顺序查找\"></a>2. 顺序查找</h4><p>原理：按一定的顺序检查数组中的每一个元素，直到找到所要寻找的特定值为止。</p>\n<p>时间复杂度：最差 $$O(n)$$，平均 $$O(n)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"3-总结\"><a href=\"#3-总结\" class=\"headerlink\" title=\"3. 总结\"></a>3. 总结</h4><p>二分查找算法的时间复杂度最差是 $$O(log_2n)$$，顺序查找的时间复杂度最差为 $$O(n)$$，所以二分查找更快，但是递归条件下，二分查找更消耗内存。</p>\n<h3 id=\"5-解题方法\"><a href=\"#5-解题方法\" class=\"headerlink\" title=\"5. 解题方法\"></a>5. 解题方法</h3><p>需要充分理解各种排序算法和查找算法的原理以及实现方式，另外还需要理解时间复杂度和空间复杂度的计算方式和概念，考察的是逻辑思维能力，需要仔细研究各种算法的实现方式。</p>\n<h3 id=\"6-真题\"><a href=\"#6-真题\" class=\"headerlink\" title=\"6. 真题\"></a>6. 真题</h3><h4 id=\"1-简述时间复杂度和空间复杂度的概念\"><a href=\"#1-简述时间复杂度和空间复杂度的概念\" class=\"headerlink\" title=\"1. 简述时间复杂度和空间复杂度的概念\"></a>1. 简述时间复杂度和空间复杂度的概念</h4><h4 id=\"2-对无序数组排序，最优的时间复杂度是什么，用-PHP-或者-JavaScript-写出一个实际的例子，该算法的空间复杂度是多少？\"><a href=\"#2-对无序数组排序，最优的时间复杂度是什么，用-PHP-或者-JavaScript-写出一个实际的例子，该算法的空间复杂度是多少？\" class=\"headerlink\" title=\"2. 对无序数组排序，最优的时间复杂度是什么，用 PHP 或者 JavaScript 写出一个实际的例子，该算法的空间复杂度是多少？\"></a>2. 对无序数组排序，最优的时间复杂度是什么，用 PHP 或者 JavaScript 写出一个实际的例子，该算法的空间复杂度是多少？</h4><p>快速或归并</p>\n<h4 id=\"3-一个有序数组中，查询特定-item-是否存在的最优算法是什么？时间复杂度多少？\"><a href=\"#3-一个有序数组中，查询特定-item-是否存在的最优算法是什么？时间复杂度多少？\" class=\"headerlink\" title=\"3. 一个有序数组中，查询特定 item 是否存在的最优算法是什么？时间复杂度多少？\"></a>3. 一个有序数组中，查询特定 item 是否存在的最优算法是什么？时间复杂度多少？</h4>","site":{"data":{}},"excerpt":"<blockquote>\n<p>写出常见的排序算法，并用 PHP 实现冒泡排序，将数组按照从小到大的方式进行排序</p>\n</blockquote>","more":"<p>考点：</p>\n<ul>\n<li>冒泡排序的原理和实现</li>\n<li>延伸：算法的概念</li>\n<li>延伸：时间复杂度和空间复杂度的概念</li>\n<li>延伸：常见排序算法</li>\n<li>延伸：常见查找算法</li>\n</ul>\n<h3 id=\"1-算法概念\"><a href=\"#1-算法概念\" class=\"headerlink\" title=\"1. 算法概念\"></a>1. 算法概念</h3><p>解决特定问题求解步骤的描述，在计算机中表现为指令的有限序列，并且每条指令表示一个或多个操作</p>\n<p>一个问题可以有多种算法，每种算法都有不同的效率</p>\n<p>一个算法具有 5 个特性：有穷性（算法能计算完，不能是死循环）、确切性（每一步都要有意义）、输入项、输出项、可行性（可以执行，每一步都是正确的）。</p>\n<h3 id=\"2-算法评定\"><a href=\"#2-算法评定\" class=\"headerlink\" title=\"2. 算法评定\"></a>2. 算法评定</h3><p>算法分析的目的在于选择合适的算法和改进算法</p>\n<p>一个算法的评价主要是从时间复杂度和空间复杂度来考虑</p>\n<h4 id=\"1-时间复杂度\"><a href=\"#1-时间复杂度\" class=\"headerlink\" title=\"1. 时间复杂度\"></a>1. 时间复杂度</h4><p>执行算法所需要的计算工作量，也就是时间消耗的效率。一般来说，计算机算法是问题规模 $$n$$ 的函数 $$f(n)$$，算法的时间复杂度也一次记作 $$T(n)=O(f(n))$$</p>\n<p>问题的规模 $$n$$ 越大，算法执行的时间的增长率与 $$f(n)$$ 的增长率正相关，称作渐进时间复杂度。</p>\n<h5 id=\"计算方式\"><a href=\"#计算方式\" class=\"headerlink\" title=\"计算方式\"></a>计算方式</h5><ol>\n<li>得出算法的计算次数公式</li>\n<li>用常数 $$1$$ 来取代所有时间中的所有加法常数，如 $$O(3)$$ 要写成 $$O(1)$$</li>\n<li>在修改后的运行次数函数中，只保留最高阶项，如 $$O(n^2+n+1)$$ 要写成 $$O(n^2)$$</li>\n<li>如果最高阶存在且不是1，则去除与这个项相乘的常数，如 $$O(3n)$$ 要写成 $$O(n)$$</li>\n</ol>\n<h5 id=\"举例\"><a href=\"#举例\" class=\"headerlink\" title=\"举例\"></a>举例</h5><ol>\n<li><p>常数阶：$$O(1)$$</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $n;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $n;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $n;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>线性阶：$$O(n)$$</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">100</span>;</span><br><span class=\"line\">$sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $n; ++$i) &#123;</span><br><span class=\"line\">\t$sum += $n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $sum;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>平（立）方阶：$$O(n^2)/O(n^3)$$</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">100</span>;</span><br><span class=\"line\">$sum = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $n; ++$i) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ($j = <span class=\"number\">0</span>; $j &lt; $n; ++$j) &#123;</span><br><span class=\"line\">\t\t$sum += $j;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> $sum;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>对数阶：$$O(log_2n)$$</p>\n</li>\n</ol>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$n = <span class=\"number\">1000</span>;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ($n &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t$n = $n/<span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>效率对比<br>$$$<br>O(1) &gt; O(log_2n) &gt; O(n) &gt; O(nlog_2n) &gt; O(n^2) &gt; O(n^3) &gt; O(2^n) &gt; O(n!) &gt; O(n^n)<br>$$$</p>\n<p>最坏情况，如果没有特别说明，时间复杂度就是指最坏情况下的时间复杂度</p>\n<h4 id=\"2-空间复杂度\"><a href=\"#2-空间复杂度\" class=\"headerlink\" title=\"2. 空间复杂度\"></a>2. 空间复杂度</h4><p>算法需要消耗的内存空间，记作 $$S(n)=O(f(n))$$</p>\n<p>包括程序代码所占用的空间，输入数据所占用的空间和辅助变量所占用的空间三部分</p>\n<p>计算和表示方法与时间复杂度类似，一般用复杂度的渐进性来表示</p>\n<p>有时用空间换取时间</p>\n<p>冒泡排序的元素交换，空间复杂度$$O(1)$$</p>\n<p>排序算法：冒泡排序、直接插入排序、希尔排序、选择排序、快速排序、堆排序、归并排序</p>\n<h3 id=\"3-排序算法\"><a href=\"#3-排序算法\" class=\"headerlink\" title=\"3. 排序算法\"></a>3. 排序算法</h3><h4 id=\"1-冒泡排序\"><a href=\"#1-冒泡排序\" class=\"headerlink\" title=\"1. 冒泡排序\"></a>1. 冒泡排序</h4><p>原理：两两相邻的数进行比较，如果反序就交换，否则不交换</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<p>对于一个长度为 N 的数组，我们需要排序 N-1 轮，每 i 轮 要比较 N-i 次。对此我们可以用双重循环语句，外层循环控制循环轮次，内层循环控制每轮的比较次数。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">order</span>(<span class=\"params\">$arr</span>) </span>&#123;</span><br><span class=\"line\">  　　$count = count($arr);</span><br><span class=\"line\">  　　$temp = <span class=\"number\">0</span>; </span><br><span class=\"line\"> 　　 <span class=\"comment\">// 外层控制排序轮次</span></span><br><span class=\"line\">  　　<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; $count - <span class=\"number\">1</span>; $i++) &#123;</span><br><span class=\"line\">      　　<span class=\"comment\">// 内层控制每轮比较次数</span></span><br><span class=\"line\">      　　<span class=\"keyword\">for</span> ($j = <span class=\"number\">0</span>; $j &lt; $count - <span class=\"number\">1</span>- $i; $j++)&#123;</span><br><span class=\"line\">            　　<span class=\"keyword\">if</span> ($arr[$j] &gt; $arr[$j + <span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                　　$temp = $arr[$j];</span><br><span class=\"line\">                　　$arr[$j] = $arr[$j + <span class=\"number\">1</span>];</span><br><span class=\"line\">                　　$arr[$j + <span class=\"number\">1</span>] = $temp;</span><br><span class=\"line\">           　　&#125;</span><br><span class=\"line\">     　　 &#125;</span><br><span class=\"line\">  　　&#125; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> $arr;</span><br><span class=\"line\">   &#125;     </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> $arr= <span class=\"keyword\">array</span>(<span class=\"number\">6</span>, <span class=\"number\">3</span>, <span class=\"number\">8</span>, <span class=\"number\">2</span>, <span class=\"number\">9</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">$res =  order($arr);</span><br><span class=\"line\">var_dump($res);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-直接插入排序\"><a href=\"#2-直接插入排序\" class=\"headerlink\" title=\"2. 直接插入排序\"></a>2. 直接插入排序</h4><p>原理：每次从无序表中取出第一个元素，把它出入到有序表的合适位置，使有序表仍然有序</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"3-希尔排序（shell-sort）\"><a href=\"#3-希尔排序（shell-sort）\" class=\"headerlink\" title=\"3. 希尔排序（shell sort）\"></a>3. 希尔排序（shell sort）</h4><p>希尔排序是基于插入排序的，区别在于插入排序是相邻的一个个比较（类似于希尔中 h=1 的情形），而希尔排序是距离 h 的比较和替换。</p>\n<p>希尔排序中一个常数因子 n，原数组被分成各个小组，每个小组由 h 个元素组成，很可能会有多余的元素。当然每次循环的时候，h 也是递减的（h=h/n）。第一次循环就是从下标为 h 开始。希尔排序的一个思想就是，分成小组去排序。</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n*log_2n)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"4-选择排序\"><a href=\"#4-选择排序\" class=\"headerlink\" title=\"4. 选择排序\"></a>4. 选择排序</h4><p>原理：每次从待排序的数据元素中选出最小（或最大）的一个元素，存放在序列的起始位置，直到全部待排序的数据元素排完</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(n^2)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"5-快速排序\"><a href=\"#5-快速排序\" class=\"headerlink\" title=\"5. 快速排序\"></a>5. 快速排序</h4><p>原理：找到当前数组中的任意一个元素（一般选择第一个元素），作为标准，新建两个空数组，遍历整个数组元素，<br>如果遍历到的元素比当前的元素要小，那么就放到左边的数组，否则放到右面的数组，然后再对新数组进行同样的操作，<br>不难发现，这里符合递归的原理，所以我们可以用递归来实现。<br>使用递归，则需要找到递归点和递归出口：<br>递归点：如果数组的元素大于 1，就需要再进行分解，所以我们的递归点就是新构造的数组元素个数大于 1<br>递归出口：我们什么时候不需要再对新数组不进行排序了呢？就是当数组元素个数变成 1 的时候，所以这就是我们的出口。</p>\n<p>时间复杂度：最坏 $$O(n^2)$$，平均 $$O(nlog_2n)$$</p>\n<p>空间复杂度：最坏 $$O(n)$$，平均 $$O(log_2n)$$</p>\n<h4 id=\"6-堆排序\"><a href=\"#6-堆排序\" class=\"headerlink\" title=\"6 .堆排序\"></a>6 .堆排序</h4><p>二叉树。。。</p>\n<p>时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"7-归并排序\"><a href=\"#7-归并排序\" class=\"headerlink\" title=\"7. 归并排序\"></a>7. 归并排序</h4><p>就是利用归并（合并）的思想实现的排序方法。它的原理是假设初始序列含有 n 个元素，则可以看成是 n 个有序的子序列，每个子序列的长度为 1，然后两两归并，得到 ⌈ n / 2⌉ （⌈ x ⌉ 表示不小于 x 的最小整数）个长度为 2 或 1 的有序序列；再两两归并，······，如此重复，直至得到一个长度为 n 的有序序列为止，这种排序方法就成为 2 路归并排序。</p>\n<p>时间复杂度：最坏 $$O(nlog_2n)$$，平均 $$O(nlog_2n)$$</p>\n<p>空间复杂度：$$O(n)$$</p>\n<h4 id=\"8-总结\"><a href=\"#8-总结\" class=\"headerlink\" title=\"8. 总结\"></a>8. 总结</h4><p>快速排序、归并排序的理想时间复杂度都是 $$O(nlog_2n)$$，但是快速排序的时间复杂度并不稳定，最坏情况下复杂度为 $$O(n^2)$$，所以最理想的算法还是归并排序。</p>\n<h3 id=\"4-查找方法\"><a href=\"#4-查找方法\" class=\"headerlink\" title=\"4. 查找方法\"></a>4. 查找方法</h3><h4 id=\"1-二分查找\"><a href=\"#1-二分查找\" class=\"headerlink\" title=\"1. 二分查找\"></a>1. 二分查找</h4><p>原理：从数组的中间元素开始，如果中间元素正好是要查找的元素，搜索结束，如果某一个特定的元素大于有这小鱼中间元素，则在数组大于或者小于中间元素的那一半中查找，而且跟开始一样从中间开始比较，如果某一步骤数组为空，表示找不到。</p>\n<p>时间复杂度：最坏 $$O(log_2n)$$，平均 $$O(log_2n)$$</p>\n<p>空间复杂度：迭代 $$O(1)$$，递归 $$O(log_2n)$$</p>\n<h4 id=\"2-顺序查找\"><a href=\"#2-顺序查找\" class=\"headerlink\" title=\"2. 顺序查找\"></a>2. 顺序查找</h4><p>原理：按一定的顺序检查数组中的每一个元素，直到找到所要寻找的特定值为止。</p>\n<p>时间复杂度：最差 $$O(n)$$，平均 $$O(n)$$</p>\n<p>空间复杂度：$$O(1)$$</p>\n<h4 id=\"3-总结\"><a href=\"#3-总结\" class=\"headerlink\" title=\"3. 总结\"></a>3. 总结</h4><p>二分查找算法的时间复杂度最差是 $$O(log_2n)$$，顺序查找的时间复杂度最差为 $$O(n)$$，所以二分查找更快，但是递归条件下，二分查找更消耗内存。</p>\n<h3 id=\"5-解题方法\"><a href=\"#5-解题方法\" class=\"headerlink\" title=\"5. 解题方法\"></a>5. 解题方法</h3><p>需要充分理解各种排序算法和查找算法的原理以及实现方式，另外还需要理解时间复杂度和空间复杂度的计算方式和概念，考察的是逻辑思维能力，需要仔细研究各种算法的实现方式。</p>\n<h3 id=\"6-真题\"><a href=\"#6-真题\" class=\"headerlink\" title=\"6. 真题\"></a>6. 真题</h3><h4 id=\"1-简述时间复杂度和空间复杂度的概念\"><a href=\"#1-简述时间复杂度和空间复杂度的概念\" class=\"headerlink\" title=\"1. 简述时间复杂度和空间复杂度的概念\"></a>1. 简述时间复杂度和空间复杂度的概念</h4><h4 id=\"2-对无序数组排序，最优的时间复杂度是什么，用-PHP-或者-JavaScript-写出一个实际的例子，该算法的空间复杂度是多少？\"><a href=\"#2-对无序数组排序，最优的时间复杂度是什么，用-PHP-或者-JavaScript-写出一个实际的例子，该算法的空间复杂度是多少？\" class=\"headerlink\" title=\"2. 对无序数组排序，最优的时间复杂度是什么，用 PHP 或者 JavaScript 写出一个实际的例子，该算法的空间复杂度是多少？\"></a>2. 对无序数组排序，最优的时间复杂度是什么，用 PHP 或者 JavaScript 写出一个实际的例子，该算法的空间复杂度是多少？</h4><p>快速或归并</p>\n<h4 id=\"3-一个有序数组中，查询特定-item-是否存在的最优算法是什么？时间复杂度多少？\"><a href=\"#3-一个有序数组中，查询特定-item-是否存在的最优算法是什么？时间复杂度多少？\" class=\"headerlink\" title=\"3. 一个有序数组中，查询特定 item 是否存在的最优算法是什么？时间复杂度多少？\"></a>3. 一个有序数组中，查询特定 item 是否存在的最优算法是什么？时间复杂度多少？</h4>"},{"title":"快速上手Linux 玩转典型应用 part-1","date":"2017-11-13T15:54:17.000Z","_content":"\n慕课网 [快速上手Linux 玩转典型应用](http://coding.imooc.com/learn/list/154.html) 学习笔记  part-1\n\n[在线学习点这里](http://www.runoob.com/linux/linux-tutorial.html)\n\n<!-- more -->\n\n## 1. 研发必须知道的 Linux 知识\n\n- Linux 区分大小写\n- 一切皆文件\n- 文件名后缀只是为了便于识别，对系统没有任何意义\n- 云服务器与本地虚拟机的最主要区别就是云服务器有**公网IP**\n\n## 2. 准备知识\n\n### 1. 查看 ip\n\n#### ifconfig （最常用）\n```\n[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ifconfig\neth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255\n        ether 00:16:3e:2e:0c:1e  txqueuelen 1000  (Ethernet)\n        RX packets 14729288  bytes 2106329863 (1.9 GiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 9911393  bytes 8389800747 (7.8 GiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        loop  txqueuelen 1  (Local Loopback)\n        RX packets 10772426  bytes 667897558 (636.9 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 10772426  bytes 667897558 (636.9 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n```\n\n#### ip addr\n```\n[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ip addr\n# 本地回环ip\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n# 物理ip\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\n    link/ether 00:16:3e:2e:0c:1e brd ff:ff:ff:ff:ff:ff\n    inet 172.17.147.89/20 brd 172.17.159.255 scope global eth0\n       valid_lft forever preferred_lft forever\n```\n\n#### vi ifcfg-xx\n```\n[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ vi /etc/sysconfig/network-scripts/ifcfg-xx\n# 这里 xx 就是 ip addr 获取到里的两个ip的名字， lo和eth0\n```\n\n修改 `ONBOOT=yes`， 并`service network restart`，对应的网络信息就可以在 `ip addr` 下显示。\n\n#### yum install net-tools\n安装完成后就可以使用ifconfig命令（minial 版的centOS阉割了此命令）\n\n### 2. 替换默认源（软件下载地址）\n\n操作方法见此[地址](http://mirrors.163.com/.help/centos.html)\n\n### 3. 安装 vim\n```\nyum install vim\n```\n\n## 3. 远程服务管理工具ssh （重点）\n\nSecure Shell 安全外壳协议，建立在应用层基础上的安全协议。\n\n可靠，专为远程登录会话和其他网络服务提供安全性的协议。\n\n### 1. 安装 ssh 服务\n\n服务器端一般默认已安装了ssh服务\n\n```\nyum install openssh-server\n```\n### 2. 启动 ssh\n```\nservice sshd start\nps -ef | grep ssh\n```\n### 3. 设置开机启动\n```\nchkconfig sshd on\n```\n\n客户端安装 ssh 工具\n\nWin:Xshell, Putty, secureCRT 等，\nLinux: `yum install openssh-clients`\n\n连接：\n`ssh zzp@47.93.234.60 -p 8222`\n\n### 4. ssh config 命令\n- 为了方便批量管理多个ssh\n- 存放在 ~/.ssh/config\n\nconfig 语法：\n1. Host: 别名\n2. HostName: 主机名或ip\n3. Port: 端口 默认 22\n4. User: 用户名\n5. IdentityFile: 密钥文件路径\n\n```\n[root@iz2ze4kikm9076bxac1noqz ~]# cd .ssh/\n[root@iz2ze4kikm9076bxac1noqz .ssh]# ll\ntotal 4\n-rw------- 1 root root 403 May 24 15:20 authorized_keys\n[root@iz2ze4kikm9076bxac1noqz .ssh]# touch config\n```\n### 5. 免密登录 ssh key\n使用非对称加密方式生成公钥和私钥，私钥存放在本地 ~/.ssh，保护好私钥，公钥可以对外公开，放在服务器的 ~/.ssh/authorized_keys\n\n```\nssh-keygen -t rsa\nssh-keygen -t dsa\n```\n\n需要加载私钥\n```\nssh-add ~/.ssh/private_key\n```\n\n### 5. [iTerm 中配置免密登录 sshpass](http://www.cnblogs.com/onlyfu/p/4460160.html)\n\n我的配置大概下面这个样子\n```\n/usr/local/bin/sshpass  -f /zzp/sshpass/my_aliyun_pass ssh zzp@47.93.234.60 -p 8222\n```\n\n其中，`/zzp/sshpass/my_aliyun_pass` 文件中存储的是登录密码，设置好快捷键后就可以实现一键免密登录。\n\n### 6. 端口安全\n改变默认服务器端口，修改 `/etc/ssh/sshd_config` 文件，大概十几行， Port 12345，并且可以同时监听多个端口\n\n```\nPort 12345\nPort 10086\nPort 10010\n```\n\n## 4. Liunx 常用命令\n\n### 1. 软件操作命令\n\n软件包管理器 yum\n- 安装软件 `yum install xxx`\n- 卸载软件 `yum remove xxx`\n- 搜索软件 `yum search xxx`\n- 清理缓存 `yum clean packages`\n- 列出已安装 `yum list` 会列出很多，最好grep一下\n- 软件包信息 `yum info xxx`\n\n### 2. 服务器硬件资源信息\n\n- 内存 `free -m`\n- 硬盘 `df -h`\n- 负载 `w/top`\n- cpu 个数和核数 `cat /proc/cpuinfo`\n\n1分钟，5分钟，15分钟的平均负载，一般大于0.6或0.7为危险\n\n```\n$ w\n21:13:30 up 1 day, 20:22,  1 user,  load average: 0.00, 0.03, 0.05\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\nzzp      pts/0    123.122.85.229   21:05    2.00s  0.00s  0.00s w\n```\n\nfdisk 可视化磁盘\n\n### 3. 文件操作命令\n\n文件目录结构\n- 根目录 /\n- 家目录 /home\n- 临时目录 /tmp\n- 配置目录 /etc\n- 用户程序目录 /usr\n\n文件操作\n- 查看目录下的文件 ls/ll/ll -ah\n- 新建文件 touch\n- 新建文件夹 mkdir (mkdir -p dir1/dir2/dir3/dir4)\n- 进入目录 cd\n- 删除文件和目录 rm\n- 复制 cp\n- 移动 mv\n- 显示当前路径 pwd (print working directory)\n\n### 4. Vim\n\n- 首行 gg\n- 末行 G\n- 行尾 $\n- 删除 dd\n- 恢复 u\n- 复制 yy\n- 粘贴 p \n\n### 5. 文件搜索、查找、读取\n- 从文件尾部开始读 tail 通常加 -f\n- 从文件头部开始读 head\n- 读取整个文件 cat 注意大文件，不要随意读\n- 分页读取 more 从头部开始读\n- 可控分页 less \n- 搜索关键字 grep  (grep -n \"error\" filename)\n- 查找文件 find\n- 统计个数 wc (cat filename | wc -l)  wordcount\n\n`grep \"2017-11-11\" filename | more`\n\n`find . -name \"*.conf\"` 在当前目录及其子目录下查找名称以.conf结尾的文件\n\n`find . -type f` 在当前目录及其子目录下查找类型为文件的文件\n\n`find . -type d` 在当前目录及其子目录下查找类型为目录的文件\n\n`find . -ctime -20` 在当前目录及其子目录下查找所有最近20天内更新过的文件\n\n`find /var/log -type f -mtime +7 -exec rm {}; \\` 在/var/log下查找所有7天以前更新过的文件，删除\n\n`find . -type f -perm 644 -exec ls -al {} \\;`\n\n### 6. 文件解压缩\n\n`tar -cf des.tar source` create compressed file from source to des\n\n`tar -tvf file.tar` list files in the compressed file\n\n`tar -xf file.tar` extract file from the compressed file\n\n`tar -czvf des.tar.gz source`  in .gz format, visualized, -f usually is the last param\n\n`tar -xzvf file.tar.gz`\n\n记住每个参数的意思\n\n### 7. 系统用户操作命令\n\n- useradd\n- adduser\n- userdel\n- passwd\n\n\n> useradd is native binary compiled with the system. But, adduser is a perl script which uses useradd binary in back-end.\nadduser is more user friendly and interactive than its back-end useradd. There's no difference in features provided.\n\n### 8. 防火墙的设置\n\n保护服务器安全\n\n确认服务是否已安装\n```\n# yum list | grep firewall\nfirewalld.noarch                        0.4.4.4-6.el7                  @base\nfirewalld-filesystem.noarch             0.4.4.4-6.el7                  @base\npython-firewall.noarch                  0.4.4.4-6.el7                  @base\nfail2ban-firewalld.noarch               0.9.7-1.el7                    epel\nfirewall-applet.noarch                  0.4.4.4-6.el7                  base\nfirewall-config.noarch                  0.4.4.4-6.el7                  base\npuppet-firewalld.noarch                 0.1.3-1.el7                    epel\nsystem-config-firewall.noarch           1.2.29-10.el7                  base\nsystem-config-firewall-base.noarch      1.2.29-10.el7                  base\nsystem-config-firewall-tui.noarch       1.2.29-10.el7                  base\n```\n\n确认服务是否已启动\n```\n# ps -ef | grep firewall\nroot     19678 19531  0 22:45 pts/1    00:00:00 grep --color=auto firewall\n```\n\n安装\n```\n# yum install firewalld\n```\n\n启动\n```\n$ service firewalld start\nRedirecting to /bin/systemctl start  firewalld.service\n==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===\nAuthentication is required to manage system services or units.\nAuthenticating as: root\nPassword:\n==== AUTHENTICATION COMPLETE ===\n```\n\n检查状态\n```\n# service firewalld status\nRedirecting to /bin/systemctl status  firewalld.service\n● firewalld.service\n   Loaded: masked (/dev/null; bad)\n   Active: inactive (dead)\n```\n\n关闭或禁用\n```\n# service firewalld stop/disable\n```\n\n```\nfirewall-cmd --version\nfirewall-cmd --state\nfirewall-cmd --get-zones\nfirewall-cmd --get-default-zone\nfirewall-cmd --list-all-zone\nfirewall-cmd --zone=public\nfirewall-cmd --list-ports\nfirewall-cmd --query-service=ssh\nfirewall-cmd --remove-service=ssh\nfirewall-cmd --add-service=ssh\nfirewall-cmd --list-services\nfirewall-cmd --query-port=22/tcp\nfirewall-cmd --add-port=22/tcp\nfirewall-cmd --remove-port=22/tcp\nfirewall-cmd --list-ports\nfirewall-cmd --get-all-zones\n```\n\n### 9. 提权和文件上传下载\n\n- 提权 sudo\n- 下载 wget, curl\n- 上传 scp\n\n\nsecureCRT + lrzsz\n\n#### 1. 提权\n```\nvisudo\n```\n找到 Allows people in group wheel to run all commands\n\n添加一行\n```\n%user ALL=(ALL)  ALL\n```\n将用户添加到提权账号中\n\n尽量不要使用root 账号进行操作。\n\n#### 2. 下载\n\n一般使用 wget 就可以了\n\n```\n# wget http://www.baidu.com/\n--2017-11-13 23:33:40--  http://www.baidu.com/\nResolving www.baidu.com (www.baidu.com)... 115.239.210.27, 115.239.211.112\nConnecting to www.baidu.com (www.baidu.com)|115.239.210.27|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2381 (2.3K) [text/html]\nSaving to: ‘index.html’\n\n100%[====================================================================================================================>] 2,381       --.-K/s   in 0s\n\n2017-11-13 23:33:40 (260 MB/s) - ‘index.html’ saved [2381/2381]\n\n[root@iz2ze4kikm9076bxac1noqz ~]# ll\n-rw-r--r--  1 root root     2381 Jan 23  2017 index.html\n\n# curl -o baidu.html http://www.baidu.com\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  2381  100  2381    0     0   3918      0 --:--:-- --:--:-- --:--:--  3922\n[root@iz2ze4kikm9076bxac1noqz ~]# ll\n-rw-r--r--  1 root root     2381 Nov 13 23:34 baidu.html\n-rw-r--r--  1 root root     2381 Jan 23  2017 index.html\n```\n\n#### 3. 上传\n```\nscp file root@192.168.1.1:/dir/\n```\n\n下载到本地\n```\nscp root@192.168.1.1:/dir/file locate_dir\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/快速上手Linux-玩转典型应用-part-1.md","raw":"---\ntitle: 快速上手Linux 玩转典型应用 part-1\ndate: 2017-11-13 23:54:17\ntags: Linux\ncategories: Liunx\n---\n\n慕课网 [快速上手Linux 玩转典型应用](http://coding.imooc.com/learn/list/154.html) 学习笔记  part-1\n\n[在线学习点这里](http://www.runoob.com/linux/linux-tutorial.html)\n\n<!-- more -->\n\n## 1. 研发必须知道的 Linux 知识\n\n- Linux 区分大小写\n- 一切皆文件\n- 文件名后缀只是为了便于识别，对系统没有任何意义\n- 云服务器与本地虚拟机的最主要区别就是云服务器有**公网IP**\n\n## 2. 准备知识\n\n### 1. 查看 ip\n\n#### ifconfig （最常用）\n```\n[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ifconfig\neth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255\n        ether 00:16:3e:2e:0c:1e  txqueuelen 1000  (Ethernet)\n        RX packets 14729288  bytes 2106329863 (1.9 GiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 9911393  bytes 8389800747 (7.8 GiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        loop  txqueuelen 1  (Local Loopback)\n        RX packets 10772426  bytes 667897558 (636.9 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 10772426  bytes 667897558 (636.9 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n```\n\n#### ip addr\n```\n[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ip addr\n# 本地回环ip\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n# 物理ip\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\n    link/ether 00:16:3e:2e:0c:1e brd ff:ff:ff:ff:ff:ff\n    inet 172.17.147.89/20 brd 172.17.159.255 scope global eth0\n       valid_lft forever preferred_lft forever\n```\n\n#### vi ifcfg-xx\n```\n[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ vi /etc/sysconfig/network-scripts/ifcfg-xx\n# 这里 xx 就是 ip addr 获取到里的两个ip的名字， lo和eth0\n```\n\n修改 `ONBOOT=yes`， 并`service network restart`，对应的网络信息就可以在 `ip addr` 下显示。\n\n#### yum install net-tools\n安装完成后就可以使用ifconfig命令（minial 版的centOS阉割了此命令）\n\n### 2. 替换默认源（软件下载地址）\n\n操作方法见此[地址](http://mirrors.163.com/.help/centos.html)\n\n### 3. 安装 vim\n```\nyum install vim\n```\n\n## 3. 远程服务管理工具ssh （重点）\n\nSecure Shell 安全外壳协议，建立在应用层基础上的安全协议。\n\n可靠，专为远程登录会话和其他网络服务提供安全性的协议。\n\n### 1. 安装 ssh 服务\n\n服务器端一般默认已安装了ssh服务\n\n```\nyum install openssh-server\n```\n### 2. 启动 ssh\n```\nservice sshd start\nps -ef | grep ssh\n```\n### 3. 设置开机启动\n```\nchkconfig sshd on\n```\n\n客户端安装 ssh 工具\n\nWin:Xshell, Putty, secureCRT 等，\nLinux: `yum install openssh-clients`\n\n连接：\n`ssh zzp@47.93.234.60 -p 8222`\n\n### 4. ssh config 命令\n- 为了方便批量管理多个ssh\n- 存放在 ~/.ssh/config\n\nconfig 语法：\n1. Host: 别名\n2. HostName: 主机名或ip\n3. Port: 端口 默认 22\n4. User: 用户名\n5. IdentityFile: 密钥文件路径\n\n```\n[root@iz2ze4kikm9076bxac1noqz ~]# cd .ssh/\n[root@iz2ze4kikm9076bxac1noqz .ssh]# ll\ntotal 4\n-rw------- 1 root root 403 May 24 15:20 authorized_keys\n[root@iz2ze4kikm9076bxac1noqz .ssh]# touch config\n```\n### 5. 免密登录 ssh key\n使用非对称加密方式生成公钥和私钥，私钥存放在本地 ~/.ssh，保护好私钥，公钥可以对外公开，放在服务器的 ~/.ssh/authorized_keys\n\n```\nssh-keygen -t rsa\nssh-keygen -t dsa\n```\n\n需要加载私钥\n```\nssh-add ~/.ssh/private_key\n```\n\n### 5. [iTerm 中配置免密登录 sshpass](http://www.cnblogs.com/onlyfu/p/4460160.html)\n\n我的配置大概下面这个样子\n```\n/usr/local/bin/sshpass  -f /zzp/sshpass/my_aliyun_pass ssh zzp@47.93.234.60 -p 8222\n```\n\n其中，`/zzp/sshpass/my_aliyun_pass` 文件中存储的是登录密码，设置好快捷键后就可以实现一键免密登录。\n\n### 6. 端口安全\n改变默认服务器端口，修改 `/etc/ssh/sshd_config` 文件，大概十几行， Port 12345，并且可以同时监听多个端口\n\n```\nPort 12345\nPort 10086\nPort 10010\n```\n\n## 4. Liunx 常用命令\n\n### 1. 软件操作命令\n\n软件包管理器 yum\n- 安装软件 `yum install xxx`\n- 卸载软件 `yum remove xxx`\n- 搜索软件 `yum search xxx`\n- 清理缓存 `yum clean packages`\n- 列出已安装 `yum list` 会列出很多，最好grep一下\n- 软件包信息 `yum info xxx`\n\n### 2. 服务器硬件资源信息\n\n- 内存 `free -m`\n- 硬盘 `df -h`\n- 负载 `w/top`\n- cpu 个数和核数 `cat /proc/cpuinfo`\n\n1分钟，5分钟，15分钟的平均负载，一般大于0.6或0.7为危险\n\n```\n$ w\n21:13:30 up 1 day, 20:22,  1 user,  load average: 0.00, 0.03, 0.05\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\nzzp      pts/0    123.122.85.229   21:05    2.00s  0.00s  0.00s w\n```\n\nfdisk 可视化磁盘\n\n### 3. 文件操作命令\n\n文件目录结构\n- 根目录 /\n- 家目录 /home\n- 临时目录 /tmp\n- 配置目录 /etc\n- 用户程序目录 /usr\n\n文件操作\n- 查看目录下的文件 ls/ll/ll -ah\n- 新建文件 touch\n- 新建文件夹 mkdir (mkdir -p dir1/dir2/dir3/dir4)\n- 进入目录 cd\n- 删除文件和目录 rm\n- 复制 cp\n- 移动 mv\n- 显示当前路径 pwd (print working directory)\n\n### 4. Vim\n\n- 首行 gg\n- 末行 G\n- 行尾 $\n- 删除 dd\n- 恢复 u\n- 复制 yy\n- 粘贴 p \n\n### 5. 文件搜索、查找、读取\n- 从文件尾部开始读 tail 通常加 -f\n- 从文件头部开始读 head\n- 读取整个文件 cat 注意大文件，不要随意读\n- 分页读取 more 从头部开始读\n- 可控分页 less \n- 搜索关键字 grep  (grep -n \"error\" filename)\n- 查找文件 find\n- 统计个数 wc (cat filename | wc -l)  wordcount\n\n`grep \"2017-11-11\" filename | more`\n\n`find . -name \"*.conf\"` 在当前目录及其子目录下查找名称以.conf结尾的文件\n\n`find . -type f` 在当前目录及其子目录下查找类型为文件的文件\n\n`find . -type d` 在当前目录及其子目录下查找类型为目录的文件\n\n`find . -ctime -20` 在当前目录及其子目录下查找所有最近20天内更新过的文件\n\n`find /var/log -type f -mtime +7 -exec rm {}; \\` 在/var/log下查找所有7天以前更新过的文件，删除\n\n`find . -type f -perm 644 -exec ls -al {} \\;`\n\n### 6. 文件解压缩\n\n`tar -cf des.tar source` create compressed file from source to des\n\n`tar -tvf file.tar` list files in the compressed file\n\n`tar -xf file.tar` extract file from the compressed file\n\n`tar -czvf des.tar.gz source`  in .gz format, visualized, -f usually is the last param\n\n`tar -xzvf file.tar.gz`\n\n记住每个参数的意思\n\n### 7. 系统用户操作命令\n\n- useradd\n- adduser\n- userdel\n- passwd\n\n\n> useradd is native binary compiled with the system. But, adduser is a perl script which uses useradd binary in back-end.\nadduser is more user friendly and interactive than its back-end useradd. There's no difference in features provided.\n\n### 8. 防火墙的设置\n\n保护服务器安全\n\n确认服务是否已安装\n```\n# yum list | grep firewall\nfirewalld.noarch                        0.4.4.4-6.el7                  @base\nfirewalld-filesystem.noarch             0.4.4.4-6.el7                  @base\npython-firewall.noarch                  0.4.4.4-6.el7                  @base\nfail2ban-firewalld.noarch               0.9.7-1.el7                    epel\nfirewall-applet.noarch                  0.4.4.4-6.el7                  base\nfirewall-config.noarch                  0.4.4.4-6.el7                  base\npuppet-firewalld.noarch                 0.1.3-1.el7                    epel\nsystem-config-firewall.noarch           1.2.29-10.el7                  base\nsystem-config-firewall-base.noarch      1.2.29-10.el7                  base\nsystem-config-firewall-tui.noarch       1.2.29-10.el7                  base\n```\n\n确认服务是否已启动\n```\n# ps -ef | grep firewall\nroot     19678 19531  0 22:45 pts/1    00:00:00 grep --color=auto firewall\n```\n\n安装\n```\n# yum install firewalld\n```\n\n启动\n```\n$ service firewalld start\nRedirecting to /bin/systemctl start  firewalld.service\n==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===\nAuthentication is required to manage system services or units.\nAuthenticating as: root\nPassword:\n==== AUTHENTICATION COMPLETE ===\n```\n\n检查状态\n```\n# service firewalld status\nRedirecting to /bin/systemctl status  firewalld.service\n● firewalld.service\n   Loaded: masked (/dev/null; bad)\n   Active: inactive (dead)\n```\n\n关闭或禁用\n```\n# service firewalld stop/disable\n```\n\n```\nfirewall-cmd --version\nfirewall-cmd --state\nfirewall-cmd --get-zones\nfirewall-cmd --get-default-zone\nfirewall-cmd --list-all-zone\nfirewall-cmd --zone=public\nfirewall-cmd --list-ports\nfirewall-cmd --query-service=ssh\nfirewall-cmd --remove-service=ssh\nfirewall-cmd --add-service=ssh\nfirewall-cmd --list-services\nfirewall-cmd --query-port=22/tcp\nfirewall-cmd --add-port=22/tcp\nfirewall-cmd --remove-port=22/tcp\nfirewall-cmd --list-ports\nfirewall-cmd --get-all-zones\n```\n\n### 9. 提权和文件上传下载\n\n- 提权 sudo\n- 下载 wget, curl\n- 上传 scp\n\n\nsecureCRT + lrzsz\n\n#### 1. 提权\n```\nvisudo\n```\n找到 Allows people in group wheel to run all commands\n\n添加一行\n```\n%user ALL=(ALL)  ALL\n```\n将用户添加到提权账号中\n\n尽量不要使用root 账号进行操作。\n\n#### 2. 下载\n\n一般使用 wget 就可以了\n\n```\n# wget http://www.baidu.com/\n--2017-11-13 23:33:40--  http://www.baidu.com/\nResolving www.baidu.com (www.baidu.com)... 115.239.210.27, 115.239.211.112\nConnecting to www.baidu.com (www.baidu.com)|115.239.210.27|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2381 (2.3K) [text/html]\nSaving to: ‘index.html’\n\n100%[====================================================================================================================>] 2,381       --.-K/s   in 0s\n\n2017-11-13 23:33:40 (260 MB/s) - ‘index.html’ saved [2381/2381]\n\n[root@iz2ze4kikm9076bxac1noqz ~]# ll\n-rw-r--r--  1 root root     2381 Jan 23  2017 index.html\n\n# curl -o baidu.html http://www.baidu.com\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  2381  100  2381    0     0   3918      0 --:--:-- --:--:-- --:--:--  3922\n[root@iz2ze4kikm9076bxac1noqz ~]# ll\n-rw-r--r--  1 root root     2381 Nov 13 23:34 baidu.html\n-rw-r--r--  1 root root     2381 Jan 23  2017 index.html\n```\n\n#### 3. 上传\n```\nscp file root@192.168.1.1:/dir/\n```\n\n下载到本地\n```\nscp root@192.168.1.1:/dir/file locate_dir\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n","slug":"快速上手Linux-玩转典型应用-part-1","published":1,"updated":"2020-09-11T01:04:35.049Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9x003q6wo17fvs3jnh","content":"<p>慕课网 <a href=\"http://coding.imooc.com/learn/list/154.html\">快速上手Linux 玩转典型应用</a> 学习笔记  part-1</p>\n<p><a href=\"http://www.runoob.com/linux/linux-tutorial.html\">在线学习点这里</a></p>\n<a id=\"more\"></a>\n\n<h2 id=\"1-研发必须知道的-Linux-知识\"><a href=\"#1-研发必须知道的-Linux-知识\" class=\"headerlink\" title=\"1. 研发必须知道的 Linux 知识\"></a>1. 研发必须知道的 Linux 知识</h2><ul>\n<li>Linux 区分大小写</li>\n<li>一切皆文件</li>\n<li>文件名后缀只是为了便于识别，对系统没有任何意义</li>\n<li>云服务器与本地虚拟机的最主要区别就是云服务器有<strong>公网IP</strong></li>\n</ul>\n<h2 id=\"2-准备知识\"><a href=\"#2-准备知识\" class=\"headerlink\" title=\"2. 准备知识\"></a>2. 准备知识</h2><h3 id=\"1-查看-ip\"><a href=\"#1-查看-ip\" class=\"headerlink\" title=\"1. 查看 ip\"></a>1. 查看 ip</h3><h4 id=\"ifconfig-（最常用）\"><a href=\"#ifconfig-（最常用）\" class=\"headerlink\" title=\"ifconfig （最常用）\"></a>ifconfig （最常用）</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ifconfig</span><br><span class=\"line\">eth0: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class=\"line\">        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255</span><br><span class=\"line\">        ether 00:16:3e:2e:0c:1e  txqueuelen 1000  (Ethernet)</span><br><span class=\"line\">        RX packets 14729288  bytes 2106329863 (1.9 GiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 9911393  bytes 8389800747 (7.8 GiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class=\"line\"></span><br><span class=\"line\">lo: flags&#x3D;73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class=\"line\">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class=\"line\">        loop  txqueuelen 1  (Local Loopback)</span><br><span class=\"line\">        RX packets 10772426  bytes 667897558 (636.9 MiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 10772426  bytes 667897558 (636.9 MiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ip-addr\"><a href=\"#ip-addr\" class=\"headerlink\" title=\"ip addr\"></a>ip addr</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ip addr</span><br><span class=\"line\"># 本地回环ip</span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class=\"line\">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\"># 物理ip</span><br><span class=\"line\">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class=\"line\">    link&#x2F;ether 00:16:3e:2e:0c:1e brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 172.17.147.89&#x2F;20 brd 172.17.159.255 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"vi-ifcfg-xx\"><a href=\"#vi-ifcfg-xx\" class=\"headerlink\" title=\"vi ifcfg-xx\"></a>vi ifcfg-xx</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-xx</span><br><span class=\"line\"># 这里 xx 就是 ip addr 获取到里的两个ip的名字， lo和eth0</span><br></pre></td></tr></table></figure>\n\n<p>修改 <code>ONBOOT=yes</code>， 并<code>service network restart</code>，对应的网络信息就可以在 <code>ip addr</code> 下显示。</p>\n<h4 id=\"yum-install-net-tools\"><a href=\"#yum-install-net-tools\" class=\"headerlink\" title=\"yum install net-tools\"></a>yum install net-tools</h4><p>安装完成后就可以使用ifconfig命令（minial 版的centOS阉割了此命令）</p>\n<h3 id=\"2-替换默认源（软件下载地址）\"><a href=\"#2-替换默认源（软件下载地址）\" class=\"headerlink\" title=\"2. 替换默认源（软件下载地址）\"></a>2. 替换默认源（软件下载地址）</h3><p>操作方法见此<a href=\"http://mirrors.163.com/.help/centos.html\">地址</a></p>\n<h3 id=\"3-安装-vim\"><a href=\"#3-安装-vim\" class=\"headerlink\" title=\"3. 安装 vim\"></a>3. 安装 vim</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install vim</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-远程服务管理工具ssh-（重点）\"><a href=\"#3-远程服务管理工具ssh-（重点）\" class=\"headerlink\" title=\"3. 远程服务管理工具ssh （重点）\"></a>3. 远程服务管理工具ssh （重点）</h2><p>Secure Shell 安全外壳协议，建立在应用层基础上的安全协议。</p>\n<p>可靠，专为远程登录会话和其他网络服务提供安全性的协议。</p>\n<h3 id=\"1-安装-ssh-服务\"><a href=\"#1-安装-ssh-服务\" class=\"headerlink\" title=\"1. 安装 ssh 服务\"></a>1. 安装 ssh 服务</h3><p>服务器端一般默认已安装了ssh服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install openssh-server</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-启动-ssh\"><a href=\"#2-启动-ssh\" class=\"headerlink\" title=\"2. 启动 ssh\"></a>2. 启动 ssh</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service sshd start</span><br><span class=\"line\">ps -ef | grep ssh</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-设置开机启动\"><a href=\"#3-设置开机启动\" class=\"headerlink\" title=\"3. 设置开机启动\"></a>3. 设置开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig sshd on</span><br></pre></td></tr></table></figure>\n\n<p>客户端安装 ssh 工具</p>\n<p>Win:Xshell, Putty, secureCRT 等，<br>Linux: <code>yum install openssh-clients</code></p>\n<p>连接：<br><code>ssh zzp@47.93.234.60 -p 8222</code></p>\n<h3 id=\"4-ssh-config-命令\"><a href=\"#4-ssh-config-命令\" class=\"headerlink\" title=\"4. ssh config 命令\"></a>4. ssh config 命令</h3><ul>\n<li>为了方便批量管理多个ssh</li>\n<li>存放在 ~/.ssh/config</li>\n</ul>\n<p>config 语法：</p>\n<ol>\n<li>Host: 别名</li>\n<li>HostName: 主机名或ip</li>\n<li>Port: 端口 默认 22</li>\n<li>User: 用户名</li>\n<li>IdentityFile: 密钥文件路径</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz ~]# cd .ssh&#x2F;</span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz .ssh]# ll</span><br><span class=\"line\">total 4</span><br><span class=\"line\">-rw------- 1 root root 403 May 24 15:20 authorized_keys</span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz .ssh]# touch config</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-免密登录-ssh-key\"><a href=\"#5-免密登录-ssh-key\" class=\"headerlink\" title=\"5. 免密登录 ssh key\"></a>5. 免密登录 ssh key</h3><p>使用非对称加密方式生成公钥和私钥，私钥存放在本地 ~/.ssh，保护好私钥，公钥可以对外公开，放在服务器的 ~/.ssh/authorized_keys</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">ssh-keygen -t dsa</span><br></pre></td></tr></table></figure>\n\n<p>需要加载私钥</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add ~&#x2F;.ssh&#x2F;private_key</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-iTerm-中配置免密登录-sshpass\"><a href=\"#5-iTerm-中配置免密登录-sshpass\" class=\"headerlink\" title=\"5. iTerm 中配置免密登录 sshpass\"></a>5. <a href=\"http://www.cnblogs.com/onlyfu/p/4460160.html\">iTerm 中配置免密登录 sshpass</a></h3><p>我的配置大概下面这个样子</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;sshpass  -f &#x2F;zzp&#x2F;sshpass&#x2F;my_aliyun_pass ssh zzp@47.93.234.60 -p 8222</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>/zzp/sshpass/my_aliyun_pass</code> 文件中存储的是登录密码，设置好快捷键后就可以实现一键免密登录。</p>\n<h3 id=\"6-端口安全\"><a href=\"#6-端口安全\" class=\"headerlink\" title=\"6. 端口安全\"></a>6. 端口安全</h3><p>改变默认服务器端口，修改 <code>/etc/ssh/sshd_config</code> 文件，大概十几行， Port 12345，并且可以同时监听多个端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Port 12345</span><br><span class=\"line\">Port 10086</span><br><span class=\"line\">Port 10010</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Liunx-常用命令\"><a href=\"#4-Liunx-常用命令\" class=\"headerlink\" title=\"4. Liunx 常用命令\"></a>4. Liunx 常用命令</h2><h3 id=\"1-软件操作命令\"><a href=\"#1-软件操作命令\" class=\"headerlink\" title=\"1. 软件操作命令\"></a>1. 软件操作命令</h3><p>软件包管理器 yum</p>\n<ul>\n<li>安装软件 <code>yum install xxx</code></li>\n<li>卸载软件 <code>yum remove xxx</code></li>\n<li>搜索软件 <code>yum search xxx</code></li>\n<li>清理缓存 <code>yum clean packages</code></li>\n<li>列出已安装 <code>yum list</code> 会列出很多，最好grep一下</li>\n<li>软件包信息 <code>yum info xxx</code></li>\n</ul>\n<h3 id=\"2-服务器硬件资源信息\"><a href=\"#2-服务器硬件资源信息\" class=\"headerlink\" title=\"2. 服务器硬件资源信息\"></a>2. 服务器硬件资源信息</h3><ul>\n<li>内存 <code>free -m</code></li>\n<li>硬盘 <code>df -h</code></li>\n<li>负载 <code>w/top</code></li>\n<li>cpu 个数和核数 <code>cat /proc/cpuinfo</code></li>\n</ul>\n<p>1分钟，5分钟，15分钟的平均负载，一般大于0.6或0.7为危险</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ w</span><br><span class=\"line\">21:13:30 up 1 day, 20:22,  1 user,  load average: 0.00, 0.03, 0.05</span><br><span class=\"line\">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class=\"line\">zzp      pts&#x2F;0    123.122.85.229   21:05    2.00s  0.00s  0.00s w</span><br></pre></td></tr></table></figure>\n\n<p>fdisk 可视化磁盘</p>\n<h3 id=\"3-文件操作命令\"><a href=\"#3-文件操作命令\" class=\"headerlink\" title=\"3. 文件操作命令\"></a>3. 文件操作命令</h3><p>文件目录结构</p>\n<ul>\n<li>根目录 /</li>\n<li>家目录 /home</li>\n<li>临时目录 /tmp</li>\n<li>配置目录 /etc</li>\n<li>用户程序目录 /usr</li>\n</ul>\n<p>文件操作</p>\n<ul>\n<li>查看目录下的文件 ls/ll/ll -ah</li>\n<li>新建文件 touch</li>\n<li>新建文件夹 mkdir (mkdir -p dir1/dir2/dir3/dir4)</li>\n<li>进入目录 cd</li>\n<li>删除文件和目录 rm</li>\n<li>复制 cp</li>\n<li>移动 mv</li>\n<li>显示当前路径 pwd (print working directory)</li>\n</ul>\n<h3 id=\"4-Vim\"><a href=\"#4-Vim\" class=\"headerlink\" title=\"4. Vim\"></a>4. Vim</h3><ul>\n<li>首行 gg</li>\n<li>末行 G</li>\n<li>行尾 $</li>\n<li>删除 dd</li>\n<li>恢复 u</li>\n<li>复制 yy</li>\n<li>粘贴 p </li>\n</ul>\n<h3 id=\"5-文件搜索、查找、读取\"><a href=\"#5-文件搜索、查找、读取\" class=\"headerlink\" title=\"5. 文件搜索、查找、读取\"></a>5. 文件搜索、查找、读取</h3><ul>\n<li>从文件尾部开始读 tail 通常加 -f</li>\n<li>从文件头部开始读 head</li>\n<li>读取整个文件 cat 注意大文件，不要随意读</li>\n<li>分页读取 more 从头部开始读</li>\n<li>可控分页 less </li>\n<li>搜索关键字 grep  (grep -n “error” filename)</li>\n<li>查找文件 find</li>\n<li>统计个数 wc (cat filename | wc -l)  wordcount</li>\n</ul>\n<p><code>grep &quot;2017-11-11&quot; filename | more</code></p>\n<p><code>find . -name &quot;*.conf&quot;</code> 在当前目录及其子目录下查找名称以.conf结尾的文件</p>\n<p><code>find . -type f</code> 在当前目录及其子目录下查找类型为文件的文件</p>\n<p><code>find . -type d</code> 在当前目录及其子目录下查找类型为目录的文件</p>\n<p><code>find . -ctime -20</code> 在当前目录及其子目录下查找所有最近20天内更新过的文件</p>\n<p><code>find /var/log -type f -mtime +7 -exec rm &#123;&#125;; \\</code> 在/var/log下查找所有7天以前更新过的文件，删除</p>\n<p><code>find . -type f -perm 644 -exec ls -al &#123;&#125; \\;</code></p>\n<h3 id=\"6-文件解压缩\"><a href=\"#6-文件解压缩\" class=\"headerlink\" title=\"6. 文件解压缩\"></a>6. 文件解压缩</h3><p><code>tar -cf des.tar source</code> create compressed file from source to des</p>\n<p><code>tar -tvf file.tar</code> list files in the compressed file</p>\n<p><code>tar -xf file.tar</code> extract file from the compressed file</p>\n<p><code>tar -czvf des.tar.gz source</code>  in .gz format, visualized, -f usually is the last param</p>\n<p><code>tar -xzvf file.tar.gz</code></p>\n<p>记住每个参数的意思</p>\n<h3 id=\"7-系统用户操作命令\"><a href=\"#7-系统用户操作命令\" class=\"headerlink\" title=\"7. 系统用户操作命令\"></a>7. 系统用户操作命令</h3><ul>\n<li>useradd</li>\n<li>adduser</li>\n<li>userdel</li>\n<li>passwd</li>\n</ul>\n<blockquote>\n<p>useradd is native binary compiled with the system. But, adduser is a perl script which uses useradd binary in back-end.<br>adduser is more user friendly and interactive than its back-end useradd. There’s no difference in features provided.</p>\n</blockquote>\n<h3 id=\"8-防火墙的设置\"><a href=\"#8-防火墙的设置\" class=\"headerlink\" title=\"8. 防火墙的设置\"></a>8. 防火墙的设置</h3><p>保护服务器安全</p>\n<p>确认服务是否已安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum list | grep firewall</span><br><span class=\"line\">firewalld.noarch                        0.4.4.4-6.el7                  @base</span><br><span class=\"line\">firewalld-filesystem.noarch             0.4.4.4-6.el7                  @base</span><br><span class=\"line\">python-firewall.noarch                  0.4.4.4-6.el7                  @base</span><br><span class=\"line\">fail2ban-firewalld.noarch               0.9.7-1.el7                    epel</span><br><span class=\"line\">firewall-applet.noarch                  0.4.4.4-6.el7                  base</span><br><span class=\"line\">firewall-config.noarch                  0.4.4.4-6.el7                  base</span><br><span class=\"line\">puppet-firewalld.noarch                 0.1.3-1.el7                    epel</span><br><span class=\"line\">system-config-firewall.noarch           1.2.29-10.el7                  base</span><br><span class=\"line\">system-config-firewall-base.noarch      1.2.29-10.el7                  base</span><br><span class=\"line\">system-config-firewall-tui.noarch       1.2.29-10.el7                  base</span><br></pre></td></tr></table></figure>\n\n<p>确认服务是否已启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ps -ef | grep firewall</span><br><span class=\"line\">root     19678 19531  0 22:45 pts&#x2F;1    00:00:00 grep --color&#x3D;auto firewall</span><br></pre></td></tr></table></figure>\n\n<p>安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install firewalld</span><br></pre></td></tr></table></figure>\n\n<p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ service firewalld start</span><br><span class=\"line\">Redirecting to &#x2F;bin&#x2F;systemctl start  firewalld.service</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D; AUTHENTICATING FOR org.freedesktop.systemd1.manage-units &#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">Authentication is required to manage system services or units.</span><br><span class=\"line\">Authenticating as: root</span><br><span class=\"line\">Password:</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D; AUTHENTICATION COMPLETE &#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>\n\n<p>检查状态</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># service firewalld status</span><br><span class=\"line\">Redirecting to &#x2F;bin&#x2F;systemctl status  firewalld.service</span><br><span class=\"line\">● firewalld.service</span><br><span class=\"line\">   Loaded: masked (&#x2F;dev&#x2F;null; bad)</span><br><span class=\"line\">   Active: inactive (dead)</span><br></pre></td></tr></table></figure>\n\n<p>关闭或禁用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># service firewalld stop&#x2F;disable</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --version</span><br><span class=\"line\">firewall-cmd --state</span><br><span class=\"line\">firewall-cmd --get-zones</span><br><span class=\"line\">firewall-cmd --get-default-zone</span><br><span class=\"line\">firewall-cmd --list-all-zone</span><br><span class=\"line\">firewall-cmd --zone&#x3D;public</span><br><span class=\"line\">firewall-cmd --list-ports</span><br><span class=\"line\">firewall-cmd --query-service&#x3D;ssh</span><br><span class=\"line\">firewall-cmd --remove-service&#x3D;ssh</span><br><span class=\"line\">firewall-cmd --add-service&#x3D;ssh</span><br><span class=\"line\">firewall-cmd --list-services</span><br><span class=\"line\">firewall-cmd --query-port&#x3D;22&#x2F;tcp</span><br><span class=\"line\">firewall-cmd --add-port&#x3D;22&#x2F;tcp</span><br><span class=\"line\">firewall-cmd --remove-port&#x3D;22&#x2F;tcp</span><br><span class=\"line\">firewall-cmd --list-ports</span><br><span class=\"line\">firewall-cmd --get-all-zones</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-提权和文件上传下载\"><a href=\"#9-提权和文件上传下载\" class=\"headerlink\" title=\"9. 提权和文件上传下载\"></a>9. 提权和文件上传下载</h3><ul>\n<li>提权 sudo</li>\n<li>下载 wget, curl</li>\n<li>上传 scp</li>\n</ul>\n<p>secureCRT + lrzsz</p>\n<h4 id=\"1-提权\"><a href=\"#1-提权\" class=\"headerlink\" title=\"1. 提权\"></a>1. 提权</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">visudo</span><br></pre></td></tr></table></figure>\n<p>找到 Allows people in group wheel to run all commands</p>\n<p>添加一行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%user ALL&#x3D;(ALL)  ALL</span><br></pre></td></tr></table></figure>\n<p>将用户添加到提权账号中</p>\n<p>尽量不要使用root 账号进行操作。</p>\n<h4 id=\"2-下载\"><a href=\"#2-下载\" class=\"headerlink\" title=\"2. 下载\"></a>2. 下载</h4><p>一般使用 wget 就可以了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># wget http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br><span class=\"line\">--2017-11-13 23:33:40--  http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br><span class=\"line\">Resolving www.baidu.com (www.baidu.com)... 115.239.210.27, 115.239.211.112</span><br><span class=\"line\">Connecting to www.baidu.com (www.baidu.com)|115.239.210.27|:80... connected.</span><br><span class=\"line\">HTTP request sent, awaiting response... 200 OK</span><br><span class=\"line\">Length: 2381 (2.3K) [text&#x2F;html]</span><br><span class=\"line\">Saving to: ‘index.html’</span><br><span class=\"line\"></span><br><span class=\"line\">100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 2,381       --.-K&#x2F;s   in 0s</span><br><span class=\"line\"></span><br><span class=\"line\">2017-11-13 23:33:40 (260 MB&#x2F;s) - ‘index.html’ saved [2381&#x2F;2381]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz ~]# ll</span><br><span class=\"line\">-rw-r--r--  1 root root     2381 Jan 23  2017 index.html</span><br><span class=\"line\"></span><br><span class=\"line\"># curl -o baidu.html http:&#x2F;&#x2F;www.baidu.com</span><br><span class=\"line\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class=\"line\">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class=\"line\">100  2381  100  2381    0     0   3918      0 --:--:-- --:--:-- --:--:--  3922</span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz ~]# ll</span><br><span class=\"line\">-rw-r--r--  1 root root     2381 Nov 13 23:34 baidu.html</span><br><span class=\"line\">-rw-r--r--  1 root root     2381 Jan 23  2017 index.html</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-上传\"><a href=\"#3-上传\" class=\"headerlink\" title=\"3. 上传\"></a>3. 上传</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp file root@192.168.1.1:&#x2F;dir&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>下载到本地</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp root@192.168.1.1:&#x2F;dir&#x2F;file locate_dir</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<p>慕课网 <a href=\"http://coding.imooc.com/learn/list/154.html\">快速上手Linux 玩转典型应用</a> 学习笔记  part-1</p>\n<p><a href=\"http://www.runoob.com/linux/linux-tutorial.html\">在线学习点这里</a></p>","more":"<h2 id=\"1-研发必须知道的-Linux-知识\"><a href=\"#1-研发必须知道的-Linux-知识\" class=\"headerlink\" title=\"1. 研发必须知道的 Linux 知识\"></a>1. 研发必须知道的 Linux 知识</h2><ul>\n<li>Linux 区分大小写</li>\n<li>一切皆文件</li>\n<li>文件名后缀只是为了便于识别，对系统没有任何意义</li>\n<li>云服务器与本地虚拟机的最主要区别就是云服务器有<strong>公网IP</strong></li>\n</ul>\n<h2 id=\"2-准备知识\"><a href=\"#2-准备知识\" class=\"headerlink\" title=\"2. 准备知识\"></a>2. 准备知识</h2><h3 id=\"1-查看-ip\"><a href=\"#1-查看-ip\" class=\"headerlink\" title=\"1. 查看 ip\"></a>1. 查看 ip</h3><h4 id=\"ifconfig-（最常用）\"><a href=\"#ifconfig-（最常用）\" class=\"headerlink\" title=\"ifconfig （最常用）\"></a>ifconfig （最常用）</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ifconfig</span><br><span class=\"line\">eth0: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class=\"line\">        inet 172.17.147.89  netmask 255.255.240.0  broadcast 172.17.159.255</span><br><span class=\"line\">        ether 00:16:3e:2e:0c:1e  txqueuelen 1000  (Ethernet)</span><br><span class=\"line\">        RX packets 14729288  bytes 2106329863 (1.9 GiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 9911393  bytes 8389800747 (7.8 GiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class=\"line\"></span><br><span class=\"line\">lo: flags&#x3D;73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class=\"line\">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class=\"line\">        loop  txqueuelen 1  (Local Loopback)</span><br><span class=\"line\">        RX packets 10772426  bytes 667897558 (636.9 MiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 10772426  bytes 667897558 (636.9 MiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"ip-addr\"><a href=\"#ip-addr\" class=\"headerlink\" title=\"ip addr\"></a>ip addr</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ ip addr</span><br><span class=\"line\"># 本地回环ip</span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class=\"line\">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">    inet 127.0.0.1&#x2F;8 scope host lo</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br><span class=\"line\"># 物理ip</span><br><span class=\"line\">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class=\"line\">    link&#x2F;ether 00:16:3e:2e:0c:1e brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    inet 172.17.147.89&#x2F;20 brd 172.17.159.255 scope global eth0</span><br><span class=\"line\">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"vi-ifcfg-xx\"><a href=\"#vi-ifcfg-xx\" class=\"headerlink\" title=\"vi ifcfg-xx\"></a>vi ifcfg-xx</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[zzp@iZ2ze4kikm9076bxac1noqZ ~]$ vi &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;ifcfg-xx</span><br><span class=\"line\"># 这里 xx 就是 ip addr 获取到里的两个ip的名字， lo和eth0</span><br></pre></td></tr></table></figure>\n\n<p>修改 <code>ONBOOT=yes</code>， 并<code>service network restart</code>，对应的网络信息就可以在 <code>ip addr</code> 下显示。</p>\n<h4 id=\"yum-install-net-tools\"><a href=\"#yum-install-net-tools\" class=\"headerlink\" title=\"yum install net-tools\"></a>yum install net-tools</h4><p>安装完成后就可以使用ifconfig命令（minial 版的centOS阉割了此命令）</p>\n<h3 id=\"2-替换默认源（软件下载地址）\"><a href=\"#2-替换默认源（软件下载地址）\" class=\"headerlink\" title=\"2. 替换默认源（软件下载地址）\"></a>2. 替换默认源（软件下载地址）</h3><p>操作方法见此<a href=\"http://mirrors.163.com/.help/centos.html\">地址</a></p>\n<h3 id=\"3-安装-vim\"><a href=\"#3-安装-vim\" class=\"headerlink\" title=\"3. 安装 vim\"></a>3. 安装 vim</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install vim</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-远程服务管理工具ssh-（重点）\"><a href=\"#3-远程服务管理工具ssh-（重点）\" class=\"headerlink\" title=\"3. 远程服务管理工具ssh （重点）\"></a>3. 远程服务管理工具ssh （重点）</h2><p>Secure Shell 安全外壳协议，建立在应用层基础上的安全协议。</p>\n<p>可靠，专为远程登录会话和其他网络服务提供安全性的协议。</p>\n<h3 id=\"1-安装-ssh-服务\"><a href=\"#1-安装-ssh-服务\" class=\"headerlink\" title=\"1. 安装 ssh 服务\"></a>1. 安装 ssh 服务</h3><p>服务器端一般默认已安装了ssh服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install openssh-server</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-启动-ssh\"><a href=\"#2-启动-ssh\" class=\"headerlink\" title=\"2. 启动 ssh\"></a>2. 启动 ssh</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service sshd start</span><br><span class=\"line\">ps -ef | grep ssh</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-设置开机启动\"><a href=\"#3-设置开机启动\" class=\"headerlink\" title=\"3. 设置开机启动\"></a>3. 设置开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chkconfig sshd on</span><br></pre></td></tr></table></figure>\n\n<p>客户端安装 ssh 工具</p>\n<p>Win:Xshell, Putty, secureCRT 等，<br>Linux: <code>yum install openssh-clients</code></p>\n<p>连接：<br><code>ssh zzp@47.93.234.60 -p 8222</code></p>\n<h3 id=\"4-ssh-config-命令\"><a href=\"#4-ssh-config-命令\" class=\"headerlink\" title=\"4. ssh config 命令\"></a>4. ssh config 命令</h3><ul>\n<li>为了方便批量管理多个ssh</li>\n<li>存放在 ~/.ssh/config</li>\n</ul>\n<p>config 语法：</p>\n<ol>\n<li>Host: 别名</li>\n<li>HostName: 主机名或ip</li>\n<li>Port: 端口 默认 22</li>\n<li>User: 用户名</li>\n<li>IdentityFile: 密钥文件路径</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz ~]# cd .ssh&#x2F;</span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz .ssh]# ll</span><br><span class=\"line\">total 4</span><br><span class=\"line\">-rw------- 1 root root 403 May 24 15:20 authorized_keys</span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz .ssh]# touch config</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-免密登录-ssh-key\"><a href=\"#5-免密登录-ssh-key\" class=\"headerlink\" title=\"5. 免密登录 ssh key\"></a>5. 免密登录 ssh key</h3><p>使用非对称加密方式生成公钥和私钥，私钥存放在本地 ~/.ssh，保护好私钥，公钥可以对外公开，放在服务器的 ~/.ssh/authorized_keys</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br><span class=\"line\">ssh-keygen -t dsa</span><br></pre></td></tr></table></figure>\n\n<p>需要加载私钥</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add ~&#x2F;.ssh&#x2F;private_key</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-iTerm-中配置免密登录-sshpass\"><a href=\"#5-iTerm-中配置免密登录-sshpass\" class=\"headerlink\" title=\"5. iTerm 中配置免密登录 sshpass\"></a>5. <a href=\"http://www.cnblogs.com/onlyfu/p/4460160.html\">iTerm 中配置免密登录 sshpass</a></h3><p>我的配置大概下面这个样子</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;sshpass  -f &#x2F;zzp&#x2F;sshpass&#x2F;my_aliyun_pass ssh zzp@47.93.234.60 -p 8222</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>/zzp/sshpass/my_aliyun_pass</code> 文件中存储的是登录密码，设置好快捷键后就可以实现一键免密登录。</p>\n<h3 id=\"6-端口安全\"><a href=\"#6-端口安全\" class=\"headerlink\" title=\"6. 端口安全\"></a>6. 端口安全</h3><p>改变默认服务器端口，修改 <code>/etc/ssh/sshd_config</code> 文件，大概十几行， Port 12345，并且可以同时监听多个端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Port 12345</span><br><span class=\"line\">Port 10086</span><br><span class=\"line\">Port 10010</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Liunx-常用命令\"><a href=\"#4-Liunx-常用命令\" class=\"headerlink\" title=\"4. Liunx 常用命令\"></a>4. Liunx 常用命令</h2><h3 id=\"1-软件操作命令\"><a href=\"#1-软件操作命令\" class=\"headerlink\" title=\"1. 软件操作命令\"></a>1. 软件操作命令</h3><p>软件包管理器 yum</p>\n<ul>\n<li>安装软件 <code>yum install xxx</code></li>\n<li>卸载软件 <code>yum remove xxx</code></li>\n<li>搜索软件 <code>yum search xxx</code></li>\n<li>清理缓存 <code>yum clean packages</code></li>\n<li>列出已安装 <code>yum list</code> 会列出很多，最好grep一下</li>\n<li>软件包信息 <code>yum info xxx</code></li>\n</ul>\n<h3 id=\"2-服务器硬件资源信息\"><a href=\"#2-服务器硬件资源信息\" class=\"headerlink\" title=\"2. 服务器硬件资源信息\"></a>2. 服务器硬件资源信息</h3><ul>\n<li>内存 <code>free -m</code></li>\n<li>硬盘 <code>df -h</code></li>\n<li>负载 <code>w/top</code></li>\n<li>cpu 个数和核数 <code>cat /proc/cpuinfo</code></li>\n</ul>\n<p>1分钟，5分钟，15分钟的平均负载，一般大于0.6或0.7为危险</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ w</span><br><span class=\"line\">21:13:30 up 1 day, 20:22,  1 user,  load average: 0.00, 0.03, 0.05</span><br><span class=\"line\">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class=\"line\">zzp      pts&#x2F;0    123.122.85.229   21:05    2.00s  0.00s  0.00s w</span><br></pre></td></tr></table></figure>\n\n<p>fdisk 可视化磁盘</p>\n<h3 id=\"3-文件操作命令\"><a href=\"#3-文件操作命令\" class=\"headerlink\" title=\"3. 文件操作命令\"></a>3. 文件操作命令</h3><p>文件目录结构</p>\n<ul>\n<li>根目录 /</li>\n<li>家目录 /home</li>\n<li>临时目录 /tmp</li>\n<li>配置目录 /etc</li>\n<li>用户程序目录 /usr</li>\n</ul>\n<p>文件操作</p>\n<ul>\n<li>查看目录下的文件 ls/ll/ll -ah</li>\n<li>新建文件 touch</li>\n<li>新建文件夹 mkdir (mkdir -p dir1/dir2/dir3/dir4)</li>\n<li>进入目录 cd</li>\n<li>删除文件和目录 rm</li>\n<li>复制 cp</li>\n<li>移动 mv</li>\n<li>显示当前路径 pwd (print working directory)</li>\n</ul>\n<h3 id=\"4-Vim\"><a href=\"#4-Vim\" class=\"headerlink\" title=\"4. Vim\"></a>4. Vim</h3><ul>\n<li>首行 gg</li>\n<li>末行 G</li>\n<li>行尾 $</li>\n<li>删除 dd</li>\n<li>恢复 u</li>\n<li>复制 yy</li>\n<li>粘贴 p </li>\n</ul>\n<h3 id=\"5-文件搜索、查找、读取\"><a href=\"#5-文件搜索、查找、读取\" class=\"headerlink\" title=\"5. 文件搜索、查找、读取\"></a>5. 文件搜索、查找、读取</h3><ul>\n<li>从文件尾部开始读 tail 通常加 -f</li>\n<li>从文件头部开始读 head</li>\n<li>读取整个文件 cat 注意大文件，不要随意读</li>\n<li>分页读取 more 从头部开始读</li>\n<li>可控分页 less </li>\n<li>搜索关键字 grep  (grep -n “error” filename)</li>\n<li>查找文件 find</li>\n<li>统计个数 wc (cat filename | wc -l)  wordcount</li>\n</ul>\n<p><code>grep &quot;2017-11-11&quot; filename | more</code></p>\n<p><code>find . -name &quot;*.conf&quot;</code> 在当前目录及其子目录下查找名称以.conf结尾的文件</p>\n<p><code>find . -type f</code> 在当前目录及其子目录下查找类型为文件的文件</p>\n<p><code>find . -type d</code> 在当前目录及其子目录下查找类型为目录的文件</p>\n<p><code>find . -ctime -20</code> 在当前目录及其子目录下查找所有最近20天内更新过的文件</p>\n<p><code>find /var/log -type f -mtime +7 -exec rm &#123;&#125;; \\</code> 在/var/log下查找所有7天以前更新过的文件，删除</p>\n<p><code>find . -type f -perm 644 -exec ls -al &#123;&#125; \\;</code></p>\n<h3 id=\"6-文件解压缩\"><a href=\"#6-文件解压缩\" class=\"headerlink\" title=\"6. 文件解压缩\"></a>6. 文件解压缩</h3><p><code>tar -cf des.tar source</code> create compressed file from source to des</p>\n<p><code>tar -tvf file.tar</code> list files in the compressed file</p>\n<p><code>tar -xf file.tar</code> extract file from the compressed file</p>\n<p><code>tar -czvf des.tar.gz source</code>  in .gz format, visualized, -f usually is the last param</p>\n<p><code>tar -xzvf file.tar.gz</code></p>\n<p>记住每个参数的意思</p>\n<h3 id=\"7-系统用户操作命令\"><a href=\"#7-系统用户操作命令\" class=\"headerlink\" title=\"7. 系统用户操作命令\"></a>7. 系统用户操作命令</h3><ul>\n<li>useradd</li>\n<li>adduser</li>\n<li>userdel</li>\n<li>passwd</li>\n</ul>\n<blockquote>\n<p>useradd is native binary compiled with the system. But, adduser is a perl script which uses useradd binary in back-end.<br>adduser is more user friendly and interactive than its back-end useradd. There’s no difference in features provided.</p>\n</blockquote>\n<h3 id=\"8-防火墙的设置\"><a href=\"#8-防火墙的设置\" class=\"headerlink\" title=\"8. 防火墙的设置\"></a>8. 防火墙的设置</h3><p>保护服务器安全</p>\n<p>确认服务是否已安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum list | grep firewall</span><br><span class=\"line\">firewalld.noarch                        0.4.4.4-6.el7                  @base</span><br><span class=\"line\">firewalld-filesystem.noarch             0.4.4.4-6.el7                  @base</span><br><span class=\"line\">python-firewall.noarch                  0.4.4.4-6.el7                  @base</span><br><span class=\"line\">fail2ban-firewalld.noarch               0.9.7-1.el7                    epel</span><br><span class=\"line\">firewall-applet.noarch                  0.4.4.4-6.el7                  base</span><br><span class=\"line\">firewall-config.noarch                  0.4.4.4-6.el7                  base</span><br><span class=\"line\">puppet-firewalld.noarch                 0.1.3-1.el7                    epel</span><br><span class=\"line\">system-config-firewall.noarch           1.2.29-10.el7                  base</span><br><span class=\"line\">system-config-firewall-base.noarch      1.2.29-10.el7                  base</span><br><span class=\"line\">system-config-firewall-tui.noarch       1.2.29-10.el7                  base</span><br></pre></td></tr></table></figure>\n\n<p>确认服务是否已启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># ps -ef | grep firewall</span><br><span class=\"line\">root     19678 19531  0 22:45 pts&#x2F;1    00:00:00 grep --color&#x3D;auto firewall</span><br></pre></td></tr></table></figure>\n\n<p>安装</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># yum install firewalld</span><br></pre></td></tr></table></figure>\n\n<p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ service firewalld start</span><br><span class=\"line\">Redirecting to &#x2F;bin&#x2F;systemctl start  firewalld.service</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D; AUTHENTICATING FOR org.freedesktop.systemd1.manage-units &#x3D;&#x3D;&#x3D;</span><br><span class=\"line\">Authentication is required to manage system services or units.</span><br><span class=\"line\">Authenticating as: root</span><br><span class=\"line\">Password:</span><br><span class=\"line\">&#x3D;&#x3D;&#x3D;&#x3D; AUTHENTICATION COMPLETE &#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>\n\n<p>检查状态</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># service firewalld status</span><br><span class=\"line\">Redirecting to &#x2F;bin&#x2F;systemctl status  firewalld.service</span><br><span class=\"line\">● firewalld.service</span><br><span class=\"line\">   Loaded: masked (&#x2F;dev&#x2F;null; bad)</span><br><span class=\"line\">   Active: inactive (dead)</span><br></pre></td></tr></table></figure>\n\n<p>关闭或禁用</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># service firewalld stop&#x2F;disable</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --version</span><br><span class=\"line\">firewall-cmd --state</span><br><span class=\"line\">firewall-cmd --get-zones</span><br><span class=\"line\">firewall-cmd --get-default-zone</span><br><span class=\"line\">firewall-cmd --list-all-zone</span><br><span class=\"line\">firewall-cmd --zone&#x3D;public</span><br><span class=\"line\">firewall-cmd --list-ports</span><br><span class=\"line\">firewall-cmd --query-service&#x3D;ssh</span><br><span class=\"line\">firewall-cmd --remove-service&#x3D;ssh</span><br><span class=\"line\">firewall-cmd --add-service&#x3D;ssh</span><br><span class=\"line\">firewall-cmd --list-services</span><br><span class=\"line\">firewall-cmd --query-port&#x3D;22&#x2F;tcp</span><br><span class=\"line\">firewall-cmd --add-port&#x3D;22&#x2F;tcp</span><br><span class=\"line\">firewall-cmd --remove-port&#x3D;22&#x2F;tcp</span><br><span class=\"line\">firewall-cmd --list-ports</span><br><span class=\"line\">firewall-cmd --get-all-zones</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-提权和文件上传下载\"><a href=\"#9-提权和文件上传下载\" class=\"headerlink\" title=\"9. 提权和文件上传下载\"></a>9. 提权和文件上传下载</h3><ul>\n<li>提权 sudo</li>\n<li>下载 wget, curl</li>\n<li>上传 scp</li>\n</ul>\n<p>secureCRT + lrzsz</p>\n<h4 id=\"1-提权\"><a href=\"#1-提权\" class=\"headerlink\" title=\"1. 提权\"></a>1. 提权</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">visudo</span><br></pre></td></tr></table></figure>\n<p>找到 Allows people in group wheel to run all commands</p>\n<p>添加一行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">%user ALL&#x3D;(ALL)  ALL</span><br></pre></td></tr></table></figure>\n<p>将用户添加到提权账号中</p>\n<p>尽量不要使用root 账号进行操作。</p>\n<h4 id=\"2-下载\"><a href=\"#2-下载\" class=\"headerlink\" title=\"2. 下载\"></a>2. 下载</h4><p>一般使用 wget 就可以了</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># wget http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br><span class=\"line\">--2017-11-13 23:33:40--  http:&#x2F;&#x2F;www.baidu.com&#x2F;</span><br><span class=\"line\">Resolving www.baidu.com (www.baidu.com)... 115.239.210.27, 115.239.211.112</span><br><span class=\"line\">Connecting to www.baidu.com (www.baidu.com)|115.239.210.27|:80... connected.</span><br><span class=\"line\">HTTP request sent, awaiting response... 200 OK</span><br><span class=\"line\">Length: 2381 (2.3K) [text&#x2F;html]</span><br><span class=\"line\">Saving to: ‘index.html’</span><br><span class=\"line\"></span><br><span class=\"line\">100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 2,381       --.-K&#x2F;s   in 0s</span><br><span class=\"line\"></span><br><span class=\"line\">2017-11-13 23:33:40 (260 MB&#x2F;s) - ‘index.html’ saved [2381&#x2F;2381]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz ~]# ll</span><br><span class=\"line\">-rw-r--r--  1 root root     2381 Jan 23  2017 index.html</span><br><span class=\"line\"></span><br><span class=\"line\"># curl -o baidu.html http:&#x2F;&#x2F;www.baidu.com</span><br><span class=\"line\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class=\"line\">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class=\"line\">100  2381  100  2381    0     0   3918      0 --:--:-- --:--:-- --:--:--  3922</span><br><span class=\"line\">[root@iz2ze4kikm9076bxac1noqz ~]# ll</span><br><span class=\"line\">-rw-r--r--  1 root root     2381 Nov 13 23:34 baidu.html</span><br><span class=\"line\">-rw-r--r--  1 root root     2381 Jan 23  2017 index.html</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-上传\"><a href=\"#3-上传\" class=\"headerlink\" title=\"3. 上传\"></a>3. 上传</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp file root@192.168.1.1:&#x2F;dir&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p>下载到本地</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp root@192.168.1.1:&#x2F;dir&#x2F;file locate_dir</span><br></pre></td></tr></table></figure>"},{"title":"把 mac 上的默认 php 修改为 MAMP 等扩展环境中的 php 版本","date":"2017-01-02T16:00:00.000Z","_content":"\n1. 把mac上的默认php修改为MAMP等扩展环境中的php 版本，也就是不使用 mac 自带的。步骤如下：\n\n<!--more-->\n\n打开terminal。输入```locate .bash_profile```， 找到我们需要编辑的文件的路径。\ncd 到该目录下执行```sudo vim .bash_profile```,这个文件也有可能没有，如果没有就新建一个。\n在vim中打开或新建好该文件后在文件末尾添加\n```export PATH=\"/Applications/MAMP/bin/php/php5.6.10/bin:$PATH\"```\n注：“=”号之后，“：”号之前的路径就是你要修改成的php的路径，我这里选取的是MAMP中自带的5.6版本。\n保存后运行： ```source .bash_profile```，可能会报错，不用管。\n就大功告成了，接着我们验证一下，另开terminal，输入which PHP,有没有发现默认php的路径已经修改好了呢。接下来就可以正常使用了，如果还不行，重启电脑就可以了。\n\n坑：在 /etc/profiles 中设置了环境变量后, 还是不能在 zsh 中使用. 是因为没有在 .zshrc 中配置.\n\n在终端中输入: `cat ~/.zshrc` 以此来查看 .zshrc 文件, 找到里面的 ` # User configuration ` 部分. 可以看到当前 zsh 支持的所有本地已配置环境变量.\n在 `export PATH=”XXXX”` 里面追加一条想要配置的环境变量路径.\n\n\n","source":"_posts/把mac上的默认php修改为MAMP等扩展环境中的php-版本.md","raw":"---\ntitle: 把 mac 上的默认 php 修改为 MAMP 等扩展环境中的 php 版本\ndate: 2017-01-03\ntags: php\n---\n\n1. 把mac上的默认php修改为MAMP等扩展环境中的php 版本，也就是不使用 mac 自带的。步骤如下：\n\n<!--more-->\n\n打开terminal。输入```locate .bash_profile```， 找到我们需要编辑的文件的路径。\ncd 到该目录下执行```sudo vim .bash_profile```,这个文件也有可能没有，如果没有就新建一个。\n在vim中打开或新建好该文件后在文件末尾添加\n```export PATH=\"/Applications/MAMP/bin/php/php5.6.10/bin:$PATH\"```\n注：“=”号之后，“：”号之前的路径就是你要修改成的php的路径，我这里选取的是MAMP中自带的5.6版本。\n保存后运行： ```source .bash_profile```，可能会报错，不用管。\n就大功告成了，接着我们验证一下，另开terminal，输入which PHP,有没有发现默认php的路径已经修改好了呢。接下来就可以正常使用了，如果还不行，重启电脑就可以了。\n\n坑：在 /etc/profiles 中设置了环境变量后, 还是不能在 zsh 中使用. 是因为没有在 .zshrc 中配置.\n\n在终端中输入: `cat ~/.zshrc` 以此来查看 .zshrc 文件, 找到里面的 ` # User configuration ` 部分. 可以看到当前 zsh 支持的所有本地已配置环境变量.\n在 `export PATH=”XXXX”` 里面追加一条想要配置的环境变量路径.\n\n\n","slug":"把mac上的默认php修改为MAMP等扩展环境中的php-版本","published":1,"updated":"2020-09-11T01:04:35.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtz9y003t6wo1h2xz359a","content":"<ol>\n<li>把mac上的默认php修改为MAMP等扩展环境中的php 版本，也就是不使用 mac 自带的。步骤如下：</li>\n</ol>\n<a id=\"more\"></a>\n\n<p>打开terminal。输入<code>locate .bash_profile</code>， 找到我们需要编辑的文件的路径。<br>cd 到该目录下执行<code>sudo vim .bash_profile</code>,这个文件也有可能没有，如果没有就新建一个。<br>在vim中打开或新建好该文件后在文件末尾添加<br><code>export PATH=&quot;/Applications/MAMP/bin/php/php5.6.10/bin:$PATH&quot;</code><br>注：“=”号之后，“：”号之前的路径就是你要修改成的php的路径，我这里选取的是MAMP中自带的5.6版本。<br>保存后运行： <code>source .bash_profile</code>，可能会报错，不用管。<br>就大功告成了，接着我们验证一下，另开terminal，输入which PHP,有没有发现默认php的路径已经修改好了呢。接下来就可以正常使用了，如果还不行，重启电脑就可以了。</p>\n<p>坑：在 /etc/profiles 中设置了环境变量后, 还是不能在 zsh 中使用. 是因为没有在 .zshrc 中配置.</p>\n<p>在终端中输入: <code>cat ~/.zshrc</code> 以此来查看 .zshrc 文件, 找到里面的 <code># User configuration</code> 部分. 可以看到当前 zsh 支持的所有本地已配置环境变量.<br>在 <code>export PATH=”XXXX”</code> 里面追加一条想要配置的环境变量路径.</p>\n","site":{"data":{}},"excerpt":"<ol>\n<li>把mac上的默认php修改为MAMP等扩展环境中的php 版本，也就是不使用 mac 自带的。步骤如下：</li>\n</ol>","more":"<p>打开terminal。输入<code>locate .bash_profile</code>， 找到我们需要编辑的文件的路径。<br>cd 到该目录下执行<code>sudo vim .bash_profile</code>,这个文件也有可能没有，如果没有就新建一个。<br>在vim中打开或新建好该文件后在文件末尾添加<br><code>export PATH=&quot;/Applications/MAMP/bin/php/php5.6.10/bin:$PATH&quot;</code><br>注：“=”号之后，“：”号之前的路径就是你要修改成的php的路径，我这里选取的是MAMP中自带的5.6版本。<br>保存后运行： <code>source .bash_profile</code>，可能会报错，不用管。<br>就大功告成了，接着我们验证一下，另开terminal，输入which PHP,有没有发现默认php的路径已经修改好了呢。接下来就可以正常使用了，如果还不行，重启电脑就可以了。</p>\n<p>坑：在 /etc/profiles 中设置了环境变量后, 还是不能在 zsh 中使用. 是因为没有在 .zshrc 中配置.</p>\n<p>在终端中输入: <code>cat ~/.zshrc</code> 以此来查看 .zshrc 文件, 找到里面的 <code># User configuration</code> 部分. 可以看到当前 zsh 支持的所有本地已配置环境变量.<br>在 <code>export PATH=”XXXX”</code> 里面追加一条想要配置的环境变量路径.</p>"},{"title":"富文本编辑器 wangEditor 接入方法","date":"2017-11-18T12:51:55.000Z","_content":"\n[wangEditor](https://www.kancloud.cn/wangfupeng/wangeditor3/332599) 是基于javascript和css开发的 Web富文本编辑器， 轻量、简洁、易用、开源免费\n\n\n## 1. 下载所需的 css 和 js 文件，放到 public 目录下\n\n## 2. 模板文件中引入 css 和 js\n\n其中， js 文件必须放到 jquery 后\n\n<!-- more -->\n\n```\n<link rel=\"stylesheet\" href=\"/bower_components/wangEditor/release/wangEditor.min.css\">\n\n<script type=\"text/javascript\" src=\"/bower_components/wangEditor/release/wangEditor.min.js\"></script>\n```\n\n## 3. 在 html 中，添加一个需要展示编辑器的 div\n```\n<div id=\"editor\">\n    <p>\n        @if(!empty($post)){!! $post->content !!}@endif\n    </p>\n</div>\n```\n\n## 4. js 文件中\n```\n@section('script')\n    <script type=\"text/javascript\">\n        $(document).ready(function () {\n\n            var E = window.wangEditor;\n            var editor = new E('#editor');\n            editor.customConfig.uploadImgServer = '/admin/posts/image/upload';  // 上传图片到服务器\n            editor.customConfig.uploadImgHeaders = {\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n            };\n            editor.customConfig.uploadFileName = 'wangEditorImg';\n            // 将图片大小限制为 1M\n            editor.customConfig.uploadImgMaxSize = 1024 * 1024;\n            // 限制一次最多上传 5 张图片\n            editor.customConfig.uploadImgMaxLength = 5;\n            // 隐藏“网络图片”tab\n            editor.customConfig.showLinkImg = false;\n            editor.customConfig.zIndex = 1;\n            editor.customConfig.menus = [\n                'head',  // 标题\n                'bold',  // 粗体\n                'italic',  // 斜体\n                'underline',  // 下划线\n                'strikeThrough',  // 删除线\n                'foreColor',  // 文字颜色\n                'backColor',  // 背景颜色\n                'link',  // 插入链接\n                'list',  // 列表\n                'justify',  // 对齐方式\n                'quote',  // 引用\n                'emoticon',  // 表情\n                'image',  // 插入图片\n                'table',  // 表格\n//                'video',  // 插入视频\n                'code',  // 插入代码\n                'undo',  // 撤销\n                'redo'  // 重复\n            ];\n            editor.create();\n\t</script>\n@endsection\n\n```\n\n## 5. PHP 文件异步处理上传的图片\n\n需要提前配置文件路径，服务器中单独设置一个目录，最好在项目目录之外，可以使多个项目都同时能访问到，同时配置一个二级域名或端口直接指向该目录。\n\n```\npublic function imageUpload(Request $request)\n{\n    $returnData = imageUpload($request->file('wangEditorImg'), 'posts', true);\n    return response()->json($returnData)->setCallback($request->input('callback'));\n}\n```\n\n```\n// 处理文件上传，需要返回图片路径数组\nfunction imageUpload($file, $dirName, $isWangEditor = false)\n{\n    $returnData = [\n        'errno' => -1,\n        'msg' => '',\n        'data' => ''\n    ];\n\n    $path = sprintf('%s/uploads/%s/%s/', DATA_ROOT, $dirName, \\Carbon\\Carbon::now()->month);\n    autoMakeDir($path);\n\n    $error = $file->getError();\n    if ($error != 0) {\n        $returnData['msg'] = $file->getErrorMessage();\n    } else {\n        $fileExt = $file->getClientOriginalExtension();\n        // 新文件名\n        $newFilename = sprintf('%s_%s.%s', time(), rand(10000, 99999), $fileExt);\n        // 移动文件\n        $file->move($path, $newFilename);\n        $returnData['errno'] = 0;\n        $fileUrl = sprintf('%s/uploads/%s/%s/', DATA_URL, $dirName, \\Carbon\\Carbon::now()->month) . $newFilename;\n        if ($isWangEditor) {\n            $returnData['data'] = [$fileUrl];\n        } else {\n            $returnData['data'] = $newFilename;\n        }\n    }\n\n    return $returnData;\n}\n```","source":"_posts/富文本编辑器-wangEditor-接入方法.md","raw":"---\ntitle: 富文本编辑器 wangEditor 接入方法\ndate: 2017-11-18 20:51:55\ntags: wangEditor\ncategories: html\n---\n\n[wangEditor](https://www.kancloud.cn/wangfupeng/wangeditor3/332599) 是基于javascript和css开发的 Web富文本编辑器， 轻量、简洁、易用、开源免费\n\n\n## 1. 下载所需的 css 和 js 文件，放到 public 目录下\n\n## 2. 模板文件中引入 css 和 js\n\n其中， js 文件必须放到 jquery 后\n\n<!-- more -->\n\n```\n<link rel=\"stylesheet\" href=\"/bower_components/wangEditor/release/wangEditor.min.css\">\n\n<script type=\"text/javascript\" src=\"/bower_components/wangEditor/release/wangEditor.min.js\"></script>\n```\n\n## 3. 在 html 中，添加一个需要展示编辑器的 div\n```\n<div id=\"editor\">\n    <p>\n        @if(!empty($post)){!! $post->content !!}@endif\n    </p>\n</div>\n```\n\n## 4. js 文件中\n```\n@section('script')\n    <script type=\"text/javascript\">\n        $(document).ready(function () {\n\n            var E = window.wangEditor;\n            var editor = new E('#editor');\n            editor.customConfig.uploadImgServer = '/admin/posts/image/upload';  // 上传图片到服务器\n            editor.customConfig.uploadImgHeaders = {\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n            };\n            editor.customConfig.uploadFileName = 'wangEditorImg';\n            // 将图片大小限制为 1M\n            editor.customConfig.uploadImgMaxSize = 1024 * 1024;\n            // 限制一次最多上传 5 张图片\n            editor.customConfig.uploadImgMaxLength = 5;\n            // 隐藏“网络图片”tab\n            editor.customConfig.showLinkImg = false;\n            editor.customConfig.zIndex = 1;\n            editor.customConfig.menus = [\n                'head',  // 标题\n                'bold',  // 粗体\n                'italic',  // 斜体\n                'underline',  // 下划线\n                'strikeThrough',  // 删除线\n                'foreColor',  // 文字颜色\n                'backColor',  // 背景颜色\n                'link',  // 插入链接\n                'list',  // 列表\n                'justify',  // 对齐方式\n                'quote',  // 引用\n                'emoticon',  // 表情\n                'image',  // 插入图片\n                'table',  // 表格\n//                'video',  // 插入视频\n                'code',  // 插入代码\n                'undo',  // 撤销\n                'redo'  // 重复\n            ];\n            editor.create();\n\t</script>\n@endsection\n\n```\n\n## 5. PHP 文件异步处理上传的图片\n\n需要提前配置文件路径，服务器中单独设置一个目录，最好在项目目录之外，可以使多个项目都同时能访问到，同时配置一个二级域名或端口直接指向该目录。\n\n```\npublic function imageUpload(Request $request)\n{\n    $returnData = imageUpload($request->file('wangEditorImg'), 'posts', true);\n    return response()->json($returnData)->setCallback($request->input('callback'));\n}\n```\n\n```\n// 处理文件上传，需要返回图片路径数组\nfunction imageUpload($file, $dirName, $isWangEditor = false)\n{\n    $returnData = [\n        'errno' => -1,\n        'msg' => '',\n        'data' => ''\n    ];\n\n    $path = sprintf('%s/uploads/%s/%s/', DATA_ROOT, $dirName, \\Carbon\\Carbon::now()->month);\n    autoMakeDir($path);\n\n    $error = $file->getError();\n    if ($error != 0) {\n        $returnData['msg'] = $file->getErrorMessage();\n    } else {\n        $fileExt = $file->getClientOriginalExtension();\n        // 新文件名\n        $newFilename = sprintf('%s_%s.%s', time(), rand(10000, 99999), $fileExt);\n        // 移动文件\n        $file->move($path, $newFilename);\n        $returnData['errno'] = 0;\n        $fileUrl = sprintf('%s/uploads/%s/%s/', DATA_URL, $dirName, \\Carbon\\Carbon::now()->month) . $newFilename;\n        if ($isWangEditor) {\n            $returnData['data'] = [$fileUrl];\n        } else {\n            $returnData['data'] = $newFilename;\n        }\n    }\n\n    return $returnData;\n}\n```","slug":"富文本编辑器-wangEditor-接入方法","published":1,"updated":"2020-09-11T01:04:35.048Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza0003w6wo16xiwfqm0","content":"<p><a href=\"https://www.kancloud.cn/wangfupeng/wangeditor3/332599\">wangEditor</a> 是基于javascript和css开发的 Web富文本编辑器， 轻量、简洁、易用、开源免费</p>\n<h2 id=\"1-下载所需的-css-和-js-文件，放到-public-目录下\"><a href=\"#1-下载所需的-css-和-js-文件，放到-public-目录下\" class=\"headerlink\" title=\"1. 下载所需的 css 和 js 文件，放到 public 目录下\"></a>1. 下载所需的 css 和 js 文件，放到 public 目录下</h2><h2 id=\"2-模板文件中引入-css-和-js\"><a href=\"#2-模板文件中引入-css-和-js\" class=\"headerlink\" title=\"2. 模板文件中引入 css 和 js\"></a>2. 模板文件中引入 css 和 js</h2><p>其中， js 文件必须放到 jquery 后</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#x2F;bower_components&#x2F;wangEditor&#x2F;release&#x2F;wangEditor.min.css&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#x2F;bower_components&#x2F;wangEditor&#x2F;release&#x2F;wangEditor.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-在-html-中，添加一个需要展示编辑器的-div\"><a href=\"#3-在-html-中，添加一个需要展示编辑器的-div\" class=\"headerlink\" title=\"3. 在 html 中，添加一个需要展示编辑器的 div\"></a>3. 在 html 中，添加一个需要展示编辑器的 div</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;editor&quot;&gt;</span><br><span class=\"line\">    &lt;p&gt;</span><br><span class=\"line\">        @if(!empty($post))&#123;!! $post-&gt;content !!&#125;@endif</span><br><span class=\"line\">    &lt;&#x2F;p&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-js-文件中\"><a href=\"#4-js-文件中\" class=\"headerlink\" title=\"4. js 文件中\"></a>4. js 文件中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;script&#39;)</span><br><span class=\"line\">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class=\"line\">        $(document).ready(function () &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            var E &#x3D; window.wangEditor;</span><br><span class=\"line\">            var editor &#x3D; new E(&#39;#editor&#39;);</span><br><span class=\"line\">            editor.customConfig.uploadImgServer &#x3D; &#39;&#x2F;admin&#x2F;posts&#x2F;image&#x2F;upload&#39;;  &#x2F;&#x2F; 上传图片到服务器</span><br><span class=\"line\">            editor.customConfig.uploadImgHeaders &#x3D; &#123;</span><br><span class=\"line\">                &#39;X-CSRF-TOKEN&#39;: $(&#39;meta[name&#x3D;&quot;csrf-token&quot;]&#39;).attr(&#39;content&#39;)</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            editor.customConfig.uploadFileName &#x3D; &#39;wangEditorImg&#39;;</span><br><span class=\"line\">            &#x2F;&#x2F; 将图片大小限制为 1M</span><br><span class=\"line\">            editor.customConfig.uploadImgMaxSize &#x3D; 1024 * 1024;</span><br><span class=\"line\">            &#x2F;&#x2F; 限制一次最多上传 5 张图片</span><br><span class=\"line\">            editor.customConfig.uploadImgMaxLength &#x3D; 5;</span><br><span class=\"line\">            &#x2F;&#x2F; 隐藏“网络图片”tab</span><br><span class=\"line\">            editor.customConfig.showLinkImg &#x3D; false;</span><br><span class=\"line\">            editor.customConfig.zIndex &#x3D; 1;</span><br><span class=\"line\">            editor.customConfig.menus &#x3D; [</span><br><span class=\"line\">                &#39;head&#39;,  &#x2F;&#x2F; 标题</span><br><span class=\"line\">                &#39;bold&#39;,  &#x2F;&#x2F; 粗体</span><br><span class=\"line\">                &#39;italic&#39;,  &#x2F;&#x2F; 斜体</span><br><span class=\"line\">                &#39;underline&#39;,  &#x2F;&#x2F; 下划线</span><br><span class=\"line\">                &#39;strikeThrough&#39;,  &#x2F;&#x2F; 删除线</span><br><span class=\"line\">                &#39;foreColor&#39;,  &#x2F;&#x2F; 文字颜色</span><br><span class=\"line\">                &#39;backColor&#39;,  &#x2F;&#x2F; 背景颜色</span><br><span class=\"line\">                &#39;link&#39;,  &#x2F;&#x2F; 插入链接</span><br><span class=\"line\">                &#39;list&#39;,  &#x2F;&#x2F; 列表</span><br><span class=\"line\">                &#39;justify&#39;,  &#x2F;&#x2F; 对齐方式</span><br><span class=\"line\">                &#39;quote&#39;,  &#x2F;&#x2F; 引用</span><br><span class=\"line\">                &#39;emoticon&#39;,  &#x2F;&#x2F; 表情</span><br><span class=\"line\">                &#39;image&#39;,  &#x2F;&#x2F; 插入图片</span><br><span class=\"line\">                &#39;table&#39;,  &#x2F;&#x2F; 表格</span><br><span class=\"line\">&#x2F;&#x2F;                &#39;video&#39;,  &#x2F;&#x2F; 插入视频</span><br><span class=\"line\">                &#39;code&#39;,  &#x2F;&#x2F; 插入代码</span><br><span class=\"line\">                &#39;undo&#39;,  &#x2F;&#x2F; 撤销</span><br><span class=\"line\">                &#39;redo&#39;  &#x2F;&#x2F; 重复</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            editor.create();</span><br><span class=\"line\">\t&lt;&#x2F;script&gt;</span><br><span class=\"line\">@endsection</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-PHP-文件异步处理上传的图片\"><a href=\"#5-PHP-文件异步处理上传的图片\" class=\"headerlink\" title=\"5. PHP 文件异步处理上传的图片\"></a>5. PHP 文件异步处理上传的图片</h2><p>需要提前配置文件路径，服务器中单独设置一个目录，最好在项目目录之外，可以使多个项目都同时能访问到，同时配置一个二级域名或端口直接指向该目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function imageUpload(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; imageUpload($request-&gt;file(&#39;wangEditorImg&#39;), &#39;posts&#39;, true);</span><br><span class=\"line\">    return response()-&gt;json($returnData)-&gt;setCallback($request-&gt;input(&#39;callback&#39;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 处理文件上传，需要返回图片路径数组</span><br><span class=\"line\">function imageUpload($file, $dirName, $isWangEditor &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; [</span><br><span class=\"line\">        &#39;errno&#39; &#x3D;&gt; -1,</span><br><span class=\"line\">        &#39;msg&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">        &#39;data&#39; &#x3D;&gt; &#39;&#39;</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    $path &#x3D; sprintf(&#39;%s&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, DATA_ROOT, $dirName, \\Carbon\\Carbon::now()-&gt;month);</span><br><span class=\"line\">    autoMakeDir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">    $error &#x3D; $file-&gt;getError();</span><br><span class=\"line\">    if ($error !&#x3D; 0) &#123;</span><br><span class=\"line\">        $returnData[&#39;msg&#39;] &#x3D; $file-&gt;getErrorMessage();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $fileExt &#x3D; $file-&gt;getClientOriginalExtension();</span><br><span class=\"line\">        &#x2F;&#x2F; 新文件名</span><br><span class=\"line\">        $newFilename &#x3D; sprintf(&#39;%s_%s.%s&#39;, time(), rand(10000, 99999), $fileExt);</span><br><span class=\"line\">        &#x2F;&#x2F; 移动文件</span><br><span class=\"line\">        $file-&gt;move($path, $newFilename);</span><br><span class=\"line\">        $returnData[&#39;errno&#39;] &#x3D; 0;</span><br><span class=\"line\">        $fileUrl &#x3D; sprintf(&#39;%s&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, DATA_URL, $dirName, \\Carbon\\Carbon::now()-&gt;month) . $newFilename;</span><br><span class=\"line\">        if ($isWangEditor) &#123;</span><br><span class=\"line\">            $returnData[&#39;data&#39;] &#x3D; [$fileUrl];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $returnData[&#39;data&#39;] &#x3D; $newFilename;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p><a href=\"https://www.kancloud.cn/wangfupeng/wangeditor3/332599\">wangEditor</a> 是基于javascript和css开发的 Web富文本编辑器， 轻量、简洁、易用、开源免费</p>\n<h2 id=\"1-下载所需的-css-和-js-文件，放到-public-目录下\"><a href=\"#1-下载所需的-css-和-js-文件，放到-public-目录下\" class=\"headerlink\" title=\"1. 下载所需的 css 和 js 文件，放到 public 目录下\"></a>1. 下载所需的 css 和 js 文件，放到 public 目录下</h2><h2 id=\"2-模板文件中引入-css-和-js\"><a href=\"#2-模板文件中引入-css-和-js\" class=\"headerlink\" title=\"2. 模板文件中引入 css 和 js\"></a>2. 模板文件中引入 css 和 js</h2><p>其中， js 文件必须放到 jquery 后</p>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;&#x2F;bower_components&#x2F;wangEditor&#x2F;release&#x2F;wangEditor.min.css&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot; src&#x3D;&quot;&#x2F;bower_components&#x2F;wangEditor&#x2F;release&#x2F;wangEditor.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-在-html-中，添加一个需要展示编辑器的-div\"><a href=\"#3-在-html-中，添加一个需要展示编辑器的-div\" class=\"headerlink\" title=\"3. 在 html 中，添加一个需要展示编辑器的 div\"></a>3. 在 html 中，添加一个需要展示编辑器的 div</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id&#x3D;&quot;editor&quot;&gt;</span><br><span class=\"line\">    &lt;p&gt;</span><br><span class=\"line\">        @if(!empty($post))&#123;!! $post-&gt;content !!&#125;@endif</span><br><span class=\"line\">    &lt;&#x2F;p&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-js-文件中\"><a href=\"#4-js-文件中\" class=\"headerlink\" title=\"4. js 文件中\"></a>4. js 文件中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;script&#39;)</span><br><span class=\"line\">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class=\"line\">        $(document).ready(function () &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            var E &#x3D; window.wangEditor;</span><br><span class=\"line\">            var editor &#x3D; new E(&#39;#editor&#39;);</span><br><span class=\"line\">            editor.customConfig.uploadImgServer &#x3D; &#39;&#x2F;admin&#x2F;posts&#x2F;image&#x2F;upload&#39;;  &#x2F;&#x2F; 上传图片到服务器</span><br><span class=\"line\">            editor.customConfig.uploadImgHeaders &#x3D; &#123;</span><br><span class=\"line\">                &#39;X-CSRF-TOKEN&#39;: $(&#39;meta[name&#x3D;&quot;csrf-token&quot;]&#39;).attr(&#39;content&#39;)</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">            editor.customConfig.uploadFileName &#x3D; &#39;wangEditorImg&#39;;</span><br><span class=\"line\">            &#x2F;&#x2F; 将图片大小限制为 1M</span><br><span class=\"line\">            editor.customConfig.uploadImgMaxSize &#x3D; 1024 * 1024;</span><br><span class=\"line\">            &#x2F;&#x2F; 限制一次最多上传 5 张图片</span><br><span class=\"line\">            editor.customConfig.uploadImgMaxLength &#x3D; 5;</span><br><span class=\"line\">            &#x2F;&#x2F; 隐藏“网络图片”tab</span><br><span class=\"line\">            editor.customConfig.showLinkImg &#x3D; false;</span><br><span class=\"line\">            editor.customConfig.zIndex &#x3D; 1;</span><br><span class=\"line\">            editor.customConfig.menus &#x3D; [</span><br><span class=\"line\">                &#39;head&#39;,  &#x2F;&#x2F; 标题</span><br><span class=\"line\">                &#39;bold&#39;,  &#x2F;&#x2F; 粗体</span><br><span class=\"line\">                &#39;italic&#39;,  &#x2F;&#x2F; 斜体</span><br><span class=\"line\">                &#39;underline&#39;,  &#x2F;&#x2F; 下划线</span><br><span class=\"line\">                &#39;strikeThrough&#39;,  &#x2F;&#x2F; 删除线</span><br><span class=\"line\">                &#39;foreColor&#39;,  &#x2F;&#x2F; 文字颜色</span><br><span class=\"line\">                &#39;backColor&#39;,  &#x2F;&#x2F; 背景颜色</span><br><span class=\"line\">                &#39;link&#39;,  &#x2F;&#x2F; 插入链接</span><br><span class=\"line\">                &#39;list&#39;,  &#x2F;&#x2F; 列表</span><br><span class=\"line\">                &#39;justify&#39;,  &#x2F;&#x2F; 对齐方式</span><br><span class=\"line\">                &#39;quote&#39;,  &#x2F;&#x2F; 引用</span><br><span class=\"line\">                &#39;emoticon&#39;,  &#x2F;&#x2F; 表情</span><br><span class=\"line\">                &#39;image&#39;,  &#x2F;&#x2F; 插入图片</span><br><span class=\"line\">                &#39;table&#39;,  &#x2F;&#x2F; 表格</span><br><span class=\"line\">&#x2F;&#x2F;                &#39;video&#39;,  &#x2F;&#x2F; 插入视频</span><br><span class=\"line\">                &#39;code&#39;,  &#x2F;&#x2F; 插入代码</span><br><span class=\"line\">                &#39;undo&#39;,  &#x2F;&#x2F; 撤销</span><br><span class=\"line\">                &#39;redo&#39;  &#x2F;&#x2F; 重复</span><br><span class=\"line\">            ];</span><br><span class=\"line\">            editor.create();</span><br><span class=\"line\">\t&lt;&#x2F;script&gt;</span><br><span class=\"line\">@endsection</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-PHP-文件异步处理上传的图片\"><a href=\"#5-PHP-文件异步处理上传的图片\" class=\"headerlink\" title=\"5. PHP 文件异步处理上传的图片\"></a>5. PHP 文件异步处理上传的图片</h2><p>需要提前配置文件路径，服务器中单独设置一个目录，最好在项目目录之外，可以使多个项目都同时能访问到，同时配置一个二级域名或端口直接指向该目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function imageUpload(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; imageUpload($request-&gt;file(&#39;wangEditorImg&#39;), &#39;posts&#39;, true);</span><br><span class=\"line\">    return response()-&gt;json($returnData)-&gt;setCallback($request-&gt;input(&#39;callback&#39;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 处理文件上传，需要返回图片路径数组</span><br><span class=\"line\">function imageUpload($file, $dirName, $isWangEditor &#x3D; false)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; [</span><br><span class=\"line\">        &#39;errno&#39; &#x3D;&gt; -1,</span><br><span class=\"line\">        &#39;msg&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">        &#39;data&#39; &#x3D;&gt; &#39;&#39;</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    $path &#x3D; sprintf(&#39;%s&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, DATA_ROOT, $dirName, \\Carbon\\Carbon::now()-&gt;month);</span><br><span class=\"line\">    autoMakeDir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">    $error &#x3D; $file-&gt;getError();</span><br><span class=\"line\">    if ($error !&#x3D; 0) &#123;</span><br><span class=\"line\">        $returnData[&#39;msg&#39;] &#x3D; $file-&gt;getErrorMessage();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $fileExt &#x3D; $file-&gt;getClientOriginalExtension();</span><br><span class=\"line\">        &#x2F;&#x2F; 新文件名</span><br><span class=\"line\">        $newFilename &#x3D; sprintf(&#39;%s_%s.%s&#39;, time(), rand(10000, 99999), $fileExt);</span><br><span class=\"line\">        &#x2F;&#x2F; 移动文件</span><br><span class=\"line\">        $file-&gt;move($path, $newFilename);</span><br><span class=\"line\">        $returnData[&#39;errno&#39;] &#x3D; 0;</span><br><span class=\"line\">        $fileUrl &#x3D; sprintf(&#39;%s&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, DATA_URL, $dirName, \\Carbon\\Carbon::now()-&gt;month) . $newFilename;</span><br><span class=\"line\">        if ($isWangEditor) &#123;</span><br><span class=\"line\">            $returnData[&#39;data&#39;] &#x3D; [$fileUrl];</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            $returnData[&#39;data&#39;] &#x3D; $newFilename;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"文件上传插件 dropzone 接入方法","date":"2017-11-18T12:52:10.000Z","_content":"\n[dropzone](http://www.dropzonejs.com/) 是一个简洁的文件上传插件，接入方便。\n\n## 1. 首先下载 dropzone 插件的 css 和 js 文件， 放到 public 目录下。\n\n## 2. 模板文件中引入 css 和 js\n\n<!-- more -->\n\n```\n@section('add_css')\n    {!! Html::style('/dropzone/dist/min/dropzone.min.css') !!}\n@endsection\n```\n\n```\n@section('add_script')\n    <script src=\"/dropzone/dist/min/dropzone.min.js\"></script>\n@endsection\n```\n\n## 3. 采用渐进式的引入方式 html 中\n\n```\n<div class=\"dropzone dz-clickable\" id=\"myDrop\">\n    <div class=\"dz-default dz-message\" data-dz-message=\"\">\n        <span style=\"font-size: large\">点击此处或拖拽文件到此处</span>\n    </div>\n</div>\n\n```\n\n## 4. js 文件中\n\n```\n@section('script')\n\n    <script type=\"text/javascript\">\n        Dropzone.autoDiscover = false; // 这一行一定要放在ready之前\n        $(document).ready(function () {\n            var fileMaxSize = 20; // MB\n\n            var myDropzone = new Dropzone(\"div#myDrop\", {\n                url: \"/admin/files/upload\",\n                paramName: \"file\", // The name that will be used to transfer the file\n                maxFilesize: fileMaxSize, // MB\n                maxFiles: 1, // 一个一个来\n\t\t// 需要在headers中添加csrf\n                headers: {\n                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n                }\n            });\n\n            myDropzone.on('addedfile', function (file) {\n                if (file.size > 1024 * 1024 * fileMaxSize) {\n                    alert('文件大小不能超过 ' + fileMaxSize + 'M');\n                    myDropzone.removeFile(file);\n                }\n                file.previewElement.addEventListener(\"click\", function () {\n//                    var filename = $(this).find('.dz-filename')[0].innerText;\n//                    console.log(file);\n                    var path = $('#path').val();\n                    var filename = $('#filename').val();\n                    if (window.confirm('你确定要删除 ' + file.name + ' 吗？')) {\n                        $.ajax({\n                            type: \"GET\",\n                            url: \"/admin/files/delete\",\n                            data: {path: path},\n                            dataType: \"JSON\",\n                            success: function (data) {\n//                                console.log(data);\n                                if (0 == data.error) {\n                                    myDropzone.removeFile(file);\n                                } else {\n                                    alert('删除失败，稍后重试');\n                                }\n                            }\n                        });\n                    } else {\n                        return false;\n                    }\n                });\n            });\n\n            myDropzone.on('success', function (file, response) {\n//                console.log(file);\n//                console.log(response);\n                if (response.errno == 0) {\n//                    alert('文件上传成功');\n                    $('#filename').attr('value', response.data['original_filename']);\n                    $('#path').attr('value', response.data['path']);\n                    $('#uri').attr('value', response.data['uri']);\n                    $('#hash').attr('value', response.data['file_hash']);\n                } else {\n                    alert(response.msg);\n                    myDropzone.removeFile(file);\n                }\n            });\n\n            myDropzone.on('error', function (file, errorMessage) {\n//                console.log(errorMessage);\n            });\n            myDropzone.on('removefile', function (file) {\n                alert('remove file');\n            });\n        });\n    </script>\n@endsection\n```\n\n## 5. layout 文件中 ，在head 标签内需加入 csrf_token\n\n\n```\n<meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">\n```\n\n\n## 6. php 文件，异步处理上传的文件\n\n```\npublic function upload(Request $request)\n{\n    $returnData = fileUpload($request->file('file'), 'file');\n    return response()->json($returnData)->setCallback($request->input('callback'));\n}\n```\n\n```\n// 文件上传方法\nfunction fileUpload($file, $dirName)\n{\n    $returnData = [\n        'errno' => -1,\n        'msg' => '',\n        'data' => ''\n    ];\n\n    $path = sprintf('%s/uploads/%s/%s/', DATA_ROOT, $dirName, \\Carbon\\Carbon::now()->month);\n    autoMakeDir($path);\n\n//        var_dump($file->getError()); // 0\n//        var_dump($file->getFilename()); // php3R7aUM\n//        var_dump($file->getExtension());\n//        var_dump($file->getClientMimeType()); // image/png\n//        var_dump($file->getClientOriginalExtension()); // png\n//        var_dump($file->getClientOriginalName()); // bef3df8aly1fbx05q2ra1j20b40b4mxi.png\n//        var_dump($file->getErrorMessage()); // The file \"bef3df8aly1fbx05q2ra1j20b40b4mxi.png\" was not uploaded due to an unknown error.\n//        var_dump($file->getBasename()); // php3R7aUM\n//        var_dump($file->getPath()); // /tmp\n//        var_dump($file->getPathname()); // /tmp/php3R7aUM\n//        var_dump($file->getType()); // file\n//        var_dump($file->getRealPath()); // /tmp/php3R7aUM\n\n    $error = $file->getError();\n    if ($error != 0) {\n        $returnData['msg'] = $file->getErrorMessage();\n    } else {\n        $fileExt = $file->getClientOriginalExtension();\n        // 新文件名\n        $originalFilename = $file->getClientOriginalName();\n        $realFilename = rtrim($originalFilename, '.' . $fileExt);\n        $newFilename = sprintf('%s_%s_%s.%s', $realFilename, time(), rand(10000, 99999), $fileExt);\n        $fileHash = hash_file('md5', $file->getPathname());\n        // 不允许重复上传相同的文件\n        $fileExist = \\App\\File::where('hash', $fileHash)->count();\n        if ($fileExist) {\n            $returnData['msg'] = '该文件已存在 请选择其他文件上传';\n            $returnData['errno'] = 123;\n        } else {\n            // 移动文件\n            $file->move($path, $newFilename);\n            $returnData['errno'] = 0;\n            $fileUri = sprintf('/uploads/%s/%s/', $dirName, \\Carbon\\Carbon::now()->month) . $newFilename;\n            $returnData['data'] = [\n                'path' => $path . $newFilename,\n                'uri' => $fileUri,\n                'filename' => $newFilename,\n                'original_filename' => $originalFilename,\n                'file_hash' => $fileHash,\n            ];\n        }\n    }\n\n    return $returnData;\n}\n\n```\n\n```\n// 自动创建目录方法\nfunction autoMakeDir($filePath)\n{\n    if (!file_exists($filePath)) {\n        mkdir($filePath, 0777, true);\n    }\n}\n```","source":"_posts/文件上传插件-dropzone-接入方法.md","raw":"---\ntitle: 文件上传插件 dropzone 接入方法\ndate: 2017-11-18 20:52:10\ntags: dropzone\ncategories: html\n---\n\n[dropzone](http://www.dropzonejs.com/) 是一个简洁的文件上传插件，接入方便。\n\n## 1. 首先下载 dropzone 插件的 css 和 js 文件， 放到 public 目录下。\n\n## 2. 模板文件中引入 css 和 js\n\n<!-- more -->\n\n```\n@section('add_css')\n    {!! Html::style('/dropzone/dist/min/dropzone.min.css') !!}\n@endsection\n```\n\n```\n@section('add_script')\n    <script src=\"/dropzone/dist/min/dropzone.min.js\"></script>\n@endsection\n```\n\n## 3. 采用渐进式的引入方式 html 中\n\n```\n<div class=\"dropzone dz-clickable\" id=\"myDrop\">\n    <div class=\"dz-default dz-message\" data-dz-message=\"\">\n        <span style=\"font-size: large\">点击此处或拖拽文件到此处</span>\n    </div>\n</div>\n\n```\n\n## 4. js 文件中\n\n```\n@section('script')\n\n    <script type=\"text/javascript\">\n        Dropzone.autoDiscover = false; // 这一行一定要放在ready之前\n        $(document).ready(function () {\n            var fileMaxSize = 20; // MB\n\n            var myDropzone = new Dropzone(\"div#myDrop\", {\n                url: \"/admin/files/upload\",\n                paramName: \"file\", // The name that will be used to transfer the file\n                maxFilesize: fileMaxSize, // MB\n                maxFiles: 1, // 一个一个来\n\t\t// 需要在headers中添加csrf\n                headers: {\n                    'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n                }\n            });\n\n            myDropzone.on('addedfile', function (file) {\n                if (file.size > 1024 * 1024 * fileMaxSize) {\n                    alert('文件大小不能超过 ' + fileMaxSize + 'M');\n                    myDropzone.removeFile(file);\n                }\n                file.previewElement.addEventListener(\"click\", function () {\n//                    var filename = $(this).find('.dz-filename')[0].innerText;\n//                    console.log(file);\n                    var path = $('#path').val();\n                    var filename = $('#filename').val();\n                    if (window.confirm('你确定要删除 ' + file.name + ' 吗？')) {\n                        $.ajax({\n                            type: \"GET\",\n                            url: \"/admin/files/delete\",\n                            data: {path: path},\n                            dataType: \"JSON\",\n                            success: function (data) {\n//                                console.log(data);\n                                if (0 == data.error) {\n                                    myDropzone.removeFile(file);\n                                } else {\n                                    alert('删除失败，稍后重试');\n                                }\n                            }\n                        });\n                    } else {\n                        return false;\n                    }\n                });\n            });\n\n            myDropzone.on('success', function (file, response) {\n//                console.log(file);\n//                console.log(response);\n                if (response.errno == 0) {\n//                    alert('文件上传成功');\n                    $('#filename').attr('value', response.data['original_filename']);\n                    $('#path').attr('value', response.data['path']);\n                    $('#uri').attr('value', response.data['uri']);\n                    $('#hash').attr('value', response.data['file_hash']);\n                } else {\n                    alert(response.msg);\n                    myDropzone.removeFile(file);\n                }\n            });\n\n            myDropzone.on('error', function (file, errorMessage) {\n//                console.log(errorMessage);\n            });\n            myDropzone.on('removefile', function (file) {\n                alert('remove file');\n            });\n        });\n    </script>\n@endsection\n```\n\n## 5. layout 文件中 ，在head 标签内需加入 csrf_token\n\n\n```\n<meta name=\"csrf-token\" content=\"{{ csrf_token() }}\">\n```\n\n\n## 6. php 文件，异步处理上传的文件\n\n```\npublic function upload(Request $request)\n{\n    $returnData = fileUpload($request->file('file'), 'file');\n    return response()->json($returnData)->setCallback($request->input('callback'));\n}\n```\n\n```\n// 文件上传方法\nfunction fileUpload($file, $dirName)\n{\n    $returnData = [\n        'errno' => -1,\n        'msg' => '',\n        'data' => ''\n    ];\n\n    $path = sprintf('%s/uploads/%s/%s/', DATA_ROOT, $dirName, \\Carbon\\Carbon::now()->month);\n    autoMakeDir($path);\n\n//        var_dump($file->getError()); // 0\n//        var_dump($file->getFilename()); // php3R7aUM\n//        var_dump($file->getExtension());\n//        var_dump($file->getClientMimeType()); // image/png\n//        var_dump($file->getClientOriginalExtension()); // png\n//        var_dump($file->getClientOriginalName()); // bef3df8aly1fbx05q2ra1j20b40b4mxi.png\n//        var_dump($file->getErrorMessage()); // The file \"bef3df8aly1fbx05q2ra1j20b40b4mxi.png\" was not uploaded due to an unknown error.\n//        var_dump($file->getBasename()); // php3R7aUM\n//        var_dump($file->getPath()); // /tmp\n//        var_dump($file->getPathname()); // /tmp/php3R7aUM\n//        var_dump($file->getType()); // file\n//        var_dump($file->getRealPath()); // /tmp/php3R7aUM\n\n    $error = $file->getError();\n    if ($error != 0) {\n        $returnData['msg'] = $file->getErrorMessage();\n    } else {\n        $fileExt = $file->getClientOriginalExtension();\n        // 新文件名\n        $originalFilename = $file->getClientOriginalName();\n        $realFilename = rtrim($originalFilename, '.' . $fileExt);\n        $newFilename = sprintf('%s_%s_%s.%s', $realFilename, time(), rand(10000, 99999), $fileExt);\n        $fileHash = hash_file('md5', $file->getPathname());\n        // 不允许重复上传相同的文件\n        $fileExist = \\App\\File::where('hash', $fileHash)->count();\n        if ($fileExist) {\n            $returnData['msg'] = '该文件已存在 请选择其他文件上传';\n            $returnData['errno'] = 123;\n        } else {\n            // 移动文件\n            $file->move($path, $newFilename);\n            $returnData['errno'] = 0;\n            $fileUri = sprintf('/uploads/%s/%s/', $dirName, \\Carbon\\Carbon::now()->month) . $newFilename;\n            $returnData['data'] = [\n                'path' => $path . $newFilename,\n                'uri' => $fileUri,\n                'filename' => $newFilename,\n                'original_filename' => $originalFilename,\n                'file_hash' => $fileHash,\n            ];\n        }\n    }\n\n    return $returnData;\n}\n\n```\n\n```\n// 自动创建目录方法\nfunction autoMakeDir($filePath)\n{\n    if (!file_exists($filePath)) {\n        mkdir($filePath, 0777, true);\n    }\n}\n```","slug":"文件上传插件-dropzone-接入方法","published":1,"updated":"2020-09-11T01:04:35.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza1003z6wo15bgm4yx0","content":"<p><a href=\"http://www.dropzonejs.com/\">dropzone</a> 是一个简洁的文件上传插件，接入方便。</p>\n<h2 id=\"1-首先下载-dropzone-插件的-css-和-js-文件，-放到-public-目录下。\"><a href=\"#1-首先下载-dropzone-插件的-css-和-js-文件，-放到-public-目录下。\" class=\"headerlink\" title=\"1. 首先下载 dropzone 插件的 css 和 js 文件， 放到 public 目录下。\"></a>1. 首先下载 dropzone 插件的 css 和 js 文件， 放到 public 目录下。</h2><h2 id=\"2-模板文件中引入-css-和-js\"><a href=\"#2-模板文件中引入-css-和-js\" class=\"headerlink\" title=\"2. 模板文件中引入 css 和 js\"></a>2. 模板文件中引入 css 和 js</h2><a id=\"more\"></a>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;add_css&#39;)</span><br><span class=\"line\">    &#123;!! Html::style(&#39;&#x2F;dropzone&#x2F;dist&#x2F;min&#x2F;dropzone.min.css&#39;) !!&#125;</span><br><span class=\"line\">@endsection</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;add_script&#39;)</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;&#x2F;dropzone&#x2F;dist&#x2F;min&#x2F;dropzone.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">@endsection</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-采用渐进式的引入方式-html-中\"><a href=\"#3-采用渐进式的引入方式-html-中\" class=\"headerlink\" title=\"3. 采用渐进式的引入方式 html 中\"></a>3. 采用渐进式的引入方式 html 中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;dropzone dz-clickable&quot; id&#x3D;&quot;myDrop&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;dz-default dz-message&quot; data-dz-message&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;span style&#x3D;&quot;font-size: large&quot;&gt;点击此处或拖拽文件到此处&lt;&#x2F;span&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-js-文件中\"><a href=\"#4-js-文件中\" class=\"headerlink\" title=\"4. js 文件中\"></a>4. js 文件中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;script&#39;)</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class=\"line\">        Dropzone.autoDiscover &#x3D; false; &#x2F;&#x2F; 这一行一定要放在ready之前</span><br><span class=\"line\">        $(document).ready(function () &#123;</span><br><span class=\"line\">            var fileMaxSize &#x3D; 20; &#x2F;&#x2F; MB</span><br><span class=\"line\"></span><br><span class=\"line\">            var myDropzone &#x3D; new Dropzone(&quot;div#myDrop&quot;, &#123;</span><br><span class=\"line\">                url: &quot;&#x2F;admin&#x2F;files&#x2F;upload&quot;,</span><br><span class=\"line\">                paramName: &quot;file&quot;, &#x2F;&#x2F; The name that will be used to transfer the file</span><br><span class=\"line\">                maxFilesize: fileMaxSize, &#x2F;&#x2F; MB</span><br><span class=\"line\">                maxFiles: 1, &#x2F;&#x2F; 一个一个来</span><br><span class=\"line\">\t\t&#x2F;&#x2F; 需要在headers中添加csrf</span><br><span class=\"line\">                headers: &#123;</span><br><span class=\"line\">                    &#39;X-CSRF-TOKEN&#39;: $(&#39;meta[name&#x3D;&quot;csrf-token&quot;]&#39;).attr(&#39;content&#39;)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            myDropzone.on(&#39;addedfile&#39;, function (file) &#123;</span><br><span class=\"line\">                if (file.size &gt; 1024 * 1024 * fileMaxSize) &#123;</span><br><span class=\"line\">                    alert(&#39;文件大小不能超过 &#39; + fileMaxSize + &#39;M&#39;);</span><br><span class=\"line\">                    myDropzone.removeFile(file);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                file.previewElement.addEventListener(&quot;click&quot;, function () &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                    var filename &#x3D; $(this).find(&#39;.dz-filename&#39;)[0].innerText;</span><br><span class=\"line\">&#x2F;&#x2F;                    console.log(file);</span><br><span class=\"line\">                    var path &#x3D; $(&#39;#path&#39;).val();</span><br><span class=\"line\">                    var filename &#x3D; $(&#39;#filename&#39;).val();</span><br><span class=\"line\">                    if (window.confirm(&#39;你确定要删除 &#39; + file.name + &#39; 吗？&#39;)) &#123;</span><br><span class=\"line\">                        $.ajax(&#123;</span><br><span class=\"line\">                            type: &quot;GET&quot;,</span><br><span class=\"line\">                            url: &quot;&#x2F;admin&#x2F;files&#x2F;delete&quot;,</span><br><span class=\"line\">                            data: &#123;path: path&#125;,</span><br><span class=\"line\">                            dataType: &quot;JSON&quot;,</span><br><span class=\"line\">                            success: function (data) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                                console.log(data);</span><br><span class=\"line\">                                if (0 &#x3D;&#x3D; data.error) &#123;</span><br><span class=\"line\">                                    myDropzone.removeFile(file);</span><br><span class=\"line\">                                &#125; else &#123;</span><br><span class=\"line\">                                    alert(&#39;删除失败，稍后重试&#39;);</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125; else &#123;</span><br><span class=\"line\">                        return false;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            myDropzone.on(&#39;success&#39;, function (file, response) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                console.log(file);</span><br><span class=\"line\">&#x2F;&#x2F;                console.log(response);</span><br><span class=\"line\">                if (response.errno &#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                    alert(&#39;文件上传成功&#39;);</span><br><span class=\"line\">                    $(&#39;#filename&#39;).attr(&#39;value&#39;, response.data[&#39;original_filename&#39;]);</span><br><span class=\"line\">                    $(&#39;#path&#39;).attr(&#39;value&#39;, response.data[&#39;path&#39;]);</span><br><span class=\"line\">                    $(&#39;#uri&#39;).attr(&#39;value&#39;, response.data[&#39;uri&#39;]);</span><br><span class=\"line\">                    $(&#39;#hash&#39;).attr(&#39;value&#39;, response.data[&#39;file_hash&#39;]);</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    alert(response.msg);</span><br><span class=\"line\">                    myDropzone.removeFile(file);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            myDropzone.on(&#39;error&#39;, function (file, errorMessage) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                console.log(errorMessage);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            myDropzone.on(&#39;removefile&#39;, function (file) &#123;</span><br><span class=\"line\">                alert(&#39;remove file&#39;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &lt;&#x2F;script&gt;</span><br><span class=\"line\">@endsection</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-layout-文件中-，在head-标签内需加入-csrf-token\"><a href=\"#5-layout-文件中-，在head-标签内需加入-csrf-token\" class=\"headerlink\" title=\"5. layout 文件中 ，在head 标签内需加入 csrf_token\"></a>5. layout 文件中 ，在head 标签内需加入 csrf_token</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta name&#x3D;&quot;csrf-token&quot; content&#x3D;&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-php-文件，异步处理上传的文件\"><a href=\"#6-php-文件，异步处理上传的文件\" class=\"headerlink\" title=\"6. php 文件，异步处理上传的文件\"></a>6. php 文件，异步处理上传的文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function upload(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; fileUpload($request-&gt;file(&#39;file&#39;), &#39;file&#39;);</span><br><span class=\"line\">    return response()-&gt;json($returnData)-&gt;setCallback($request-&gt;input(&#39;callback&#39;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 文件上传方法</span><br><span class=\"line\">function fileUpload($file, $dirName)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; [</span><br><span class=\"line\">        &#39;errno&#39; &#x3D;&gt; -1,</span><br><span class=\"line\">        &#39;msg&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">        &#39;data&#39; &#x3D;&gt; &#39;&#39;</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    $path &#x3D; sprintf(&#39;%s&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, DATA_ROOT, $dirName, \\Carbon\\Carbon::now()-&gt;month);</span><br><span class=\"line\">    autoMakeDir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getError()); &#x2F;&#x2F; 0</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getFilename()); &#x2F;&#x2F; php3R7aUM</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getExtension());</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getClientMimeType()); &#x2F;&#x2F; image&#x2F;png</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getClientOriginalExtension()); &#x2F;&#x2F; png</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getClientOriginalName()); &#x2F;&#x2F; bef3df8aly1fbx05q2ra1j20b40b4mxi.png</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getErrorMessage()); &#x2F;&#x2F; The file &quot;bef3df8aly1fbx05q2ra1j20b40b4mxi.png&quot; was not uploaded due to an unknown error.</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getBasename()); &#x2F;&#x2F; php3R7aUM</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getPath()); &#x2F;&#x2F; &#x2F;tmp</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getPathname()); &#x2F;&#x2F; &#x2F;tmp&#x2F;php3R7aUM</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getType()); &#x2F;&#x2F; file</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getRealPath()); &#x2F;&#x2F; &#x2F;tmp&#x2F;php3R7aUM</span><br><span class=\"line\"></span><br><span class=\"line\">    $error &#x3D; $file-&gt;getError();</span><br><span class=\"line\">    if ($error !&#x3D; 0) &#123;</span><br><span class=\"line\">        $returnData[&#39;msg&#39;] &#x3D; $file-&gt;getErrorMessage();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $fileExt &#x3D; $file-&gt;getClientOriginalExtension();</span><br><span class=\"line\">        &#x2F;&#x2F; 新文件名</span><br><span class=\"line\">        $originalFilename &#x3D; $file-&gt;getClientOriginalName();</span><br><span class=\"line\">        $realFilename &#x3D; rtrim($originalFilename, &#39;.&#39; . $fileExt);</span><br><span class=\"line\">        $newFilename &#x3D; sprintf(&#39;%s_%s_%s.%s&#39;, $realFilename, time(), rand(10000, 99999), $fileExt);</span><br><span class=\"line\">        $fileHash &#x3D; hash_file(&#39;md5&#39;, $file-&gt;getPathname());</span><br><span class=\"line\">        &#x2F;&#x2F; 不允许重复上传相同的文件</span><br><span class=\"line\">        $fileExist &#x3D; \\App\\File::where(&#39;hash&#39;, $fileHash)-&gt;count();</span><br><span class=\"line\">        if ($fileExist) &#123;</span><br><span class=\"line\">            $returnData[&#39;msg&#39;] &#x3D; &#39;该文件已存在 请选择其他文件上传&#39;;</span><br><span class=\"line\">            $returnData[&#39;errno&#39;] &#x3D; 123;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; 移动文件</span><br><span class=\"line\">            $file-&gt;move($path, $newFilename);</span><br><span class=\"line\">            $returnData[&#39;errno&#39;] &#x3D; 0;</span><br><span class=\"line\">            $fileUri &#x3D; sprintf(&#39;&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, $dirName, \\Carbon\\Carbon::now()-&gt;month) . $newFilename;</span><br><span class=\"line\">            $returnData[&#39;data&#39;] &#x3D; [</span><br><span class=\"line\">                &#39;path&#39; &#x3D;&gt; $path . $newFilename,</span><br><span class=\"line\">                &#39;uri&#39; &#x3D;&gt; $fileUri,</span><br><span class=\"line\">                &#39;filename&#39; &#x3D;&gt; $newFilename,</span><br><span class=\"line\">                &#39;original_filename&#39; &#x3D;&gt; $originalFilename,</span><br><span class=\"line\">                &#39;file_hash&#39; &#x3D;&gt; $fileHash,</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $returnData;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 自动创建目录方法</span><br><span class=\"line\">function autoMakeDir($filePath)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (!file_exists($filePath)) &#123;</span><br><span class=\"line\">        mkdir($filePath, 0777, true);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p><a href=\"http://www.dropzonejs.com/\">dropzone</a> 是一个简洁的文件上传插件，接入方便。</p>\n<h2 id=\"1-首先下载-dropzone-插件的-css-和-js-文件，-放到-public-目录下。\"><a href=\"#1-首先下载-dropzone-插件的-css-和-js-文件，-放到-public-目录下。\" class=\"headerlink\" title=\"1. 首先下载 dropzone 插件的 css 和 js 文件， 放到 public 目录下。\"></a>1. 首先下载 dropzone 插件的 css 和 js 文件， 放到 public 目录下。</h2><h2 id=\"2-模板文件中引入-css-和-js\"><a href=\"#2-模板文件中引入-css-和-js\" class=\"headerlink\" title=\"2. 模板文件中引入 css 和 js\"></a>2. 模板文件中引入 css 和 js</h2>","more":"<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;add_css&#39;)</span><br><span class=\"line\">    &#123;!! Html::style(&#39;&#x2F;dropzone&#x2F;dist&#x2F;min&#x2F;dropzone.min.css&#39;) !!&#125;</span><br><span class=\"line\">@endsection</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;add_script&#39;)</span><br><span class=\"line\">    &lt;script src&#x3D;&quot;&#x2F;dropzone&#x2F;dist&#x2F;min&#x2F;dropzone.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class=\"line\">@endsection</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-采用渐进式的引入方式-html-中\"><a href=\"#3-采用渐进式的引入方式-html-中\" class=\"headerlink\" title=\"3. 采用渐进式的引入方式 html 中\"></a>3. 采用渐进式的引入方式 html 中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div class&#x3D;&quot;dropzone dz-clickable&quot; id&#x3D;&quot;myDrop&quot;&gt;</span><br><span class=\"line\">    &lt;div class&#x3D;&quot;dz-default dz-message&quot; data-dz-message&#x3D;&quot;&quot;&gt;</span><br><span class=\"line\">        &lt;span style&#x3D;&quot;font-size: large&quot;&gt;点击此处或拖拽文件到此处&lt;&#x2F;span&gt;</span><br><span class=\"line\">    &lt;&#x2F;div&gt;</span><br><span class=\"line\">&lt;&#x2F;div&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-js-文件中\"><a href=\"#4-js-文件中\" class=\"headerlink\" title=\"4. js 文件中\"></a>4. js 文件中</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@section(&#39;script&#39;)</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class=\"line\">        Dropzone.autoDiscover &#x3D; false; &#x2F;&#x2F; 这一行一定要放在ready之前</span><br><span class=\"line\">        $(document).ready(function () &#123;</span><br><span class=\"line\">            var fileMaxSize &#x3D; 20; &#x2F;&#x2F; MB</span><br><span class=\"line\"></span><br><span class=\"line\">            var myDropzone &#x3D; new Dropzone(&quot;div#myDrop&quot;, &#123;</span><br><span class=\"line\">                url: &quot;&#x2F;admin&#x2F;files&#x2F;upload&quot;,</span><br><span class=\"line\">                paramName: &quot;file&quot;, &#x2F;&#x2F; The name that will be used to transfer the file</span><br><span class=\"line\">                maxFilesize: fileMaxSize, &#x2F;&#x2F; MB</span><br><span class=\"line\">                maxFiles: 1, &#x2F;&#x2F; 一个一个来</span><br><span class=\"line\">\t\t&#x2F;&#x2F; 需要在headers中添加csrf</span><br><span class=\"line\">                headers: &#123;</span><br><span class=\"line\">                    &#39;X-CSRF-TOKEN&#39;: $(&#39;meta[name&#x3D;&quot;csrf-token&quot;]&#39;).attr(&#39;content&#39;)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            myDropzone.on(&#39;addedfile&#39;, function (file) &#123;</span><br><span class=\"line\">                if (file.size &gt; 1024 * 1024 * fileMaxSize) &#123;</span><br><span class=\"line\">                    alert(&#39;文件大小不能超过 &#39; + fileMaxSize + &#39;M&#39;);</span><br><span class=\"line\">                    myDropzone.removeFile(file);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                file.previewElement.addEventListener(&quot;click&quot;, function () &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                    var filename &#x3D; $(this).find(&#39;.dz-filename&#39;)[0].innerText;</span><br><span class=\"line\">&#x2F;&#x2F;                    console.log(file);</span><br><span class=\"line\">                    var path &#x3D; $(&#39;#path&#39;).val();</span><br><span class=\"line\">                    var filename &#x3D; $(&#39;#filename&#39;).val();</span><br><span class=\"line\">                    if (window.confirm(&#39;你确定要删除 &#39; + file.name + &#39; 吗？&#39;)) &#123;</span><br><span class=\"line\">                        $.ajax(&#123;</span><br><span class=\"line\">                            type: &quot;GET&quot;,</span><br><span class=\"line\">                            url: &quot;&#x2F;admin&#x2F;files&#x2F;delete&quot;,</span><br><span class=\"line\">                            data: &#123;path: path&#125;,</span><br><span class=\"line\">                            dataType: &quot;JSON&quot;,</span><br><span class=\"line\">                            success: function (data) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                                console.log(data);</span><br><span class=\"line\">                                if (0 &#x3D;&#x3D; data.error) &#123;</span><br><span class=\"line\">                                    myDropzone.removeFile(file);</span><br><span class=\"line\">                                &#125; else &#123;</span><br><span class=\"line\">                                    alert(&#39;删除失败，稍后重试&#39;);</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;);</span><br><span class=\"line\">                    &#125; else &#123;</span><br><span class=\"line\">                        return false;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            myDropzone.on(&#39;success&#39;, function (file, response) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                console.log(file);</span><br><span class=\"line\">&#x2F;&#x2F;                console.log(response);</span><br><span class=\"line\">                if (response.errno &#x3D;&#x3D; 0) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                    alert(&#39;文件上传成功&#39;);</span><br><span class=\"line\">                    $(&#39;#filename&#39;).attr(&#39;value&#39;, response.data[&#39;original_filename&#39;]);</span><br><span class=\"line\">                    $(&#39;#path&#39;).attr(&#39;value&#39;, response.data[&#39;path&#39;]);</span><br><span class=\"line\">                    $(&#39;#uri&#39;).attr(&#39;value&#39;, response.data[&#39;uri&#39;]);</span><br><span class=\"line\">                    $(&#39;#hash&#39;).attr(&#39;value&#39;, response.data[&#39;file_hash&#39;]);</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    alert(response.msg);</span><br><span class=\"line\">                    myDropzone.removeFile(file);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">            myDropzone.on(&#39;error&#39;, function (file, errorMessage) &#123;</span><br><span class=\"line\">&#x2F;&#x2F;                console.log(errorMessage);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            myDropzone.on(&#39;removefile&#39;, function (file) &#123;</span><br><span class=\"line\">                alert(&#39;remove file&#39;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &lt;&#x2F;script&gt;</span><br><span class=\"line\">@endsection</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-layout-文件中-，在head-标签内需加入-csrf-token\"><a href=\"#5-layout-文件中-，在head-标签内需加入-csrf-token\" class=\"headerlink\" title=\"5. layout 文件中 ，在head 标签内需加入 csrf_token\"></a>5. layout 文件中 ，在head 标签内需加入 csrf_token</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;meta name&#x3D;&quot;csrf-token&quot; content&#x3D;&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-php-文件，异步处理上传的文件\"><a href=\"#6-php-文件，异步处理上传的文件\" class=\"headerlink\" title=\"6. php 文件，异步处理上传的文件\"></a>6. php 文件，异步处理上传的文件</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public function upload(Request $request)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; fileUpload($request-&gt;file(&#39;file&#39;), &#39;file&#39;);</span><br><span class=\"line\">    return response()-&gt;json($returnData)-&gt;setCallback($request-&gt;input(&#39;callback&#39;));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 文件上传方法</span><br><span class=\"line\">function fileUpload($file, $dirName)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    $returnData &#x3D; [</span><br><span class=\"line\">        &#39;errno&#39; &#x3D;&gt; -1,</span><br><span class=\"line\">        &#39;msg&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class=\"line\">        &#39;data&#39; &#x3D;&gt; &#39;&#39;</span><br><span class=\"line\">    ];</span><br><span class=\"line\"></span><br><span class=\"line\">    $path &#x3D; sprintf(&#39;%s&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, DATA_ROOT, $dirName, \\Carbon\\Carbon::now()-&gt;month);</span><br><span class=\"line\">    autoMakeDir($path);</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getError()); &#x2F;&#x2F; 0</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getFilename()); &#x2F;&#x2F; php3R7aUM</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getExtension());</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getClientMimeType()); &#x2F;&#x2F; image&#x2F;png</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getClientOriginalExtension()); &#x2F;&#x2F; png</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getClientOriginalName()); &#x2F;&#x2F; bef3df8aly1fbx05q2ra1j20b40b4mxi.png</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getErrorMessage()); &#x2F;&#x2F; The file &quot;bef3df8aly1fbx05q2ra1j20b40b4mxi.png&quot; was not uploaded due to an unknown error.</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getBasename()); &#x2F;&#x2F; php3R7aUM</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getPath()); &#x2F;&#x2F; &#x2F;tmp</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getPathname()); &#x2F;&#x2F; &#x2F;tmp&#x2F;php3R7aUM</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getType()); &#x2F;&#x2F; file</span><br><span class=\"line\">&#x2F;&#x2F;        var_dump($file-&gt;getRealPath()); &#x2F;&#x2F; &#x2F;tmp&#x2F;php3R7aUM</span><br><span class=\"line\"></span><br><span class=\"line\">    $error &#x3D; $file-&gt;getError();</span><br><span class=\"line\">    if ($error !&#x3D; 0) &#123;</span><br><span class=\"line\">        $returnData[&#39;msg&#39;] &#x3D; $file-&gt;getErrorMessage();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        $fileExt &#x3D; $file-&gt;getClientOriginalExtension();</span><br><span class=\"line\">        &#x2F;&#x2F; 新文件名</span><br><span class=\"line\">        $originalFilename &#x3D; $file-&gt;getClientOriginalName();</span><br><span class=\"line\">        $realFilename &#x3D; rtrim($originalFilename, &#39;.&#39; . $fileExt);</span><br><span class=\"line\">        $newFilename &#x3D; sprintf(&#39;%s_%s_%s.%s&#39;, $realFilename, time(), rand(10000, 99999), $fileExt);</span><br><span class=\"line\">        $fileHash &#x3D; hash_file(&#39;md5&#39;, $file-&gt;getPathname());</span><br><span class=\"line\">        &#x2F;&#x2F; 不允许重复上传相同的文件</span><br><span class=\"line\">        $fileExist &#x3D; \\App\\File::where(&#39;hash&#39;, $fileHash)-&gt;count();</span><br><span class=\"line\">        if ($fileExist) &#123;</span><br><span class=\"line\">            $returnData[&#39;msg&#39;] &#x3D; &#39;该文件已存在 请选择其他文件上传&#39;;</span><br><span class=\"line\">            $returnData[&#39;errno&#39;] &#x3D; 123;</span><br><span class=\"line\">        &#125; else &#123;</span><br><span class=\"line\">            &#x2F;&#x2F; 移动文件</span><br><span class=\"line\">            $file-&gt;move($path, $newFilename);</span><br><span class=\"line\">            $returnData[&#39;errno&#39;] &#x3D; 0;</span><br><span class=\"line\">            $fileUri &#x3D; sprintf(&#39;&#x2F;uploads&#x2F;%s&#x2F;%s&#x2F;&#39;, $dirName, \\Carbon\\Carbon::now()-&gt;month) . $newFilename;</span><br><span class=\"line\">            $returnData[&#39;data&#39;] &#x3D; [</span><br><span class=\"line\">                &#39;path&#39; &#x3D;&gt; $path . $newFilename,</span><br><span class=\"line\">                &#39;uri&#39; &#x3D;&gt; $fileUri,</span><br><span class=\"line\">                &#39;filename&#39; &#x3D;&gt; $newFilename,</span><br><span class=\"line\">                &#39;original_filename&#39; &#x3D;&gt; $originalFilename,</span><br><span class=\"line\">                &#39;file_hash&#39; &#x3D;&gt; $fileHash,</span><br><span class=\"line\">            ];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    return $returnData;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 自动创建目录方法</span><br><span class=\"line\">function autoMakeDir($filePath)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (!file_exists($filePath)) &#123;</span><br><span class=\"line\">        mkdir($filePath, 0777, true);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"晚霞无限好，只是下班晚","date":"2017-05-23T02:42:46.000Z","_content":"> 天地有大美而不言。一直以来，我都是喜欢自然的美景，人工的建筑再怎么精致宏伟也不感冒。在大自然的波诡云谲面前，人类的巧夺天工也不值一提。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/95812189-file_1495509134387_3a99.jpg)\n\n<!--more-->\n\n昨天下了小半天的雨。由于雨伞一直落在单位，导致早晨上班的时候出门困难，折返两次回屋去找雨伞，无果。最终冒雨前行，基本湿透。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/78653587-file_1495508664383_490e.jpg)\n\n忙碌的一天很快就过去了，下班时太阳已下山。打开朋友圈，发现已经被晚霞刷屏。\n\n错过此等美景实属遗憾，遂盗图数张，贴于此。侵删。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/78018613-file_1495509134710_17b32.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/41585586-file_1495509134561_f0d0.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/14621647-file_1495509134265_f79.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/60977595-file_1495509134110_11497.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/57319255-file_1495509133942_a29e.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/5676366-file_1495509133767_77d1.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/3171034-file_1495509133623_65d6.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/90260416-file_1495509510830_769.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/90429892-file_1495509510989_926c.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/98195669-file_1495509511284_dabb.jpg)\n\n","source":"_posts/晚霞无限好，只是下班晚.md","raw":"---\ntitle: 晚霞无限好，只是下班晚\ndate: 2017-05-23 10:42:46\ntags: 晚霞\ncategories: 图集\n---\n> 天地有大美而不言。一直以来，我都是喜欢自然的美景，人工的建筑再怎么精致宏伟也不感冒。在大自然的波诡云谲面前，人类的巧夺天工也不值一提。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/95812189-file_1495509134387_3a99.jpg)\n\n<!--more-->\n\n昨天下了小半天的雨。由于雨伞一直落在单位，导致早晨上班的时候出门困难，折返两次回屋去找雨伞，无果。最终冒雨前行，基本湿透。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/78653587-file_1495508664383_490e.jpg)\n\n忙碌的一天很快就过去了，下班时太阳已下山。打开朋友圈，发现已经被晚霞刷屏。\n\n错过此等美景实属遗憾，遂盗图数张，贴于此。侵删。\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/78018613-file_1495509134710_17b32.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/41585586-file_1495509134561_f0d0.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/14621647-file_1495509134265_f79.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/60977595-file_1495509134110_11497.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/57319255-file_1495509133942_a29e.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/5676366-file_1495509133767_77d1.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/3171034-file_1495509133623_65d6.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/90260416-file_1495509510830_769.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/90429892-file_1495509510989_926c.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-5-23/98195669-file_1495509511284_dabb.jpg)\n\n","slug":"晚霞无限好，只是下班晚","published":1,"updated":"2020-09-11T01:04:35.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza200416wo14gzf7kpu","content":"<blockquote>\n<p>天地有大美而不言。一直以来，我都是喜欢自然的美景，人工的建筑再怎么精致宏伟也不感冒。在大自然的波诡云谲面前，人类的巧夺天工也不值一提。</p>\n</blockquote>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/95812189-file_1495509134387_3a99.jpg\"></p>\n<a id=\"more\"></a>\n\n<p>昨天下了小半天的雨。由于雨伞一直落在单位，导致早晨上班的时候出门困难，折返两次回屋去找雨伞，无果。最终冒雨前行，基本湿透。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/78653587-file_1495508664383_490e.jpg\"></p>\n<p>忙碌的一天很快就过去了，下班时太阳已下山。打开朋友圈，发现已经被晚霞刷屏。</p>\n<p>错过此等美景实属遗憾，遂盗图数张，贴于此。侵删。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/78018613-file_1495509134710_17b32.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/41585586-file_1495509134561_f0d0.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/14621647-file_1495509134265_f79.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/60977595-file_1495509134110_11497.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/57319255-file_1495509133942_a29e.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/5676366-file_1495509133767_77d1.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/3171034-file_1495509133623_65d6.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/90260416-file_1495509510830_769.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/90429892-file_1495509510989_926c.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/98195669-file_1495509511284_dabb.jpg\"></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>天地有大美而不言。一直以来，我都是喜欢自然的美景，人工的建筑再怎么精致宏伟也不感冒。在大自然的波诡云谲面前，人类的巧夺天工也不值一提。</p>\n</blockquote>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/95812189-file_1495509134387_3a99.jpg\"></p>","more":"<p>昨天下了小半天的雨。由于雨伞一直落在单位，导致早晨上班的时候出门困难，折返两次回屋去找雨伞，无果。最终冒雨前行，基本湿透。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/78653587-file_1495508664383_490e.jpg\"></p>\n<p>忙碌的一天很快就过去了，下班时太阳已下山。打开朋友圈，发现已经被晚霞刷屏。</p>\n<p>错过此等美景实属遗憾，遂盗图数张，贴于此。侵删。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/78018613-file_1495509134710_17b32.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/41585586-file_1495509134561_f0d0.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/14621647-file_1495509134265_f79.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/60977595-file_1495509134110_11497.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/57319255-file_1495509133942_a29e.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/5676366-file_1495509133767_77d1.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/3171034-file_1495509133623_65d6.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/90260416-file_1495509510830_769.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/90429892-file_1495509510989_926c.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-5-23/98195669-file_1495509511284_dabb.jpg\"></p>"},{"title":"最近遇到的一些小问题 201711","date":"2017-11-28T09:01:02.000Z","_content":"## 1. Laravel\n\n### 1. TokenMismatchException in VerifyCsrfToken.php\n这个问题很常见，在html中添加 csrf_token 也无效的话，考虑以下解决方法：\n```\nsudo rm -rf storage/framework/sessions/*\nsudo php artisan cache:clear\n```\n\n<!-- more -->\n\n### 2. Tinker\n\ndatabase/factories/ModelFactory 里的写法：\n```\n$factory->define(App\\User::class, function (Faker\\Generator $faker) {\n    static $password;\n\n    return [\n        'name' => $faker->name,\n        'email' => $faker->unique()->safeEmail,\n        'mobile' => $faker->phoneNumber,\n        'password' => $password ?: $password = bcrypt('secret'),\n        'remember_token' => str_random(10),\n        'forum_id' => function () {\n            return factory(\\App\\Forum::class)->create()->id;\n        },\n    ];\n});\n```\n\n```\nphp artisan tinker \nfactory(App\\User::class, 10)->create();\n```\n\n> 注意：修改代码后需退出再重新进\n\n## 2. Mysql\n\n### 1. 重置表格索引\n\n```\nalter table `files` auto_increment=1 \n```\n\n### 2. mysql 选择出多个字段，按其中某个字段distinct\n要通过count 和 group的组合来实现\n```\nselect DISTINCT field_name, other_field_name_1, other_field_name_2, ... ,other_field_name_n, count(field_name) from table_name where where_conditions group by field_name\n```\n\n### 3. 月份实现\n\ndatediff 函数\n```\nselect round(datediff(date1, date2)/30) from table_name;\n```\n\n### 4.正则\n```\nselect * from acct_member where email regexp '^[0-9]{11}@virtualAccount.com$' limit 10\n```\n\n> 注意：\\d 等在mysql不好用，替换成别的，如[0-9]+\n\n### 5. mysql 连表更新数据\n\n```\nUPDATE  p_order_article p\nLEFT JOIN\n        acct_member a\nON      p.username = a.email\nSET     p.user_id = a.uid\nWHERE  a.email<>'' and p.user_id=0\n```\n\n## 3. 前端\n\n### 1. jquery-validation 验证 select 下拉框\n需要使用自定义方法，[网址](http://stackoverflow.com/questions/241145/jquery-validate-plugin-how-to-create-a-simple-custom-rule)\n\n### 2. textarea\n\n在使用表单中的textarea标签时，有以下需要注意的地方：\n\n- 去掉右侧滚动条：\n```\n<textarea  style= \"overflow:hidden;\"> </textarea>\n```\n- 去掉右下角的拖拽标记：\n```\n<textarea  style= \"resize:none;\"> </textarea>\n```\n\n- textarea文本域宽度和高度（width、height）自动适应变化处理\n\n```\n<!-- 控制宽度的自动适应 -->\n<style type=\"text/css\">\n.comments {\n width:100%;/*自动适应父布局宽度*/\n overflow:auto;\n word-break:break-all;/*在ie中解决断行问题(防止自动变为在一行显示，主要解决ie兼容问题，ie8中当设宽度为100%时，文本域类容超过一行时，当我们双击文本内容就会自动变为一行显示，所以只能用ie的专有断行属性“word-break或word-wrap”控制其断行)*/\n}\n</style>\n```\n```\n<!-- 主要控制高度的自动适应 -->\n<!-- 第一个是普通textarea -->\n<textarea class=\"comments\" rows=\"10\" cols=\"10\"> </textarea>\n<!-- 以下两种方式都可以解决textarea行高自动适应类容的高度 -->\n<textarea class=\"comments\" rows=1   name=s1   cols=27   onpropertychange= \"this.style.posHeight=this.scrollHeight \"></textarea>\n\n<textarea class=\"comments\" style=\"height:expression((this.scrollHeight>150)?'150px':(this.scrollHeight+5)+'px');overflow:auto;\"></textarea> \n```\n\n## 4. Linux & PHP\n\n### 1. 查找大文件\n\n```\nfind ./ -size +100M -exec ls -lh {} \\;\n```\n\n- 如果想直接删除大于50M的文件，使用命令\n```\nfind ./ -size +50M -exec rm {} \\;\n```\n\n- 本目录下文件大小排序并取前十个\n```\nls -lSh | head -10\n```\n[这里](https://teakki.com/p/57dbcd8f57cd1ab2139a72d3)有详细的教程和案例。\n\n\n\n\n### 2. PHP的 `file_exists = is_dir + is_file`\n\n它既可以判断文件是否存在，又可以判断目录是否存在。但这样一个全面的函数执行效率非常低，就像asp中request不指定是form，还是get,cookies，所以结论是：\n\n- 如果要判断目录是否存在，请用独立函数 is_dir(directory)\n- 如果要判断文件是否存在，请用独立函数 is_file(filepath)\n\nis_file 只判断文件是否存在；\nfile_exists 判断文件是否存在或者是目录是否存在；\nis_dir 判断目录是否存在；\n\n查看手册，虽然这两个函数的结果都会被缓存，但是is_file却快了N倍。\n还有一个值得注意的：\n文件存在的情况下，is_file比file_exists要快N倍；\n文件不存在的情况下，is_file比file_exists要慢；\n结论是，file_exits函数并不会因为该文件是否真的存在而影响速度，但是is_file影响就大了。\n\n### 3. Laravel 使用 model 方式取数据，标记为 deleted_at 的记录也取出来了，如何避免\n\n```\n<?php\nnamespace App;\nuse Illuminate\\Database\\Eloquent\\Model as EloquentModel;\nuse Illuminate\\Database\\Eloquent\\SoftDeletes;\nclass Model extends EloquentModel\n    public function __construct()\n    {\n        parent::__construct();\n    }\n```\n\n加入 `parent::__contstruct()`， 就可以了\n这就带来一个问题， 每个Model 的 fillable 字段都要填一遍了\n老老实实写 fillable吧 ，为了安全\n其实删掉 construct 就好了，怪了（有待确认）\n\n### 4. 修改php文件上传2M的限制\n\n首先找到当前使用的PHP配置文件\n```\nwhich php.ini is being used\nphp -i|grep 'php.ini'\n```\n\n实践证明，这种方法不靠谱，最好的方法还是在页面中打印出 `phpinfo()`， 找到 `Loaded Configuration File` 即可\n\n修改这几个参数，重启 php-fpm （`service php-fpm restart`）\n\n```\nupload_max_filesize = 100M     (php程序最大可以上传的附件值)\npost_max_size = 100M           (form表单POST类型上传的最大可以上传值)\nmemory_limit = 128M　          (限制php程序运行时占用的内存大小最大为 128M)\nmax_execution_time = 0　    (PHP程序执行时间，单位：秒 0代表不限制)\n```\n\n### 5. could not find driver\n\n网页请求没有问题，而命令行中执行composer 或 artisan 都报这个错误\n```\n[Illuminate\\Database\\QueryException]\n could not find driver\n```\n这个问题困扰了好几天\n服务器装了多个PHP， 命令行 `php -v`  和网页 `phpinfo()` 输出的PHP版本竟然不一致\n\n```\n# which php\n/usr/local/bin/php\n\n# /usr/local/bin/php -r \"phpinfo();\" | grep \"PHP Version\"\nPHP Version => 7.1.9\nPHP Version => 7.1.9\n\n# php -v\nPHP 7.1.9 (cli) (built: Sep  8 2017 10:52:57) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\n\n# /usr/local/bin/php -r \"echo(PHP_BINDIR);\"\n/usr/local/php/bin\n```\n\n而在网页中，以上的输出结果为 `PHP Version 7.1.11` 和 `/usr/bin`\n\n\n解决方法： 修改环境变量，将命令行的PHP指向7.1.11 (未成功)\n\n临时解决方法： 将目前所使用的PHP**软链**到所需的PHP版本（先将原来的php备份）\n```\n# which php\n/usr/local/bin/php\n# cd /usr/local/bin/\n# ll | grep php\nlrwxrwxrwx  1 root root       12 Nov 13 18:03 php -> /usr/bin/php*\n```\n\n修改`/etc/profile`文件使其永久性生效，并对所有系统用户生效，在文件末尾加上如下两行代码\n```\nexport PHP_HOME=/usr/bin\nexport PATH=${PATH}:${PHP_HOME}\n```\n\n最后：执行 命令`source /etc/profile`或 执行点命令 `./profile`使其修改生效，执行完可通过`echo $PATH`命令查看是否添加成功。\n\n目前的解决方法：\n```\n/usr/bin/php /root/composer.phar update\n```\n\n终极解决方案：删掉所有PHP版本，重装一个，就一个。\n```\nyum remove php-common\n```\n\n### 6. nginx 配置\n\n使用socket 连接代替http连接。\n\nfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n这一行必须要加入到 nginx 的配置文件中，详细见[这里](http://www.zouzhipeng.com/2017/05/06/centOS%20%E5%AE%89%E8%A3%85%20PHP7/#4-查看是否已正确安装)\n\n## 3. 其他\n\n### 1. sublime 正则替换\n```\nFrom：(\\d{11})\nTo： \"$1\"\n```\n\n> From 的每一块都需要加括号\n\n### 2. hexo NODE_MODULE_VERSION 冲突\n\n```\nNODE_MODULE_VERSION 46. This version of Node.js requires NODE_MODULE_VERSION 51. Please try re-compiling or re-installing\n```\n\nI ran into same issue, after updating node 7.x.x.Rebuilding npm rebuild didn't work either, so After, some digging I was able to resolved it by following:\n```\ncd `which hexo'/../..\nrm -rvf node_modules\nnpm install\n```\n\ncd into your hexo-project\n```\nrm -rvf node_modules\nnpm install\n```\n","source":"_posts/最近遇到的一些小问题-201711.md","raw":"---\ntitle: 最近遇到的一些小问题 201711\ndate: 2017-11-28 17:01:02\ntags: trivia\ncategories: trivia\n---\n## 1. Laravel\n\n### 1. TokenMismatchException in VerifyCsrfToken.php\n这个问题很常见，在html中添加 csrf_token 也无效的话，考虑以下解决方法：\n```\nsudo rm -rf storage/framework/sessions/*\nsudo php artisan cache:clear\n```\n\n<!-- more -->\n\n### 2. Tinker\n\ndatabase/factories/ModelFactory 里的写法：\n```\n$factory->define(App\\User::class, function (Faker\\Generator $faker) {\n    static $password;\n\n    return [\n        'name' => $faker->name,\n        'email' => $faker->unique()->safeEmail,\n        'mobile' => $faker->phoneNumber,\n        'password' => $password ?: $password = bcrypt('secret'),\n        'remember_token' => str_random(10),\n        'forum_id' => function () {\n            return factory(\\App\\Forum::class)->create()->id;\n        },\n    ];\n});\n```\n\n```\nphp artisan tinker \nfactory(App\\User::class, 10)->create();\n```\n\n> 注意：修改代码后需退出再重新进\n\n## 2. Mysql\n\n### 1. 重置表格索引\n\n```\nalter table `files` auto_increment=1 \n```\n\n### 2. mysql 选择出多个字段，按其中某个字段distinct\n要通过count 和 group的组合来实现\n```\nselect DISTINCT field_name, other_field_name_1, other_field_name_2, ... ,other_field_name_n, count(field_name) from table_name where where_conditions group by field_name\n```\n\n### 3. 月份实现\n\ndatediff 函数\n```\nselect round(datediff(date1, date2)/30) from table_name;\n```\n\n### 4.正则\n```\nselect * from acct_member where email regexp '^[0-9]{11}@virtualAccount.com$' limit 10\n```\n\n> 注意：\\d 等在mysql不好用，替换成别的，如[0-9]+\n\n### 5. mysql 连表更新数据\n\n```\nUPDATE  p_order_article p\nLEFT JOIN\n        acct_member a\nON      p.username = a.email\nSET     p.user_id = a.uid\nWHERE  a.email<>'' and p.user_id=0\n```\n\n## 3. 前端\n\n### 1. jquery-validation 验证 select 下拉框\n需要使用自定义方法，[网址](http://stackoverflow.com/questions/241145/jquery-validate-plugin-how-to-create-a-simple-custom-rule)\n\n### 2. textarea\n\n在使用表单中的textarea标签时，有以下需要注意的地方：\n\n- 去掉右侧滚动条：\n```\n<textarea  style= \"overflow:hidden;\"> </textarea>\n```\n- 去掉右下角的拖拽标记：\n```\n<textarea  style= \"resize:none;\"> </textarea>\n```\n\n- textarea文本域宽度和高度（width、height）自动适应变化处理\n\n```\n<!-- 控制宽度的自动适应 -->\n<style type=\"text/css\">\n.comments {\n width:100%;/*自动适应父布局宽度*/\n overflow:auto;\n word-break:break-all;/*在ie中解决断行问题(防止自动变为在一行显示，主要解决ie兼容问题，ie8中当设宽度为100%时，文本域类容超过一行时，当我们双击文本内容就会自动变为一行显示，所以只能用ie的专有断行属性“word-break或word-wrap”控制其断行)*/\n}\n</style>\n```\n```\n<!-- 主要控制高度的自动适应 -->\n<!-- 第一个是普通textarea -->\n<textarea class=\"comments\" rows=\"10\" cols=\"10\"> </textarea>\n<!-- 以下两种方式都可以解决textarea行高自动适应类容的高度 -->\n<textarea class=\"comments\" rows=1   name=s1   cols=27   onpropertychange= \"this.style.posHeight=this.scrollHeight \"></textarea>\n\n<textarea class=\"comments\" style=\"height:expression((this.scrollHeight>150)?'150px':(this.scrollHeight+5)+'px');overflow:auto;\"></textarea> \n```\n\n## 4. Linux & PHP\n\n### 1. 查找大文件\n\n```\nfind ./ -size +100M -exec ls -lh {} \\;\n```\n\n- 如果想直接删除大于50M的文件，使用命令\n```\nfind ./ -size +50M -exec rm {} \\;\n```\n\n- 本目录下文件大小排序并取前十个\n```\nls -lSh | head -10\n```\n[这里](https://teakki.com/p/57dbcd8f57cd1ab2139a72d3)有详细的教程和案例。\n\n\n\n\n### 2. PHP的 `file_exists = is_dir + is_file`\n\n它既可以判断文件是否存在，又可以判断目录是否存在。但这样一个全面的函数执行效率非常低，就像asp中request不指定是form，还是get,cookies，所以结论是：\n\n- 如果要判断目录是否存在，请用独立函数 is_dir(directory)\n- 如果要判断文件是否存在，请用独立函数 is_file(filepath)\n\nis_file 只判断文件是否存在；\nfile_exists 判断文件是否存在或者是目录是否存在；\nis_dir 判断目录是否存在；\n\n查看手册，虽然这两个函数的结果都会被缓存，但是is_file却快了N倍。\n还有一个值得注意的：\n文件存在的情况下，is_file比file_exists要快N倍；\n文件不存在的情况下，is_file比file_exists要慢；\n结论是，file_exits函数并不会因为该文件是否真的存在而影响速度，但是is_file影响就大了。\n\n### 3. Laravel 使用 model 方式取数据，标记为 deleted_at 的记录也取出来了，如何避免\n\n```\n<?php\nnamespace App;\nuse Illuminate\\Database\\Eloquent\\Model as EloquentModel;\nuse Illuminate\\Database\\Eloquent\\SoftDeletes;\nclass Model extends EloquentModel\n    public function __construct()\n    {\n        parent::__construct();\n    }\n```\n\n加入 `parent::__contstruct()`， 就可以了\n这就带来一个问题， 每个Model 的 fillable 字段都要填一遍了\n老老实实写 fillable吧 ，为了安全\n其实删掉 construct 就好了，怪了（有待确认）\n\n### 4. 修改php文件上传2M的限制\n\n首先找到当前使用的PHP配置文件\n```\nwhich php.ini is being used\nphp -i|grep 'php.ini'\n```\n\n实践证明，这种方法不靠谱，最好的方法还是在页面中打印出 `phpinfo()`， 找到 `Loaded Configuration File` 即可\n\n修改这几个参数，重启 php-fpm （`service php-fpm restart`）\n\n```\nupload_max_filesize = 100M     (php程序最大可以上传的附件值)\npost_max_size = 100M           (form表单POST类型上传的最大可以上传值)\nmemory_limit = 128M　          (限制php程序运行时占用的内存大小最大为 128M)\nmax_execution_time = 0　    (PHP程序执行时间，单位：秒 0代表不限制)\n```\n\n### 5. could not find driver\n\n网页请求没有问题，而命令行中执行composer 或 artisan 都报这个错误\n```\n[Illuminate\\Database\\QueryException]\n could not find driver\n```\n这个问题困扰了好几天\n服务器装了多个PHP， 命令行 `php -v`  和网页 `phpinfo()` 输出的PHP版本竟然不一致\n\n```\n# which php\n/usr/local/bin/php\n\n# /usr/local/bin/php -r \"phpinfo();\" | grep \"PHP Version\"\nPHP Version => 7.1.9\nPHP Version => 7.1.9\n\n# php -v\nPHP 7.1.9 (cli) (built: Sep  8 2017 10:52:57) ( NTS )\nCopyright (c) 1997-2017 The PHP Group\nZend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies\n\n# /usr/local/bin/php -r \"echo(PHP_BINDIR);\"\n/usr/local/php/bin\n```\n\n而在网页中，以上的输出结果为 `PHP Version 7.1.11` 和 `/usr/bin`\n\n\n解决方法： 修改环境变量，将命令行的PHP指向7.1.11 (未成功)\n\n临时解决方法： 将目前所使用的PHP**软链**到所需的PHP版本（先将原来的php备份）\n```\n# which php\n/usr/local/bin/php\n# cd /usr/local/bin/\n# ll | grep php\nlrwxrwxrwx  1 root root       12 Nov 13 18:03 php -> /usr/bin/php*\n```\n\n修改`/etc/profile`文件使其永久性生效，并对所有系统用户生效，在文件末尾加上如下两行代码\n```\nexport PHP_HOME=/usr/bin\nexport PATH=${PATH}:${PHP_HOME}\n```\n\n最后：执行 命令`source /etc/profile`或 执行点命令 `./profile`使其修改生效，执行完可通过`echo $PATH`命令查看是否添加成功。\n\n目前的解决方法：\n```\n/usr/bin/php /root/composer.phar update\n```\n\n终极解决方案：删掉所有PHP版本，重装一个，就一个。\n```\nyum remove php-common\n```\n\n### 6. nginx 配置\n\n使用socket 连接代替http连接。\n\nfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n这一行必须要加入到 nginx 的配置文件中，详细见[这里](http://www.zouzhipeng.com/2017/05/06/centOS%20%E5%AE%89%E8%A3%85%20PHP7/#4-查看是否已正确安装)\n\n## 3. 其他\n\n### 1. sublime 正则替换\n```\nFrom：(\\d{11})\nTo： \"$1\"\n```\n\n> From 的每一块都需要加括号\n\n### 2. hexo NODE_MODULE_VERSION 冲突\n\n```\nNODE_MODULE_VERSION 46. This version of Node.js requires NODE_MODULE_VERSION 51. Please try re-compiling or re-installing\n```\n\nI ran into same issue, after updating node 7.x.x.Rebuilding npm rebuild didn't work either, so After, some digging I was able to resolved it by following:\n```\ncd `which hexo'/../..\nrm -rvf node_modules\nnpm install\n```\n\ncd into your hexo-project\n```\nrm -rvf node_modules\nnpm install\n```\n","slug":"最近遇到的一些小问题-201711","published":1,"updated":"2020-09-11T01:04:35.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza300446wo15hod6vx6","content":"<h2 id=\"1-Laravel\"><a href=\"#1-Laravel\" class=\"headerlink\" title=\"1. Laravel\"></a>1. Laravel</h2><h3 id=\"1-TokenMismatchException-in-VerifyCsrfToken-php\"><a href=\"#1-TokenMismatchException-in-VerifyCsrfToken-php\" class=\"headerlink\" title=\"1. TokenMismatchException in VerifyCsrfToken.php\"></a>1. TokenMismatchException in VerifyCsrfToken.php</h3><p>这个问题很常见，在html中添加 csrf_token 也无效的话，考虑以下解决方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf storage&#x2F;framework&#x2F;sessions&#x2F;*</span><br><span class=\"line\">sudo php artisan cache:clear</span><br></pre></td></tr></table></figure>\n\n<a id=\"more\"></a>\n\n<h3 id=\"2-Tinker\"><a href=\"#2-Tinker\" class=\"headerlink\" title=\"2. Tinker\"></a>2. Tinker</h3><p>database/factories/ModelFactory 里的写法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$factory-&gt;define(App\\User::class, function (Faker\\Generator $faker) &#123;</span><br><span class=\"line\">    static $password;</span><br><span class=\"line\"></span><br><span class=\"line\">    return [</span><br><span class=\"line\">        &#39;name&#39; &#x3D;&gt; $faker-&gt;name,</span><br><span class=\"line\">        &#39;email&#39; &#x3D;&gt; $faker-&gt;unique()-&gt;safeEmail,</span><br><span class=\"line\">        &#39;mobile&#39; &#x3D;&gt; $faker-&gt;phoneNumber,</span><br><span class=\"line\">        &#39;password&#39; &#x3D;&gt; $password ?: $password &#x3D; bcrypt(&#39;secret&#39;),</span><br><span class=\"line\">        &#39;remember_token&#39; &#x3D;&gt; str_random(10),</span><br><span class=\"line\">        &#39;forum_id&#39; &#x3D;&gt; function () &#123;</span><br><span class=\"line\">            return factory(\\App\\Forum::class)-&gt;create()-&gt;id;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan tinker </span><br><span class=\"line\">factory(App\\User::class, 10)-&gt;create();</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：修改代码后需退出再重新进</p>\n</blockquote>\n<h2 id=\"2-Mysql\"><a href=\"#2-Mysql\" class=\"headerlink\" title=\"2. Mysql\"></a>2. Mysql</h2><h3 id=\"1-重置表格索引\"><a href=\"#1-重置表格索引\" class=\"headerlink\" title=\"1. 重置表格索引\"></a>1. 重置表格索引</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alter table &#96;files&#96; auto_increment&#x3D;1 </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-mysql-选择出多个字段，按其中某个字段distinct\"><a href=\"#2-mysql-选择出多个字段，按其中某个字段distinct\" class=\"headerlink\" title=\"2. mysql 选择出多个字段，按其中某个字段distinct\"></a>2. mysql 选择出多个字段，按其中某个字段distinct</h3><p>要通过count 和 group的组合来实现</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select DISTINCT field_name, other_field_name_1, other_field_name_2, ... ,other_field_name_n, count(field_name) from table_name where where_conditions group by field_name</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-月份实现\"><a href=\"#3-月份实现\" class=\"headerlink\" title=\"3. 月份实现\"></a>3. 月份实现</h3><p>datediff 函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select round(datediff(date1, date2)&#x2F;30) from table_name;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-正则\"><a href=\"#4-正则\" class=\"headerlink\" title=\"4.正则\"></a>4.正则</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from acct_member where email regexp &#39;^[0-9]&#123;11&#125;@virtualAccount.com$&#39; limit 10</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：\\d 等在mysql不好用，替换成别的，如[0-9]+</p>\n</blockquote>\n<h3 id=\"5-mysql-连表更新数据\"><a href=\"#5-mysql-连表更新数据\" class=\"headerlink\" title=\"5. mysql 连表更新数据\"></a>5. mysql 连表更新数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UPDATE  p_order_article p</span><br><span class=\"line\">LEFT JOIN</span><br><span class=\"line\">        acct_member a</span><br><span class=\"line\">ON      p.username &#x3D; a.email</span><br><span class=\"line\">SET     p.user_id &#x3D; a.uid</span><br><span class=\"line\">WHERE  a.email&lt;&gt;&#39;&#39; and p.user_id&#x3D;0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-前端\"><a href=\"#3-前端\" class=\"headerlink\" title=\"3. 前端\"></a>3. 前端</h2><h3 id=\"1-jquery-validation-验证-select-下拉框\"><a href=\"#1-jquery-validation-验证-select-下拉框\" class=\"headerlink\" title=\"1. jquery-validation 验证 select 下拉框\"></a>1. jquery-validation 验证 select 下拉框</h3><p>需要使用自定义方法，<a href=\"http://stackoverflow.com/questions/241145/jquery-validate-plugin-how-to-create-a-simple-custom-rule\">网址</a></p>\n<h3 id=\"2-textarea\"><a href=\"#2-textarea\" class=\"headerlink\" title=\"2. textarea\"></a>2. textarea</h3><p>在使用表单中的textarea标签时，有以下需要注意的地方：</p>\n<ul>\n<li><p>去掉右侧滚动条：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;textarea  style&#x3D; &quot;overflow:hidden;&quot;&gt; &lt;&#x2F;textarea&gt;</span><br></pre></td></tr></table></figure></li>\n<li><p>去掉右下角的拖拽标记：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;textarea  style&#x3D; &quot;resize:none;&quot;&gt; &lt;&#x2F;textarea&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>textarea文本域宽度和高度（width、height）自动适应变化处理</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- 控制宽度的自动适应 --&gt;</span><br><span class=\"line\">&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class=\"line\">.comments &#123;</span><br><span class=\"line\"> width:100%;&#x2F;*自动适应父布局宽度*&#x2F;</span><br><span class=\"line\"> overflow:auto;</span><br><span class=\"line\"> word-break:break-all;&#x2F;*在ie中解决断行问题(防止自动变为在一行显示，主要解决ie兼容问题，ie8中当设宽度为100%时，文本域类容超过一行时，当我们双击文本内容就会自动变为一行显示，所以只能用ie的专有断行属性“word-break或word-wrap”控制其断行)*&#x2F;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- 主要控制高度的自动适应 --&gt;</span><br><span class=\"line\">&lt;!-- 第一个是普通textarea --&gt;</span><br><span class=\"line\">&lt;textarea class&#x3D;&quot;comments&quot; rows&#x3D;&quot;10&quot; cols&#x3D;&quot;10&quot;&gt; &lt;&#x2F;textarea&gt;</span><br><span class=\"line\">&lt;!-- 以下两种方式都可以解决textarea行高自动适应类容的高度 --&gt;</span><br><span class=\"line\">&lt;textarea class&#x3D;&quot;comments&quot; rows&#x3D;1   name&#x3D;s1   cols&#x3D;27   onpropertychange&#x3D; &quot;this.style.posHeight&#x3D;this.scrollHeight &quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;textarea class&#x3D;&quot;comments&quot; style&#x3D;&quot;height:expression((this.scrollHeight&gt;150)?&#39;150px&#39;:(this.scrollHeight+5)+&#39;px&#39;);overflow:auto;&quot;&gt;&lt;&#x2F;textarea&gt; </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Linux-amp-PHP\"><a href=\"#4-Linux-amp-PHP\" class=\"headerlink\" title=\"4. Linux &amp; PHP\"></a>4. Linux &amp; PHP</h2><h3 id=\"1-查找大文件\"><a href=\"#1-查找大文件\" class=\"headerlink\" title=\"1. 查找大文件\"></a>1. 查找大文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find .&#x2F; -size +100M -exec ls -lh &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>如果想直接删除大于50M的文件，使用命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find .&#x2F; -size +50M -exec rm &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>本目录下文件大小排序并取前十个</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -lSh | head -10</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://teakki.com/p/57dbcd8f57cd1ab2139a72d3\">这里</a>有详细的教程和案例。</p>\n</li>\n</ul>\n<h3 id=\"2-PHP的-file-exists-is-dir-is-file\"><a href=\"#2-PHP的-file-exists-is-dir-is-file\" class=\"headerlink\" title=\"2. PHP的 file_exists = is_dir + is_file\"></a>2. PHP的 <code>file_exists = is_dir + is_file</code></h3><p>它既可以判断文件是否存在，又可以判断目录是否存在。但这样一个全面的函数执行效率非常低，就像asp中request不指定是form，还是get,cookies，所以结论是：</p>\n<ul>\n<li>如果要判断目录是否存在，请用独立函数 is_dir(directory)</li>\n<li>如果要判断文件是否存在，请用独立函数 is_file(filepath)</li>\n</ul>\n<p>is_file 只判断文件是否存在；<br>file_exists 判断文件是否存在或者是目录是否存在；<br>is_dir 判断目录是否存在；</p>\n<p>查看手册，虽然这两个函数的结果都会被缓存，但是is_file却快了N倍。<br>还有一个值得注意的：<br>文件存在的情况下，is_file比file_exists要快N倍；<br>文件不存在的情况下，is_file比file_exists要慢；<br>结论是，file_exits函数并不会因为该文件是否真的存在而影响速度，但是is_file影响就大了。</p>\n<h3 id=\"3-Laravel-使用-model-方式取数据，标记为-deleted-at-的记录也取出来了，如何避免\"><a href=\"#3-Laravel-使用-model-方式取数据，标记为-deleted-at-的记录也取出来了，如何避免\" class=\"headerlink\" title=\"3. Laravel 使用 model 方式取数据，标记为 deleted_at 的记录也取出来了，如何避免\"></a>3. Laravel 使用 model 方式取数据，标记为 deleted_at 的记录也取出来了，如何避免</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">namespace App;</span><br><span class=\"line\">use Illuminate\\Database\\Eloquent\\Model as EloquentModel;</span><br><span class=\"line\">use Illuminate\\Database\\Eloquent\\SoftDeletes;</span><br><span class=\"line\">class Model extends EloquentModel</span><br><span class=\"line\">    public function __construct()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        parent::__construct();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>加入 <code>parent::__contstruct()</code>， 就可以了<br>这就带来一个问题， 每个Model 的 fillable 字段都要填一遍了<br>老老实实写 fillable吧 ，为了安全<br>其实删掉 construct 就好了，怪了（有待确认）</p>\n<h3 id=\"4-修改php文件上传2M的限制\"><a href=\"#4-修改php文件上传2M的限制\" class=\"headerlink\" title=\"4. 修改php文件上传2M的限制\"></a>4. 修改php文件上传2M的限制</h3><p>首先找到当前使用的PHP配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which php.ini is being used</span><br><span class=\"line\">php -i|grep &#39;php.ini&#39;</span><br></pre></td></tr></table></figure>\n\n<p>实践证明，这种方法不靠谱，最好的方法还是在页面中打印出 <code>phpinfo()</code>， 找到 <code>Loaded Configuration File</code> 即可</p>\n<p>修改这几个参数，重启 php-fpm （<code>service php-fpm restart</code>）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upload_max_filesize &#x3D; 100M     (php程序最大可以上传的附件值)</span><br><span class=\"line\">post_max_size &#x3D; 100M           (form表单POST类型上传的最大可以上传值)</span><br><span class=\"line\">memory_limit &#x3D; 128M　          (限制php程序运行时占用的内存大小最大为 128M)</span><br><span class=\"line\">max_execution_time &#x3D; 0　    (PHP程序执行时间，单位：秒 0代表不限制)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-could-not-find-driver\"><a href=\"#5-could-not-find-driver\" class=\"headerlink\" title=\"5. could not find driver\"></a>5. could not find driver</h3><p>网页请求没有问题，而命令行中执行composer 或 artisan 都报这个错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Illuminate\\Database\\QueryException]</span><br><span class=\"line\"> could not find driver</span><br></pre></td></tr></table></figure>\n<p>这个问题困扰了好几天<br>服务器装了多个PHP， 命令行 <code>php -v</code>  和网页 <code>phpinfo()</code> 输出的PHP版本竟然不一致</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># which php</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php</span><br><span class=\"line\"></span><br><span class=\"line\"># &#x2F;usr&#x2F;local&#x2F;bin&#x2F;php -r &quot;phpinfo();&quot; | grep &quot;PHP Version&quot;</span><br><span class=\"line\">PHP Version &#x3D;&gt; 7.1.9</span><br><span class=\"line\">PHP Version &#x3D;&gt; 7.1.9</span><br><span class=\"line\"></span><br><span class=\"line\"># php -v</span><br><span class=\"line\">PHP 7.1.9 (cli) (built: Sep  8 2017 10:52:57) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2017 The PHP Group</span><br><span class=\"line\">Zend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies</span><br><span class=\"line\"></span><br><span class=\"line\"># &#x2F;usr&#x2F;local&#x2F;bin&#x2F;php -r &quot;echo(PHP_BINDIR);&quot;</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<p>而在网页中，以上的输出结果为 <code>PHP Version 7.1.11</code> 和 <code>/usr/bin</code></p>\n<p>解决方法： 修改环境变量，将命令行的PHP指向7.1.11 (未成功)</p>\n<p>临时解决方法： 将目前所使用的PHP<strong>软链</strong>到所需的PHP版本（先将原来的php备份）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># which php</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php</span><br><span class=\"line\"># cd &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class=\"line\"># ll | grep php</span><br><span class=\"line\">lrwxrwxrwx  1 root root       12 Nov 13 18:03 php -&gt; &#x2F;usr&#x2F;bin&#x2F;php*</span><br></pre></td></tr></table></figure>\n\n<p>修改<code>/etc/profile</code>文件使其永久性生效，并对所有系统用户生效，在文件末尾加上如下两行代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export PHP_HOME&#x3D;&#x2F;usr&#x2F;bin</span><br><span class=\"line\">export PATH&#x3D;$&#123;PATH&#125;:$&#123;PHP_HOME&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后：执行 命令<code>source /etc/profile</code>或 执行点命令 <code>./profile</code>使其修改生效，执行完可通过<code>echo $PATH</code>命令查看是否添加成功。</p>\n<p>目前的解决方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;php &#x2F;root&#x2F;composer.phar update</span><br></pre></td></tr></table></figure>\n\n<p>终极解决方案：删掉所有PHP版本，重装一个，就一个。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove php-common</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-nginx-配置\"><a href=\"#6-nginx-配置\" class=\"headerlink\" title=\"6. nginx 配置\"></a>6. nginx 配置</h3><p>使用socket 连接代替http连接。</p>\n<p>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br>这一行必须要加入到 nginx 的配置文件中，详细见<a href=\"http://www.zouzhipeng.com/2017/05/06/centOS%20%E5%AE%89%E8%A3%85%20PHP7/#4-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%B7%B2%E6%AD%A3%E7%A1%AE%E5%AE%89%E8%A3%85\">这里</a></p>\n<h2 id=\"3-其他\"><a href=\"#3-其他\" class=\"headerlink\" title=\"3. 其他\"></a>3. 其他</h2><h3 id=\"1-sublime-正则替换\"><a href=\"#1-sublime-正则替换\" class=\"headerlink\" title=\"1. sublime 正则替换\"></a>1. sublime 正则替换</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">From：(\\d&#123;11&#125;)</span><br><span class=\"line\">To： &quot;$1&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>From 的每一块都需要加括号</p>\n</blockquote>\n<h3 id=\"2-hexo-NODE-MODULE-VERSION-冲突\"><a href=\"#2-hexo-NODE-MODULE-VERSION-冲突\" class=\"headerlink\" title=\"2. hexo NODE_MODULE_VERSION 冲突\"></a>2. hexo NODE_MODULE_VERSION 冲突</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NODE_MODULE_VERSION 46. This version of Node.js requires NODE_MODULE_VERSION 51. Please try re-compiling or re-installing</span><br></pre></td></tr></table></figure>\n\n<p>I ran into same issue, after updating node 7.x.x.Rebuilding npm rebuild didn’t work either, so After, some digging I was able to resolved it by following:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#96;which hexo&#39;&#x2F;..&#x2F;..</span><br><span class=\"line\">rm -rvf node_modules</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<p>cd into your hexo-project</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -rvf node_modules</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-Laravel\"><a href=\"#1-Laravel\" class=\"headerlink\" title=\"1. Laravel\"></a>1. Laravel</h2><h3 id=\"1-TokenMismatchException-in-VerifyCsrfToken-php\"><a href=\"#1-TokenMismatchException-in-VerifyCsrfToken-php\" class=\"headerlink\" title=\"1. TokenMismatchException in VerifyCsrfToken.php\"></a>1. TokenMismatchException in VerifyCsrfToken.php</h3><p>这个问题很常见，在html中添加 csrf_token 也无效的话，考虑以下解决方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rm -rf storage&#x2F;framework&#x2F;sessions&#x2F;*</span><br><span class=\"line\">sudo php artisan cache:clear</span><br></pre></td></tr></table></figure>","more":"<h3 id=\"2-Tinker\"><a href=\"#2-Tinker\" class=\"headerlink\" title=\"2. Tinker\"></a>2. Tinker</h3><p>database/factories/ModelFactory 里的写法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$factory-&gt;define(App\\User::class, function (Faker\\Generator $faker) &#123;</span><br><span class=\"line\">    static $password;</span><br><span class=\"line\"></span><br><span class=\"line\">    return [</span><br><span class=\"line\">        &#39;name&#39; &#x3D;&gt; $faker-&gt;name,</span><br><span class=\"line\">        &#39;email&#39; &#x3D;&gt; $faker-&gt;unique()-&gt;safeEmail,</span><br><span class=\"line\">        &#39;mobile&#39; &#x3D;&gt; $faker-&gt;phoneNumber,</span><br><span class=\"line\">        &#39;password&#39; &#x3D;&gt; $password ?: $password &#x3D; bcrypt(&#39;secret&#39;),</span><br><span class=\"line\">        &#39;remember_token&#39; &#x3D;&gt; str_random(10),</span><br><span class=\"line\">        &#39;forum_id&#39; &#x3D;&gt; function () &#123;</span><br><span class=\"line\">            return factory(\\App\\Forum::class)-&gt;create()-&gt;id;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    ];</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php artisan tinker </span><br><span class=\"line\">factory(App\\User::class, 10)-&gt;create();</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：修改代码后需退出再重新进</p>\n</blockquote>\n<h2 id=\"2-Mysql\"><a href=\"#2-Mysql\" class=\"headerlink\" title=\"2. Mysql\"></a>2. Mysql</h2><h3 id=\"1-重置表格索引\"><a href=\"#1-重置表格索引\" class=\"headerlink\" title=\"1. 重置表格索引\"></a>1. 重置表格索引</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alter table &#96;files&#96; auto_increment&#x3D;1 </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-mysql-选择出多个字段，按其中某个字段distinct\"><a href=\"#2-mysql-选择出多个字段，按其中某个字段distinct\" class=\"headerlink\" title=\"2. mysql 选择出多个字段，按其中某个字段distinct\"></a>2. mysql 选择出多个字段，按其中某个字段distinct</h3><p>要通过count 和 group的组合来实现</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select DISTINCT field_name, other_field_name_1, other_field_name_2, ... ,other_field_name_n, count(field_name) from table_name where where_conditions group by field_name</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-月份实现\"><a href=\"#3-月份实现\" class=\"headerlink\" title=\"3. 月份实现\"></a>3. 月份实现</h3><p>datediff 函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select round(datediff(date1, date2)&#x2F;30) from table_name;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-正则\"><a href=\"#4-正则\" class=\"headerlink\" title=\"4.正则\"></a>4.正则</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from acct_member where email regexp &#39;^[0-9]&#123;11&#125;@virtualAccount.com$&#39; limit 10</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：\\d 等在mysql不好用，替换成别的，如[0-9]+</p>\n</blockquote>\n<h3 id=\"5-mysql-连表更新数据\"><a href=\"#5-mysql-连表更新数据\" class=\"headerlink\" title=\"5. mysql 连表更新数据\"></a>5. mysql 连表更新数据</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UPDATE  p_order_article p</span><br><span class=\"line\">LEFT JOIN</span><br><span class=\"line\">        acct_member a</span><br><span class=\"line\">ON      p.username &#x3D; a.email</span><br><span class=\"line\">SET     p.user_id &#x3D; a.uid</span><br><span class=\"line\">WHERE  a.email&lt;&gt;&#39;&#39; and p.user_id&#x3D;0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-前端\"><a href=\"#3-前端\" class=\"headerlink\" title=\"3. 前端\"></a>3. 前端</h2><h3 id=\"1-jquery-validation-验证-select-下拉框\"><a href=\"#1-jquery-validation-验证-select-下拉框\" class=\"headerlink\" title=\"1. jquery-validation 验证 select 下拉框\"></a>1. jquery-validation 验证 select 下拉框</h3><p>需要使用自定义方法，<a href=\"http://stackoverflow.com/questions/241145/jquery-validate-plugin-how-to-create-a-simple-custom-rule\">网址</a></p>\n<h3 id=\"2-textarea\"><a href=\"#2-textarea\" class=\"headerlink\" title=\"2. textarea\"></a>2. textarea</h3><p>在使用表单中的textarea标签时，有以下需要注意的地方：</p>\n<ul>\n<li><p>去掉右侧滚动条：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;textarea  style&#x3D; &quot;overflow:hidden;&quot;&gt; &lt;&#x2F;textarea&gt;</span><br></pre></td></tr></table></figure></li>\n<li><p>去掉右下角的拖拽标记：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;textarea  style&#x3D; &quot;resize:none;&quot;&gt; &lt;&#x2F;textarea&gt;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>textarea文本域宽度和高度（width、height）自动适应变化处理</p>\n</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- 控制宽度的自动适应 --&gt;</span><br><span class=\"line\">&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class=\"line\">.comments &#123;</span><br><span class=\"line\"> width:100%;&#x2F;*自动适应父布局宽度*&#x2F;</span><br><span class=\"line\"> overflow:auto;</span><br><span class=\"line\"> word-break:break-all;&#x2F;*在ie中解决断行问题(防止自动变为在一行显示，主要解决ie兼容问题，ie8中当设宽度为100%时，文本域类容超过一行时，当我们双击文本内容就会自动变为一行显示，所以只能用ie的专有断行属性“word-break或word-wrap”控制其断行)*&#x2F;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- 主要控制高度的自动适应 --&gt;</span><br><span class=\"line\">&lt;!-- 第一个是普通textarea --&gt;</span><br><span class=\"line\">&lt;textarea class&#x3D;&quot;comments&quot; rows&#x3D;&quot;10&quot; cols&#x3D;&quot;10&quot;&gt; &lt;&#x2F;textarea&gt;</span><br><span class=\"line\">&lt;!-- 以下两种方式都可以解决textarea行高自动适应类容的高度 --&gt;</span><br><span class=\"line\">&lt;textarea class&#x3D;&quot;comments&quot; rows&#x3D;1   name&#x3D;s1   cols&#x3D;27   onpropertychange&#x3D; &quot;this.style.posHeight&#x3D;this.scrollHeight &quot;&gt;&lt;&#x2F;textarea&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;textarea class&#x3D;&quot;comments&quot; style&#x3D;&quot;height:expression((this.scrollHeight&gt;150)?&#39;150px&#39;:(this.scrollHeight+5)+&#39;px&#39;);overflow:auto;&quot;&gt;&lt;&#x2F;textarea&gt; </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Linux-amp-PHP\"><a href=\"#4-Linux-amp-PHP\" class=\"headerlink\" title=\"4. Linux &amp; PHP\"></a>4. Linux &amp; PHP</h2><h3 id=\"1-查找大文件\"><a href=\"#1-查找大文件\" class=\"headerlink\" title=\"1. 查找大文件\"></a>1. 查找大文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find .&#x2F; -size +100M -exec ls -lh &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>如果想直接删除大于50M的文件，使用命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find .&#x2F; -size +50M -exec rm &#123;&#125; \\;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>本目录下文件大小排序并取前十个</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls -lSh | head -10</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://teakki.com/p/57dbcd8f57cd1ab2139a72d3\">这里</a>有详细的教程和案例。</p>\n</li>\n</ul>\n<h3 id=\"2-PHP的-file-exists-is-dir-is-file\"><a href=\"#2-PHP的-file-exists-is-dir-is-file\" class=\"headerlink\" title=\"2. PHP的 file_exists = is_dir + is_file\"></a>2. PHP的 <code>file_exists = is_dir + is_file</code></h3><p>它既可以判断文件是否存在，又可以判断目录是否存在。但这样一个全面的函数执行效率非常低，就像asp中request不指定是form，还是get,cookies，所以结论是：</p>\n<ul>\n<li>如果要判断目录是否存在，请用独立函数 is_dir(directory)</li>\n<li>如果要判断文件是否存在，请用独立函数 is_file(filepath)</li>\n</ul>\n<p>is_file 只判断文件是否存在；<br>file_exists 判断文件是否存在或者是目录是否存在；<br>is_dir 判断目录是否存在；</p>\n<p>查看手册，虽然这两个函数的结果都会被缓存，但是is_file却快了N倍。<br>还有一个值得注意的：<br>文件存在的情况下，is_file比file_exists要快N倍；<br>文件不存在的情况下，is_file比file_exists要慢；<br>结论是，file_exits函数并不会因为该文件是否真的存在而影响速度，但是is_file影响就大了。</p>\n<h3 id=\"3-Laravel-使用-model-方式取数据，标记为-deleted-at-的记录也取出来了，如何避免\"><a href=\"#3-Laravel-使用-model-方式取数据，标记为-deleted-at-的记录也取出来了，如何避免\" class=\"headerlink\" title=\"3. Laravel 使用 model 方式取数据，标记为 deleted_at 的记录也取出来了，如何避免\"></a>3. Laravel 使用 model 方式取数据，标记为 deleted_at 的记录也取出来了，如何避免</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">namespace App;</span><br><span class=\"line\">use Illuminate\\Database\\Eloquent\\Model as EloquentModel;</span><br><span class=\"line\">use Illuminate\\Database\\Eloquent\\SoftDeletes;</span><br><span class=\"line\">class Model extends EloquentModel</span><br><span class=\"line\">    public function __construct()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        parent::__construct();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>加入 <code>parent::__contstruct()</code>， 就可以了<br>这就带来一个问题， 每个Model 的 fillable 字段都要填一遍了<br>老老实实写 fillable吧 ，为了安全<br>其实删掉 construct 就好了，怪了（有待确认）</p>\n<h3 id=\"4-修改php文件上传2M的限制\"><a href=\"#4-修改php文件上传2M的限制\" class=\"headerlink\" title=\"4. 修改php文件上传2M的限制\"></a>4. 修改php文件上传2M的限制</h3><p>首先找到当前使用的PHP配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">which php.ini is being used</span><br><span class=\"line\">php -i|grep &#39;php.ini&#39;</span><br></pre></td></tr></table></figure>\n\n<p>实践证明，这种方法不靠谱，最好的方法还是在页面中打印出 <code>phpinfo()</code>， 找到 <code>Loaded Configuration File</code> 即可</p>\n<p>修改这几个参数，重启 php-fpm （<code>service php-fpm restart</code>）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">upload_max_filesize &#x3D; 100M     (php程序最大可以上传的附件值)</span><br><span class=\"line\">post_max_size &#x3D; 100M           (form表单POST类型上传的最大可以上传值)</span><br><span class=\"line\">memory_limit &#x3D; 128M　          (限制php程序运行时占用的内存大小最大为 128M)</span><br><span class=\"line\">max_execution_time &#x3D; 0　    (PHP程序执行时间，单位：秒 0代表不限制)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-could-not-find-driver\"><a href=\"#5-could-not-find-driver\" class=\"headerlink\" title=\"5. could not find driver\"></a>5. could not find driver</h3><p>网页请求没有问题，而命令行中执行composer 或 artisan 都报这个错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Illuminate\\Database\\QueryException]</span><br><span class=\"line\"> could not find driver</span><br></pre></td></tr></table></figure>\n<p>这个问题困扰了好几天<br>服务器装了多个PHP， 命令行 <code>php -v</code>  和网页 <code>phpinfo()</code> 输出的PHP版本竟然不一致</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># which php</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php</span><br><span class=\"line\"></span><br><span class=\"line\"># &#x2F;usr&#x2F;local&#x2F;bin&#x2F;php -r &quot;phpinfo();&quot; | grep &quot;PHP Version&quot;</span><br><span class=\"line\">PHP Version &#x3D;&gt; 7.1.9</span><br><span class=\"line\">PHP Version &#x3D;&gt; 7.1.9</span><br><span class=\"line\"></span><br><span class=\"line\"># php -v</span><br><span class=\"line\">PHP 7.1.9 (cli) (built: Sep  8 2017 10:52:57) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2017 The PHP Group</span><br><span class=\"line\">Zend Engine v3.1.0, Copyright (c) 1998-2017 Zend Technologies</span><br><span class=\"line\"></span><br><span class=\"line\"># &#x2F;usr&#x2F;local&#x2F;bin&#x2F;php -r &quot;echo(PHP_BINDIR);&quot;</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;php&#x2F;bin</span><br></pre></td></tr></table></figure>\n\n<p>而在网页中，以上的输出结果为 <code>PHP Version 7.1.11</code> 和 <code>/usr/bin</code></p>\n<p>解决方法： 修改环境变量，将命令行的PHP指向7.1.11 (未成功)</p>\n<p>临时解决方法： 将目前所使用的PHP<strong>软链</strong>到所需的PHP版本（先将原来的php备份）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># which php</span><br><span class=\"line\">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;php</span><br><span class=\"line\"># cd &#x2F;usr&#x2F;local&#x2F;bin&#x2F;</span><br><span class=\"line\"># ll | grep php</span><br><span class=\"line\">lrwxrwxrwx  1 root root       12 Nov 13 18:03 php -&gt; &#x2F;usr&#x2F;bin&#x2F;php*</span><br></pre></td></tr></table></figure>\n\n<p>修改<code>/etc/profile</code>文件使其永久性生效，并对所有系统用户生效，在文件末尾加上如下两行代码</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export PHP_HOME&#x3D;&#x2F;usr&#x2F;bin</span><br><span class=\"line\">export PATH&#x3D;$&#123;PATH&#125;:$&#123;PHP_HOME&#125;</span><br></pre></td></tr></table></figure>\n\n<p>最后：执行 命令<code>source /etc/profile</code>或 执行点命令 <code>./profile</code>使其修改生效，执行完可通过<code>echo $PATH</code>命令查看是否添加成功。</p>\n<p>目前的解决方法：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;usr&#x2F;bin&#x2F;php &#x2F;root&#x2F;composer.phar update</span><br></pre></td></tr></table></figure>\n\n<p>终极解决方案：删掉所有PHP版本，重装一个，就一个。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove php-common</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-nginx-配置\"><a href=\"#6-nginx-配置\" class=\"headerlink\" title=\"6. nginx 配置\"></a>6. nginx 配置</h3><p>使用socket 连接代替http连接。</p>\n<p>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br>这一行必须要加入到 nginx 的配置文件中，详细见<a href=\"http://www.zouzhipeng.com/2017/05/06/centOS%20%E5%AE%89%E8%A3%85%20PHP7/#4-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E5%B7%B2%E6%AD%A3%E7%A1%AE%E5%AE%89%E8%A3%85\">这里</a></p>\n<h2 id=\"3-其他\"><a href=\"#3-其他\" class=\"headerlink\" title=\"3. 其他\"></a>3. 其他</h2><h3 id=\"1-sublime-正则替换\"><a href=\"#1-sublime-正则替换\" class=\"headerlink\" title=\"1. sublime 正则替换\"></a>1. sublime 正则替换</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">From：(\\d&#123;11&#125;)</span><br><span class=\"line\">To： &quot;$1&quot;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>From 的每一块都需要加括号</p>\n</blockquote>\n<h3 id=\"2-hexo-NODE-MODULE-VERSION-冲突\"><a href=\"#2-hexo-NODE-MODULE-VERSION-冲突\" class=\"headerlink\" title=\"2. hexo NODE_MODULE_VERSION 冲突\"></a>2. hexo NODE_MODULE_VERSION 冲突</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NODE_MODULE_VERSION 46. This version of Node.js requires NODE_MODULE_VERSION 51. Please try re-compiling or re-installing</span><br></pre></td></tr></table></figure>\n\n<p>I ran into same issue, after updating node 7.x.x.Rebuilding npm rebuild didn’t work either, so After, some digging I was able to resolved it by following:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#96;which hexo&#39;&#x2F;..&#x2F;..</span><br><span class=\"line\">rm -rvf node_modules</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n\n<p>cd into your hexo-project</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm -rvf node_modules</span><br><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>"},{"title":"算法、逻辑思维","date":"2018-02-17T07:08:45.000Z","_content":"\n> 真题：请简单描述一下数据结构的特征（stack、heap、list、doubly-linked-list、queue、array(vector)）\n\n考点: 常见数据结构特征\n\n<!-- more -->\n\n#### 1. Array 数组\n数组，最简单而且应用最广泛的数据结构之一\n\n特性：<b style='color:red'>使用连续的内存来存储，数组中的所有元素必须是相同的类型或类型的衍生（同质数据结构）</b>，元素可以通过下标直接访问\n\n#### 2. LinkedList 链表\n\n线性表的一种，最基本、最简单、也是最常用的数据结构\n\n特性：元素之间的关系是一对一的关系（除了第一个和最后一个元素，其他元素都是首尾相接），有顺序存储结构和链式存储结构两种存储方式\n\n#### 3.Stack 栈\n\n和队列相似，一个带有数据存储特性的数据结构\n\n特性：存储数据是先进后出，栈只有一个出口，只能从栈顶部增加和移除元素\n\n#### 4. Heap 堆\n\n一般情况下，堆叫二叉堆，近似完全二叉树的数据结构\n\n特性：子节点的键值或者索引总是小于它的父节点，每个节点的左右子树又是一个二叉堆，根节点最大的堆叫最大堆或者大根堆，最小的叫最小堆或者小根堆\n\n#### 5. list 线性表\n\n由零个或多个数据元素组成的有限序列\n\n特性：线性表是一个序列，0 个元素够成的线性表是空表，第一个元素无先驱，最后一个元素无后继，其他元素都只有一个先驱和后继，有长度，长度是元素个数，长度有限\n\n#### 6. doubly-linked-list 双向链表\n\n特性：每个元素都是一个对象，每个对象有一个关键字 key 和两个指针（next 和 prev）\n\n#### 7. queue 队列\n\n特性：先进先出（FIFO），并发中使用，可以安全地将对象从一个任务传给另一个任务\n\n#### 8. set 集合\n\n特性：保存不重复的元素\n\n#### 9. map 字典\n\n特性：关联数组，也被叫做字典或者键值对\n\n#### 10. graph 图\n\n特性：通常使用邻接矩阵和邻接表表示，前者易实现但是对于稀疏矩阵会浪费较多空间，后者使用链表的方式存储信息但是对于图搜索时间复杂度较高\n\n### 解题方法\n\n先理解每种数据结构的特征，有时会遇到让用 PHP 代码实现其中的数据结构，遇到此类题目，先要理解该种数据结构的特性是什么，然后再实现，通常可以使用 PHP 的数组来模拟。\n\n真题：用 PHP 实现一个双向队列\n\n队列是一种线性表，按照先进先出的原则进行\n- 单向队列：只能从头进，从尾出\n- 双向队列：头尾都可以进出\n\nPHP 有四个数组方法可以实现\n\n``` php\n<?php\n\nclass Deque\n{\n    public $queue = array();\n\n    /**\n     * 尾部入对\n     * @param [type] $value [description]\n     */\n    public function addLast($value)\n    {\n        return array_push($this->queue, $value);\n    }\n\n    /**\n     * 尾部出队\n     * @return [type] [description]\n     */\n    public function removeLast()\n    {\n        return array_pop($this->queue);\n    }\n\n    /**\n     * 头部入队\n     * @param [type] $value [description]\n     */\n    public function addFirst($value)\n    {\n        return array_unshift($this->queue, $value);\n    }\n\n    /**\n     * 头部出队\n     * @return [type] [description]\n     */\n    public function removeFirst()\n    {\n        return array_shift($this->queue);\n    }\n\n    /**\n     * 清空队列\n     * @return [type] [description]\n     */\n    public function makeEmpty()\n    {\n        unset($this->queue);\n    }\n\n    /**\n     * 获取列头\n     * @return [type] [description]\n     */\n    public function getFirst()\n    {\n        return reset($this->queue);\n    }\n\n    /**\n     * 获取列尾\n     * @return [type] [description]\n     */\n    public function getLast()\n    {\n        return end($this->queue);\n    }\n\n    /**\n     * 获取长度\n     * @return [type] [description]\n     */\n    public function getLength()\n    {\n        return count($this->queue);\n    }\n}\n\n```\n\n\n\n\n\n\n","source":"_posts/算法、逻辑思维.md","raw":"---\ntitle: 算法、逻辑思维\ndate: 2018-02-17 15:08:45\ntags: 算法\n---\n\n> 真题：请简单描述一下数据结构的特征（stack、heap、list、doubly-linked-list、queue、array(vector)）\n\n考点: 常见数据结构特征\n\n<!-- more -->\n\n#### 1. Array 数组\n数组，最简单而且应用最广泛的数据结构之一\n\n特性：<b style='color:red'>使用连续的内存来存储，数组中的所有元素必须是相同的类型或类型的衍生（同质数据结构）</b>，元素可以通过下标直接访问\n\n#### 2. LinkedList 链表\n\n线性表的一种，最基本、最简单、也是最常用的数据结构\n\n特性：元素之间的关系是一对一的关系（除了第一个和最后一个元素，其他元素都是首尾相接），有顺序存储结构和链式存储结构两种存储方式\n\n#### 3.Stack 栈\n\n和队列相似，一个带有数据存储特性的数据结构\n\n特性：存储数据是先进后出，栈只有一个出口，只能从栈顶部增加和移除元素\n\n#### 4. Heap 堆\n\n一般情况下，堆叫二叉堆，近似完全二叉树的数据结构\n\n特性：子节点的键值或者索引总是小于它的父节点，每个节点的左右子树又是一个二叉堆，根节点最大的堆叫最大堆或者大根堆，最小的叫最小堆或者小根堆\n\n#### 5. list 线性表\n\n由零个或多个数据元素组成的有限序列\n\n特性：线性表是一个序列，0 个元素够成的线性表是空表，第一个元素无先驱，最后一个元素无后继，其他元素都只有一个先驱和后继，有长度，长度是元素个数，长度有限\n\n#### 6. doubly-linked-list 双向链表\n\n特性：每个元素都是一个对象，每个对象有一个关键字 key 和两个指针（next 和 prev）\n\n#### 7. queue 队列\n\n特性：先进先出（FIFO），并发中使用，可以安全地将对象从一个任务传给另一个任务\n\n#### 8. set 集合\n\n特性：保存不重复的元素\n\n#### 9. map 字典\n\n特性：关联数组，也被叫做字典或者键值对\n\n#### 10. graph 图\n\n特性：通常使用邻接矩阵和邻接表表示，前者易实现但是对于稀疏矩阵会浪费较多空间，后者使用链表的方式存储信息但是对于图搜索时间复杂度较高\n\n### 解题方法\n\n先理解每种数据结构的特征，有时会遇到让用 PHP 代码实现其中的数据结构，遇到此类题目，先要理解该种数据结构的特性是什么，然后再实现，通常可以使用 PHP 的数组来模拟。\n\n真题：用 PHP 实现一个双向队列\n\n队列是一种线性表，按照先进先出的原则进行\n- 单向队列：只能从头进，从尾出\n- 双向队列：头尾都可以进出\n\nPHP 有四个数组方法可以实现\n\n``` php\n<?php\n\nclass Deque\n{\n    public $queue = array();\n\n    /**\n     * 尾部入对\n     * @param [type] $value [description]\n     */\n    public function addLast($value)\n    {\n        return array_push($this->queue, $value);\n    }\n\n    /**\n     * 尾部出队\n     * @return [type] [description]\n     */\n    public function removeLast()\n    {\n        return array_pop($this->queue);\n    }\n\n    /**\n     * 头部入队\n     * @param [type] $value [description]\n     */\n    public function addFirst($value)\n    {\n        return array_unshift($this->queue, $value);\n    }\n\n    /**\n     * 头部出队\n     * @return [type] [description]\n     */\n    public function removeFirst()\n    {\n        return array_shift($this->queue);\n    }\n\n    /**\n     * 清空队列\n     * @return [type] [description]\n     */\n    public function makeEmpty()\n    {\n        unset($this->queue);\n    }\n\n    /**\n     * 获取列头\n     * @return [type] [description]\n     */\n    public function getFirst()\n    {\n        return reset($this->queue);\n    }\n\n    /**\n     * 获取列尾\n     * @return [type] [description]\n     */\n    public function getLast()\n    {\n        return end($this->queue);\n    }\n\n    /**\n     * 获取长度\n     * @return [type] [description]\n     */\n    public function getLength()\n    {\n        return count($this->queue);\n    }\n}\n\n```\n\n\n\n\n\n\n","slug":"算法、逻辑思维","published":1,"updated":"2020-09-11T01:04:35.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza400466wo1hcy0finh","content":"<blockquote>\n<p>真题：请简单描述一下数据结构的特征（stack、heap、list、doubly-linked-list、queue、array(vector)）</p>\n</blockquote>\n<p>考点: 常见数据结构特征</p>\n<a id=\"more\"></a>\n\n<h4 id=\"1-Array-数组\"><a href=\"#1-Array-数组\" class=\"headerlink\" title=\"1. Array 数组\"></a>1. Array 数组</h4><p>数组，最简单而且应用最广泛的数据结构之一</p>\n<p>特性：<b style='color:red'>使用连续的内存来存储，数组中的所有元素必须是相同的类型或类型的衍生（同质数据结构）</b>，元素可以通过下标直接访问</p>\n<h4 id=\"2-LinkedList-链表\"><a href=\"#2-LinkedList-链表\" class=\"headerlink\" title=\"2. LinkedList 链表\"></a>2. LinkedList 链表</h4><p>线性表的一种，最基本、最简单、也是最常用的数据结构</p>\n<p>特性：元素之间的关系是一对一的关系（除了第一个和最后一个元素，其他元素都是首尾相接），有顺序存储结构和链式存储结构两种存储方式</p>\n<h4 id=\"3-Stack-栈\"><a href=\"#3-Stack-栈\" class=\"headerlink\" title=\"3.Stack 栈\"></a>3.Stack 栈</h4><p>和队列相似，一个带有数据存储特性的数据结构</p>\n<p>特性：存储数据是先进后出，栈只有一个出口，只能从栈顶部增加和移除元素</p>\n<h4 id=\"4-Heap-堆\"><a href=\"#4-Heap-堆\" class=\"headerlink\" title=\"4. Heap 堆\"></a>4. Heap 堆</h4><p>一般情况下，堆叫二叉堆，近似完全二叉树的数据结构</p>\n<p>特性：子节点的键值或者索引总是小于它的父节点，每个节点的左右子树又是一个二叉堆，根节点最大的堆叫最大堆或者大根堆，最小的叫最小堆或者小根堆</p>\n<h4 id=\"5-list-线性表\"><a href=\"#5-list-线性表\" class=\"headerlink\" title=\"5. list 线性表\"></a>5. list 线性表</h4><p>由零个或多个数据元素组成的有限序列</p>\n<p>特性：线性表是一个序列，0 个元素够成的线性表是空表，第一个元素无先驱，最后一个元素无后继，其他元素都只有一个先驱和后继，有长度，长度是元素个数，长度有限</p>\n<h4 id=\"6-doubly-linked-list-双向链表\"><a href=\"#6-doubly-linked-list-双向链表\" class=\"headerlink\" title=\"6. doubly-linked-list 双向链表\"></a>6. doubly-linked-list 双向链表</h4><p>特性：每个元素都是一个对象，每个对象有一个关键字 key 和两个指针（next 和 prev）</p>\n<h4 id=\"7-queue-队列\"><a href=\"#7-queue-队列\" class=\"headerlink\" title=\"7. queue 队列\"></a>7. queue 队列</h4><p>特性：先进先出（FIFO），并发中使用，可以安全地将对象从一个任务传给另一个任务</p>\n<h4 id=\"8-set-集合\"><a href=\"#8-set-集合\" class=\"headerlink\" title=\"8. set 集合\"></a>8. set 集合</h4><p>特性：保存不重复的元素</p>\n<h4 id=\"9-map-字典\"><a href=\"#9-map-字典\" class=\"headerlink\" title=\"9. map 字典\"></a>9. map 字典</h4><p>特性：关联数组，也被叫做字典或者键值对</p>\n<h4 id=\"10-graph-图\"><a href=\"#10-graph-图\" class=\"headerlink\" title=\"10. graph 图\"></a>10. graph 图</h4><p>特性：通常使用邻接矩阵和邻接表表示，前者易实现但是对于稀疏矩阵会浪费较多空间，后者使用链表的方式存储信息但是对于图搜索时间复杂度较高</p>\n<h3 id=\"解题方法\"><a href=\"#解题方法\" class=\"headerlink\" title=\"解题方法\"></a>解题方法</h3><p>先理解每种数据结构的特征，有时会遇到让用 PHP 代码实现其中的数据结构，遇到此类题目，先要理解该种数据结构的特性是什么，然后再实现，通常可以使用 PHP 的数组来模拟。</p>\n<p>真题：用 PHP 实现一个双向队列</p>\n<p>队列是一种线性表，按照先进先出的原则进行</p>\n<ul>\n<li>单向队列：只能从头进，从尾出</li>\n<li>双向队列：头尾都可以进出</li>\n</ul>\n<p>PHP 有四个数组方法可以实现</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Deque</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $queue = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 尾部入对</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> [type] $value [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addLast</span>(<span class=\"params\">$value</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_push(<span class=\"keyword\">$this</span>-&gt;queue, $value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 尾部出队</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">removeLast</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_pop(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 头部入队</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> [type] $value [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addFirst</span>(<span class=\"params\">$value</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_unshift(<span class=\"keyword\">$this</span>-&gt;queue, $value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 头部出队</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">removeFirst</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_shift(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 清空队列</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeEmpty</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取列头</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFirst</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> reset(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取列尾</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLast</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> end(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取长度</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLength</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> count(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>真题：请简单描述一下数据结构的特征（stack、heap、list、doubly-linked-list、queue、array(vector)）</p>\n</blockquote>\n<p>考点: 常见数据结构特征</p>","more":"<h4 id=\"1-Array-数组\"><a href=\"#1-Array-数组\" class=\"headerlink\" title=\"1. Array 数组\"></a>1. Array 数组</h4><p>数组，最简单而且应用最广泛的数据结构之一</p>\n<p>特性：<b style='color:red'>使用连续的内存来存储，数组中的所有元素必须是相同的类型或类型的衍生（同质数据结构）</b>，元素可以通过下标直接访问</p>\n<h4 id=\"2-LinkedList-链表\"><a href=\"#2-LinkedList-链表\" class=\"headerlink\" title=\"2. LinkedList 链表\"></a>2. LinkedList 链表</h4><p>线性表的一种，最基本、最简单、也是最常用的数据结构</p>\n<p>特性：元素之间的关系是一对一的关系（除了第一个和最后一个元素，其他元素都是首尾相接），有顺序存储结构和链式存储结构两种存储方式</p>\n<h4 id=\"3-Stack-栈\"><a href=\"#3-Stack-栈\" class=\"headerlink\" title=\"3.Stack 栈\"></a>3.Stack 栈</h4><p>和队列相似，一个带有数据存储特性的数据结构</p>\n<p>特性：存储数据是先进后出，栈只有一个出口，只能从栈顶部增加和移除元素</p>\n<h4 id=\"4-Heap-堆\"><a href=\"#4-Heap-堆\" class=\"headerlink\" title=\"4. Heap 堆\"></a>4. Heap 堆</h4><p>一般情况下，堆叫二叉堆，近似完全二叉树的数据结构</p>\n<p>特性：子节点的键值或者索引总是小于它的父节点，每个节点的左右子树又是一个二叉堆，根节点最大的堆叫最大堆或者大根堆，最小的叫最小堆或者小根堆</p>\n<h4 id=\"5-list-线性表\"><a href=\"#5-list-线性表\" class=\"headerlink\" title=\"5. list 线性表\"></a>5. list 线性表</h4><p>由零个或多个数据元素组成的有限序列</p>\n<p>特性：线性表是一个序列，0 个元素够成的线性表是空表，第一个元素无先驱，最后一个元素无后继，其他元素都只有一个先驱和后继，有长度，长度是元素个数，长度有限</p>\n<h4 id=\"6-doubly-linked-list-双向链表\"><a href=\"#6-doubly-linked-list-双向链表\" class=\"headerlink\" title=\"6. doubly-linked-list 双向链表\"></a>6. doubly-linked-list 双向链表</h4><p>特性：每个元素都是一个对象，每个对象有一个关键字 key 和两个指针（next 和 prev）</p>\n<h4 id=\"7-queue-队列\"><a href=\"#7-queue-队列\" class=\"headerlink\" title=\"7. queue 队列\"></a>7. queue 队列</h4><p>特性：先进先出（FIFO），并发中使用，可以安全地将对象从一个任务传给另一个任务</p>\n<h4 id=\"8-set-集合\"><a href=\"#8-set-集合\" class=\"headerlink\" title=\"8. set 集合\"></a>8. set 集合</h4><p>特性：保存不重复的元素</p>\n<h4 id=\"9-map-字典\"><a href=\"#9-map-字典\" class=\"headerlink\" title=\"9. map 字典\"></a>9. map 字典</h4><p>特性：关联数组，也被叫做字典或者键值对</p>\n<h4 id=\"10-graph-图\"><a href=\"#10-graph-图\" class=\"headerlink\" title=\"10. graph 图\"></a>10. graph 图</h4><p>特性：通常使用邻接矩阵和邻接表表示，前者易实现但是对于稀疏矩阵会浪费较多空间，后者使用链表的方式存储信息但是对于图搜索时间复杂度较高</p>\n<h3 id=\"解题方法\"><a href=\"#解题方法\" class=\"headerlink\" title=\"解题方法\"></a>解题方法</h3><p>先理解每种数据结构的特征，有时会遇到让用 PHP 代码实现其中的数据结构，遇到此类题目，先要理解该种数据结构的特性是什么，然后再实现，通常可以使用 PHP 的数组来模拟。</p>\n<p>真题：用 PHP 实现一个双向队列</p>\n<p>队列是一种线性表，按照先进先出的原则进行</p>\n<ul>\n<li>单向队列：只能从头进，从尾出</li>\n<li>双向队列：头尾都可以进出</li>\n</ul>\n<p>PHP 有四个数组方法可以实现</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Deque</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> $queue = <span class=\"keyword\">array</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 尾部入对</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> [type] $value [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addLast</span>(<span class=\"params\">$value</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_push(<span class=\"keyword\">$this</span>-&gt;queue, $value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 尾部出队</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">removeLast</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_pop(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 头部入队</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> [type] $value [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addFirst</span>(<span class=\"params\">$value</span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_unshift(<span class=\"keyword\">$this</span>-&gt;queue, $value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 头部出队</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">removeFirst</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> array_shift(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 清空队列</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeEmpty</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">unset</span>(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取列头</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFirst</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> reset(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取列尾</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLast</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> end(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取长度</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> [type] [description]</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLength</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> count(<span class=\"keyword\">$this</span>-&gt;queue);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>"},{"title":"算法、逻辑思维2","date":"2018-02-17T07:40:51.000Z","_content":"\n### 算法\n> 真题：1，1，2，3，5，8，13，21，34... 求第 30 位的数是多少，请用伪代码描述其实现方法\n\n考点：逻辑思维能力\n\n解题方法：找到要处理的数组或者字符串的规律，也可以是一个数列的规律，如果要求使用伪代码实现，建议先说明规律，然后白话说明解题步骤即可。\n\n<!--more-->\n\n``` php\n<?php\n$arr = [1, 1];\nfor ($i = 2; $i < 30; ++$i) {\n\t$arr[$i] = $arr[$i - 1] + $arr[$i - 2];\n}\n\nvar_dump($arr);\n```\n\n> 真题：请写一个函数，实现以下功能：字符串 \"open_door\" 转换成 \"OpenDoor\"，\"make_by_id\" 转换成 \"MakeById\"\n\n分割--首字母大写--合并\n\n``` php\n<?php\nfunction strConvert($str) {\n\t$returnData = '';\n\t$arr = explode('_', $str);\n\tforeach ($arr as $value) {\n\t\t$returnData .= ucfirst($value);\n\t}\n\treturn $returnData;\n}\n```\n\n### 模拟内置函数\n\n真题：不使用 PHP 函数，用方法写一个反转字符串的方法\n\n考点：逻辑思维能力；对 PHP 内置函数的熟悉程度；<b style='color:red'>字符串和数组</b>的处理能力\n\n<b style='color:red'>把字符串直接当成数组来处理</b>\n\n``` php\n<?php\nfunction strReverse($str) {\n\t// 自己实现字符串长度的统计，不能使用 strlen()\n\tfor ($i = 0; true; ++$i) {\n\t\tif (!isset($str[$i])) {\n\t\t\tbreak;\n\t\t}\n\t}\t\n\n\t$returnData = '';\n\tfor ($j = $i - 1; $j >= 0; --$j) {\n\t\t$returnData .= $str[$j];\n\t}\n\treturn $returnData;\n}\n```\n\n> 真题：写一个函数，要求不使用 array_merge 完成多个数组的合并\n\n``` php\nfunction arrMerge() {\n\treturnData = [];\n\t$arrays = func_get_args();\n\tforeach ($arrays as $arr) {\n\t\tif (is_array($arr)) {\n\t\t\tforeach ($arr as $value) {\n\t\t\t\t$returnData[] = $value;\n\t\t\t}\n\t\t}\n\t}\n\treturn $returnData;\n}\n```\n","source":"_posts/算法、逻辑思维2.md","raw":"---\ntitle: 算法、逻辑思维2\ndate: 2018-02-17 15:40:51\ntags: 算法\n---\n\n### 算法\n> 真题：1，1，2，3，5，8，13，21，34... 求第 30 位的数是多少，请用伪代码描述其实现方法\n\n考点：逻辑思维能力\n\n解题方法：找到要处理的数组或者字符串的规律，也可以是一个数列的规律，如果要求使用伪代码实现，建议先说明规律，然后白话说明解题步骤即可。\n\n<!--more-->\n\n``` php\n<?php\n$arr = [1, 1];\nfor ($i = 2; $i < 30; ++$i) {\n\t$arr[$i] = $arr[$i - 1] + $arr[$i - 2];\n}\n\nvar_dump($arr);\n```\n\n> 真题：请写一个函数，实现以下功能：字符串 \"open_door\" 转换成 \"OpenDoor\"，\"make_by_id\" 转换成 \"MakeById\"\n\n分割--首字母大写--合并\n\n``` php\n<?php\nfunction strConvert($str) {\n\t$returnData = '';\n\t$arr = explode('_', $str);\n\tforeach ($arr as $value) {\n\t\t$returnData .= ucfirst($value);\n\t}\n\treturn $returnData;\n}\n```\n\n### 模拟内置函数\n\n真题：不使用 PHP 函数，用方法写一个反转字符串的方法\n\n考点：逻辑思维能力；对 PHP 内置函数的熟悉程度；<b style='color:red'>字符串和数组</b>的处理能力\n\n<b style='color:red'>把字符串直接当成数组来处理</b>\n\n``` php\n<?php\nfunction strReverse($str) {\n\t// 自己实现字符串长度的统计，不能使用 strlen()\n\tfor ($i = 0; true; ++$i) {\n\t\tif (!isset($str[$i])) {\n\t\t\tbreak;\n\t\t}\n\t}\t\n\n\t$returnData = '';\n\tfor ($j = $i - 1; $j >= 0; --$j) {\n\t\t$returnData .= $str[$j];\n\t}\n\treturn $returnData;\n}\n```\n\n> 真题：写一个函数，要求不使用 array_merge 完成多个数组的合并\n\n``` php\nfunction arrMerge() {\n\treturnData = [];\n\t$arrays = func_get_args();\n\tforeach ($arrays as $arr) {\n\t\tif (is_array($arr)) {\n\t\t\tforeach ($arr as $value) {\n\t\t\t\t$returnData[] = $value;\n\t\t\t}\n\t\t}\n\t}\n\treturn $returnData;\n}\n```\n","slug":"算法、逻辑思维2","published":1,"updated":"2020-09-11T01:04:35.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza6004a6wo11yrafezk","content":"<h3 id=\"算法\"><a href=\"#算法\" class=\"headerlink\" title=\"算法\"></a>算法</h3><blockquote>\n<p>真题：1，1，2，3，5，8，13，21，34… 求第 30 位的数是多少，请用伪代码描述其实现方法</p>\n</blockquote>\n<p>考点：逻辑思维能力</p>\n<p>解题方法：找到要处理的数组或者字符串的规律，也可以是一个数列的规律，如果要求使用伪代码实现，建议先说明规律，然后白话说明解题步骤即可。</p>\n<a id=\"more\"></a>\n\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$arr = [<span class=\"number\">1</span>, <span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">2</span>; $i &lt; <span class=\"number\">30</span>; ++$i) &#123;</span><br><span class=\"line\">\t$arr[$i] = $arr[$i - <span class=\"number\">1</span>] + $arr[$i - <span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump($arr);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>真题：请写一个函数，实现以下功能：字符串 “open_door” 转换成 “OpenDoor”，”make_by_id” 转换成 “MakeById”</p>\n</blockquote>\n<p>分割–首字母大写–合并</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strConvert</span>(<span class=\"params\">$str</span>) </span>&#123;</span><br><span class=\"line\">\t$returnData = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">\t$arr = explode(<span class=\"string\">&#x27;_&#x27;</span>, $str);</span><br><span class=\"line\">\t<span class=\"keyword\">foreach</span> ($arr <span class=\"keyword\">as</span> $value) &#123;</span><br><span class=\"line\">\t\t$returnData .= ucfirst($value);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模拟内置函数\"><a href=\"#模拟内置函数\" class=\"headerlink\" title=\"模拟内置函数\"></a>模拟内置函数</h3><p>真题：不使用 PHP 函数，用方法写一个反转字符串的方法</p>\n<p>考点：逻辑思维能力；对 PHP 内置函数的熟悉程度；<b style='color:red'>字符串和数组</b>的处理能力</p>\n<p><b style='color:red'>把字符串直接当成数组来处理</b></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strReverse</span>(<span class=\"params\">$str</span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 自己实现字符串长度的统计，不能使用 strlen()</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; <span class=\"literal\">true</span>; ++$i) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>($str[$i])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t$returnData = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ($j = $i - <span class=\"number\">1</span>; $j &gt;= <span class=\"number\">0</span>; --$j) &#123;</span><br><span class=\"line\">\t\t$returnData .= $str[$j];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>真题：写一个函数，要求不使用 array_merge 完成多个数组的合并</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arrMerge</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\treturnData = [];</span><br><span class=\"line\">\t$arrays = func_get_args();</span><br><span class=\"line\">\t<span class=\"keyword\">foreach</span> ($arrays <span class=\"keyword\">as</span> $arr) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_array($arr)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">foreach</span> ($arr <span class=\"keyword\">as</span> $value) &#123;</span><br><span class=\"line\">\t\t\t\t$returnData[] = $value;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h3 id=\"算法\"><a href=\"#算法\" class=\"headerlink\" title=\"算法\"></a>算法</h3><blockquote>\n<p>真题：1，1，2，3，5，8，13，21，34… 求第 30 位的数是多少，请用伪代码描述其实现方法</p>\n</blockquote>\n<p>考点：逻辑思维能力</p>\n<p>解题方法：找到要处理的数组或者字符串的规律，也可以是一个数列的规律，如果要求使用伪代码实现，建议先说明规律，然后白话说明解题步骤即可。</p>","more":"<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$arr = [<span class=\"number\">1</span>, <span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">2</span>; $i &lt; <span class=\"number\">30</span>; ++$i) &#123;</span><br><span class=\"line\">\t$arr[$i] = $arr[$i - <span class=\"number\">1</span>] + $arr[$i - <span class=\"number\">2</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">var_dump($arr);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>真题：请写一个函数，实现以下功能：字符串 “open_door” 转换成 “OpenDoor”，”make_by_id” 转换成 “MakeById”</p>\n</blockquote>\n<p>分割–首字母大写–合并</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strConvert</span>(<span class=\"params\">$str</span>) </span>&#123;</span><br><span class=\"line\">\t$returnData = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">\t$arr = explode(<span class=\"string\">&#x27;_&#x27;</span>, $str);</span><br><span class=\"line\">\t<span class=\"keyword\">foreach</span> ($arr <span class=\"keyword\">as</span> $value) &#123;</span><br><span class=\"line\">\t\t$returnData .= ucfirst($value);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"模拟内置函数\"><a href=\"#模拟内置函数\" class=\"headerlink\" title=\"模拟内置函数\"></a>模拟内置函数</h3><p>真题：不使用 PHP 函数，用方法写一个反转字符串的方法</p>\n<p>考点：逻辑思维能力；对 PHP 内置函数的熟悉程度；<b style='color:red'>字符串和数组</b>的处理能力</p>\n<p><b style='color:red'>把字符串直接当成数组来处理</b></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">strReverse</span>(<span class=\"params\">$str</span>) </span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 自己实现字符串长度的统计，不能使用 strlen()</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; <span class=\"literal\">true</span>; ++$i) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>($str[$i])) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t$returnData = <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> ($j = $i - <span class=\"number\">1</span>; $j &gt;= <span class=\"number\">0</span>; --$j) &#123;</span><br><span class=\"line\">\t\t$returnData .= $str[$j];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>真题：写一个函数，要求不使用 array_merge 完成多个数组的合并</p>\n</blockquote>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">arrMerge</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\treturnData = [];</span><br><span class=\"line\">\t$arrays = func_get_args();</span><br><span class=\"line\">\t<span class=\"keyword\">foreach</span> ($arrays <span class=\"keyword\">as</span> $arr) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (is_array($arr)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">foreach</span> ($arr <span class=\"keyword\">as</span> $value) &#123;</span><br><span class=\"line\">\t\t\t\t$returnData[] = $value;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> $returnData;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"程序功能设计","date":"2018-02-16T09:55:04.000Z","_content":"\n> 真题：编写一个在线留言本，实现用户的在线留言功能，留言信息存储到数据库，要求设计数据表内容以及使用 PHP 编码完成。\n\n考点：\n\n- 数据表设计\n- 数据表创建语句\n- PHP 连接数据库的方式\n- 编码能力\n\n<!-- more -->\n\n#### 1. 分析数据表结构\n\n留言本有哪些信息需要存储\n\n留言信息： ID，留言标题，留言内容，留言时间，留言人\n\n``` mysql\nCREATE TABLE message (\n`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,\n`title` VARCHAR(120) NOT NULL DEFAULT '',\n`content` VARCHAR(255) NOT NULL DEFAULT '',\n`created_at` INT NOT NULL DEFAULT 0,\n`user_name` VARCHAR(32) NOT NULL DEFAULT ''\nKEY message_user_name(user_name)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n\n#### 2. PHP 连接数据库的方式\n\n- PDO：可扩展性更好、支持预处理、面向对象。建议使用，扩展性好，之后切换其他数据库方便，方法完善\n- MySQLi：只支持 MySQL 操作、支持预处理、面向对象和过程、效率更高\n- mysql：只支持 MySQL 数据库，没有预处理的支持、面向过程\n\n\nPDO 的基本操作\n\n``` php\n<?php\ntry {\n\t// 操作数据库的代码\n} catch (PDOException $e) {\n\techo $e->getMessage();\n}\n```\n\n操作数据库的代码\n``` php\n<?php\n$pdo = new PDO($dsn, $username, $password, $attr);\n$sql = 'SELECT id, title, content FROM message where user_name=:user_name';\n$stmt = $pdo->prepare($sql);\n$stmt->execute([':user_name' => $user_name]);\n$result = $stmt->fetchAll(PDO::FETCH_ASSOC);\n```\n\n#### 3. 解题方法\n\n根据考题给出的功能，先分析应该存储哪些信息，设计好数据表，这一步很关键，如果编码时才发现设计有问题，会浪费大量的时间，基本没有时间改，所以要先设计好，然后根据设计好的数据表创建数据表语句，通常建议使用 PDO 来连接 MySQL，最终完成编码，所以一定要熟悉 PDO 的操作。\n\n示例\n\n``` php\n<?php\ntry {\n\t$dsn = 'mysql:dbname=test;host=localhost';\n\t$username = 'test';\n\t$password = 'test';\n\t$attr = [\n\t\tPDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION\n\t];\n\t$pdo = new PDO($dsn, $username, $password, $attr);\n\t$sql = 'insert into message(title, content, created_at, user_name) values(:title, :content. :created_at, :user_name)';\n\t$stmt = $pdo->prepare($sql);\n\t$data = [\n\t\t':title' => $title,\n\t\t':content' => $content,\n\t\t':created_at' => time(),\n\t\t'user_name' => $user_name\n\t];\n\t$stmt->execute($data);\n\t$rows = $stmt->rowCount();\n\tif ($rows) {\n\t\texit('执行成功');\n\t} else {\n\t\texit('执行失败');\n\t}\n} catch (PDOException $e) {\n\techo $e->getMessage();\n}\n```\n\n#### 4. 真题：设计一个无限分类表\n\n``` mysql\nCREATE TABLE message (\n`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,\n`title` VARCHAR(120) NOT NULL DEFAULT '',\n`pid` INT NOT NULL DEFAULT 0,\n`path` VARCHAR NOT NULL DEFAULT ''\nKEY message_user_name(user_name)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-16/13030217.jpg)\n\n\n","source":"_posts/程序功能设计.md","raw":"---\ntitle: 程序功能设计\ndate: 2018-02-16 17:55:04\ntags: \n---\n\n> 真题：编写一个在线留言本，实现用户的在线留言功能，留言信息存储到数据库，要求设计数据表内容以及使用 PHP 编码完成。\n\n考点：\n\n- 数据表设计\n- 数据表创建语句\n- PHP 连接数据库的方式\n- 编码能力\n\n<!-- more -->\n\n#### 1. 分析数据表结构\n\n留言本有哪些信息需要存储\n\n留言信息： ID，留言标题，留言内容，留言时间，留言人\n\n``` mysql\nCREATE TABLE message (\n`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,\n`title` VARCHAR(120) NOT NULL DEFAULT '',\n`content` VARCHAR(255) NOT NULL DEFAULT '',\n`created_at` INT NOT NULL DEFAULT 0,\n`user_name` VARCHAR(32) NOT NULL DEFAULT ''\nKEY message_user_name(user_name)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n\n#### 2. PHP 连接数据库的方式\n\n- PDO：可扩展性更好、支持预处理、面向对象。建议使用，扩展性好，之后切换其他数据库方便，方法完善\n- MySQLi：只支持 MySQL 操作、支持预处理、面向对象和过程、效率更高\n- mysql：只支持 MySQL 数据库，没有预处理的支持、面向过程\n\n\nPDO 的基本操作\n\n``` php\n<?php\ntry {\n\t// 操作数据库的代码\n} catch (PDOException $e) {\n\techo $e->getMessage();\n}\n```\n\n操作数据库的代码\n``` php\n<?php\n$pdo = new PDO($dsn, $username, $password, $attr);\n$sql = 'SELECT id, title, content FROM message where user_name=:user_name';\n$stmt = $pdo->prepare($sql);\n$stmt->execute([':user_name' => $user_name]);\n$result = $stmt->fetchAll(PDO::FETCH_ASSOC);\n```\n\n#### 3. 解题方法\n\n根据考题给出的功能，先分析应该存储哪些信息，设计好数据表，这一步很关键，如果编码时才发现设计有问题，会浪费大量的时间，基本没有时间改，所以要先设计好，然后根据设计好的数据表创建数据表语句，通常建议使用 PDO 来连接 MySQL，最终完成编码，所以一定要熟悉 PDO 的操作。\n\n示例\n\n``` php\n<?php\ntry {\n\t$dsn = 'mysql:dbname=test;host=localhost';\n\t$username = 'test';\n\t$password = 'test';\n\t$attr = [\n\t\tPDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION\n\t];\n\t$pdo = new PDO($dsn, $username, $password, $attr);\n\t$sql = 'insert into message(title, content, created_at, user_name) values(:title, :content. :created_at, :user_name)';\n\t$stmt = $pdo->prepare($sql);\n\t$data = [\n\t\t':title' => $title,\n\t\t':content' => $content,\n\t\t':created_at' => time(),\n\t\t'user_name' => $user_name\n\t];\n\t$stmt->execute($data);\n\t$rows = $stmt->rowCount();\n\tif ($rows) {\n\t\texit('执行成功');\n\t} else {\n\t\texit('执行失败');\n\t}\n} catch (PDOException $e) {\n\techo $e->getMessage();\n}\n```\n\n#### 4. 真题：设计一个无限分类表\n\n``` mysql\nCREATE TABLE message (\n`id` INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,\n`title` VARCHAR(120) NOT NULL DEFAULT '',\n`pid` INT NOT NULL DEFAULT 0,\n`path` VARCHAR NOT NULL DEFAULT ''\nKEY message_user_name(user_name)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n```\n\n![](http://omp48p40q.bkt.clouddn.com/18-2-16/13030217.jpg)\n\n\n","slug":"程序功能设计","published":1,"updated":"2020-09-11T01:04:35.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza7004d6wo14jy0ebmt","content":"<blockquote>\n<p>真题：编写一个在线留言本，实现用户的在线留言功能，留言信息存储到数据库，要求设计数据表内容以及使用 PHP 编码完成。</p>\n</blockquote>\n<p>考点：</p>\n<ul>\n<li>数据表设计</li>\n<li>数据表创建语句</li>\n<li>PHP 连接数据库的方式</li>\n<li>编码能力</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"1-分析数据表结构\"><a href=\"#1-分析数据表结构\" class=\"headerlink\" title=\"1. 分析数据表结构\"></a>1. 分析数据表结构</h4><p>留言本有哪些信息需要存储</p>\n<p>留言信息： ID，留言标题，留言内容，留言时间，留言人</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE message (</span><br><span class=\"line\">&#96;id&#96; INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">&#96;title&#96; VARCHAR(120) NOT NULL DEFAULT &#39;&#39;,</span><br><span class=\"line\">&#96;content&#96; VARCHAR(255) NOT NULL DEFAULT &#39;&#39;,</span><br><span class=\"line\">&#96;created_at&#96; INT NOT NULL DEFAULT 0,</span><br><span class=\"line\">&#96;user_name&#96; VARCHAR(32) NOT NULL DEFAULT &#39;&#39;</span><br><span class=\"line\">KEY message_user_name(user_name)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-PHP-连接数据库的方式\"><a href=\"#2-PHP-连接数据库的方式\" class=\"headerlink\" title=\"2. PHP 连接数据库的方式\"></a>2. PHP 连接数据库的方式</h4><ul>\n<li>PDO：可扩展性更好、支持预处理、面向对象。建议使用，扩展性好，之后切换其他数据库方便，方法完善</li>\n<li>MySQLi：只支持 MySQL 操作、支持预处理、面向对象和过程、效率更高</li>\n<li>mysql：只支持 MySQL 数据库，没有预处理的支持、面向过程</li>\n</ul>\n<p>PDO 的基本操作</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 操作数据库的代码</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (PDOException $e) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>操作数据库的代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$pdo = <span class=\"keyword\">new</span> PDO($dsn, $username, $password, $attr);</span><br><span class=\"line\">$sql = <span class=\"string\">&#x27;SELECT id, title, content FROM message where user_name=:user_name&#x27;</span>;</span><br><span class=\"line\">$stmt = $pdo-&gt;prepare($sql);</span><br><span class=\"line\">$stmt-&gt;execute([<span class=\"string\">&#x27;:user_name&#x27;</span> =&gt; $user_name]);</span><br><span class=\"line\">$result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-解题方法\"><a href=\"#3-解题方法\" class=\"headerlink\" title=\"3. 解题方法\"></a>3. 解题方法</h4><p>根据考题给出的功能，先分析应该存储哪些信息，设计好数据表，这一步很关键，如果编码时才发现设计有问题，会浪费大量的时间，基本没有时间改，所以要先设计好，然后根据设计好的数据表创建数据表语句，通常建议使用 PDO 来连接 MySQL，最终完成编码，所以一定要熟悉 PDO 的操作。</p>\n<p>示例</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t$dsn = <span class=\"string\">&#x27;mysql:dbname=test;host=localhost&#x27;</span>;</span><br><span class=\"line\">\t$username = <span class=\"string\">&#x27;test&#x27;</span>;</span><br><span class=\"line\">\t$password = <span class=\"string\">&#x27;test&#x27;</span>;</span><br><span class=\"line\">\t$attr = [</span><br><span class=\"line\">\t\tPDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION</span><br><span class=\"line\">\t];</span><br><span class=\"line\">\t$pdo = <span class=\"keyword\">new</span> PDO($dsn, $username, $password, $attr);</span><br><span class=\"line\">\t$sql = <span class=\"string\">&#x27;insert into message(title, content, created_at, user_name) values(:title, :content. :created_at, :user_name)&#x27;</span>;</span><br><span class=\"line\">\t$stmt = $pdo-&gt;prepare($sql);</span><br><span class=\"line\">\t$data = [</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;:title&#x27;</span> =&gt; $title,</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;:content&#x27;</span> =&gt; $content,</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;:created_at&#x27;</span> =&gt; time(),</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;user_name&#x27;</span> =&gt; $user_name</span><br><span class=\"line\">\t];</span><br><span class=\"line\">\t$stmt-&gt;execute($data);</span><br><span class=\"line\">\t$rows = $stmt-&gt;rowCount();</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ($rows) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">&#x27;执行成功&#x27;</span>);</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">&#x27;执行失败&#x27;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (PDOException $e) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-真题：设计一个无限分类表\"><a href=\"#4-真题：设计一个无限分类表\" class=\"headerlink\" title=\"4. 真题：设计一个无限分类表\"></a>4. 真题：设计一个无限分类表</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE message (</span><br><span class=\"line\">&#96;id&#96; INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">&#96;title&#96; VARCHAR(120) NOT NULL DEFAULT &#39;&#39;,</span><br><span class=\"line\">&#96;pid&#96; INT NOT NULL DEFAULT 0,</span><br><span class=\"line\">&#96;path&#96; VARCHAR NOT NULL DEFAULT &#39;&#39;</span><br><span class=\"line\">KEY message_user_name(user_name)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-2-16/13030217.jpg\"></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>真题：编写一个在线留言本，实现用户的在线留言功能，留言信息存储到数据库，要求设计数据表内容以及使用 PHP 编码完成。</p>\n</blockquote>\n<p>考点：</p>\n<ul>\n<li>数据表设计</li>\n<li>数据表创建语句</li>\n<li>PHP 连接数据库的方式</li>\n<li>编码能力</li>\n</ul>","more":"<h4 id=\"1-分析数据表结构\"><a href=\"#1-分析数据表结构\" class=\"headerlink\" title=\"1. 分析数据表结构\"></a>1. 分析数据表结构</h4><p>留言本有哪些信息需要存储</p>\n<p>留言信息： ID，留言标题，留言内容，留言时间，留言人</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE message (</span><br><span class=\"line\">&#96;id&#96; INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">&#96;title&#96; VARCHAR(120) NOT NULL DEFAULT &#39;&#39;,</span><br><span class=\"line\">&#96;content&#96; VARCHAR(255) NOT NULL DEFAULT &#39;&#39;,</span><br><span class=\"line\">&#96;created_at&#96; INT NOT NULL DEFAULT 0,</span><br><span class=\"line\">&#96;user_name&#96; VARCHAR(32) NOT NULL DEFAULT &#39;&#39;</span><br><span class=\"line\">KEY message_user_name(user_name)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-PHP-连接数据库的方式\"><a href=\"#2-PHP-连接数据库的方式\" class=\"headerlink\" title=\"2. PHP 连接数据库的方式\"></a>2. PHP 连接数据库的方式</h4><ul>\n<li>PDO：可扩展性更好、支持预处理、面向对象。建议使用，扩展性好，之后切换其他数据库方便，方法完善</li>\n<li>MySQLi：只支持 MySQL 操作、支持预处理、面向对象和过程、效率更高</li>\n<li>mysql：只支持 MySQL 数据库，没有预处理的支持、面向过程</li>\n</ul>\n<p>PDO 的基本操作</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 操作数据库的代码</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (PDOException $e) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>操作数据库的代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$pdo = <span class=\"keyword\">new</span> PDO($dsn, $username, $password, $attr);</span><br><span class=\"line\">$sql = <span class=\"string\">&#x27;SELECT id, title, content FROM message where user_name=:user_name&#x27;</span>;</span><br><span class=\"line\">$stmt = $pdo-&gt;prepare($sql);</span><br><span class=\"line\">$stmt-&gt;execute([<span class=\"string\">&#x27;:user_name&#x27;</span> =&gt; $user_name]);</span><br><span class=\"line\">$result = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-解题方法\"><a href=\"#3-解题方法\" class=\"headerlink\" title=\"3. 解题方法\"></a>3. 解题方法</h4><p>根据考题给出的功能，先分析应该存储哪些信息，设计好数据表，这一步很关键，如果编码时才发现设计有问题，会浪费大量的时间，基本没有时间改，所以要先设计好，然后根据设计好的数据表创建数据表语句，通常建议使用 PDO 来连接 MySQL，最终完成编码，所以一定要熟悉 PDO 的操作。</p>\n<p>示例</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t$dsn = <span class=\"string\">&#x27;mysql:dbname=test;host=localhost&#x27;</span>;</span><br><span class=\"line\">\t$username = <span class=\"string\">&#x27;test&#x27;</span>;</span><br><span class=\"line\">\t$password = <span class=\"string\">&#x27;test&#x27;</span>;</span><br><span class=\"line\">\t$attr = [</span><br><span class=\"line\">\t\tPDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION</span><br><span class=\"line\">\t];</span><br><span class=\"line\">\t$pdo = <span class=\"keyword\">new</span> PDO($dsn, $username, $password, $attr);</span><br><span class=\"line\">\t$sql = <span class=\"string\">&#x27;insert into message(title, content, created_at, user_name) values(:title, :content. :created_at, :user_name)&#x27;</span>;</span><br><span class=\"line\">\t$stmt = $pdo-&gt;prepare($sql);</span><br><span class=\"line\">\t$data = [</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;:title&#x27;</span> =&gt; $title,</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;:content&#x27;</span> =&gt; $content,</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;:created_at&#x27;</span> =&gt; time(),</span><br><span class=\"line\">\t\t<span class=\"string\">&#x27;user_name&#x27;</span> =&gt; $user_name</span><br><span class=\"line\">\t];</span><br><span class=\"line\">\t$stmt-&gt;execute($data);</span><br><span class=\"line\">\t$rows = $stmt-&gt;rowCount();</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ($rows) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">&#x27;执行成功&#x27;</span>);</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>(<span class=\"string\">&#x27;执行失败&#x27;</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (PDOException $e) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">echo</span> $e-&gt;getMessage();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-真题：设计一个无限分类表\"><a href=\"#4-真题：设计一个无限分类表\" class=\"headerlink\" title=\"4. 真题：设计一个无限分类表\"></a>4. 真题：设计一个无限分类表</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CREATE TABLE message (</span><br><span class=\"line\">&#96;id&#96; INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,</span><br><span class=\"line\">&#96;title&#96; VARCHAR(120) NOT NULL DEFAULT &#39;&#39;,</span><br><span class=\"line\">&#96;pid&#96; INT NOT NULL DEFAULT 0,</span><br><span class=\"line\">&#96;path&#96; VARCHAR NOT NULL DEFAULT &#39;&#39;</span><br><span class=\"line\">KEY message_user_name(user_name)</span><br><span class=\"line\">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/18-2-16/13030217.jpg\"></p>"},{"title":"配置和使用-Xdebug-方法二","date":"2017-02-03T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-33e6d9872c86262a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\n# 前提\n\n基本配置参见前一篇[《配置和使用 Xdebug (Laravel + Homestead + Xdebug)》](http://www.jianshu.com/p/3a3db0359bc7)\n\n# 不同\nxdebug.so 文件的内容改为：\n```\nzend_extension=\"/usr/lib/php/20151012/xdebug.so\"\nxdebug.idekey=\"PHPSTORM\"\nxdebug.profiler_append = 0\nxdebug.profiler_enable = off\nxdebug.profiler_enable_trigger = off\nxdebug.profiler_output_dir = \"/tmp\"\nxdebug.profiler_output_name = \"cachegrind.out.%t-%s\"\nxdebug.remote_enable = on\nxdebug.remote_handler = \"dbgp\"\nxdebug.remote_host = \"127.0.0.1\"\nxdebug.trace_output_dir = \"/tmp\"\nxdebug.remote_connect_back = On\nxdebug.remote_port=9000\nxdebug.auto_trace=off\nxdebug.default_enable=on\nxdebug.collect_params=4\nxdebug.collect_return=on\nxdebug.show_exception_trace=On\nxdebug.max_nesting_level = 10000\n```\n\n# 安装 Chrome 的 Xdebug Helper 插件\n\n# 使用\n1. 打断点\n2. 点击 phpstorm 的电话图标，开始监听\n3. Chrome 中，enable Xdebug Helper 插件\n4. 点击页面至断点所在位置，开始调试\n\n切换项目以及操作不当等可能导致PHP服务崩溃或系统崩溃，此时需重启PHP服务或系统，很蛋疼。\n个人更喜欢方法一\n以上配置方法一也可以完美运行\n\n\n","source":"_posts/配置和使用-Xdebug-方法二.md","raw":"---\ntitle: 配置和使用-Xdebug-方法二\ndate: 2017-02-04\ntags: xdebug\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-33e6d9872c86262a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n<!--more-->\n# 前提\n\n基本配置参见前一篇[《配置和使用 Xdebug (Laravel + Homestead + Xdebug)》](http://www.jianshu.com/p/3a3db0359bc7)\n\n# 不同\nxdebug.so 文件的内容改为：\n```\nzend_extension=\"/usr/lib/php/20151012/xdebug.so\"\nxdebug.idekey=\"PHPSTORM\"\nxdebug.profiler_append = 0\nxdebug.profiler_enable = off\nxdebug.profiler_enable_trigger = off\nxdebug.profiler_output_dir = \"/tmp\"\nxdebug.profiler_output_name = \"cachegrind.out.%t-%s\"\nxdebug.remote_enable = on\nxdebug.remote_handler = \"dbgp\"\nxdebug.remote_host = \"127.0.0.1\"\nxdebug.trace_output_dir = \"/tmp\"\nxdebug.remote_connect_back = On\nxdebug.remote_port=9000\nxdebug.auto_trace=off\nxdebug.default_enable=on\nxdebug.collect_params=4\nxdebug.collect_return=on\nxdebug.show_exception_trace=On\nxdebug.max_nesting_level = 10000\n```\n\n# 安装 Chrome 的 Xdebug Helper 插件\n\n# 使用\n1. 打断点\n2. 点击 phpstorm 的电话图标，开始监听\n3. Chrome 中，enable Xdebug Helper 插件\n4. 点击页面至断点所在位置，开始调试\n\n切换项目以及操作不当等可能导致PHP服务崩溃或系统崩溃，此时需重启PHP服务或系统，很蛋疼。\n个人更喜欢方法一\n以上配置方法一也可以完美运行\n\n\n","slug":"配置和使用-Xdebug-方法二","published":1,"updated":"2020-09-11T01:04:35.053Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtza9004g6wo16y2lba7x","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-33e6d9872c86262a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<a id=\"more\"></a>\n<h1 id=\"前提\"><a href=\"#前提\" class=\"headerlink\" title=\"前提\"></a>前提</h1><p>基本配置参见前一篇<a href=\"http://www.jianshu.com/p/3a3db0359bc7\">《配置和使用 Xdebug (Laravel + Homestead + Xdebug)》</a></p>\n<h1 id=\"不同\"><a href=\"#不同\" class=\"headerlink\" title=\"不同\"></a>不同</h1><p>xdebug.so 文件的内容改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zend_extension&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;php&#x2F;20151012&#x2F;xdebug.so&quot;</span><br><span class=\"line\">xdebug.idekey&#x3D;&quot;PHPSTORM&quot;</span><br><span class=\"line\">xdebug.profiler_append &#x3D; 0</span><br><span class=\"line\">xdebug.profiler_enable &#x3D; off</span><br><span class=\"line\">xdebug.profiler_enable_trigger &#x3D; off</span><br><span class=\"line\">xdebug.profiler_output_dir &#x3D; &quot;&#x2F;tmp&quot;</span><br><span class=\"line\">xdebug.profiler_output_name &#x3D; &quot;cachegrind.out.%t-%s&quot;</span><br><span class=\"line\">xdebug.remote_enable &#x3D; on</span><br><span class=\"line\">xdebug.remote_handler &#x3D; &quot;dbgp&quot;</span><br><span class=\"line\">xdebug.remote_host &#x3D; &quot;127.0.0.1&quot;</span><br><span class=\"line\">xdebug.trace_output_dir &#x3D; &quot;&#x2F;tmp&quot;</span><br><span class=\"line\">xdebug.remote_connect_back &#x3D; On</span><br><span class=\"line\">xdebug.remote_port&#x3D;9000</span><br><span class=\"line\">xdebug.auto_trace&#x3D;off</span><br><span class=\"line\">xdebug.default_enable&#x3D;on</span><br><span class=\"line\">xdebug.collect_params&#x3D;4</span><br><span class=\"line\">xdebug.collect_return&#x3D;on</span><br><span class=\"line\">xdebug.show_exception_trace&#x3D;On</span><br><span class=\"line\">xdebug.max_nesting_level &#x3D; 10000</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装-Chrome-的-Xdebug-Helper-插件\"><a href=\"#安装-Chrome-的-Xdebug-Helper-插件\" class=\"headerlink\" title=\"安装 Chrome 的 Xdebug Helper 插件\"></a>安装 Chrome 的 Xdebug Helper 插件</h1><h1 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h1><ol>\n<li>打断点</li>\n<li>点击 phpstorm 的电话图标，开始监听</li>\n<li>Chrome 中，enable Xdebug Helper 插件</li>\n<li>点击页面至断点所在位置，开始调试</li>\n</ol>\n<p>切换项目以及操作不当等可能导致PHP服务崩溃或系统崩溃，此时需重启PHP服务或系统，很蛋疼。<br>个人更喜欢方法一<br>以上配置方法一也可以完美运行</p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-33e6d9872c86262a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>","more":"<h1 id=\"前提\"><a href=\"#前提\" class=\"headerlink\" title=\"前提\"></a>前提</h1><p>基本配置参见前一篇<a href=\"http://www.jianshu.com/p/3a3db0359bc7\">《配置和使用 Xdebug (Laravel + Homestead + Xdebug)》</a></p>\n<h1 id=\"不同\"><a href=\"#不同\" class=\"headerlink\" title=\"不同\"></a>不同</h1><p>xdebug.so 文件的内容改为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zend_extension&#x3D;&quot;&#x2F;usr&#x2F;lib&#x2F;php&#x2F;20151012&#x2F;xdebug.so&quot;</span><br><span class=\"line\">xdebug.idekey&#x3D;&quot;PHPSTORM&quot;</span><br><span class=\"line\">xdebug.profiler_append &#x3D; 0</span><br><span class=\"line\">xdebug.profiler_enable &#x3D; off</span><br><span class=\"line\">xdebug.profiler_enable_trigger &#x3D; off</span><br><span class=\"line\">xdebug.profiler_output_dir &#x3D; &quot;&#x2F;tmp&quot;</span><br><span class=\"line\">xdebug.profiler_output_name &#x3D; &quot;cachegrind.out.%t-%s&quot;</span><br><span class=\"line\">xdebug.remote_enable &#x3D; on</span><br><span class=\"line\">xdebug.remote_handler &#x3D; &quot;dbgp&quot;</span><br><span class=\"line\">xdebug.remote_host &#x3D; &quot;127.0.0.1&quot;</span><br><span class=\"line\">xdebug.trace_output_dir &#x3D; &quot;&#x2F;tmp&quot;</span><br><span class=\"line\">xdebug.remote_connect_back &#x3D; On</span><br><span class=\"line\">xdebug.remote_port&#x3D;9000</span><br><span class=\"line\">xdebug.auto_trace&#x3D;off</span><br><span class=\"line\">xdebug.default_enable&#x3D;on</span><br><span class=\"line\">xdebug.collect_params&#x3D;4</span><br><span class=\"line\">xdebug.collect_return&#x3D;on</span><br><span class=\"line\">xdebug.show_exception_trace&#x3D;On</span><br><span class=\"line\">xdebug.max_nesting_level &#x3D; 10000</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"安装-Chrome-的-Xdebug-Helper-插件\"><a href=\"#安装-Chrome-的-Xdebug-Helper-插件\" class=\"headerlink\" title=\"安装 Chrome 的 Xdebug Helper 插件\"></a>安装 Chrome 的 Xdebug Helper 插件</h1><h1 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h1><ol>\n<li>打断点</li>\n<li>点击 phpstorm 的电话图标，开始监听</li>\n<li>Chrome 中，enable Xdebug Helper 插件</li>\n<li>点击页面至断点所在位置，开始调试</li>\n</ol>\n<p>切换项目以及操作不当等可能导致PHP服务崩溃或系统崩溃，此时需重启PHP服务或系统，很蛋疼。<br>个人更喜欢方法一<br>以上配置方法一也可以完美运行</p>"},{"title":"配置和使用 Xdebug (Laravel + Homestead + Xdebug)","date":"2017-02-02T16:00:00.000Z","description":"Xdebug deepens debugging PHP apps and websites to a level you can’t receive from the manual process of using code level ```var_dump()```.","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-f23a03851fb5eafd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nXdebug deepens debugging PHP apps and websites to a level you can’t receive from the manual process of using code level ```var_dump()```.\n\n<!--more-->\n\n# Setup\n\nTo install Xdebug for PHP7 on Ubuntu you will need to do so manually. Ubuntu 15 and lower will not come with a package for PHP7 or its xDebug counterpart.\n\n\nFirst, be sure you are using PHP 7 already by checking your version.\n\n```vagrant@homestead:~/www/caijing/cms_caijing$ php -v```\nShould give you something like:\n```\nPHP 7.0.1-1+deb.sury.org~trusty+2 (cli) ( NTS )\nCopyright (c) 1997-2015 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2015 Zend Technologies\n    with Xdebug v2.5.0, Copyright (c) 2002-2016, by Derick Rethans\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2015, by Zend Technologies\n```\nIn my case I’m using the **Larval Homestead PHP 7 branch with Vagrant and the VirtualBox provider**. So, I have PHP 7 already installed and working with Nginx.\n\n# Get your php.ini\n\nNext output your php.ini information into a file or place you can get to the information from. I like to save mine to a file called php-info.txt.\n\n```\nvagrant@homestead:~/www/caijing/cms_caijing$ sudo php -i > ~/php-info.txt(一个你可以打开该文件的地方即可)\n```\n# Use the Xdebug Wizard\n\n打开 php-info 文件，全选，复制，粘贴到 https://xdebug.org/wizard.php，然后点击 analyse，等待结果。\n\n按照结果提示一步步来即可。\n\nSend the text file information into the wizard at Xdebug Wizard. Then follow the instructions the wizard supplies.\n\nAlso, if you are using OSX you may need to run ```brew install autoconf```.\n\n下面是我本机(zzp)的 Instructions:\n\n1.  Download xdebug-2.5.0.tgz (到想要保存的目录中执行，或者使用绝对路径  ```sudo wget -O ~/downloads/xdebug-2.5.0.tgz https://xdebug.org/files/xdebug-2.5.0.tgz```)\n2.  Unpack the downloaded file with ```tar -xvzf xdebug-2.5.0.tgz```\n3. Run: ```cd xdebug-2.5.0```\n4. Run: ```phpize``` (See the FAQ if you don't have phpize.)\nAs part of its output it should show:\nConfiguring for:\n```\nZend Module Api No:      20151012\nZend Extension Api No:   320151012\n```\nIf it does not, you are using the wrong phpize. Please follow this FAQ entry and skip the next step.\n\n5. Run: ```./configure```\n6. Run: ```make```\n7. Run: ```cp modules/xdebug.so /usr/lib/php/20151012```\n8. Edit /etc/php/7.0/cli/php.ini and add the line\n```zend_extension = /usr/lib/php/20151012/xdebug.so```\n这里，最好不要改动 php 的主配置文件，在 phpinfo() 输出内容中找到 Additional .ini files parsed，这里是辅助配置文件。本机为： ```/etc/php/7.0/fpm/conf.d```，软链自：```/etc/php/mods-available/```\n在目录下新建一个文件 xdebug.ini， 添加需要的这行代码。然后还需要在```/etc/php/7.0/fpm/conf.d```下创建软链。\n9. 重启服务\n```\nsudo service php7.0-fpm restart\nsudo service nginx restart\n```\n在项目的任何地方设置输出 phpinfo(), 在网页上能搜索到 xdebug 的内容，表示配置成功。\n\n![Snip20161212_10.png](http://upload-images.jianshu.io/upload_images/693141-a7ec3e277ecfe17f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n# Enable Remote Xdebug\n\nTo use Xdebug remote debugging on a host computer you need to enable remote debugging on the guest server. In my case the guest is the Vagrant Homestead VM.\n\nIn the guest php.ini file add: （这些直接复制即可，不用改，同样添加至 xdebug.ini 即可）\n```\nxdebug.remote_enable = 1\nxdebug.remote_connect_back=1\nxdebug.remote_port = 9000\nxdebug.scream=0\nxdebug.show_local_vars=1\nxdebug.idekey=PHPSTORM\n```\nSince I use PhpStorm for Debugging I set my Xdebug key to PHPSTORM. \nIn the browser, the Xdebug and PhpStorm will look for a cookie called XDEBUG_SESSION with the value PHPSTORM. To set this cookie I use the Chrome Browser extension Xdebug helper. （这里暂时没有用到）\n\nReboot Services\n\nTo load the new configurations reload your PHP and HTTP server services. In my case that is nginx and php7.0-fpm.\n```\nsudo service php7.0-fpm restart\nsudo service nginx restart\n```\n# Configure PHP Storm\n\nNow that Xdebug is install we are ready to configure a “PHP Remote Debug” for PhpStorm.\n\n1. Under ```PhpStorm -> Preferences -> Languages&Frameworks -> PHP -> Debug``` be sure Xdebug is set to port 9000\n2. Under ```PhpStorm -> Preferences -> Languages&Frameworks -> PHP -> Servers```, add a server using port 80 and set the Absolute path on the server.\n其中，因为是虚拟机远程服务器的原因，勾选了使用 path mappings，将本地的项目目录 ```/Users/ZouZhipeng/www/caijing/cms_caijing``` 和服务器上的绝对路径 ```/home/vagrant/www/caijing/cms_caijing``` 进行关联。\n![Snip20161212_1.png](http://upload-images.jianshu.io/upload_images/693141-ad567cc7c1a170a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n3. 屏幕上方的菜单栏：Under ```Run -> Edit Configurations``` 添加一个 PHP Remote Debug， 选择 Servers 后点击省略号，即跳转到 Server 配置页面，即上面第二步操作的。\n![Snip20161212_5.png](http://upload-images.jianshu.io/upload_images/693141-69d0f1a6f53da420.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n4. Set the server and the Ide key(session id) to PHPSTORM \n5. 还是刚才的页面，左侧➕，添加一个 PHP Web Application，我的配置如下\nstart URL 为项目开始的地址，即下方蓝色 url，点击臭虫会直接跳转到这里。\n![Snip20161212_3.png](http://upload-images.jianshu.io/upload_images/693141-611304b1de040915.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n# Using PhpStorm with Xdebug on a Remote Server （这部分没用到）\n\nTo start receiving requests from the remote server enable “Debug” with Xdebug helper in Google Chrome on the page you want to debug. Then, unlike local testing that uses “Start Listening for PHP Debug Connections” use Run > Debug instead.\n\nUsing the “Debug” command will open up the signal manually and open the direct connection to the remote server.\n\nSet breakpoints and you are off.\n\n# Out of Network Servers （troubleshooting，暂未用到）\n\nIf you are trying to remote debug a website with Xdebug from outside your local network be sure the 9000 port is not blocked on your network. This is typically done at the router level.\n\nAs always consult the Xdebug remote documentation.\n\nNext, ask Google “what is my public ip” and it will tell you.\n\nThen be sure your remote server is not blocking your IP address.\n\n# 使用方法\n\n在需要调试的行上打上断点（点击一下行号后面的空白处即可，再点一次取消断点），需要说明的是当程序运行到该断点时，程序会停留在该行，但该行本身不会执行。自此可以查看程序运行到此处时所包含的所有数据信息。当然，查看信息功能相当于使用echo，print或者var_dump。\n# 操作流程\n打断点—>点击臭虫—>点击浏览器页面触发断点—>自动跳转回PhpStorm—>查看携带的数据（调试的目的）—>可按步执行查找问题点—>点击运行（或者F5）—>浏览器页面继续执行—>调试完成\n\n![20160719101531030.png](http://upload-images.jianshu.io/upload_images/693141-e4f1e54dfd890e54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![20160719101534475.png](http://upload-images.jianshu.io/upload_images/693141-c84a3d2da5ccfc37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![20160719101537936.png](http://upload-images.jianshu.io/upload_images/693141-6412b574967f7ba0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n# 参考：\nhttp://blog.csdn.net/knight_quan/article/details/51953269\nhttps://xdebug.org/wizard.php\nhttps://php-built.com/2016/01/20/installing-xdebug-for-php7/\n\n\n","source":"_posts/配置和使用-Xdebug-(Laravel-+-Homestead-+-Xdebug).md","raw":"---\ntitle: 配置和使用 Xdebug (Laravel + Homestead + Xdebug)\ndate: 2017-02-03\ntags: xdebug\ndescription: Xdebug deepens debugging PHP apps and websites to a level you can’t receive from the manual process of using code level ```var_dump()```.\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-f23a03851fb5eafd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\nXdebug deepens debugging PHP apps and websites to a level you can’t receive from the manual process of using code level ```var_dump()```.\n\n<!--more-->\n\n# Setup\n\nTo install Xdebug for PHP7 on Ubuntu you will need to do so manually. Ubuntu 15 and lower will not come with a package for PHP7 or its xDebug counterpart.\n\n\nFirst, be sure you are using PHP 7 already by checking your version.\n\n```vagrant@homestead:~/www/caijing/cms_caijing$ php -v```\nShould give you something like:\n```\nPHP 7.0.1-1+deb.sury.org~trusty+2 (cli) ( NTS )\nCopyright (c) 1997-2015 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2015 Zend Technologies\n    with Xdebug v2.5.0, Copyright (c) 2002-2016, by Derick Rethans\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2015, by Zend Technologies\n```\nIn my case I’m using the **Larval Homestead PHP 7 branch with Vagrant and the VirtualBox provider**. So, I have PHP 7 already installed and working with Nginx.\n\n# Get your php.ini\n\nNext output your php.ini information into a file or place you can get to the information from. I like to save mine to a file called php-info.txt.\n\n```\nvagrant@homestead:~/www/caijing/cms_caijing$ sudo php -i > ~/php-info.txt(一个你可以打开该文件的地方即可)\n```\n# Use the Xdebug Wizard\n\n打开 php-info 文件，全选，复制，粘贴到 https://xdebug.org/wizard.php，然后点击 analyse，等待结果。\n\n按照结果提示一步步来即可。\n\nSend the text file information into the wizard at Xdebug Wizard. Then follow the instructions the wizard supplies.\n\nAlso, if you are using OSX you may need to run ```brew install autoconf```.\n\n下面是我本机(zzp)的 Instructions:\n\n1.  Download xdebug-2.5.0.tgz (到想要保存的目录中执行，或者使用绝对路径  ```sudo wget -O ~/downloads/xdebug-2.5.0.tgz https://xdebug.org/files/xdebug-2.5.0.tgz```)\n2.  Unpack the downloaded file with ```tar -xvzf xdebug-2.5.0.tgz```\n3. Run: ```cd xdebug-2.5.0```\n4. Run: ```phpize``` (See the FAQ if you don't have phpize.)\nAs part of its output it should show:\nConfiguring for:\n```\nZend Module Api No:      20151012\nZend Extension Api No:   320151012\n```\nIf it does not, you are using the wrong phpize. Please follow this FAQ entry and skip the next step.\n\n5. Run: ```./configure```\n6. Run: ```make```\n7. Run: ```cp modules/xdebug.so /usr/lib/php/20151012```\n8. Edit /etc/php/7.0/cli/php.ini and add the line\n```zend_extension = /usr/lib/php/20151012/xdebug.so```\n这里，最好不要改动 php 的主配置文件，在 phpinfo() 输出内容中找到 Additional .ini files parsed，这里是辅助配置文件。本机为： ```/etc/php/7.0/fpm/conf.d```，软链自：```/etc/php/mods-available/```\n在目录下新建一个文件 xdebug.ini， 添加需要的这行代码。然后还需要在```/etc/php/7.0/fpm/conf.d```下创建软链。\n9. 重启服务\n```\nsudo service php7.0-fpm restart\nsudo service nginx restart\n```\n在项目的任何地方设置输出 phpinfo(), 在网页上能搜索到 xdebug 的内容，表示配置成功。\n\n![Snip20161212_10.png](http://upload-images.jianshu.io/upload_images/693141-a7ec3e277ecfe17f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n# Enable Remote Xdebug\n\nTo use Xdebug remote debugging on a host computer you need to enable remote debugging on the guest server. In my case the guest is the Vagrant Homestead VM.\n\nIn the guest php.ini file add: （这些直接复制即可，不用改，同样添加至 xdebug.ini 即可）\n```\nxdebug.remote_enable = 1\nxdebug.remote_connect_back=1\nxdebug.remote_port = 9000\nxdebug.scream=0\nxdebug.show_local_vars=1\nxdebug.idekey=PHPSTORM\n```\nSince I use PhpStorm for Debugging I set my Xdebug key to PHPSTORM. \nIn the browser, the Xdebug and PhpStorm will look for a cookie called XDEBUG_SESSION with the value PHPSTORM. To set this cookie I use the Chrome Browser extension Xdebug helper. （这里暂时没有用到）\n\nReboot Services\n\nTo load the new configurations reload your PHP and HTTP server services. In my case that is nginx and php7.0-fpm.\n```\nsudo service php7.0-fpm restart\nsudo service nginx restart\n```\n# Configure PHP Storm\n\nNow that Xdebug is install we are ready to configure a “PHP Remote Debug” for PhpStorm.\n\n1. Under ```PhpStorm -> Preferences -> Languages&Frameworks -> PHP -> Debug``` be sure Xdebug is set to port 9000\n2. Under ```PhpStorm -> Preferences -> Languages&Frameworks -> PHP -> Servers```, add a server using port 80 and set the Absolute path on the server.\n其中，因为是虚拟机远程服务器的原因，勾选了使用 path mappings，将本地的项目目录 ```/Users/ZouZhipeng/www/caijing/cms_caijing``` 和服务器上的绝对路径 ```/home/vagrant/www/caijing/cms_caijing``` 进行关联。\n![Snip20161212_1.png](http://upload-images.jianshu.io/upload_images/693141-ad567cc7c1a170a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n3. 屏幕上方的菜单栏：Under ```Run -> Edit Configurations``` 添加一个 PHP Remote Debug， 选择 Servers 后点击省略号，即跳转到 Server 配置页面，即上面第二步操作的。\n![Snip20161212_5.png](http://upload-images.jianshu.io/upload_images/693141-69d0f1a6f53da420.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n4. Set the server and the Ide key(session id) to PHPSTORM \n5. 还是刚才的页面，左侧➕，添加一个 PHP Web Application，我的配置如下\nstart URL 为项目开始的地址，即下方蓝色 url，点击臭虫会直接跳转到这里。\n![Snip20161212_3.png](http://upload-images.jianshu.io/upload_images/693141-611304b1de040915.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n# Using PhpStorm with Xdebug on a Remote Server （这部分没用到）\n\nTo start receiving requests from the remote server enable “Debug” with Xdebug helper in Google Chrome on the page you want to debug. Then, unlike local testing that uses “Start Listening for PHP Debug Connections” use Run > Debug instead.\n\nUsing the “Debug” command will open up the signal manually and open the direct connection to the remote server.\n\nSet breakpoints and you are off.\n\n# Out of Network Servers （troubleshooting，暂未用到）\n\nIf you are trying to remote debug a website with Xdebug from outside your local network be sure the 9000 port is not blocked on your network. This is typically done at the router level.\n\nAs always consult the Xdebug remote documentation.\n\nNext, ask Google “what is my public ip” and it will tell you.\n\nThen be sure your remote server is not blocking your IP address.\n\n# 使用方法\n\n在需要调试的行上打上断点（点击一下行号后面的空白处即可，再点一次取消断点），需要说明的是当程序运行到该断点时，程序会停留在该行，但该行本身不会执行。自此可以查看程序运行到此处时所包含的所有数据信息。当然，查看信息功能相当于使用echo，print或者var_dump。\n# 操作流程\n打断点—>点击臭虫—>点击浏览器页面触发断点—>自动跳转回PhpStorm—>查看携带的数据（调试的目的）—>可按步执行查找问题点—>点击运行（或者F5）—>浏览器页面继续执行—>调试完成\n\n![20160719101531030.png](http://upload-images.jianshu.io/upload_images/693141-e4f1e54dfd890e54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![20160719101534475.png](http://upload-images.jianshu.io/upload_images/693141-c84a3d2da5ccfc37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![20160719101537936.png](http://upload-images.jianshu.io/upload_images/693141-6412b574967f7ba0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n# 参考：\nhttp://blog.csdn.net/knight_quan/article/details/51953269\nhttps://xdebug.org/wizard.php\nhttps://php-built.com/2016/01/20/installing-xdebug-for-php7/\n\n\n","slug":"配置和使用-Xdebug-(Laravel-+-Homestead-+-Xdebug)","published":1,"updated":"2020-09-11T01:04:35.052Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzab004k6wo1c1ib69tk","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-f23a03851fb5eafd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>Xdebug deepens debugging PHP apps and websites to a level you can’t receive from the manual process of using code level <code>var_dump()</code>.</p>\n<a id=\"more\"></a>\n\n<h1 id=\"Setup\"><a href=\"#Setup\" class=\"headerlink\" title=\"Setup\"></a>Setup</h1><p>To install Xdebug for PHP7 on Ubuntu you will need to do so manually. Ubuntu 15 and lower will not come with a package for PHP7 or its xDebug counterpart.</p>\n<p>First, be sure you are using PHP 7 already by checking your version.</p>\n<p><code>vagrant@homestead:~/www/caijing/cms_caijing$ php -v</code><br>Should give you something like:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PHP 7.0.1-1+deb.sury.org~trusty+2 (cli) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2015 The PHP Group</span><br><span class=\"line\">Zend Engine v3.0.0, Copyright (c) 1998-2015 Zend Technologies</span><br><span class=\"line\">    with Xdebug v2.5.0, Copyright (c) 2002-2016, by Derick Rethans</span><br><span class=\"line\">    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2015, by Zend Technologies</span><br></pre></td></tr></table></figure>\n<p>In my case I’m using the <strong>Larval Homestead PHP 7 branch with Vagrant and the VirtualBox provider</strong>. So, I have PHP 7 already installed and working with Nginx.</p>\n<h1 id=\"Get-your-php-ini\"><a href=\"#Get-your-php-ini\" class=\"headerlink\" title=\"Get your php.ini\"></a>Get your php.ini</h1><p>Next output your php.ini information into a file or place you can get to the information from. I like to save mine to a file called php-info.txt.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~&#x2F;www&#x2F;caijing&#x2F;cms_caijing$ sudo php -i &gt; ~&#x2F;php-info.txt(一个你可以打开该文件的地方即可)</span><br></pre></td></tr></table></figure>\n<h1 id=\"Use-the-Xdebug-Wizard\"><a href=\"#Use-the-Xdebug-Wizard\" class=\"headerlink\" title=\"Use the Xdebug Wizard\"></a>Use the Xdebug Wizard</h1><p>打开 php-info 文件，全选，复制，粘贴到 <a href=\"https://xdebug.org/wizard.php%EF%BC%8C%E7%84%B6%E5%90%8E%E7%82%B9%E5%87%BB\">https://xdebug.org/wizard.php，然后点击</a> analyse，等待结果。</p>\n<p>按照结果提示一步步来即可。</p>\n<p>Send the text file information into the wizard at Xdebug Wizard. Then follow the instructions the wizard supplies.</p>\n<p>Also, if you are using OSX you may need to run <code>brew install autoconf</code>.</p>\n<p>下面是我本机(zzp)的 Instructions:</p>\n<ol>\n<li><p>Download xdebug-2.5.0.tgz (到想要保存的目录中执行，或者使用绝对路径  <code>sudo wget -O ~/downloads/xdebug-2.5.0.tgz https://xdebug.org/files/xdebug-2.5.0.tgz</code>)</p>\n</li>\n<li><p>Unpack the downloaded file with <code>tar -xvzf xdebug-2.5.0.tgz</code></p>\n</li>\n<li><p>Run: <code>cd xdebug-2.5.0</code></p>\n</li>\n<li><p>Run: <code>phpize</code> (See the FAQ if you don’t have phpize.)<br>As part of its output it should show:<br>Configuring for:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Zend Module Api No:      20151012</span><br><span class=\"line\">Zend Extension Api No:   320151012</span><br></pre></td></tr></table></figure>\n<p>If it does not, you are using the wrong phpize. Please follow this FAQ entry and skip the next step.</p>\n</li>\n<li><p>Run: <code>./configure</code></p>\n</li>\n<li><p>Run: <code>make</code></p>\n</li>\n<li><p>Run: <code>cp modules/xdebug.so /usr/lib/php/20151012</code></p>\n</li>\n<li><p>Edit /etc/php/7.0/cli/php.ini and add the line<br><code>zend_extension = /usr/lib/php/20151012/xdebug.so</code><br>这里，最好不要改动 php 的主配置文件，在 phpinfo() 输出内容中找到 Additional .ini files parsed，这里是辅助配置文件。本机为： <code>/etc/php/7.0/fpm/conf.d</code>，软链自：<code>/etc/php/mods-available/</code><br>在目录下新建一个文件 xdebug.ini， 添加需要的这行代码。然后还需要在<code>/etc/php/7.0/fpm/conf.d</code>下创建软链。</p>\n</li>\n<li><p>重启服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service php7.0-fpm restart</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure>\n<p>在项目的任何地方设置输出 phpinfo(), 在网页上能搜索到 xdebug 的内容，表示配置成功。</p>\n</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-a7ec3e277ecfe17f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_10.png\"></p>\n<h1 id=\"Enable-Remote-Xdebug\"><a href=\"#Enable-Remote-Xdebug\" class=\"headerlink\" title=\"Enable Remote Xdebug\"></a>Enable Remote Xdebug</h1><p>To use Xdebug remote debugging on a host computer you need to enable remote debugging on the guest server. In my case the guest is the Vagrant Homestead VM.</p>\n<p>In the guest php.ini file add: （这些直接复制即可，不用改，同样添加至 xdebug.ini 即可）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xdebug.remote_enable &#x3D; 1</span><br><span class=\"line\">xdebug.remote_connect_back&#x3D;1</span><br><span class=\"line\">xdebug.remote_port &#x3D; 9000</span><br><span class=\"line\">xdebug.scream&#x3D;0</span><br><span class=\"line\">xdebug.show_local_vars&#x3D;1</span><br><span class=\"line\">xdebug.idekey&#x3D;PHPSTORM</span><br></pre></td></tr></table></figure>\n<p>Since I use PhpStorm for Debugging I set my Xdebug key to PHPSTORM.<br>In the browser, the Xdebug and PhpStorm will look for a cookie called XDEBUG_SESSION with the value PHPSTORM. To set this cookie I use the Chrome Browser extension Xdebug helper. （这里暂时没有用到）</p>\n<p>Reboot Services</p>\n<p>To load the new configurations reload your PHP and HTTP server services. In my case that is nginx and php7.0-fpm.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service php7.0-fpm restart</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure>\n<h1 id=\"Configure-PHP-Storm\"><a href=\"#Configure-PHP-Storm\" class=\"headerlink\" title=\"Configure PHP Storm\"></a>Configure PHP Storm</h1><p>Now that Xdebug is install we are ready to configure a “PHP Remote Debug” for PhpStorm.</p>\n<ol>\n<li><p>Under <code>PhpStorm -&gt; Preferences -&gt; Languages&amp;Frameworks -&gt; PHP -&gt; Debug</code> be sure Xdebug is set to port 9000</p>\n</li>\n<li><p>Under <code>PhpStorm -&gt; Preferences -&gt; Languages&amp;Frameworks -&gt; PHP -&gt; Servers</code>, add a server using port 80 and set the Absolute path on the server.<br>其中，因为是虚拟机远程服务器的原因，勾选了使用 path mappings，将本地的项目目录 <code>/Users/ZouZhipeng/www/caijing/cms_caijing</code> 和服务器上的绝对路径 <code>/home/vagrant/www/caijing/cms_caijing</code> 进行关联。<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-ad567cc7c1a170a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_1.png\"></p>\n</li>\n<li><p>屏幕上方的菜单栏：Under <code>Run -&gt; Edit Configurations</code> 添加一个 PHP Remote Debug， 选择 Servers 后点击省略号，即跳转到 Server 配置页面，即上面第二步操作的。<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-69d0f1a6f53da420.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_5.png\"></p>\n</li>\n<li><p>Set the server and the Ide key(session id) to PHPSTORM </p>\n</li>\n<li><p>还是刚才的页面，左侧➕，添加一个 PHP Web Application，我的配置如下<br>start URL 为项目开始的地址，即下方蓝色 url，点击臭虫会直接跳转到这里。<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-611304b1de040915.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_3.png\"></p>\n</li>\n</ol>\n<h1 id=\"Using-PhpStorm-with-Xdebug-on-a-Remote-Server-（这部分没用到）\"><a href=\"#Using-PhpStorm-with-Xdebug-on-a-Remote-Server-（这部分没用到）\" class=\"headerlink\" title=\"Using PhpStorm with Xdebug on a Remote Server （这部分没用到）\"></a>Using PhpStorm with Xdebug on a Remote Server （这部分没用到）</h1><p>To start receiving requests from the remote server enable “Debug” with Xdebug helper in Google Chrome on the page you want to debug. Then, unlike local testing that uses “Start Listening for PHP Debug Connections” use Run &gt; Debug instead.</p>\n<p>Using the “Debug” command will open up the signal manually and open the direct connection to the remote server.</p>\n<p>Set breakpoints and you are off.</p>\n<h1 id=\"Out-of-Network-Servers-（troubleshooting，暂未用到）\"><a href=\"#Out-of-Network-Servers-（troubleshooting，暂未用到）\" class=\"headerlink\" title=\"Out of Network Servers （troubleshooting，暂未用到）\"></a>Out of Network Servers （troubleshooting，暂未用到）</h1><p>If you are trying to remote debug a website with Xdebug from outside your local network be sure the 9000 port is not blocked on your network. This is typically done at the router level.</p>\n<p>As always consult the Xdebug remote documentation.</p>\n<p>Next, ask Google “what is my public ip” and it will tell you.</p>\n<p>Then be sure your remote server is not blocking your IP address.</p>\n<h1 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h1><p>在需要调试的行上打上断点（点击一下行号后面的空白处即可，再点一次取消断点），需要说明的是当程序运行到该断点时，程序会停留在该行，但该行本身不会执行。自此可以查看程序运行到此处时所包含的所有数据信息。当然，查看信息功能相当于使用echo，print或者var_dump。</p>\n<h1 id=\"操作流程\"><a href=\"#操作流程\" class=\"headerlink\" title=\"操作流程\"></a>操作流程</h1><p>打断点—&gt;点击臭虫—&gt;点击浏览器页面触发断点—&gt;自动跳转回PhpStorm—&gt;查看携带的数据（调试的目的）—&gt;可按步执行查找问题点—&gt;点击运行（或者F5）—&gt;浏览器页面继续执行—&gt;调试完成</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-e4f1e54dfd890e54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"20160719101531030.png\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-c84a3d2da5ccfc37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"20160719101534475.png\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-6412b574967f7ba0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"20160719101537936.png\"></p>\n<h1 id=\"参考：\"><a href=\"#参考：\" class=\"headerlink\" title=\"参考：\"></a>参考：</h1><p><a href=\"http://blog.csdn.net/knight_quan/article/details/51953269\">http://blog.csdn.net/knight_quan/article/details/51953269</a><br><a href=\"https://xdebug.org/wizard.php\">https://xdebug.org/wizard.php</a><br><a href=\"https://php-built.com/2016/01/20/installing-xdebug-for-php7/\">https://php-built.com/2016/01/20/installing-xdebug-for-php7/</a></p>\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-f23a03851fb5eafd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>Xdebug deepens debugging PHP apps and websites to a level you can’t receive from the manual process of using code level <code>var_dump()</code>.</p>","more":"<h1 id=\"Setup\"><a href=\"#Setup\" class=\"headerlink\" title=\"Setup\"></a>Setup</h1><p>To install Xdebug for PHP7 on Ubuntu you will need to do so manually. Ubuntu 15 and lower will not come with a package for PHP7 or its xDebug counterpart.</p>\n<p>First, be sure you are using PHP 7 already by checking your version.</p>\n<p><code>vagrant@homestead:~/www/caijing/cms_caijing$ php -v</code><br>Should give you something like:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PHP 7.0.1-1+deb.sury.org~trusty+2 (cli) ( NTS )</span><br><span class=\"line\">Copyright (c) 1997-2015 The PHP Group</span><br><span class=\"line\">Zend Engine v3.0.0, Copyright (c) 1998-2015 Zend Technologies</span><br><span class=\"line\">    with Xdebug v2.5.0, Copyright (c) 2002-2016, by Derick Rethans</span><br><span class=\"line\">    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2015, by Zend Technologies</span><br></pre></td></tr></table></figure>\n<p>In my case I’m using the <strong>Larval Homestead PHP 7 branch with Vagrant and the VirtualBox provider</strong>. So, I have PHP 7 already installed and working with Nginx.</p>\n<h1 id=\"Get-your-php-ini\"><a href=\"#Get-your-php-ini\" class=\"headerlink\" title=\"Get your php.ini\"></a>Get your php.ini</h1><p>Next output your php.ini information into a file or place you can get to the information from. I like to save mine to a file called php-info.txt.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant@homestead:~&#x2F;www&#x2F;caijing&#x2F;cms_caijing$ sudo php -i &gt; ~&#x2F;php-info.txt(一个你可以打开该文件的地方即可)</span><br></pre></td></tr></table></figure>\n<h1 id=\"Use-the-Xdebug-Wizard\"><a href=\"#Use-the-Xdebug-Wizard\" class=\"headerlink\" title=\"Use the Xdebug Wizard\"></a>Use the Xdebug Wizard</h1><p>打开 php-info 文件，全选，复制，粘贴到 <a href=\"https://xdebug.org/wizard.php%EF%BC%8C%E7%84%B6%E5%90%8E%E7%82%B9%E5%87%BB\">https://xdebug.org/wizard.php，然后点击</a> analyse，等待结果。</p>\n<p>按照结果提示一步步来即可。</p>\n<p>Send the text file information into the wizard at Xdebug Wizard. Then follow the instructions the wizard supplies.</p>\n<p>Also, if you are using OSX you may need to run <code>brew install autoconf</code>.</p>\n<p>下面是我本机(zzp)的 Instructions:</p>\n<ol>\n<li><p>Download xdebug-2.5.0.tgz (到想要保存的目录中执行，或者使用绝对路径  <code>sudo wget -O ~/downloads/xdebug-2.5.0.tgz https://xdebug.org/files/xdebug-2.5.0.tgz</code>)</p>\n</li>\n<li><p>Unpack the downloaded file with <code>tar -xvzf xdebug-2.5.0.tgz</code></p>\n</li>\n<li><p>Run: <code>cd xdebug-2.5.0</code></p>\n</li>\n<li><p>Run: <code>phpize</code> (See the FAQ if you don’t have phpize.)<br>As part of its output it should show:<br>Configuring for:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Zend Module Api No:      20151012</span><br><span class=\"line\">Zend Extension Api No:   320151012</span><br></pre></td></tr></table></figure>\n<p>If it does not, you are using the wrong phpize. Please follow this FAQ entry and skip the next step.</p>\n</li>\n<li><p>Run: <code>./configure</code></p>\n</li>\n<li><p>Run: <code>make</code></p>\n</li>\n<li><p>Run: <code>cp modules/xdebug.so /usr/lib/php/20151012</code></p>\n</li>\n<li><p>Edit /etc/php/7.0/cli/php.ini and add the line<br><code>zend_extension = /usr/lib/php/20151012/xdebug.so</code><br>这里，最好不要改动 php 的主配置文件，在 phpinfo() 输出内容中找到 Additional .ini files parsed，这里是辅助配置文件。本机为： <code>/etc/php/7.0/fpm/conf.d</code>，软链自：<code>/etc/php/mods-available/</code><br>在目录下新建一个文件 xdebug.ini， 添加需要的这行代码。然后还需要在<code>/etc/php/7.0/fpm/conf.d</code>下创建软链。</p>\n</li>\n<li><p>重启服务</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service php7.0-fpm restart</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure>\n<p>在项目的任何地方设置输出 phpinfo(), 在网页上能搜索到 xdebug 的内容，表示配置成功。</p>\n</li>\n</ol>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-a7ec3e277ecfe17f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_10.png\"></p>\n<h1 id=\"Enable-Remote-Xdebug\"><a href=\"#Enable-Remote-Xdebug\" class=\"headerlink\" title=\"Enable Remote Xdebug\"></a>Enable Remote Xdebug</h1><p>To use Xdebug remote debugging on a host computer you need to enable remote debugging on the guest server. In my case the guest is the Vagrant Homestead VM.</p>\n<p>In the guest php.ini file add: （这些直接复制即可，不用改，同样添加至 xdebug.ini 即可）</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xdebug.remote_enable &#x3D; 1</span><br><span class=\"line\">xdebug.remote_connect_back&#x3D;1</span><br><span class=\"line\">xdebug.remote_port &#x3D; 9000</span><br><span class=\"line\">xdebug.scream&#x3D;0</span><br><span class=\"line\">xdebug.show_local_vars&#x3D;1</span><br><span class=\"line\">xdebug.idekey&#x3D;PHPSTORM</span><br></pre></td></tr></table></figure>\n<p>Since I use PhpStorm for Debugging I set my Xdebug key to PHPSTORM.<br>In the browser, the Xdebug and PhpStorm will look for a cookie called XDEBUG_SESSION with the value PHPSTORM. To set this cookie I use the Chrome Browser extension Xdebug helper. （这里暂时没有用到）</p>\n<p>Reboot Services</p>\n<p>To load the new configurations reload your PHP and HTTP server services. In my case that is nginx and php7.0-fpm.</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo service php7.0-fpm restart</span><br><span class=\"line\">sudo service nginx restart</span><br></pre></td></tr></table></figure>\n<h1 id=\"Configure-PHP-Storm\"><a href=\"#Configure-PHP-Storm\" class=\"headerlink\" title=\"Configure PHP Storm\"></a>Configure PHP Storm</h1><p>Now that Xdebug is install we are ready to configure a “PHP Remote Debug” for PhpStorm.</p>\n<ol>\n<li><p>Under <code>PhpStorm -&gt; Preferences -&gt; Languages&amp;Frameworks -&gt; PHP -&gt; Debug</code> be sure Xdebug is set to port 9000</p>\n</li>\n<li><p>Under <code>PhpStorm -&gt; Preferences -&gt; Languages&amp;Frameworks -&gt; PHP -&gt; Servers</code>, add a server using port 80 and set the Absolute path on the server.<br>其中，因为是虚拟机远程服务器的原因，勾选了使用 path mappings，将本地的项目目录 <code>/Users/ZouZhipeng/www/caijing/cms_caijing</code> 和服务器上的绝对路径 <code>/home/vagrant/www/caijing/cms_caijing</code> 进行关联。<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-ad567cc7c1a170a0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_1.png\"></p>\n</li>\n<li><p>屏幕上方的菜单栏：Under <code>Run -&gt; Edit Configurations</code> 添加一个 PHP Remote Debug， 选择 Servers 后点击省略号，即跳转到 Server 配置页面，即上面第二步操作的。<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-69d0f1a6f53da420.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_5.png\"></p>\n</li>\n<li><p>Set the server and the Ide key(session id) to PHPSTORM </p>\n</li>\n<li><p>还是刚才的页面，左侧➕，添加一个 PHP Web Application，我的配置如下<br>start URL 为项目开始的地址，即下方蓝色 url，点击臭虫会直接跳转到这里。<br><img src=\"http://upload-images.jianshu.io/upload_images/693141-611304b1de040915.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Snip20161212_3.png\"></p>\n</li>\n</ol>\n<h1 id=\"Using-PhpStorm-with-Xdebug-on-a-Remote-Server-（这部分没用到）\"><a href=\"#Using-PhpStorm-with-Xdebug-on-a-Remote-Server-（这部分没用到）\" class=\"headerlink\" title=\"Using PhpStorm with Xdebug on a Remote Server （这部分没用到）\"></a>Using PhpStorm with Xdebug on a Remote Server （这部分没用到）</h1><p>To start receiving requests from the remote server enable “Debug” with Xdebug helper in Google Chrome on the page you want to debug. Then, unlike local testing that uses “Start Listening for PHP Debug Connections” use Run &gt; Debug instead.</p>\n<p>Using the “Debug” command will open up the signal manually and open the direct connection to the remote server.</p>\n<p>Set breakpoints and you are off.</p>\n<h1 id=\"Out-of-Network-Servers-（troubleshooting，暂未用到）\"><a href=\"#Out-of-Network-Servers-（troubleshooting，暂未用到）\" class=\"headerlink\" title=\"Out of Network Servers （troubleshooting，暂未用到）\"></a>Out of Network Servers （troubleshooting，暂未用到）</h1><p>If you are trying to remote debug a website with Xdebug from outside your local network be sure the 9000 port is not blocked on your network. This is typically done at the router level.</p>\n<p>As always consult the Xdebug remote documentation.</p>\n<p>Next, ask Google “what is my public ip” and it will tell you.</p>\n<p>Then be sure your remote server is not blocking your IP address.</p>\n<h1 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h1><p>在需要调试的行上打上断点（点击一下行号后面的空白处即可，再点一次取消断点），需要说明的是当程序运行到该断点时，程序会停留在该行，但该行本身不会执行。自此可以查看程序运行到此处时所包含的所有数据信息。当然，查看信息功能相当于使用echo，print或者var_dump。</p>\n<h1 id=\"操作流程\"><a href=\"#操作流程\" class=\"headerlink\" title=\"操作流程\"></a>操作流程</h1><p>打断点—&gt;点击臭虫—&gt;点击浏览器页面触发断点—&gt;自动跳转回PhpStorm—&gt;查看携带的数据（调试的目的）—&gt;可按步执行查找问题点—&gt;点击运行（或者F5）—&gt;浏览器页面继续执行—&gt;调试完成</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-e4f1e54dfd890e54.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"20160719101531030.png\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-c84a3d2da5ccfc37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"20160719101534475.png\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-6412b574967f7ba0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"20160719101537936.png\"></p>\n<h1 id=\"参考：\"><a href=\"#参考：\" class=\"headerlink\" title=\"参考：\"></a>参考：</h1><p><a href=\"http://blog.csdn.net/knight_quan/article/details/51953269\">http://blog.csdn.net/knight_quan/article/details/51953269</a><br><a href=\"https://xdebug.org/wizard.php\">https://xdebug.org/wizard.php</a><br><a href=\"https://php-built.com/2016/01/20/installing-xdebug-for-php7/\">https://php-built.com/2016/01/20/installing-xdebug-for-php7/</a></p>"},{"title":"青海湖朝圣之旅 第三季 Part 1 （多图预警）","date":"2017-06-04T09:39:23.000Z","_content":"\nBest catch from this trip.\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/81997653.jpg)\n\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n\n几个月前鸽子曾提及毕业前想出去玩一次，想去青海湖，由于我之前去过两次，让我给点建议。想想自己确实也不知道自己想去哪里，青海湖给我的印象又是好到爆炸，就萌生了自己也再去一次的想法。趁着端午节的三天假期，狠下心来请了三天假，加上接下来的一个周末，8天的时间正好够环湖。说走就走的旅行，不就是这样么？\n\n计划什么的完全不用做了，这条路线本就简单，环湖骑行两次的经历让我对这条线路也了然于心。以下是对本次环湖骑行的一些简单记录，以图片为主。\n\n## Day 0\n\n5月29日下午，火车抵达西宁，之前从天气预报了解到，青海最近的天气不是很好，要么阴天要么下雨。心里也做好了这次旅途凶多吉少的准备。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/48067496.jpg)\n\n到了之后，发现果真是阴天，尽管有了心理准备，但还是感觉到很低落。在火车站停留片刻，太阳逐渐从厚厚的云层中漏出半个脑袋，天空也慢慢渗出一点蓝色，这才有了一点与天空距离更近的感觉。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/21091796.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/24873346.jpg)\n\n一行5人乘大巴车耗时一个半小时抵达环湖起点--海北藏族自治州西海镇。\n\n找好住宿，租好车，时间还早，就开始了对这片陌生土地的探索。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/17081831.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/73040497.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/84795830.jpg)\n\n由于是旅游淡季，环湖骑行的人比较少。住在同一家旅店的有一个广东的妹子，只身一人来环湖骑行，勇气可嘉，这种事情我都不一定能做到。就这样，我们的队伍壮大到6人。\n\n## Day 1\n\n出发，天气似乎还不错。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/93829334.jpg)\n\n环湖东路刚开始就有几个上坡，对于刚刚出发的我们是不小的挑战。犹记得四年前的自己初生牛犊不怕虎，一口气冲到坡顶，而今带着多了20多斤的肥膘在半坡就气喘吁吁。好在还是咬牙坚持到达坡顶。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/46285113.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31188012.jpg)\n\n仅仅20多公里，妹子的车胎就没气了。检查后发现是轮胎老化，刚开始想补，后来决定直接换。但是这辆车是一辆公路车，拆装难度都极其大。我们折腾了有一个多小时也以失败告终，路上几位热心骑友主动帮忙也没能将其换好。无奈，只好打电话向租车店老板求助，要求其换一辆车。\n\n一个小时后，车子换好了。考虑到第一天的行程比较紧张，有100公里。老板就将我们向前带了20公里。这才保证第一天完成任务。\n\n像风儿一样自由\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/78905802.jpg)\n\n天空触手可及\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/13953071.jpg)\n\n雪山清晰可见，只是距离还是有些远\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/21529038.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/12747707.jpg)\n\n湖水清澈见底，略咸略苦\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31856606.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/84007068.jpg)\n\n可以以假乱真的毛绒玩具\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/93988479.jpg)\n\n起飞\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/5161349.jpg)\n\n假的洱海，是否有真洱海的感觉？\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/6176193.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/51724586.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/13065274.jpg)\n\n羊羊羊\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/6435283.jpg)\n\n牛牛牛\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/69617105.jpg)\n\n骑马下湖\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16198502.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/74410178.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/177919.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31842491.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/96146063.jpg)\n\n下午一位伙伴的车子又扎胎了，一天两次也是够了。好在是一辆山地车，我们几分钟就换好新胎继续上路。\n\n未完待续...\n\n","source":"_posts/青海湖朝圣之旅-第三季 part1.md","raw":"---\ntitle: 青海湖朝圣之旅 第三季 Part 1 （多图预警）\ndate: 2017-06-04 17:39:23\ntags: 青海湖\ncategories: 图集\n---\n\nBest catch from this trip.\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/81997653.jpg)\n\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n\n几个月前鸽子曾提及毕业前想出去玩一次，想去青海湖，由于我之前去过两次，让我给点建议。想想自己确实也不知道自己想去哪里，青海湖给我的印象又是好到爆炸，就萌生了自己也再去一次的想法。趁着端午节的三天假期，狠下心来请了三天假，加上接下来的一个周末，8天的时间正好够环湖。说走就走的旅行，不就是这样么？\n\n计划什么的完全不用做了，这条路线本就简单，环湖骑行两次的经历让我对这条线路也了然于心。以下是对本次环湖骑行的一些简单记录，以图片为主。\n\n## Day 0\n\n5月29日下午，火车抵达西宁，之前从天气预报了解到，青海最近的天气不是很好，要么阴天要么下雨。心里也做好了这次旅途凶多吉少的准备。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/48067496.jpg)\n\n到了之后，发现果真是阴天，尽管有了心理准备，但还是感觉到很低落。在火车站停留片刻，太阳逐渐从厚厚的云层中漏出半个脑袋，天空也慢慢渗出一点蓝色，这才有了一点与天空距离更近的感觉。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/21091796.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/24873346.jpg)\n\n一行5人乘大巴车耗时一个半小时抵达环湖起点--海北藏族自治州西海镇。\n\n找好住宿，租好车，时间还早，就开始了对这片陌生土地的探索。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/17081831.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/73040497.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/84795830.jpg)\n\n由于是旅游淡季，环湖骑行的人比较少。住在同一家旅店的有一个广东的妹子，只身一人来环湖骑行，勇气可嘉，这种事情我都不一定能做到。就这样，我们的队伍壮大到6人。\n\n## Day 1\n\n出发，天气似乎还不错。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/93829334.jpg)\n\n环湖东路刚开始就有几个上坡，对于刚刚出发的我们是不小的挑战。犹记得四年前的自己初生牛犊不怕虎，一口气冲到坡顶，而今带着多了20多斤的肥膘在半坡就气喘吁吁。好在还是咬牙坚持到达坡顶。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/46285113.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31188012.jpg)\n\n仅仅20多公里，妹子的车胎就没气了。检查后发现是轮胎老化，刚开始想补，后来决定直接换。但是这辆车是一辆公路车，拆装难度都极其大。我们折腾了有一个多小时也以失败告终，路上几位热心骑友主动帮忙也没能将其换好。无奈，只好打电话向租车店老板求助，要求其换一辆车。\n\n一个小时后，车子换好了。考虑到第一天的行程比较紧张，有100公里。老板就将我们向前带了20公里。这才保证第一天完成任务。\n\n像风儿一样自由\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/78905802.jpg)\n\n天空触手可及\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/13953071.jpg)\n\n雪山清晰可见，只是距离还是有些远\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/21529038.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/12747707.jpg)\n\n湖水清澈见底，略咸略苦\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31856606.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/84007068.jpg)\n\n可以以假乱真的毛绒玩具\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/93988479.jpg)\n\n起飞\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/5161349.jpg)\n\n假的洱海，是否有真洱海的感觉？\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/6176193.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/51724586.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/13065274.jpg)\n\n羊羊羊\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/6435283.jpg)\n\n牛牛牛\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/69617105.jpg)\n\n骑马下湖\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16198502.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/74410178.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/177919.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31842491.jpg)\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/96146063.jpg)\n\n下午一位伙伴的车子又扎胎了，一天两次也是够了。好在是一辆山地车，我们几分钟就换好新胎继续上路。\n\n未完待续...\n\n","slug":"青海湖朝圣之旅-第三季 part1","published":1,"updated":"2020-09-11T01:04:35.053Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzac004n6wo1g616g8xi","content":"<p>Best catch from this trip.</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/81997653.jpg\"></p>\n<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>\n<a id=\"more\"></a>\n\n<p>几个月前鸽子曾提及毕业前想出去玩一次，想去青海湖，由于我之前去过两次，让我给点建议。想想自己确实也不知道自己想去哪里，青海湖给我的印象又是好到爆炸，就萌生了自己也再去一次的想法。趁着端午节的三天假期，狠下心来请了三天假，加上接下来的一个周末，8天的时间正好够环湖。说走就走的旅行，不就是这样么？</p>\n<p>计划什么的完全不用做了，这条路线本就简单，环湖骑行两次的经历让我对这条线路也了然于心。以下是对本次环湖骑行的一些简单记录，以图片为主。</p>\n<h2 id=\"Day-0\"><a href=\"#Day-0\" class=\"headerlink\" title=\"Day 0\"></a>Day 0</h2><p>5月29日下午，火车抵达西宁，之前从天气预报了解到，青海最近的天气不是很好，要么阴天要么下雨。心里也做好了这次旅途凶多吉少的准备。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/48067496.jpg\"></p>\n<p>到了之后，发现果真是阴天，尽管有了心理准备，但还是感觉到很低落。在火车站停留片刻，太阳逐渐从厚厚的云层中漏出半个脑袋，天空也慢慢渗出一点蓝色，这才有了一点与天空距离更近的感觉。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/21091796.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/24873346.jpg\"></p>\n<p>一行5人乘大巴车耗时一个半小时抵达环湖起点–海北藏族自治州西海镇。</p>\n<p>找好住宿，租好车，时间还早，就开始了对这片陌生土地的探索。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/17081831.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/73040497.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/84795830.jpg\"></p>\n<p>由于是旅游淡季，环湖骑行的人比较少。住在同一家旅店的有一个广东的妹子，只身一人来环湖骑行，勇气可嘉，这种事情我都不一定能做到。就这样，我们的队伍壮大到6人。</p>\n<h2 id=\"Day-1\"><a href=\"#Day-1\" class=\"headerlink\" title=\"Day 1\"></a>Day 1</h2><p>出发，天气似乎还不错。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/93829334.jpg\"></p>\n<p>环湖东路刚开始就有几个上坡，对于刚刚出发的我们是不小的挑战。犹记得四年前的自己初生牛犊不怕虎，一口气冲到坡顶，而今带着多了20多斤的肥膘在半坡就气喘吁吁。好在还是咬牙坚持到达坡顶。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/46285113.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31188012.jpg\"></p>\n<p>仅仅20多公里，妹子的车胎就没气了。检查后发现是轮胎老化，刚开始想补，后来决定直接换。但是这辆车是一辆公路车，拆装难度都极其大。我们折腾了有一个多小时也以失败告终，路上几位热心骑友主动帮忙也没能将其换好。无奈，只好打电话向租车店老板求助，要求其换一辆车。</p>\n<p>一个小时后，车子换好了。考虑到第一天的行程比较紧张，有100公里。老板就将我们向前带了20公里。这才保证第一天完成任务。</p>\n<p>像风儿一样自由<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/78905802.jpg\"></p>\n<p>天空触手可及<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/13953071.jpg\"></p>\n<p>雪山清晰可见，只是距离还是有些远<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/21529038.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/12747707.jpg\"></p>\n<p>湖水清澈见底，略咸略苦<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31856606.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/84007068.jpg\"></p>\n<p>可以以假乱真的毛绒玩具<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/93988479.jpg\"></p>\n<p>起飞<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/5161349.jpg\"></p>\n<p>假的洱海，是否有真洱海的感觉？<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/6176193.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/51724586.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/13065274.jpg\"></p>\n<p>羊羊羊<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/6435283.jpg\"></p>\n<p>牛牛牛<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/69617105.jpg\"></p>\n<p>骑马下湖<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16198502.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/74410178.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/177919.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31842491.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/96146063.jpg\"></p>\n<p>下午一位伙伴的车子又扎胎了，一天两次也是够了。好在是一辆山地车，我们几分钟就换好新胎继续上路。</p>\n<p>未完待续…</p>\n","site":{"data":{}},"excerpt":"<p>Best catch from this trip.</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/81997653.jpg\"></p>\n<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>","more":"<p>几个月前鸽子曾提及毕业前想出去玩一次，想去青海湖，由于我之前去过两次，让我给点建议。想想自己确实也不知道自己想去哪里，青海湖给我的印象又是好到爆炸，就萌生了自己也再去一次的想法。趁着端午节的三天假期，狠下心来请了三天假，加上接下来的一个周末，8天的时间正好够环湖。说走就走的旅行，不就是这样么？</p>\n<p>计划什么的完全不用做了，这条路线本就简单，环湖骑行两次的经历让我对这条线路也了然于心。以下是对本次环湖骑行的一些简单记录，以图片为主。</p>\n<h2 id=\"Day-0\"><a href=\"#Day-0\" class=\"headerlink\" title=\"Day 0\"></a>Day 0</h2><p>5月29日下午，火车抵达西宁，之前从天气预报了解到，青海最近的天气不是很好，要么阴天要么下雨。心里也做好了这次旅途凶多吉少的准备。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/48067496.jpg\"></p>\n<p>到了之后，发现果真是阴天，尽管有了心理准备，但还是感觉到很低落。在火车站停留片刻，太阳逐渐从厚厚的云层中漏出半个脑袋，天空也慢慢渗出一点蓝色，这才有了一点与天空距离更近的感觉。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/21091796.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/24873346.jpg\"></p>\n<p>一行5人乘大巴车耗时一个半小时抵达环湖起点–海北藏族自治州西海镇。</p>\n<p>找好住宿，租好车，时间还早，就开始了对这片陌生土地的探索。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/17081831.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/73040497.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/84795830.jpg\"></p>\n<p>由于是旅游淡季，环湖骑行的人比较少。住在同一家旅店的有一个广东的妹子，只身一人来环湖骑行，勇气可嘉，这种事情我都不一定能做到。就这样，我们的队伍壮大到6人。</p>\n<h2 id=\"Day-1\"><a href=\"#Day-1\" class=\"headerlink\" title=\"Day 1\"></a>Day 1</h2><p>出发，天气似乎还不错。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/93829334.jpg\"></p>\n<p>环湖东路刚开始就有几个上坡，对于刚刚出发的我们是不小的挑战。犹记得四年前的自己初生牛犊不怕虎，一口气冲到坡顶，而今带着多了20多斤的肥膘在半坡就气喘吁吁。好在还是咬牙坚持到达坡顶。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/46285113.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31188012.jpg\"></p>\n<p>仅仅20多公里，妹子的车胎就没气了。检查后发现是轮胎老化，刚开始想补，后来决定直接换。但是这辆车是一辆公路车，拆装难度都极其大。我们折腾了有一个多小时也以失败告终，路上几位热心骑友主动帮忙也没能将其换好。无奈，只好打电话向租车店老板求助，要求其换一辆车。</p>\n<p>一个小时后，车子换好了。考虑到第一天的行程比较紧张，有100公里。老板就将我们向前带了20公里。这才保证第一天完成任务。</p>\n<p>像风儿一样自由<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/78905802.jpg\"></p>\n<p>天空触手可及<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/13953071.jpg\"></p>\n<p>雪山清晰可见，只是距离还是有些远<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/21529038.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/12747707.jpg\"></p>\n<p>湖水清澈见底，略咸略苦<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31856606.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/84007068.jpg\"></p>\n<p>可以以假乱真的毛绒玩具<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/93988479.jpg\"></p>\n<p>起飞<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/5161349.jpg\"></p>\n<p>假的洱海，是否有真洱海的感觉？<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/6176193.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/51724586.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/13065274.jpg\"></p>\n<p>羊羊羊<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/6435283.jpg\"></p>\n<p>牛牛牛<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/69617105.jpg\"></p>\n<p>骑马下湖<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16198502.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/74410178.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/177919.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31842491.jpg\"><br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/96146063.jpg\"></p>\n<p>下午一位伙伴的车子又扎胎了，一天两次也是够了。好在是一辆山地车，我们几分钟就换好新胎继续上路。</p>\n<p>未完待续…</p>"},{"title":"青海湖朝圣之旅 第三季 Part 3 （多图预警）","date":"2017-06-04T09:59:23.000Z","_content":"\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n## Day 4\n\n下雨，还是下雨。一路也没有太多风景，同伴也着急赶回去乘火车，遂取消了最后一天的行程，搭乘大巴回到西海镇--环湖的起点。匆匆结束了本次旅行。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/55327230.jpg)\n\n## 全景\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/52069726.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/20398064.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/77920497.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/29920612.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/97568312.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/50992300.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/29109699.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31657203.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/42722245.jpg)\n\n\n\n","source":"_posts/青海湖朝圣之旅-第三季 part3.md","raw":"---\ntitle: 青海湖朝圣之旅 第三季 Part 3 （多图预警）\ndate: 2017-06-04 17:59:23\ntags: 青海湖\ncategories: 图集\n---\n\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n## Day 4\n\n下雨，还是下雨。一路也没有太多风景，同伴也着急赶回去乘火车，遂取消了最后一天的行程，搭乘大巴回到西海镇--环湖的起点。匆匆结束了本次旅行。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/55327230.jpg)\n\n## 全景\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/52069726.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/20398064.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/77920497.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/29920612.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/97568312.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/50992300.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/29109699.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/31657203.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/42722245.jpg)\n\n\n\n","slug":"青海湖朝圣之旅-第三季 part3","published":1,"updated":"2020-09-11T01:04:35.054Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzad004q6wo11osc0xo0","content":"<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>\n<a id=\"more\"></a>\n<h2 id=\"Day-4\"><a href=\"#Day-4\" class=\"headerlink\" title=\"Day 4\"></a>Day 4</h2><p>下雨，还是下雨。一路也没有太多风景，同伴也着急赶回去乘火车，遂取消了最后一天的行程，搭乘大巴回到西海镇–环湖的起点。匆匆结束了本次旅行。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/55327230.jpg\"></p>\n<h2 id=\"全景\"><a href=\"#全景\" class=\"headerlink\" title=\"全景\"></a>全景</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/52069726.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/20398064.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/77920497.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/29920612.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/97568312.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/50992300.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/29109699.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31657203.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/42722245.jpg\"></p>\n","site":{"data":{}},"excerpt":"<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>","more":"<h2 id=\"Day-4\"><a href=\"#Day-4\" class=\"headerlink\" title=\"Day 4\"></a>Day 4</h2><p>下雨，还是下雨。一路也没有太多风景，同伴也着急赶回去乘火车，遂取消了最后一天的行程，搭乘大巴回到西海镇–环湖的起点。匆匆结束了本次旅行。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/55327230.jpg\"></p>\n<h2 id=\"全景\"><a href=\"#全景\" class=\"headerlink\" title=\"全景\"></a>全景</h2><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/52069726.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/20398064.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/77920497.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/29920612.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/97568312.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/50992300.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/29109699.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/31657203.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/42722245.jpg\"></p>"},{"title":"青海湖朝圣之旅 第三季 Part 2 （多图预警）","date":"2017-06-04T09:49:23.000Z","_content":"\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n\n## Day 2\n\n前一天晚上看天气预报说今天有雨，果不其然，起床后就能听到外面的雨声。没办法，还是要赶路啊，今天的任务不多，只有50多公里，下午要赶到黑马河，然后包车去茶卡盐湖。本来挺轻松的一天，被这雨一下子打乱了节奏。\n\n扎胎，还是扎胎，还好已轻车熟路，换好胎立马上路。\n\n即便穿上了雨衣，50公里下来全身还是湿透，手脚麻木冰冷，鞋子里面灌满水可以养金鱼。好在这50公里以下坡为主，且基本一路顺风，大概中午就抵达黑马河安顿下来。\n\n途中海龙兄第二次中招，再次扎胎，只是这次在雨中，没有办法换，且备胎已用完，只能坚持到一个小商店，一行人动手补完了三个轮胎，也是成就感满满。\n\n下雨也无法阻挡我们对于茶卡盐湖的向往。吃完午饭休息片刻就包车前往天空之境。只是雨水一直没停，拍的照片都惨不忍睹，更别提天空之境的感觉了。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/43648678.jpg)\n\n穿着拖鞋去茶卡的貌似只有我们几个了\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/40253221.jpg)\n\n## Day 3\n\n> 阳光总在风雨后\n请相信有彩虹\n\n一觉醒来，惊奇地发现火红的太阳挂在碧绿的湖面，这才拍大腿后悔没有早起去看日出，黑马河的日出闻名遐迩，自己却两次错过，遗憾啊遗憾。\n\n不过今天的天气好到爆炸，也算是弥补了一些遗憾。今天任务繁重，120公里的行程还是以坡路为主，压力比较大。但这样的蓝天白云，这样的雪山，这样的湖水，怎能不停下来记录呢？\n\n### 雪山\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/40138562.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/72768218.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/89582254.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/57861173.jpg)\n\n\n### 天空\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/41274610.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/65916076.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16110640.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/33727324.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/59443804.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/57530305.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/17322450.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/84307153.jpg)\n\n\n\n### 湖水\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16991815.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/60948578.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/62291969.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/80697454.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/923508.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/50823298.jpg)\n\n### 我们\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/58791578.jpg)\n\n在这里抓拍到了最好的一张照片，可惜这不是我们的人\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16297434.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/10526304.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/91390372.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/6578090.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/95725865.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/95070563.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/70286595.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/74980463.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/22844875.jpg)\n\n\n\n\n\n\n","source":"_posts/青海湖朝圣之旅-第三季 part2.md","raw":"---\ntitle: 青海湖朝圣之旅 第三季 Part 2 （多图预警）\ndate: 2017-06-04 17:49:23\ntags: 青海湖\ncategories: 图集\n---\n\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n\n## Day 2\n\n前一天晚上看天气预报说今天有雨，果不其然，起床后就能听到外面的雨声。没办法，还是要赶路啊，今天的任务不多，只有50多公里，下午要赶到黑马河，然后包车去茶卡盐湖。本来挺轻松的一天，被这雨一下子打乱了节奏。\n\n扎胎，还是扎胎，还好已轻车熟路，换好胎立马上路。\n\n即便穿上了雨衣，50公里下来全身还是湿透，手脚麻木冰冷，鞋子里面灌满水可以养金鱼。好在这50公里以下坡为主，且基本一路顺风，大概中午就抵达黑马河安顿下来。\n\n途中海龙兄第二次中招，再次扎胎，只是这次在雨中，没有办法换，且备胎已用完，只能坚持到一个小商店，一行人动手补完了三个轮胎，也是成就感满满。\n\n下雨也无法阻挡我们对于茶卡盐湖的向往。吃完午饭休息片刻就包车前往天空之境。只是雨水一直没停，拍的照片都惨不忍睹，更别提天空之境的感觉了。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/43648678.jpg)\n\n穿着拖鞋去茶卡的貌似只有我们几个了\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/40253221.jpg)\n\n## Day 3\n\n> 阳光总在风雨后\n请相信有彩虹\n\n一觉醒来，惊奇地发现火红的太阳挂在碧绿的湖面，这才拍大腿后悔没有早起去看日出，黑马河的日出闻名遐迩，自己却两次错过，遗憾啊遗憾。\n\n不过今天的天气好到爆炸，也算是弥补了一些遗憾。今天任务繁重，120公里的行程还是以坡路为主，压力比较大。但这样的蓝天白云，这样的雪山，这样的湖水，怎能不停下来记录呢？\n\n### 雪山\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/40138562.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/72768218.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/89582254.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/57861173.jpg)\n\n\n### 天空\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/41274610.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/65916076.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16110640.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/33727324.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/59443804.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/57530305.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/17322450.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/84307153.jpg)\n\n\n\n### 湖水\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16991815.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/60948578.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/62291969.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/80697454.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/923508.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/50823298.jpg)\n\n### 我们\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/58791578.jpg)\n\n在这里抓拍到了最好的一张照片，可惜这不是我们的人\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/16297434.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/10526304.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/91390372.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/6578090.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/95725865.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/95070563.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/70286595.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/74980463.jpg)\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/22844875.jpg)\n\n\n\n\n\n\n","slug":"青海湖朝圣之旅-第三季 part2","published":1,"updated":"2020-09-11T01:04:35.053Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzaf004t6wo16slj8idy","content":"<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"Day-2\"><a href=\"#Day-2\" class=\"headerlink\" title=\"Day 2\"></a>Day 2</h2><p>前一天晚上看天气预报说今天有雨，果不其然，起床后就能听到外面的雨声。没办法，还是要赶路啊，今天的任务不多，只有50多公里，下午要赶到黑马河，然后包车去茶卡盐湖。本来挺轻松的一天，被这雨一下子打乱了节奏。</p>\n<p>扎胎，还是扎胎，还好已轻车熟路，换好胎立马上路。</p>\n<p>即便穿上了雨衣，50公里下来全身还是湿透，手脚麻木冰冷，鞋子里面灌满水可以养金鱼。好在这50公里以下坡为主，且基本一路顺风，大概中午就抵达黑马河安顿下来。</p>\n<p>途中海龙兄第二次中招，再次扎胎，只是这次在雨中，没有办法换，且备胎已用完，只能坚持到一个小商店，一行人动手补完了三个轮胎，也是成就感满满。</p>\n<p>下雨也无法阻挡我们对于茶卡盐湖的向往。吃完午饭休息片刻就包车前往天空之境。只是雨水一直没停，拍的照片都惨不忍睹，更别提天空之境的感觉了。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/43648678.jpg\"></p>\n<p>穿着拖鞋去茶卡的貌似只有我们几个了<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/40253221.jpg\"></p>\n<h2 id=\"Day-3\"><a href=\"#Day-3\" class=\"headerlink\" title=\"Day 3\"></a>Day 3</h2><blockquote>\n<p>阳光总在风雨后<br>请相信有彩虹</p>\n</blockquote>\n<p>一觉醒来，惊奇地发现火红的太阳挂在碧绿的湖面，这才拍大腿后悔没有早起去看日出，黑马河的日出闻名遐迩，自己却两次错过，遗憾啊遗憾。</p>\n<p>不过今天的天气好到爆炸，也算是弥补了一些遗憾。今天任务繁重，120公里的行程还是以坡路为主，压力比较大。但这样的蓝天白云，这样的雪山，这样的湖水，怎能不停下来记录呢？</p>\n<h3 id=\"雪山\"><a href=\"#雪山\" class=\"headerlink\" title=\"雪山\"></a>雪山</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/40138562.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/72768218.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/89582254.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/57861173.jpg\"></p>\n<h3 id=\"天空\"><a href=\"#天空\" class=\"headerlink\" title=\"天空\"></a>天空</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/41274610.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/65916076.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16110640.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/33727324.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/59443804.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/57530305.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/17322450.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/84307153.jpg\"></p>\n<h3 id=\"湖水\"><a href=\"#湖水\" class=\"headerlink\" title=\"湖水\"></a>湖水</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16991815.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/60948578.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/62291969.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/80697454.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/923508.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/50823298.jpg\"></p>\n<h3 id=\"我们\"><a href=\"#我们\" class=\"headerlink\" title=\"我们\"></a>我们</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/58791578.jpg\"></p>\n<p>在这里抓拍到了最好的一张照片，可惜这不是我们的人<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16297434.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/10526304.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/91390372.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/6578090.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/95725865.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/95070563.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/70286595.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/74980463.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/22844875.jpg\"></p>\n","site":{"data":{}},"excerpt":"<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>","more":"<h2 id=\"Day-2\"><a href=\"#Day-2\" class=\"headerlink\" title=\"Day 2\"></a>Day 2</h2><p>前一天晚上看天气预报说今天有雨，果不其然，起床后就能听到外面的雨声。没办法，还是要赶路啊，今天的任务不多，只有50多公里，下午要赶到黑马河，然后包车去茶卡盐湖。本来挺轻松的一天，被这雨一下子打乱了节奏。</p>\n<p>扎胎，还是扎胎，还好已轻车熟路，换好胎立马上路。</p>\n<p>即便穿上了雨衣，50公里下来全身还是湿透，手脚麻木冰冷，鞋子里面灌满水可以养金鱼。好在这50公里以下坡为主，且基本一路顺风，大概中午就抵达黑马河安顿下来。</p>\n<p>途中海龙兄第二次中招，再次扎胎，只是这次在雨中，没有办法换，且备胎已用完，只能坚持到一个小商店，一行人动手补完了三个轮胎，也是成就感满满。</p>\n<p>下雨也无法阻挡我们对于茶卡盐湖的向往。吃完午饭休息片刻就包车前往天空之境。只是雨水一直没停，拍的照片都惨不忍睹，更别提天空之境的感觉了。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/43648678.jpg\"></p>\n<p>穿着拖鞋去茶卡的貌似只有我们几个了<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/40253221.jpg\"></p>\n<h2 id=\"Day-3\"><a href=\"#Day-3\" class=\"headerlink\" title=\"Day 3\"></a>Day 3</h2><blockquote>\n<p>阳光总在风雨后<br>请相信有彩虹</p>\n</blockquote>\n<p>一觉醒来，惊奇地发现火红的太阳挂在碧绿的湖面，这才拍大腿后悔没有早起去看日出，黑马河的日出闻名遐迩，自己却两次错过，遗憾啊遗憾。</p>\n<p>不过今天的天气好到爆炸，也算是弥补了一些遗憾。今天任务繁重，120公里的行程还是以坡路为主，压力比较大。但这样的蓝天白云，这样的雪山，这样的湖水，怎能不停下来记录呢？</p>\n<h3 id=\"雪山\"><a href=\"#雪山\" class=\"headerlink\" title=\"雪山\"></a>雪山</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/40138562.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/72768218.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/89582254.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/57861173.jpg\"></p>\n<h3 id=\"天空\"><a href=\"#天空\" class=\"headerlink\" title=\"天空\"></a>天空</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/41274610.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/65916076.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16110640.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/33727324.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/59443804.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/57530305.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/17322450.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/84307153.jpg\"></p>\n<h3 id=\"湖水\"><a href=\"#湖水\" class=\"headerlink\" title=\"湖水\"></a>湖水</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16991815.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/60948578.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/62291969.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/80697454.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/923508.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/50823298.jpg\"></p>\n<h3 id=\"我们\"><a href=\"#我们\" class=\"headerlink\" title=\"我们\"></a>我们</h3><p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/58791578.jpg\"></p>\n<p>在这里抓拍到了最好的一张照片，可惜这不是我们的人<br><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/16297434.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/10526304.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/91390372.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/6578090.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/95725865.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/95070563.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/70286595.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/74980463.jpg\"></p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/22844875.jpg\"></p>"},{"title":"青海湖朝圣之旅 第三季 Part 4（多图预警）","date":"2017-06-04T10:19:23.000Z","_content":"\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n\n## 感动\n\n都说一方水土养一方人，这里的人朴实、热心，如天空和湖水般澄澈而一尘不染。这里列几件小事加以佐证。\n\n1. 四年前环湖的第三天早晨，还下着小雨，很冷。我们刚刚踏上行程，同伴的车胎就扎胎了。这也是我这么多年来第一次遇见扎胎。虽然之前见过别人补胎，但是轮到自己动手，还是有着意想不到的难度。而且当时还下着雨，可以说是非常绝望的情况。我们刚把轮胎拆下，路边小店的一位藏族小哥就走了出来，二话不说就将我们拽进了店里，也不顾泥水弄脏地面，熟练得开始帮我们补胎。我们站在旁边，束手无策，眼睁睁看着藏族小哥帮我们补完胎打完气。除了感谢，就是感动。\n2. 这次抵达西海镇后，我们找到一个空旷的地方放飞无人机。玩累了之后，看到旁边有一大家子人在野炊，煮着什么东西。我们好奇地凑上前去看看煮了什么东西。他们就主动招呼我们，把各种东西拿给我们吃。我们给他们的小孩子红包他们也不要。我们几个吃到基本都不用吃晚饭。后来他们还邀请我们环湖结束到到他们家去做客，后来由于其他情况未能成行。但这种热情好客着实让我们非常感动。\n\n    ![](http://omp48p40q.bkt.clouddn.com/17-6-4/87087269.jpg)\n    \n    ![](http://omp48p40q.bkt.clouddn.com/17-6-4/96578581.jpg)\n    \n3. 租车时，我们向老板索要车锁，老板说没有，从来没有向租车者提供过车锁，这里任何地方都不会有人偷车。在路上餐馆吃饭的时候，我们也尽量找靠窗的座位，并时不时向窗外多看两眼。餐馆老板见状就说，放心吧，这里安全得很，不会丢的。这里民风之淳朴，除了感动还是感动。\n4. 虽然车子坏了，租车店老板主动驱车赶来帮忙似乎是他分内的，但他大老远赶到我们的所在地，并给更换了一辆新车（美利达挑战者300，前一天我一直想选的车）。考虑到我们的行程安排，将我们向前带了20公里。\n5. 不管我们是去买汽车票，还是去吃饭、去邮局等，旅店老板都会将我们带过去，给我们节省了不少时间。最后我们离开时将房间打扫干净，不留垃圾，并将一些路上买的装备送给了他，算是感谢吧。（注：租车店老板和旅店老板是同一人，这里基本都是提供全套服务。）\n4. 第二天冷雨中骑行50公里，抵达黑马河的时候手脚麻木冰凉，几无知觉。找了一家餐馆还没有点菜，老板就招呼我们到后厨烤烤火，并给我们倒上了热水。最后结账的时候还给我们打了折，并带上了两壶热水。心里暖暖的。\n5. 茶卡盐湖的售票姑娘也非常热心，我们买票的时候下着毛毛雨，她提醒我们说今天肯定拍不出天空之境，不如明天再来，明天天气晴，而且是新园开园一周年，明天免票。无奈我们行程紧，时间有限，第二天肯定来不了，只能买票进去。\n6. 在刚察，一天骑行120公里，队友们都累了。旅店老板提前出门迎接，用三轮车将我们带到了住的地方。我们累得不想出门，老板就去买肉和菜，帮我们做晚饭，并只收了一点点加工费。第二天还是主动提供早饭，并冒雨去为我们买好了回西海镇的大巴票。感动无以言表，加老板微信并发了个红包表达谢意。\n\n    ![](http://omp48p40q.bkt.clouddn.com/17-6-4/5322015.jpg)\n\n4. 不知是骑友都如此热心还是受到这里民风的感染，路上我们几个扎胎，骑友们经过都会主动询问情况，并主动提供工具或者帮忙补、换。虽然没有他们的帮忙我们也能完成此次行程，但骑友们主动提供帮助还是让我们十分感动。\n5. 还有很多很多，有些记忆不够深刻。留着以后有机会再去感受吧。\n\n\n## 几个小遗憾\n\n1. 由于车子是在环湖东湖坏掉的，老板带我们的20公里就把湖边沙漠这个景观错过了，当时天气还非常好，所以非常遗憾。那本该是第一次近距离接触湖水的地方。\n2. 最大的遗憾应该是在第二天，驱车去茶卡盐湖的路上，天气状况由小雨到多云，似乎还看到了太阳出来的苗头，司机师傅也说黑马河地区下雨，茶卡不下，这让我们平添了很多期待。但天公仍不作美，在茶卡的两个小时天空一片阴霾，根本拍不出天空之境的感觉。游玩的兴致一下子烟消云散。 \n3. 淡季人少，一个主要的原因是油菜花还未盛开。这次没有见到油菜花，景色稍显黯淡。\n4. 大部分时间在下雨，天近蓝和湖蓝只在第三天看得到，其余几天拍的照片都挺惨。\n5. 还是由于下雨，一直念叨的第四天的连续4公里上坡未能挑战。留着下次吧。\n6. 下雨，以及车子故障（4人次车胎问题，也算是人品大爆炸），这次没能完整得骑完360公里环湖路。不过之前两次都完整地骑完了，这次也能原谅自己吧。\n7. 日出，还是日出，其实第三天早晨本应该可以看到黑马河日出的，但还是因为心里没底所以没有去看。我就这么与日出无缘么？北戴河的日出，下雨没看成；三亚的日出，下雨没看成；上一次黑马河的日出，下雨没看成；这一次黑马河日出，前一天下雨所以没早起去看。。。\n\n\n## 后记\n\n为什么这么喜欢青海湖这个地方？首先，我最心水的景色就是纯净、天然、没有人工痕迹。青海湖恰恰符合这些要求，即使有人工痕迹，也是牧民围起来的栅栏，用于放牧，而不是商业运作。天空蓝得干净，可以洗眼睛；白云白净而活泼；雪山明亮而庄严；路面干净；湖水清澈，湖蓝色很漂亮；油菜花一望无际；动物很多且是这里的主人，过马路时行人车辆都要避让，人与自然和谐而美好；更不必说这里的人们善良而淳朴了，这构成一幅完美的画面，让我流连忘返。\n\n反观茶卡盐湖，这次尽管是天气的原因没有拍到好照片，但其他几个方面却将其在我心中的完美印象击得粉碎。票价上提了50%情有可原，毕竟已经过去了四年。但是其他的收费项目真是如雨后春笋般出现。首先从售票口到接近盐湖的地方修了一条长长的“观光路”，有观光车来往，走路进去大概要耽误二三十分钟。火车轨道和湖边都被长长的栅栏围了起来，游客与狗不得靠近。原本任何地方都可以直接下到湖里，尽情拍照游玩，现在呢，想要翻过栅栏就有工作人员对你大喊大叫，想要下到湖里拍照只能再多走二三十分钟的路，否则就买票坐小火车去。兴致一下子大打折扣。比这样的天气还要恶心。餐馆、纪念品商店更是多如牛毛，到处散发着过度商业化的铜臭味。已经不是我记忆中纯净的天空之境了。但愿青海湖还能保持其自然纯净，不要受商业化的打扰。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/51772514.jpg)\n\n青海湖我必然还会再去，这样的茶卡盐湖，我想我可能不会再去了。\n\n","source":"_posts/青海湖朝圣之旅-第三季 part4.md","raw":"---\ntitle: 青海湖朝圣之旅 第三季 Part 4（多图预警）\ndate: 2017-06-04 18:19:23\ntags: 青海湖\ncategories: 图集\n---\n\n已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。\n\n<!--more-->\n\n## 感动\n\n都说一方水土养一方人，这里的人朴实、热心，如天空和湖水般澄澈而一尘不染。这里列几件小事加以佐证。\n\n1. 四年前环湖的第三天早晨，还下着小雨，很冷。我们刚刚踏上行程，同伴的车胎就扎胎了。这也是我这么多年来第一次遇见扎胎。虽然之前见过别人补胎，但是轮到自己动手，还是有着意想不到的难度。而且当时还下着雨，可以说是非常绝望的情况。我们刚把轮胎拆下，路边小店的一位藏族小哥就走了出来，二话不说就将我们拽进了店里，也不顾泥水弄脏地面，熟练得开始帮我们补胎。我们站在旁边，束手无策，眼睁睁看着藏族小哥帮我们补完胎打完气。除了感谢，就是感动。\n2. 这次抵达西海镇后，我们找到一个空旷的地方放飞无人机。玩累了之后，看到旁边有一大家子人在野炊，煮着什么东西。我们好奇地凑上前去看看煮了什么东西。他们就主动招呼我们，把各种东西拿给我们吃。我们给他们的小孩子红包他们也不要。我们几个吃到基本都不用吃晚饭。后来他们还邀请我们环湖结束到到他们家去做客，后来由于其他情况未能成行。但这种热情好客着实让我们非常感动。\n\n    ![](http://omp48p40q.bkt.clouddn.com/17-6-4/87087269.jpg)\n    \n    ![](http://omp48p40q.bkt.clouddn.com/17-6-4/96578581.jpg)\n    \n3. 租车时，我们向老板索要车锁，老板说没有，从来没有向租车者提供过车锁，这里任何地方都不会有人偷车。在路上餐馆吃饭的时候，我们也尽量找靠窗的座位，并时不时向窗外多看两眼。餐馆老板见状就说，放心吧，这里安全得很，不会丢的。这里民风之淳朴，除了感动还是感动。\n4. 虽然车子坏了，租车店老板主动驱车赶来帮忙似乎是他分内的，但他大老远赶到我们的所在地，并给更换了一辆新车（美利达挑战者300，前一天我一直想选的车）。考虑到我们的行程安排，将我们向前带了20公里。\n5. 不管我们是去买汽车票，还是去吃饭、去邮局等，旅店老板都会将我们带过去，给我们节省了不少时间。最后我们离开时将房间打扫干净，不留垃圾，并将一些路上买的装备送给了他，算是感谢吧。（注：租车店老板和旅店老板是同一人，这里基本都是提供全套服务。）\n4. 第二天冷雨中骑行50公里，抵达黑马河的时候手脚麻木冰凉，几无知觉。找了一家餐馆还没有点菜，老板就招呼我们到后厨烤烤火，并给我们倒上了热水。最后结账的时候还给我们打了折，并带上了两壶热水。心里暖暖的。\n5. 茶卡盐湖的售票姑娘也非常热心，我们买票的时候下着毛毛雨，她提醒我们说今天肯定拍不出天空之境，不如明天再来，明天天气晴，而且是新园开园一周年，明天免票。无奈我们行程紧，时间有限，第二天肯定来不了，只能买票进去。\n6. 在刚察，一天骑行120公里，队友们都累了。旅店老板提前出门迎接，用三轮车将我们带到了住的地方。我们累得不想出门，老板就去买肉和菜，帮我们做晚饭，并只收了一点点加工费。第二天还是主动提供早饭，并冒雨去为我们买好了回西海镇的大巴票。感动无以言表，加老板微信并发了个红包表达谢意。\n\n    ![](http://omp48p40q.bkt.clouddn.com/17-6-4/5322015.jpg)\n\n4. 不知是骑友都如此热心还是受到这里民风的感染，路上我们几个扎胎，骑友们经过都会主动询问情况，并主动提供工具或者帮忙补、换。虽然没有他们的帮忙我们也能完成此次行程，但骑友们主动提供帮助还是让我们十分感动。\n5. 还有很多很多，有些记忆不够深刻。留着以后有机会再去感受吧。\n\n\n## 几个小遗憾\n\n1. 由于车子是在环湖东湖坏掉的，老板带我们的20公里就把湖边沙漠这个景观错过了，当时天气还非常好，所以非常遗憾。那本该是第一次近距离接触湖水的地方。\n2. 最大的遗憾应该是在第二天，驱车去茶卡盐湖的路上，天气状况由小雨到多云，似乎还看到了太阳出来的苗头，司机师傅也说黑马河地区下雨，茶卡不下，这让我们平添了很多期待。但天公仍不作美，在茶卡的两个小时天空一片阴霾，根本拍不出天空之境的感觉。游玩的兴致一下子烟消云散。 \n3. 淡季人少，一个主要的原因是油菜花还未盛开。这次没有见到油菜花，景色稍显黯淡。\n4. 大部分时间在下雨，天近蓝和湖蓝只在第三天看得到，其余几天拍的照片都挺惨。\n5. 还是由于下雨，一直念叨的第四天的连续4公里上坡未能挑战。留着下次吧。\n6. 下雨，以及车子故障（4人次车胎问题，也算是人品大爆炸），这次没能完整得骑完360公里环湖路。不过之前两次都完整地骑完了，这次也能原谅自己吧。\n7. 日出，还是日出，其实第三天早晨本应该可以看到黑马河日出的，但还是因为心里没底所以没有去看。我就这么与日出无缘么？北戴河的日出，下雨没看成；三亚的日出，下雨没看成；上一次黑马河的日出，下雨没看成；这一次黑马河日出，前一天下雨所以没早起去看。。。\n\n\n## 后记\n\n为什么这么喜欢青海湖这个地方？首先，我最心水的景色就是纯净、天然、没有人工痕迹。青海湖恰恰符合这些要求，即使有人工痕迹，也是牧民围起来的栅栏，用于放牧，而不是商业运作。天空蓝得干净，可以洗眼睛；白云白净而活泼；雪山明亮而庄严；路面干净；湖水清澈，湖蓝色很漂亮；油菜花一望无际；动物很多且是这里的主人，过马路时行人车辆都要避让，人与自然和谐而美好；更不必说这里的人们善良而淳朴了，这构成一幅完美的画面，让我流连忘返。\n\n反观茶卡盐湖，这次尽管是天气的原因没有拍到好照片，但其他几个方面却将其在我心中的完美印象击得粉碎。票价上提了50%情有可原，毕竟已经过去了四年。但是其他的收费项目真是如雨后春笋般出现。首先从售票口到接近盐湖的地方修了一条长长的“观光路”，有观光车来往，走路进去大概要耽误二三十分钟。火车轨道和湖边都被长长的栅栏围了起来，游客与狗不得靠近。原本任何地方都可以直接下到湖里，尽情拍照游玩，现在呢，想要翻过栅栏就有工作人员对你大喊大叫，想要下到湖里拍照只能再多走二三十分钟的路，否则就买票坐小火车去。兴致一下子大打折扣。比这样的天气还要恶心。餐馆、纪念品商店更是多如牛毛，到处散发着过度商业化的铜臭味。已经不是我记忆中纯净的天空之境了。但愿青海湖还能保持其自然纯净，不要受商业化的打扰。\n\n![](http://omp48p40q.bkt.clouddn.com/17-6-4/51772514.jpg)\n\n青海湖我必然还会再去，这样的茶卡盐湖，我想我可能不会再去了。\n\n","slug":"青海湖朝圣之旅-第三季 part4","published":1,"updated":"2020-09-11T01:04:35.054Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzag004v6wo1737kfhlg","content":"<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"感动\"><a href=\"#感动\" class=\"headerlink\" title=\"感动\"></a>感动</h2><p>都说一方水土养一方人，这里的人朴实、热心，如天空和湖水般澄澈而一尘不染。这里列几件小事加以佐证。</p>\n<ol>\n<li><p>四年前环湖的第三天早晨，还下着小雨，很冷。我们刚刚踏上行程，同伴的车胎就扎胎了。这也是我这么多年来第一次遇见扎胎。虽然之前见过别人补胎，但是轮到自己动手，还是有着意想不到的难度。而且当时还下着雨，可以说是非常绝望的情况。我们刚把轮胎拆下，路边小店的一位藏族小哥就走了出来，二话不说就将我们拽进了店里，也不顾泥水弄脏地面，熟练得开始帮我们补胎。我们站在旁边，束手无策，眼睁睁看着藏族小哥帮我们补完胎打完气。除了感谢，就是感动。</p>\n</li>\n<li><p>这次抵达西海镇后，我们找到一个空旷的地方放飞无人机。玩累了之后，看到旁边有一大家子人在野炊，煮着什么东西。我们好奇地凑上前去看看煮了什么东西。他们就主动招呼我们，把各种东西拿给我们吃。我们给他们的小孩子红包他们也不要。我们几个吃到基本都不用吃晚饭。后来他们还邀请我们环湖结束到到他们家去做客，后来由于其他情况未能成行。但这种热情好客着实让我们非常感动。</p>\n<p> <img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/87087269.jpg\"></p>\n<p> <img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/96578581.jpg\"></p>\n</li>\n<li><p>租车时，我们向老板索要车锁，老板说没有，从来没有向租车者提供过车锁，这里任何地方都不会有人偷车。在路上餐馆吃饭的时候，我们也尽量找靠窗的座位，并时不时向窗外多看两眼。餐馆老板见状就说，放心吧，这里安全得很，不会丢的。这里民风之淳朴，除了感动还是感动。</p>\n</li>\n<li><p>虽然车子坏了，租车店老板主动驱车赶来帮忙似乎是他分内的，但他大老远赶到我们的所在地，并给更换了一辆新车（美利达挑战者300，前一天我一直想选的车）。考虑到我们的行程安排，将我们向前带了20公里。</p>\n</li>\n<li><p>不管我们是去买汽车票，还是去吃饭、去邮局等，旅店老板都会将我们带过去，给我们节省了不少时间。最后我们离开时将房间打扫干净，不留垃圾，并将一些路上买的装备送给了他，算是感谢吧。（注：租车店老板和旅店老板是同一人，这里基本都是提供全套服务。）</p>\n</li>\n<li><p>第二天冷雨中骑行50公里，抵达黑马河的时候手脚麻木冰凉，几无知觉。找了一家餐馆还没有点菜，老板就招呼我们到后厨烤烤火，并给我们倒上了热水。最后结账的时候还给我们打了折，并带上了两壶热水。心里暖暖的。</p>\n</li>\n<li><p>茶卡盐湖的售票姑娘也非常热心，我们买票的时候下着毛毛雨，她提醒我们说今天肯定拍不出天空之境，不如明天再来，明天天气晴，而且是新园开园一周年，明天免票。无奈我们行程紧，时间有限，第二天肯定来不了，只能买票进去。</p>\n</li>\n<li><p>在刚察，一天骑行120公里，队友们都累了。旅店老板提前出门迎接，用三轮车将我们带到了住的地方。我们累得不想出门，老板就去买肉和菜，帮我们做晚饭，并只收了一点点加工费。第二天还是主动提供早饭，并冒雨去为我们买好了回西海镇的大巴票。感动无以言表，加老板微信并发了个红包表达谢意。</p>\n<p> <img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/5322015.jpg\"></p>\n</li>\n<li><p>不知是骑友都如此热心还是受到这里民风的感染，路上我们几个扎胎，骑友们经过都会主动询问情况，并主动提供工具或者帮忙补、换。虽然没有他们的帮忙我们也能完成此次行程，但骑友们主动提供帮助还是让我们十分感动。</p>\n</li>\n<li><p>还有很多很多，有些记忆不够深刻。留着以后有机会再去感受吧。</p>\n</li>\n</ol>\n<h2 id=\"几个小遗憾\"><a href=\"#几个小遗憾\" class=\"headerlink\" title=\"几个小遗憾\"></a>几个小遗憾</h2><ol>\n<li>由于车子是在环湖东湖坏掉的，老板带我们的20公里就把湖边沙漠这个景观错过了，当时天气还非常好，所以非常遗憾。那本该是第一次近距离接触湖水的地方。</li>\n<li>最大的遗憾应该是在第二天，驱车去茶卡盐湖的路上，天气状况由小雨到多云，似乎还看到了太阳出来的苗头，司机师傅也说黑马河地区下雨，茶卡不下，这让我们平添了很多期待。但天公仍不作美，在茶卡的两个小时天空一片阴霾，根本拍不出天空之境的感觉。游玩的兴致一下子烟消云散。 </li>\n<li>淡季人少，一个主要的原因是油菜花还未盛开。这次没有见到油菜花，景色稍显黯淡。</li>\n<li>大部分时间在下雨，天近蓝和湖蓝只在第三天看得到，其余几天拍的照片都挺惨。</li>\n<li>还是由于下雨，一直念叨的第四天的连续4公里上坡未能挑战。留着下次吧。</li>\n<li>下雨，以及车子故障（4人次车胎问题，也算是人品大爆炸），这次没能完整得骑完360公里环湖路。不过之前两次都完整地骑完了，这次也能原谅自己吧。</li>\n<li>日出，还是日出，其实第三天早晨本应该可以看到黑马河日出的，但还是因为心里没底所以没有去看。我就这么与日出无缘么？北戴河的日出，下雨没看成；三亚的日出，下雨没看成；上一次黑马河的日出，下雨没看成；这一次黑马河日出，前一天下雨所以没早起去看。。。</li>\n</ol>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><p>为什么这么喜欢青海湖这个地方？首先，我最心水的景色就是纯净、天然、没有人工痕迹。青海湖恰恰符合这些要求，即使有人工痕迹，也是牧民围起来的栅栏，用于放牧，而不是商业运作。天空蓝得干净，可以洗眼睛；白云白净而活泼；雪山明亮而庄严；路面干净；湖水清澈，湖蓝色很漂亮；油菜花一望无际；动物很多且是这里的主人，过马路时行人车辆都要避让，人与自然和谐而美好；更不必说这里的人们善良而淳朴了，这构成一幅完美的画面，让我流连忘返。</p>\n<p>反观茶卡盐湖，这次尽管是天气的原因没有拍到好照片，但其他几个方面却将其在我心中的完美印象击得粉碎。票价上提了50%情有可原，毕竟已经过去了四年。但是其他的收费项目真是如雨后春笋般出现。首先从售票口到接近盐湖的地方修了一条长长的“观光路”，有观光车来往，走路进去大概要耽误二三十分钟。火车轨道和湖边都被长长的栅栏围了起来，游客与狗不得靠近。原本任何地方都可以直接下到湖里，尽情拍照游玩，现在呢，想要翻过栅栏就有工作人员对你大喊大叫，想要下到湖里拍照只能再多走二三十分钟的路，否则就买票坐小火车去。兴致一下子大打折扣。比这样的天气还要恶心。餐馆、纪念品商店更是多如牛毛，到处散发着过度商业化的铜臭味。已经不是我记忆中纯净的天空之境了。但愿青海湖还能保持其自然纯净，不要受商业化的打扰。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/51772514.jpg\"></p>\n<p>青海湖我必然还会再去，这样的茶卡盐湖，我想我可能不会再去了。</p>\n","site":{"data":{}},"excerpt":"<p>已经接近两年没有一次实质性的旅行了，本就计划今年内做一次短途旅行，给自己的眼睛和心灵放放假。</p>","more":"<h2 id=\"感动\"><a href=\"#感动\" class=\"headerlink\" title=\"感动\"></a>感动</h2><p>都说一方水土养一方人，这里的人朴实、热心，如天空和湖水般澄澈而一尘不染。这里列几件小事加以佐证。</p>\n<ol>\n<li><p>四年前环湖的第三天早晨，还下着小雨，很冷。我们刚刚踏上行程，同伴的车胎就扎胎了。这也是我这么多年来第一次遇见扎胎。虽然之前见过别人补胎，但是轮到自己动手，还是有着意想不到的难度。而且当时还下着雨，可以说是非常绝望的情况。我们刚把轮胎拆下，路边小店的一位藏族小哥就走了出来，二话不说就将我们拽进了店里，也不顾泥水弄脏地面，熟练得开始帮我们补胎。我们站在旁边，束手无策，眼睁睁看着藏族小哥帮我们补完胎打完气。除了感谢，就是感动。</p>\n</li>\n<li><p>这次抵达西海镇后，我们找到一个空旷的地方放飞无人机。玩累了之后，看到旁边有一大家子人在野炊，煮着什么东西。我们好奇地凑上前去看看煮了什么东西。他们就主动招呼我们，把各种东西拿给我们吃。我们给他们的小孩子红包他们也不要。我们几个吃到基本都不用吃晚饭。后来他们还邀请我们环湖结束到到他们家去做客，后来由于其他情况未能成行。但这种热情好客着实让我们非常感动。</p>\n<p> <img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/87087269.jpg\"></p>\n<p> <img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/96578581.jpg\"></p>\n</li>\n<li><p>租车时，我们向老板索要车锁，老板说没有，从来没有向租车者提供过车锁，这里任何地方都不会有人偷车。在路上餐馆吃饭的时候，我们也尽量找靠窗的座位，并时不时向窗外多看两眼。餐馆老板见状就说，放心吧，这里安全得很，不会丢的。这里民风之淳朴，除了感动还是感动。</p>\n</li>\n<li><p>虽然车子坏了，租车店老板主动驱车赶来帮忙似乎是他分内的，但他大老远赶到我们的所在地，并给更换了一辆新车（美利达挑战者300，前一天我一直想选的车）。考虑到我们的行程安排，将我们向前带了20公里。</p>\n</li>\n<li><p>不管我们是去买汽车票，还是去吃饭、去邮局等，旅店老板都会将我们带过去，给我们节省了不少时间。最后我们离开时将房间打扫干净，不留垃圾，并将一些路上买的装备送给了他，算是感谢吧。（注：租车店老板和旅店老板是同一人，这里基本都是提供全套服务。）</p>\n</li>\n<li><p>第二天冷雨中骑行50公里，抵达黑马河的时候手脚麻木冰凉，几无知觉。找了一家餐馆还没有点菜，老板就招呼我们到后厨烤烤火，并给我们倒上了热水。最后结账的时候还给我们打了折，并带上了两壶热水。心里暖暖的。</p>\n</li>\n<li><p>茶卡盐湖的售票姑娘也非常热心，我们买票的时候下着毛毛雨，她提醒我们说今天肯定拍不出天空之境，不如明天再来，明天天气晴，而且是新园开园一周年，明天免票。无奈我们行程紧，时间有限，第二天肯定来不了，只能买票进去。</p>\n</li>\n<li><p>在刚察，一天骑行120公里，队友们都累了。旅店老板提前出门迎接，用三轮车将我们带到了住的地方。我们累得不想出门，老板就去买肉和菜，帮我们做晚饭，并只收了一点点加工费。第二天还是主动提供早饭，并冒雨去为我们买好了回西海镇的大巴票。感动无以言表，加老板微信并发了个红包表达谢意。</p>\n<p> <img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/5322015.jpg\"></p>\n</li>\n<li><p>不知是骑友都如此热心还是受到这里民风的感染，路上我们几个扎胎，骑友们经过都会主动询问情况，并主动提供工具或者帮忙补、换。虽然没有他们的帮忙我们也能完成此次行程，但骑友们主动提供帮助还是让我们十分感动。</p>\n</li>\n<li><p>还有很多很多，有些记忆不够深刻。留着以后有机会再去感受吧。</p>\n</li>\n</ol>\n<h2 id=\"几个小遗憾\"><a href=\"#几个小遗憾\" class=\"headerlink\" title=\"几个小遗憾\"></a>几个小遗憾</h2><ol>\n<li>由于车子是在环湖东湖坏掉的，老板带我们的20公里就把湖边沙漠这个景观错过了，当时天气还非常好，所以非常遗憾。那本该是第一次近距离接触湖水的地方。</li>\n<li>最大的遗憾应该是在第二天，驱车去茶卡盐湖的路上，天气状况由小雨到多云，似乎还看到了太阳出来的苗头，司机师傅也说黑马河地区下雨，茶卡不下，这让我们平添了很多期待。但天公仍不作美，在茶卡的两个小时天空一片阴霾，根本拍不出天空之境的感觉。游玩的兴致一下子烟消云散。 </li>\n<li>淡季人少，一个主要的原因是油菜花还未盛开。这次没有见到油菜花，景色稍显黯淡。</li>\n<li>大部分时间在下雨，天近蓝和湖蓝只在第三天看得到，其余几天拍的照片都挺惨。</li>\n<li>还是由于下雨，一直念叨的第四天的连续4公里上坡未能挑战。留着下次吧。</li>\n<li>下雨，以及车子故障（4人次车胎问题，也算是人品大爆炸），这次没能完整得骑完360公里环湖路。不过之前两次都完整地骑完了，这次也能原谅自己吧。</li>\n<li>日出，还是日出，其实第三天早晨本应该可以看到黑马河日出的，但还是因为心里没底所以没有去看。我就这么与日出无缘么？北戴河的日出，下雨没看成；三亚的日出，下雨没看成；上一次黑马河的日出，下雨没看成；这一次黑马河日出，前一天下雨所以没早起去看。。。</li>\n</ol>\n<h2 id=\"后记\"><a href=\"#后记\" class=\"headerlink\" title=\"后记\"></a>后记</h2><p>为什么这么喜欢青海湖这个地方？首先，我最心水的景色就是纯净、天然、没有人工痕迹。青海湖恰恰符合这些要求，即使有人工痕迹，也是牧民围起来的栅栏，用于放牧，而不是商业运作。天空蓝得干净，可以洗眼睛；白云白净而活泼；雪山明亮而庄严；路面干净；湖水清澈，湖蓝色很漂亮；油菜花一望无际；动物很多且是这里的主人，过马路时行人车辆都要避让，人与自然和谐而美好；更不必说这里的人们善良而淳朴了，这构成一幅完美的画面，让我流连忘返。</p>\n<p>反观茶卡盐湖，这次尽管是天气的原因没有拍到好照片，但其他几个方面却将其在我心中的完美印象击得粉碎。票价上提了50%情有可原，毕竟已经过去了四年。但是其他的收费项目真是如雨后春笋般出现。首先从售票口到接近盐湖的地方修了一条长长的“观光路”，有观光车来往，走路进去大概要耽误二三十分钟。火车轨道和湖边都被长长的栅栏围了起来，游客与狗不得靠近。原本任何地方都可以直接下到湖里，尽情拍照游玩，现在呢，想要翻过栅栏就有工作人员对你大喊大叫，想要下到湖里拍照只能再多走二三十分钟的路，否则就买票坐小火车去。兴致一下子大打折扣。比这样的天气还要恶心。餐馆、纪念品商店更是多如牛毛，到处散发着过度商业化的铜臭味。已经不是我记忆中纯净的天空之境了。但愿青海湖还能保持其自然纯净，不要受商业化的打扰。</p>\n<p><img src=\"http://omp48p40q.bkt.clouddn.com/17-6-4/51772514.jpg\"></p>\n<p>青海湖我必然还会再去，这样的茶卡盐湖，我想我可能不会再去了。</p>"},{"title":"高并发和大流量解决方案","date":"2018-02-15T08:28:43.000Z","_content":"\n这是慕课网相关课程的学习笔记，在此记录一下，方便查阅。\n\n> 真题：PHP如何解决网站大流量和高并发的问题？\n\n1. 考点\n- 高并发架构相关概念\n- 高并发解决方案案例\n\n<!-- more -->\n\n### 1. 高并发架构相关概念\n\n#### 1. 并发\n\n> 在操作系统中，是指一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个处理机上运行，但任意时刻点上只有一个程序在处理机上运行。\n\n我们所说的高并发：在互联网时代，所讲的并发、高并发，通常是指并发访问。也就是在摸个时间点，有多少个访问同时到来。\n\n通过一个系统的日PV在千万以上，有可能是一个高并发的系统。\n\n高并发具体应该关心什么？\n\n- QPS：每秒请求或者查询的数量，在互联网领域，指每秒响应请求数（指http请求）；\n- 吞吐量：单位时间内处理的请求数量（通常由QPS和并发数决定）；\n- 响应时间：从请求发出到收到响应花费的时间。例如一个系统处理一个http请求需要100ms，这个100ms就是系统的响应时间；\n- PV：综合浏览量 page view， 即页面的浏览量或者点击量，访客在24小时内访问的页面数量。刷新页面不计入，同一访客浏览同一网页页面，只记作一次PV；\n- UV：独立访客 unique visitor；\n- 带宽：计算带宽大小需关注两个指标，峰值流量和页面的平均大小，峰值一般是平均值的倍数，根据实际情况来定；\n- 日网站带宽： PV/统计时间（s）\\* 平均页面大小（KB）\\* 8\n\n\n> 注意： QPS 不等于 并发连接数。QPS是每秒http请求数量，并发连接数是系统同时处理的请求数量。\n\n峰值每秒请求数(QPS) = (总PV数 * 80%)/(6小时秒数 * 20%)  即80% 的访问量集中在20% 的时间内。二八定律\n\n压力测试：\n- 测试能承受的最大并发数；\n- 测试最大承受的QPS值。\n- \n\n常用性能测试工具： ab (apache benchmark) , wrk, http_load, Web Bench\n\nab的使用：模拟并发请求100次 -c concurrency，总共请求5000次 -n requests。\n\n```\nab -c 100 -n 5000 http://website\n```\n\n注意事项：\n- 测试机器与被测试机器分开\n- 不要对线上服务做压力测试\n- 观察测试工具ab所在机器，以及被测试的前端机的CPU、内存、网络等都不超过最高限度的75% （top）\n\n```\nbogon% ab -c 10 -n 100 https://www.zouzhipeng.com/\nThis is ApacheBench, Version 2.3 <$Revision: 1807734 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking www.zouzhipeng.com (be patient).....done\n\n\nServer Software:        nginx/1.10.2\nServer Hostname:        www.zouzhipeng.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128\nTLS Server Name:        www.zouzhipeng.com\n\nDocument Path:          /\nDocument Length:        41106 bytes\n\nConcurrency Level:      10 （并发数）\nTime taken for tests:   33.520 seconds\nComplete requests:      100\nFailed requests:        0 （失败请求数，成功率95%以上才有意义）\nTotal transferred:      4134200 bytes\nHTML transferred:       4110600 bytes\nRequests per second:    2.98 [#/sec] (mean) （这个就是QPS）\nTime per request:       3352.033 [ms] (mean)\nTime per request:       335.203 [ms] (mean, across all concurrent requests)\nTransfer rate:          120.44 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:       26  199 300.1     44    1472\nProcessing:    19 2983 1884.0   2765   11618\nWaiting:       16 1327 1079.2   1066    5585\nTotal:        175 3182 1932.9   2848   11662\n\nPercentage of the requests served within a certain time (ms)\n  50%   2848\n  66%   3786\n  75%   4321\n  80%   4742\n  90%   5732\n  95%   6377\n  98%   8345\n  99%  11662\n 100%  11662 (longest request)\n```\n\nQPS如果达到极限，该如何处理？\n\n随着QPS的增长，每个阶段需要根据时间情况来进行优化，优化的方案也与硬件条件、网络带宽息息相关。\n\n1. QPS达到50：可以称之为小型网站，一般的服务器就可以应付，无需优化；\n2. QPS达到100：假设关系型数据库的每次请求在0.01秒完成（理想状态），假设单个页面只有一个sql查询，那么100QPS意味着1秒钟完成100次请求，但是此时并不能保证数据库查询能完成100次。即瓶颈在数据库，方案：数据库缓存层、数据库的负载均衡；\n3. QPS达到800：假设使用百兆带宽，意味着网站的出口实际带宽有8M左右。假设每个页面只有10K，在这个并发条件下，百兆带宽已经吃完。即带宽此时是瓶颈，方案：CDN加速、负载均衡；\n4. QPS达到1000：假设使用redis或memcache缓存数据库查询数据，每个页面对memcache的请求远大于直接对DB的请求，memcache的悲观并发数在20k左右，但有可能在之前内网带宽已经吃完，表现出不稳定。方案：静态HTML缓存；\n5. QPS达到2000：这个级别下，文件系统访问锁都成为了灾难，方案：做业务分离，分布式存储。\n\n解决：首先回答怎么测试单击QPS极限值，针对不同的QPS做不同的优化。\n\n\n### 高并发解决方案案例\n\n#### 1. 流量优化\n1. 防盗链处理，将恶意请求拒之门外\n\n#### 2. 前端优化\n\n1. 减少http请求，合并css，合并js，合并图片或将图片转至oss\n2. 添加异步请求，不太重要的内容异步处理，事件驱动。\n3. 启用浏览器缓存，如 localStorage 和文件压缩，如压缩图片，nginx gzip等\n4. CDN 加速，同时能缓解带宽压力\n5. 建立独立的图片服务器、文件服务器，或者使用对象存储\n\n#### 3. 服务端优化\n\n1. 页面静态化，能有效增加QPS和减小服务器压力\n2. 并发处理，如多线程异步、队列\n\n#### 4. 数据库优化\n\n1. 数据库缓存，memcache、redis、mongodb等\n2. 分库分表、分区操作\n3. 读写分离\n4. 负载均衡\n\n#### 5. web服务器优化\n1. 负载均衡，如使用nginx的反向代理\n","source":"_posts/高并发和大流量解决方案.md","raw":"---\ntitle: 高并发和大流量解决方案\ndate: 2018-02-15 16:28:43\ntags: 高并发\n---\n\n这是慕课网相关课程的学习笔记，在此记录一下，方便查阅。\n\n> 真题：PHP如何解决网站大流量和高并发的问题？\n\n1. 考点\n- 高并发架构相关概念\n- 高并发解决方案案例\n\n<!-- more -->\n\n### 1. 高并发架构相关概念\n\n#### 1. 并发\n\n> 在操作系统中，是指一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个处理机上运行，但任意时刻点上只有一个程序在处理机上运行。\n\n我们所说的高并发：在互联网时代，所讲的并发、高并发，通常是指并发访问。也就是在摸个时间点，有多少个访问同时到来。\n\n通过一个系统的日PV在千万以上，有可能是一个高并发的系统。\n\n高并发具体应该关心什么？\n\n- QPS：每秒请求或者查询的数量，在互联网领域，指每秒响应请求数（指http请求）；\n- 吞吐量：单位时间内处理的请求数量（通常由QPS和并发数决定）；\n- 响应时间：从请求发出到收到响应花费的时间。例如一个系统处理一个http请求需要100ms，这个100ms就是系统的响应时间；\n- PV：综合浏览量 page view， 即页面的浏览量或者点击量，访客在24小时内访问的页面数量。刷新页面不计入，同一访客浏览同一网页页面，只记作一次PV；\n- UV：独立访客 unique visitor；\n- 带宽：计算带宽大小需关注两个指标，峰值流量和页面的平均大小，峰值一般是平均值的倍数，根据实际情况来定；\n- 日网站带宽： PV/统计时间（s）\\* 平均页面大小（KB）\\* 8\n\n\n> 注意： QPS 不等于 并发连接数。QPS是每秒http请求数量，并发连接数是系统同时处理的请求数量。\n\n峰值每秒请求数(QPS) = (总PV数 * 80%)/(6小时秒数 * 20%)  即80% 的访问量集中在20% 的时间内。二八定律\n\n压力测试：\n- 测试能承受的最大并发数；\n- 测试最大承受的QPS值。\n- \n\n常用性能测试工具： ab (apache benchmark) , wrk, http_load, Web Bench\n\nab的使用：模拟并发请求100次 -c concurrency，总共请求5000次 -n requests。\n\n```\nab -c 100 -n 5000 http://website\n```\n\n注意事项：\n- 测试机器与被测试机器分开\n- 不要对线上服务做压力测试\n- 观察测试工具ab所在机器，以及被测试的前端机的CPU、内存、网络等都不超过最高限度的75% （top）\n\n```\nbogon% ab -c 10 -n 100 https://www.zouzhipeng.com/\nThis is ApacheBench, Version 2.3 <$Revision: 1807734 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking www.zouzhipeng.com (be patient).....done\n\n\nServer Software:        nginx/1.10.2\nServer Hostname:        www.zouzhipeng.com\nServer Port:            443\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128\nTLS Server Name:        www.zouzhipeng.com\n\nDocument Path:          /\nDocument Length:        41106 bytes\n\nConcurrency Level:      10 （并发数）\nTime taken for tests:   33.520 seconds\nComplete requests:      100\nFailed requests:        0 （失败请求数，成功率95%以上才有意义）\nTotal transferred:      4134200 bytes\nHTML transferred:       4110600 bytes\nRequests per second:    2.98 [#/sec] (mean) （这个就是QPS）\nTime per request:       3352.033 [ms] (mean)\nTime per request:       335.203 [ms] (mean, across all concurrent requests)\nTransfer rate:          120.44 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:       26  199 300.1     44    1472\nProcessing:    19 2983 1884.0   2765   11618\nWaiting:       16 1327 1079.2   1066    5585\nTotal:        175 3182 1932.9   2848   11662\n\nPercentage of the requests served within a certain time (ms)\n  50%   2848\n  66%   3786\n  75%   4321\n  80%   4742\n  90%   5732\n  95%   6377\n  98%   8345\n  99%  11662\n 100%  11662 (longest request)\n```\n\nQPS如果达到极限，该如何处理？\n\n随着QPS的增长，每个阶段需要根据时间情况来进行优化，优化的方案也与硬件条件、网络带宽息息相关。\n\n1. QPS达到50：可以称之为小型网站，一般的服务器就可以应付，无需优化；\n2. QPS达到100：假设关系型数据库的每次请求在0.01秒完成（理想状态），假设单个页面只有一个sql查询，那么100QPS意味着1秒钟完成100次请求，但是此时并不能保证数据库查询能完成100次。即瓶颈在数据库，方案：数据库缓存层、数据库的负载均衡；\n3. QPS达到800：假设使用百兆带宽，意味着网站的出口实际带宽有8M左右。假设每个页面只有10K，在这个并发条件下，百兆带宽已经吃完。即带宽此时是瓶颈，方案：CDN加速、负载均衡；\n4. QPS达到1000：假设使用redis或memcache缓存数据库查询数据，每个页面对memcache的请求远大于直接对DB的请求，memcache的悲观并发数在20k左右，但有可能在之前内网带宽已经吃完，表现出不稳定。方案：静态HTML缓存；\n5. QPS达到2000：这个级别下，文件系统访问锁都成为了灾难，方案：做业务分离，分布式存储。\n\n解决：首先回答怎么测试单击QPS极限值，针对不同的QPS做不同的优化。\n\n\n### 高并发解决方案案例\n\n#### 1. 流量优化\n1. 防盗链处理，将恶意请求拒之门外\n\n#### 2. 前端优化\n\n1. 减少http请求，合并css，合并js，合并图片或将图片转至oss\n2. 添加异步请求，不太重要的内容异步处理，事件驱动。\n3. 启用浏览器缓存，如 localStorage 和文件压缩，如压缩图片，nginx gzip等\n4. CDN 加速，同时能缓解带宽压力\n5. 建立独立的图片服务器、文件服务器，或者使用对象存储\n\n#### 3. 服务端优化\n\n1. 页面静态化，能有效增加QPS和减小服务器压力\n2. 并发处理，如多线程异步、队列\n\n#### 4. 数据库优化\n\n1. 数据库缓存，memcache、redis、mongodb等\n2. 分库分表、分区操作\n3. 读写分离\n4. 负载均衡\n\n#### 5. web服务器优化\n1. 负载均衡，如使用nginx的反向代理\n","slug":"高并发和大流量解决方案","published":1,"updated":"2020-09-11T01:04:35.057Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzah004y6wo1fu7e76y6","content":"<p>这是慕课网相关课程的学习笔记，在此记录一下，方便查阅。</p>\n<blockquote>\n<p>真题：PHP如何解决网站大流量和高并发的问题？</p>\n</blockquote>\n<ol>\n<li>考点</li>\n</ol>\n<ul>\n<li>高并发架构相关概念</li>\n<li>高并发解决方案案例</li>\n</ul>\n<a id=\"more\"></a>\n\n<h3 id=\"1-高并发架构相关概念\"><a href=\"#1-高并发架构相关概念\" class=\"headerlink\" title=\"1. 高并发架构相关概念\"></a>1. 高并发架构相关概念</h3><h4 id=\"1-并发\"><a href=\"#1-并发\" class=\"headerlink\" title=\"1. 并发\"></a>1. 并发</h4><blockquote>\n<p>在操作系统中，是指一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个处理机上运行，但任意时刻点上只有一个程序在处理机上运行。</p>\n</blockquote>\n<p>我们所说的高并发：在互联网时代，所讲的并发、高并发，通常是指并发访问。也就是在摸个时间点，有多少个访问同时到来。</p>\n<p>通过一个系统的日PV在千万以上，有可能是一个高并发的系统。</p>\n<p>高并发具体应该关心什么？</p>\n<ul>\n<li>QPS：每秒请求或者查询的数量，在互联网领域，指每秒响应请求数（指http请求）；</li>\n<li>吞吐量：单位时间内处理的请求数量（通常由QPS和并发数决定）；</li>\n<li>响应时间：从请求发出到收到响应花费的时间。例如一个系统处理一个http请求需要100ms，这个100ms就是系统的响应时间；</li>\n<li>PV：综合浏览量 page view， 即页面的浏览量或者点击量，访客在24小时内访问的页面数量。刷新页面不计入，同一访客浏览同一网页页面，只记作一次PV；</li>\n<li>UV：独立访客 unique visitor；</li>\n<li>带宽：计算带宽大小需关注两个指标，峰值流量和页面的平均大小，峰值一般是平均值的倍数，根据实际情况来定；</li>\n<li>日网站带宽： PV/统计时间（s）* 平均页面大小（KB）* 8</li>\n</ul>\n<blockquote>\n<p>注意： QPS 不等于 并发连接数。QPS是每秒http请求数量，并发连接数是系统同时处理的请求数量。</p>\n</blockquote>\n<p>峰值每秒请求数(QPS) = (总PV数 * 80%)/(6小时秒数 * 20%)  即80% 的访问量集中在20% 的时间内。二八定律</p>\n<p>压力测试：</p>\n<ul>\n<li>测试能承受的最大并发数；</li>\n<li>测试最大承受的QPS值。</li>\n<li></li>\n</ul>\n<p>常用性能测试工具： ab (apache benchmark) , wrk, http_load, Web Bench</p>\n<p>ab的使用：模拟并发请求100次 -c concurrency，总共请求5000次 -n requests。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -c 100 -n 5000 http:&#x2F;&#x2F;website</span><br></pre></td></tr></table></figure>\n\n<p>注意事项：</p>\n<ul>\n<li>测试机器与被测试机器分开</li>\n<li>不要对线上服务做压力测试</li>\n<li>观察测试工具ab所在机器，以及被测试的前端机的CPU、内存、网络等都不超过最高限度的75% （top）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bogon% ab -c 10 -n 100 https:&#x2F;&#x2F;www.zouzhipeng.com&#x2F;</span><br><span class=\"line\">This is ApacheBench, Version 2.3 &lt;$Revision: 1807734 $&gt;</span><br><span class=\"line\">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http:&#x2F;&#x2F;www.zeustech.net&#x2F;</span><br><span class=\"line\">Licensed to The Apache Software Foundation, http:&#x2F;&#x2F;www.apache.org&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">Benchmarking www.zouzhipeng.com (be patient).....done</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Server Software:        nginx&#x2F;1.10.2</span><br><span class=\"line\">Server Hostname:        www.zouzhipeng.com</span><br><span class=\"line\">Server Port:            443</span><br><span class=\"line\">SSL&#x2F;TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128</span><br><span class=\"line\">TLS Server Name:        www.zouzhipeng.com</span><br><span class=\"line\"></span><br><span class=\"line\">Document Path:          &#x2F;</span><br><span class=\"line\">Document Length:        41106 bytes</span><br><span class=\"line\"></span><br><span class=\"line\">Concurrency Level:      10 （并发数）</span><br><span class=\"line\">Time taken for tests:   33.520 seconds</span><br><span class=\"line\">Complete requests:      100</span><br><span class=\"line\">Failed requests:        0 （失败请求数，成功率95%以上才有意义）</span><br><span class=\"line\">Total transferred:      4134200 bytes</span><br><span class=\"line\">HTML transferred:       4110600 bytes</span><br><span class=\"line\">Requests per second:    2.98 [#&#x2F;sec] (mean) （这个就是QPS）</span><br><span class=\"line\">Time per request:       3352.033 [ms] (mean)</span><br><span class=\"line\">Time per request:       335.203 [ms] (mean, across all concurrent requests)</span><br><span class=\"line\">Transfer rate:          120.44 [Kbytes&#x2F;sec] received</span><br><span class=\"line\"></span><br><span class=\"line\">Connection Times (ms)</span><br><span class=\"line\">              min  mean[+&#x2F;-sd] median   max</span><br><span class=\"line\">Connect:       26  199 300.1     44    1472</span><br><span class=\"line\">Processing:    19 2983 1884.0   2765   11618</span><br><span class=\"line\">Waiting:       16 1327 1079.2   1066    5585</span><br><span class=\"line\">Total:        175 3182 1932.9   2848   11662</span><br><span class=\"line\"></span><br><span class=\"line\">Percentage of the requests served within a certain time (ms)</span><br><span class=\"line\">  50%   2848</span><br><span class=\"line\">  66%   3786</span><br><span class=\"line\">  75%   4321</span><br><span class=\"line\">  80%   4742</span><br><span class=\"line\">  90%   5732</span><br><span class=\"line\">  95%   6377</span><br><span class=\"line\">  98%   8345</span><br><span class=\"line\">  99%  11662</span><br><span class=\"line\"> 100%  11662 (longest request)</span><br></pre></td></tr></table></figure>\n\n<p>QPS如果达到极限，该如何处理？</p>\n<p>随着QPS的增长，每个阶段需要根据时间情况来进行优化，优化的方案也与硬件条件、网络带宽息息相关。</p>\n<ol>\n<li>QPS达到50：可以称之为小型网站，一般的服务器就可以应付，无需优化；</li>\n<li>QPS达到100：假设关系型数据库的每次请求在0.01秒完成（理想状态），假设单个页面只有一个sql查询，那么100QPS意味着1秒钟完成100次请求，但是此时并不能保证数据库查询能完成100次。即瓶颈在数据库，方案：数据库缓存层、数据库的负载均衡；</li>\n<li>QPS达到800：假设使用百兆带宽，意味着网站的出口实际带宽有8M左右。假设每个页面只有10K，在这个并发条件下，百兆带宽已经吃完。即带宽此时是瓶颈，方案：CDN加速、负载均衡；</li>\n<li>QPS达到1000：假设使用redis或memcache缓存数据库查询数据，每个页面对memcache的请求远大于直接对DB的请求，memcache的悲观并发数在20k左右，但有可能在之前内网带宽已经吃完，表现出不稳定。方案：静态HTML缓存；</li>\n<li>QPS达到2000：这个级别下，文件系统访问锁都成为了灾难，方案：做业务分离，分布式存储。</li>\n</ol>\n<p>解决：首先回答怎么测试单击QPS极限值，针对不同的QPS做不同的优化。</p>\n<h3 id=\"高并发解决方案案例\"><a href=\"#高并发解决方案案例\" class=\"headerlink\" title=\"高并发解决方案案例\"></a>高并发解决方案案例</h3><h4 id=\"1-流量优化\"><a href=\"#1-流量优化\" class=\"headerlink\" title=\"1. 流量优化\"></a>1. 流量优化</h4><ol>\n<li>防盗链处理，将恶意请求拒之门外</li>\n</ol>\n<h4 id=\"2-前端优化\"><a href=\"#2-前端优化\" class=\"headerlink\" title=\"2. 前端优化\"></a>2. 前端优化</h4><ol>\n<li>减少http请求，合并css，合并js，合并图片或将图片转至oss</li>\n<li>添加异步请求，不太重要的内容异步处理，事件驱动。</li>\n<li>启用浏览器缓存，如 localStorage 和文件压缩，如压缩图片，nginx gzip等</li>\n<li>CDN 加速，同时能缓解带宽压力</li>\n<li>建立独立的图片服务器、文件服务器，或者使用对象存储</li>\n</ol>\n<h4 id=\"3-服务端优化\"><a href=\"#3-服务端优化\" class=\"headerlink\" title=\"3. 服务端优化\"></a>3. 服务端优化</h4><ol>\n<li>页面静态化，能有效增加QPS和减小服务器压力</li>\n<li>并发处理，如多线程异步、队列</li>\n</ol>\n<h4 id=\"4-数据库优化\"><a href=\"#4-数据库优化\" class=\"headerlink\" title=\"4. 数据库优化\"></a>4. 数据库优化</h4><ol>\n<li>数据库缓存，memcache、redis、mongodb等</li>\n<li>分库分表、分区操作</li>\n<li>读写分离</li>\n<li>负载均衡</li>\n</ol>\n<h4 id=\"5-web服务器优化\"><a href=\"#5-web服务器优化\" class=\"headerlink\" title=\"5. web服务器优化\"></a>5. web服务器优化</h4><ol>\n<li>负载均衡，如使用nginx的反向代理</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>这是慕课网相关课程的学习笔记，在此记录一下，方便查阅。</p>\n<blockquote>\n<p>真题：PHP如何解决网站大流量和高并发的问题？</p>\n</blockquote>\n<ol>\n<li>考点</li>\n</ol>\n<ul>\n<li>高并发架构相关概念</li>\n<li>高并发解决方案案例</li>\n</ul>","more":"<h3 id=\"1-高并发架构相关概念\"><a href=\"#1-高并发架构相关概念\" class=\"headerlink\" title=\"1. 高并发架构相关概念\"></a>1. 高并发架构相关概念</h3><h4 id=\"1-并发\"><a href=\"#1-并发\" class=\"headerlink\" title=\"1. 并发\"></a>1. 并发</h4><blockquote>\n<p>在操作系统中，是指一个时间段中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都是在同一个处理机上运行，但任意时刻点上只有一个程序在处理机上运行。</p>\n</blockquote>\n<p>我们所说的高并发：在互联网时代，所讲的并发、高并发，通常是指并发访问。也就是在摸个时间点，有多少个访问同时到来。</p>\n<p>通过一个系统的日PV在千万以上，有可能是一个高并发的系统。</p>\n<p>高并发具体应该关心什么？</p>\n<ul>\n<li>QPS：每秒请求或者查询的数量，在互联网领域，指每秒响应请求数（指http请求）；</li>\n<li>吞吐量：单位时间内处理的请求数量（通常由QPS和并发数决定）；</li>\n<li>响应时间：从请求发出到收到响应花费的时间。例如一个系统处理一个http请求需要100ms，这个100ms就是系统的响应时间；</li>\n<li>PV：综合浏览量 page view， 即页面的浏览量或者点击量，访客在24小时内访问的页面数量。刷新页面不计入，同一访客浏览同一网页页面，只记作一次PV；</li>\n<li>UV：独立访客 unique visitor；</li>\n<li>带宽：计算带宽大小需关注两个指标，峰值流量和页面的平均大小，峰值一般是平均值的倍数，根据实际情况来定；</li>\n<li>日网站带宽： PV/统计时间（s）* 平均页面大小（KB）* 8</li>\n</ul>\n<blockquote>\n<p>注意： QPS 不等于 并发连接数。QPS是每秒http请求数量，并发连接数是系统同时处理的请求数量。</p>\n</blockquote>\n<p>峰值每秒请求数(QPS) = (总PV数 * 80%)/(6小时秒数 * 20%)  即80% 的访问量集中在20% 的时间内。二八定律</p>\n<p>压力测试：</p>\n<ul>\n<li>测试能承受的最大并发数；</li>\n<li>测试最大承受的QPS值。</li>\n<li></li>\n</ul>\n<p>常用性能测试工具： ab (apache benchmark) , wrk, http_load, Web Bench</p>\n<p>ab的使用：模拟并发请求100次 -c concurrency，总共请求5000次 -n requests。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ab -c 100 -n 5000 http:&#x2F;&#x2F;website</span><br></pre></td></tr></table></figure>\n\n<p>注意事项：</p>\n<ul>\n<li>测试机器与被测试机器分开</li>\n<li>不要对线上服务做压力测试</li>\n<li>观察测试工具ab所在机器，以及被测试的前端机的CPU、内存、网络等都不超过最高限度的75% （top）</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bogon% ab -c 10 -n 100 https:&#x2F;&#x2F;www.zouzhipeng.com&#x2F;</span><br><span class=\"line\">This is ApacheBench, Version 2.3 &lt;$Revision: 1807734 $&gt;</span><br><span class=\"line\">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http:&#x2F;&#x2F;www.zeustech.net&#x2F;</span><br><span class=\"line\">Licensed to The Apache Software Foundation, http:&#x2F;&#x2F;www.apache.org&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">Benchmarking www.zouzhipeng.com (be patient).....done</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Server Software:        nginx&#x2F;1.10.2</span><br><span class=\"line\">Server Hostname:        www.zouzhipeng.com</span><br><span class=\"line\">Server Port:            443</span><br><span class=\"line\">SSL&#x2F;TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128</span><br><span class=\"line\">TLS Server Name:        www.zouzhipeng.com</span><br><span class=\"line\"></span><br><span class=\"line\">Document Path:          &#x2F;</span><br><span class=\"line\">Document Length:        41106 bytes</span><br><span class=\"line\"></span><br><span class=\"line\">Concurrency Level:      10 （并发数）</span><br><span class=\"line\">Time taken for tests:   33.520 seconds</span><br><span class=\"line\">Complete requests:      100</span><br><span class=\"line\">Failed requests:        0 （失败请求数，成功率95%以上才有意义）</span><br><span class=\"line\">Total transferred:      4134200 bytes</span><br><span class=\"line\">HTML transferred:       4110600 bytes</span><br><span class=\"line\">Requests per second:    2.98 [#&#x2F;sec] (mean) （这个就是QPS）</span><br><span class=\"line\">Time per request:       3352.033 [ms] (mean)</span><br><span class=\"line\">Time per request:       335.203 [ms] (mean, across all concurrent requests)</span><br><span class=\"line\">Transfer rate:          120.44 [Kbytes&#x2F;sec] received</span><br><span class=\"line\"></span><br><span class=\"line\">Connection Times (ms)</span><br><span class=\"line\">              min  mean[+&#x2F;-sd] median   max</span><br><span class=\"line\">Connect:       26  199 300.1     44    1472</span><br><span class=\"line\">Processing:    19 2983 1884.0   2765   11618</span><br><span class=\"line\">Waiting:       16 1327 1079.2   1066    5585</span><br><span class=\"line\">Total:        175 3182 1932.9   2848   11662</span><br><span class=\"line\"></span><br><span class=\"line\">Percentage of the requests served within a certain time (ms)</span><br><span class=\"line\">  50%   2848</span><br><span class=\"line\">  66%   3786</span><br><span class=\"line\">  75%   4321</span><br><span class=\"line\">  80%   4742</span><br><span class=\"line\">  90%   5732</span><br><span class=\"line\">  95%   6377</span><br><span class=\"line\">  98%   8345</span><br><span class=\"line\">  99%  11662</span><br><span class=\"line\"> 100%  11662 (longest request)</span><br></pre></td></tr></table></figure>\n\n<p>QPS如果达到极限，该如何处理？</p>\n<p>随着QPS的增长，每个阶段需要根据时间情况来进行优化，优化的方案也与硬件条件、网络带宽息息相关。</p>\n<ol>\n<li>QPS达到50：可以称之为小型网站，一般的服务器就可以应付，无需优化；</li>\n<li>QPS达到100：假设关系型数据库的每次请求在0.01秒完成（理想状态），假设单个页面只有一个sql查询，那么100QPS意味着1秒钟完成100次请求，但是此时并不能保证数据库查询能完成100次。即瓶颈在数据库，方案：数据库缓存层、数据库的负载均衡；</li>\n<li>QPS达到800：假设使用百兆带宽，意味着网站的出口实际带宽有8M左右。假设每个页面只有10K，在这个并发条件下，百兆带宽已经吃完。即带宽此时是瓶颈，方案：CDN加速、负载均衡；</li>\n<li>QPS达到1000：假设使用redis或memcache缓存数据库查询数据，每个页面对memcache的请求远大于直接对DB的请求，memcache的悲观并发数在20k左右，但有可能在之前内网带宽已经吃完，表现出不稳定。方案：静态HTML缓存；</li>\n<li>QPS达到2000：这个级别下，文件系统访问锁都成为了灾难，方案：做业务分离，分布式存储。</li>\n</ol>\n<p>解决：首先回答怎么测试单击QPS极限值，针对不同的QPS做不同的优化。</p>\n<h3 id=\"高并发解决方案案例\"><a href=\"#高并发解决方案案例\" class=\"headerlink\" title=\"高并发解决方案案例\"></a>高并发解决方案案例</h3><h4 id=\"1-流量优化\"><a href=\"#1-流量优化\" class=\"headerlink\" title=\"1. 流量优化\"></a>1. 流量优化</h4><ol>\n<li>防盗链处理，将恶意请求拒之门外</li>\n</ol>\n<h4 id=\"2-前端优化\"><a href=\"#2-前端优化\" class=\"headerlink\" title=\"2. 前端优化\"></a>2. 前端优化</h4><ol>\n<li>减少http请求，合并css，合并js，合并图片或将图片转至oss</li>\n<li>添加异步请求，不太重要的内容异步处理，事件驱动。</li>\n<li>启用浏览器缓存，如 localStorage 和文件压缩，如压缩图片，nginx gzip等</li>\n<li>CDN 加速，同时能缓解带宽压力</li>\n<li>建立独立的图片服务器、文件服务器，或者使用对象存储</li>\n</ol>\n<h4 id=\"3-服务端优化\"><a href=\"#3-服务端优化\" class=\"headerlink\" title=\"3. 服务端优化\"></a>3. 服务端优化</h4><ol>\n<li>页面静态化，能有效增加QPS和减小服务器压力</li>\n<li>并发处理，如多线程异步、队列</li>\n</ol>\n<h4 id=\"4-数据库优化\"><a href=\"#4-数据库优化\" class=\"headerlink\" title=\"4. 数据库优化\"></a>4. 数据库优化</h4><ol>\n<li>数据库缓存，memcache、redis、mongodb等</li>\n<li>分库分表、分区操作</li>\n<li>读写分离</li>\n<li>负载均衡</li>\n</ol>\n<h4 id=\"5-web服务器优化\"><a href=\"#5-web服务器优化\" class=\"headerlink\" title=\"5. web服务器优化\"></a>5. web服务器优化</h4><ol>\n<li>负载均衡，如使用nginx的反向代理</li>\n</ol>"},{"title":"高并发大流量解决方案 1 web 资源防盗链","date":"2018-02-15T08:30:34.000Z","_content":"\n### 1. web 资源防盗链\n\n#### 1.  什么是防盗链？\n\n- 盗链：是指在自己的服务器上展示一些并不在自己服务器上的内容。\n\n   获得他人服务器上的资源地址，绕过别人的资源展示页面，直接在自己的页面上向最终用户提供此内容。\n\n  常见的是小站盗用大站的音乐、图片、视频、文件等资源。\n\n  通过盗链可以减轻自己服务器的负担，因为真实的空间和流量均是来自别人的服务器。\n\n<!-- more -->\n\n- 防盗链：防止别人通过一些技术手段绕过本站的资源展示页面，盗用本站的资源，让绕开本站资源展示页面的资源链接失效。\n\n  可以大大减轻服务器及带宽的压力\n\n#### 2. 防盗链的工作原理\n通过 referer 或者签名，网站可以检测目标网页访问的来源网页，如果是资源文件，则可以跟踪到显示它的网页地址。\n  \n  一旦检测到来源不是本站即进行阻止或返回指定的页面。 \n  \n  通过计算签名的方式，判断请求是否合法，如果合法则显示，否则返回错误信息。\n\n#### 3. 防盗链的实现方法\n##### 1. referer 方法\n \n   nginx模块 `ngx_http_referer_module` 用来阻挡来源非法的域名请求\n   \n   nginx 指令 `valid_referers`，全局变量 `$invalid_referer`\n   \n   语法： `valid_referers none | blocked | server_names | string ...;`\n   \n  -  `none`: 可以写也可以不写，代表 referer 是否为空，写了代表如果 referer 为空也是合法的，不写 none 表示如果 referer 为空就不合法，必须有 referer，一般可以为空；\n  -  `blocked`: 表示通过代理、防火墙等途径对referer进行删除，这些值都不以 http:// 或 https:// 开头；\n    -  `server_names`: referer 来源头部包含当前的 server_names，即被允许的源的列表；\n  -  ` string ...`: 信任的地址，字符串或正则表达式；\n\n示例：\n``` nginx\nlocation ~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$\n{\n\tvalid_referers none blocked imooc.com *.imooc.com;\n\tif ($invalid_referer)\n\t{\n\t\t#return 403;\n\t\trewrite ^/ http://www.imooc.com/403.jpg;\n\t}\n\texpires 30d;\n}\n```\n\n当访问这些扩展名结尾的文件时，会进行防盗链处理。添加 none、blocked 以及白名单（慕课网），如果来源合法，变量 `$invalid_referer` 就是0，直接跳过判断。\n\n也可以针对目录进行防盗链，只需要修改 location 那一行\n``` nginx\nlocation /images/\n{\n\tvalid_referers none blocked imooc.com *.imooc.com;\n\tif ($invalid_referer)\n\t{\n\t\t#return 403;\n\t\trewrite ^/ http://www.imooc.com/403.jpg;\n\t}\n}\n```\n\n首先确认是否已安装了该模块，没有的话先安装\n``` bash\n$ nginx -V\nnginx version: nginx/1.12.2\nbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)\nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx ...\n```\n\n传统防盗链存在的问题：伪造 referer。可以使用加密签名解决。\n\n##### 2. 加密签名方法\n\n使用第三方模块 HttpAccessKeyModule 实现 nginx 防盗链。\n\n- `accesskey on|off` 模块开关\n- `accesskey_hashmethod md5|sha-1` 签名加密方式\n- `accesskey_arg` GET 参数名称\n- `accesskey_signature` 加密规则\n\n同样，首先要确认已安装该模块。\n\n示例：\n``` nginx\nlocation ~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$\n{\n\tvalid_referers none blocked imooc.com *.imooc.com;\n\tif ($invalid_referer)\n\t{\n\t\taccesskey on;\n\t\taccesskey_hashmethod md5;\n\t\taccesskey_arg \"your_arg\";\n\t\taccesskey_signature \"your_pass$remote_addr\";\n\t}\n}\n```\n\nnginx 端进行了这样的配置，php 端要相应地做相同的配置，签名才能通过。\n\n``` php\n<?php\n$your_arg = md5('your_pass' . $_SERVER['REMOTE_ADDR']);\necho '<img src=\"address?your_arg=' . $your_arg . '\">';\n```\n\n这种方法基本可以实现完全的防盗链，但是所有的资源文件的路径都要加上一个参数，对于编码来说比较麻烦。两种方式各有利弊，使用哪种方式要视具体业务及情况进行考虑。\n","source":"_posts/高并发大流量解决方案-1-web-资源防盗链.md","raw":"---\ntitle: 高并发大流量解决方案 1 web 资源防盗链\ndate: 2018-02-15 16:30:34\ntags: 高并发\n---\n\n### 1. web 资源防盗链\n\n#### 1.  什么是防盗链？\n\n- 盗链：是指在自己的服务器上展示一些并不在自己服务器上的内容。\n\n   获得他人服务器上的资源地址，绕过别人的资源展示页面，直接在自己的页面上向最终用户提供此内容。\n\n  常见的是小站盗用大站的音乐、图片、视频、文件等资源。\n\n  通过盗链可以减轻自己服务器的负担，因为真实的空间和流量均是来自别人的服务器。\n\n<!-- more -->\n\n- 防盗链：防止别人通过一些技术手段绕过本站的资源展示页面，盗用本站的资源，让绕开本站资源展示页面的资源链接失效。\n\n  可以大大减轻服务器及带宽的压力\n\n#### 2. 防盗链的工作原理\n通过 referer 或者签名，网站可以检测目标网页访问的来源网页，如果是资源文件，则可以跟踪到显示它的网页地址。\n  \n  一旦检测到来源不是本站即进行阻止或返回指定的页面。 \n  \n  通过计算签名的方式，判断请求是否合法，如果合法则显示，否则返回错误信息。\n\n#### 3. 防盗链的实现方法\n##### 1. referer 方法\n \n   nginx模块 `ngx_http_referer_module` 用来阻挡来源非法的域名请求\n   \n   nginx 指令 `valid_referers`，全局变量 `$invalid_referer`\n   \n   语法： `valid_referers none | blocked | server_names | string ...;`\n   \n  -  `none`: 可以写也可以不写，代表 referer 是否为空，写了代表如果 referer 为空也是合法的，不写 none 表示如果 referer 为空就不合法，必须有 referer，一般可以为空；\n  -  `blocked`: 表示通过代理、防火墙等途径对referer进行删除，这些值都不以 http:// 或 https:// 开头；\n    -  `server_names`: referer 来源头部包含当前的 server_names，即被允许的源的列表；\n  -  ` string ...`: 信任的地址，字符串或正则表达式；\n\n示例：\n``` nginx\nlocation ~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$\n{\n\tvalid_referers none blocked imooc.com *.imooc.com;\n\tif ($invalid_referer)\n\t{\n\t\t#return 403;\n\t\trewrite ^/ http://www.imooc.com/403.jpg;\n\t}\n\texpires 30d;\n}\n```\n\n当访问这些扩展名结尾的文件时，会进行防盗链处理。添加 none、blocked 以及白名单（慕课网），如果来源合法，变量 `$invalid_referer` 就是0，直接跳过判断。\n\n也可以针对目录进行防盗链，只需要修改 location 那一行\n``` nginx\nlocation /images/\n{\n\tvalid_referers none blocked imooc.com *.imooc.com;\n\tif ($invalid_referer)\n\t{\n\t\t#return 403;\n\t\trewrite ^/ http://www.imooc.com/403.jpg;\n\t}\n}\n```\n\n首先确认是否已安装了该模块，没有的话先安装\n``` bash\n$ nginx -V\nnginx version: nginx/1.12.2\nbuilt by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)\nbuilt with OpenSSL 1.0.2k-fips  26 Jan 2017\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx ...\n```\n\n传统防盗链存在的问题：伪造 referer。可以使用加密签名解决。\n\n##### 2. 加密签名方法\n\n使用第三方模块 HttpAccessKeyModule 实现 nginx 防盗链。\n\n- `accesskey on|off` 模块开关\n- `accesskey_hashmethod md5|sha-1` 签名加密方式\n- `accesskey_arg` GET 参数名称\n- `accesskey_signature` 加密规则\n\n同样，首先要确认已安装该模块。\n\n示例：\n``` nginx\nlocation ~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$\n{\n\tvalid_referers none blocked imooc.com *.imooc.com;\n\tif ($invalid_referer)\n\t{\n\t\taccesskey on;\n\t\taccesskey_hashmethod md5;\n\t\taccesskey_arg \"your_arg\";\n\t\taccesskey_signature \"your_pass$remote_addr\";\n\t}\n}\n```\n\nnginx 端进行了这样的配置，php 端要相应地做相同的配置，签名才能通过。\n\n``` php\n<?php\n$your_arg = md5('your_pass' . $_SERVER['REMOTE_ADDR']);\necho '<img src=\"address?your_arg=' . $your_arg . '\">';\n```\n\n这种方法基本可以实现完全的防盗链，但是所有的资源文件的路径都要加上一个参数，对于编码来说比较麻烦。两种方式各有利弊，使用哪种方式要视具体业务及情况进行考虑。\n","slug":"高并发大流量解决方案-1-web-资源防盗链","published":1,"updated":"2020-09-11T01:04:35.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzai00516wo1df1l8kg8","content":"<h3 id=\"1-web-资源防盗链\"><a href=\"#1-web-资源防盗链\" class=\"headerlink\" title=\"1. web 资源防盗链\"></a>1. web 资源防盗链</h3><h4 id=\"1-什么是防盗链？\"><a href=\"#1-什么是防盗链？\" class=\"headerlink\" title=\"1.  什么是防盗链？\"></a>1.  什么是防盗链？</h4><ul>\n<li><p>盗链：是指在自己的服务器上展示一些并不在自己服务器上的内容。</p>\n<p> 获得他人服务器上的资源地址，绕过别人的资源展示页面，直接在自己的页面上向最终用户提供此内容。</p>\n<p>常见的是小站盗用大站的音乐、图片、视频、文件等资源。</p>\n<p>通过盗链可以减轻自己服务器的负担，因为真实的空间和流量均是来自别人的服务器。</p>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<ul>\n<li><p>防盗链：防止别人通过一些技术手段绕过本站的资源展示页面，盗用本站的资源，让绕开本站资源展示页面的资源链接失效。</p>\n<p>可以大大减轻服务器及带宽的压力</p>\n</li>\n</ul>\n<h4 id=\"2-防盗链的工作原理\"><a href=\"#2-防盗链的工作原理\" class=\"headerlink\" title=\"2. 防盗链的工作原理\"></a>2. 防盗链的工作原理</h4><p>通过 referer 或者签名，网站可以检测目标网页访问的来源网页，如果是资源文件，则可以跟踪到显示它的网页地址。</p>\n<p>  一旦检测到来源不是本站即进行阻止或返回指定的页面。 </p>\n<p>  通过计算签名的方式，判断请求是否合法，如果合法则显示，否则返回错误信息。</p>\n<h4 id=\"3-防盗链的实现方法\"><a href=\"#3-防盗链的实现方法\" class=\"headerlink\" title=\"3. 防盗链的实现方法\"></a>3. 防盗链的实现方法</h4><h5 id=\"1-referer-方法\"><a href=\"#1-referer-方法\" class=\"headerlink\" title=\"1. referer 方法\"></a>1. referer 方法</h5><p>   nginx模块 <code>ngx_http_referer_module</code> 用来阻挡来源非法的域名请求</p>\n<p>   nginx 指令 <code>valid_referers</code>，全局变量 <code>$invalid_referer</code></p>\n<p>   语法： <code>valid_referers none | blocked | server_names | string ...;</code></p>\n<ul>\n<li><code>none</code>: 可以写也可以不写，代表 referer 是否为空，写了代表如果 referer 为空也是合法的，不写 none 表示如果 referer 为空就不合法，必须有 referer，一般可以为空；</li>\n<li><code>blocked</code>: 表示通过代理、防火墙等途径对referer进行删除，这些值都不以 http:// 或 https:// 开头；<ul>\n<li><code>server_names</code>: referer 来源头部包含当前的 server_names，即被允许的源的列表；</li>\n</ul>\n</li>\n<li><code> string ...</code>: 信任的地址，字符串或正则表达式；</li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">valid_referers</span> <span class=\"literal\">none</span> <span class=\"literal\">blocked</span> imooc.com <span class=\"regexp\">*.imooc.com</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">if</span> (<span class=\"variable\">$invalid_referer</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">#return 403;</span></span><br><span class=\"line\">\t\t<span class=\"attribute\">rewrite</span><span class=\"regexp\"> ^/</span> http://www.imooc.com/403.jpg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"attribute\">expires</span> <span class=\"number\">30d</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当访问这些扩展名结尾的文件时，会进行防盗链处理。添加 none、blocked 以及白名单（慕课网），如果来源合法，变量 <code>$invalid_referer</code> 就是0，直接跳过判断。</p>\n<p>也可以针对目录进行防盗链，只需要修改 location 那一行</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> /images/</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">valid_referers</span> <span class=\"literal\">none</span> <span class=\"literal\">blocked</span> imooc.com <span class=\"regexp\">*.imooc.com</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">if</span> (<span class=\"variable\">$invalid_referer</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">#return 403;</span></span><br><span class=\"line\">\t\t<span class=\"attribute\">rewrite</span><span class=\"regexp\"> ^/</span> http://www.imooc.com/403.jpg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>首先确认是否已安装了该模块，没有的话先安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nginx -V</span><br><span class=\"line\">nginx version: nginx/1.12.2</span><br><span class=\"line\">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)</span><br><span class=\"line\">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">TLS SNI support enabled</span><br><span class=\"line\">configure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx ...</span><br></pre></td></tr></table></figure>\n\n<p>传统防盗链存在的问题：伪造 referer。可以使用加密签名解决。</p>\n<h5 id=\"2-加密签名方法\"><a href=\"#2-加密签名方法\" class=\"headerlink\" title=\"2. 加密签名方法\"></a>2. 加密签名方法</h5><p>使用第三方模块 HttpAccessKeyModule 实现 nginx 防盗链。</p>\n<ul>\n<li><code>accesskey on|off</code> 模块开关</li>\n<li><code>accesskey_hashmethod md5|sha-1</code> 签名加密方式</li>\n<li><code>accesskey_arg</code> GET 参数名称</li>\n<li><code>accesskey_signature</code> 加密规则</li>\n</ul>\n<p>同样，首先要确认已安装该模块。</p>\n<p>示例：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">valid_referers</span> <span class=\"literal\">none</span> <span class=\"literal\">blocked</span> imooc.com <span class=\"regexp\">*.imooc.com</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">if</span> (<span class=\"variable\">$invalid_referer</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey_hashmethod</span> md5;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey_arg</span> <span class=\"string\">&quot;your_arg&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey_signature</span> <span class=\"string\">&quot;your_pass<span class=\"variable\">$remote_addr</span>&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>nginx 端进行了这样的配置，php 端要相应地做相同的配置，签名才能通过。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$your_arg = md5(<span class=\"string\">&#x27;your_pass&#x27;</span> . $_SERVER[<span class=\"string\">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;img src=&quot;address?your_arg=&#x27;</span> . $your_arg . <span class=\"string\">&#x27;&quot;&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>这种方法基本可以实现完全的防盗链，但是所有的资源文件的路径都要加上一个参数，对于编码来说比较麻烦。两种方式各有利弊，使用哪种方式要视具体业务及情况进行考虑。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"1-web-资源防盗链\"><a href=\"#1-web-资源防盗链\" class=\"headerlink\" title=\"1. web 资源防盗链\"></a>1. web 资源防盗链</h3><h4 id=\"1-什么是防盗链？\"><a href=\"#1-什么是防盗链？\" class=\"headerlink\" title=\"1.  什么是防盗链？\"></a>1.  什么是防盗链？</h4><ul>\n<li><p>盗链：是指在自己的服务器上展示一些并不在自己服务器上的内容。</p>\n<p> 获得他人服务器上的资源地址，绕过别人的资源展示页面，直接在自己的页面上向最终用户提供此内容。</p>\n<p>常见的是小站盗用大站的音乐、图片、视频、文件等资源。</p>\n<p>通过盗链可以减轻自己服务器的负担，因为真实的空间和流量均是来自别人的服务器。</p>\n</li>\n</ul>","more":"<ul>\n<li><p>防盗链：防止别人通过一些技术手段绕过本站的资源展示页面，盗用本站的资源，让绕开本站资源展示页面的资源链接失效。</p>\n<p>可以大大减轻服务器及带宽的压力</p>\n</li>\n</ul>\n<h4 id=\"2-防盗链的工作原理\"><a href=\"#2-防盗链的工作原理\" class=\"headerlink\" title=\"2. 防盗链的工作原理\"></a>2. 防盗链的工作原理</h4><p>通过 referer 或者签名，网站可以检测目标网页访问的来源网页，如果是资源文件，则可以跟踪到显示它的网页地址。</p>\n<p>  一旦检测到来源不是本站即进行阻止或返回指定的页面。 </p>\n<p>  通过计算签名的方式，判断请求是否合法，如果合法则显示，否则返回错误信息。</p>\n<h4 id=\"3-防盗链的实现方法\"><a href=\"#3-防盗链的实现方法\" class=\"headerlink\" title=\"3. 防盗链的实现方法\"></a>3. 防盗链的实现方法</h4><h5 id=\"1-referer-方法\"><a href=\"#1-referer-方法\" class=\"headerlink\" title=\"1. referer 方法\"></a>1. referer 方法</h5><p>   nginx模块 <code>ngx_http_referer_module</code> 用来阻挡来源非法的域名请求</p>\n<p>   nginx 指令 <code>valid_referers</code>，全局变量 <code>$invalid_referer</code></p>\n<p>   语法： <code>valid_referers none | blocked | server_names | string ...;</code></p>\n<ul>\n<li><code>none</code>: 可以写也可以不写，代表 referer 是否为空，写了代表如果 referer 为空也是合法的，不写 none 表示如果 referer 为空就不合法，必须有 referer，一般可以为空；</li>\n<li><code>blocked</code>: 表示通过代理、防火墙等途径对referer进行删除，这些值都不以 http:// 或 https:// 开头；<ul>\n<li><code>server_names</code>: referer 来源头部包含当前的 server_names，即被允许的源的列表；</li>\n</ul>\n</li>\n<li><code> string ...</code>: 信任的地址，字符串或正则表达式；</li>\n</ul>\n<p>示例：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">valid_referers</span> <span class=\"literal\">none</span> <span class=\"literal\">blocked</span> imooc.com <span class=\"regexp\">*.imooc.com</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">if</span> (<span class=\"variable\">$invalid_referer</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">#return 403;</span></span><br><span class=\"line\">\t\t<span class=\"attribute\">rewrite</span><span class=\"regexp\"> ^/</span> http://www.imooc.com/403.jpg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"attribute\">expires</span> <span class=\"number\">30d</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当访问这些扩展名结尾的文件时，会进行防盗链处理。添加 none、blocked 以及白名单（慕课网），如果来源合法，变量 <code>$invalid_referer</code> 就是0，直接跳过判断。</p>\n<p>也可以针对目录进行防盗链，只需要修改 location 那一行</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> /images/</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">valid_referers</span> <span class=\"literal\">none</span> <span class=\"literal\">blocked</span> imooc.com <span class=\"regexp\">*.imooc.com</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">if</span> (<span class=\"variable\">$invalid_referer</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">#return 403;</span></span><br><span class=\"line\">\t\t<span class=\"attribute\">rewrite</span><span class=\"regexp\"> ^/</span> http://www.imooc.com/403.jpg;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>首先确认是否已安装了该模块，没有的话先安装</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nginx -V</span><br><span class=\"line\">nginx version: nginx/1.12.2</span><br><span class=\"line\">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC)</span><br><span class=\"line\">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class=\"line\">TLS SNI support enabled</span><br><span class=\"line\">configure arguments: --prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx ...</span><br></pre></td></tr></table></figure>\n\n<p>传统防盗链存在的问题：伪造 referer。可以使用加密签名解决。</p>\n<h5 id=\"2-加密签名方法\"><a href=\"#2-加密签名方法\" class=\"headerlink\" title=\"2. 加密签名方法\"></a>2. 加密签名方法</h5><p>使用第三方模块 HttpAccessKeyModule 实现 nginx 防盗链。</p>\n<ul>\n<li><code>accesskey on|off</code> 模块开关</li>\n<li><code>accesskey_hashmethod md5|sha-1</code> 签名加密方式</li>\n<li><code>accesskey_arg</code> GET 参数名称</li>\n<li><code>accesskey_signature</code> 加密规则</li>\n</ul>\n<p>同样，首先要确认已安装该模块。</p>\n<p>示例：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">valid_referers</span> <span class=\"literal\">none</span> <span class=\"literal\">blocked</span> imooc.com <span class=\"regexp\">*.imooc.com</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">if</span> (<span class=\"variable\">$invalid_referer</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey</span> <span class=\"literal\">on</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey_hashmethod</span> md5;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey_arg</span> <span class=\"string\">&quot;your_arg&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">accesskey_signature</span> <span class=\"string\">&quot;your_pass<span class=\"variable\">$remote_addr</span>&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>nginx 端进行了这样的配置，php 端要相应地做相同的配置，签名才能通过。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$your_arg = md5(<span class=\"string\">&#x27;your_pass&#x27;</span> . $_SERVER[<span class=\"string\">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;img src=&quot;address?your_arg=&#x27;</span> . $your_arg . <span class=\"string\">&#x27;&quot;&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>这种方法基本可以实现完全的防盗链，但是所有的资源文件的路径都要加上一个参数，对于编码来说比较麻烦。两种方式各有利弊，使用哪种方式要视具体业务及情况进行考虑。</p>"},{"title":"高并发大流量解决方案 10 MySQL 数据库层的优化","date":"2018-02-15T08:35:43.000Z","_content":"\n#### MySQL 数据库层优化\n\n\n##### 1. 数据表数据类型优化\n\n- 字段使用什么样的数据类型更合适\n- 字段使用什么样的数据类型性能更快\n\n<!-- more -->\n\n按需选择，如年龄选择 tinyint 无符号即可；smallint 古建筑、古树年龄等；bigint 存储大数据。考虑空间的问题，考虑范围的问题。\n\nchar，varchar，手机号码固定 11 位，md5 字符串固定 32 位，宜用 char 类型；用户名等不固定长度的应使用\n\nvarchar，需要考虑存储字符串长度是否固定。\n\nenum：特定、固定的分类可以使用 enum 存储，效率更快，扩展性较差。但实际情况中一般不用\nip 地址的存储，一般用字符串存储，但占用空间较大，用整型存储比较合适。ip2long(), long2ip()\n\n##### 2. 索引优化\n\n- 建立合适的索引\n- 索引在什么场景下效率最高\n\n索引的创建原则：索引不是越多越好，在合适的字段上创建合适的索引。索引会提升查询操作速度，但是胡影响写入操作的效率，也会占用更多的磁盘空间。\n\n- 注意复合索引的最左前缀原则\n- 注意 like 查询的 % 问题， % 在前，该字段的索引将失效\n- 注意全表扫描优化\n- 注意 or 条件索引使用情况，如果 or 前面的列有索引，or 后面的列没有索引，所以会失效。\n- 注意字符串类型索引失效问题：如果字符串内存的是整型数据，查询时直接以整型的形式去查，索引会失效，查询时要加引号。\n\n##### 3. SQL 语句优化\n\n- 优化查询过程中的数据访问\n  \n  使用 limit， 尽量不用 *\n- 优化长难句的查询语句\n\n  变复杂为简单\n  \n  切分查询\n  \n  分解关联查询\n\n- 优化特定类型的查询语句\n\n  优化 count()\n  \n  优化关联查询\n  \n  优化子查询，尽量使用关联查询替代\n  \n  优化 group by 和 distinct\n  \n  优化 limit 和 union\n\n##### 4. 存储引擎优化\n\n尽量使用 InnoDB，支持事务，支持外键，使用独立表空间，使用行级锁\n\n##### 5. 数据表结构设计优化\n\n> 分区操作\n\n通过特定的策略对数据表进行物理拆分\n对用户透明，用户无感知\npartition by\n\n> 分库分表\n\n水平拆分\n垂直拆分\n\n##### 6. 数据库服务器架构优化\n\n> 主从复制\n\n> 读写分离\n\n> 双主热备\n\n> 负载均衡\n\n通过 LVS 的三种基本模式实现负载均衡\n\nmycat 数据库中间件实现负载均衡\n\n","source":"_posts/高并发大流量解决方案-10-MySQL-数据库层的优化.md","raw":"---\ntitle: 高并发大流量解决方案 10 MySQL 数据库层的优化\ndate: 2018-02-15 16:35:43\ntags: 高并发\n---\n\n#### MySQL 数据库层优化\n\n\n##### 1. 数据表数据类型优化\n\n- 字段使用什么样的数据类型更合适\n- 字段使用什么样的数据类型性能更快\n\n<!-- more -->\n\n按需选择，如年龄选择 tinyint 无符号即可；smallint 古建筑、古树年龄等；bigint 存储大数据。考虑空间的问题，考虑范围的问题。\n\nchar，varchar，手机号码固定 11 位，md5 字符串固定 32 位，宜用 char 类型；用户名等不固定长度的应使用\n\nvarchar，需要考虑存储字符串长度是否固定。\n\nenum：特定、固定的分类可以使用 enum 存储，效率更快，扩展性较差。但实际情况中一般不用\nip 地址的存储，一般用字符串存储，但占用空间较大，用整型存储比较合适。ip2long(), long2ip()\n\n##### 2. 索引优化\n\n- 建立合适的索引\n- 索引在什么场景下效率最高\n\n索引的创建原则：索引不是越多越好，在合适的字段上创建合适的索引。索引会提升查询操作速度，但是胡影响写入操作的效率，也会占用更多的磁盘空间。\n\n- 注意复合索引的最左前缀原则\n- 注意 like 查询的 % 问题， % 在前，该字段的索引将失效\n- 注意全表扫描优化\n- 注意 or 条件索引使用情况，如果 or 前面的列有索引，or 后面的列没有索引，所以会失效。\n- 注意字符串类型索引失效问题：如果字符串内存的是整型数据，查询时直接以整型的形式去查，索引会失效，查询时要加引号。\n\n##### 3. SQL 语句优化\n\n- 优化查询过程中的数据访问\n  \n  使用 limit， 尽量不用 *\n- 优化长难句的查询语句\n\n  变复杂为简单\n  \n  切分查询\n  \n  分解关联查询\n\n- 优化特定类型的查询语句\n\n  优化 count()\n  \n  优化关联查询\n  \n  优化子查询，尽量使用关联查询替代\n  \n  优化 group by 和 distinct\n  \n  优化 limit 和 union\n\n##### 4. 存储引擎优化\n\n尽量使用 InnoDB，支持事务，支持外键，使用独立表空间，使用行级锁\n\n##### 5. 数据表结构设计优化\n\n> 分区操作\n\n通过特定的策略对数据表进行物理拆分\n对用户透明，用户无感知\npartition by\n\n> 分库分表\n\n水平拆分\n垂直拆分\n\n##### 6. 数据库服务器架构优化\n\n> 主从复制\n\n> 读写分离\n\n> 双主热备\n\n> 负载均衡\n\n通过 LVS 的三种基本模式实现负载均衡\n\nmycat 数据库中间件实现负载均衡\n\n","slug":"高并发大流量解决方案-10-MySQL-数据库层的优化","published":1,"updated":"2020-09-11T01:04:35.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzak00546wo15ttkb0ah","content":"<h4 id=\"MySQL-数据库层优化\"><a href=\"#MySQL-数据库层优化\" class=\"headerlink\" title=\"MySQL 数据库层优化\"></a>MySQL 数据库层优化</h4><h5 id=\"1-数据表数据类型优化\"><a href=\"#1-数据表数据类型优化\" class=\"headerlink\" title=\"1. 数据表数据类型优化\"></a>1. 数据表数据类型优化</h5><ul>\n<li>字段使用什么样的数据类型更合适</li>\n<li>字段使用什么样的数据类型性能更快</li>\n</ul>\n<a id=\"more\"></a>\n\n<p>按需选择，如年龄选择 tinyint 无符号即可；smallint 古建筑、古树年龄等；bigint 存储大数据。考虑空间的问题，考虑范围的问题。</p>\n<p>char，varchar，手机号码固定 11 位，md5 字符串固定 32 位，宜用 char 类型；用户名等不固定长度的应使用</p>\n<p>varchar，需要考虑存储字符串长度是否固定。</p>\n<p>enum：特定、固定的分类可以使用 enum 存储，效率更快，扩展性较差。但实际情况中一般不用<br>ip 地址的存储，一般用字符串存储，但占用空间较大，用整型存储比较合适。ip2long(), long2ip()</p>\n<h5 id=\"2-索引优化\"><a href=\"#2-索引优化\" class=\"headerlink\" title=\"2. 索引优化\"></a>2. 索引优化</h5><ul>\n<li>建立合适的索引</li>\n<li>索引在什么场景下效率最高</li>\n</ul>\n<p>索引的创建原则：索引不是越多越好，在合适的字段上创建合适的索引。索引会提升查询操作速度，但是胡影响写入操作的效率，也会占用更多的磁盘空间。</p>\n<ul>\n<li>注意复合索引的最左前缀原则</li>\n<li>注意 like 查询的 % 问题， % 在前，该字段的索引将失效</li>\n<li>注意全表扫描优化</li>\n<li>注意 or 条件索引使用情况，如果 or 前面的列有索引，or 后面的列没有索引，所以会失效。</li>\n<li>注意字符串类型索引失效问题：如果字符串内存的是整型数据，查询时直接以整型的形式去查，索引会失效，查询时要加引号。</li>\n</ul>\n<h5 id=\"3-SQL-语句优化\"><a href=\"#3-SQL-语句优化\" class=\"headerlink\" title=\"3. SQL 语句优化\"></a>3. SQL 语句优化</h5><ul>\n<li><p>优化查询过程中的数据访问</p>\n<p>使用 limit， 尽量不用 *</p>\n</li>\n<li><p>优化长难句的查询语句</p>\n<p>变复杂为简单</p>\n<p>切分查询</p>\n<p>分解关联查询</p>\n</li>\n<li><p>优化特定类型的查询语句</p>\n<p>优化 count()</p>\n<p>优化关联查询</p>\n<p>优化子查询，尽量使用关联查询替代</p>\n<p>优化 group by 和 distinct</p>\n<p>优化 limit 和 union</p>\n</li>\n</ul>\n<h5 id=\"4-存储引擎优化\"><a href=\"#4-存储引擎优化\" class=\"headerlink\" title=\"4. 存储引擎优化\"></a>4. 存储引擎优化</h5><p>尽量使用 InnoDB，支持事务，支持外键，使用独立表空间，使用行级锁</p>\n<h5 id=\"5-数据表结构设计优化\"><a href=\"#5-数据表结构设计优化\" class=\"headerlink\" title=\"5. 数据表结构设计优化\"></a>5. 数据表结构设计优化</h5><blockquote>\n<p>分区操作</p>\n</blockquote>\n<p>通过特定的策略对数据表进行物理拆分<br>对用户透明，用户无感知<br>partition by</p>\n<blockquote>\n<p>分库分表</p>\n</blockquote>\n<p>水平拆分<br>垂直拆分</p>\n<h5 id=\"6-数据库服务器架构优化\"><a href=\"#6-数据库服务器架构优化\" class=\"headerlink\" title=\"6. 数据库服务器架构优化\"></a>6. 数据库服务器架构优化</h5><blockquote>\n<p>主从复制</p>\n</blockquote>\n<blockquote>\n<p>读写分离</p>\n</blockquote>\n<blockquote>\n<p>双主热备</p>\n</blockquote>\n<blockquote>\n<p>负载均衡</p>\n</blockquote>\n<p>通过 LVS 的三种基本模式实现负载均衡</p>\n<p>mycat 数据库中间件实现负载均衡</p>\n","site":{"data":{}},"excerpt":"<h4 id=\"MySQL-数据库层优化\"><a href=\"#MySQL-数据库层优化\" class=\"headerlink\" title=\"MySQL 数据库层优化\"></a>MySQL 数据库层优化</h4><h5 id=\"1-数据表数据类型优化\"><a href=\"#1-数据表数据类型优化\" class=\"headerlink\" title=\"1. 数据表数据类型优化\"></a>1. 数据表数据类型优化</h5><ul>\n<li>字段使用什么样的数据类型更合适</li>\n<li>字段使用什么样的数据类型性能更快</li>\n</ul>","more":"<p>按需选择，如年龄选择 tinyint 无符号即可；smallint 古建筑、古树年龄等；bigint 存储大数据。考虑空间的问题，考虑范围的问题。</p>\n<p>char，varchar，手机号码固定 11 位，md5 字符串固定 32 位，宜用 char 类型；用户名等不固定长度的应使用</p>\n<p>varchar，需要考虑存储字符串长度是否固定。</p>\n<p>enum：特定、固定的分类可以使用 enum 存储，效率更快，扩展性较差。但实际情况中一般不用<br>ip 地址的存储，一般用字符串存储，但占用空间较大，用整型存储比较合适。ip2long(), long2ip()</p>\n<h5 id=\"2-索引优化\"><a href=\"#2-索引优化\" class=\"headerlink\" title=\"2. 索引优化\"></a>2. 索引优化</h5><ul>\n<li>建立合适的索引</li>\n<li>索引在什么场景下效率最高</li>\n</ul>\n<p>索引的创建原则：索引不是越多越好，在合适的字段上创建合适的索引。索引会提升查询操作速度，但是胡影响写入操作的效率，也会占用更多的磁盘空间。</p>\n<ul>\n<li>注意复合索引的最左前缀原则</li>\n<li>注意 like 查询的 % 问题， % 在前，该字段的索引将失效</li>\n<li>注意全表扫描优化</li>\n<li>注意 or 条件索引使用情况，如果 or 前面的列有索引，or 后面的列没有索引，所以会失效。</li>\n<li>注意字符串类型索引失效问题：如果字符串内存的是整型数据，查询时直接以整型的形式去查，索引会失效，查询时要加引号。</li>\n</ul>\n<h5 id=\"3-SQL-语句优化\"><a href=\"#3-SQL-语句优化\" class=\"headerlink\" title=\"3. SQL 语句优化\"></a>3. SQL 语句优化</h5><ul>\n<li><p>优化查询过程中的数据访问</p>\n<p>使用 limit， 尽量不用 *</p>\n</li>\n<li><p>优化长难句的查询语句</p>\n<p>变复杂为简单</p>\n<p>切分查询</p>\n<p>分解关联查询</p>\n</li>\n<li><p>优化特定类型的查询语句</p>\n<p>优化 count()</p>\n<p>优化关联查询</p>\n<p>优化子查询，尽量使用关联查询替代</p>\n<p>优化 group by 和 distinct</p>\n<p>优化 limit 和 union</p>\n</li>\n</ul>\n<h5 id=\"4-存储引擎优化\"><a href=\"#4-存储引擎优化\" class=\"headerlink\" title=\"4. 存储引擎优化\"></a>4. 存储引擎优化</h5><p>尽量使用 InnoDB，支持事务，支持外键，使用独立表空间，使用行级锁</p>\n<h5 id=\"5-数据表结构设计优化\"><a href=\"#5-数据表结构设计优化\" class=\"headerlink\" title=\"5. 数据表结构设计优化\"></a>5. 数据表结构设计优化</h5><blockquote>\n<p>分区操作</p>\n</blockquote>\n<p>通过特定的策略对数据表进行物理拆分<br>对用户透明，用户无感知<br>partition by</p>\n<blockquote>\n<p>分库分表</p>\n</blockquote>\n<p>水平拆分<br>垂直拆分</p>\n<h5 id=\"6-数据库服务器架构优化\"><a href=\"#6-数据库服务器架构优化\" class=\"headerlink\" title=\"6. 数据库服务器架构优化\"></a>6. 数据库服务器架构优化</h5><blockquote>\n<p>主从复制</p>\n</blockquote>\n<blockquote>\n<p>读写分离</p>\n</blockquote>\n<blockquote>\n<p>双主热备</p>\n</blockquote>\n<blockquote>\n<p>负载均衡</p>\n</blockquote>\n<p>通过 LVS 的三种基本模式实现负载均衡</p>\n<p>mycat 数据库中间件实现负载均衡</p>"},{"title":"高并发大流量解决方案 11 web 服务器的负载均衡，请求分发","date":"2018-02-15T08:36:07.000Z","_content":"\n\n### 1. web 服务器的负载均衡，请求分发\n\n#### 1.  #### 1. 七层负载均衡的实现\n\n基于 url 等应用层信息的负载均衡\n\nnginx 的 proxy 是它一个很强大的功能，实现了七层负载均衡\n\n<!-- more -->\n\n- 功能强大、性能卓越、运行稳定\n- 配置简单灵活 upstream\n- 能够自动剔除工作不正常的后端服务器\n- 上传文件使用异步模式\n- 支持多种分配策略，可以分配权重，分配方式灵活\n\n> nginx 负载均衡\n\n1. 内置策略: IP hash、加权轮询\n\n- 加权轮询策略：首先将请求都分给高权重的机器，直到该机器的权值降到了比其他机器低，才开始将请求分给下一个高权重的机器。\n当所有后端机器都 down 掉时，nginx 会立即将所有机器的标志位清成初始状态，以避免造成所有的机器都处于 timeout 状态。\n- IP hash 策略：nginx 内置的另一个负载均衡的策略，流程和轮询很类似，只是其中的算法和具体的策略有些变化。IP hash 算法是一种变相的轮询算法\n\n2. 扩展策略: fair 策略、通用 hash、一致性 hash\n\n- fair 策略：根据后端服务器的响应时间判断负载情况，从中选出负载最轻的机器进行分流，有点类似 CDN 的原理。\n- 通用 hash、一致性 hash：通用 hash 比较简单，可以以 nginx 内置的变量为 key 进行 hash，一致性 hash 采用了 nginx 内置的一致性 hash 环，支持 memcache\n\n\nnginx 配置方案\n\n``` nginx\nhttp {\n\t# cluster 为集群名称\n\tupstream cluster {\n\t\tserver srv1;\n\t\tserver srv2;\n\t\tserver srv3;\n\t}\n\tserver {\n\t\tlisten 80;\n\t\tlocation / {\n\t\t\tproxy_pass http://cluster;\n\t\t}\n\t}\n}\n```\n\n#### 2. 四层负载均衡的实现\n\n通过报文中的模板地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器\n\nlVS 实现服务器集群负载均衡有三种方式：NAT、DR 和 TUN\n\n\n总结：大概思路，再细化\n\n- 流量优化：防盗链处理；\n- 前端优化：浏览器缓存，数据压缩，CDN 加速，独立图片服务器；\n- 服务端：动态语言静态化，动态语言并发处理；\n- 数据层：数据缓存，MySQL 优化；\n- web 服务器负载均衡。\n","source":"_posts/高并发大流量解决方案-11-web-服务器的负载均衡，请求分发.md","raw":"---\ntitle: 高并发大流量解决方案 11 web 服务器的负载均衡，请求分发\ndate: 2018-02-15 16:36:07\ntags: 高并发\n---\n\n\n### 1. web 服务器的负载均衡，请求分发\n\n#### 1.  #### 1. 七层负载均衡的实现\n\n基于 url 等应用层信息的负载均衡\n\nnginx 的 proxy 是它一个很强大的功能，实现了七层负载均衡\n\n<!-- more -->\n\n- 功能强大、性能卓越、运行稳定\n- 配置简单灵活 upstream\n- 能够自动剔除工作不正常的后端服务器\n- 上传文件使用异步模式\n- 支持多种分配策略，可以分配权重，分配方式灵活\n\n> nginx 负载均衡\n\n1. 内置策略: IP hash、加权轮询\n\n- 加权轮询策略：首先将请求都分给高权重的机器，直到该机器的权值降到了比其他机器低，才开始将请求分给下一个高权重的机器。\n当所有后端机器都 down 掉时，nginx 会立即将所有机器的标志位清成初始状态，以避免造成所有的机器都处于 timeout 状态。\n- IP hash 策略：nginx 内置的另一个负载均衡的策略，流程和轮询很类似，只是其中的算法和具体的策略有些变化。IP hash 算法是一种变相的轮询算法\n\n2. 扩展策略: fair 策略、通用 hash、一致性 hash\n\n- fair 策略：根据后端服务器的响应时间判断负载情况，从中选出负载最轻的机器进行分流，有点类似 CDN 的原理。\n- 通用 hash、一致性 hash：通用 hash 比较简单，可以以 nginx 内置的变量为 key 进行 hash，一致性 hash 采用了 nginx 内置的一致性 hash 环，支持 memcache\n\n\nnginx 配置方案\n\n``` nginx\nhttp {\n\t# cluster 为集群名称\n\tupstream cluster {\n\t\tserver srv1;\n\t\tserver srv2;\n\t\tserver srv3;\n\t}\n\tserver {\n\t\tlisten 80;\n\t\tlocation / {\n\t\t\tproxy_pass http://cluster;\n\t\t}\n\t}\n}\n```\n\n#### 2. 四层负载均衡的实现\n\n通过报文中的模板地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器\n\nlVS 实现服务器集群负载均衡有三种方式：NAT、DR 和 TUN\n\n\n总结：大概思路，再细化\n\n- 流量优化：防盗链处理；\n- 前端优化：浏览器缓存，数据压缩，CDN 加速，独立图片服务器；\n- 服务端：动态语言静态化，动态语言并发处理；\n- 数据层：数据缓存，MySQL 优化；\n- web 服务器负载均衡。\n","slug":"高并发大流量解决方案-11-web-服务器的负载均衡，请求分发","published":1,"updated":"2020-09-11T01:04:35.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzak00566wo1ebny5o0v","content":"<h3 id=\"1-web-服务器的负载均衡，请求分发\"><a href=\"#1-web-服务器的负载均衡，请求分发\" class=\"headerlink\" title=\"1. web 服务器的负载均衡，请求分发\"></a>1. web 服务器的负载均衡，请求分发</h3><h4 id=\"1-1-七层负载均衡的实现\"><a href=\"#1-1-七层负载均衡的实现\" class=\"headerlink\" title=\"1.  #### 1. 七层负载均衡的实现\"></a>1.  #### 1. 七层负载均衡的实现</h4><p>基于 url 等应用层信息的负载均衡</p>\n<p>nginx 的 proxy 是它一个很强大的功能，实现了七层负载均衡</p>\n<a id=\"more\"></a>\n\n<ul>\n<li>功能强大、性能卓越、运行稳定</li>\n<li>配置简单灵活 upstream</li>\n<li>能够自动剔除工作不正常的后端服务器</li>\n<li>上传文件使用异步模式</li>\n<li>支持多种分配策略，可以分配权重，分配方式灵活</li>\n</ul>\n<blockquote>\n<p>nginx 负载均衡</p>\n</blockquote>\n<ol>\n<li>内置策略: IP hash、加权轮询</li>\n</ol>\n<ul>\n<li>加权轮询策略：首先将请求都分给高权重的机器，直到该机器的权值降到了比其他机器低，才开始将请求分给下一个高权重的机器。<br>当所有后端机器都 down 掉时，nginx 会立即将所有机器的标志位清成初始状态，以避免造成所有的机器都处于 timeout 状态。</li>\n<li>IP hash 策略：nginx 内置的另一个负载均衡的策略，流程和轮询很类似，只是其中的算法和具体的策略有些变化。IP hash 算法是一种变相的轮询算法</li>\n</ul>\n<ol start=\"2\">\n<li>扩展策略: fair 策略、通用 hash、一致性 hash</li>\n</ol>\n<ul>\n<li>fair 策略：根据后端服务器的响应时间判断负载情况，从中选出负载最轻的机器进行分流，有点类似 CDN 的原理。</li>\n<li>通用 hash、一致性 hash：通用 hash 比较简单，可以以 nginx 内置的变量为 key 进行 hash，一致性 hash 采用了 nginx 内置的一致性 hash 环，支持 memcache</li>\n</ul>\n<p>nginx 配置方案</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\"># cluster 为集群名称</span></span><br><span class=\"line\">\t<span class=\"attribute\">upstream</span> cluster &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">server</span> srv1;</span><br><span class=\"line\">\t\t<span class=\"attribute\">server</span> srv2;</span><br><span class=\"line\">\t\t<span class=\"attribute\">server</span> srv3;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"section\">server</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">proxy_pass</span> http://cluster;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-四层负载均衡的实现\"><a href=\"#2-四层负载均衡的实现\" class=\"headerlink\" title=\"2. 四层负载均衡的实现\"></a>2. 四层负载均衡的实现</h4><p>通过报文中的模板地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器</p>\n<p>lVS 实现服务器集群负载均衡有三种方式：NAT、DR 和 TUN</p>\n<p>总结：大概思路，再细化</p>\n<ul>\n<li>流量优化：防盗链处理；</li>\n<li>前端优化：浏览器缓存，数据压缩，CDN 加速，独立图片服务器；</li>\n<li>服务端：动态语言静态化，动态语言并发处理；</li>\n<li>数据层：数据缓存，MySQL 优化；</li>\n<li>web 服务器负载均衡。</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"1-web-服务器的负载均衡，请求分发\"><a href=\"#1-web-服务器的负载均衡，请求分发\" class=\"headerlink\" title=\"1. web 服务器的负载均衡，请求分发\"></a>1. web 服务器的负载均衡，请求分发</h3><h4 id=\"1-1-七层负载均衡的实现\"><a href=\"#1-1-七层负载均衡的实现\" class=\"headerlink\" title=\"1.  #### 1. 七层负载均衡的实现\"></a>1.  #### 1. 七层负载均衡的实现</h4><p>基于 url 等应用层信息的负载均衡</p>\n<p>nginx 的 proxy 是它一个很强大的功能，实现了七层负载均衡</p>","more":"<ul>\n<li>功能强大、性能卓越、运行稳定</li>\n<li>配置简单灵活 upstream</li>\n<li>能够自动剔除工作不正常的后端服务器</li>\n<li>上传文件使用异步模式</li>\n<li>支持多种分配策略，可以分配权重，分配方式灵活</li>\n</ul>\n<blockquote>\n<p>nginx 负载均衡</p>\n</blockquote>\n<ol>\n<li>内置策略: IP hash、加权轮询</li>\n</ol>\n<ul>\n<li>加权轮询策略：首先将请求都分给高权重的机器，直到该机器的权值降到了比其他机器低，才开始将请求分给下一个高权重的机器。<br>当所有后端机器都 down 掉时，nginx 会立即将所有机器的标志位清成初始状态，以避免造成所有的机器都处于 timeout 状态。</li>\n<li>IP hash 策略：nginx 内置的另一个负载均衡的策略，流程和轮询很类似，只是其中的算法和具体的策略有些变化。IP hash 算法是一种变相的轮询算法</li>\n</ul>\n<ol start=\"2\">\n<li>扩展策略: fair 策略、通用 hash、一致性 hash</li>\n</ol>\n<ul>\n<li>fair 策略：根据后端服务器的响应时间判断负载情况，从中选出负载最轻的机器进行分流，有点类似 CDN 的原理。</li>\n<li>通用 hash、一致性 hash：通用 hash 比较简单，可以以 nginx 内置的变量为 key 进行 hash，一致性 hash 采用了 nginx 内置的一致性 hash 环，支持 memcache</li>\n</ul>\n<p>nginx 配置方案</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\"># cluster 为集群名称</span></span><br><span class=\"line\">\t<span class=\"attribute\">upstream</span> cluster &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">server</span> srv1;</span><br><span class=\"line\">\t\t<span class=\"attribute\">server</span> srv2;</span><br><span class=\"line\">\t\t<span class=\"attribute\">server</span> srv3;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"section\">server</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"attribute\">listen</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">\t\t<span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">\t\t\t<span class=\"attribute\">proxy_pass</span> http://cluster;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-四层负载均衡的实现\"><a href=\"#2-四层负载均衡的实现\" class=\"headerlink\" title=\"2. 四层负载均衡的实现\"></a>2. 四层负载均衡的实现</h4><p>通过报文中的模板地址和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器</p>\n<p>lVS 实现服务器集群负载均衡有三种方式：NAT、DR 和 TUN</p>\n<p>总结：大概思路，再细化</p>\n<ul>\n<li>流量优化：防盗链处理；</li>\n<li>前端优化：浏览器缓存，数据压缩，CDN 加速，独立图片服务器；</li>\n<li>服务端：动态语言静态化，动态语言并发处理；</li>\n<li>数据层：数据缓存，MySQL 优化；</li>\n<li>web 服务器负载均衡。</li>\n</ul>"},{"title":"高并发大流量解决方案 2 减少 http 请求次数","date":"2018-02-15T08:31:11.000Z","_content":"\n### 2. 减少 http 请求次数\n\n#### 1. 为什么要减少 http 请求\n\n   - 性能黄金法则\n   \n     只有10%-20%的最终用户响应时间花在接收请求的html文档上，剩下的80%-90%时间花在html文档所引用的所有组件（图片、script、css、flash等）进行的http请求上。\n     \n<!-- more -->\n\n   - 如何改善\n   \n     改善响应时间最简单的途径就是减少组件的数量，并由此减少http请求的数量。    \n  - http 连接产生的开销\n  \n    域名解析 - tcp连接 - 发送请求 - 等待 - 下载资源 - 浏览器解析\n\n\n#### 2. 减少 http 请求的方式\n\n##### 1. 图片地图\n  \n    图片地图允许在一张图片上关联多个url，目标url的选择取决于点击了图片上的哪个位置。\n    \n   如：导航的多张图片，可以使用多张分开的图片，然后每张图片对应一个超链接。这样就会产生多个图片的http请求，我们的目标是要减少http请求，将多张图片合成为一张图片，然后以位置信息定义超链接，达到减少http请求的目的。把http请求减少为一个，可以保证设计的完整性和功能的齐全性。\n   \n   \n 示例：\n \nhttp://stevesouders.com/hpws/imagemap-no.php\n\nhttp://stevesouders.com/hpws/imagemap.php\n\n``` html\n<center>\n<img usemap=\"#map1\" border=\"0\" src=\"/images/imagemap.gif?t=1518433942\">\n<map name=\"map1\">\n  <area shape=\"rect\" coords=\"0,0,31,31\" href=\"javascript:alert('Home')\" title=\"Home\">\n  <area shape=\"rect\" coords=\"36,0,66,31\" href=\"javascript:alert('Gifts')\" title=\"Gifts\">\n  <area shape=\"rect\" coords=\"71,0,101,31\" href=\"javascript:alert('Cart')\" title=\"Cart\">\n  <area shape=\"rect\" coords=\"106,0,136,31\" href=\"javascript:alert('Settings')\" title=\"Settings\">\n  <area shape=\"rect\" coords=\"141,0,171,31\" href=\"javascript:alert('Help')\" title=\"Help\">\n</map>\n</center>\n```\n\n##### 2. css Sprites\n\ncss 精灵，通过使用合并图片，通过指定css 的 `background-image` 和 `background-position` 来显示元素。\n\n示例：\n\nhttp://stevesouders.com/hpws/sprites.php\n\n``` html\n<div id=\"navbar\" style=\"background-color: #F4F5EB; border: 2px ridge #333; width: 180px; height: 32px; padding: 4px 0 4px 0;\">\n  <a href=\"javascript:alert('Home')\" title=\"Home\"><span class=\"home\"></span></a>\n  <a href=\"javascript:alert('Gifts')\" title=\"Gifts\"><span class=\"gifts\"></span></a>\n  <a href=\"javascript:alert('Cart')\" title=\"Cart\"><span class=\"cart\"></span></a>\n  <a href=\"javascript:alert('Settings')\" title=\"Settings\"><span class=\"settings\"></span></a>\n  <a href=\"javascript:alert('Help')\" title=\"Help\"><span class=\"help\"></span></a>\n</div>\n```\n\n``` css\n<style>\n#navbar span {\n  width:31px;\n  height:31px;\n  display:inline;\n  float:left;\n  background-image:url(/images/spritebg.gif?t=1518434522);\n}\n.home     { background-position:0 0; margin-right:4px; margin-left: 4px;}\n.gifts    { background-position:-32px 0; margin-right:4px;}\n.cart     { background-position:-64px 0; margin-right:4px;}\n.settings { background-position:-96px 0; margin-right:4px;}\n.help     { background-position:-128px 0; margin-right:0px;}\n</style>\n```\n\n性能分析：图片地图和css精灵的响应时间基本相同，但比使用多个图片的方式要快50%以上。css精灵比图片地图方便一些，通常选用css精灵的方式。\n\n\n##### 3. 合并脚本和样式表\n\n使用外部css和js文件引用的方式，这比直接写在页面中性能要好一点。但这样会增加http请求数量。独立一个js文件比用多个文件载入速度快38%。\n\n##### 4. 图片使用 base64 编码减少页面请求数\n\n采用 base64 编码将图片直接嵌入到网页中，而不是从外部载入。但是HTML文件会变大些。\n\n`php file_get_conetents` 读出图片文件，然后使用 `base64_encode` 函数生成。","source":"_posts/高并发大流量解决方案-2-减少-http-请求次数.md","raw":"---\ntitle: 高并发大流量解决方案 2 减少 http 请求次数\ndate: 2018-02-15 16:31:11\ntags: 高并发\n---\n\n### 2. 减少 http 请求次数\n\n#### 1. 为什么要减少 http 请求\n\n   - 性能黄金法则\n   \n     只有10%-20%的最终用户响应时间花在接收请求的html文档上，剩下的80%-90%时间花在html文档所引用的所有组件（图片、script、css、flash等）进行的http请求上。\n     \n<!-- more -->\n\n   - 如何改善\n   \n     改善响应时间最简单的途径就是减少组件的数量，并由此减少http请求的数量。    \n  - http 连接产生的开销\n  \n    域名解析 - tcp连接 - 发送请求 - 等待 - 下载资源 - 浏览器解析\n\n\n#### 2. 减少 http 请求的方式\n\n##### 1. 图片地图\n  \n    图片地图允许在一张图片上关联多个url，目标url的选择取决于点击了图片上的哪个位置。\n    \n   如：导航的多张图片，可以使用多张分开的图片，然后每张图片对应一个超链接。这样就会产生多个图片的http请求，我们的目标是要减少http请求，将多张图片合成为一张图片，然后以位置信息定义超链接，达到减少http请求的目的。把http请求减少为一个，可以保证设计的完整性和功能的齐全性。\n   \n   \n 示例：\n \nhttp://stevesouders.com/hpws/imagemap-no.php\n\nhttp://stevesouders.com/hpws/imagemap.php\n\n``` html\n<center>\n<img usemap=\"#map1\" border=\"0\" src=\"/images/imagemap.gif?t=1518433942\">\n<map name=\"map1\">\n  <area shape=\"rect\" coords=\"0,0,31,31\" href=\"javascript:alert('Home')\" title=\"Home\">\n  <area shape=\"rect\" coords=\"36,0,66,31\" href=\"javascript:alert('Gifts')\" title=\"Gifts\">\n  <area shape=\"rect\" coords=\"71,0,101,31\" href=\"javascript:alert('Cart')\" title=\"Cart\">\n  <area shape=\"rect\" coords=\"106,0,136,31\" href=\"javascript:alert('Settings')\" title=\"Settings\">\n  <area shape=\"rect\" coords=\"141,0,171,31\" href=\"javascript:alert('Help')\" title=\"Help\">\n</map>\n</center>\n```\n\n##### 2. css Sprites\n\ncss 精灵，通过使用合并图片，通过指定css 的 `background-image` 和 `background-position` 来显示元素。\n\n示例：\n\nhttp://stevesouders.com/hpws/sprites.php\n\n``` html\n<div id=\"navbar\" style=\"background-color: #F4F5EB; border: 2px ridge #333; width: 180px; height: 32px; padding: 4px 0 4px 0;\">\n  <a href=\"javascript:alert('Home')\" title=\"Home\"><span class=\"home\"></span></a>\n  <a href=\"javascript:alert('Gifts')\" title=\"Gifts\"><span class=\"gifts\"></span></a>\n  <a href=\"javascript:alert('Cart')\" title=\"Cart\"><span class=\"cart\"></span></a>\n  <a href=\"javascript:alert('Settings')\" title=\"Settings\"><span class=\"settings\"></span></a>\n  <a href=\"javascript:alert('Help')\" title=\"Help\"><span class=\"help\"></span></a>\n</div>\n```\n\n``` css\n<style>\n#navbar span {\n  width:31px;\n  height:31px;\n  display:inline;\n  float:left;\n  background-image:url(/images/spritebg.gif?t=1518434522);\n}\n.home     { background-position:0 0; margin-right:4px; margin-left: 4px;}\n.gifts    { background-position:-32px 0; margin-right:4px;}\n.cart     { background-position:-64px 0; margin-right:4px;}\n.settings { background-position:-96px 0; margin-right:4px;}\n.help     { background-position:-128px 0; margin-right:0px;}\n</style>\n```\n\n性能分析：图片地图和css精灵的响应时间基本相同，但比使用多个图片的方式要快50%以上。css精灵比图片地图方便一些，通常选用css精灵的方式。\n\n\n##### 3. 合并脚本和样式表\n\n使用外部css和js文件引用的方式，这比直接写在页面中性能要好一点。但这样会增加http请求数量。独立一个js文件比用多个文件载入速度快38%。\n\n##### 4. 图片使用 base64 编码减少页面请求数\n\n采用 base64 编码将图片直接嵌入到网页中，而不是从外部载入。但是HTML文件会变大些。\n\n`php file_get_conetents` 读出图片文件，然后使用 `base64_encode` 函数生成。","slug":"高并发大流量解决方案-2-减少-http-请求次数","published":1,"updated":"2020-09-11T01:04:35.060Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzan00596wo1f4ekd0l5","content":"<h3 id=\"2-减少-http-请求次数\"><a href=\"#2-减少-http-请求次数\" class=\"headerlink\" title=\"2. 减少 http 请求次数\"></a>2. 减少 http 请求次数</h3><h4 id=\"1-为什么要减少-http-请求\"><a href=\"#1-为什么要减少-http-请求\" class=\"headerlink\" title=\"1. 为什么要减少 http 请求\"></a>1. 为什么要减少 http 请求</h4><ul>\n<li><p>性能黄金法则</p>\n<p>只有10%-20%的最终用户响应时间花在接收请求的html文档上，剩下的80%-90%时间花在html文档所引用的所有组件（图片、script、css、flash等）进行的http请求上。</p>\n</li>\n</ul>\n<a id=\"more\"></a>\n\n<ul>\n<li><p>如何改善</p>\n<p>改善响应时间最简单的途径就是减少组件的数量，并由此减少http请求的数量。    </p>\n<ul>\n<li>http 连接产生的开销</li>\n</ul>\n<p>域名解析 - tcp连接 - 发送请求 - 等待 - 下载资源 - 浏览器解析</p>\n</li>\n</ul>\n<h4 id=\"2-减少-http-请求的方式\"><a href=\"#2-减少-http-请求的方式\" class=\"headerlink\" title=\"2. 减少 http 请求的方式\"></a>2. 减少 http 请求的方式</h4><h5 id=\"1-图片地图\"><a href=\"#1-图片地图\" class=\"headerlink\" title=\"1. 图片地图\"></a>1. 图片地图</h5><pre><code>图片地图允许在一张图片上关联多个url，目标url的选择取决于点击了图片上的哪个位置。</code></pre>\n<p>   如：导航的多张图片，可以使用多张分开的图片，然后每张图片对应一个超链接。这样就会产生多个图片的http请求，我们的目标是要减少http请求，将多张图片合成为一张图片，然后以位置信息定义超链接，达到减少http请求的目的。把http请求减少为一个，可以保证设计的完整性和功能的齐全性。</p>\n<p> 示例：</p>\n<p><a href=\"http://stevesouders.com/hpws/imagemap-no.php\">http://stevesouders.com/hpws/imagemap-no.php</a></p>\n<p><a href=\"http://stevesouders.com/hpws/imagemap.php\">http://stevesouders.com/hpws/imagemap.php</a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">center</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">usemap</span>=<span class=\"string\">&quot;#map1&quot;</span> <span class=\"attr\">border</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/images/imagemap.gif?t=1518433942&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">map</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;map1&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;0,0,31,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Home&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Home&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;36,0,66,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Gifts&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Gifts&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;71,0,101,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Cart&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Cart&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;106,0,136,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Settings&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Settings&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;141,0,171,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Help&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Help&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">map</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">center</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-css-Sprites\"><a href=\"#2-css-Sprites\" class=\"headerlink\" title=\"2. css Sprites\"></a>2. css Sprites</h5><p>css 精灵，通过使用合并图片，通过指定css 的 <code>background-image</code> 和 <code>background-position</code> 来显示元素。</p>\n<p>示例：</p>\n<p><a href=\"http://stevesouders.com/hpws/sprites.php\">http://stevesouders.com/hpws/sprites.php</a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;navbar&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #F4F5EB; border: 2px ridge #333; width: 180px; height: 32px; padding: 4px 0 4px 0;&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Home&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Home&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;home&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Gifts&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Gifts&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;gifts&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Cart&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Cart&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;cart&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Settings&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Settings&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;settings&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Help&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Help&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;help&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"selector-tag\">style</span>&gt;</span><br><span class=\"line\"><span class=\"selector-id\">#navbar</span> <span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>:<span class=\"number\">31px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>:<span class=\"number\">31px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:inline;</span><br><span class=\"line\">  <span class=\"attribute\">float</span>:left;</span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>:<span class=\"built_in\">url</span>(/images/spritebg.gif?t=<span class=\"number\">1518434522</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.home</span>     &#123; <span class=\"attribute\">background-position</span>:<span class=\"number\">0</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>; <span class=\"attribute\">margin-left</span>: <span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.gifts</span>    &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">32px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.cart</span>     &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">64px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.settings</span> &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">96px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.help</span>     &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">128px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">0px</span>;&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n\n<p>性能分析：图片地图和css精灵的响应时间基本相同，但比使用多个图片的方式要快50%以上。css精灵比图片地图方便一些，通常选用css精灵的方式。</p>\n<h5 id=\"3-合并脚本和样式表\"><a href=\"#3-合并脚本和样式表\" class=\"headerlink\" title=\"3. 合并脚本和样式表\"></a>3. 合并脚本和样式表</h5><p>使用外部css和js文件引用的方式，这比直接写在页面中性能要好一点。但这样会增加http请求数量。独立一个js文件比用多个文件载入速度快38%。</p>\n<h5 id=\"4-图片使用-base64-编码减少页面请求数\"><a href=\"#4-图片使用-base64-编码减少页面请求数\" class=\"headerlink\" title=\"4. 图片使用 base64 编码减少页面请求数\"></a>4. 图片使用 base64 编码减少页面请求数</h5><p>采用 base64 编码将图片直接嵌入到网页中，而不是从外部载入。但是HTML文件会变大些。</p>\n<p><code>php file_get_conetents</code> 读出图片文件，然后使用 <code>base64_encode</code> 函数生成。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"2-减少-http-请求次数\"><a href=\"#2-减少-http-请求次数\" class=\"headerlink\" title=\"2. 减少 http 请求次数\"></a>2. 减少 http 请求次数</h3><h4 id=\"1-为什么要减少-http-请求\"><a href=\"#1-为什么要减少-http-请求\" class=\"headerlink\" title=\"1. 为什么要减少 http 请求\"></a>1. 为什么要减少 http 请求</h4><ul>\n<li><p>性能黄金法则</p>\n<p>只有10%-20%的最终用户响应时间花在接收请求的html文档上，剩下的80%-90%时间花在html文档所引用的所有组件（图片、script、css、flash等）进行的http请求上。</p>\n</li>\n</ul>","more":"<ul>\n<li><p>如何改善</p>\n<p>改善响应时间最简单的途径就是减少组件的数量，并由此减少http请求的数量。    </p>\n<ul>\n<li>http 连接产生的开销</li>\n</ul>\n<p>域名解析 - tcp连接 - 发送请求 - 等待 - 下载资源 - 浏览器解析</p>\n</li>\n</ul>\n<h4 id=\"2-减少-http-请求的方式\"><a href=\"#2-减少-http-请求的方式\" class=\"headerlink\" title=\"2. 减少 http 请求的方式\"></a>2. 减少 http 请求的方式</h4><h5 id=\"1-图片地图\"><a href=\"#1-图片地图\" class=\"headerlink\" title=\"1. 图片地图\"></a>1. 图片地图</h5><pre><code>图片地图允许在一张图片上关联多个url，目标url的选择取决于点击了图片上的哪个位置。</code></pre>\n<p>   如：导航的多张图片，可以使用多张分开的图片，然后每张图片对应一个超链接。这样就会产生多个图片的http请求，我们的目标是要减少http请求，将多张图片合成为一张图片，然后以位置信息定义超链接，达到减少http请求的目的。把http请求减少为一个，可以保证设计的完整性和功能的齐全性。</p>\n<p> 示例：</p>\n<p><a href=\"http://stevesouders.com/hpws/imagemap-no.php\">http://stevesouders.com/hpws/imagemap-no.php</a></p>\n<p><a href=\"http://stevesouders.com/hpws/imagemap.php\">http://stevesouders.com/hpws/imagemap.php</a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">center</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">usemap</span>=<span class=\"string\">&quot;#map1&quot;</span> <span class=\"attr\">border</span>=<span class=\"string\">&quot;0&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;/images/imagemap.gif?t=1518433942&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">map</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;map1&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;0,0,31,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Home&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Home&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;36,0,66,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Gifts&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Gifts&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;71,0,101,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Cart&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Cart&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;106,0,136,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Settings&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Settings&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">area</span> <span class=\"attr\">shape</span>=<span class=\"string\">&quot;rect&quot;</span> <span class=\"attr\">coords</span>=<span class=\"string\">&quot;141,0,171,31&quot;</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Help&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Help&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">map</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">center</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-css-Sprites\"><a href=\"#2-css-Sprites\" class=\"headerlink\" title=\"2. css Sprites\"></a>2. css Sprites</h5><p>css 精灵，通过使用合并图片，通过指定css 的 <code>background-image</code> 和 <code>background-position</code> 来显示元素。</p>\n<p>示例：</p>\n<p><a href=\"http://stevesouders.com/hpws/sprites.php\">http://stevesouders.com/hpws/sprites.php</a></p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;navbar&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #F4F5EB; border: 2px ridge #333; width: 180px; height: 32px; padding: 4px 0 4px 0;&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Home&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Home&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;home&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Gifts&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Gifts&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;gifts&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Cart&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Cart&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;cart&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Settings&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Settings&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;settings&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">&quot;javascript:alert(&#x27;Help&#x27;)&quot;</span> <span class=\"attr\">title</span>=<span class=\"string\">&quot;Help&quot;</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;help&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;<span class=\"selector-tag\">style</span>&gt;</span><br><span class=\"line\"><span class=\"selector-id\">#navbar</span> <span class=\"selector-tag\">span</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>:<span class=\"number\">31px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>:<span class=\"number\">31px</span>;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>:inline;</span><br><span class=\"line\">  <span class=\"attribute\">float</span>:left;</span><br><span class=\"line\">  <span class=\"attribute\">background-image</span>:<span class=\"built_in\">url</span>(/images/spritebg.gif?t=<span class=\"number\">1518434522</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.home</span>     &#123; <span class=\"attribute\">background-position</span>:<span class=\"number\">0</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>; <span class=\"attribute\">margin-left</span>: <span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.gifts</span>    &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">32px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.cart</span>     &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">64px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.settings</span> &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">96px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">4px</span>;&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.help</span>     &#123; <span class=\"attribute\">background-position</span>:-<span class=\"number\">128px</span> <span class=\"number\">0</span>; <span class=\"attribute\">margin-right</span>:<span class=\"number\">0px</span>;&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n\n<p>性能分析：图片地图和css精灵的响应时间基本相同，但比使用多个图片的方式要快50%以上。css精灵比图片地图方便一些，通常选用css精灵的方式。</p>\n<h5 id=\"3-合并脚本和样式表\"><a href=\"#3-合并脚本和样式表\" class=\"headerlink\" title=\"3. 合并脚本和样式表\"></a>3. 合并脚本和样式表</h5><p>使用外部css和js文件引用的方式，这比直接写在页面中性能要好一点。但这样会增加http请求数量。独立一个js文件比用多个文件载入速度快38%。</p>\n<h5 id=\"4-图片使用-base64-编码减少页面请求数\"><a href=\"#4-图片使用-base64-编码减少页面请求数\" class=\"headerlink\" title=\"4. 图片使用 base64 编码减少页面请求数\"></a>4. 图片使用 base64 编码减少页面请求数</h5><p>采用 base64 编码将图片直接嵌入到网页中，而不是从外部载入。但是HTML文件会变大些。</p>\n<p><code>php file_get_conetents</code> 读出图片文件，然后使用 <code>base64_encode</code> 函数生成。</p>"},{"title":"高并发大流量解决方案 3 浏览器缓存和压缩优化技术","date":"2018-02-15T08:31:49.000Z","_content":"\n### 1. http 缓存机制\n\nhttp 缓存模型中，如果请求成功会有三种情况\n- `200 from cache`：直接从本地缓存中获取响应，最快速、最省流量，因为根本没有向服务器发送请求；\n- `304 not modified`：协商缓存，浏览器在本地没有命中的情况下，请求头中发送一定的校验数据到服务器，如果服务端数据没有改变，浏览器从本地缓存响应，返回 304，即先去服务端验证文件是否被修改过。这种方式快速，发送的数据很少，只返回一些基本的响应头信息，数据量很小，不发送实际响应体。\n- `200 ok`：以上两种缓存全部失败，服务器返回完整响应，没有用到缓存，相对最慢。\n\n<!-- more -->\n\n#### 1. 本地缓存\n\n浏览器认为本地缓存可以使用，不会去请求服务端。\n\n相关 `Header`\n1. `Pragma`：HTTP1.0 时代的遗留产物，该字段被设置为 `no-cache` 时，会告知浏览器禁用本地缓存，即每次都向服务器发送请求。\n2. `Expires`：HTTP1.0 时代用来启用本地缓存的字段，标记缓存的过期时间。`Expires` 对应一个格林威治时间，告知浏览器缓存过期的时刻，如果还没到期，表名缓存有效，无需请求服务器。问题：服务端的时间和客户端的时间基准不一定一致，如果时间差距大，会影响缓存效果。\n3. `Cache-Control`：HTTP1.1 针对 `Expires` 时间基准不一致的问题的解决方案。该参数告知浏览器缓存过期的时间间隔（秒数）而不是时刻，即使具体时间不一致，也不影响缓存的效果。设置为 `no-store`，则禁止浏览器缓存响应；`no-cache`，不允许直接使用本地缓存，先发起请求和服务器协商；`max-age=3600`，告知浏览器本地缓存有效的最长期限，单位为秒。\n\n> <span style=\"color:red\">优先级： `Pragma` > `Cache-Control` > `Expires`</sapn>\n\n\n#### 2. 协商缓存\n\n  当浏览器没有命中本地缓存，如本地缓存过期或者响应中声明不允许直接使用本地缓存，那么浏览器肯定会发起服务端请求。\n  \n  服务端会验证数据是否被修改，如果没有，通知浏览器使用本地缓存。\n  \n  相关 `Header`\n  1. `Last-Modified`：资源的最后修改时间，浏览器请求一个资源的时候，服务端进行响应，并带一个 `Last-Modified`，下次再请求服务器的时候，带着这个时间（header 中添加 `If-Modified-Since`），服务器会判断这个时间点之后，该资源是否发生了修改，如果没有修改，会返回304，告知浏览器使用本地缓存；\n1. `ETag`：HTTP1.1 推出，文件的指纹标识符，第二次浏览器请求服务的时候，带着这个指纹（header 中添加 `If-None-Match`），如果文件内容修改，指纹会改变。\n\n#### 3. 缓存策略的选择\n\n##### 1. 适合缓存的内容\n\n- 不变的图片、logo 等；\n- js、css 静态文件；\n- 可下载的内容、媒体文件等；\n\n##### 2. 建议使用协商缓存的内容\n\n经常改变的文件适合使用协商缓存，如 \n- html 文件；\n- 经常替换的图片；\n- 经常修改的 js、css 文件。\n\njs、css 文件的加载可以加入文件的签名来拒绝缓存，如时间戳、版本号等。index.css?签名\n\n##### 3. 不建议缓存的内容\n\n- 用户隐私等敏感数据；\n- 经常改变的API数据接口。\n\n### 2. nginx 配置缓存策略\n\n简单示例\n\n``` php\n<?php\n$since = isset($_SERVER['HTTP_IF_MODIFIED_SINCE']) ? $_SERVER['HTTP_IF_MODIFIED_SINCE'] : '';\n// 模拟文件修改\n$lifetime = 3600;\nif (!empty($since)) {\n\tif (strtotime($since) + $lifetime > time()) {\n\t\theader('HTTP/1.1 304 Not Modified');\n\t\texit;\n\t}\n}\n\nheader(sprintf('Last-Modified: %s GMT'), gmdate('D, d M Y H:i:s', time()));\necho time();\n```\n\n#### 1. 本地缓存配置\n\n`add_header` 指令：添加状态码为2XX和3XX的响应头信息。\n\n语法： `add_header name value [always];` name 可以为`pragma`/`cache-control`/`expires`，可以继承。<span style=\"color:red\">expires 最常用</span>，通知浏览器过期时长，后面跟数字和单位，如 `expires 30d;`，数值为负相当于 `cache-control no-cache;`，数值为0或正值相当于 `cache-control max-age=指定时间;`。\n\nnginx 配置实例\n``` nginx\nlocation ~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$\n{\n\texpires 30d;\n}\n\nlocation ~ .*\\.(js|css)?$\n{\n\texpires 12h;\n}\n```\n\n#### 2. 协商缓存配置\n\netag指令，指定签名。\n\netag on | off， 默认为 on\n\n\n### 3. 前端代码和资源的压缩\n\n优势：让资源文件更小，加快文件在网络中的传输，让网页更快地展示，降低带宽和流量开销。\n\n压缩方式：js、css、图片、HTML文件压缩；gzip 压缩\n\n#### 1. js 代码的压缩\n\n一般是去掉多余的空格和回车、替换长变量名、简化一些代码写法等。\n\n常用压缩工具：UglifyJS、YUI Compressor、Closure Compiler\n\n在线工具： https://tool.css-js.com/  或 https://www.css-js.com/\n\n#### 2. css 代码压缩\n\n原理与 js 压缩类似\n\n常用压缩工具：YUI Compressor、css Compressor\n\n#### 3. HTML 代码压缩\n\n不建议使用代码压缩，有时会破坏代码结构，可以使用 gzip 压缩，也可以使用 htmlcompressor 工具，但转换后一定要检查代码结构。\n\n在线工具： http://htmlcompressor.com/compressor/\n\n#### 4. 图片压缩\n\n压缩工具： [tinypng](https://tinypng.com/)、[JpegMini](http://www.jpegmini.com/)、[ImageOptim](https://www.imageoptim.com)\n\n#### 5. <span style=\"color:red;\">gzip 压缩</span>\n\n``` nginx\ngzip on | off;\ngzip_buffers 32 4K | 16 8K; # 缓冲，在内存中缓冲几块，每块多大\ngzip_comp_level [1-9]; 推荐6，压缩级别，级别越高，压得越小，越浪费CPU资源\ngzip_disable # 正则匹配UA，什么样的uri不进行gzip\ngzip_min_length 200 # 开始压缩的最小长度\ngzip_http_version 1.0 | 1.1 # 开始压缩的http版本\ngzip_proxied # 设置请求的代理服务器\ngzip_types text/plain application/xml # 对哪些类型的文件启用压缩\ngzip_vary on | off # 是否传输gzip压缩标记\n```\n\n#### 6. 其他工具\n\n自动化构建工具 Grunt 等。\n","source":"_posts/高并发大流量解决方案-3-浏览器缓存和压缩优化技术.md","raw":"---\ntitle: 高并发大流量解决方案 3 浏览器缓存和压缩优化技术\ndate: 2018-02-15 16:31:49\ntags: 高并发\n---\n\n### 1. http 缓存机制\n\nhttp 缓存模型中，如果请求成功会有三种情况\n- `200 from cache`：直接从本地缓存中获取响应，最快速、最省流量，因为根本没有向服务器发送请求；\n- `304 not modified`：协商缓存，浏览器在本地没有命中的情况下，请求头中发送一定的校验数据到服务器，如果服务端数据没有改变，浏览器从本地缓存响应，返回 304，即先去服务端验证文件是否被修改过。这种方式快速，发送的数据很少，只返回一些基本的响应头信息，数据量很小，不发送实际响应体。\n- `200 ok`：以上两种缓存全部失败，服务器返回完整响应，没有用到缓存，相对最慢。\n\n<!-- more -->\n\n#### 1. 本地缓存\n\n浏览器认为本地缓存可以使用，不会去请求服务端。\n\n相关 `Header`\n1. `Pragma`：HTTP1.0 时代的遗留产物，该字段被设置为 `no-cache` 时，会告知浏览器禁用本地缓存，即每次都向服务器发送请求。\n2. `Expires`：HTTP1.0 时代用来启用本地缓存的字段，标记缓存的过期时间。`Expires` 对应一个格林威治时间，告知浏览器缓存过期的时刻，如果还没到期，表名缓存有效，无需请求服务器。问题：服务端的时间和客户端的时间基准不一定一致，如果时间差距大，会影响缓存效果。\n3. `Cache-Control`：HTTP1.1 针对 `Expires` 时间基准不一致的问题的解决方案。该参数告知浏览器缓存过期的时间间隔（秒数）而不是时刻，即使具体时间不一致，也不影响缓存的效果。设置为 `no-store`，则禁止浏览器缓存响应；`no-cache`，不允许直接使用本地缓存，先发起请求和服务器协商；`max-age=3600`，告知浏览器本地缓存有效的最长期限，单位为秒。\n\n> <span style=\"color:red\">优先级： `Pragma` > `Cache-Control` > `Expires`</sapn>\n\n\n#### 2. 协商缓存\n\n  当浏览器没有命中本地缓存，如本地缓存过期或者响应中声明不允许直接使用本地缓存，那么浏览器肯定会发起服务端请求。\n  \n  服务端会验证数据是否被修改，如果没有，通知浏览器使用本地缓存。\n  \n  相关 `Header`\n  1. `Last-Modified`：资源的最后修改时间，浏览器请求一个资源的时候，服务端进行响应，并带一个 `Last-Modified`，下次再请求服务器的时候，带着这个时间（header 中添加 `If-Modified-Since`），服务器会判断这个时间点之后，该资源是否发生了修改，如果没有修改，会返回304，告知浏览器使用本地缓存；\n1. `ETag`：HTTP1.1 推出，文件的指纹标识符，第二次浏览器请求服务的时候，带着这个指纹（header 中添加 `If-None-Match`），如果文件内容修改，指纹会改变。\n\n#### 3. 缓存策略的选择\n\n##### 1. 适合缓存的内容\n\n- 不变的图片、logo 等；\n- js、css 静态文件；\n- 可下载的内容、媒体文件等；\n\n##### 2. 建议使用协商缓存的内容\n\n经常改变的文件适合使用协商缓存，如 \n- html 文件；\n- 经常替换的图片；\n- 经常修改的 js、css 文件。\n\njs、css 文件的加载可以加入文件的签名来拒绝缓存，如时间戳、版本号等。index.css?签名\n\n##### 3. 不建议缓存的内容\n\n- 用户隐私等敏感数据；\n- 经常改变的API数据接口。\n\n### 2. nginx 配置缓存策略\n\n简单示例\n\n``` php\n<?php\n$since = isset($_SERVER['HTTP_IF_MODIFIED_SINCE']) ? $_SERVER['HTTP_IF_MODIFIED_SINCE'] : '';\n// 模拟文件修改\n$lifetime = 3600;\nif (!empty($since)) {\n\tif (strtotime($since) + $lifetime > time()) {\n\t\theader('HTTP/1.1 304 Not Modified');\n\t\texit;\n\t}\n}\n\nheader(sprintf('Last-Modified: %s GMT'), gmdate('D, d M Y H:i:s', time()));\necho time();\n```\n\n#### 1. 本地缓存配置\n\n`add_header` 指令：添加状态码为2XX和3XX的响应头信息。\n\n语法： `add_header name value [always];` name 可以为`pragma`/`cache-control`/`expires`，可以继承。<span style=\"color:red\">expires 最常用</span>，通知浏览器过期时长，后面跟数字和单位，如 `expires 30d;`，数值为负相当于 `cache-control no-cache;`，数值为0或正值相当于 `cache-control max-age=指定时间;`。\n\nnginx 配置实例\n``` nginx\nlocation ~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$\n{\n\texpires 30d;\n}\n\nlocation ~ .*\\.(js|css)?$\n{\n\texpires 12h;\n}\n```\n\n#### 2. 协商缓存配置\n\netag指令，指定签名。\n\netag on | off， 默认为 on\n\n\n### 3. 前端代码和资源的压缩\n\n优势：让资源文件更小，加快文件在网络中的传输，让网页更快地展示，降低带宽和流量开销。\n\n压缩方式：js、css、图片、HTML文件压缩；gzip 压缩\n\n#### 1. js 代码的压缩\n\n一般是去掉多余的空格和回车、替换长变量名、简化一些代码写法等。\n\n常用压缩工具：UglifyJS、YUI Compressor、Closure Compiler\n\n在线工具： https://tool.css-js.com/  或 https://www.css-js.com/\n\n#### 2. css 代码压缩\n\n原理与 js 压缩类似\n\n常用压缩工具：YUI Compressor、css Compressor\n\n#### 3. HTML 代码压缩\n\n不建议使用代码压缩，有时会破坏代码结构，可以使用 gzip 压缩，也可以使用 htmlcompressor 工具，但转换后一定要检查代码结构。\n\n在线工具： http://htmlcompressor.com/compressor/\n\n#### 4. 图片压缩\n\n压缩工具： [tinypng](https://tinypng.com/)、[JpegMini](http://www.jpegmini.com/)、[ImageOptim](https://www.imageoptim.com)\n\n#### 5. <span style=\"color:red;\">gzip 压缩</span>\n\n``` nginx\ngzip on | off;\ngzip_buffers 32 4K | 16 8K; # 缓冲，在内存中缓冲几块，每块多大\ngzip_comp_level [1-9]; 推荐6，压缩级别，级别越高，压得越小，越浪费CPU资源\ngzip_disable # 正则匹配UA，什么样的uri不进行gzip\ngzip_min_length 200 # 开始压缩的最小长度\ngzip_http_version 1.0 | 1.1 # 开始压缩的http版本\ngzip_proxied # 设置请求的代理服务器\ngzip_types text/plain application/xml # 对哪些类型的文件启用压缩\ngzip_vary on | off # 是否传输gzip压缩标记\n```\n\n#### 6. 其他工具\n\n自动化构建工具 Grunt 等。\n","slug":"高并发大流量解决方案-3-浏览器缓存和压缩优化技术","published":1,"updated":"2020-09-11T01:04:35.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzao005a6wo1e20b9wfq","content":"<h3 id=\"1-http-缓存机制\"><a href=\"#1-http-缓存机制\" class=\"headerlink\" title=\"1. http 缓存机制\"></a>1. http 缓存机制</h3><p>http 缓存模型中，如果请求成功会有三种情况</p>\n<ul>\n<li><code>200 from cache</code>：直接从本地缓存中获取响应，最快速、最省流量，因为根本没有向服务器发送请求；</li>\n<li><code>304 not modified</code>：协商缓存，浏览器在本地没有命中的情况下，请求头中发送一定的校验数据到服务器，如果服务端数据没有改变，浏览器从本地缓存响应，返回 304，即先去服务端验证文件是否被修改过。这种方式快速，发送的数据很少，只返回一些基本的响应头信息，数据量很小，不发送实际响应体。</li>\n<li><code>200 ok</code>：以上两种缓存全部失败，服务器返回完整响应，没有用到缓存，相对最慢。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"1-本地缓存\"><a href=\"#1-本地缓存\" class=\"headerlink\" title=\"1. 本地缓存\"></a>1. 本地缓存</h4><p>浏览器认为本地缓存可以使用，不会去请求服务端。</p>\n<p>相关 <code>Header</code></p>\n<ol>\n<li><code>Pragma</code>：HTTP1.0 时代的遗留产物，该字段被设置为 <code>no-cache</code> 时，会告知浏览器禁用本地缓存，即每次都向服务器发送请求。</li>\n<li><code>Expires</code>：HTTP1.0 时代用来启用本地缓存的字段，标记缓存的过期时间。<code>Expires</code> 对应一个格林威治时间，告知浏览器缓存过期的时刻，如果还没到期，表名缓存有效，无需请求服务器。问题：服务端的时间和客户端的时间基准不一定一致，如果时间差距大，会影响缓存效果。</li>\n<li><code>Cache-Control</code>：HTTP1.1 针对 <code>Expires</code> 时间基准不一致的问题的解决方案。该参数告知浏览器缓存过期的时间间隔（秒数）而不是时刻，即使具体时间不一致，也不影响缓存的效果。设置为 <code>no-store</code>，则禁止浏览器缓存响应；<code>no-cache</code>，不允许直接使用本地缓存，先发起请求和服务器协商；<code>max-age=3600</code>，告知浏览器本地缓存有效的最长期限，单位为秒。</li>\n</ol>\n<blockquote>\n<p><span style=\"color:red\">优先级： <code>Pragma</code> &gt; <code>Cache-Control</code> &gt; <code>Expires</code></sapn></p>\n</blockquote>\n<h4 id=\"2-协商缓存\"><a href=\"#2-协商缓存\" class=\"headerlink\" title=\"2. 协商缓存\"></a>2. 协商缓存</h4><p>  当浏览器没有命中本地缓存，如本地缓存过期或者响应中声明不允许直接使用本地缓存，那么浏览器肯定会发起服务端请求。</p>\n<p>  服务端会验证数据是否被修改，如果没有，通知浏览器使用本地缓存。</p>\n<p>  相关 <code>Header</code></p>\n<ol>\n<li><code>Last-Modified</code>：资源的最后修改时间，浏览器请求一个资源的时候，服务端进行响应，并带一个 <code>Last-Modified</code>，下次再请求服务器的时候，带着这个时间（header 中添加 <code>If-Modified-Since</code>），服务器会判断这个时间点之后，该资源是否发生了修改，如果没有修改，会返回304，告知浏览器使用本地缓存；<ol>\n<li><code>ETag</code>：HTTP1.1 推出，文件的指纹标识符，第二次浏览器请求服务的时候，带着这个指纹（header 中添加 <code>If-None-Match</code>），如果文件内容修改，指纹会改变。</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"3-缓存策略的选择\"><a href=\"#3-缓存策略的选择\" class=\"headerlink\" title=\"3. 缓存策略的选择\"></a>3. 缓存策略的选择</h4><h5 id=\"1-适合缓存的内容\"><a href=\"#1-适合缓存的内容\" class=\"headerlink\" title=\"1. 适合缓存的内容\"></a>1. 适合缓存的内容</h5><ul>\n<li>不变的图片、logo 等；</li>\n<li>js、css 静态文件；</li>\n<li>可下载的内容、媒体文件等；</li>\n</ul>\n<h5 id=\"2-建议使用协商缓存的内容\"><a href=\"#2-建议使用协商缓存的内容\" class=\"headerlink\" title=\"2. 建议使用协商缓存的内容\"></a>2. 建议使用协商缓存的内容</h5><p>经常改变的文件适合使用协商缓存，如 </p>\n<ul>\n<li>html 文件；</li>\n<li>经常替换的图片；</li>\n<li>经常修改的 js、css 文件。</li>\n</ul>\n<p>js、css 文件的加载可以加入文件的签名来拒绝缓存，如时间戳、版本号等。index.css?签名</p>\n<h5 id=\"3-不建议缓存的内容\"><a href=\"#3-不建议缓存的内容\" class=\"headerlink\" title=\"3. 不建议缓存的内容\"></a>3. 不建议缓存的内容</h5><ul>\n<li>用户隐私等敏感数据；</li>\n<li>经常改变的API数据接口。</li>\n</ul>\n<h3 id=\"2-nginx-配置缓存策略\"><a href=\"#2-nginx-配置缓存策略\" class=\"headerlink\" title=\"2. nginx 配置缓存策略\"></a>2. nginx 配置缓存策略</h3><p>简单示例</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$since = <span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">&#x27;HTTP_IF_MODIFIED_SINCE&#x27;</span>]) ? $_SERVER[<span class=\"string\">&#x27;HTTP_IF_MODIFIED_SINCE&#x27;</span>] : <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// 模拟文件修改</span></span><br><span class=\"line\">$lifetime = <span class=\"number\">3600</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($since)) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (strtotime($since) + $lifetime &gt; time()) &#123;</span><br><span class=\"line\">\t\theader(<span class=\"string\">&#x27;HTTP/1.1 304 Not Modified&#x27;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">header(sprintf(<span class=\"string\">&#x27;Last-Modified: %s GMT&#x27;</span>), gmdate(<span class=\"string\">&#x27;D, d M Y H:i:s&#x27;</span>, time()));</span><br><span class=\"line\"><span class=\"keyword\">echo</span> time();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-本地缓存配置\"><a href=\"#1-本地缓存配置\" class=\"headerlink\" title=\"1. 本地缓存配置\"></a>1. 本地缓存配置</h4><p><code>add_header</code> 指令：添加状态码为2XX和3XX的响应头信息。</p>\n<p>语法： <code>add_header name value [always];</code> name 可以为<code>pragma</code>/<code>cache-control</code>/<code>expires</code>，可以继承。<span style=\"color:red\">expires 最常用</span>，通知浏览器过期时长，后面跟数字和单位，如 <code>expires 30d;</code>，数值为负相当于 <code>cache-control no-cache;</code>，数值为0或正值相当于 <code>cache-control max-age=指定时间;</code>。</p>\n<p>nginx 配置实例</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">expires</span> <span class=\"number\">30d</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(js|css)?$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">expires</span> <span class=\"number\">12h</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-协商缓存配置\"><a href=\"#2-协商缓存配置\" class=\"headerlink\" title=\"2. 协商缓存配置\"></a>2. 协商缓存配置</h4><p>etag指令，指定签名。</p>\n<p>etag on | off， 默认为 on</p>\n<h3 id=\"3-前端代码和资源的压缩\"><a href=\"#3-前端代码和资源的压缩\" class=\"headerlink\" title=\"3. 前端代码和资源的压缩\"></a>3. 前端代码和资源的压缩</h3><p>优势：让资源文件更小，加快文件在网络中的传输，让网页更快地展示，降低带宽和流量开销。</p>\n<p>压缩方式：js、css、图片、HTML文件压缩；gzip 压缩</p>\n<h4 id=\"1-js-代码的压缩\"><a href=\"#1-js-代码的压缩\" class=\"headerlink\" title=\"1. js 代码的压缩\"></a>1. js 代码的压缩</h4><p>一般是去掉多余的空格和回车、替换长变量名、简化一些代码写法等。</p>\n<p>常用压缩工具：UglifyJS、YUI Compressor、Closure Compiler</p>\n<p>在线工具： <a href=\"https://tool.css-js.com/\">https://tool.css-js.com/</a>  或 <a href=\"https://www.css-js.com/\">https://www.css-js.com/</a></p>\n<h4 id=\"2-css-代码压缩\"><a href=\"#2-css-代码压缩\" class=\"headerlink\" title=\"2. css 代码压缩\"></a>2. css 代码压缩</h4><p>原理与 js 压缩类似</p>\n<p>常用压缩工具：YUI Compressor、css Compressor</p>\n<h4 id=\"3-HTML-代码压缩\"><a href=\"#3-HTML-代码压缩\" class=\"headerlink\" title=\"3. HTML 代码压缩\"></a>3. HTML 代码压缩</h4><p>不建议使用代码压缩，有时会破坏代码结构，可以使用 gzip 压缩，也可以使用 htmlcompressor 工具，但转换后一定要检查代码结构。</p>\n<p>在线工具： <a href=\"http://htmlcompressor.com/compressor/\">http://htmlcompressor.com/compressor/</a></p>\n<h4 id=\"4-图片压缩\"><a href=\"#4-图片压缩\" class=\"headerlink\" title=\"4. 图片压缩\"></a>4. 图片压缩</h4><p>压缩工具： <a href=\"https://tinypng.com/\">tinypng</a>、<a href=\"http://www.jpegmini.com/\">JpegMini</a>、<a href=\"https://www.imageoptim.com/\">ImageOptim</a></p>\n<h4 id=\"5-gzip-压缩\"><a href=\"#5-gzip-压缩\" class=\"headerlink\" title=\"5. gzip 压缩\"></a>5. <span style=\"color:red;\">gzip 压缩</span></h4><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">gzip</span> <span class=\"literal\">on</span> | <span class=\"literal\">off</span>;</span><br><span class=\"line\"><span class=\"attribute\">gzip_buffers</span> <span class=\"number\">32</span> <span class=\"number\">4K</span> | <span class=\"number\">16</span> <span class=\"number\">8K</span>; <span class=\"comment\"># 缓冲，在内存中缓冲几块，每块多大</span></span><br><span class=\"line\">gzip_comp_level [1-9]; 推荐6，压缩级别，级别越高，压得越小，越浪费CPU资源</span><br><span class=\"line\"><span class=\"attribute\">gzip_disable</span> <span class=\"comment\"># 正则匹配UA，什么样的uri不进行gzip</span></span><br><span class=\"line\">gzip_min_length <span class=\"number\">200</span> <span class=\"comment\"># 开始压缩的最小长度</span></span><br><span class=\"line\">gzip_http_version <span class=\"number\">1</span>.<span class=\"number\">0</span> | <span class=\"number\">1</span>.<span class=\"number\">1</span> <span class=\"comment\"># 开始压缩的http版本</span></span><br><span class=\"line\">gzip_proxied <span class=\"comment\"># 设置请求的代理服务器</span></span><br><span class=\"line\">gzip_types text/plain application/xml <span class=\"comment\"># 对哪些类型的文件启用压缩</span></span><br><span class=\"line\">gzip_vary <span class=\"literal\">on</span> | <span class=\"literal\">off</span> <span class=\"comment\"># 是否传输gzip压缩标记</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-其他工具\"><a href=\"#6-其他工具\" class=\"headerlink\" title=\"6. 其他工具\"></a>6. 其他工具</h4><p>自动化构建工具 Grunt 等。</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"1-http-缓存机制\"><a href=\"#1-http-缓存机制\" class=\"headerlink\" title=\"1. http 缓存机制\"></a>1. http 缓存机制</h3><p>http 缓存模型中，如果请求成功会有三种情况</p>\n<ul>\n<li><code>200 from cache</code>：直接从本地缓存中获取响应，最快速、最省流量，因为根本没有向服务器发送请求；</li>\n<li><code>304 not modified</code>：协商缓存，浏览器在本地没有命中的情况下，请求头中发送一定的校验数据到服务器，如果服务端数据没有改变，浏览器从本地缓存响应，返回 304，即先去服务端验证文件是否被修改过。这种方式快速，发送的数据很少，只返回一些基本的响应头信息，数据量很小，不发送实际响应体。</li>\n<li><code>200 ok</code>：以上两种缓存全部失败，服务器返回完整响应，没有用到缓存，相对最慢。</li>\n</ul>","more":"<h4 id=\"1-本地缓存\"><a href=\"#1-本地缓存\" class=\"headerlink\" title=\"1. 本地缓存\"></a>1. 本地缓存</h4><p>浏览器认为本地缓存可以使用，不会去请求服务端。</p>\n<p>相关 <code>Header</code></p>\n<ol>\n<li><code>Pragma</code>：HTTP1.0 时代的遗留产物，该字段被设置为 <code>no-cache</code> 时，会告知浏览器禁用本地缓存，即每次都向服务器发送请求。</li>\n<li><code>Expires</code>：HTTP1.0 时代用来启用本地缓存的字段，标记缓存的过期时间。<code>Expires</code> 对应一个格林威治时间，告知浏览器缓存过期的时刻，如果还没到期，表名缓存有效，无需请求服务器。问题：服务端的时间和客户端的时间基准不一定一致，如果时间差距大，会影响缓存效果。</li>\n<li><code>Cache-Control</code>：HTTP1.1 针对 <code>Expires</code> 时间基准不一致的问题的解决方案。该参数告知浏览器缓存过期的时间间隔（秒数）而不是时刻，即使具体时间不一致，也不影响缓存的效果。设置为 <code>no-store</code>，则禁止浏览器缓存响应；<code>no-cache</code>，不允许直接使用本地缓存，先发起请求和服务器协商；<code>max-age=3600</code>，告知浏览器本地缓存有效的最长期限，单位为秒。</li>\n</ol>\n<blockquote>\n<p><span style=\"color:red\">优先级： <code>Pragma</code> &gt; <code>Cache-Control</code> &gt; <code>Expires</code></sapn></p>\n</blockquote>\n<h4 id=\"2-协商缓存\"><a href=\"#2-协商缓存\" class=\"headerlink\" title=\"2. 协商缓存\"></a>2. 协商缓存</h4><p>  当浏览器没有命中本地缓存，如本地缓存过期或者响应中声明不允许直接使用本地缓存，那么浏览器肯定会发起服务端请求。</p>\n<p>  服务端会验证数据是否被修改，如果没有，通知浏览器使用本地缓存。</p>\n<p>  相关 <code>Header</code></p>\n<ol>\n<li><code>Last-Modified</code>：资源的最后修改时间，浏览器请求一个资源的时候，服务端进行响应，并带一个 <code>Last-Modified</code>，下次再请求服务器的时候，带着这个时间（header 中添加 <code>If-Modified-Since</code>），服务器会判断这个时间点之后，该资源是否发生了修改，如果没有修改，会返回304，告知浏览器使用本地缓存；<ol>\n<li><code>ETag</code>：HTTP1.1 推出，文件的指纹标识符，第二次浏览器请求服务的时候，带着这个指纹（header 中添加 <code>If-None-Match</code>），如果文件内容修改，指纹会改变。</li>\n</ol>\n</li>\n</ol>\n<h4 id=\"3-缓存策略的选择\"><a href=\"#3-缓存策略的选择\" class=\"headerlink\" title=\"3. 缓存策略的选择\"></a>3. 缓存策略的选择</h4><h5 id=\"1-适合缓存的内容\"><a href=\"#1-适合缓存的内容\" class=\"headerlink\" title=\"1. 适合缓存的内容\"></a>1. 适合缓存的内容</h5><ul>\n<li>不变的图片、logo 等；</li>\n<li>js、css 静态文件；</li>\n<li>可下载的内容、媒体文件等；</li>\n</ul>\n<h5 id=\"2-建议使用协商缓存的内容\"><a href=\"#2-建议使用协商缓存的内容\" class=\"headerlink\" title=\"2. 建议使用协商缓存的内容\"></a>2. 建议使用协商缓存的内容</h5><p>经常改变的文件适合使用协商缓存，如 </p>\n<ul>\n<li>html 文件；</li>\n<li>经常替换的图片；</li>\n<li>经常修改的 js、css 文件。</li>\n</ul>\n<p>js、css 文件的加载可以加入文件的签名来拒绝缓存，如时间戳、版本号等。index.css?签名</p>\n<h5 id=\"3-不建议缓存的内容\"><a href=\"#3-不建议缓存的内容\" class=\"headerlink\" title=\"3. 不建议缓存的内容\"></a>3. 不建议缓存的内容</h5><ul>\n<li>用户隐私等敏感数据；</li>\n<li>经常改变的API数据接口。</li>\n</ul>\n<h3 id=\"2-nginx-配置缓存策略\"><a href=\"#2-nginx-配置缓存策略\" class=\"headerlink\" title=\"2. nginx 配置缓存策略\"></a>2. nginx 配置缓存策略</h3><p>简单示例</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$since = <span class=\"keyword\">isset</span>($_SERVER[<span class=\"string\">&#x27;HTTP_IF_MODIFIED_SINCE&#x27;</span>]) ? $_SERVER[<span class=\"string\">&#x27;HTTP_IF_MODIFIED_SINCE&#x27;</span>] : <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// 模拟文件修改</span></span><br><span class=\"line\">$lifetime = <span class=\"number\">3600</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($since)) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (strtotime($since) + $lifetime &gt; time()) &#123;</span><br><span class=\"line\">\t\theader(<span class=\"string\">&#x27;HTTP/1.1 304 Not Modified&#x27;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">header(sprintf(<span class=\"string\">&#x27;Last-Modified: %s GMT&#x27;</span>), gmdate(<span class=\"string\">&#x27;D, d M Y H:i:s&#x27;</span>, time()));</span><br><span class=\"line\"><span class=\"keyword\">echo</span> time();</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1-本地缓存配置\"><a href=\"#1-本地缓存配置\" class=\"headerlink\" title=\"1. 本地缓存配置\"></a>1. 本地缓存配置</h4><p><code>add_header</code> 指令：添加状态码为2XX和3XX的响应头信息。</p>\n<p>语法： <code>add_header name value [always];</code> name 可以为<code>pragma</code>/<code>cache-control</code>/<code>expires</code>，可以继承。<span style=\"color:red\">expires 最常用</span>，通知浏览器过期时长，后面跟数字和单位，如 <code>expires 30d;</code>，数值为负相当于 <code>cache-control no-cache;</code>，数值为0或正值相当于 <code>cache-control max-age=指定时间;</code>。</p>\n<p>nginx 配置实例</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(gif|jpg|png|flv|swf|rar|zip)$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">expires</span> <span class=\"number\">30d</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ .*\\.(js|css)?$</span></span><br><span class=\"line\"><span class=\"regexp\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">expires</span> <span class=\"number\">12h</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-协商缓存配置\"><a href=\"#2-协商缓存配置\" class=\"headerlink\" title=\"2. 协商缓存配置\"></a>2. 协商缓存配置</h4><p>etag指令，指定签名。</p>\n<p>etag on | off， 默认为 on</p>\n<h3 id=\"3-前端代码和资源的压缩\"><a href=\"#3-前端代码和资源的压缩\" class=\"headerlink\" title=\"3. 前端代码和资源的压缩\"></a>3. 前端代码和资源的压缩</h3><p>优势：让资源文件更小，加快文件在网络中的传输，让网页更快地展示，降低带宽和流量开销。</p>\n<p>压缩方式：js、css、图片、HTML文件压缩；gzip 压缩</p>\n<h4 id=\"1-js-代码的压缩\"><a href=\"#1-js-代码的压缩\" class=\"headerlink\" title=\"1. js 代码的压缩\"></a>1. js 代码的压缩</h4><p>一般是去掉多余的空格和回车、替换长变量名、简化一些代码写法等。</p>\n<p>常用压缩工具：UglifyJS、YUI Compressor、Closure Compiler</p>\n<p>在线工具： <a href=\"https://tool.css-js.com/\">https://tool.css-js.com/</a>  或 <a href=\"https://www.css-js.com/\">https://www.css-js.com/</a></p>\n<h4 id=\"2-css-代码压缩\"><a href=\"#2-css-代码压缩\" class=\"headerlink\" title=\"2. css 代码压缩\"></a>2. css 代码压缩</h4><p>原理与 js 压缩类似</p>\n<p>常用压缩工具：YUI Compressor、css Compressor</p>\n<h4 id=\"3-HTML-代码压缩\"><a href=\"#3-HTML-代码压缩\" class=\"headerlink\" title=\"3. HTML 代码压缩\"></a>3. HTML 代码压缩</h4><p>不建议使用代码压缩，有时会破坏代码结构，可以使用 gzip 压缩，也可以使用 htmlcompressor 工具，但转换后一定要检查代码结构。</p>\n<p>在线工具： <a href=\"http://htmlcompressor.com/compressor/\">http://htmlcompressor.com/compressor/</a></p>\n<h4 id=\"4-图片压缩\"><a href=\"#4-图片压缩\" class=\"headerlink\" title=\"4. 图片压缩\"></a>4. 图片压缩</h4><p>压缩工具： <a href=\"https://tinypng.com/\">tinypng</a>、<a href=\"http://www.jpegmini.com/\">JpegMini</a>、<a href=\"https://www.imageoptim.com/\">ImageOptim</a></p>\n<h4 id=\"5-gzip-压缩\"><a href=\"#5-gzip-压缩\" class=\"headerlink\" title=\"5. gzip 压缩\"></a>5. <span style=\"color:red;\">gzip 压缩</span></h4><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">gzip</span> <span class=\"literal\">on</span> | <span class=\"literal\">off</span>;</span><br><span class=\"line\"><span class=\"attribute\">gzip_buffers</span> <span class=\"number\">32</span> <span class=\"number\">4K</span> | <span class=\"number\">16</span> <span class=\"number\">8K</span>; <span class=\"comment\"># 缓冲，在内存中缓冲几块，每块多大</span></span><br><span class=\"line\">gzip_comp_level [1-9]; 推荐6，压缩级别，级别越高，压得越小，越浪费CPU资源</span><br><span class=\"line\"><span class=\"attribute\">gzip_disable</span> <span class=\"comment\"># 正则匹配UA，什么样的uri不进行gzip</span></span><br><span class=\"line\">gzip_min_length <span class=\"number\">200</span> <span class=\"comment\"># 开始压缩的最小长度</span></span><br><span class=\"line\">gzip_http_version <span class=\"number\">1</span>.<span class=\"number\">0</span> | <span class=\"number\">1</span>.<span class=\"number\">1</span> <span class=\"comment\"># 开始压缩的http版本</span></span><br><span class=\"line\">gzip_proxied <span class=\"comment\"># 设置请求的代理服务器</span></span><br><span class=\"line\">gzip_types text/plain application/xml <span class=\"comment\"># 对哪些类型的文件启用压缩</span></span><br><span class=\"line\">gzip_vary <span class=\"literal\">on</span> | <span class=\"literal\">off</span> <span class=\"comment\"># 是否传输gzip压缩标记</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"6-其他工具\"><a href=\"#6-其他工具\" class=\"headerlink\" title=\"6. 其他工具\"></a>6. 其他工具</h4><p>自动化构建工具 Grunt 等。</p>"},{"title":"高并发大流量解决方案 4 使用 CDN 加速","date":"2018-02-15T08:32:24.000Z","_content":"\n## 使用CDN加速\n\n#### 1. 什么是 CDN\n\nCDN 的全称是 content delivery network，即内容分发网络。\n\n<!-- more -->\n\n尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定。\n\n在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络（相当于真实服务器的镜像）。\n\nCDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。\n\n#### 2. 使用 CDN 的优势\n\n- 本地 cache 加速，提高了企业站点（尤其是含有大量图片和静态页面站点）的访问速度。\n- 跨运营商的网络加速（北联通、南电信），保证不同网络的用户都得到良好的访问质量。\n- 远程访问用户根据 DNS 负载均衡技术智能自动选择 cache 服务器。\n- 自动生成服务器的远程 mirror（镜像）cache 服务器，远程用户访问时从 cache 服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点 web 服务器负载等功能。\n- 广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵。\n\n#### 3. CDN 的工作原理\n\n##### 1. 传统访问\n\n用户在浏览器输入域名发起请求 -> 解析域名获取服务器 ip 地址 -> 根据 ip 地址找到对应的服务器 -> 服务器响应并返回数据\n\n##### 2. 使用 CDN 访问\n\n用户发起请求（cname）  -> 智能 DNS 解析（根据ip判断地理位置、接入网类型，选择路由最短和负载最轻的服务器） -> 取得缓存服务器ip -> 把内容返回给用户（如果缓存中有） -> 向源站点发起请求 -> 将结果返回给用户 -> 将结果存入缓存服务器\n\n#### 4. CDN 的适用场景\n\n- 站点或应用中大量静态资源的加速分发，如 css、js、图片、html 等\n- 大文件下载\n- 直播网站\n\n#### 5. CDN 的实现\n\n- BAT 等都有提供现成的 CDN 服务\n- 可用 LVS 做4层负载均衡\n- 可用 nginx、varnish、squid、Apache trafficserver 做7层负载均衡和cache\n- 使用 squid 反向代理、或者 nginx 反向代理，把源站点的内容缓存","source":"_posts/高并发大流量解决方案-4-使用-CDN-加速.md","raw":"---\ntitle: 高并发大流量解决方案 4 使用 CDN 加速\ndate: 2018-02-15 16:32:24\ntags: 高并发\n---\n\n## 使用CDN加速\n\n#### 1. 什么是 CDN\n\nCDN 的全称是 content delivery network，即内容分发网络。\n\n<!-- more -->\n\n尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定。\n\n在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络（相当于真实服务器的镜像）。\n\nCDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。\n\n#### 2. 使用 CDN 的优势\n\n- 本地 cache 加速，提高了企业站点（尤其是含有大量图片和静态页面站点）的访问速度。\n- 跨运营商的网络加速（北联通、南电信），保证不同网络的用户都得到良好的访问质量。\n- 远程访问用户根据 DNS 负载均衡技术智能自动选择 cache 服务器。\n- 自动生成服务器的远程 mirror（镜像）cache 服务器，远程用户访问时从 cache 服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点 web 服务器负载等功能。\n- 广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵。\n\n#### 3. CDN 的工作原理\n\n##### 1. 传统访问\n\n用户在浏览器输入域名发起请求 -> 解析域名获取服务器 ip 地址 -> 根据 ip 地址找到对应的服务器 -> 服务器响应并返回数据\n\n##### 2. 使用 CDN 访问\n\n用户发起请求（cname）  -> 智能 DNS 解析（根据ip判断地理位置、接入网类型，选择路由最短和负载最轻的服务器） -> 取得缓存服务器ip -> 把内容返回给用户（如果缓存中有） -> 向源站点发起请求 -> 将结果返回给用户 -> 将结果存入缓存服务器\n\n#### 4. CDN 的适用场景\n\n- 站点或应用中大量静态资源的加速分发，如 css、js、图片、html 等\n- 大文件下载\n- 直播网站\n\n#### 5. CDN 的实现\n\n- BAT 等都有提供现成的 CDN 服务\n- 可用 LVS 做4层负载均衡\n- 可用 nginx、varnish、squid、Apache trafficserver 做7层负载均衡和cache\n- 使用 squid 反向代理、或者 nginx 反向代理，把源站点的内容缓存","slug":"高并发大流量解决方案-4-使用-CDN-加速","published":1,"updated":"2020-09-11T01:04:35.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzb7006q6wo1a5tvgov8","content":"<h2 id=\"使用CDN加速\"><a href=\"#使用CDN加速\" class=\"headerlink\" title=\"使用CDN加速\"></a>使用CDN加速</h2><h4 id=\"1-什么是-CDN\"><a href=\"#1-什么是-CDN\" class=\"headerlink\" title=\"1. 什么是 CDN\"></a>1. 什么是 CDN</h4><p>CDN 的全称是 content delivery network，即内容分发网络。</p>\n<a id=\"more\"></a>\n\n<p>尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定。</p>\n<p>在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络（相当于真实服务器的镜像）。</p>\n<p>CDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。</p>\n<h4 id=\"2-使用-CDN-的优势\"><a href=\"#2-使用-CDN-的优势\" class=\"headerlink\" title=\"2. 使用 CDN 的优势\"></a>2. 使用 CDN 的优势</h4><ul>\n<li>本地 cache 加速，提高了企业站点（尤其是含有大量图片和静态页面站点）的访问速度。</li>\n<li>跨运营商的网络加速（北联通、南电信），保证不同网络的用户都得到良好的访问质量。</li>\n<li>远程访问用户根据 DNS 负载均衡技术智能自动选择 cache 服务器。</li>\n<li>自动生成服务器的远程 mirror（镜像）cache 服务器，远程用户访问时从 cache 服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点 web 服务器负载等功能。</li>\n<li>广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵。</li>\n</ul>\n<h4 id=\"3-CDN-的工作原理\"><a href=\"#3-CDN-的工作原理\" class=\"headerlink\" title=\"3. CDN 的工作原理\"></a>3. CDN 的工作原理</h4><h5 id=\"1-传统访问\"><a href=\"#1-传统访问\" class=\"headerlink\" title=\"1. 传统访问\"></a>1. 传统访问</h5><p>用户在浏览器输入域名发起请求 -&gt; 解析域名获取服务器 ip 地址 -&gt; 根据 ip 地址找到对应的服务器 -&gt; 服务器响应并返回数据</p>\n<h5 id=\"2-使用-CDN-访问\"><a href=\"#2-使用-CDN-访问\" class=\"headerlink\" title=\"2. 使用 CDN 访问\"></a>2. 使用 CDN 访问</h5><p>用户发起请求（cname）  -&gt; 智能 DNS 解析（根据ip判断地理位置、接入网类型，选择路由最短和负载最轻的服务器） -&gt; 取得缓存服务器ip -&gt; 把内容返回给用户（如果缓存中有） -&gt; 向源站点发起请求 -&gt; 将结果返回给用户 -&gt; 将结果存入缓存服务器</p>\n<h4 id=\"4-CDN-的适用场景\"><a href=\"#4-CDN-的适用场景\" class=\"headerlink\" title=\"4. CDN 的适用场景\"></a>4. CDN 的适用场景</h4><ul>\n<li>站点或应用中大量静态资源的加速分发，如 css、js、图片、html 等</li>\n<li>大文件下载</li>\n<li>直播网站</li>\n</ul>\n<h4 id=\"5-CDN-的实现\"><a href=\"#5-CDN-的实现\" class=\"headerlink\" title=\"5. CDN 的实现\"></a>5. CDN 的实现</h4><ul>\n<li>BAT 等都有提供现成的 CDN 服务</li>\n<li>可用 LVS 做4层负载均衡</li>\n<li>可用 nginx、varnish、squid、Apache trafficserver 做7层负载均衡和cache</li>\n<li>使用 squid 反向代理、或者 nginx 反向代理，把源站点的内容缓存</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"使用CDN加速\"><a href=\"#使用CDN加速\" class=\"headerlink\" title=\"使用CDN加速\"></a>使用CDN加速</h2><h4 id=\"1-什么是-CDN\"><a href=\"#1-什么是-CDN\" class=\"headerlink\" title=\"1. 什么是 CDN\"></a>1. 什么是 CDN</h4><p>CDN 的全称是 content delivery network，即内容分发网络。</p>","more":"<p>尽可能避开互联网上有可能影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快、更稳定。</p>\n<p>在网络各处放置节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络（相当于真实服务器的镜像）。</p>\n<p>CDN 系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。</p>\n<h4 id=\"2-使用-CDN-的优势\"><a href=\"#2-使用-CDN-的优势\" class=\"headerlink\" title=\"2. 使用 CDN 的优势\"></a>2. 使用 CDN 的优势</h4><ul>\n<li>本地 cache 加速，提高了企业站点（尤其是含有大量图片和静态页面站点）的访问速度。</li>\n<li>跨运营商的网络加速（北联通、南电信），保证不同网络的用户都得到良好的访问质量。</li>\n<li>远程访问用户根据 DNS 负载均衡技术智能自动选择 cache 服务器。</li>\n<li>自动生成服务器的远程 mirror（镜像）cache 服务器，远程用户访问时从 cache 服务器上读取数据，减少远程访问的带宽、分担网络流量、减轻原站点 web 服务器负载等功能。</li>\n<li>广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵。</li>\n</ul>\n<h4 id=\"3-CDN-的工作原理\"><a href=\"#3-CDN-的工作原理\" class=\"headerlink\" title=\"3. CDN 的工作原理\"></a>3. CDN 的工作原理</h4><h5 id=\"1-传统访问\"><a href=\"#1-传统访问\" class=\"headerlink\" title=\"1. 传统访问\"></a>1. 传统访问</h5><p>用户在浏览器输入域名发起请求 -&gt; 解析域名获取服务器 ip 地址 -&gt; 根据 ip 地址找到对应的服务器 -&gt; 服务器响应并返回数据</p>\n<h5 id=\"2-使用-CDN-访问\"><a href=\"#2-使用-CDN-访问\" class=\"headerlink\" title=\"2. 使用 CDN 访问\"></a>2. 使用 CDN 访问</h5><p>用户发起请求（cname）  -&gt; 智能 DNS 解析（根据ip判断地理位置、接入网类型，选择路由最短和负载最轻的服务器） -&gt; 取得缓存服务器ip -&gt; 把内容返回给用户（如果缓存中有） -&gt; 向源站点发起请求 -&gt; 将结果返回给用户 -&gt; 将结果存入缓存服务器</p>\n<h4 id=\"4-CDN-的适用场景\"><a href=\"#4-CDN-的适用场景\" class=\"headerlink\" title=\"4. CDN 的适用场景\"></a>4. CDN 的适用场景</h4><ul>\n<li>站点或应用中大量静态资源的加速分发，如 css、js、图片、html 等</li>\n<li>大文件下载</li>\n<li>直播网站</li>\n</ul>\n<h4 id=\"5-CDN-的实现\"><a href=\"#5-CDN-的实现\" class=\"headerlink\" title=\"5. CDN 的实现\"></a>5. CDN 的实现</h4><ul>\n<li>BAT 等都有提供现成的 CDN 服务</li>\n<li>可用 LVS 做4层负载均衡</li>\n<li>可用 nginx、varnish、squid、Apache trafficserver 做7层负载均衡和cache</li>\n<li>使用 squid 反向代理、或者 nginx 反向代理，把源站点的内容缓存</li>\n</ul>"},{"title":"高并发大流量解决方案 5 建立独立的图片服务器","date":"2018-02-15T08:33:02.000Z","_content":"\n## 独立图片服务器的部署\n\n#### 1. 独立的必要性\n\n- 分担web服务器的I/O负载：将耗费资源的图片服务分离出来，提高服务器的性能和稳定性。\n- 能够专门对图片服务器进行优化：为图片服务设置有针对性的缓存方案（如针对I/O较高的问题，增加硬盘转数），减少带宽成本（不需要太多计算，调低CPU性能），提高访问速度（可以做图片服务器集群）。\n- 提高网站的可扩展性：通过增加图片服务器，提高图片吞吐能力。\n\n<!-- more -->\n\n#### 2. 采用独立域名（不是二级域名）\n原因：\n- 同一域名下浏览器的并发连接数有限制（通常为2-6个），为突破浏览器连接数的限制，可采用独立域名。\n- 由于 cookie 的原因，对缓存不利，大部分 web cache 都只缓存不带 cookie 的请求，导致每次的图片请求都不能命中 cache\n\n#### 3. 独立后的问题\n\n##### 1. 如何进行图片上传和图片同步？\n- NFS 共享方式\n- FTP 同步\n- 七牛云等第三方服务","source":"_posts/高并发大流量解决方案-5-建立独立的图片服务器.md","raw":"---\ntitle: 高并发大流量解决方案 5 建立独立的图片服务器\ndate: 2018-02-15 16:33:02\ntags: 高并发\n---\n\n## 独立图片服务器的部署\n\n#### 1. 独立的必要性\n\n- 分担web服务器的I/O负载：将耗费资源的图片服务分离出来，提高服务器的性能和稳定性。\n- 能够专门对图片服务器进行优化：为图片服务设置有针对性的缓存方案（如针对I/O较高的问题，增加硬盘转数），减少带宽成本（不需要太多计算，调低CPU性能），提高访问速度（可以做图片服务器集群）。\n- 提高网站的可扩展性：通过增加图片服务器，提高图片吞吐能力。\n\n<!-- more -->\n\n#### 2. 采用独立域名（不是二级域名）\n原因：\n- 同一域名下浏览器的并发连接数有限制（通常为2-6个），为突破浏览器连接数的限制，可采用独立域名。\n- 由于 cookie 的原因，对缓存不利，大部分 web cache 都只缓存不带 cookie 的请求，导致每次的图片请求都不能命中 cache\n\n#### 3. 独立后的问题\n\n##### 1. 如何进行图片上传和图片同步？\n- NFS 共享方式\n- FTP 同步\n- 七牛云等第三方服务","slug":"高并发大流量解决方案-5-建立独立的图片服务器","published":1,"updated":"2020-09-11T01:04:35.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzb8006r6wo119w6cm9h","content":"<h2 id=\"独立图片服务器的部署\"><a href=\"#独立图片服务器的部署\" class=\"headerlink\" title=\"独立图片服务器的部署\"></a>独立图片服务器的部署</h2><h4 id=\"1-独立的必要性\"><a href=\"#1-独立的必要性\" class=\"headerlink\" title=\"1. 独立的必要性\"></a>1. 独立的必要性</h4><ul>\n<li>分担web服务器的I/O负载：将耗费资源的图片服务分离出来，提高服务器的性能和稳定性。</li>\n<li>能够专门对图片服务器进行优化：为图片服务设置有针对性的缓存方案（如针对I/O较高的问题，增加硬盘转数），减少带宽成本（不需要太多计算，调低CPU性能），提高访问速度（可以做图片服务器集群）。</li>\n<li>提高网站的可扩展性：通过增加图片服务器，提高图片吞吐能力。</li>\n</ul>\n<a id=\"more\"></a>\n\n<h4 id=\"2-采用独立域名（不是二级域名）\"><a href=\"#2-采用独立域名（不是二级域名）\" class=\"headerlink\" title=\"2. 采用独立域名（不是二级域名）\"></a>2. 采用独立域名（不是二级域名）</h4><p>原因：</p>\n<ul>\n<li>同一域名下浏览器的并发连接数有限制（通常为2-6个），为突破浏览器连接数的限制，可采用独立域名。</li>\n<li>由于 cookie 的原因，对缓存不利，大部分 web cache 都只缓存不带 cookie 的请求，导致每次的图片请求都不能命中 cache</li>\n</ul>\n<h4 id=\"3-独立后的问题\"><a href=\"#3-独立后的问题\" class=\"headerlink\" title=\"3. 独立后的问题\"></a>3. 独立后的问题</h4><h5 id=\"1-如何进行图片上传和图片同步？\"><a href=\"#1-如何进行图片上传和图片同步？\" class=\"headerlink\" title=\"1. 如何进行图片上传和图片同步？\"></a>1. 如何进行图片上传和图片同步？</h5><ul>\n<li>NFS 共享方式</li>\n<li>FTP 同步</li>\n<li>七牛云等第三方服务</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h2 id=\"独立图片服务器的部署\"><a href=\"#独立图片服务器的部署\" class=\"headerlink\" title=\"独立图片服务器的部署\"></a>独立图片服务器的部署</h2><h4 id=\"1-独立的必要性\"><a href=\"#1-独立的必要性\" class=\"headerlink\" title=\"1. 独立的必要性\"></a>1. 独立的必要性</h4><ul>\n<li>分担web服务器的I/O负载：将耗费资源的图片服务分离出来，提高服务器的性能和稳定性。</li>\n<li>能够专门对图片服务器进行优化：为图片服务设置有针对性的缓存方案（如针对I/O较高的问题，增加硬盘转数），减少带宽成本（不需要太多计算，调低CPU性能），提高访问速度（可以做图片服务器集群）。</li>\n<li>提高网站的可扩展性：通过增加图片服务器，提高图片吞吐能力。</li>\n</ul>","more":"<h4 id=\"2-采用独立域名（不是二级域名）\"><a href=\"#2-采用独立域名（不是二级域名）\" class=\"headerlink\" title=\"2. 采用独立域名（不是二级域名）\"></a>2. 采用独立域名（不是二级域名）</h4><p>原因：</p>\n<ul>\n<li>同一域名下浏览器的并发连接数有限制（通常为2-6个），为突破浏览器连接数的限制，可采用独立域名。</li>\n<li>由于 cookie 的原因，对缓存不利，大部分 web cache 都只缓存不带 cookie 的请求，导致每次的图片请求都不能命中 cache</li>\n</ul>\n<h4 id=\"3-独立后的问题\"><a href=\"#3-独立后的问题\" class=\"headerlink\" title=\"3. 独立后的问题\"></a>3. 独立后的问题</h4><h5 id=\"1-如何进行图片上传和图片同步？\"><a href=\"#1-如何进行图片上传和图片同步？\" class=\"headerlink\" title=\"1. 如何进行图片上传和图片同步？\"></a>1. 如何进行图片上传和图片同步？</h5><ul>\n<li>NFS 共享方式</li>\n<li>FTP 同步</li>\n<li>七牛云等第三方服务</li>\n</ul>"},{"title":"高并发大流量解决方案 6 动态语言静态化","date":"2018-02-15T08:33:37.000Z","_content":"\n## 动态语言静态化\n\n#### 1. 什么是动态语言静态化\n将现有 PHP 等动态语言的逻辑代码生成为静态 HTML 文件，用户访问动态脚本时重定向到静态 HTML 文件的过程，这样会大大减轻 CPU 负载和数据库的压力。\n\n<!-- more -->\n\nweb 工作原理回顾：用户通过浏览器的域名请求PHP文件，DNS 服务器解析域名得到 ip 地址，将 ip 返回给客户端，客户端通过 ip 找到真实的服务器并进行访问，然后找服务器 80 端口的 web 服务，nginx 判断用户请求的是否为 PHP 文件，如果是 PHP，nginx 反向代理给 fpm，因为只有 PHP 解析器（如 fpm）才能解析 PHP，fpm 将 PHP 代码进行解析，解析成 HTML，最后返回给用户浏览器。\n\n对实时性要求不高的页面适合使用动态语言静态化。\n\n#### 2. 为什么需要动态语言静态化\n\n- 动态脚本通过会做逻辑计算和数据查询，访问量越大，服务器压力越大；\n- 访问量大时可能造成 CPU 负载过高、数据库服务器压力过大；\n- 静态化能够降低逻辑处理压力，降低数据库服务器查询压力。\n\n\n#### 3. 静态化的实现方式\n\n##### 1. 使用模板引擎，可以使用 smarty 的缓存机制生成静态 HTML 缓存文件\n\n``` php\n$smarty->cache_dir = $ROOT . '/cache'; // 缓存目录\n$smarty->caching = true; // 是否开启缓存\n$smarty->cache_lifetime = \"3600\";  // 缓存时间\n$smarty->display(string template [, string cache_id [, string compile_id]]);\n\n$smarty->clear_all_cache(); // 清除所有缓存\n$smarty->clear_cache('flie.html'); // 清除指定的缓存\n$smarty->clear_cache('article.html', $art_id); // 清除同一模板下的指定缓存号的缓存\n```\n\n##### 2. 利用 ob 系统函数\n\n``` php\nob_start(): 打开输出控制缓冲\nob_get_contents(): 返回输出缓冲区内容\nob_clean(): 清空输出缓冲区\nob_end_flush()\t: 冲刷出（送出）输出缓冲区内容并关闭缓冲\n```\n伪代码\n``` php\nob_start(); // 在 HTML 代码之前开启缓冲区\n输出到页面的 HTML 代码 ...\n...\nob_get_contents(); // 获取中间整个的 HTML 代码\nob_end_flush()\t; // 把获取到的 HTML 代码输出，并关闭缓冲区\nfopen(); // 将 HTML 代码写入到指定的 HTML 文件，下次再来访问时首先判断这个 HTML 文件是否过期，如果存在且未过期，直接返回该文件即可。\n```\n可以判断文件的 inode 修改时间，判断是否过期。\n\n使用 `filectime` 函数\n\n示例\n``` php\n<?php\n$cache_name = md5(__FILE__) . '.html';\n$cache_lifetime = 3600;\nif (filectime(__FILE__) <= filectime($cache_name) && file_exists($cache_name) && filectime($cache_name) + $cache_lifetime > time()) {\n\tinclude $cache_name;\n\texit;\n}\n\nob_start();\n?>\n\n<html>这里是 HTML 文件内容，会包含 PHP 计算以及数据库查询等操作</html>\n\n<?php\n$content = ob_get_contents();\nob_end_flush();\n\n$handle = fopen($cache_name, 'w');\nfwrite($handle, $content);\nfclose($handle);\n?>\n```\n","source":"_posts/高并发大流量解决方案-6-动态语言静态化.md","raw":"---\ntitle: 高并发大流量解决方案 6 动态语言静态化\ndate: 2018-02-15 16:33:37\ntags: 高并发\n---\n\n## 动态语言静态化\n\n#### 1. 什么是动态语言静态化\n将现有 PHP 等动态语言的逻辑代码生成为静态 HTML 文件，用户访问动态脚本时重定向到静态 HTML 文件的过程，这样会大大减轻 CPU 负载和数据库的压力。\n\n<!-- more -->\n\nweb 工作原理回顾：用户通过浏览器的域名请求PHP文件，DNS 服务器解析域名得到 ip 地址，将 ip 返回给客户端，客户端通过 ip 找到真实的服务器并进行访问，然后找服务器 80 端口的 web 服务，nginx 判断用户请求的是否为 PHP 文件，如果是 PHP，nginx 反向代理给 fpm，因为只有 PHP 解析器（如 fpm）才能解析 PHP，fpm 将 PHP 代码进行解析，解析成 HTML，最后返回给用户浏览器。\n\n对实时性要求不高的页面适合使用动态语言静态化。\n\n#### 2. 为什么需要动态语言静态化\n\n- 动态脚本通过会做逻辑计算和数据查询，访问量越大，服务器压力越大；\n- 访问量大时可能造成 CPU 负载过高、数据库服务器压力过大；\n- 静态化能够降低逻辑处理压力，降低数据库服务器查询压力。\n\n\n#### 3. 静态化的实现方式\n\n##### 1. 使用模板引擎，可以使用 smarty 的缓存机制生成静态 HTML 缓存文件\n\n``` php\n$smarty->cache_dir = $ROOT . '/cache'; // 缓存目录\n$smarty->caching = true; // 是否开启缓存\n$smarty->cache_lifetime = \"3600\";  // 缓存时间\n$smarty->display(string template [, string cache_id [, string compile_id]]);\n\n$smarty->clear_all_cache(); // 清除所有缓存\n$smarty->clear_cache('flie.html'); // 清除指定的缓存\n$smarty->clear_cache('article.html', $art_id); // 清除同一模板下的指定缓存号的缓存\n```\n\n##### 2. 利用 ob 系统函数\n\n``` php\nob_start(): 打开输出控制缓冲\nob_get_contents(): 返回输出缓冲区内容\nob_clean(): 清空输出缓冲区\nob_end_flush()\t: 冲刷出（送出）输出缓冲区内容并关闭缓冲\n```\n伪代码\n``` php\nob_start(); // 在 HTML 代码之前开启缓冲区\n输出到页面的 HTML 代码 ...\n...\nob_get_contents(); // 获取中间整个的 HTML 代码\nob_end_flush()\t; // 把获取到的 HTML 代码输出，并关闭缓冲区\nfopen(); // 将 HTML 代码写入到指定的 HTML 文件，下次再来访问时首先判断这个 HTML 文件是否过期，如果存在且未过期，直接返回该文件即可。\n```\n可以判断文件的 inode 修改时间，判断是否过期。\n\n使用 `filectime` 函数\n\n示例\n``` php\n<?php\n$cache_name = md5(__FILE__) . '.html';\n$cache_lifetime = 3600;\nif (filectime(__FILE__) <= filectime($cache_name) && file_exists($cache_name) && filectime($cache_name) + $cache_lifetime > time()) {\n\tinclude $cache_name;\n\texit;\n}\n\nob_start();\n?>\n\n<html>这里是 HTML 文件内容，会包含 PHP 计算以及数据库查询等操作</html>\n\n<?php\n$content = ob_get_contents();\nob_end_flush();\n\n$handle = fopen($cache_name, 'w');\nfwrite($handle, $content);\nfclose($handle);\n?>\n```\n","slug":"高并发大流量解决方案-6-动态语言静态化","published":1,"updated":"2020-09-11T01:04:35.061Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzb9006t6wo16tkadfun","content":"<h2 id=\"动态语言静态化\"><a href=\"#动态语言静态化\" class=\"headerlink\" title=\"动态语言静态化\"></a>动态语言静态化</h2><h4 id=\"1-什么是动态语言静态化\"><a href=\"#1-什么是动态语言静态化\" class=\"headerlink\" title=\"1. 什么是动态语言静态化\"></a>1. 什么是动态语言静态化</h4><p>将现有 PHP 等动态语言的逻辑代码生成为静态 HTML 文件，用户访问动态脚本时重定向到静态 HTML 文件的过程，这样会大大减轻 CPU 负载和数据库的压力。</p>\n<a id=\"more\"></a>\n\n<p>web 工作原理回顾：用户通过浏览器的域名请求PHP文件，DNS 服务器解析域名得到 ip 地址，将 ip 返回给客户端，客户端通过 ip 找到真实的服务器并进行访问，然后找服务器 80 端口的 web 服务，nginx 判断用户请求的是否为 PHP 文件，如果是 PHP，nginx 反向代理给 fpm，因为只有 PHP 解析器（如 fpm）才能解析 PHP，fpm 将 PHP 代码进行解析，解析成 HTML，最后返回给用户浏览器。</p>\n<p>对实时性要求不高的页面适合使用动态语言静态化。</p>\n<h4 id=\"2-为什么需要动态语言静态化\"><a href=\"#2-为什么需要动态语言静态化\" class=\"headerlink\" title=\"2. 为什么需要动态语言静态化\"></a>2. 为什么需要动态语言静态化</h4><ul>\n<li>动态脚本通过会做逻辑计算和数据查询，访问量越大，服务器压力越大；</li>\n<li>访问量大时可能造成 CPU 负载过高、数据库服务器压力过大；</li>\n<li>静态化能够降低逻辑处理压力，降低数据库服务器查询压力。</li>\n</ul>\n<h4 id=\"3-静态化的实现方式\"><a href=\"#3-静态化的实现方式\" class=\"headerlink\" title=\"3. 静态化的实现方式\"></a>3. 静态化的实现方式</h4><h5 id=\"1-使用模板引擎，可以使用-smarty-的缓存机制生成静态-HTML-缓存文件\"><a href=\"#1-使用模板引擎，可以使用-smarty-的缓存机制生成静态-HTML-缓存文件\" class=\"headerlink\" title=\"1. 使用模板引擎，可以使用 smarty 的缓存机制生成静态 HTML 缓存文件\"></a>1. 使用模板引擎，可以使用 smarty 的缓存机制生成静态 HTML 缓存文件</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$smarty-&gt;cache_dir = $ROOT . <span class=\"string\">&#x27;/cache&#x27;</span>; <span class=\"comment\">// 缓存目录</span></span><br><span class=\"line\">$smarty-&gt;caching = <span class=\"literal\">true</span>; <span class=\"comment\">// 是否开启缓存</span></span><br><span class=\"line\">$smarty-&gt;cache_lifetime = <span class=\"string\">&quot;3600&quot;</span>;  <span class=\"comment\">// 缓存时间</span></span><br><span class=\"line\">$smarty-&gt;display(<span class=\"keyword\">string</span> template [, <span class=\"keyword\">string</span> cache_id [, <span class=\"keyword\">string</span> compile_id]]);</span><br><span class=\"line\"></span><br><span class=\"line\">$smarty-&gt;clear_all_cache(); <span class=\"comment\">// 清除所有缓存</span></span><br><span class=\"line\">$smarty-&gt;clear_cache(<span class=\"string\">&#x27;flie.html&#x27;</span>); <span class=\"comment\">// 清除指定的缓存</span></span><br><span class=\"line\">$smarty-&gt;clear_cache(<span class=\"string\">&#x27;article.html&#x27;</span>, $art_id); <span class=\"comment\">// 清除同一模板下的指定缓存号的缓存</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-利用-ob-系统函数\"><a href=\"#2-利用-ob-系统函数\" class=\"headerlink\" title=\"2. 利用 ob 系统函数\"></a>2. 利用 ob 系统函数</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ob_start(): 打开输出控制缓冲</span><br><span class=\"line\">ob_get_contents(): 返回输出缓冲区内容</span><br><span class=\"line\">ob_clean(): 清空输出缓冲区</span><br><span class=\"line\">ob_end_flush()\t: 冲刷出（送出）输出缓冲区内容并关闭缓冲</span><br></pre></td></tr></table></figure>\n<p>伪代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ob_start(); <span class=\"comment\">// 在 HTML 代码之前开启缓冲区</span></span><br><span class=\"line\">输出到页面的 HTML 代码 ...</span><br><span class=\"line\">...</span><br><span class=\"line\">ob_get_contents(); <span class=\"comment\">// 获取中间整个的 HTML 代码</span></span><br><span class=\"line\">ob_end_flush()\t; <span class=\"comment\">// 把获取到的 HTML 代码输出，并关闭缓冲区</span></span><br><span class=\"line\">fopen(); <span class=\"comment\">// 将 HTML 代码写入到指定的 HTML 文件，下次再来访问时首先判断这个 HTML 文件是否过期，如果存在且未过期，直接返回该文件即可。</span></span><br></pre></td></tr></table></figure>\n<p>可以判断文件的 inode 修改时间，判断是否过期。</p>\n<p>使用 <code>filectime</code> 函数</p>\n<p>示例</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$cache_name = md5(<span class=\"keyword\">__FILE__</span>) . <span class=\"string\">&#x27;.html&#x27;</span>;</span><br><span class=\"line\">$cache_lifetime = <span class=\"number\">3600</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (filectime(<span class=\"keyword\">__FILE__</span>) &lt;= filectime($cache_name) &amp;&amp; file_exists($cache_name) &amp;&amp; filectime($cache_name) + $cache_lifetime &gt; time()) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">include</span> $cache_name;</span><br><span class=\"line\">\t<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ob_start();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;html&gt;这里是 HTML 文件内容，会包含 PHP 计算以及数据库查询等操作&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$content = ob_get_contents();</span><br><span class=\"line\">ob_end_flush();</span><br><span class=\"line\"></span><br><span class=\"line\">$handle = fopen($cache_name, <span class=\"string\">&#x27;w&#x27;</span>);</span><br><span class=\"line\">fwrite($handle, $content);</span><br><span class=\"line\">fclose($handle);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"动态语言静态化\"><a href=\"#动态语言静态化\" class=\"headerlink\" title=\"动态语言静态化\"></a>动态语言静态化</h2><h4 id=\"1-什么是动态语言静态化\"><a href=\"#1-什么是动态语言静态化\" class=\"headerlink\" title=\"1. 什么是动态语言静态化\"></a>1. 什么是动态语言静态化</h4><p>将现有 PHP 等动态语言的逻辑代码生成为静态 HTML 文件，用户访问动态脚本时重定向到静态 HTML 文件的过程，这样会大大减轻 CPU 负载和数据库的压力。</p>","more":"<p>web 工作原理回顾：用户通过浏览器的域名请求PHP文件，DNS 服务器解析域名得到 ip 地址，将 ip 返回给客户端，客户端通过 ip 找到真实的服务器并进行访问，然后找服务器 80 端口的 web 服务，nginx 判断用户请求的是否为 PHP 文件，如果是 PHP，nginx 反向代理给 fpm，因为只有 PHP 解析器（如 fpm）才能解析 PHP，fpm 将 PHP 代码进行解析，解析成 HTML，最后返回给用户浏览器。</p>\n<p>对实时性要求不高的页面适合使用动态语言静态化。</p>\n<h4 id=\"2-为什么需要动态语言静态化\"><a href=\"#2-为什么需要动态语言静态化\" class=\"headerlink\" title=\"2. 为什么需要动态语言静态化\"></a>2. 为什么需要动态语言静态化</h4><ul>\n<li>动态脚本通过会做逻辑计算和数据查询，访问量越大，服务器压力越大；</li>\n<li>访问量大时可能造成 CPU 负载过高、数据库服务器压力过大；</li>\n<li>静态化能够降低逻辑处理压力，降低数据库服务器查询压力。</li>\n</ul>\n<h4 id=\"3-静态化的实现方式\"><a href=\"#3-静态化的实现方式\" class=\"headerlink\" title=\"3. 静态化的实现方式\"></a>3. 静态化的实现方式</h4><h5 id=\"1-使用模板引擎，可以使用-smarty-的缓存机制生成静态-HTML-缓存文件\"><a href=\"#1-使用模板引擎，可以使用-smarty-的缓存机制生成静态-HTML-缓存文件\" class=\"headerlink\" title=\"1. 使用模板引擎，可以使用 smarty 的缓存机制生成静态 HTML 缓存文件\"></a>1. 使用模板引擎，可以使用 smarty 的缓存机制生成静态 HTML 缓存文件</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$smarty-&gt;cache_dir = $ROOT . <span class=\"string\">&#x27;/cache&#x27;</span>; <span class=\"comment\">// 缓存目录</span></span><br><span class=\"line\">$smarty-&gt;caching = <span class=\"literal\">true</span>; <span class=\"comment\">// 是否开启缓存</span></span><br><span class=\"line\">$smarty-&gt;cache_lifetime = <span class=\"string\">&quot;3600&quot;</span>;  <span class=\"comment\">// 缓存时间</span></span><br><span class=\"line\">$smarty-&gt;display(<span class=\"keyword\">string</span> template [, <span class=\"keyword\">string</span> cache_id [, <span class=\"keyword\">string</span> compile_id]]);</span><br><span class=\"line\"></span><br><span class=\"line\">$smarty-&gt;clear_all_cache(); <span class=\"comment\">// 清除所有缓存</span></span><br><span class=\"line\">$smarty-&gt;clear_cache(<span class=\"string\">&#x27;flie.html&#x27;</span>); <span class=\"comment\">// 清除指定的缓存</span></span><br><span class=\"line\">$smarty-&gt;clear_cache(<span class=\"string\">&#x27;article.html&#x27;</span>, $art_id); <span class=\"comment\">// 清除同一模板下的指定缓存号的缓存</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"2-利用-ob-系统函数\"><a href=\"#2-利用-ob-系统函数\" class=\"headerlink\" title=\"2. 利用 ob 系统函数\"></a>2. 利用 ob 系统函数</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ob_start(): 打开输出控制缓冲</span><br><span class=\"line\">ob_get_contents(): 返回输出缓冲区内容</span><br><span class=\"line\">ob_clean(): 清空输出缓冲区</span><br><span class=\"line\">ob_end_flush()\t: 冲刷出（送出）输出缓冲区内容并关闭缓冲</span><br></pre></td></tr></table></figure>\n<p>伪代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ob_start(); <span class=\"comment\">// 在 HTML 代码之前开启缓冲区</span></span><br><span class=\"line\">输出到页面的 HTML 代码 ...</span><br><span class=\"line\">...</span><br><span class=\"line\">ob_get_contents(); <span class=\"comment\">// 获取中间整个的 HTML 代码</span></span><br><span class=\"line\">ob_end_flush()\t; <span class=\"comment\">// 把获取到的 HTML 代码输出，并关闭缓冲区</span></span><br><span class=\"line\">fopen(); <span class=\"comment\">// 将 HTML 代码写入到指定的 HTML 文件，下次再来访问时首先判断这个 HTML 文件是否过期，如果存在且未过期，直接返回该文件即可。</span></span><br></pre></td></tr></table></figure>\n<p>可以判断文件的 inode 修改时间，判断是否过期。</p>\n<p>使用 <code>filectime</code> 函数</p>\n<p>示例</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$cache_name = md5(<span class=\"keyword\">__FILE__</span>) . <span class=\"string\">&#x27;.html&#x27;</span>;</span><br><span class=\"line\">$cache_lifetime = <span class=\"number\">3600</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span> (filectime(<span class=\"keyword\">__FILE__</span>) &lt;= filectime($cache_name) &amp;&amp; file_exists($cache_name) &amp;&amp; filectime($cache_name) + $cache_lifetime &gt; time()) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">include</span> $cache_name;</span><br><span class=\"line\">\t<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ob_start();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;html&gt;这里是 HTML 文件内容，会包含 PHP 计算以及数据库查询等操作&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">$content = ob_get_contents();</span><br><span class=\"line\">ob_end_flush();</span><br><span class=\"line\"></span><br><span class=\"line\">$handle = fopen($cache_name, <span class=\"string\">&#x27;w&#x27;</span>);</span><br><span class=\"line\">fwrite($handle, $content);</span><br><span class=\"line\">fclose($handle);</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>"},{"title":"高并发大流量解决方案 7  动态语言的并发处理","date":"2018-02-15T08:34:03.000Z","_content":"\n### 动态语言的并发处理\n\n#### 1. 进程、线程、协程\n\n##### 1. 进程\n\n进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。\n\n进程是一个 “<b style=\"color:red\">执行中的程序</b>”\n\n<!-- more -->\n\n> 进程的三态模型：多道程序系统中，进程在处理器上交替运行，状态不断地发生变化\n\n三个状态：运行、就绪、阻塞\n\n- 运行：当一个进程在处理机上运行时，则称该进程处于运行状态。处于此状态的进程的数目小于等于处理器的数目（处理器一个核心同时只能处理一个进程），对于单处理机系统，处于运行状态的进程只有一个。在没有其他进程可以执行时（如所有进程都在阻塞状态），通常会自动执行系统的空闲进程。\n\n- 就绪：当一个进程获得了除处理机以外的一切所需资源，一旦得到处理机即可运行，则称此进程处于就绪状态。就绪进程可以按多个优先级来划分队列。例如，当一个进程由于时间片用完而进入就绪状态时，排入低优先级队列；当进程由 I/O 操作完成而进入就绪状态时，排入高优先级队列。\n\n- 阻塞：也称为等待或睡眠状态，一个进程正在等待某一事件发生（例如请求 I/O 而等待 I/O 完成等）而暂时停止运行，这时即使把处理机分配给进程也无法运行，故城该进程处于阻塞状态。如手机的app后台进入后台。\n\n> 进程的五态模型：对于一个实际的系统，进程的状态及其转换更为复杂\n\n新建态、活跃就绪/静止就绪、运行、活跃阻塞/静止阻塞、终止态\n\n- 新建态：对应于进程刚刚被创建时没有被提交的状态，并等待系统完成创建进程的所有必要信息。比赛开始状态。\n\n- 静止阻塞：进程兑换到辅存时的阻塞状态，一旦等待的事件产生便进入静止就绪状态。等待进入比赛大名单的状态。\n\n- 静止就绪（挂起就绪）：是指进程被兑换到辅存时的就绪状态，是不能被直接调度的状态，只有当主存中没有活跃就绪态进程，或者挂起就绪态进程具有更高的优先级，系统将把挂起就绪态进程调回主存并转换为活跃就绪。替补球员看饮水机状态。\n\n- 活跃阻塞：是指进程已在主存，一旦等待的事件产生便进入活跃就绪状态。\n\n- 活跃就绪：是指进程在主存并且可被调度的状态。替补球员热身状态。\n\n- 终止态：进程已结束运行，回收除进程控制块之外的其他资源，并让其他进程从进程控制块中收集有关信息。比赛结束或被替补下的状态。\n\n由于用户的并发请求，为每一个请求都创建一个进程显显然是行不通的，从系统资源开销方面或是响应用户请求的效率方面来看。因此操作系统中线程的概念便被引进了。\n\n\n##### 2. 线程\n\n线程，有时被称为轻量级进程（Lightweight Process, LWP），是程序执行流的最小单元。\n\n线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源。但它与同属于一个进程的其它线程共享进程所拥有的全部资源。\n\n一个线程可以创建和撤销另一个线程，同一个进程中的多个线程之间可以并发执行。\n\n线程是程序中一个单一的顺序控制流程，是进程内一个相对独立的、可调度的执行单元，是系统独立调度和分派 CPU 的基本单位，指运行中的程序的调度单位。\n\n在单个程序中同时运行多个线程完成不同的工作，成为多线程。\n\n每个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。\n\n线程的状态：就绪、阻塞、运行\n\n就绪：线程具备运行的所有条件，逻辑上可以运行，在等待处理机。\n\n运行：线程占有处理机正在运行。\n\n阻塞：线程在等待一个事件，逻辑上不可执行。\n\n##### 3. 协程\n\n协程：是一种<b style=\"color:red;\">用户态的轻量级线程，协程的调度完全由用户控制</b>，而线程的调度由操作系统来控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存在其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。\n\n##### 4. 线程与进程的区别\n\n1. 线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间\n2. 进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源\n3. 线程是处理器调度的基本单位，但进程不是\n4. 二者都可并发执行\n5. 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制\n\n\n##### 5. 线程与协程的区别\n\n1. 一个线程可以有多个协程，一个进程也可以单独拥有多个协程\n2. 线程、进程都是同步机制，而协程则是异步\n3. 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态，即状态不会丢失\n\n\n##### 6. 多进程、多线程\n\n多进程：同一时间里、同一计算机系统中如果允许两个或两个以上的进程处于运行状态，这就是多进程\n\n多开一个进程，多分配一份资源，进程间相互独立，通讯不方便\n\n多线程：线程就是吧一个进程分为很多片，每一片都可以是一个独立的流程\n\n与多进程的区别是只会使用一个进程的资源，线程间可以直接通信\n\n##### 7. 举例\n\n单进程单线程：一个人在一个桌子上吃饭\n\n单进程多线程：多个人在同一个桌子上一起吃饭\n\n多进程单线程：多个人每个人在自己的桌子上吃饭\n\n#### 2. 同步阻塞模型\n\n多进程：最早的服务器端程序都是通过多进程、多线程来解决并发 I/O 的问题。一个请求创建一个进程，然后子进程进入循环同步阻塞地与客户端连接进行交互，收发处理数据。\n\n多线程：用多线程模式实现非常简单，线程中可以直接向某一个客户端连接发送数据\n\n##### 1. 步骤\n1. 创建一个 socket\n2. 进入 while 循环，阻塞在进程 accept 操作上，等待客户端连接进入\n3. 主进程在多进程模型下通过 fork 创建子进程\n4. 多线程模型下可以创建子线程\n5. 子进程/线程创建成功后进入 while 循环，阻塞在 recv 调用上，等待客户端向服务器发送数据\n6. 收到数据后服务器程序进行处理然后使用 send 向客户端发送响应\n7. 当客户端连接关闭时，子进程/线程退出并销毁所有资源。主进程/线程会回收掉此子进程/线程。\n\n##### 2. 缺点\n1. 这种模型严重依赖进程的数量解决并发问题\n2. 启动大量进程会带来额外的进程调度消耗\n\n##### 3. 示例\n\n``` php\n<?php\n// 创建 socket 监听\n$socketServer = stream_socket_server('tcp://0.0.0.0:8000', $errno, $errstr);\n// 创建 5 个进程\nfor ($i = 0; $i < 5: ++$i) {\n\t// 如果返回的 pid = 0，表示阻塞\n\tif (pcntl_fork() == 0) {\n\t\t// 持续监听\n\t\twhile (true) {\n\t\t\t$conn = stream_socket_accept($socketServer);\n\t\t\t// 如果连接失败，重新创建监听\n\t\t\tif ($conn == false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// 读取流信息，并响应\n\t\t\t$request = fread($conn, 9000);\n\t\t\t$response = 'ok';\n\t\t\tfwrite($conn, $response);\n\t\t\tfclose($conn);\n\t\t}\n\t\texit(0);\n\t}\n}\n```\n\n#### 3. 异步非阻塞模型\n\n现在各种高并发异步 I/O 的服务器（nginx、golang、nodejs 等）都是基于 <b style=\"color:red\">epoll （维持无限数量的链接且无需轮询，真正解决了并发的问题）</b>实现的\n\nI/O 复用异步非阻塞程序使用经典的 Reactor 模型，Reactor 顾名思义就是反应堆的意思，它本身不处理任何数据收发，只是可以监视一个 socket 句柄的事件变化，即 EventListener\n\n##### 1. Reactor 模型\n\n四个核心操作\n\n- Add: 添加一个 socket 到 Reactor\n- Set: 修改 socket 对应的事件监听，可以设置监听的类型，如可读可写\n- Del: 从 Reactor 中移除，不再监听事件\n- Callback: 事件发生后回调指定的函数，类似 js 的事件触发，一般在 add/set 时指定\n\n实践：\n- nginx: 多线程 Reactor\n- swoole: 多线程 Reactor + 多进程 worker\n\n#### 4. PHP 并发编程实践\n\nPHP 并发编程主要有以下三种方式\n\n##### 1. PHP 的 Swoole 扩展\n\nPHP 的异步、并行、高性能网络通信引擎，使用纯 C 语言编写，提供了 PHP 语言的异步多线程服务器，异步 TCP/UDP 网络客户端，异步 MySQL，异步 Redis，数据库连接池，AsyncTask，消息队列，毫秒定时器，异步文件读写，异步 DNS 查询。\n\n除了异步 I/O 的支持之外，Swoole 为 PHP 多进程的模式设计了多个并发数据结构和 IPC 通信机制，可以大大简化多进程并发编程的工作。不需要做 Reactor，不需要同步阻塞，直接使用 Swoole 就可以实现。\n\nSwoole 2.0 支持了类似 Go 语言的协程，可以使用完全同步的代码实现异步程序。\n\n示例：Swoole 的异步 MySQL 实现\n\n``` php\n$db = new Swoole\\MySQL;\n$server = array('host' => '', 'user' => '', 'password' => '', 'database' => '');\n$db->connect($server, function($db, $result) {\n\t$db->query('show tables', function(Swoole\\MySQL $db, $result) {\n\t\t// do something\n\t});\n});\n```\n\n基于事件监听的异步操作，不需要等待\n\n\n##### 2. 消息队列\n\n- 场景：用户注册后，需要发注册邮件和注册短信\n  - 串行方式：将注册信息写入数据库成功后，发送注册邮件，再发送注册短信\n  - 并行方式：将注册信息写入数据库成功后，发送注册邮件，同时发送注册短信\n  - 消息队列方式：将注册信息写入数据库成功后，将成功信息写入队列，此时直接返回成功给用户，写入队列的时间非常短，可以忽略不计，然后异步发送邮件和短信（离线发送）\n\n> 应用解耦\n\n- 场景：用户下单后，订单系统需要通知库存系统\n  - 假如库存系统无法访问，则订单减库存将失败，从而导致订单失败。因为订单系统与库存系统耦合。\n  - 引用队列：用户下单后，订单系统完成持久化处理，将消息写入消息队列，返回用户订单下单成功，暂时不去管库存的问题。\n  - 库存系统订阅下单的消息，采用拉/推的方式，获取下单信息，库存系统根据下单信息，进行库存操作。\n\n> 流量削锋\n\n应用场景：秒杀活动，流量瞬间激增，服务器压力大。\n\n用户发起请求，服务器接收后，先写入消息队列。加入消息队列长度超过最大值，则直接报错或提示用户。\n\n后续程序读取消息队列再做处理\n\n作用：控制请求量、缓解高流量\n\n\n> 日志处理\n\n应用场景：解决大量日志的传输\n\n日志采集程序将程序写入消息队列，然后通过日志处理程序订阅日志，离线将日志写入文件，速度将大大提升。\n\n> 消息通讯\n\n应用场景：聊天室\n\n多个客户端订阅同一主题，进行消息发布和接收\n\n\n常见消息队列产品\n\nKafka、ActiveMQ、ZeroMQ、RabbitMQ、Redis 等\n\n##### 3. 接口的并发请求\n\ncurl_multi 系列函数\n\n","source":"_posts/高并发大流量解决方案-7-动态语言的并发处理.md","raw":"---\ntitle: 高并发大流量解决方案 7  动态语言的并发处理\ndate: 2018-02-15 16:34:03\ntags: 高并发\n---\n\n### 动态语言的并发处理\n\n#### 1. 进程、线程、协程\n\n##### 1. 进程\n\n进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。\n\n进程是一个 “<b style=\"color:red\">执行中的程序</b>”\n\n<!-- more -->\n\n> 进程的三态模型：多道程序系统中，进程在处理器上交替运行，状态不断地发生变化\n\n三个状态：运行、就绪、阻塞\n\n- 运行：当一个进程在处理机上运行时，则称该进程处于运行状态。处于此状态的进程的数目小于等于处理器的数目（处理器一个核心同时只能处理一个进程），对于单处理机系统，处于运行状态的进程只有一个。在没有其他进程可以执行时（如所有进程都在阻塞状态），通常会自动执行系统的空闲进程。\n\n- 就绪：当一个进程获得了除处理机以外的一切所需资源，一旦得到处理机即可运行，则称此进程处于就绪状态。就绪进程可以按多个优先级来划分队列。例如，当一个进程由于时间片用完而进入就绪状态时，排入低优先级队列；当进程由 I/O 操作完成而进入就绪状态时，排入高优先级队列。\n\n- 阻塞：也称为等待或睡眠状态，一个进程正在等待某一事件发生（例如请求 I/O 而等待 I/O 完成等）而暂时停止运行，这时即使把处理机分配给进程也无法运行，故城该进程处于阻塞状态。如手机的app后台进入后台。\n\n> 进程的五态模型：对于一个实际的系统，进程的状态及其转换更为复杂\n\n新建态、活跃就绪/静止就绪、运行、活跃阻塞/静止阻塞、终止态\n\n- 新建态：对应于进程刚刚被创建时没有被提交的状态，并等待系统完成创建进程的所有必要信息。比赛开始状态。\n\n- 静止阻塞：进程兑换到辅存时的阻塞状态，一旦等待的事件产生便进入静止就绪状态。等待进入比赛大名单的状态。\n\n- 静止就绪（挂起就绪）：是指进程被兑换到辅存时的就绪状态，是不能被直接调度的状态，只有当主存中没有活跃就绪态进程，或者挂起就绪态进程具有更高的优先级，系统将把挂起就绪态进程调回主存并转换为活跃就绪。替补球员看饮水机状态。\n\n- 活跃阻塞：是指进程已在主存，一旦等待的事件产生便进入活跃就绪状态。\n\n- 活跃就绪：是指进程在主存并且可被调度的状态。替补球员热身状态。\n\n- 终止态：进程已结束运行，回收除进程控制块之外的其他资源，并让其他进程从进程控制块中收集有关信息。比赛结束或被替补下的状态。\n\n由于用户的并发请求，为每一个请求都创建一个进程显显然是行不通的，从系统资源开销方面或是响应用户请求的效率方面来看。因此操作系统中线程的概念便被引进了。\n\n\n##### 2. 线程\n\n线程，有时被称为轻量级进程（Lightweight Process, LWP），是程序执行流的最小单元。\n\n线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源。但它与同属于一个进程的其它线程共享进程所拥有的全部资源。\n\n一个线程可以创建和撤销另一个线程，同一个进程中的多个线程之间可以并发执行。\n\n线程是程序中一个单一的顺序控制流程，是进程内一个相对独立的、可调度的执行单元，是系统独立调度和分派 CPU 的基本单位，指运行中的程序的调度单位。\n\n在单个程序中同时运行多个线程完成不同的工作，成为多线程。\n\n每个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。\n\n线程的状态：就绪、阻塞、运行\n\n就绪：线程具备运行的所有条件，逻辑上可以运行，在等待处理机。\n\n运行：线程占有处理机正在运行。\n\n阻塞：线程在等待一个事件，逻辑上不可执行。\n\n##### 3. 协程\n\n协程：是一种<b style=\"color:red;\">用户态的轻量级线程，协程的调度完全由用户控制</b>，而线程的调度由操作系统来控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存在其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。\n\n##### 4. 线程与进程的区别\n\n1. 线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间\n2. 进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源\n3. 线程是处理器调度的基本单位，但进程不是\n4. 二者都可并发执行\n5. 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制\n\n\n##### 5. 线程与协程的区别\n\n1. 一个线程可以有多个协程，一个进程也可以单独拥有多个协程\n2. 线程、进程都是同步机制，而协程则是异步\n3. 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态，即状态不会丢失\n\n\n##### 6. 多进程、多线程\n\n多进程：同一时间里、同一计算机系统中如果允许两个或两个以上的进程处于运行状态，这就是多进程\n\n多开一个进程，多分配一份资源，进程间相互独立，通讯不方便\n\n多线程：线程就是吧一个进程分为很多片，每一片都可以是一个独立的流程\n\n与多进程的区别是只会使用一个进程的资源，线程间可以直接通信\n\n##### 7. 举例\n\n单进程单线程：一个人在一个桌子上吃饭\n\n单进程多线程：多个人在同一个桌子上一起吃饭\n\n多进程单线程：多个人每个人在自己的桌子上吃饭\n\n#### 2. 同步阻塞模型\n\n多进程：最早的服务器端程序都是通过多进程、多线程来解决并发 I/O 的问题。一个请求创建一个进程，然后子进程进入循环同步阻塞地与客户端连接进行交互，收发处理数据。\n\n多线程：用多线程模式实现非常简单，线程中可以直接向某一个客户端连接发送数据\n\n##### 1. 步骤\n1. 创建一个 socket\n2. 进入 while 循环，阻塞在进程 accept 操作上，等待客户端连接进入\n3. 主进程在多进程模型下通过 fork 创建子进程\n4. 多线程模型下可以创建子线程\n5. 子进程/线程创建成功后进入 while 循环，阻塞在 recv 调用上，等待客户端向服务器发送数据\n6. 收到数据后服务器程序进行处理然后使用 send 向客户端发送响应\n7. 当客户端连接关闭时，子进程/线程退出并销毁所有资源。主进程/线程会回收掉此子进程/线程。\n\n##### 2. 缺点\n1. 这种模型严重依赖进程的数量解决并发问题\n2. 启动大量进程会带来额外的进程调度消耗\n\n##### 3. 示例\n\n``` php\n<?php\n// 创建 socket 监听\n$socketServer = stream_socket_server('tcp://0.0.0.0:8000', $errno, $errstr);\n// 创建 5 个进程\nfor ($i = 0; $i < 5: ++$i) {\n\t// 如果返回的 pid = 0，表示阻塞\n\tif (pcntl_fork() == 0) {\n\t\t// 持续监听\n\t\twhile (true) {\n\t\t\t$conn = stream_socket_accept($socketServer);\n\t\t\t// 如果连接失败，重新创建监听\n\t\t\tif ($conn == false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t// 读取流信息，并响应\n\t\t\t$request = fread($conn, 9000);\n\t\t\t$response = 'ok';\n\t\t\tfwrite($conn, $response);\n\t\t\tfclose($conn);\n\t\t}\n\t\texit(0);\n\t}\n}\n```\n\n#### 3. 异步非阻塞模型\n\n现在各种高并发异步 I/O 的服务器（nginx、golang、nodejs 等）都是基于 <b style=\"color:red\">epoll （维持无限数量的链接且无需轮询，真正解决了并发的问题）</b>实现的\n\nI/O 复用异步非阻塞程序使用经典的 Reactor 模型，Reactor 顾名思义就是反应堆的意思，它本身不处理任何数据收发，只是可以监视一个 socket 句柄的事件变化，即 EventListener\n\n##### 1. Reactor 模型\n\n四个核心操作\n\n- Add: 添加一个 socket 到 Reactor\n- Set: 修改 socket 对应的事件监听，可以设置监听的类型，如可读可写\n- Del: 从 Reactor 中移除，不再监听事件\n- Callback: 事件发生后回调指定的函数，类似 js 的事件触发，一般在 add/set 时指定\n\n实践：\n- nginx: 多线程 Reactor\n- swoole: 多线程 Reactor + 多进程 worker\n\n#### 4. PHP 并发编程实践\n\nPHP 并发编程主要有以下三种方式\n\n##### 1. PHP 的 Swoole 扩展\n\nPHP 的异步、并行、高性能网络通信引擎，使用纯 C 语言编写，提供了 PHP 语言的异步多线程服务器，异步 TCP/UDP 网络客户端，异步 MySQL，异步 Redis，数据库连接池，AsyncTask，消息队列，毫秒定时器，异步文件读写，异步 DNS 查询。\n\n除了异步 I/O 的支持之外，Swoole 为 PHP 多进程的模式设计了多个并发数据结构和 IPC 通信机制，可以大大简化多进程并发编程的工作。不需要做 Reactor，不需要同步阻塞，直接使用 Swoole 就可以实现。\n\nSwoole 2.0 支持了类似 Go 语言的协程，可以使用完全同步的代码实现异步程序。\n\n示例：Swoole 的异步 MySQL 实现\n\n``` php\n$db = new Swoole\\MySQL;\n$server = array('host' => '', 'user' => '', 'password' => '', 'database' => '');\n$db->connect($server, function($db, $result) {\n\t$db->query('show tables', function(Swoole\\MySQL $db, $result) {\n\t\t// do something\n\t});\n});\n```\n\n基于事件监听的异步操作，不需要等待\n\n\n##### 2. 消息队列\n\n- 场景：用户注册后，需要发注册邮件和注册短信\n  - 串行方式：将注册信息写入数据库成功后，发送注册邮件，再发送注册短信\n  - 并行方式：将注册信息写入数据库成功后，发送注册邮件，同时发送注册短信\n  - 消息队列方式：将注册信息写入数据库成功后，将成功信息写入队列，此时直接返回成功给用户，写入队列的时间非常短，可以忽略不计，然后异步发送邮件和短信（离线发送）\n\n> 应用解耦\n\n- 场景：用户下单后，订单系统需要通知库存系统\n  - 假如库存系统无法访问，则订单减库存将失败，从而导致订单失败。因为订单系统与库存系统耦合。\n  - 引用队列：用户下单后，订单系统完成持久化处理，将消息写入消息队列，返回用户订单下单成功，暂时不去管库存的问题。\n  - 库存系统订阅下单的消息，采用拉/推的方式，获取下单信息，库存系统根据下单信息，进行库存操作。\n\n> 流量削锋\n\n应用场景：秒杀活动，流量瞬间激增，服务器压力大。\n\n用户发起请求，服务器接收后，先写入消息队列。加入消息队列长度超过最大值，则直接报错或提示用户。\n\n后续程序读取消息队列再做处理\n\n作用：控制请求量、缓解高流量\n\n\n> 日志处理\n\n应用场景：解决大量日志的传输\n\n日志采集程序将程序写入消息队列，然后通过日志处理程序订阅日志，离线将日志写入文件，速度将大大提升。\n\n> 消息通讯\n\n应用场景：聊天室\n\n多个客户端订阅同一主题，进行消息发布和接收\n\n\n常见消息队列产品\n\nKafka、ActiveMQ、ZeroMQ、RabbitMQ、Redis 等\n\n##### 3. 接口的并发请求\n\ncurl_multi 系列函数\n\n","slug":"高并发大流量解决方案-7-动态语言的并发处理","published":1,"updated":"2020-09-11T01:04:35.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzba006v6wo11388drzt","content":"<h3 id=\"动态语言的并发处理\"><a href=\"#动态语言的并发处理\" class=\"headerlink\" title=\"动态语言的并发处理\"></a>动态语言的并发处理</h3><h4 id=\"1-进程、线程、协程\"><a href=\"#1-进程、线程、协程\" class=\"headerlink\" title=\"1. 进程、线程、协程\"></a>1. 进程、线程、协程</h4><h5 id=\"1-进程\"><a href=\"#1-进程\" class=\"headerlink\" title=\"1. 进程\"></a>1. 进程</h5><p>进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</p>\n<p>进程是一个 “<b style=\"color:red\">执行中的程序</b>”</p>\n<a id=\"more\"></a>\n\n<blockquote>\n<p>进程的三态模型：多道程序系统中，进程在处理器上交替运行，状态不断地发生变化</p>\n</blockquote>\n<p>三个状态：运行、就绪、阻塞</p>\n<ul>\n<li><p>运行：当一个进程在处理机上运行时，则称该进程处于运行状态。处于此状态的进程的数目小于等于处理器的数目（处理器一个核心同时只能处理一个进程），对于单处理机系统，处于运行状态的进程只有一个。在没有其他进程可以执行时（如所有进程都在阻塞状态），通常会自动执行系统的空闲进程。</p>\n</li>\n<li><p>就绪：当一个进程获得了除处理机以外的一切所需资源，一旦得到处理机即可运行，则称此进程处于就绪状态。就绪进程可以按多个优先级来划分队列。例如，当一个进程由于时间片用完而进入就绪状态时，排入低优先级队列；当进程由 I/O 操作完成而进入就绪状态时，排入高优先级队列。</p>\n</li>\n<li><p>阻塞：也称为等待或睡眠状态，一个进程正在等待某一事件发生（例如请求 I/O 而等待 I/O 完成等）而暂时停止运行，这时即使把处理机分配给进程也无法运行，故城该进程处于阻塞状态。如手机的app后台进入后台。</p>\n</li>\n</ul>\n<blockquote>\n<p>进程的五态模型：对于一个实际的系统，进程的状态及其转换更为复杂</p>\n</blockquote>\n<p>新建态、活跃就绪/静止就绪、运行、活跃阻塞/静止阻塞、终止态</p>\n<ul>\n<li><p>新建态：对应于进程刚刚被创建时没有被提交的状态，并等待系统完成创建进程的所有必要信息。比赛开始状态。</p>\n</li>\n<li><p>静止阻塞：进程兑换到辅存时的阻塞状态，一旦等待的事件产生便进入静止就绪状态。等待进入比赛大名单的状态。</p>\n</li>\n<li><p>静止就绪（挂起就绪）：是指进程被兑换到辅存时的就绪状态，是不能被直接调度的状态，只有当主存中没有活跃就绪态进程，或者挂起就绪态进程具有更高的优先级，系统将把挂起就绪态进程调回主存并转换为活跃就绪。替补球员看饮水机状态。</p>\n</li>\n<li><p>活跃阻塞：是指进程已在主存，一旦等待的事件产生便进入活跃就绪状态。</p>\n</li>\n<li><p>活跃就绪：是指进程在主存并且可被调度的状态。替补球员热身状态。</p>\n</li>\n<li><p>终止态：进程已结束运行，回收除进程控制块之外的其他资源，并让其他进程从进程控制块中收集有关信息。比赛结束或被替补下的状态。</p>\n</li>\n</ul>\n<p>由于用户的并发请求，为每一个请求都创建一个进程显显然是行不通的，从系统资源开销方面或是响应用户请求的效率方面来看。因此操作系统中线程的概念便被引进了。</p>\n<h5 id=\"2-线程\"><a href=\"#2-线程\" class=\"headerlink\" title=\"2. 线程\"></a>2. 线程</h5><p>线程，有时被称为轻量级进程（Lightweight Process, LWP），是程序执行流的最小单元。</p>\n<p>线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源。但它与同属于一个进程的其它线程共享进程所拥有的全部资源。</p>\n<p>一个线程可以创建和撤销另一个线程，同一个进程中的多个线程之间可以并发执行。</p>\n<p>线程是程序中一个单一的顺序控制流程，是进程内一个相对独立的、可调度的执行单元，是系统独立调度和分派 CPU 的基本单位，指运行中的程序的调度单位。</p>\n<p>在单个程序中同时运行多个线程完成不同的工作，成为多线程。</p>\n<p>每个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。</p>\n<p>线程的状态：就绪、阻塞、运行</p>\n<p>就绪：线程具备运行的所有条件，逻辑上可以运行，在等待处理机。</p>\n<p>运行：线程占有处理机正在运行。</p>\n<p>阻塞：线程在等待一个事件，逻辑上不可执行。</p>\n<h5 id=\"3-协程\"><a href=\"#3-协程\" class=\"headerlink\" title=\"3. 协程\"></a>3. 协程</h5><p>协程：是一种<b style=\"color:red;\">用户态的轻量级线程，协程的调度完全由用户控制</b>，而线程的调度由操作系统来控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存在其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。</p>\n<h5 id=\"4-线程与进程的区别\"><a href=\"#4-线程与进程的区别\" class=\"headerlink\" title=\"4. 线程与进程的区别\"></a>4. 线程与进程的区别</h5><ol>\n<li>线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间</li>\n<li>进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源</li>\n<li>线程是处理器调度的基本单位，但进程不是</li>\n<li>二者都可并发执行</li>\n<li>每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制</li>\n</ol>\n<h5 id=\"5-线程与协程的区别\"><a href=\"#5-线程与协程的区别\" class=\"headerlink\" title=\"5. 线程与协程的区别\"></a>5. 线程与协程的区别</h5><ol>\n<li>一个线程可以有多个协程，一个进程也可以单独拥有多个协程</li>\n<li>线程、进程都是同步机制，而协程则是异步</li>\n<li>协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态，即状态不会丢失</li>\n</ol>\n<h5 id=\"6-多进程、多线程\"><a href=\"#6-多进程、多线程\" class=\"headerlink\" title=\"6. 多进程、多线程\"></a>6. 多进程、多线程</h5><p>多进程：同一时间里、同一计算机系统中如果允许两个或两个以上的进程处于运行状态，这就是多进程</p>\n<p>多开一个进程，多分配一份资源，进程间相互独立，通讯不方便</p>\n<p>多线程：线程就是吧一个进程分为很多片，每一片都可以是一个独立的流程</p>\n<p>与多进程的区别是只会使用一个进程的资源，线程间可以直接通信</p>\n<h5 id=\"7-举例\"><a href=\"#7-举例\" class=\"headerlink\" title=\"7. 举例\"></a>7. 举例</h5><p>单进程单线程：一个人在一个桌子上吃饭</p>\n<p>单进程多线程：多个人在同一个桌子上一起吃饭</p>\n<p>多进程单线程：多个人每个人在自己的桌子上吃饭</p>\n<h4 id=\"2-同步阻塞模型\"><a href=\"#2-同步阻塞模型\" class=\"headerlink\" title=\"2. 同步阻塞模型\"></a>2. 同步阻塞模型</h4><p>多进程：最早的服务器端程序都是通过多进程、多线程来解决并发 I/O 的问题。一个请求创建一个进程，然后子进程进入循环同步阻塞地与客户端连接进行交互，收发处理数据。</p>\n<p>多线程：用多线程模式实现非常简单，线程中可以直接向某一个客户端连接发送数据</p>\n<h5 id=\"1-步骤\"><a href=\"#1-步骤\" class=\"headerlink\" title=\"1. 步骤\"></a>1. 步骤</h5><ol>\n<li>创建一个 socket</li>\n<li>进入 while 循环，阻塞在进程 accept 操作上，等待客户端连接进入</li>\n<li>主进程在多进程模型下通过 fork 创建子进程</li>\n<li>多线程模型下可以创建子线程</li>\n<li>子进程/线程创建成功后进入 while 循环，阻塞在 recv 调用上，等待客户端向服务器发送数据</li>\n<li>收到数据后服务器程序进行处理然后使用 send 向客户端发送响应</li>\n<li>当客户端连接关闭时，子进程/线程退出并销毁所有资源。主进程/线程会回收掉此子进程/线程。</li>\n</ol>\n<h5 id=\"2-缺点\"><a href=\"#2-缺点\" class=\"headerlink\" title=\"2. 缺点\"></a>2. 缺点</h5><ol>\n<li>这种模型严重依赖进程的数量解决并发问题</li>\n<li>启动大量进程会带来额外的进程调度消耗</li>\n</ol>\n<h5 id=\"3-示例\"><a href=\"#3-示例\" class=\"headerlink\" title=\"3. 示例\"></a>3. 示例</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">// 创建 socket 监听</span></span><br><span class=\"line\">$socketServer = stream_socket_server(<span class=\"string\">&#x27;tcp://0.0.0.0:8000&#x27;</span>, $errno, $errstr);</span><br><span class=\"line\"><span class=\"comment\">// 创建 5 个进程</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; <span class=\"number\">5</span>: ++$i) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 如果返回的 pid = 0，表示阻塞</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pcntl_fork() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 持续监听</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">\t\t\t$conn = stream_socket_accept($socketServer);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 如果连接失败，重新创建监听</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($conn == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 读取流信息，并响应</span></span><br><span class=\"line\">\t\t\t$request = fread($conn, <span class=\"number\">9000</span>);</span><br><span class=\"line\">\t\t\t$response = <span class=\"string\">&#x27;ok&#x27;</span>;</span><br><span class=\"line\">\t\t\tfwrite($conn, $response);</span><br><span class=\"line\">\t\t\tfclose($conn);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-异步非阻塞模型\"><a href=\"#3-异步非阻塞模型\" class=\"headerlink\" title=\"3. 异步非阻塞模型\"></a>3. 异步非阻塞模型</h4><p>现在各种高并发异步 I/O 的服务器（nginx、golang、nodejs 等）都是基于 <b style=\"color:red\">epoll （维持无限数量的链接且无需轮询，真正解决了并发的问题）</b>实现的</p>\n<p>I/O 复用异步非阻塞程序使用经典的 Reactor 模型，Reactor 顾名思义就是反应堆的意思，它本身不处理任何数据收发，只是可以监视一个 socket 句柄的事件变化，即 EventListener</p>\n<h5 id=\"1-Reactor-模型\"><a href=\"#1-Reactor-模型\" class=\"headerlink\" title=\"1. Reactor 模型\"></a>1. Reactor 模型</h5><p>四个核心操作</p>\n<ul>\n<li>Add: 添加一个 socket 到 Reactor</li>\n<li>Set: 修改 socket 对应的事件监听，可以设置监听的类型，如可读可写</li>\n<li>Del: 从 Reactor 中移除，不再监听事件</li>\n<li>Callback: 事件发生后回调指定的函数，类似 js 的事件触发，一般在 add/set 时指定</li>\n</ul>\n<p>实践：</p>\n<ul>\n<li>nginx: 多线程 Reactor</li>\n<li>swoole: 多线程 Reactor + 多进程 worker</li>\n</ul>\n<h4 id=\"4-PHP-并发编程实践\"><a href=\"#4-PHP-并发编程实践\" class=\"headerlink\" title=\"4. PHP 并发编程实践\"></a>4. PHP 并发编程实践</h4><p>PHP 并发编程主要有以下三种方式</p>\n<h5 id=\"1-PHP-的-Swoole-扩展\"><a href=\"#1-PHP-的-Swoole-扩展\" class=\"headerlink\" title=\"1. PHP 的 Swoole 扩展\"></a>1. PHP 的 Swoole 扩展</h5><p>PHP 的异步、并行、高性能网络通信引擎，使用纯 C 语言编写，提供了 PHP 语言的异步多线程服务器，异步 TCP/UDP 网络客户端，异步 MySQL，异步 Redis，数据库连接池，AsyncTask，消息队列，毫秒定时器，异步文件读写，异步 DNS 查询。</p>\n<p>除了异步 I/O 的支持之外，Swoole 为 PHP 多进程的模式设计了多个并发数据结构和 IPC 通信机制，可以大大简化多进程并发编程的工作。不需要做 Reactor，不需要同步阻塞，直接使用 Swoole 就可以实现。</p>\n<p>Swoole 2.0 支持了类似 Go 语言的协程，可以使用完全同步的代码实现异步程序。</p>\n<p>示例：Swoole 的异步 MySQL 实现</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$db = <span class=\"keyword\">new</span> Swoole\\MySQL;</span><br><span class=\"line\">$server = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;host&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;user&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;password&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;database&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">$db-&gt;connect($server, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$db, $result</span>) </span>&#123;</span><br><span class=\"line\">\t$db-&gt;query(<span class=\"string\">&#x27;show tables&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">Swoole\\MySQL $db, $result</span>) </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something</span></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>基于事件监听的异步操作，不需要等待</p>\n<h5 id=\"2-消息队列\"><a href=\"#2-消息队列\" class=\"headerlink\" title=\"2. 消息队列\"></a>2. 消息队列</h5><ul>\n<li>场景：用户注册后，需要发注册邮件和注册短信<ul>\n<li>串行方式：将注册信息写入数据库成功后，发送注册邮件，再发送注册短信</li>\n<li>并行方式：将注册信息写入数据库成功后，发送注册邮件，同时发送注册短信</li>\n<li>消息队列方式：将注册信息写入数据库成功后，将成功信息写入队列，此时直接返回成功给用户，写入队列的时间非常短，可以忽略不计，然后异步发送邮件和短信（离线发送）</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>应用解耦</p>\n</blockquote>\n<ul>\n<li>场景：用户下单后，订单系统需要通知库存系统<ul>\n<li>假如库存系统无法访问，则订单减库存将失败，从而导致订单失败。因为订单系统与库存系统耦合。</li>\n<li>引用队列：用户下单后，订单系统完成持久化处理，将消息写入消息队列，返回用户订单下单成功，暂时不去管库存的问题。</li>\n<li>库存系统订阅下单的消息，采用拉/推的方式，获取下单信息，库存系统根据下单信息，进行库存操作。</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>流量削锋</p>\n</blockquote>\n<p>应用场景：秒杀活动，流量瞬间激增，服务器压力大。</p>\n<p>用户发起请求，服务器接收后，先写入消息队列。加入消息队列长度超过最大值，则直接报错或提示用户。</p>\n<p>后续程序读取消息队列再做处理</p>\n<p>作用：控制请求量、缓解高流量</p>\n<blockquote>\n<p>日志处理</p>\n</blockquote>\n<p>应用场景：解决大量日志的传输</p>\n<p>日志采集程序将程序写入消息队列，然后通过日志处理程序订阅日志，离线将日志写入文件，速度将大大提升。</p>\n<blockquote>\n<p>消息通讯</p>\n</blockquote>\n<p>应用场景：聊天室</p>\n<p>多个客户端订阅同一主题，进行消息发布和接收</p>\n<p>常见消息队列产品</p>\n<p>Kafka、ActiveMQ、ZeroMQ、RabbitMQ、Redis 等</p>\n<h5 id=\"3-接口的并发请求\"><a href=\"#3-接口的并发请求\" class=\"headerlink\" title=\"3. 接口的并发请求\"></a>3. 接口的并发请求</h5><p>curl_multi 系列函数</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"动态语言的并发处理\"><a href=\"#动态语言的并发处理\" class=\"headerlink\" title=\"动态语言的并发处理\"></a>动态语言的并发处理</h3><h4 id=\"1-进程、线程、协程\"><a href=\"#1-进程、线程、协程\" class=\"headerlink\" title=\"1. 进程、线程、协程\"></a>1. 进程、线程、协程</h4><h5 id=\"1-进程\"><a href=\"#1-进程\" class=\"headerlink\" title=\"1. 进程\"></a>1. 进程</h5><p>进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。</p>\n<p>进程是一个 “<b style=\"color:red\">执行中的程序</b>”</p>","more":"<blockquote>\n<p>进程的三态模型：多道程序系统中，进程在处理器上交替运行，状态不断地发生变化</p>\n</blockquote>\n<p>三个状态：运行、就绪、阻塞</p>\n<ul>\n<li><p>运行：当一个进程在处理机上运行时，则称该进程处于运行状态。处于此状态的进程的数目小于等于处理器的数目（处理器一个核心同时只能处理一个进程），对于单处理机系统，处于运行状态的进程只有一个。在没有其他进程可以执行时（如所有进程都在阻塞状态），通常会自动执行系统的空闲进程。</p>\n</li>\n<li><p>就绪：当一个进程获得了除处理机以外的一切所需资源，一旦得到处理机即可运行，则称此进程处于就绪状态。就绪进程可以按多个优先级来划分队列。例如，当一个进程由于时间片用完而进入就绪状态时，排入低优先级队列；当进程由 I/O 操作完成而进入就绪状态时，排入高优先级队列。</p>\n</li>\n<li><p>阻塞：也称为等待或睡眠状态，一个进程正在等待某一事件发生（例如请求 I/O 而等待 I/O 完成等）而暂时停止运行，这时即使把处理机分配给进程也无法运行，故城该进程处于阻塞状态。如手机的app后台进入后台。</p>\n</li>\n</ul>\n<blockquote>\n<p>进程的五态模型：对于一个实际的系统，进程的状态及其转换更为复杂</p>\n</blockquote>\n<p>新建态、活跃就绪/静止就绪、运行、活跃阻塞/静止阻塞、终止态</p>\n<ul>\n<li><p>新建态：对应于进程刚刚被创建时没有被提交的状态，并等待系统完成创建进程的所有必要信息。比赛开始状态。</p>\n</li>\n<li><p>静止阻塞：进程兑换到辅存时的阻塞状态，一旦等待的事件产生便进入静止就绪状态。等待进入比赛大名单的状态。</p>\n</li>\n<li><p>静止就绪（挂起就绪）：是指进程被兑换到辅存时的就绪状态，是不能被直接调度的状态，只有当主存中没有活跃就绪态进程，或者挂起就绪态进程具有更高的优先级，系统将把挂起就绪态进程调回主存并转换为活跃就绪。替补球员看饮水机状态。</p>\n</li>\n<li><p>活跃阻塞：是指进程已在主存，一旦等待的事件产生便进入活跃就绪状态。</p>\n</li>\n<li><p>活跃就绪：是指进程在主存并且可被调度的状态。替补球员热身状态。</p>\n</li>\n<li><p>终止态：进程已结束运行，回收除进程控制块之外的其他资源，并让其他进程从进程控制块中收集有关信息。比赛结束或被替补下的状态。</p>\n</li>\n</ul>\n<p>由于用户的并发请求，为每一个请求都创建一个进程显显然是行不通的，从系统资源开销方面或是响应用户请求的效率方面来看。因此操作系统中线程的概念便被引进了。</p>\n<h5 id=\"2-线程\"><a href=\"#2-线程\" class=\"headerlink\" title=\"2. 线程\"></a>2. 线程</h5><p>线程，有时被称为轻量级进程（Lightweight Process, LWP），是程序执行流的最小单元。</p>\n<p>线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源。但它与同属于一个进程的其它线程共享进程所拥有的全部资源。</p>\n<p>一个线程可以创建和撤销另一个线程，同一个进程中的多个线程之间可以并发执行。</p>\n<p>线程是程序中一个单一的顺序控制流程，是进程内一个相对独立的、可调度的执行单元，是系统独立调度和分派 CPU 的基本单位，指运行中的程序的调度单位。</p>\n<p>在单个程序中同时运行多个线程完成不同的工作，成为多线程。</p>\n<p>每个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。</p>\n<p>线程的状态：就绪、阻塞、运行</p>\n<p>就绪：线程具备运行的所有条件，逻辑上可以运行，在等待处理机。</p>\n<p>运行：线程占有处理机正在运行。</p>\n<p>阻塞：线程在等待一个事件，逻辑上不可执行。</p>\n<h5 id=\"3-协程\"><a href=\"#3-协程\" class=\"headerlink\" title=\"3. 协程\"></a>3. 协程</h5><p>协程：是一种<b style=\"color:red;\">用户态的轻量级线程，协程的调度完全由用户控制</b>，而线程的调度由操作系统来控制。协程拥有自己的寄存器上下文和栈。协程调度切换时，将寄存器上下文和栈保存在其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，可以不加锁的访问全局变量，所以上下文的切换非常快。</p>\n<h5 id=\"4-线程与进程的区别\"><a href=\"#4-线程与进程的区别\" class=\"headerlink\" title=\"4. 线程与进程的区别\"></a>4. 线程与进程的区别</h5><ol>\n<li>线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自己独立的地址空间</li>\n<li>进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源</li>\n<li>线程是处理器调度的基本单位，但进程不是</li>\n<li>二者都可并发执行</li>\n<li>每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制</li>\n</ol>\n<h5 id=\"5-线程与协程的区别\"><a href=\"#5-线程与协程的区别\" class=\"headerlink\" title=\"5. 线程与协程的区别\"></a>5. 线程与协程的区别</h5><ol>\n<li>一个线程可以有多个协程，一个进程也可以单独拥有多个协程</li>\n<li>线程、进程都是同步机制，而协程则是异步</li>\n<li>协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态，即状态不会丢失</li>\n</ol>\n<h5 id=\"6-多进程、多线程\"><a href=\"#6-多进程、多线程\" class=\"headerlink\" title=\"6. 多进程、多线程\"></a>6. 多进程、多线程</h5><p>多进程：同一时间里、同一计算机系统中如果允许两个或两个以上的进程处于运行状态，这就是多进程</p>\n<p>多开一个进程，多分配一份资源，进程间相互独立，通讯不方便</p>\n<p>多线程：线程就是吧一个进程分为很多片，每一片都可以是一个独立的流程</p>\n<p>与多进程的区别是只会使用一个进程的资源，线程间可以直接通信</p>\n<h5 id=\"7-举例\"><a href=\"#7-举例\" class=\"headerlink\" title=\"7. 举例\"></a>7. 举例</h5><p>单进程单线程：一个人在一个桌子上吃饭</p>\n<p>单进程多线程：多个人在同一个桌子上一起吃饭</p>\n<p>多进程单线程：多个人每个人在自己的桌子上吃饭</p>\n<h4 id=\"2-同步阻塞模型\"><a href=\"#2-同步阻塞模型\" class=\"headerlink\" title=\"2. 同步阻塞模型\"></a>2. 同步阻塞模型</h4><p>多进程：最早的服务器端程序都是通过多进程、多线程来解决并发 I/O 的问题。一个请求创建一个进程，然后子进程进入循环同步阻塞地与客户端连接进行交互，收发处理数据。</p>\n<p>多线程：用多线程模式实现非常简单，线程中可以直接向某一个客户端连接发送数据</p>\n<h5 id=\"1-步骤\"><a href=\"#1-步骤\" class=\"headerlink\" title=\"1. 步骤\"></a>1. 步骤</h5><ol>\n<li>创建一个 socket</li>\n<li>进入 while 循环，阻塞在进程 accept 操作上，等待客户端连接进入</li>\n<li>主进程在多进程模型下通过 fork 创建子进程</li>\n<li>多线程模型下可以创建子线程</li>\n<li>子进程/线程创建成功后进入 while 循环，阻塞在 recv 调用上，等待客户端向服务器发送数据</li>\n<li>收到数据后服务器程序进行处理然后使用 send 向客户端发送响应</li>\n<li>当客户端连接关闭时，子进程/线程退出并销毁所有资源。主进程/线程会回收掉此子进程/线程。</li>\n</ol>\n<h5 id=\"2-缺点\"><a href=\"#2-缺点\" class=\"headerlink\" title=\"2. 缺点\"></a>2. 缺点</h5><ol>\n<li>这种模型严重依赖进程的数量解决并发问题</li>\n<li>启动大量进程会带来额外的进程调度消耗</li>\n</ol>\n<h5 id=\"3-示例\"><a href=\"#3-示例\" class=\"headerlink\" title=\"3. 示例\"></a>3. 示例</h5><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">// 创建 socket 监听</span></span><br><span class=\"line\">$socketServer = stream_socket_server(<span class=\"string\">&#x27;tcp://0.0.0.0:8000&#x27;</span>, $errno, $errstr);</span><br><span class=\"line\"><span class=\"comment\">// 创建 5 个进程</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> ($i = <span class=\"number\">0</span>; $i &lt; <span class=\"number\">5</span>: ++$i) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 如果返回的 pid = 0，表示阻塞</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pcntl_fork() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// 持续监听</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">\t\t\t$conn = stream_socket_accept($socketServer);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 如果连接失败，重新创建监听</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ($conn == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 读取流信息，并响应</span></span><br><span class=\"line\">\t\t\t$request = fread($conn, <span class=\"number\">9000</span>);</span><br><span class=\"line\">\t\t\t$response = <span class=\"string\">&#x27;ok&#x27;</span>;</span><br><span class=\"line\">\t\t\tfwrite($conn, $response);</span><br><span class=\"line\">\t\t\tfclose($conn);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-异步非阻塞模型\"><a href=\"#3-异步非阻塞模型\" class=\"headerlink\" title=\"3. 异步非阻塞模型\"></a>3. 异步非阻塞模型</h4><p>现在各种高并发异步 I/O 的服务器（nginx、golang、nodejs 等）都是基于 <b style=\"color:red\">epoll （维持无限数量的链接且无需轮询，真正解决了并发的问题）</b>实现的</p>\n<p>I/O 复用异步非阻塞程序使用经典的 Reactor 模型，Reactor 顾名思义就是反应堆的意思，它本身不处理任何数据收发，只是可以监视一个 socket 句柄的事件变化，即 EventListener</p>\n<h5 id=\"1-Reactor-模型\"><a href=\"#1-Reactor-模型\" class=\"headerlink\" title=\"1. Reactor 模型\"></a>1. Reactor 模型</h5><p>四个核心操作</p>\n<ul>\n<li>Add: 添加一个 socket 到 Reactor</li>\n<li>Set: 修改 socket 对应的事件监听，可以设置监听的类型，如可读可写</li>\n<li>Del: 从 Reactor 中移除，不再监听事件</li>\n<li>Callback: 事件发生后回调指定的函数，类似 js 的事件触发，一般在 add/set 时指定</li>\n</ul>\n<p>实践：</p>\n<ul>\n<li>nginx: 多线程 Reactor</li>\n<li>swoole: 多线程 Reactor + 多进程 worker</li>\n</ul>\n<h4 id=\"4-PHP-并发编程实践\"><a href=\"#4-PHP-并发编程实践\" class=\"headerlink\" title=\"4. PHP 并发编程实践\"></a>4. PHP 并发编程实践</h4><p>PHP 并发编程主要有以下三种方式</p>\n<h5 id=\"1-PHP-的-Swoole-扩展\"><a href=\"#1-PHP-的-Swoole-扩展\" class=\"headerlink\" title=\"1. PHP 的 Swoole 扩展\"></a>1. PHP 的 Swoole 扩展</h5><p>PHP 的异步、并行、高性能网络通信引擎，使用纯 C 语言编写，提供了 PHP 语言的异步多线程服务器，异步 TCP/UDP 网络客户端，异步 MySQL，异步 Redis，数据库连接池，AsyncTask，消息队列，毫秒定时器，异步文件读写，异步 DNS 查询。</p>\n<p>除了异步 I/O 的支持之外，Swoole 为 PHP 多进程的模式设计了多个并发数据结构和 IPC 通信机制，可以大大简化多进程并发编程的工作。不需要做 Reactor，不需要同步阻塞，直接使用 Swoole 就可以实现。</p>\n<p>Swoole 2.0 支持了类似 Go 语言的协程，可以使用完全同步的代码实现异步程序。</p>\n<p>示例：Swoole 的异步 MySQL 实现</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$db = <span class=\"keyword\">new</span> Swoole\\MySQL;</span><br><span class=\"line\">$server = <span class=\"keyword\">array</span>(<span class=\"string\">&#x27;host&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;user&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;password&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>, <span class=\"string\">&#x27;database&#x27;</span> =&gt; <span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">$db-&gt;connect($server, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">$db, $result</span>) </span>&#123;</span><br><span class=\"line\">\t$db-&gt;query(<span class=\"string\">&#x27;show tables&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">Swoole\\MySQL $db, $result</span>) </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something</span></span><br><span class=\"line\">\t&#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>基于事件监听的异步操作，不需要等待</p>\n<h5 id=\"2-消息队列\"><a href=\"#2-消息队列\" class=\"headerlink\" title=\"2. 消息队列\"></a>2. 消息队列</h5><ul>\n<li>场景：用户注册后，需要发注册邮件和注册短信<ul>\n<li>串行方式：将注册信息写入数据库成功后，发送注册邮件，再发送注册短信</li>\n<li>并行方式：将注册信息写入数据库成功后，发送注册邮件，同时发送注册短信</li>\n<li>消息队列方式：将注册信息写入数据库成功后，将成功信息写入队列，此时直接返回成功给用户，写入队列的时间非常短，可以忽略不计，然后异步发送邮件和短信（离线发送）</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>应用解耦</p>\n</blockquote>\n<ul>\n<li>场景：用户下单后，订单系统需要通知库存系统<ul>\n<li>假如库存系统无法访问，则订单减库存将失败，从而导致订单失败。因为订单系统与库存系统耦合。</li>\n<li>引用队列：用户下单后，订单系统完成持久化处理，将消息写入消息队列，返回用户订单下单成功，暂时不去管库存的问题。</li>\n<li>库存系统订阅下单的消息，采用拉/推的方式，获取下单信息，库存系统根据下单信息，进行库存操作。</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>流量削锋</p>\n</blockquote>\n<p>应用场景：秒杀活动，流量瞬间激增，服务器压力大。</p>\n<p>用户发起请求，服务器接收后，先写入消息队列。加入消息队列长度超过最大值，则直接报错或提示用户。</p>\n<p>后续程序读取消息队列再做处理</p>\n<p>作用：控制请求量、缓解高流量</p>\n<blockquote>\n<p>日志处理</p>\n</blockquote>\n<p>应用场景：解决大量日志的传输</p>\n<p>日志采集程序将程序写入消息队列，然后通过日志处理程序订阅日志，离线将日志写入文件，速度将大大提升。</p>\n<blockquote>\n<p>消息通讯</p>\n</blockquote>\n<p>应用场景：聊天室</p>\n<p>多个客户端订阅同一主题，进行消息发布和接收</p>\n<p>常见消息队列产品</p>\n<p>Kafka、ActiveMQ、ZeroMQ、RabbitMQ、Redis 等</p>\n<h5 id=\"3-接口的并发请求\"><a href=\"#3-接口的并发请求\" class=\"headerlink\" title=\"3. 接口的并发请求\"></a>3. 接口的并发请求</h5><p>curl_multi 系列函数</p>"},{"title":"高并发大流量解决方案 8  数据库缓存层优化","date":"2018-02-15T08:34:29.000Z","_content":"\n### 数据库缓存层优化\n\n#### 1. 什么是数据库缓存\n\nMySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。\n\n<!-- more -->\n\n优势：\n\n- 极大地解决数据库服务器的压力\n- 提高应用数据的响应速度\n\n常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存\n\n#### 2. 为什么要使用数据库缓存\n\n缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。\n\n> 流程\n\n用户请求 -- 数据查询 -- 连接数据库服务器并查询数据 -- 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） -- 显示给客户端\n\n用户再次请求或新用户访问 -- 数据查询 -- 直接从缓存中获取数据 -- 显示给客户端\n\n缓存需要考虑的问题\n\n- 缓存方式的选择：尽量使用内存\n- 缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据\n- 缓存数据的实时性，不建议同步地修改\n- 缓存数据的稳定性 \n\n#### 3. 使用 MySQL 查询缓存\n\n##### 1. 启用 MySQL 查询缓存\n\n可极大降低 CPU 使用率\n\n> 开启方法：\n\n`query_cache_type`: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。\n\n`query_cache_type=1` 时，也可以在查询语句中关闭查询缓存\n```\nSELECT SQL_NO_CACHE * FROM my_table WHERE condition;\n```\n\n`query_cache_type=2` 时，可按需使用查询缓存\n\n```\nSELECT SQL_CACHE * FROM my_table WHERE condition;\n```\n\nquery_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。\n\n```\nSET GLOBAL query_cache_size = 134217728; (128M)\n```\n\n查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存\n\n```\nSHOW STATUS LIKE 'Qcache_hits'; // 查看命中次数\n```\n\n表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。\n\n> 清理缓存\n\n```\nFLUSH QUERY CACHE; // 清理查询缓存内存碎片\nRESET QUERY CACHE; // 从查询缓存中移除所有查询\nFLUSH TABLES; // 关闭所有打开的表，同时该操作将会清空查询缓存中的内容\n```\n\n#### 4. 使用 memcache 缓存\n\n对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。\n\nmemcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。\n\nmemcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。\n\n> 工作流程：\n\n先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。\n\n> 常用方法：\n\n- 获取：get(key)\n- 设置：set(key, val, expire)\n- 删除：delete(key)\n\n> 通用缓存机制：\n\n用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。\n\n#### 5. 使用 Redis 缓存\n\n与 memcache 的区别\n\n- 性能相差不大\n- Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法\n- Redis 依赖客户端来实现分布式读写\n- memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。\n- memcache 不支持持久化，通常做缓存，提升性能；\n- memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。\n- Redis 支持多种类型的数据类型\n- Redis 常用于数据量较小的高性能操作和运算上\n- memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能\n\n\n#### 6. 其他数据缓存\n\nSession：尽量存到 memcache 或 Redis 里\n","source":"_posts/高并发大流量解决方案-8-数据库缓存层优化.md","raw":"---\ntitle: 高并发大流量解决方案 8  数据库缓存层优化\ndate: 2018-02-15 16:34:29\ntags: 高并发\n---\n\n### 数据库缓存层优化\n\n#### 1. 什么是数据库缓存\n\nMySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。\n\n<!-- more -->\n\n优势：\n\n- 极大地解决数据库服务器的压力\n- 提高应用数据的响应速度\n\n常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存\n\n#### 2. 为什么要使用数据库缓存\n\n缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。\n\n> 流程\n\n用户请求 -- 数据查询 -- 连接数据库服务器并查询数据 -- 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） -- 显示给客户端\n\n用户再次请求或新用户访问 -- 数据查询 -- 直接从缓存中获取数据 -- 显示给客户端\n\n缓存需要考虑的问题\n\n- 缓存方式的选择：尽量使用内存\n- 缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据\n- 缓存数据的实时性，不建议同步地修改\n- 缓存数据的稳定性 \n\n#### 3. 使用 MySQL 查询缓存\n\n##### 1. 启用 MySQL 查询缓存\n\n可极大降低 CPU 使用率\n\n> 开启方法：\n\n`query_cache_type`: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。\n\n`query_cache_type=1` 时，也可以在查询语句中关闭查询缓存\n```\nSELECT SQL_NO_CACHE * FROM my_table WHERE condition;\n```\n\n`query_cache_type=2` 时，可按需使用查询缓存\n\n```\nSELECT SQL_CACHE * FROM my_table WHERE condition;\n```\n\nquery_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。\n\n```\nSET GLOBAL query_cache_size = 134217728; (128M)\n```\n\n查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存\n\n```\nSHOW STATUS LIKE 'Qcache_hits'; // 查看命中次数\n```\n\n表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。\n\n> 清理缓存\n\n```\nFLUSH QUERY CACHE; // 清理查询缓存内存碎片\nRESET QUERY CACHE; // 从查询缓存中移除所有查询\nFLUSH TABLES; // 关闭所有打开的表，同时该操作将会清空查询缓存中的内容\n```\n\n#### 4. 使用 memcache 缓存\n\n对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。\n\nmemcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。\n\nmemcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。\n\n> 工作流程：\n\n先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。\n\n> 常用方法：\n\n- 获取：get(key)\n- 设置：set(key, val, expire)\n- 删除：delete(key)\n\n> 通用缓存机制：\n\n用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。\n\n#### 5. 使用 Redis 缓存\n\n与 memcache 的区别\n\n- 性能相差不大\n- Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法\n- Redis 依赖客户端来实现分布式读写\n- memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。\n- memcache 不支持持久化，通常做缓存，提升性能；\n- memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。\n- Redis 支持多种类型的数据类型\n- Redis 常用于数据量较小的高性能操作和运算上\n- memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能\n\n\n#### 6. 其他数据缓存\n\nSession：尽量存到 memcache 或 Redis 里\n","slug":"高并发大流量解决方案-8-数据库缓存层优化","published":1,"updated":"2020-09-11T01:04:35.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzba006x6wo10r7g8h95","content":"<h3 id=\"数据库缓存层优化\"><a href=\"#数据库缓存层优化\" class=\"headerlink\" title=\"数据库缓存层优化\"></a>数据库缓存层优化</h3><h4 id=\"1-什么是数据库缓存\"><a href=\"#1-什么是数据库缓存\" class=\"headerlink\" title=\"1. 什么是数据库缓存\"></a>1. 什么是数据库缓存</h4><p>MySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。</p>\n<a id=\"more\"></a>\n\n<p>优势：</p>\n<ul>\n<li>极大地解决数据库服务器的压力</li>\n<li>提高应用数据的响应速度</li>\n</ul>\n<p>常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存</p>\n<h4 id=\"2-为什么要使用数据库缓存\"><a href=\"#2-为什么要使用数据库缓存\" class=\"headerlink\" title=\"2. 为什么要使用数据库缓存\"></a>2. 为什么要使用数据库缓存</h4><p>缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。</p>\n<blockquote>\n<p>流程</p>\n</blockquote>\n<p>用户请求 – 数据查询 – 连接数据库服务器并查询数据 – 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） – 显示给客户端</p>\n<p>用户再次请求或新用户访问 – 数据查询 – 直接从缓存中获取数据 – 显示给客户端</p>\n<p>缓存需要考虑的问题</p>\n<ul>\n<li>缓存方式的选择：尽量使用内存</li>\n<li>缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据</li>\n<li>缓存数据的实时性，不建议同步地修改</li>\n<li>缓存数据的稳定性 </li>\n</ul>\n<h4 id=\"3-使用-MySQL-查询缓存\"><a href=\"#3-使用-MySQL-查询缓存\" class=\"headerlink\" title=\"3. 使用 MySQL 查询缓存\"></a>3. 使用 MySQL 查询缓存</h4><h5 id=\"1-启用-MySQL-查询缓存\"><a href=\"#1-启用-MySQL-查询缓存\" class=\"headerlink\" title=\"1. 启用 MySQL 查询缓存\"></a>1. 启用 MySQL 查询缓存</h5><p>可极大降低 CPU 使用率</p>\n<blockquote>\n<p>开启方法：</p>\n</blockquote>\n<p><code>query_cache_type</code>: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。</p>\n<p><code>query_cache_type=1</code> 时，也可以在查询语句中关闭查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_NO_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p><code>query_cache_type=2</code> 时，可按需使用查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p>query_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SET GLOBAL query_cache_size &#x3D; 134217728; (128M)</span><br></pre></td></tr></table></figure>\n\n<p>查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW STATUS LIKE &#39;Qcache_hits&#39;; &#x2F;&#x2F; 查看命中次数</span><br></pre></td></tr></table></figure>\n\n<p>表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。</p>\n<blockquote>\n<p>清理缓存</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FLUSH QUERY CACHE; &#x2F;&#x2F; 清理查询缓存内存碎片</span><br><span class=\"line\">RESET QUERY CACHE; &#x2F;&#x2F; 从查询缓存中移除所有查询</span><br><span class=\"line\">FLUSH TABLES; &#x2F;&#x2F; 关闭所有打开的表，同时该操作将会清空查询缓存中的内容</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-使用-memcache-缓存\"><a href=\"#4-使用-memcache-缓存\" class=\"headerlink\" title=\"4. 使用 memcache 缓存\"></a>4. 使用 memcache 缓存</h4><p>对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。</p>\n<p>memcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。</p>\n<p>memcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。</p>\n<blockquote>\n<p>工作流程：</p>\n</blockquote>\n<p>先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。</p>\n<blockquote>\n<p>常用方法：</p>\n</blockquote>\n<ul>\n<li>获取：get(key)</li>\n<li>设置：set(key, val, expire)</li>\n<li>删除：delete(key)</li>\n</ul>\n<blockquote>\n<p>通用缓存机制：</p>\n</blockquote>\n<p>用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。</p>\n<h4 id=\"5-使用-Redis-缓存\"><a href=\"#5-使用-Redis-缓存\" class=\"headerlink\" title=\"5. 使用 Redis 缓存\"></a>5. 使用 Redis 缓存</h4><p>与 memcache 的区别</p>\n<ul>\n<li>性能相差不大</li>\n<li>Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法</li>\n<li>Redis 依赖客户端来实现分布式读写</li>\n<li>memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。</li>\n<li>memcache 不支持持久化，通常做缓存，提升性能；</li>\n<li>memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。</li>\n<li>Redis 支持多种类型的数据类型</li>\n<li>Redis 常用于数据量较小的高性能操作和运算上</li>\n<li>memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能</li>\n</ul>\n<h4 id=\"6-其他数据缓存\"><a href=\"#6-其他数据缓存\" class=\"headerlink\" title=\"6. 其他数据缓存\"></a>6. 其他数据缓存</h4><p>Session：尽量存到 memcache 或 Redis 里</p>\n","site":{"data":{}},"excerpt":"<h3 id=\"数据库缓存层优化\"><a href=\"#数据库缓存层优化\" class=\"headerlink\" title=\"数据库缓存层优化\"></a>数据库缓存层优化</h3><h4 id=\"1-什么是数据库缓存\"><a href=\"#1-什么是数据库缓存\" class=\"headerlink\" title=\"1. 什么是数据库缓存\"></a>1. 什么是数据库缓存</h4><p>MySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。</p>","more":"<p>优势：</p>\n<ul>\n<li>极大地解决数据库服务器的压力</li>\n<li>提高应用数据的响应速度</li>\n</ul>\n<p>常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存</p>\n<h4 id=\"2-为什么要使用数据库缓存\"><a href=\"#2-为什么要使用数据库缓存\" class=\"headerlink\" title=\"2. 为什么要使用数据库缓存\"></a>2. 为什么要使用数据库缓存</h4><p>缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。</p>\n<blockquote>\n<p>流程</p>\n</blockquote>\n<p>用户请求 – 数据查询 – 连接数据库服务器并查询数据 – 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） – 显示给客户端</p>\n<p>用户再次请求或新用户访问 – 数据查询 – 直接从缓存中获取数据 – 显示给客户端</p>\n<p>缓存需要考虑的问题</p>\n<ul>\n<li>缓存方式的选择：尽量使用内存</li>\n<li>缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据</li>\n<li>缓存数据的实时性，不建议同步地修改</li>\n<li>缓存数据的稳定性 </li>\n</ul>\n<h4 id=\"3-使用-MySQL-查询缓存\"><a href=\"#3-使用-MySQL-查询缓存\" class=\"headerlink\" title=\"3. 使用 MySQL 查询缓存\"></a>3. 使用 MySQL 查询缓存</h4><h5 id=\"1-启用-MySQL-查询缓存\"><a href=\"#1-启用-MySQL-查询缓存\" class=\"headerlink\" title=\"1. 启用 MySQL 查询缓存\"></a>1. 启用 MySQL 查询缓存</h5><p>可极大降低 CPU 使用率</p>\n<blockquote>\n<p>开启方法：</p>\n</blockquote>\n<p><code>query_cache_type</code>: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。</p>\n<p><code>query_cache_type=1</code> 时，也可以在查询语句中关闭查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_NO_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p><code>query_cache_type=2</code> 时，可按需使用查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p>query_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SET GLOBAL query_cache_size &#x3D; 134217728; (128M)</span><br></pre></td></tr></table></figure>\n\n<p>查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW STATUS LIKE &#39;Qcache_hits&#39;; &#x2F;&#x2F; 查看命中次数</span><br></pre></td></tr></table></figure>\n\n<p>表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。</p>\n<blockquote>\n<p>清理缓存</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FLUSH QUERY CACHE; &#x2F;&#x2F; 清理查询缓存内存碎片</span><br><span class=\"line\">RESET QUERY CACHE; &#x2F;&#x2F; 从查询缓存中移除所有查询</span><br><span class=\"line\">FLUSH TABLES; &#x2F;&#x2F; 关闭所有打开的表，同时该操作将会清空查询缓存中的内容</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-使用-memcache-缓存\"><a href=\"#4-使用-memcache-缓存\" class=\"headerlink\" title=\"4. 使用 memcache 缓存\"></a>4. 使用 memcache 缓存</h4><p>对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。</p>\n<p>memcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。</p>\n<p>memcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。</p>\n<blockquote>\n<p>工作流程：</p>\n</blockquote>\n<p>先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。</p>\n<blockquote>\n<p>常用方法：</p>\n</blockquote>\n<ul>\n<li>获取：get(key)</li>\n<li>设置：set(key, val, expire)</li>\n<li>删除：delete(key)</li>\n</ul>\n<blockquote>\n<p>通用缓存机制：</p>\n</blockquote>\n<p>用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。</p>\n<h4 id=\"5-使用-Redis-缓存\"><a href=\"#5-使用-Redis-缓存\" class=\"headerlink\" title=\"5. 使用 Redis 缓存\"></a>5. 使用 Redis 缓存</h4><p>与 memcache 的区别</p>\n<ul>\n<li>性能相差不大</li>\n<li>Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法</li>\n<li>Redis 依赖客户端来实现分布式读写</li>\n<li>memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。</li>\n<li>memcache 不支持持久化，通常做缓存，提升性能；</li>\n<li>memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。</li>\n<li>Redis 支持多种类型的数据类型</li>\n<li>Redis 常用于数据量较小的高性能操作和运算上</li>\n<li>memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能</li>\n</ul>\n<h4 id=\"6-其他数据缓存\"><a href=\"#6-其他数据缓存\" class=\"headerlink\" title=\"6. 其他数据缓存\"></a>6. 其他数据缓存</h4><p>Session：尽量存到 memcache 或 Redis 里</p>"},{"title":"高并发大流量解决方案 9 数据层的优化","date":"2018-02-15T08:35:02.000Z","_content":"\n### 数据库缓存层优化\n\n#### 1. 什么是数据库缓存\n\nMySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。\n\n<!-- more -->\n\n优势：\n\n- 极大地解决数据库服务器的压力\n- 提高应用数据的响应速度\n\n常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存\n\n#### 2. 为什么要使用数据库缓存\n\n缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。\n\n> 流程\n\n用户请求 -- 数据查询 -- 连接数据库服务器并查询数据 -- 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） -- 显示给客户端\n\n用户再次请求或新用户访问 -- 数据查询 -- 直接从缓存中获取数据 -- 显示给客户端\n\n缓存需要考虑的问题\n\n- 缓存方式的选择：尽量使用内存\n- 缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据\n- 缓存数据的实时性，不建议同步地修改\n- 缓存数据的稳定性 \n\n#### 3. 使用 MySQL 查询缓存\n\n##### 1. 启用 MySQL 查询缓存\n\n可极大降低 CPU 使用率\n\n> 开启方法：\n\n`query_cache_type`: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。\n\n`query_cache_type=1` 时，也可以在查询语句中关闭查询缓存\n```\nSELECT SQL_NO_CACHE * FROM my_table WHERE condition;\n```\n\n`query_cache_type=2` 时，可按需使用查询缓存\n\n```\nSELECT SQL_CACHE * FROM my_table WHERE condition;\n```\n\nquery_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。\n\n```\nSET GLOBAL query_cache_size = 134217728; (128M)\n```\n\n查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存\n\n```\nSHOW STATUS LIKE 'Qcache_hits'; // 查看命中次数\n```\n\n表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。\n\n> 清理缓存\n\n```\nFLUSH QUERY CACHE; // 清理查询缓存内存碎片\nRESET QUERY CACHE; // 从查询缓存中移除所有查询\nFLUSH TABLES; // 关闭所有打开的表，同时该操作将会清空查询缓存中的内容\n```\n\n#### 4. 使用 memcache 缓存\n\n对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。\n\nmemcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。\n\nmemcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。\n\n> 工作流程：\n\n先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。\n\n> 常用方法：\n\n- 获取：get(key)\n- 设置：set(key, val, expire)\n- 删除：delete(key)\n\n> 通用缓存机制：\n\n用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。\n\n#### 5. 使用 Redis 缓存\n\n与 memcache 的区别\n\n- 性能相差不大\n- Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法\n- Redis 依赖客户端来实现分布式读写\n- memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。\n- memcache 不支持持久化，通常做缓存，提升性能；\n- memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。\n- Redis 支持多种类型的数据类型\n- Redis 常用于数据量较小的高性能操作和运算上\n- memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能","source":"_posts/高并发大流量解决方案-9-数据层的优化.md","raw":"---\ntitle: 高并发大流量解决方案 9 数据层的优化\ndate: 2018-02-15 16:35:02\ntags: 高并发\n---\n\n### 数据库缓存层优化\n\n#### 1. 什么是数据库缓存\n\nMySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。\n\n<!-- more -->\n\n优势：\n\n- 极大地解决数据库服务器的压力\n- 提高应用数据的响应速度\n\n常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存\n\n#### 2. 为什么要使用数据库缓存\n\n缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。\n\n> 流程\n\n用户请求 -- 数据查询 -- 连接数据库服务器并查询数据 -- 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） -- 显示给客户端\n\n用户再次请求或新用户访问 -- 数据查询 -- 直接从缓存中获取数据 -- 显示给客户端\n\n缓存需要考虑的问题\n\n- 缓存方式的选择：尽量使用内存\n- 缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据\n- 缓存数据的实时性，不建议同步地修改\n- 缓存数据的稳定性 \n\n#### 3. 使用 MySQL 查询缓存\n\n##### 1. 启用 MySQL 查询缓存\n\n可极大降低 CPU 使用率\n\n> 开启方法：\n\n`query_cache_type`: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。\n\n`query_cache_type=1` 时，也可以在查询语句中关闭查询缓存\n```\nSELECT SQL_NO_CACHE * FROM my_table WHERE condition;\n```\n\n`query_cache_type=2` 时，可按需使用查询缓存\n\n```\nSELECT SQL_CACHE * FROM my_table WHERE condition;\n```\n\nquery_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。\n\n```\nSET GLOBAL query_cache_size = 134217728; (128M)\n```\n\n查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存\n\n```\nSHOW STATUS LIKE 'Qcache_hits'; // 查看命中次数\n```\n\n表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。\n\n> 清理缓存\n\n```\nFLUSH QUERY CACHE; // 清理查询缓存内存碎片\nRESET QUERY CACHE; // 从查询缓存中移除所有查询\nFLUSH TABLES; // 关闭所有打开的表，同时该操作将会清空查询缓存中的内容\n```\n\n#### 4. 使用 memcache 缓存\n\n对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。\n\nmemcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。\n\nmemcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。\n\n> 工作流程：\n\n先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。\n\n> 常用方法：\n\n- 获取：get(key)\n- 设置：set(key, val, expire)\n- 删除：delete(key)\n\n> 通用缓存机制：\n\n用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。\n\n#### 5. 使用 Redis 缓存\n\n与 memcache 的区别\n\n- 性能相差不大\n- Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法\n- Redis 依赖客户端来实现分布式读写\n- memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。\n- memcache 不支持持久化，通常做缓存，提升性能；\n- memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。\n- Redis 支持多种类型的数据类型\n- Redis 常用于数据量较小的高性能操作和运算上\n- memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能","slug":"高并发大流量解决方案-9-数据层的优化","published":1,"updated":"2020-09-11T01:04:35.062Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzbb006z6wo1cjycbzqr","content":"<h3 id=\"数据库缓存层优化\"><a href=\"#数据库缓存层优化\" class=\"headerlink\" title=\"数据库缓存层优化\"></a>数据库缓存层优化</h3><h4 id=\"1-什么是数据库缓存\"><a href=\"#1-什么是数据库缓存\" class=\"headerlink\" title=\"1. 什么是数据库缓存\"></a>1. 什么是数据库缓存</h4><p>MySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。</p>\n<a id=\"more\"></a>\n\n<p>优势：</p>\n<ul>\n<li>极大地解决数据库服务器的压力</li>\n<li>提高应用数据的响应速度</li>\n</ul>\n<p>常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存</p>\n<h4 id=\"2-为什么要使用数据库缓存\"><a href=\"#2-为什么要使用数据库缓存\" class=\"headerlink\" title=\"2. 为什么要使用数据库缓存\"></a>2. 为什么要使用数据库缓存</h4><p>缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。</p>\n<blockquote>\n<p>流程</p>\n</blockquote>\n<p>用户请求 – 数据查询 – 连接数据库服务器并查询数据 – 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） – 显示给客户端</p>\n<p>用户再次请求或新用户访问 – 数据查询 – 直接从缓存中获取数据 – 显示给客户端</p>\n<p>缓存需要考虑的问题</p>\n<ul>\n<li>缓存方式的选择：尽量使用内存</li>\n<li>缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据</li>\n<li>缓存数据的实时性，不建议同步地修改</li>\n<li>缓存数据的稳定性 </li>\n</ul>\n<h4 id=\"3-使用-MySQL-查询缓存\"><a href=\"#3-使用-MySQL-查询缓存\" class=\"headerlink\" title=\"3. 使用 MySQL 查询缓存\"></a>3. 使用 MySQL 查询缓存</h4><h5 id=\"1-启用-MySQL-查询缓存\"><a href=\"#1-启用-MySQL-查询缓存\" class=\"headerlink\" title=\"1. 启用 MySQL 查询缓存\"></a>1. 启用 MySQL 查询缓存</h5><p>可极大降低 CPU 使用率</p>\n<blockquote>\n<p>开启方法：</p>\n</blockquote>\n<p><code>query_cache_type</code>: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。</p>\n<p><code>query_cache_type=1</code> 时，也可以在查询语句中关闭查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_NO_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p><code>query_cache_type=2</code> 时，可按需使用查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p>query_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SET GLOBAL query_cache_size &#x3D; 134217728; (128M)</span><br></pre></td></tr></table></figure>\n\n<p>查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW STATUS LIKE &#39;Qcache_hits&#39;; &#x2F;&#x2F; 查看命中次数</span><br></pre></td></tr></table></figure>\n\n<p>表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。</p>\n<blockquote>\n<p>清理缓存</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FLUSH QUERY CACHE; &#x2F;&#x2F; 清理查询缓存内存碎片</span><br><span class=\"line\">RESET QUERY CACHE; &#x2F;&#x2F; 从查询缓存中移除所有查询</span><br><span class=\"line\">FLUSH TABLES; &#x2F;&#x2F; 关闭所有打开的表，同时该操作将会清空查询缓存中的内容</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-使用-memcache-缓存\"><a href=\"#4-使用-memcache-缓存\" class=\"headerlink\" title=\"4. 使用 memcache 缓存\"></a>4. 使用 memcache 缓存</h4><p>对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。</p>\n<p>memcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。</p>\n<p>memcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。</p>\n<blockquote>\n<p>工作流程：</p>\n</blockquote>\n<p>先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。</p>\n<blockquote>\n<p>常用方法：</p>\n</blockquote>\n<ul>\n<li>获取：get(key)</li>\n<li>设置：set(key, val, expire)</li>\n<li>删除：delete(key)</li>\n</ul>\n<blockquote>\n<p>通用缓存机制：</p>\n</blockquote>\n<p>用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。</p>\n<h4 id=\"5-使用-Redis-缓存\"><a href=\"#5-使用-Redis-缓存\" class=\"headerlink\" title=\"5. 使用 Redis 缓存\"></a>5. 使用 Redis 缓存</h4><p>与 memcache 的区别</p>\n<ul>\n<li>性能相差不大</li>\n<li>Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法</li>\n<li>Redis 依赖客户端来实现分布式读写</li>\n<li>memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。</li>\n<li>memcache 不支持持久化，通常做缓存，提升性能；</li>\n<li>memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。</li>\n<li>Redis 支持多种类型的数据类型</li>\n<li>Redis 常用于数据量较小的高性能操作和运算上</li>\n<li>memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能</li>\n</ul>\n","site":{"data":{}},"excerpt":"<h3 id=\"数据库缓存层优化\"><a href=\"#数据库缓存层优化\" class=\"headerlink\" title=\"数据库缓存层优化\"></a>数据库缓存层优化</h3><h4 id=\"1-什么是数据库缓存\"><a href=\"#1-什么是数据库缓存\" class=\"headerlink\" title=\"1. 什么是数据库缓存\"></a>1. 什么是数据库缓存</h4><p>MySQL 等一些常见的关系型数据库的数据都存储在磁盘当中，在高并发场景下，业务应用对 MySQL 产生的增删改查操作造成巨大的 I/O 开销和查询压力，这无疑对数据库和服务器都是一种巨大的压力，为了解决此类问题，缓存数据的概念应运而生。</p>","more":"<p>优势：</p>\n<ul>\n<li>极大地解决数据库服务器的压力</li>\n<li>提高应用数据的响应速度</li>\n</ul>\n<p>常见的缓存形式：<b style=\"color:red;\">内存缓存（尽量使用）</b>、文件缓存</p>\n<h4 id=\"2-为什么要使用数据库缓存\"><a href=\"#2-为什么要使用数据库缓存\" class=\"headerlink\" title=\"2. 为什么要使用数据库缓存\"></a>2. 为什么要使用数据库缓存</h4><p>缓存数据是为了让客户端很少甚至不访问数据库服务器进行数据的查询，高并发下，能最大程度地降低对数据库服务器的访问压力。</p>\n<blockquote>\n<p>流程</p>\n</blockquote>\n<p>用户请求 – 数据查询 – 连接数据库服务器并查询数据 – 将数据缓存起来（HTML、<b style='color:red'>内存</b>、json、序列化） – 显示给客户端</p>\n<p>用户再次请求或新用户访问 – 数据查询 – 直接从缓存中获取数据 – 显示给客户端</p>\n<p>缓存需要考虑的问题</p>\n<ul>\n<li>缓存方式的选择：尽量使用内存</li>\n<li>缓存场景的选择：哪些数据适合使用缓存，如不经常修改的数据</li>\n<li>缓存数据的实时性，不建议同步地修改</li>\n<li>缓存数据的稳定性 </li>\n</ul>\n<h4 id=\"3-使用-MySQL-查询缓存\"><a href=\"#3-使用-MySQL-查询缓存\" class=\"headerlink\" title=\"3. 使用 MySQL 查询缓存\"></a>3. 使用 MySQL 查询缓存</h4><h5 id=\"1-启用-MySQL-查询缓存\"><a href=\"#1-启用-MySQL-查询缓存\" class=\"headerlink\" title=\"1. 启用 MySQL 查询缓存\"></a>1. 启用 MySQL 查询缓存</h5><p>可极大降低 CPU 使用率</p>\n<blockquote>\n<p>开启方法：</p>\n</blockquote>\n<p><code>query_cache_type</code>: 查询缓存类型，有 0，1，2 三个值。0 表示不使用查询缓存；1 表示始终使用查询缓存；2 表示按需使用查询缓存。</p>\n<p><code>query_cache_type=1</code> 时，也可以在查询语句中关闭查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_NO_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p><code>query_cache_type=2</code> 时，可按需使用查询缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT SQL_CACHE * FROM my_table WHERE condition;</span><br></pre></td></tr></table></figure>\n\n<p>query_cache_size: 默认情况下，值为0，表示为查询缓存预留的内存为 0，则无法使用查询缓存。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SET GLOBAL query_cache_size &#x3D; 134217728; (128M)</span><br></pre></td></tr></table></figure>\n\n<p>查询缓存可以看做是 SQL 文本和查询结果的映射，第二次查询的 SQL 和第一次查询的 SQL 完全相同（多一个空格都不行），则会使用缓存</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SHOW STATUS LIKE &#39;Qcache_hits&#39;; &#x2F;&#x2F; 查看命中次数</span><br></pre></td></tr></table></figure>\n\n<p>表的结构或数据发送改变时，查询缓存中的数据不再有效（即时失效），如果数据表的写入或修改频率比较高，查询缓存就失去意义了。</p>\n<blockquote>\n<p>清理缓存</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FLUSH QUERY CACHE; &#x2F;&#x2F; 清理查询缓存内存碎片</span><br><span class=\"line\">RESET QUERY CACHE; &#x2F;&#x2F; 从查询缓存中移除所有查询</span><br><span class=\"line\">FLUSH TABLES; &#x2F;&#x2F; 关闭所有打开的表，同时该操作将会清空查询缓存中的内容</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-使用-memcache-缓存\"><a href=\"#4-使用-memcache-缓存\" class=\"headerlink\" title=\"4. 使用 memcache 缓存\"></a>4. 使用 memcache 缓存</h4><p>对于大型站点，如果没有中间缓存层，当流量打入数据库层时，即便之前的几层为我们挡住一部分流量，但是在大并发的情况下，还是会有大量请求涌入数据库层，这样对于数据库服务器的压力冲击很大，响应速度也会下降，因此添加中间缓存层很有必要。</p>\n<p>memcache 是一套分布式的高速缓存系统，目前被许多网站使用以提升网站的访问速度，尤其对于一些大型的、需要频繁访问数据库的网站访问速度提升效果十分显著。</p>\n<p>memcache 是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个统一的巨大的 hash 表，它能够用来存储各种格式的数据，包括图像、视频、文件以及数据库检索的结果等。简单说就是将数据调用到内存，然后从内存中读取，从而大大提高读取速度。</p>\n<blockquote>\n<p>工作流程：</p>\n</blockquote>\n<p>先检查客户端的请求数据是否在 memcached 中，如有，直接把请求数据返回，不再对数据库进行任何操作；如果请求的数据不在 memcached 中，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中。</p>\n<blockquote>\n<p>常用方法：</p>\n</blockquote>\n<ul>\n<li>获取：get(key)</li>\n<li>设置：set(key, val, expire)</li>\n<li>删除：delete(key)</li>\n</ul>\n<blockquote>\n<p>通用缓存机制：</p>\n</blockquote>\n<p>用查询的方法名 + 参数作为查询时的 key value 对应的 key 值。</p>\n<h4 id=\"5-使用-Redis-缓存\"><a href=\"#5-使用-Redis-缓存\" class=\"headerlink\" title=\"5. 使用 Redis 缓存\"></a>5. 使用 Redis 缓存</h4><p>与 memcache 的区别</p>\n<ul>\n<li>性能相差不大</li>\n<li>Redis 在 2.0 版本后增加了自己的 VM 特性，突破物理内存的限制，memcache 可以修改最大可用内存，采用 LRU（Least recently used，最近最少使用）算法</li>\n<li>Redis 依赖客户端来实现分布式读写</li>\n<li>memcache 本身没有数据冗余机制，Redis 支持（快照、AOF），依赖快照进行持久化，AOF 增强了可靠性的同时，对性能有所影响。</li>\n<li>memcache 不支持持久化，通常做缓存，提升性能；</li>\n<li>memcache 在并发场景下，用 cas 保证一致性，Redis 事务支持比较弱，只能保证事务中的每个操作连续执行。</li>\n<li>Redis 支持多种类型的数据类型</li>\n<li>Redis 常用于数据量较小的高性能操作和运算上</li>\n<li>memcache 用于在动态系统中减少数据库负载，提升性能；适合做缓存，提升性能</li>\n</ul>"},{"title":"Vagrant-打造PHP开发环境","date":"2017-04-20T16:00:00.000Z","_content":"\n![](http://upload-images.jianshu.io/upload_images/693141-dcab921466013b5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n本文是慕课网 [《vagrant打造跨平台可移动的开发环境》](http://www.imooc.com/learn/805)的学习记录。\n\n<!--more-->\n\nThinkPHP 和 Apache 的配置相对麻烦，且很少使用。若没有需求可直接略过这两部分。\n\n## 1. 虚拟机\n优点：\n- 安装多种演示环境；\n- 保证主机快速运行，减少不必要的垃圾安装程序；\n- 避免每次重新安装；\n- 测试不熟悉的应用，随便在虚拟机中安装和删除；\n- 体验不同版本的操作系统。\n****\n## 2. Vagrant\n是构建在虚拟化技术之上的虚拟机运行环境管理工具\n#### 作用：\n- 建立和删除虚拟机\n- 配置虚拟机运行参数\n- 管理虚拟机运行状态\n- 自动化配置和安装开发环境\n\nvagrant 的运行，需要依赖某项具体的**虚拟化技术**（virtualbox，vmvare）\n\n#### 优点：\n- 跨平台 无差异性\n- 可移动 镜像和配置文件相对较小\n- 自动化部署，无需人工参与\n- 面试加分项\n\n- 减少公司人力培训成本\n- 统一开发环境（vagrant+virtualbox+ubuntu）\n\n#### 适用范围\n- 开发环境，不适用线上环境\n- 项目配置比较复杂 （nginx/apache, memcache/redis, php/python/java）配置好的环境可以分发给每一个人，保证环境统一\n\n\n#### 安装步骤\n1. 下载 Virtualbox（VirtualBox-5.1.4-110228-OSX.dmg） \n2. Vagrant（vagrant_1.8.5.dmg）， 安装\n\n****\n### 常用 vagrant 命令\n```\nvagrant box list 查看目前已有的box\nvagrant box add 新增加一个box 需要在下载好的box(基于该box生成)的路径下执行，或者指定box的路径 如 vagrant box add myProject ubuntu16.01.box\nvagrant box remove 删除指定的box\nvagrant init  初始化配置文件 vagrantfile\nvagrant up 启动虚拟机\nvagrant ssh ssh登录虚拟机\nvagrant suspend 挂起虚拟机\nvagrant reload 重启虚拟机\nvagrant halt 关闭虚拟机\nvagrant status 虚拟机状态\nvagrant destroy 删除虚拟机\n```\n\n\n实战\n目标：\n生成一个box\nbox镜像默认配置好 LAMP & LNMP\nYii2，TP5，Laravel 可以直接运行\n****\t\n## 步骤：\n### 1. 初始化并启动虚拟机\n\n- VirtualBox 5.1.8\n下载地址 https://www.virtualbox.org/wiki/Download_Old_Builds_5_1\n\n- Vagrant 1.8.6\n下载地址：https://releases.hashicorp.com/vagrant/1.8.6/\n切记根据自己的操作系统下载，同时分32位和64位\n\n- Windows 额外工作\n>可能需要配置环境变;\n安装Xshell命令行工具;\n注意，一定要开启 VT-x/AMD-V 硬件加速\n\n\n- 下载 ubuntu1404.box\n- 首先运行 vagrant box list 看当前所有的box\n- 然后在ubuntu1404.box 所在的路径执行 vagrant box add ubuntu1404（这个名字随意起） ubuntu1404.box\n- 再次执行 vagrant box list 看是否添加成功\n- 创建一个目录，在该目录中执行 vagrant init ubuntu1404（镜像的名称）\n- 在该目录下就会生成一个名为 Vagrantfile 的配置文件\n- 使用编辑器打开该配置文件，可以看到第15行，box的名称为刚才镜像的名称\n- vagrant up 启动虚拟机，可以在virtualbox客户端看到启动的过程\n- vagrant ssh 进入虚拟机\n\n### 2. 替换源(使用阿里云的镜像，不用翻墙)\n备份\n```sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak```\n\n编辑\n文件内容为：\n```\ndeb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\n```\n\n更新源(**这里卡住了**)\n```sudo apt-get update```\n\n这部分有点坑，反正我能翻墙，不用它了\n\n\n### 3. 安装 nginx\n1. 首先进入虚拟机，查看 nginx 是否可安装\n```apt-cache search nginx```\n2. 安装 nginx\n```sudo apt-get install nginx```\n3. 查看是否安装成功\n```nginx -v```\n4. 测试 nginx 能否得到请求并正确响应\n```curl -I 'http://127.0.0.1'```\n```curl http://www.baidu.com```\n\n### 4. 安装 apache2\n1. 安装 nginx\n```sudo apt-get install apache2```\n3. 查看是否安装成功\n```apache2 -v```\n4. 测试 nginx 能否得到请求并正确响应 必须先停止nginx\n```\nsudo /etc/init.d/nginx stop\ncurl -I 'http://127.0.0.1'\ncurl -I 'http://www.baidu.com'\nsudo /etc/init.d/apache2 start\ncurl -I 'http://127.0.0.1'\n```\n\n### 5. 安装 mysql\n```\nsudo apt-get install mysql-server\nsudo apt-get install mysql-client\nmysql -uroot -p\nselect version();\n```\n\n### 6. 安装 PHP\n```\nsudo apt-get install php5-cli\n```\n\n### 7. 安装 扩展\n```\nsudo apt-get install php5-mcrypt php5-mysql php5-gd\n```\n\n### 8. 安装 apache2 的 PHP 模块\n```\nsudo apt-get install libapache2-mod-php5\n```\n\n### 8. 安装 nginx fastcgi\nfastcgi  fpm 是一个进程池，来管理PHP的进程(cgi)\n```\nsudo apt-get install php5-cgi php5-fpm\n// 查询软件启动状态\nps -ef | grep apache\n```\n\n### 9. 更改端口\napache 和 nginx 默认都是监听 80 端口\n```\n// 更改 Apache 的监听端口为8888\nsudo vim /etc/apache2/ports.conf \nlisten 8888 保存后重启apache\n```\n这时候，监听的端口不同，两个server就可以同时运行，可以查看启动状态\n\n验证是否可以访问\n```\ncurl -I \"http://127.0.0.1:80\"\ncurl -I \"http://127.0.0.1:8888\"\n```\n按需求来，一般不会两个同时安装。\n\n### 10. 通过浏览器访问虚拟机\n```\n// 挂起虚拟机\nvagrant suspend\n// 打开virtualbox，选中要操作的虚拟机-setting-network-advance-port forwarding\n```\n\n![](http://upload-images.jianshu.io/upload_images/693141-3ae6d25152d5914f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n配置完成后，保存，启动虚拟机。\n\n8888端口，访问的是虚拟机里面的80端口，即nginx\n\n8889端口，访问的是虚拟机里面的8888端口，即Apache\n\n在浏览器中访问虚拟机\n```\n127.0.0.1:8888\n127.0.0.1:8889\n```\n****\n## vagrant 高级功能\n进入当前虚拟机目录， 这样所有操作都是针对当前的虚拟机进行的操作。\n### 端口转发\n上述手动的配置，重启虚拟机之后自动消失。\n\nvagrant每次重启的时候，都会按照自己的配置文件进行设置，所以手动更改的配置无效。\n\n参考官网的示例是最好的学习方式。\n\n修改本虚拟机的配置文件 Vagrantfile\n```\nconfig.vm.network \"forwarded_port\", guest:80 (虚拟机里的端口), host:8888 （主机里的端口）\nconfig.vm.network \"forwarded_port\", guest:8888, host:8889\n```\n保存后重启虚拟机\n\n### 网络设置\n\n#### 1. 公有IP\n公有IP不能创建nfs共享目录\n\nIP段必须和主机（host 自己的电脑，不是虚拟机guest）的IP段一致，且不能与其他IP冲突。\n#### 2. 私有IP\n只能本机和虚拟机之间，以及虚拟机与虚拟机之间进行通讯。一般都使用私有IP\n```\nconfig.vm.network \"private_network\", ip:\"192.168.11.11\"\n```\n这样，可以直接在浏览器中输入IP来访问虚拟机的webserver\n\n### 共享目录\n一般共享代码目录，本地修改可以及时同步到虚拟机调试。\n\nNFS方式\n```\nconfig.vm.synced_folder \"/Users/ZouZhipeng/mooc_vagrant/\", \"/home/www/\" (该目录如果不存在，会自动创建), :nfs => true\n```\n![](http://upload-images.jianshu.io/upload_images/693141-d8da821808b2e649.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![](http://upload-images.jianshu.io/upload_images/693141-1bd408cef572074d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n\n****\n## vagrant 配置 ThinkPHP5\n### 1. 安装git\n```\nsudo apt-get install git\n```\n### 2. 克隆代码\n新建一个目录\n```\ngit clone https://github.com/top-think/think tp5\n```\n切换到tp5目录下，再克隆核心框架仓库\n```\ncd tp5 && git clone https://github.com/top-think/framework thinkphp\n```\n### 3. nginx 配置文件（/etc/nginx/nginx.conf）详解\n下面两行有一个包含的命令\n```\ninclude /etc/nginx/conf.d/*.conf;\ninclude /etc/nginx/sites-enabled/*;\n```\n\n也就是说，所有在conf.d目录下以.conf为后缀的文件，以及所有在sites-enabled目录下的文件，都可以自动加载到nginx的配置文件。这样不会影响到主配置文件。\n\n新建一个配置文件 cd conf.d && sudo touch tp5.conf：\n\n详解版\n```\nserver{ // 所有nginx虚拟机的配置都是以 server 变量开始的\n\tserver_name tp5.zzp.com; // 虚拟机域名\n\troot /home/www/tp5/public; // 代码路径 入口文件地址\n\tindex index.php index.html; // 默认的索引文件\n\tlocation / {  // \n\t\tif (-f $request_filename) { //如果访问的文件存在，直接跳转，不执行这里\n\t\t\tbreak;\n\t\t}\n\t\tif (!-e $request_filename) { // 如果访问的文件不存在 正则表达式（任何内容） 重定向到入口文件，参数为前面的正则表达式$1 last 表示不再走了\n\t\t\trewrite ^/(.*)/$ /index.php/$1 last;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tlocation ~ \\.php { // 任何路径，如果是以.php结尾的，包括前面的index.php\n\t\tset $script $uri;\n\t\tset $path_info \"\";\n\t\tif ($uri ~ \"^(.+\\.php)(/.+)\") { // 如果路由符合这个规则\n\t\t\tset $script $1;\n\t\t\tset $path_info $2;\n\t\t} \n\t\tinclude fastcgi_params; // 包含fastcgi参数\n\t\t// 需手动设置pathInfo类型的路由\n\t\t// 多传递一个参数，并解析出来\n\t\tfastcgi_index index.php?IF_REWRITE=1;\n\t\tfastcgi_param PATH_INFO $path_info;\n\t\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\t\tfastcgi_param SCRIPT_NAME $script;\n\t\tfastcgi_pass 127.0.0.1:9000; // fastcgi 端口\n\t\ttry_files $uri = 404; // 如果文件不存在，直接404\n\t}\n}\n```\n\ncopy版\n```\n    server {\n        charset utf-8;\n        client_max_body_size 128M;\n        listen 80;\n        server_name tp5.imooc.test;\n    \n        root  /home/www/mooc/vagrant/phpmvc/tp5/public;\n        index  index.php;\n    \n        location ~* \\.(eot|otf|ttf|woff)$ {\n            add_header Access-Control-Allow-Origin *;\n        }\n    \n        \n        location / {\n            index    index.html index.php;\n            if ( -f $request_filename) {\n                break;\n            }\n\n            if ( !-e $request_filename) {\n                rewrite ^/(.*)$ /index.php/$1 last;\n                break;\n            }\n        }\n    \n        location ~ \\.php {\n        \tset $script $uri;\n            set $path_info \"\";\n            if ($uri ~ \"^(.+\\.php)(/.+)\") {\n                set $script $1;\n                set $path_info $2;\n            }\n            include   fastcgi_params;\n            fastcgi_index    index.php?IF_REWRITE=1;\n        \tfastcgi_pass   127.0.0.1:9000;\n        \tfastcgi_param    PATH_INFO    $path_info;\n            fastcgi_param    SCRIPT_FILENAME    $document_root$fastcgi_script_name;\n            fastcgi_param    SCRIPT_NAME    $script;\n            try_files $uri =404;\n        }\n    \n    }\n```\n \n在 /etc/hosts 文件中绑定上面配置的域名 其实就是自定义的DNS服务\n```192.168.11.11 tp5.zzp.com```\n\n然后再浏览器中访问，发现报错404。\n\n#### 排错\n排错的方式就是查看日志，首先找到日志存放的位置。主配置文件nginx.conf中可以找到。\n```\n##\n# Logging Settings\n##\naccess_log /var/log/nginx/access.log;\nerror_log /var/log/nginx/error.log;\n```\n首先看访问日志，如果有变化说明访问进来了。\n```\ntail -f /var/log/nginx/access.log\n```\n如果没权限，先修改访问日志的权限为777\n\n再次在浏览器中访问，访问日志有记录。然后查看错误日志。\n```\ntail -f /var/log/nginx/error.log\n```\n同样需要先修改权限。\n\n如果错误为 connection refused，如何排查。\n\n```\ncd /etc/php5/fpm/pool.d\nsudo vim www.conf 搜索listen\n找到\nlisten = /var/run/php5-fpm.sock\n这是监听域模式的方式，改成端口方式进行监听\nlisten = 127.0.0.1：9000 \n端口方式比域模式更加稳定\n修改后重启fpm服务\nsudo service php5-fpm restart\nsudo /etc/init.d/php5-fpm restart 这两行一样\n```\n再次通过浏览器访问，终于通了。\n\n### 配置apache\n```\ncd /etc/apache2\nvim apache2.conf\n打开配置文件，最下面可以看到\n# Include the virtual host configurations:\nIncludeOptional sites-enabled/*.conf\n找到子配置文件的目录\ncd sites-enabled\nsudo touch tp5.conf\n```\n```\n<VirtualHost *:8888> // xml 形式 端口为8888\n\tServerName tp5.zzp.com\n\tDocumentRoot /home/www/tp5/public\n</VirtualHost>\n```\n然后重启apache\n\n浏览器中访问 tp5.zzp.com:8888  返回403错误\n\n#### 解决方式\n看错误日志\n```\nsudo chmod -R 755 /var/log/apache2\ntail -f error.log\nclient denied by server configuration\n一般是Apache的配置错误导致的\nsudo vim /etc/apache2/apache2.conf\n\n<Directory />\n        Options FollowSymLinks\n        AllowOverride None\n        Require all denied // 把这行注释掉即可,然后重启apache\n</Directory>\n```\nTP 的路由解决方式已经非常落后，给webserver 的配置带来了很多麻烦，看看就好。\n\n#### 开启Apache的rewrite功能\n\n```\nsudo a2enmod rewrite\n```\n在Apache的配置文件中还要修改\n\n```\nsudo vim /etc/apache2/apache2.conf\n找到 Directory 的 AllowOverride, 改为All\n```\n\n## 2. vagrant 安装yii2 & Laravel5\n### 1. 下载yii-basic 的压缩包，解压到目标目录\n### 2. 配置nginx运行环境\n```\ncd /etc/nginx/conf.d\nsudo touch yii2.conf\nsudo vim yii2.conf\nsudo service nginx restart\n\nserver{\n    server_name yii.zzp.com;\n    root /home/www/yii/web;\n    index index.php;\n    location / {\n      try_files $uri $uri/ /index.php?$args;\n  }\n    location ~ \\.php$ {\n      include fastcgi_params;\n      fastcgi_pass 127.0.0.1:9000;\n      try_files $uri = 404;\n  }\n}\n\n别忘了 hosts 在浏览器中就可以访问了\n```\n### 3. 配置Apache\n```\ncd /etc/apache2/sites-enabled\nsudo touch yii.conf\nsudo vim yii.conf\n\n<VirtualHost *:8888>\n  ServerName yii.zzp.com\n  DocumentRoot /home/www/yii/web\n</VirtualHost>\n\n重启apache 在浏览器中就可以访问了\n```\n\n### 4. 下载并解压 laravel安装包\n配置基本和yii一致\n```\nserver{\n    server_name laravel.zzp.com;\n    root /home/www/laravel/public;\n    index index.php;\n    location / {\n      try_files $uri $uri/ /index.php?$args;\n  }\n    location ~ \\.php$ {\n      include fastcgi_params;\n      fastcgi_pass 127.0.0.1:9000;\n      try_files $uri = 404;\n  }\n}\n```\n```\n<VirtualHost *:8888>\n  ServerName laravel.zzp.com\n  DocumentRoot /home/www/laravel/public\n</VirtualHost>\n```\n\n## 3. vagrant  虚拟机优化\n### 虚拟机名字 内存和CPU\n修改vagrantfile并重启虚拟机\n```\n  config.vm.provider \"virtualbox\" do |vb|\n  #   # Display the VirtualBox GUI when booting the machine\n  #   vb.gui = true\n  #\n  #   # Customize the amount of memory on the VM:\n      vb.memory = \"1024\"\n      vb.cpus = 2\n      vb.name = \"ubuntu_mooc\"\n  end\n```\n### 虚拟机主机名\n```\nconfig.vm.hostname = \"mooc\"\n```\n查看虚拟机内容 ```free -m```\nCPU ```top``` 再按1查看，q退出\n\n\n### 优化nginx和apache 同步目录的问题 修改后文件可及时同步\n\n![](http://upload-images.jianshu.io/upload_images/693141-368f8373feeaa483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n****\n## 打包分发环境\n### 打包 \n需先关闭虚拟机 vagrant halt\n```\nvagrant package --output xxx.box\nvagrant package --output xxx.box --base 虚拟机名\n```\n### 升级\n老用户：使用Vagrantfile进行升级；\n```\nconfig.vm.provision \"shell\", inline: <<-SHELL\napt-get install -y redis-server (-y 表示强制安装)\nvagrant reload --provision\n```\n新用户：直接重新打包分发给他\n```\nvagrant box add new xxx.box\n新建一个目录\nvagrant box list\nvagrant init new\n```\n\n配置文件里面的vb.gui可以查看虚拟机启动时候的情况，可用于错误调试。\n\n打包的时候最好关闭网络配置\n\n\n\n\n```\n// Vagrantfile 配置文件所有内容\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n  config.vm.box = \"ubuntu1404\"\n  config.vm.hostname = \"mooc\"\n  config.vm.network \"forwarded_port\", guest: 80, host: 8888 ,id: 'nginx'\n  config.vm.network \"forwarded_port\", guest: 8888, host: 8889 ,id: 'apache'\n  config.vm.network \"private_network\", ip: \"192.168.11.11\",auto_config: true\n  config.vm.synced_folder \"/Users/ZouZhipeng/www/mooc_vagrant/\", \"/home/www\", :nfs => true\n  #config.vm.synced_folder \"/Users/vincent/code/\", \"/home/www\", :nfs => true\n\n  config.vm.provider \"virtualbox\" do |vb|\n  #   # Display the VirtualBox GUI when booting the machine\n  #   vb.gui = true\n  #\n  #   # Customize the amount of memory on the VM:\n      vb.memory = \"1024\"\n      vb.cpus = 2\n      vb.name = \"ubuntu_mooc\"\n  end\n\n\n  # Enable provisioning with a shell script. Additional provisioners such as\n  # Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the\n  # documentation for more information about their specific syntax and use.\n  # config.vm.provision \"shell\", inline: <<-SHELL\n  #   apt-get update\n  #   apt-get install -y apache2\n  # SHELL\nend\n```\n\n\n","source":"_posts/Vagrant-打造PHP开发环境.md","raw":"---\ntitle: Vagrant-打造PHP开发环境\ndate: 2017-04-21\ntags: laravel\n---\n\n![](http://upload-images.jianshu.io/upload_images/693141-dcab921466013b5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n本文是慕课网 [《vagrant打造跨平台可移动的开发环境》](http://www.imooc.com/learn/805)的学习记录。\n\n<!--more-->\n\nThinkPHP 和 Apache 的配置相对麻烦，且很少使用。若没有需求可直接略过这两部分。\n\n## 1. 虚拟机\n优点：\n- 安装多种演示环境；\n- 保证主机快速运行，减少不必要的垃圾安装程序；\n- 避免每次重新安装；\n- 测试不熟悉的应用，随便在虚拟机中安装和删除；\n- 体验不同版本的操作系统。\n****\n## 2. Vagrant\n是构建在虚拟化技术之上的虚拟机运行环境管理工具\n#### 作用：\n- 建立和删除虚拟机\n- 配置虚拟机运行参数\n- 管理虚拟机运行状态\n- 自动化配置和安装开发环境\n\nvagrant 的运行，需要依赖某项具体的**虚拟化技术**（virtualbox，vmvare）\n\n#### 优点：\n- 跨平台 无差异性\n- 可移动 镜像和配置文件相对较小\n- 自动化部署，无需人工参与\n- 面试加分项\n\n- 减少公司人力培训成本\n- 统一开发环境（vagrant+virtualbox+ubuntu）\n\n#### 适用范围\n- 开发环境，不适用线上环境\n- 项目配置比较复杂 （nginx/apache, memcache/redis, php/python/java）配置好的环境可以分发给每一个人，保证环境统一\n\n\n#### 安装步骤\n1. 下载 Virtualbox（VirtualBox-5.1.4-110228-OSX.dmg） \n2. Vagrant（vagrant_1.8.5.dmg）， 安装\n\n****\n### 常用 vagrant 命令\n```\nvagrant box list 查看目前已有的box\nvagrant box add 新增加一个box 需要在下载好的box(基于该box生成)的路径下执行，或者指定box的路径 如 vagrant box add myProject ubuntu16.01.box\nvagrant box remove 删除指定的box\nvagrant init  初始化配置文件 vagrantfile\nvagrant up 启动虚拟机\nvagrant ssh ssh登录虚拟机\nvagrant suspend 挂起虚拟机\nvagrant reload 重启虚拟机\nvagrant halt 关闭虚拟机\nvagrant status 虚拟机状态\nvagrant destroy 删除虚拟机\n```\n\n\n实战\n目标：\n生成一个box\nbox镜像默认配置好 LAMP & LNMP\nYii2，TP5，Laravel 可以直接运行\n****\t\n## 步骤：\n### 1. 初始化并启动虚拟机\n\n- VirtualBox 5.1.8\n下载地址 https://www.virtualbox.org/wiki/Download_Old_Builds_5_1\n\n- Vagrant 1.8.6\n下载地址：https://releases.hashicorp.com/vagrant/1.8.6/\n切记根据自己的操作系统下载，同时分32位和64位\n\n- Windows 额外工作\n>可能需要配置环境变;\n安装Xshell命令行工具;\n注意，一定要开启 VT-x/AMD-V 硬件加速\n\n\n- 下载 ubuntu1404.box\n- 首先运行 vagrant box list 看当前所有的box\n- 然后在ubuntu1404.box 所在的路径执行 vagrant box add ubuntu1404（这个名字随意起） ubuntu1404.box\n- 再次执行 vagrant box list 看是否添加成功\n- 创建一个目录，在该目录中执行 vagrant init ubuntu1404（镜像的名称）\n- 在该目录下就会生成一个名为 Vagrantfile 的配置文件\n- 使用编辑器打开该配置文件，可以看到第15行，box的名称为刚才镜像的名称\n- vagrant up 启动虚拟机，可以在virtualbox客户端看到启动的过程\n- vagrant ssh 进入虚拟机\n\n### 2. 替换源(使用阿里云的镜像，不用翻墙)\n备份\n```sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak```\n\n编辑\n文件内容为：\n```\ndeb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse\n```\n\n更新源(**这里卡住了**)\n```sudo apt-get update```\n\n这部分有点坑，反正我能翻墙，不用它了\n\n\n### 3. 安装 nginx\n1. 首先进入虚拟机，查看 nginx 是否可安装\n```apt-cache search nginx```\n2. 安装 nginx\n```sudo apt-get install nginx```\n3. 查看是否安装成功\n```nginx -v```\n4. 测试 nginx 能否得到请求并正确响应\n```curl -I 'http://127.0.0.1'```\n```curl http://www.baidu.com```\n\n### 4. 安装 apache2\n1. 安装 nginx\n```sudo apt-get install apache2```\n3. 查看是否安装成功\n```apache2 -v```\n4. 测试 nginx 能否得到请求并正确响应 必须先停止nginx\n```\nsudo /etc/init.d/nginx stop\ncurl -I 'http://127.0.0.1'\ncurl -I 'http://www.baidu.com'\nsudo /etc/init.d/apache2 start\ncurl -I 'http://127.0.0.1'\n```\n\n### 5. 安装 mysql\n```\nsudo apt-get install mysql-server\nsudo apt-get install mysql-client\nmysql -uroot -p\nselect version();\n```\n\n### 6. 安装 PHP\n```\nsudo apt-get install php5-cli\n```\n\n### 7. 安装 扩展\n```\nsudo apt-get install php5-mcrypt php5-mysql php5-gd\n```\n\n### 8. 安装 apache2 的 PHP 模块\n```\nsudo apt-get install libapache2-mod-php5\n```\n\n### 8. 安装 nginx fastcgi\nfastcgi  fpm 是一个进程池，来管理PHP的进程(cgi)\n```\nsudo apt-get install php5-cgi php5-fpm\n// 查询软件启动状态\nps -ef | grep apache\n```\n\n### 9. 更改端口\napache 和 nginx 默认都是监听 80 端口\n```\n// 更改 Apache 的监听端口为8888\nsudo vim /etc/apache2/ports.conf \nlisten 8888 保存后重启apache\n```\n这时候，监听的端口不同，两个server就可以同时运行，可以查看启动状态\n\n验证是否可以访问\n```\ncurl -I \"http://127.0.0.1:80\"\ncurl -I \"http://127.0.0.1:8888\"\n```\n按需求来，一般不会两个同时安装。\n\n### 10. 通过浏览器访问虚拟机\n```\n// 挂起虚拟机\nvagrant suspend\n// 打开virtualbox，选中要操作的虚拟机-setting-network-advance-port forwarding\n```\n\n![](http://upload-images.jianshu.io/upload_images/693141-3ae6d25152d5914f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n配置完成后，保存，启动虚拟机。\n\n8888端口，访问的是虚拟机里面的80端口，即nginx\n\n8889端口，访问的是虚拟机里面的8888端口，即Apache\n\n在浏览器中访问虚拟机\n```\n127.0.0.1:8888\n127.0.0.1:8889\n```\n****\n## vagrant 高级功能\n进入当前虚拟机目录， 这样所有操作都是针对当前的虚拟机进行的操作。\n### 端口转发\n上述手动的配置，重启虚拟机之后自动消失。\n\nvagrant每次重启的时候，都会按照自己的配置文件进行设置，所以手动更改的配置无效。\n\n参考官网的示例是最好的学习方式。\n\n修改本虚拟机的配置文件 Vagrantfile\n```\nconfig.vm.network \"forwarded_port\", guest:80 (虚拟机里的端口), host:8888 （主机里的端口）\nconfig.vm.network \"forwarded_port\", guest:8888, host:8889\n```\n保存后重启虚拟机\n\n### 网络设置\n\n#### 1. 公有IP\n公有IP不能创建nfs共享目录\n\nIP段必须和主机（host 自己的电脑，不是虚拟机guest）的IP段一致，且不能与其他IP冲突。\n#### 2. 私有IP\n只能本机和虚拟机之间，以及虚拟机与虚拟机之间进行通讯。一般都使用私有IP\n```\nconfig.vm.network \"private_network\", ip:\"192.168.11.11\"\n```\n这样，可以直接在浏览器中输入IP来访问虚拟机的webserver\n\n### 共享目录\n一般共享代码目录，本地修改可以及时同步到虚拟机调试。\n\nNFS方式\n```\nconfig.vm.synced_folder \"/Users/ZouZhipeng/mooc_vagrant/\", \"/home/www/\" (该目录如果不存在，会自动创建), :nfs => true\n```\n![](http://upload-images.jianshu.io/upload_images/693141-d8da821808b2e649.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n![](http://upload-images.jianshu.io/upload_images/693141-1bd408cef572074d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n\n\n****\n## vagrant 配置 ThinkPHP5\n### 1. 安装git\n```\nsudo apt-get install git\n```\n### 2. 克隆代码\n新建一个目录\n```\ngit clone https://github.com/top-think/think tp5\n```\n切换到tp5目录下，再克隆核心框架仓库\n```\ncd tp5 && git clone https://github.com/top-think/framework thinkphp\n```\n### 3. nginx 配置文件（/etc/nginx/nginx.conf）详解\n下面两行有一个包含的命令\n```\ninclude /etc/nginx/conf.d/*.conf;\ninclude /etc/nginx/sites-enabled/*;\n```\n\n也就是说，所有在conf.d目录下以.conf为后缀的文件，以及所有在sites-enabled目录下的文件，都可以自动加载到nginx的配置文件。这样不会影响到主配置文件。\n\n新建一个配置文件 cd conf.d && sudo touch tp5.conf：\n\n详解版\n```\nserver{ // 所有nginx虚拟机的配置都是以 server 变量开始的\n\tserver_name tp5.zzp.com; // 虚拟机域名\n\troot /home/www/tp5/public; // 代码路径 入口文件地址\n\tindex index.php index.html; // 默认的索引文件\n\tlocation / {  // \n\t\tif (-f $request_filename) { //如果访问的文件存在，直接跳转，不执行这里\n\t\t\tbreak;\n\t\t}\n\t\tif (!-e $request_filename) { // 如果访问的文件不存在 正则表达式（任何内容） 重定向到入口文件，参数为前面的正则表达式$1 last 表示不再走了\n\t\t\trewrite ^/(.*)/$ /index.php/$1 last;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tlocation ~ \\.php { // 任何路径，如果是以.php结尾的，包括前面的index.php\n\t\tset $script $uri;\n\t\tset $path_info \"\";\n\t\tif ($uri ~ \"^(.+\\.php)(/.+)\") { // 如果路由符合这个规则\n\t\t\tset $script $1;\n\t\t\tset $path_info $2;\n\t\t} \n\t\tinclude fastcgi_params; // 包含fastcgi参数\n\t\t// 需手动设置pathInfo类型的路由\n\t\t// 多传递一个参数，并解析出来\n\t\tfastcgi_index index.php?IF_REWRITE=1;\n\t\tfastcgi_param PATH_INFO $path_info;\n\t\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n\t\tfastcgi_param SCRIPT_NAME $script;\n\t\tfastcgi_pass 127.0.0.1:9000; // fastcgi 端口\n\t\ttry_files $uri = 404; // 如果文件不存在，直接404\n\t}\n}\n```\n\ncopy版\n```\n    server {\n        charset utf-8;\n        client_max_body_size 128M;\n        listen 80;\n        server_name tp5.imooc.test;\n    \n        root  /home/www/mooc/vagrant/phpmvc/tp5/public;\n        index  index.php;\n    \n        location ~* \\.(eot|otf|ttf|woff)$ {\n            add_header Access-Control-Allow-Origin *;\n        }\n    \n        \n        location / {\n            index    index.html index.php;\n            if ( -f $request_filename) {\n                break;\n            }\n\n            if ( !-e $request_filename) {\n                rewrite ^/(.*)$ /index.php/$1 last;\n                break;\n            }\n        }\n    \n        location ~ \\.php {\n        \tset $script $uri;\n            set $path_info \"\";\n            if ($uri ~ \"^(.+\\.php)(/.+)\") {\n                set $script $1;\n                set $path_info $2;\n            }\n            include   fastcgi_params;\n            fastcgi_index    index.php?IF_REWRITE=1;\n        \tfastcgi_pass   127.0.0.1:9000;\n        \tfastcgi_param    PATH_INFO    $path_info;\n            fastcgi_param    SCRIPT_FILENAME    $document_root$fastcgi_script_name;\n            fastcgi_param    SCRIPT_NAME    $script;\n            try_files $uri =404;\n        }\n    \n    }\n```\n \n在 /etc/hosts 文件中绑定上面配置的域名 其实就是自定义的DNS服务\n```192.168.11.11 tp5.zzp.com```\n\n然后再浏览器中访问，发现报错404。\n\n#### 排错\n排错的方式就是查看日志，首先找到日志存放的位置。主配置文件nginx.conf中可以找到。\n```\n##\n# Logging Settings\n##\naccess_log /var/log/nginx/access.log;\nerror_log /var/log/nginx/error.log;\n```\n首先看访问日志，如果有变化说明访问进来了。\n```\ntail -f /var/log/nginx/access.log\n```\n如果没权限，先修改访问日志的权限为777\n\n再次在浏览器中访问，访问日志有记录。然后查看错误日志。\n```\ntail -f /var/log/nginx/error.log\n```\n同样需要先修改权限。\n\n如果错误为 connection refused，如何排查。\n\n```\ncd /etc/php5/fpm/pool.d\nsudo vim www.conf 搜索listen\n找到\nlisten = /var/run/php5-fpm.sock\n这是监听域模式的方式，改成端口方式进行监听\nlisten = 127.0.0.1：9000 \n端口方式比域模式更加稳定\n修改后重启fpm服务\nsudo service php5-fpm restart\nsudo /etc/init.d/php5-fpm restart 这两行一样\n```\n再次通过浏览器访问，终于通了。\n\n### 配置apache\n```\ncd /etc/apache2\nvim apache2.conf\n打开配置文件，最下面可以看到\n# Include the virtual host configurations:\nIncludeOptional sites-enabled/*.conf\n找到子配置文件的目录\ncd sites-enabled\nsudo touch tp5.conf\n```\n```\n<VirtualHost *:8888> // xml 形式 端口为8888\n\tServerName tp5.zzp.com\n\tDocumentRoot /home/www/tp5/public\n</VirtualHost>\n```\n然后重启apache\n\n浏览器中访问 tp5.zzp.com:8888  返回403错误\n\n#### 解决方式\n看错误日志\n```\nsudo chmod -R 755 /var/log/apache2\ntail -f error.log\nclient denied by server configuration\n一般是Apache的配置错误导致的\nsudo vim /etc/apache2/apache2.conf\n\n<Directory />\n        Options FollowSymLinks\n        AllowOverride None\n        Require all denied // 把这行注释掉即可,然后重启apache\n</Directory>\n```\nTP 的路由解决方式已经非常落后，给webserver 的配置带来了很多麻烦，看看就好。\n\n#### 开启Apache的rewrite功能\n\n```\nsudo a2enmod rewrite\n```\n在Apache的配置文件中还要修改\n\n```\nsudo vim /etc/apache2/apache2.conf\n找到 Directory 的 AllowOverride, 改为All\n```\n\n## 2. vagrant 安装yii2 & Laravel5\n### 1. 下载yii-basic 的压缩包，解压到目标目录\n### 2. 配置nginx运行环境\n```\ncd /etc/nginx/conf.d\nsudo touch yii2.conf\nsudo vim yii2.conf\nsudo service nginx restart\n\nserver{\n    server_name yii.zzp.com;\n    root /home/www/yii/web;\n    index index.php;\n    location / {\n      try_files $uri $uri/ /index.php?$args;\n  }\n    location ~ \\.php$ {\n      include fastcgi_params;\n      fastcgi_pass 127.0.0.1:9000;\n      try_files $uri = 404;\n  }\n}\n\n别忘了 hosts 在浏览器中就可以访问了\n```\n### 3. 配置Apache\n```\ncd /etc/apache2/sites-enabled\nsudo touch yii.conf\nsudo vim yii.conf\n\n<VirtualHost *:8888>\n  ServerName yii.zzp.com\n  DocumentRoot /home/www/yii/web\n</VirtualHost>\n\n重启apache 在浏览器中就可以访问了\n```\n\n### 4. 下载并解压 laravel安装包\n配置基本和yii一致\n```\nserver{\n    server_name laravel.zzp.com;\n    root /home/www/laravel/public;\n    index index.php;\n    location / {\n      try_files $uri $uri/ /index.php?$args;\n  }\n    location ~ \\.php$ {\n      include fastcgi_params;\n      fastcgi_pass 127.0.0.1:9000;\n      try_files $uri = 404;\n  }\n}\n```\n```\n<VirtualHost *:8888>\n  ServerName laravel.zzp.com\n  DocumentRoot /home/www/laravel/public\n</VirtualHost>\n```\n\n## 3. vagrant  虚拟机优化\n### 虚拟机名字 内存和CPU\n修改vagrantfile并重启虚拟机\n```\n  config.vm.provider \"virtualbox\" do |vb|\n  #   # Display the VirtualBox GUI when booting the machine\n  #   vb.gui = true\n  #\n  #   # Customize the amount of memory on the VM:\n      vb.memory = \"1024\"\n      vb.cpus = 2\n      vb.name = \"ubuntu_mooc\"\n  end\n```\n### 虚拟机主机名\n```\nconfig.vm.hostname = \"mooc\"\n```\n查看虚拟机内容 ```free -m```\nCPU ```top``` 再按1查看，q退出\n\n\n### 优化nginx和apache 同步目录的问题 修改后文件可及时同步\n\n![](http://upload-images.jianshu.io/upload_images/693141-368f8373feeaa483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)\n\n****\n## 打包分发环境\n### 打包 \n需先关闭虚拟机 vagrant halt\n```\nvagrant package --output xxx.box\nvagrant package --output xxx.box --base 虚拟机名\n```\n### 升级\n老用户：使用Vagrantfile进行升级；\n```\nconfig.vm.provision \"shell\", inline: <<-SHELL\napt-get install -y redis-server (-y 表示强制安装)\nvagrant reload --provision\n```\n新用户：直接重新打包分发给他\n```\nvagrant box add new xxx.box\n新建一个目录\nvagrant box list\nvagrant init new\n```\n\n配置文件里面的vb.gui可以查看虚拟机启动时候的情况，可用于错误调试。\n\n打包的时候最好关闭网络配置\n\n\n\n\n```\n// Vagrantfile 配置文件所有内容\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n  config.vm.box = \"ubuntu1404\"\n  config.vm.hostname = \"mooc\"\n  config.vm.network \"forwarded_port\", guest: 80, host: 8888 ,id: 'nginx'\n  config.vm.network \"forwarded_port\", guest: 8888, host: 8889 ,id: 'apache'\n  config.vm.network \"private_network\", ip: \"192.168.11.11\",auto_config: true\n  config.vm.synced_folder \"/Users/ZouZhipeng/www/mooc_vagrant/\", \"/home/www\", :nfs => true\n  #config.vm.synced_folder \"/Users/vincent/code/\", \"/home/www\", :nfs => true\n\n  config.vm.provider \"virtualbox\" do |vb|\n  #   # Display the VirtualBox GUI when booting the machine\n  #   vb.gui = true\n  #\n  #   # Customize the amount of memory on the VM:\n      vb.memory = \"1024\"\n      vb.cpus = 2\n      vb.name = \"ubuntu_mooc\"\n  end\n\n\n  # Enable provisioning with a shell script. Additional provisioners such as\n  # Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the\n  # documentation for more information about their specific syntax and use.\n  # config.vm.provision \"shell\", inline: <<-SHELL\n  #   apt-get update\n  #   apt-get install -y apache2\n  # SHELL\nend\n```\n\n\n","slug":"Vagrant-打造PHP开发环境","published":1,"updated":"2020-09-11T01:04:35.040Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckexjtzbc00716wo1hi7he9t3","content":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-dcab921466013b5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>本文是慕课网 <a href=\"http://www.imooc.com/learn/805\">《vagrant打造跨平台可移动的开发环境》</a>的学习记录。</p>\n<a id=\"more\"></a>\n\n<p>ThinkPHP 和 Apache 的配置相对麻烦，且很少使用。若没有需求可直接略过这两部分。</p>\n<h2 id=\"1-虚拟机\"><a href=\"#1-虚拟机\" class=\"headerlink\" title=\"1. 虚拟机\"></a>1. 虚拟机</h2><p>优点：</p>\n<ul>\n<li>安装多种演示环境；</li>\n<li>保证主机快速运行，减少不必要的垃圾安装程序；</li>\n<li>避免每次重新安装；</li>\n<li>测试不熟悉的应用，随便在虚拟机中安装和删除；</li>\n<li>体验不同版本的操作系统。</li>\n</ul>\n<hr>\n<h2 id=\"2-Vagrant\"><a href=\"#2-Vagrant\" class=\"headerlink\" title=\"2. Vagrant\"></a>2. Vagrant</h2><p>是构建在虚拟化技术之上的虚拟机运行环境管理工具</p>\n<h4 id=\"作用：\"><a href=\"#作用：\" class=\"headerlink\" title=\"作用：\"></a>作用：</h4><ul>\n<li>建立和删除虚拟机</li>\n<li>配置虚拟机运行参数</li>\n<li>管理虚拟机运行状态</li>\n<li>自动化配置和安装开发环境</li>\n</ul>\n<p>vagrant 的运行，需要依赖某项具体的<strong>虚拟化技术</strong>（virtualbox，vmvare）</p>\n<h4 id=\"优点：\"><a href=\"#优点：\" class=\"headerlink\" title=\"优点：\"></a>优点：</h4><ul>\n<li><p>跨平台 无差异性</p>\n</li>\n<li><p>可移动 镜像和配置文件相对较小</p>\n</li>\n<li><p>自动化部署，无需人工参与</p>\n</li>\n<li><p>面试加分项</p>\n</li>\n<li><p>减少公司人力培训成本</p>\n</li>\n<li><p>统一开发环境（vagrant+virtualbox+ubuntu）</p>\n</li>\n</ul>\n<h4 id=\"适用范围\"><a href=\"#适用范围\" class=\"headerlink\" title=\"适用范围\"></a>适用范围</h4><ul>\n<li>开发环境，不适用线上环境</li>\n<li>项目配置比较复杂 （nginx/apache, memcache/redis, php/python/java）配置好的环境可以分发给每一个人，保证环境统一</li>\n</ul>\n<h4 id=\"安装步骤\"><a href=\"#安装步骤\" class=\"headerlink\" title=\"安装步骤\"></a>安装步骤</h4><ol>\n<li>下载 Virtualbox（VirtualBox-5.1.4-110228-OSX.dmg） </li>\n<li>Vagrant（vagrant_1.8.5.dmg）， 安装</li>\n</ol>\n<hr>\n<h3 id=\"常用-vagrant-命令\"><a href=\"#常用-vagrant-命令\" class=\"headerlink\" title=\"常用 vagrant 命令\"></a>常用 vagrant 命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant box list 查看目前已有的box</span><br><span class=\"line\">vagrant box add 新增加一个box 需要在下载好的box(基于该box生成)的路径下执行，或者指定box的路径 如 vagrant box add myProject ubuntu16.01.box</span><br><span class=\"line\">vagrant box remove 删除指定的box</span><br><span class=\"line\">vagrant init  初始化配置文件 vagrantfile</span><br><span class=\"line\">vagrant up 启动虚拟机</span><br><span class=\"line\">vagrant ssh ssh登录虚拟机</span><br><span class=\"line\">vagrant suspend 挂起虚拟机</span><br><span class=\"line\">vagrant reload 重启虚拟机</span><br><span class=\"line\">vagrant halt 关闭虚拟机</span><br><span class=\"line\">vagrant status 虚拟机状态</span><br><span class=\"line\">vagrant destroy 删除虚拟机</span><br></pre></td></tr></table></figure>\n\n\n<p>实战<br>目标：<br>生成一个box<br>box镜像默认配置好 LAMP &amp; LNMP<br>Yii2，TP5，Laravel 可以直接运行</p>\n<hr>\n<h2 id=\"步骤：\"><a href=\"#步骤：\" class=\"headerlink\" title=\"步骤：\"></a>步骤：</h2><h3 id=\"1-初始化并启动虚拟机\"><a href=\"#1-初始化并启动虚拟机\" class=\"headerlink\" title=\"1. 初始化并启动虚拟机\"></a>1. 初始化并启动虚拟机</h3><ul>\n<li><p>VirtualBox 5.1.8<br>下载地址 <a href=\"https://www.virtualbox.org/wiki/Download_Old_Builds_5_1\">https://www.virtualbox.org/wiki/Download_Old_Builds_5_1</a></p>\n</li>\n<li><p>Vagrant 1.8.6<br>下载地址：<a href=\"https://releases.hashicorp.com/vagrant/1.8.6/\">https://releases.hashicorp.com/vagrant/1.8.6/</a><br>切记根据自己的操作系统下载，同时分32位和64位</p>\n</li>\n<li><p>Windows 额外工作</p>\n<blockquote>\n<p>可能需要配置环境变;<br>安装Xshell命令行工具;<br>注意，一定要开启 VT-x/AMD-V 硬件加速</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>下载 ubuntu1404.box</li>\n<li>首先运行 vagrant box list 看当前所有的box</li>\n<li>然后在ubuntu1404.box 所在的路径执行 vagrant box add ubuntu1404（这个名字随意起） ubuntu1404.box</li>\n<li>再次执行 vagrant box list 看是否添加成功</li>\n<li>创建一个目录，在该目录中执行 vagrant init ubuntu1404（镜像的名称）</li>\n<li>在该目录下就会生成一个名为 Vagrantfile 的配置文件</li>\n<li>使用编辑器打开该配置文件，可以看到第15行，box的名称为刚才镜像的名称</li>\n<li>vagrant up 启动虚拟机，可以在virtualbox客户端看到启动的过程</li>\n<li>vagrant ssh 进入虚拟机</li>\n</ul>\n<h3 id=\"2-替换源-使用阿里云的镜像，不用翻墙\"><a href=\"#2-替换源-使用阿里云的镜像，不用翻墙\" class=\"headerlink\" title=\"2. 替换源(使用阿里云的镜像，不用翻墙)\"></a>2. 替换源(使用阿里云的镜像，不用翻墙)</h3><p>备份<br><code>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</code></p>\n<p>编辑<br>文件内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-security main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-updates main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-proposed main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-backports main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-security main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-updates main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-proposed main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>\n\n<p>更新源(<strong>这里卡住了</strong>)<br><code>sudo apt-get update</code></p>\n<p>这部分有点坑，反正我能翻墙，不用它了</p>\n<h3 id=\"3-安装-nginx\"><a href=\"#3-安装-nginx\" class=\"headerlink\" title=\"3. 安装 nginx\"></a>3. 安装 nginx</h3><ol>\n<li>首先进入虚拟机，查看 nginx 是否可安装<br><code>apt-cache search nginx</code></li>\n<li>安装 nginx<br><code>sudo apt-get install nginx</code></li>\n<li>查看是否安装成功<br><code>nginx -v</code></li>\n<li>测试 nginx 能否得到请求并正确响应<br><code>curl -I &#39;http://127.0.0.1&#39;</code><br><code>curl http://www.baidu.com</code></li>\n</ol>\n<h3 id=\"4-安装-apache2\"><a href=\"#4-安装-apache2\" class=\"headerlink\" title=\"4. 安装 apache2\"></a>4. 安装 apache2</h3><ol>\n<li>安装 nginx<br><code>sudo apt-get install apache2</code></li>\n<li>查看是否安装成功<br><code>apache2 -v</code></li>\n<li>测试 nginx 能否得到请求并正确响应 必须先停止nginx<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;nginx stop</span><br><span class=\"line\">curl -I &#39;http:&#x2F;&#x2F;127.0.0.1&#39;</span><br><span class=\"line\">curl -I &#39;http:&#x2F;&#x2F;www.baidu.com&#39;</span><br><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;apache2 start</span><br><span class=\"line\">curl -I &#39;http:&#x2F;&#x2F;127.0.0.1&#39;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"5-安装-mysql\"><a href=\"#5-安装-mysql\" class=\"headerlink\" title=\"5. 安装 mysql\"></a>5. 安装 mysql</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install mysql-server</span><br><span class=\"line\">sudo apt-get install mysql-client</span><br><span class=\"line\">mysql -uroot -p</span><br><span class=\"line\">select version();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-安装-PHP\"><a href=\"#6-安装-PHP\" class=\"headerlink\" title=\"6. 安装 PHP\"></a>6. 安装 PHP</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5-cli</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-安装-扩展\"><a href=\"#7-安装-扩展\" class=\"headerlink\" title=\"7. 安装 扩展\"></a>7. 安装 扩展</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5-mcrypt php5-mysql php5-gd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-安装-apache2-的-PHP-模块\"><a href=\"#8-安装-apache2-的-PHP-模块\" class=\"headerlink\" title=\"8. 安装 apache2 的 PHP 模块\"></a>8. 安装 apache2 的 PHP 模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libapache2-mod-php5</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-安装-nginx-fastcgi\"><a href=\"#8-安装-nginx-fastcgi\" class=\"headerlink\" title=\"8. 安装 nginx fastcgi\"></a>8. 安装 nginx fastcgi</h3><p>fastcgi  fpm 是一个进程池，来管理PHP的进程(cgi)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5-cgi php5-fpm</span><br><span class=\"line\">&#x2F;&#x2F; 查询软件启动状态</span><br><span class=\"line\">ps -ef | grep apache</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-更改端口\"><a href=\"#9-更改端口\" class=\"headerlink\" title=\"9. 更改端口\"></a>9. 更改端口</h3><p>apache 和 nginx 默认都是监听 80 端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 更改 Apache 的监听端口为8888</span><br><span class=\"line\">sudo vim &#x2F;etc&#x2F;apache2&#x2F;ports.conf </span><br><span class=\"line\">listen 8888 保存后重启apache</span><br></pre></td></tr></table></figure>\n<p>这时候，监听的端口不同，两个server就可以同时运行，可以查看启动状态</p>\n<p>验证是否可以访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -I &quot;http:&#x2F;&#x2F;127.0.0.1:80&quot;</span><br><span class=\"line\">curl -I &quot;http:&#x2F;&#x2F;127.0.0.1:8888&quot;</span><br></pre></td></tr></table></figure>\n<p>按需求来，一般不会两个同时安装。</p>\n<h3 id=\"10-通过浏览器访问虚拟机\"><a href=\"#10-通过浏览器访问虚拟机\" class=\"headerlink\" title=\"10. 通过浏览器访问虚拟机\"></a>10. 通过浏览器访问虚拟机</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 挂起虚拟机</span><br><span class=\"line\">vagrant suspend</span><br><span class=\"line\">&#x2F;&#x2F; 打开virtualbox，选中要操作的虚拟机-setting-network-advance-port forwarding</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-3ae6d25152d5914f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"><br>配置完成后，保存，启动虚拟机。</p>\n<p>8888端口，访问的是虚拟机里面的80端口，即nginx</p>\n<p>8889端口，访问的是虚拟机里面的8888端口，即Apache</p>\n<p>在浏览器中访问虚拟机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:8888</span><br><span class=\"line\">127.0.0.1:8889</span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"vagrant-高级功能\"><a href=\"#vagrant-高级功能\" class=\"headerlink\" title=\"vagrant 高级功能\"></a>vagrant 高级功能</h2><p>进入当前虚拟机目录， 这样所有操作都是针对当前的虚拟机进行的操作。</p>\n<h3 id=\"端口转发\"><a href=\"#端口转发\" class=\"headerlink\" title=\"端口转发\"></a>端口转发</h3><p>上述手动的配置，重启虚拟机之后自动消失。</p>\n<p>vagrant每次重启的时候，都会按照自己的配置文件进行设置，所以手动更改的配置无效。</p>\n<p>参考官网的示例是最好的学习方式。</p>\n<p>修改本虚拟机的配置文件 Vagrantfile</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.network &quot;forwarded_port&quot;, guest:80 (虚拟机里的端口), host:8888 （主机里的端口）</span><br><span class=\"line\">config.vm.network &quot;forwarded_port&quot;, guest:8888, host:8889</span><br></pre></td></tr></table></figure>\n<p>保存后重启虚拟机</p>\n<h3 id=\"网络设置\"><a href=\"#网络设置\" class=\"headerlink\" title=\"网络设置\"></a>网络设置</h3><h4 id=\"1-公有IP\"><a href=\"#1-公有IP\" class=\"headerlink\" title=\"1. 公有IP\"></a>1. 公有IP</h4><p>公有IP不能创建nfs共享目录</p>\n<p>IP段必须和主机（host 自己的电脑，不是虚拟机guest）的IP段一致，且不能与其他IP冲突。</p>\n<h4 id=\"2-私有IP\"><a href=\"#2-私有IP\" class=\"headerlink\" title=\"2. 私有IP\"></a>2. 私有IP</h4><p>只能本机和虚拟机之间，以及虚拟机与虚拟机之间进行通讯。一般都使用私有IP</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.network &quot;private_network&quot;, ip:&quot;192.168.11.11&quot;</span><br></pre></td></tr></table></figure>\n<p>这样，可以直接在浏览器中输入IP来访问虚拟机的webserver</p>\n<h3 id=\"共享目录\"><a href=\"#共享目录\" class=\"headerlink\" title=\"共享目录\"></a>共享目录</h3><p>一般共享代码目录，本地修改可以及时同步到虚拟机调试。</p>\n<p>NFS方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.synced_folder &quot;&#x2F;Users&#x2F;ZouZhipeng&#x2F;mooc_vagrant&#x2F;&quot;, &quot;&#x2F;home&#x2F;www&#x2F;&quot; (该目录如果不存在，会自动创建), :nfs &#x3D;&gt; true</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-d8da821808b2e649.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-1bd408cef572074d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<hr>\n<h2 id=\"vagrant-配置-ThinkPHP5\"><a href=\"#vagrant-配置-ThinkPHP5\" class=\"headerlink\" title=\"vagrant 配置 ThinkPHP5\"></a>vagrant 配置 ThinkPHP5</h2><h3 id=\"1-安装git\"><a href=\"#1-安装git\" class=\"headerlink\" title=\"1. 安装git\"></a>1. 安装git</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install git</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-克隆代码\"><a href=\"#2-克隆代码\" class=\"headerlink\" title=\"2. 克隆代码\"></a>2. 克隆代码</h3><p>新建一个目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;top-think&#x2F;think tp5</span><br></pre></td></tr></table></figure>\n<p>切换到tp5目录下，再克隆核心框架仓库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd tp5 &amp;&amp; git clone https:&#x2F;&#x2F;github.com&#x2F;top-think&#x2F;framework thinkphp</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-nginx-配置文件（-etc-nginx-nginx-conf）详解\"><a href=\"#3-nginx-配置文件（-etc-nginx-nginx-conf）详解\" class=\"headerlink\" title=\"3. nginx 配置文件（/etc/nginx/nginx.conf）详解\"></a>3. nginx 配置文件（/etc/nginx/nginx.conf）详解</h3><p>下面两行有一个包含的命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class=\"line\">include &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;*;</span><br></pre></td></tr></table></figure>\n\n<p>也就是说，所有在conf.d目录下以.conf为后缀的文件，以及所有在sites-enabled目录下的文件，都可以自动加载到nginx的配置文件。这样不会影响到主配置文件。</p>\n<p>新建一个配置文件 cd conf.d &amp;&amp; sudo touch tp5.conf：</p>\n<p>详解版</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123; &#x2F;&#x2F; 所有nginx虚拟机的配置都是以 server 变量开始的</span><br><span class=\"line\">\tserver_name tp5.zzp.com; &#x2F;&#x2F; 虚拟机域名</span><br><span class=\"line\">\troot &#x2F;home&#x2F;www&#x2F;tp5&#x2F;public; &#x2F;&#x2F; 代码路径 入口文件地址</span><br><span class=\"line\">\tindex index.php index.html; &#x2F;&#x2F; 默认的索引文件</span><br><span class=\"line\">\tlocation &#x2F; &#123;  &#x2F;&#x2F; </span><br><span class=\"line\">\t\tif (-f $request_filename) &#123; &#x2F;&#x2F;如果访问的文件存在，直接跳转，不执行这里</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tif (!-e $request_filename) &#123; &#x2F;&#x2F; 如果访问的文件不存在 正则表达式（任何内容） 重定向到入口文件，参数为前面的正则表达式$1 last 表示不再走了</span><br><span class=\"line\">\t\t\trewrite ^&#x2F;(.*)&#x2F;$ &#x2F;index.php&#x2F;$1 last;</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tlocation ~ \\.php &#123; &#x2F;&#x2F; 任何路径，如果是以.php结尾的，包括前面的index.php</span><br><span class=\"line\">\t\tset $script $uri;</span><br><span class=\"line\">\t\tset $path_info &quot;&quot;;</span><br><span class=\"line\">\t\tif ($uri ~ &quot;^(.+\\.php)(&#x2F;.+)&quot;) &#123; &#x2F;&#x2F; 如果路由符合这个规则</span><br><span class=\"line\">\t\t\tset $script $1;</span><br><span class=\"line\">\t\t\tset $path_info $2;</span><br><span class=\"line\">\t\t&#125; </span><br><span class=\"line\">\t\tinclude fastcgi_params; &#x2F;&#x2F; 包含fastcgi参数</span><br><span class=\"line\">\t\t&#x2F;&#x2F; 需手动设置pathInfo类型的路由</span><br><span class=\"line\">\t\t&#x2F;&#x2F; 多传递一个参数，并解析出来</span><br><span class=\"line\">\t\tfastcgi_index index.php?IF_REWRITE&#x3D;1;</span><br><span class=\"line\">\t\tfastcgi_param PATH_INFO $path_info;</span><br><span class=\"line\">\t\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class=\"line\">\t\tfastcgi_param SCRIPT_NAME $script;</span><br><span class=\"line\">\t\tfastcgi_pass 127.0.0.1:9000; &#x2F;&#x2F; fastcgi 端口</span><br><span class=\"line\">\t\ttry_files $uri &#x3D; 404; &#x2F;&#x2F; 如果文件不存在，直接404</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>copy版</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    charset utf-8;</span><br><span class=\"line\">    client_max_body_size 128M;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name tp5.imooc.test;</span><br><span class=\"line\"></span><br><span class=\"line\">    root  &#x2F;home&#x2F;www&#x2F;mooc&#x2F;vagrant&#x2F;phpmvc&#x2F;tp5&#x2F;public;</span><br><span class=\"line\">    index  index.php;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~* \\.(eot|otf|ttf|woff)$ &#123;</span><br><span class=\"line\">        add_header Access-Control-Allow-Origin *;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        index    index.html index.php;</span><br><span class=\"line\">        if ( -f $request_filename) &#123;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        if ( !-e $request_filename) &#123;</span><br><span class=\"line\">            rewrite ^&#x2F;(.*)$ &#x2F;index.php&#x2F;$1 last;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ \\.php &#123;</span><br><span class=\"line\">    \tset $script $uri;</span><br><span class=\"line\">        set $path_info &quot;&quot;;</span><br><span class=\"line\">        if ($uri ~ &quot;^(.+\\.php)(&#x2F;.+)&quot;) &#123;</span><br><span class=\"line\">            set $script $1;</span><br><span class=\"line\">            set $path_info $2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        include   fastcgi_params;</span><br><span class=\"line\">        fastcgi_index    index.php?IF_REWRITE&#x3D;1;</span><br><span class=\"line\">    \tfastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">    \tfastcgi_param    PATH_INFO    $path_info;</span><br><span class=\"line\">        fastcgi_param    SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br><span class=\"line\">        fastcgi_param    SCRIPT_NAME    $script;</span><br><span class=\"line\">        try_files $uri &#x3D;404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 /etc/hosts 文件中绑定上面配置的域名 其实就是自定义的DNS服务<br><code>192.168.11.11 tp5.zzp.com</code></p>\n<p>然后再浏览器中访问，发现报错404。</p>\n<h4 id=\"排错\"><a href=\"#排错\" class=\"headerlink\" title=\"排错\"></a>排错</h4><p>排错的方式就是查看日志，首先找到日志存放的位置。主配置文件nginx.conf中可以找到。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##</span><br><span class=\"line\"># Logging Settings</span><br><span class=\"line\">##</span><br><span class=\"line\">access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log;</span><br><span class=\"line\">error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;</span><br></pre></td></tr></table></figure>\n<p>首先看访问日志，如果有变化说明访问进来了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br></pre></td></tr></table></figure>\n<p>如果没权限，先修改访问日志的权限为777</p>\n<p>再次在浏览器中访问，访问日志有记录。然后查看错误日志。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br></pre></td></tr></table></figure>\n<p>同样需要先修改权限。</p>\n<p>如果错误为 connection refused，如何排查。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;php5&#x2F;fpm&#x2F;pool.d</span><br><span class=\"line\">sudo vim www.conf 搜索listen</span><br><span class=\"line\">找到</span><br><span class=\"line\">listen &#x3D; &#x2F;var&#x2F;run&#x2F;php5-fpm.sock</span><br><span class=\"line\">这是监听域模式的方式，改成端口方式进行监听</span><br><span class=\"line\">listen &#x3D; 127.0.0.1：9000 </span><br><span class=\"line\">端口方式比域模式更加稳定</span><br><span class=\"line\">修改后重启fpm服务</span><br><span class=\"line\">sudo service php5-fpm restart</span><br><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;php5-fpm restart 这两行一样</span><br></pre></td></tr></table></figure>\n<p>再次通过浏览器访问，终于通了。</p>\n<h3 id=\"配置apache\"><a href=\"#配置apache\" class=\"headerlink\" title=\"配置apache\"></a>配置apache</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;apache2</span><br><span class=\"line\">vim apache2.conf</span><br><span class=\"line\">打开配置文件，最下面可以看到</span><br><span class=\"line\"># Include the virtual host configurations:</span><br><span class=\"line\">IncludeOptional sites-enabled&#x2F;*.conf</span><br><span class=\"line\">找到子配置文件的目录</span><br><span class=\"line\">cd sites-enabled</span><br><span class=\"line\">sudo touch tp5.conf</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:8888&gt; &#x2F;&#x2F; xml 形式 端口为8888</span><br><span class=\"line\">\tServerName tp5.zzp.com</span><br><span class=\"line\">\tDocumentRoot &#x2F;home&#x2F;www&#x2F;tp5&#x2F;public</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<p>然后重启apache</p>\n<p>浏览器中访问 tp5.zzp.com:8888  返回403错误</p>\n<h4 id=\"解决方式\"><a href=\"#解决方式\" class=\"headerlink\" title=\"解决方式\"></a>解决方式</h4><p>看错误日志</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod -R 755 &#x2F;var&#x2F;log&#x2F;apache2</span><br><span class=\"line\">tail -f error.log</span><br><span class=\"line\">client denied by server configuration</span><br><span class=\"line\">一般是Apache的配置错误导致的</span><br><span class=\"line\">sudo vim &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Directory &#x2F;&gt;</span><br><span class=\"line\">        Options FollowSymLinks</span><br><span class=\"line\">        AllowOverride None</span><br><span class=\"line\">        Require all denied &#x2F;&#x2F; 把这行注释掉即可,然后重启apache</span><br><span class=\"line\">&lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure>\n<p>TP 的路由解决方式已经非常落后，给webserver 的配置带来了很多麻烦，看看就好。</p>\n<h4 id=\"开启Apache的rewrite功能\"><a href=\"#开启Apache的rewrite功能\" class=\"headerlink\" title=\"开启Apache的rewrite功能\"></a>开启Apache的rewrite功能</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo a2enmod rewrite</span><br></pre></td></tr></table></figure>\n<p>在Apache的配置文件中还要修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class=\"line\">找到 Directory 的 AllowOverride, 改为All</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-vagrant-安装yii2-amp-Laravel5\"><a href=\"#2-vagrant-安装yii2-amp-Laravel5\" class=\"headerlink\" title=\"2. vagrant 安装yii2 &amp; Laravel5\"></a>2. vagrant 安装yii2 &amp; Laravel5</h2><h3 id=\"1-下载yii-basic-的压缩包，解压到目标目录\"><a href=\"#1-下载yii-basic-的压缩包，解压到目标目录\" class=\"headerlink\" title=\"1. 下载yii-basic 的压缩包，解压到目标目录\"></a>1. 下载yii-basic 的压缩包，解压到目标目录</h3><h3 id=\"2-配置nginx运行环境\"><a href=\"#2-配置nginx运行环境\" class=\"headerlink\" title=\"2. 配置nginx运行环境\"></a>2. 配置nginx运行环境</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">sudo touch yii2.conf</span><br><span class=\"line\">sudo vim yii2.conf</span><br><span class=\"line\">sudo service nginx restart</span><br><span class=\"line\"></span><br><span class=\"line\">server&#123;</span><br><span class=\"line\">    server_name yii.zzp.com;</span><br><span class=\"line\">    root &#x2F;home&#x2F;www&#x2F;yii&#x2F;web;</span><br><span class=\"line\">    index index.php;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">      try_files $uri $uri&#x2F; &#x2F;index.php?$args;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">      include fastcgi_params;</span><br><span class=\"line\">      fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">      try_files $uri &#x3D; 404;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">别忘了 hosts 在浏览器中就可以访问了</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-配置Apache\"><a href=\"#3-配置Apache\" class=\"headerlink\" title=\"3. 配置Apache\"></a>3. 配置Apache</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;apache2&#x2F;sites-enabled</span><br><span class=\"line\">sudo touch yii.conf</span><br><span class=\"line\">sudo vim yii.conf</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;VirtualHost *:8888&gt;</span><br><span class=\"line\">  ServerName yii.zzp.com</span><br><span class=\"line\">  DocumentRoot &#x2F;home&#x2F;www&#x2F;yii&#x2F;web</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">重启apache 在浏览器中就可以访问了</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-下载并解压-laravel安装包\"><a href=\"#4-下载并解压-laravel安装包\" class=\"headerlink\" title=\"4. 下载并解压 laravel安装包\"></a>4. 下载并解压 laravel安装包</h3><p>配置基本和yii一致</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    server_name laravel.zzp.com;</span><br><span class=\"line\">    root &#x2F;home&#x2F;www&#x2F;laravel&#x2F;public;</span><br><span class=\"line\">    index index.php;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">      try_files $uri $uri&#x2F; &#x2F;index.php?$args;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">      include fastcgi_params;</span><br><span class=\"line\">      fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">      try_files $uri &#x3D; 404;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:8888&gt;</span><br><span class=\"line\">  ServerName laravel.zzp.com</span><br><span class=\"line\">  DocumentRoot &#x2F;home&#x2F;www&#x2F;laravel&#x2F;public</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-vagrant-虚拟机优化\"><a href=\"#3-vagrant-虚拟机优化\" class=\"headerlink\" title=\"3. vagrant  虚拟机优化\"></a>3. vagrant  虚拟机优化</h2><h3 id=\"虚拟机名字-内存和CPU\"><a href=\"#虚拟机名字-内存和CPU\" class=\"headerlink\" title=\"虚拟机名字 内存和CPU\"></a>虚拟机名字 内存和CPU</h3><p>修改vagrantfile并重启虚拟机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class=\"line\">#   # Display the VirtualBox GUI when booting the machine</span><br><span class=\"line\">#   vb.gui &#x3D; true</span><br><span class=\"line\">#</span><br><span class=\"line\">#   # Customize the amount of memory on the VM:</span><br><span class=\"line\">    vb.memory &#x3D; &quot;1024&quot;</span><br><span class=\"line\">    vb.cpus &#x3D; 2</span><br><span class=\"line\">    vb.name &#x3D; &quot;ubuntu_mooc&quot;</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<h3 id=\"虚拟机主机名\"><a href=\"#虚拟机主机名\" class=\"headerlink\" title=\"虚拟机主机名\"></a>虚拟机主机名</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.hostname &#x3D; &quot;mooc&quot;</span><br></pre></td></tr></table></figure>\n<p>查看虚拟机内容 <code>free -m</code><br>CPU <code>top</code> 再按1查看，q退出</p>\n<h3 id=\"优化nginx和apache-同步目录的问题-修改后文件可及时同步\"><a href=\"#优化nginx和apache-同步目录的问题-修改后文件可及时同步\" class=\"headerlink\" title=\"优化nginx和apache 同步目录的问题 修改后文件可及时同步\"></a>优化nginx和apache 同步目录的问题 修改后文件可及时同步</h3><p><img src=\"http://upload-images.jianshu.io/upload_images/693141-368f8373feeaa483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<hr>\n<h2 id=\"打包分发环境\"><a href=\"#打包分发环境\" class=\"headerlink\" title=\"打包分发环境\"></a>打包分发环境</h2><h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><p>需先关闭虚拟机 vagrant halt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant package --output xxx.box</span><br><span class=\"line\">vagrant package --output xxx.box --base 虚拟机名</span><br></pre></td></tr></table></figure>\n<h3 id=\"升级\"><a href=\"#升级\" class=\"headerlink\" title=\"升级\"></a>升级</h3><p>老用户：使用Vagrantfile进行升级；</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class=\"line\">apt-get install -y redis-server (-y 表示强制安装)</span><br><span class=\"line\">vagrant reload --provision</span><br></pre></td></tr></table></figure>\n<p>新用户：直接重新打包分发给他</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant box add new xxx.box</span><br><span class=\"line\">新建一个目录</span><br><span class=\"line\">vagrant box list</span><br><span class=\"line\">vagrant init new</span><br></pre></td></tr></table></figure>\n\n<p>配置文件里面的vb.gui可以查看虚拟机启动时候的情况，可用于错误调试。</p>\n<p>打包的时候最好关闭网络配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Vagrantfile 配置文件所有内容</span><br><span class=\"line\"># -*- mode: ruby -*-</span><br><span class=\"line\"># vi: set ft&#x3D;ruby :</span><br><span class=\"line\"></span><br><span class=\"line\">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class=\"line\">  config.vm.box &#x3D; &quot;ubuntu1404&quot;</span><br><span class=\"line\">  config.vm.hostname &#x3D; &quot;mooc&quot;</span><br><span class=\"line\">  config.vm.network &quot;forwarded_port&quot;, guest: 80, host: 8888 ,id: &#39;nginx&#39;</span><br><span class=\"line\">  config.vm.network &quot;forwarded_port&quot;, guest: 8888, host: 8889 ,id: &#39;apache&#39;</span><br><span class=\"line\">  config.vm.network &quot;private_network&quot;, ip: &quot;192.168.11.11&quot;,auto_config: true</span><br><span class=\"line\">  config.vm.synced_folder &quot;&#x2F;Users&#x2F;ZouZhipeng&#x2F;www&#x2F;mooc_vagrant&#x2F;&quot;, &quot;&#x2F;home&#x2F;www&quot;, :nfs &#x3D;&gt; true</span><br><span class=\"line\">  #config.vm.synced_folder &quot;&#x2F;Users&#x2F;vincent&#x2F;code&#x2F;&quot;, &quot;&#x2F;home&#x2F;www&quot;, :nfs &#x3D;&gt; true</span><br><span class=\"line\"></span><br><span class=\"line\">  config.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class=\"line\">  #   # Display the VirtualBox GUI when booting the machine</span><br><span class=\"line\">  #   vb.gui &#x3D; true</span><br><span class=\"line\">  #</span><br><span class=\"line\">  #   # Customize the amount of memory on the VM:</span><br><span class=\"line\">      vb.memory &#x3D; &quot;1024&quot;</span><br><span class=\"line\">      vb.cpus &#x3D; 2</span><br><span class=\"line\">      vb.name &#x3D; &quot;ubuntu_mooc&quot;</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  # Enable provisioning with a shell script. Additional provisioners such as</span><br><span class=\"line\">  # Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the</span><br><span class=\"line\">  # documentation for more information about their specific syntax and use.</span><br><span class=\"line\">  # config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class=\"line\">  #   apt-get update</span><br><span class=\"line\">  #   apt-get install -y apache2</span><br><span class=\"line\">  # SHELL</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-dcab921466013b5d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p>本文是慕课网 <a href=\"http://www.imooc.com/learn/805\">《vagrant打造跨平台可移动的开发环境》</a>的学习记录。</p>","more":"<p>ThinkPHP 和 Apache 的配置相对麻烦，且很少使用。若没有需求可直接略过这两部分。</p>\n<h2 id=\"1-虚拟机\"><a href=\"#1-虚拟机\" class=\"headerlink\" title=\"1. 虚拟机\"></a>1. 虚拟机</h2><p>优点：</p>\n<ul>\n<li>安装多种演示环境；</li>\n<li>保证主机快速运行，减少不必要的垃圾安装程序；</li>\n<li>避免每次重新安装；</li>\n<li>测试不熟悉的应用，随便在虚拟机中安装和删除；</li>\n<li>体验不同版本的操作系统。</li>\n</ul>\n<hr>\n<h2 id=\"2-Vagrant\"><a href=\"#2-Vagrant\" class=\"headerlink\" title=\"2. Vagrant\"></a>2. Vagrant</h2><p>是构建在虚拟化技术之上的虚拟机运行环境管理工具</p>\n<h4 id=\"作用：\"><a href=\"#作用：\" class=\"headerlink\" title=\"作用：\"></a>作用：</h4><ul>\n<li>建立和删除虚拟机</li>\n<li>配置虚拟机运行参数</li>\n<li>管理虚拟机运行状态</li>\n<li>自动化配置和安装开发环境</li>\n</ul>\n<p>vagrant 的运行，需要依赖某项具体的<strong>虚拟化技术</strong>（virtualbox，vmvare）</p>\n<h4 id=\"优点：\"><a href=\"#优点：\" class=\"headerlink\" title=\"优点：\"></a>优点：</h4><ul>\n<li><p>跨平台 无差异性</p>\n</li>\n<li><p>可移动 镜像和配置文件相对较小</p>\n</li>\n<li><p>自动化部署，无需人工参与</p>\n</li>\n<li><p>面试加分项</p>\n</li>\n<li><p>减少公司人力培训成本</p>\n</li>\n<li><p>统一开发环境（vagrant+virtualbox+ubuntu）</p>\n</li>\n</ul>\n<h4 id=\"适用范围\"><a href=\"#适用范围\" class=\"headerlink\" title=\"适用范围\"></a>适用范围</h4><ul>\n<li>开发环境，不适用线上环境</li>\n<li>项目配置比较复杂 （nginx/apache, memcache/redis, php/python/java）配置好的环境可以分发给每一个人，保证环境统一</li>\n</ul>\n<h4 id=\"安装步骤\"><a href=\"#安装步骤\" class=\"headerlink\" title=\"安装步骤\"></a>安装步骤</h4><ol>\n<li>下载 Virtualbox（VirtualBox-5.1.4-110228-OSX.dmg） </li>\n<li>Vagrant（vagrant_1.8.5.dmg）， 安装</li>\n</ol>\n<hr>\n<h3 id=\"常用-vagrant-命令\"><a href=\"#常用-vagrant-命令\" class=\"headerlink\" title=\"常用 vagrant 命令\"></a>常用 vagrant 命令</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant box list 查看目前已有的box</span><br><span class=\"line\">vagrant box add 新增加一个box 需要在下载好的box(基于该box生成)的路径下执行，或者指定box的路径 如 vagrant box add myProject ubuntu16.01.box</span><br><span class=\"line\">vagrant box remove 删除指定的box</span><br><span class=\"line\">vagrant init  初始化配置文件 vagrantfile</span><br><span class=\"line\">vagrant up 启动虚拟机</span><br><span class=\"line\">vagrant ssh ssh登录虚拟机</span><br><span class=\"line\">vagrant suspend 挂起虚拟机</span><br><span class=\"line\">vagrant reload 重启虚拟机</span><br><span class=\"line\">vagrant halt 关闭虚拟机</span><br><span class=\"line\">vagrant status 虚拟机状态</span><br><span class=\"line\">vagrant destroy 删除虚拟机</span><br></pre></td></tr></table></figure>\n\n\n<p>实战<br>目标：<br>生成一个box<br>box镜像默认配置好 LAMP &amp; LNMP<br>Yii2，TP5，Laravel 可以直接运行</p>\n<hr>\n<h2 id=\"步骤：\"><a href=\"#步骤：\" class=\"headerlink\" title=\"步骤：\"></a>步骤：</h2><h3 id=\"1-初始化并启动虚拟机\"><a href=\"#1-初始化并启动虚拟机\" class=\"headerlink\" title=\"1. 初始化并启动虚拟机\"></a>1. 初始化并启动虚拟机</h3><ul>\n<li><p>VirtualBox 5.1.8<br>下载地址 <a href=\"https://www.virtualbox.org/wiki/Download_Old_Builds_5_1\">https://www.virtualbox.org/wiki/Download_Old_Builds_5_1</a></p>\n</li>\n<li><p>Vagrant 1.8.6<br>下载地址：<a href=\"https://releases.hashicorp.com/vagrant/1.8.6/\">https://releases.hashicorp.com/vagrant/1.8.6/</a><br>切记根据自己的操作系统下载，同时分32位和64位</p>\n</li>\n<li><p>Windows 额外工作</p>\n<blockquote>\n<p>可能需要配置环境变;<br>安装Xshell命令行工具;<br>注意，一定要开启 VT-x/AMD-V 硬件加速</p>\n</blockquote>\n</li>\n</ul>\n<ul>\n<li>下载 ubuntu1404.box</li>\n<li>首先运行 vagrant box list 看当前所有的box</li>\n<li>然后在ubuntu1404.box 所在的路径执行 vagrant box add ubuntu1404（这个名字随意起） ubuntu1404.box</li>\n<li>再次执行 vagrant box list 看是否添加成功</li>\n<li>创建一个目录，在该目录中执行 vagrant init ubuntu1404（镜像的名称）</li>\n<li>在该目录下就会生成一个名为 Vagrantfile 的配置文件</li>\n<li>使用编辑器打开该配置文件，可以看到第15行，box的名称为刚才镜像的名称</li>\n<li>vagrant up 启动虚拟机，可以在virtualbox客户端看到启动的过程</li>\n<li>vagrant ssh 进入虚拟机</li>\n</ul>\n<h3 id=\"2-替换源-使用阿里云的镜像，不用翻墙\"><a href=\"#2-替换源-使用阿里云的镜像，不用翻墙\" class=\"headerlink\" title=\"2. 替换源(使用阿里云的镜像，不用翻墙)\"></a>2. 替换源(使用阿里云的镜像，不用翻墙)</h3><p>备份<br><code>sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</code></p>\n<p>编辑<br>文件内容为：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-security main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-updates main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-proposed main restricted universe multiverse</span><br><span class=\"line\">deb http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-backports main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-security main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-updates main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-proposed main restricted universe multiverse</span><br><span class=\"line\">deb-src http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;ubuntu&#x2F; trusty-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>\n\n<p>更新源(<strong>这里卡住了</strong>)<br><code>sudo apt-get update</code></p>\n<p>这部分有点坑，反正我能翻墙，不用它了</p>\n<h3 id=\"3-安装-nginx\"><a href=\"#3-安装-nginx\" class=\"headerlink\" title=\"3. 安装 nginx\"></a>3. 安装 nginx</h3><ol>\n<li>首先进入虚拟机，查看 nginx 是否可安装<br><code>apt-cache search nginx</code></li>\n<li>安装 nginx<br><code>sudo apt-get install nginx</code></li>\n<li>查看是否安装成功<br><code>nginx -v</code></li>\n<li>测试 nginx 能否得到请求并正确响应<br><code>curl -I &#39;http://127.0.0.1&#39;</code><br><code>curl http://www.baidu.com</code></li>\n</ol>\n<h3 id=\"4-安装-apache2\"><a href=\"#4-安装-apache2\" class=\"headerlink\" title=\"4. 安装 apache2\"></a>4. 安装 apache2</h3><ol>\n<li>安装 nginx<br><code>sudo apt-get install apache2</code></li>\n<li>查看是否安装成功<br><code>apache2 -v</code></li>\n<li>测试 nginx 能否得到请求并正确响应 必须先停止nginx<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;nginx stop</span><br><span class=\"line\">curl -I &#39;http:&#x2F;&#x2F;127.0.0.1&#39;</span><br><span class=\"line\">curl -I &#39;http:&#x2F;&#x2F;www.baidu.com&#39;</span><br><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;apache2 start</span><br><span class=\"line\">curl -I &#39;http:&#x2F;&#x2F;127.0.0.1&#39;</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"5-安装-mysql\"><a href=\"#5-安装-mysql\" class=\"headerlink\" title=\"5. 安装 mysql\"></a>5. 安装 mysql</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install mysql-server</span><br><span class=\"line\">sudo apt-get install mysql-client</span><br><span class=\"line\">mysql -uroot -p</span><br><span class=\"line\">select version();</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"6-安装-PHP\"><a href=\"#6-安装-PHP\" class=\"headerlink\" title=\"6. 安装 PHP\"></a>6. 安装 PHP</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5-cli</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"7-安装-扩展\"><a href=\"#7-安装-扩展\" class=\"headerlink\" title=\"7. 安装 扩展\"></a>7. 安装 扩展</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5-mcrypt php5-mysql php5-gd</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-安装-apache2-的-PHP-模块\"><a href=\"#8-安装-apache2-的-PHP-模块\" class=\"headerlink\" title=\"8. 安装 apache2 的 PHP 模块\"></a>8. 安装 apache2 的 PHP 模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libapache2-mod-php5</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-安装-nginx-fastcgi\"><a href=\"#8-安装-nginx-fastcgi\" class=\"headerlink\" title=\"8. 安装 nginx fastcgi\"></a>8. 安装 nginx fastcgi</h3><p>fastcgi  fpm 是一个进程池，来管理PHP的进程(cgi)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install php5-cgi php5-fpm</span><br><span class=\"line\">&#x2F;&#x2F; 查询软件启动状态</span><br><span class=\"line\">ps -ef | grep apache</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-更改端口\"><a href=\"#9-更改端口\" class=\"headerlink\" title=\"9. 更改端口\"></a>9. 更改端口</h3><p>apache 和 nginx 默认都是监听 80 端口</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 更改 Apache 的监听端口为8888</span><br><span class=\"line\">sudo vim &#x2F;etc&#x2F;apache2&#x2F;ports.conf </span><br><span class=\"line\">listen 8888 保存后重启apache</span><br></pre></td></tr></table></figure>\n<p>这时候，监听的端口不同，两个server就可以同时运行，可以查看启动状态</p>\n<p>验证是否可以访问</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -I &quot;http:&#x2F;&#x2F;127.0.0.1:80&quot;</span><br><span class=\"line\">curl -I &quot;http:&#x2F;&#x2F;127.0.0.1:8888&quot;</span><br></pre></td></tr></table></figure>\n<p>按需求来，一般不会两个同时安装。</p>\n<h3 id=\"10-通过浏览器访问虚拟机\"><a href=\"#10-通过浏览器访问虚拟机\" class=\"headerlink\" title=\"10. 通过浏览器访问虚拟机\"></a>10. 通过浏览器访问虚拟机</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; 挂起虚拟机</span><br><span class=\"line\">vagrant suspend</span><br><span class=\"line\">&#x2F;&#x2F; 打开virtualbox，选中要操作的虚拟机-setting-network-advance-port forwarding</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-3ae6d25152d5914f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"><br>配置完成后，保存，启动虚拟机。</p>\n<p>8888端口，访问的是虚拟机里面的80端口，即nginx</p>\n<p>8889端口，访问的是虚拟机里面的8888端口，即Apache</p>\n<p>在浏览器中访问虚拟机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:8888</span><br><span class=\"line\">127.0.0.1:8889</span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"vagrant-高级功能\"><a href=\"#vagrant-高级功能\" class=\"headerlink\" title=\"vagrant 高级功能\"></a>vagrant 高级功能</h2><p>进入当前虚拟机目录， 这样所有操作都是针对当前的虚拟机进行的操作。</p>\n<h3 id=\"端口转发\"><a href=\"#端口转发\" class=\"headerlink\" title=\"端口转发\"></a>端口转发</h3><p>上述手动的配置，重启虚拟机之后自动消失。</p>\n<p>vagrant每次重启的时候，都会按照自己的配置文件进行设置，所以手动更改的配置无效。</p>\n<p>参考官网的示例是最好的学习方式。</p>\n<p>修改本虚拟机的配置文件 Vagrantfile</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.network &quot;forwarded_port&quot;, guest:80 (虚拟机里的端口), host:8888 （主机里的端口）</span><br><span class=\"line\">config.vm.network &quot;forwarded_port&quot;, guest:8888, host:8889</span><br></pre></td></tr></table></figure>\n<p>保存后重启虚拟机</p>\n<h3 id=\"网络设置\"><a href=\"#网络设置\" class=\"headerlink\" title=\"网络设置\"></a>网络设置</h3><h4 id=\"1-公有IP\"><a href=\"#1-公有IP\" class=\"headerlink\" title=\"1. 公有IP\"></a>1. 公有IP</h4><p>公有IP不能创建nfs共享目录</p>\n<p>IP段必须和主机（host 自己的电脑，不是虚拟机guest）的IP段一致，且不能与其他IP冲突。</p>\n<h4 id=\"2-私有IP\"><a href=\"#2-私有IP\" class=\"headerlink\" title=\"2. 私有IP\"></a>2. 私有IP</h4><p>只能本机和虚拟机之间，以及虚拟机与虚拟机之间进行通讯。一般都使用私有IP</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.network &quot;private_network&quot;, ip:&quot;192.168.11.11&quot;</span><br></pre></td></tr></table></figure>\n<p>这样，可以直接在浏览器中输入IP来访问虚拟机的webserver</p>\n<h3 id=\"共享目录\"><a href=\"#共享目录\" class=\"headerlink\" title=\"共享目录\"></a>共享目录</h3><p>一般共享代码目录，本地修改可以及时同步到虚拟机调试。</p>\n<p>NFS方式</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.synced_folder &quot;&#x2F;Users&#x2F;ZouZhipeng&#x2F;mooc_vagrant&#x2F;&quot;, &quot;&#x2F;home&#x2F;www&#x2F;&quot; (该目录如果不存在，会自动创建), :nfs &#x3D;&gt; true</span><br></pre></td></tr></table></figure>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-d8da821808b2e649.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/693141-1bd408cef572074d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<hr>\n<h2 id=\"vagrant-配置-ThinkPHP5\"><a href=\"#vagrant-配置-ThinkPHP5\" class=\"headerlink\" title=\"vagrant 配置 ThinkPHP5\"></a>vagrant 配置 ThinkPHP5</h2><h3 id=\"1-安装git\"><a href=\"#1-安装git\" class=\"headerlink\" title=\"1. 安装git\"></a>1. 安装git</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install git</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-克隆代码\"><a href=\"#2-克隆代码\" class=\"headerlink\" title=\"2. 克隆代码\"></a>2. 克隆代码</h3><p>新建一个目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone https:&#x2F;&#x2F;github.com&#x2F;top-think&#x2F;think tp5</span><br></pre></td></tr></table></figure>\n<p>切换到tp5目录下，再克隆核心框架仓库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd tp5 &amp;&amp; git clone https:&#x2F;&#x2F;github.com&#x2F;top-think&#x2F;framework thinkphp</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-nginx-配置文件（-etc-nginx-nginx-conf）详解\"><a href=\"#3-nginx-配置文件（-etc-nginx-nginx-conf）详解\" class=\"headerlink\" title=\"3. nginx 配置文件（/etc/nginx/nginx.conf）详解\"></a>3. nginx 配置文件（/etc/nginx/nginx.conf）详解</h3><p>下面两行有一个包含的命令</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class=\"line\">include &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;*;</span><br></pre></td></tr></table></figure>\n\n<p>也就是说，所有在conf.d目录下以.conf为后缀的文件，以及所有在sites-enabled目录下的文件，都可以自动加载到nginx的配置文件。这样不会影响到主配置文件。</p>\n<p>新建一个配置文件 cd conf.d &amp;&amp; sudo touch tp5.conf：</p>\n<p>详解版</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123; &#x2F;&#x2F; 所有nginx虚拟机的配置都是以 server 变量开始的</span><br><span class=\"line\">\tserver_name tp5.zzp.com; &#x2F;&#x2F; 虚拟机域名</span><br><span class=\"line\">\troot &#x2F;home&#x2F;www&#x2F;tp5&#x2F;public; &#x2F;&#x2F; 代码路径 入口文件地址</span><br><span class=\"line\">\tindex index.php index.html; &#x2F;&#x2F; 默认的索引文件</span><br><span class=\"line\">\tlocation &#x2F; &#123;  &#x2F;&#x2F; </span><br><span class=\"line\">\t\tif (-f $request_filename) &#123; &#x2F;&#x2F;如果访问的文件存在，直接跳转，不执行这里</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tif (!-e $request_filename) &#123; &#x2F;&#x2F; 如果访问的文件不存在 正则表达式（任何内容） 重定向到入口文件，参数为前面的正则表达式$1 last 表示不再走了</span><br><span class=\"line\">\t\t\trewrite ^&#x2F;(.*)&#x2F;$ &#x2F;index.php&#x2F;$1 last;</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tlocation ~ \\.php &#123; &#x2F;&#x2F; 任何路径，如果是以.php结尾的，包括前面的index.php</span><br><span class=\"line\">\t\tset $script $uri;</span><br><span class=\"line\">\t\tset $path_info &quot;&quot;;</span><br><span class=\"line\">\t\tif ($uri ~ &quot;^(.+\\.php)(&#x2F;.+)&quot;) &#123; &#x2F;&#x2F; 如果路由符合这个规则</span><br><span class=\"line\">\t\t\tset $script $1;</span><br><span class=\"line\">\t\t\tset $path_info $2;</span><br><span class=\"line\">\t\t&#125; </span><br><span class=\"line\">\t\tinclude fastcgi_params; &#x2F;&#x2F; 包含fastcgi参数</span><br><span class=\"line\">\t\t&#x2F;&#x2F; 需手动设置pathInfo类型的路由</span><br><span class=\"line\">\t\t&#x2F;&#x2F; 多传递一个参数，并解析出来</span><br><span class=\"line\">\t\tfastcgi_index index.php?IF_REWRITE&#x3D;1;</span><br><span class=\"line\">\t\tfastcgi_param PATH_INFO $path_info;</span><br><span class=\"line\">\t\tfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class=\"line\">\t\tfastcgi_param SCRIPT_NAME $script;</span><br><span class=\"line\">\t\tfastcgi_pass 127.0.0.1:9000; &#x2F;&#x2F; fastcgi 端口</span><br><span class=\"line\">\t\ttry_files $uri &#x3D; 404; &#x2F;&#x2F; 如果文件不存在，直接404</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>copy版</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    charset utf-8;</span><br><span class=\"line\">    client_max_body_size 128M;</span><br><span class=\"line\">    listen 80;</span><br><span class=\"line\">    server_name tp5.imooc.test;</span><br><span class=\"line\"></span><br><span class=\"line\">    root  &#x2F;home&#x2F;www&#x2F;mooc&#x2F;vagrant&#x2F;phpmvc&#x2F;tp5&#x2F;public;</span><br><span class=\"line\">    index  index.php;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~* \\.(eot|otf|ttf|woff)$ &#123;</span><br><span class=\"line\">        add_header Access-Control-Allow-Origin *;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">        index    index.html index.php;</span><br><span class=\"line\">        if ( -f $request_filename) &#123;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        if ( !-e $request_filename) &#123;</span><br><span class=\"line\">            rewrite ^&#x2F;(.*)$ &#x2F;index.php&#x2F;$1 last;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location ~ \\.php &#123;</span><br><span class=\"line\">    \tset $script $uri;</span><br><span class=\"line\">        set $path_info &quot;&quot;;</span><br><span class=\"line\">        if ($uri ~ &quot;^(.+\\.php)(&#x2F;.+)&quot;) &#123;</span><br><span class=\"line\">            set $script $1;</span><br><span class=\"line\">            set $path_info $2;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        include   fastcgi_params;</span><br><span class=\"line\">        fastcgi_index    index.php?IF_REWRITE&#x3D;1;</span><br><span class=\"line\">    \tfastcgi_pass   127.0.0.1:9000;</span><br><span class=\"line\">    \tfastcgi_param    PATH_INFO    $path_info;</span><br><span class=\"line\">        fastcgi_param    SCRIPT_FILENAME    $document_root$fastcgi_script_name;</span><br><span class=\"line\">        fastcgi_param    SCRIPT_NAME    $script;</span><br><span class=\"line\">        try_files $uri &#x3D;404;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 /etc/hosts 文件中绑定上面配置的域名 其实就是自定义的DNS服务<br><code>192.168.11.11 tp5.zzp.com</code></p>\n<p>然后再浏览器中访问，发现报错404。</p>\n<h4 id=\"排错\"><a href=\"#排错\" class=\"headerlink\" title=\"排错\"></a>排错</h4><p>排错的方式就是查看日志，首先找到日志存放的位置。主配置文件nginx.conf中可以找到。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">##</span><br><span class=\"line\"># Logging Settings</span><br><span class=\"line\">##</span><br><span class=\"line\">access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log;</span><br><span class=\"line\">error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;</span><br></pre></td></tr></table></figure>\n<p>首先看访问日志，如果有变化说明访问进来了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</span><br></pre></td></tr></table></figure>\n<p>如果没权限，先修改访问日志的权限为777</p>\n<p>再次在浏览器中访问，访问日志有记录。然后查看错误日志。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log</span><br></pre></td></tr></table></figure>\n<p>同样需要先修改权限。</p>\n<p>如果错误为 connection refused，如何排查。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;php5&#x2F;fpm&#x2F;pool.d</span><br><span class=\"line\">sudo vim www.conf 搜索listen</span><br><span class=\"line\">找到</span><br><span class=\"line\">listen &#x3D; &#x2F;var&#x2F;run&#x2F;php5-fpm.sock</span><br><span class=\"line\">这是监听域模式的方式，改成端口方式进行监听</span><br><span class=\"line\">listen &#x3D; 127.0.0.1：9000 </span><br><span class=\"line\">端口方式比域模式更加稳定</span><br><span class=\"line\">修改后重启fpm服务</span><br><span class=\"line\">sudo service php5-fpm restart</span><br><span class=\"line\">sudo &#x2F;etc&#x2F;init.d&#x2F;php5-fpm restart 这两行一样</span><br></pre></td></tr></table></figure>\n<p>再次通过浏览器访问，终于通了。</p>\n<h3 id=\"配置apache\"><a href=\"#配置apache\" class=\"headerlink\" title=\"配置apache\"></a>配置apache</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;apache2</span><br><span class=\"line\">vim apache2.conf</span><br><span class=\"line\">打开配置文件，最下面可以看到</span><br><span class=\"line\"># Include the virtual host configurations:</span><br><span class=\"line\">IncludeOptional sites-enabled&#x2F;*.conf</span><br><span class=\"line\">找到子配置文件的目录</span><br><span class=\"line\">cd sites-enabled</span><br><span class=\"line\">sudo touch tp5.conf</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:8888&gt; &#x2F;&#x2F; xml 形式 端口为8888</span><br><span class=\"line\">\tServerName tp5.zzp.com</span><br><span class=\"line\">\tDocumentRoot &#x2F;home&#x2F;www&#x2F;tp5&#x2F;public</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<p>然后重启apache</p>\n<p>浏览器中访问 tp5.zzp.com:8888  返回403错误</p>\n<h4 id=\"解决方式\"><a href=\"#解决方式\" class=\"headerlink\" title=\"解决方式\"></a>解决方式</h4><p>看错误日志</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo chmod -R 755 &#x2F;var&#x2F;log&#x2F;apache2</span><br><span class=\"line\">tail -f error.log</span><br><span class=\"line\">client denied by server configuration</span><br><span class=\"line\">一般是Apache的配置错误导致的</span><br><span class=\"line\">sudo vim &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Directory &#x2F;&gt;</span><br><span class=\"line\">        Options FollowSymLinks</span><br><span class=\"line\">        AllowOverride None</span><br><span class=\"line\">        Require all denied &#x2F;&#x2F; 把这行注释掉即可,然后重启apache</span><br><span class=\"line\">&lt;&#x2F;Directory&gt;</span><br></pre></td></tr></table></figure>\n<p>TP 的路由解决方式已经非常落后，给webserver 的配置带来了很多麻烦，看看就好。</p>\n<h4 id=\"开启Apache的rewrite功能\"><a href=\"#开启Apache的rewrite功能\" class=\"headerlink\" title=\"开启Apache的rewrite功能\"></a>开启Apache的rewrite功能</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo a2enmod rewrite</span><br></pre></td></tr></table></figure>\n<p>在Apache的配置文件中还要修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo vim &#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class=\"line\">找到 Directory 的 AllowOverride, 改为All</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-vagrant-安装yii2-amp-Laravel5\"><a href=\"#2-vagrant-安装yii2-amp-Laravel5\" class=\"headerlink\" title=\"2. vagrant 安装yii2 &amp; Laravel5\"></a>2. vagrant 安装yii2 &amp; Laravel5</h2><h3 id=\"1-下载yii-basic-的压缩包，解压到目标目录\"><a href=\"#1-下载yii-basic-的压缩包，解压到目标目录\" class=\"headerlink\" title=\"1. 下载yii-basic 的压缩包，解压到目标目录\"></a>1. 下载yii-basic 的压缩包，解压到目标目录</h3><h3 id=\"2-配置nginx运行环境\"><a href=\"#2-配置nginx运行环境\" class=\"headerlink\" title=\"2. 配置nginx运行环境\"></a>2. 配置nginx运行环境</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;nginx&#x2F;conf.d</span><br><span class=\"line\">sudo touch yii2.conf</span><br><span class=\"line\">sudo vim yii2.conf</span><br><span class=\"line\">sudo service nginx restart</span><br><span class=\"line\"></span><br><span class=\"line\">server&#123;</span><br><span class=\"line\">    server_name yii.zzp.com;</span><br><span class=\"line\">    root &#x2F;home&#x2F;www&#x2F;yii&#x2F;web;</span><br><span class=\"line\">    index index.php;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">      try_files $uri $uri&#x2F; &#x2F;index.php?$args;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">      include fastcgi_params;</span><br><span class=\"line\">      fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">      try_files $uri &#x3D; 404;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">别忘了 hosts 在浏览器中就可以访问了</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-配置Apache\"><a href=\"#3-配置Apache\" class=\"headerlink\" title=\"3. 配置Apache\"></a>3. 配置Apache</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd &#x2F;etc&#x2F;apache2&#x2F;sites-enabled</span><br><span class=\"line\">sudo touch yii.conf</span><br><span class=\"line\">sudo vim yii.conf</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;VirtualHost *:8888&gt;</span><br><span class=\"line\">  ServerName yii.zzp.com</span><br><span class=\"line\">  DocumentRoot &#x2F;home&#x2F;www&#x2F;yii&#x2F;web</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">重启apache 在浏览器中就可以访问了</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-下载并解压-laravel安装包\"><a href=\"#4-下载并解压-laravel安装包\" class=\"headerlink\" title=\"4. 下载并解压 laravel安装包\"></a>4. 下载并解压 laravel安装包</h3><p>配置基本和yii一致</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">    server_name laravel.zzp.com;</span><br><span class=\"line\">    root &#x2F;home&#x2F;www&#x2F;laravel&#x2F;public;</span><br><span class=\"line\">    index index.php;</span><br><span class=\"line\">    location &#x2F; &#123;</span><br><span class=\"line\">      try_files $uri $uri&#x2F; &#x2F;index.php?$args;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    location ~ \\.php$ &#123;</span><br><span class=\"line\">      include fastcgi_params;</span><br><span class=\"line\">      fastcgi_pass 127.0.0.1:9000;</span><br><span class=\"line\">      try_files $uri &#x3D; 404;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost *:8888&gt;</span><br><span class=\"line\">  ServerName laravel.zzp.com</span><br><span class=\"line\">  DocumentRoot &#x2F;home&#x2F;www&#x2F;laravel&#x2F;public</span><br><span class=\"line\">&lt;&#x2F;VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-vagrant-虚拟机优化\"><a href=\"#3-vagrant-虚拟机优化\" class=\"headerlink\" title=\"3. vagrant  虚拟机优化\"></a>3. vagrant  虚拟机优化</h2><h3 id=\"虚拟机名字-内存和CPU\"><a href=\"#虚拟机名字-内存和CPU\" class=\"headerlink\" title=\"虚拟机名字 内存和CPU\"></a>虚拟机名字 内存和CPU</h3><p>修改vagrantfile并重启虚拟机</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class=\"line\">#   # Display the VirtualBox GUI when booting the machine</span><br><span class=\"line\">#   vb.gui &#x3D; true</span><br><span class=\"line\">#</span><br><span class=\"line\">#   # Customize the amount of memory on the VM:</span><br><span class=\"line\">    vb.memory &#x3D; &quot;1024&quot;</span><br><span class=\"line\">    vb.cpus &#x3D; 2</span><br><span class=\"line\">    vb.name &#x3D; &quot;ubuntu_mooc&quot;</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n<h3 id=\"虚拟机主机名\"><a href=\"#虚拟机主机名\" class=\"headerlink\" title=\"虚拟机主机名\"></a>虚拟机主机名</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.hostname &#x3D; &quot;mooc&quot;</span><br></pre></td></tr></table></figure>\n<p>查看虚拟机内容 <code>free -m</code><br>CPU <code>top</code> 再按1查看，q退出</p>\n<h3 id=\"优化nginx和apache-同步目录的问题-修改后文件可及时同步\"><a href=\"#优化nginx和apache-同步目录的问题-修改后文件可及时同步\" class=\"headerlink\" title=\"优化nginx和apache 同步目录的问题 修改后文件可及时同步\"></a>优化nginx和apache 同步目录的问题 修改后文件可及时同步</h3><p><img src=\"http://upload-images.jianshu.io/upload_images/693141-368f8373feeaa483.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"></p>\n<hr>\n<h2 id=\"打包分发环境\"><a href=\"#打包分发环境\" class=\"headerlink\" title=\"打包分发环境\"></a>打包分发环境</h2><h3 id=\"打包\"><a href=\"#打包\" class=\"headerlink\" title=\"打包\"></a>打包</h3><p>需先关闭虚拟机 vagrant halt</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant package --output xxx.box</span><br><span class=\"line\">vagrant package --output xxx.box --base 虚拟机名</span><br></pre></td></tr></table></figure>\n<h3 id=\"升级\"><a href=\"#升级\" class=\"headerlink\" title=\"升级\"></a>升级</h3><p>老用户：使用Vagrantfile进行升级；</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class=\"line\">apt-get install -y redis-server (-y 表示强制安装)</span><br><span class=\"line\">vagrant reload --provision</span><br></pre></td></tr></table></figure>\n<p>新用户：直接重新打包分发给他</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vagrant box add new xxx.box</span><br><span class=\"line\">新建一个目录</span><br><span class=\"line\">vagrant box list</span><br><span class=\"line\">vagrant init new</span><br></pre></td></tr></table></figure>\n\n<p>配置文件里面的vb.gui可以查看虚拟机启动时候的情况，可用于错误调试。</p>\n<p>打包的时候最好关闭网络配置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; Vagrantfile 配置文件所有内容</span><br><span class=\"line\"># -*- mode: ruby -*-</span><br><span class=\"line\"># vi: set ft&#x3D;ruby :</span><br><span class=\"line\"></span><br><span class=\"line\">Vagrant.configure(&quot;2&quot;) do |config|</span><br><span class=\"line\">  config.vm.box &#x3D; &quot;ubuntu1404&quot;</span><br><span class=\"line\">  config.vm.hostname &#x3D; &quot;mooc&quot;</span><br><span class=\"line\">  config.vm.network &quot;forwarded_port&quot;, guest: 80, host: 8888 ,id: &#39;nginx&#39;</span><br><span class=\"line\">  config.vm.network &quot;forwarded_port&quot;, guest: 8888, host: 8889 ,id: &#39;apache&#39;</span><br><span class=\"line\">  config.vm.network &quot;private_network&quot;, ip: &quot;192.168.11.11&quot;,auto_config: true</span><br><span class=\"line\">  config.vm.synced_folder &quot;&#x2F;Users&#x2F;ZouZhipeng&#x2F;www&#x2F;mooc_vagrant&#x2F;&quot;, &quot;&#x2F;home&#x2F;www&quot;, :nfs &#x3D;&gt; true</span><br><span class=\"line\">  #config.vm.synced_folder &quot;&#x2F;Users&#x2F;vincent&#x2F;code&#x2F;&quot;, &quot;&#x2F;home&#x2F;www&quot;, :nfs &#x3D;&gt; true</span><br><span class=\"line\"></span><br><span class=\"line\">  config.vm.provider &quot;virtualbox&quot; do |vb|</span><br><span class=\"line\">  #   # Display the VirtualBox GUI when booting the machine</span><br><span class=\"line\">  #   vb.gui &#x3D; true</span><br><span class=\"line\">  #</span><br><span class=\"line\">  #   # Customize the amount of memory on the VM:</span><br><span class=\"line\">      vb.memory &#x3D; &quot;1024&quot;</span><br><span class=\"line\">      vb.cpus &#x3D; 2</span><br><span class=\"line\">      vb.name &#x3D; &quot;ubuntu_mooc&quot;</span><br><span class=\"line\">  end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  # Enable provisioning with a shell script. Additional provisioners such as</span><br><span class=\"line\">  # Puppet, Chef, Ansible, Salt, and Docker are also available. Please see the</span><br><span class=\"line\">  # documentation for more information about their specific syntax and use.</span><br><span class=\"line\">  # config.vm.provision &quot;shell&quot;, inline: &lt;&lt;-SHELL</span><br><span class=\"line\">  #   apt-get update</span><br><span class=\"line\">  #   apt-get install -y apache2</span><br><span class=\"line\">  # SHELL</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[{"post_id":"ckexjtz7o00066wo12yc606x8","category_id":"ckexjtz7r00096wo1fj3d2nde","_id":"ckexjtz80000l6wo15rp8ddc6"},{"post_id":"ckexjtz7w000f6wo160w610m8","category_id":"ckexjtz7z000j6wo1g3ge986f","_id":"ckexjtz88000w6wo1gl56gvfr"},{"post_id":"ckexjtz7x000h6wo15yjwa0sr","category_id":"ckexjtz7z000j6wo1g3ge986f","_id":"ckexjtz8b00116wo15nl752nw"},{"post_id":"ckexjtz7z000k6wo1hdu9awrq","category_id":"ckexjtz87000v6wo1cwmfdj8y","_id":"ckexjtz8i00176wo1g2gp2y1l"},{"post_id":"ckexjtz82000p6wo1ecv1gz9g","category_id":"ckexjtz8b00126wo12u61hvvc","_id":"ckexjtz8l001d6wo11vro8l1o"},{"post_id":"ckexjtz8c00136wo1ef8vd8zd","category_id":"ckexjtz8i00186wo1a6ne8727","_id":"ckexjtz8p001j6wo1ams12348"},{"post_id":"ckexjtz8s001p6wo1am3m0j02","category_id":"ckexjtz8b00126wo12u61hvvc","_id":"ckexjtz8x001w6wo13uytccwk"},{"post_id":"ckexjtz8o001i6wo12ryydn3f","category_id":"ckexjtz8q001n6wo19soh3ave","_id":"ckexjtz8y001z6wo10uv15tfh"},{"post_id":"ckexjtz8u001s6wo1f06wenrl","category_id":"ckexjtz7r00096wo1fj3d2nde","_id":"ckexjtz9000236wo161ithyid"},{"post_id":"ckexjtz96002h6wo12lqfhd0x","category_id":"ckexjtz7z000j6wo1g3ge986f","_id":"ckexjtz9a002q6wo15tmj29ga"},{"post_id":"ckexjtz99002p6wo14x5l30fp","category_id":"ckexjtz7z000j6wo1g3ge986f","_id":"ckexjtz9k002y6wo13pao4iyf"},{"post_id":"ckexjtz9l00306wo1aqo3aac7","category_id":"ckexjtz8b00126wo12u61hvvc","_id":"ckexjtz9p00376wo1da1s6p59"},{"post_id":"ckexjtz9m00326wo11vi01p67","category_id":"ckexjtz8b00126wo12u61hvvc","_id":"ckexjtz9q003b6wo12dr12aj4"},{"post_id":"ckexjtz9n00346wo1boee5bl0","category_id":"ckexjtz8b00126wo12u61hvvc","_id":"ckexjtz9s003e6wo1d6ynam0q"},{"post_id":"ckexjtz9s003f6wo1a49vgkd3","category_id":"ckexjtz7r00096wo1fj3d2nde","_id":"ckexjtz9w003o6wo12a12dxs0"},{"post_id":"ckexjtz9t003i6wo157behmtf","category_id":"ckexjtz8b00126wo12u61hvvc","_id":"ckexjtz9x003r6wo1d6pfd1yz"},{"post_id":"ckexjtz9x003q6wo17fvs3jnh","category_id":"ckexjtza0003v6wo1cvivfclp","_id":"ckexjtza500476wo11cgt8f34"},{"post_id":"ckexjtza300446wo15hod6vx6","category_id":"ckexjtz8q001n6wo19soh3ave","_id":"ckexjtza8004e6wo1h9ut1uzr"},{"post_id":"ckexjtza0003w6wo16xiwfqm0","category_id":"ckexjtza300426wo12uc783bm","_id":"ckexjtza9004h6wo17trk0e7b"},{"post_id":"ckexjtza1003z6wo15bgm4yx0","category_id":"ckexjtza300426wo12uc783bm","_id":"ckexjtzac004l6wo146rqgwll"},{"post_id":"ckexjtza200416wo14gzf7kpu","category_id":"ckexjtza8004f6wo1cani9rs4","_id":"ckexjtzae004r6wo1eevs3kxt"},{"post_id":"ckexjtzac004n6wo1g616g8xi","category_id":"ckexjtza8004f6wo1cani9rs4","_id":"ckexjtzag004w6wo1c9oy4naj"},{"post_id":"ckexjtzad004q6wo11osc0xo0","category_id":"ckexjtza8004f6wo1cani9rs4","_id":"ckexjtzai004z6wo14jb2f8za"},{"post_id":"ckexjtzaf004t6wo16slj8idy","category_id":"ckexjtza8004f6wo1cani9rs4","_id":"ckexjtzaj00526wo148vwd26t"},{"post_id":"ckexjtzag004v6wo1737kfhlg","category_id":"ckexjtza8004f6wo1cani9rs4","_id":"ckexjtzak00556wo1fvyvd2cs"}],"PostTag":[{"post_id":"ckexjtz7g00016wo17z8h1i3y","tag_id":"ckexjtz7m00046wo1eu503gbo","_id":"ckexjtz7u000d6wo1bsond6jr"},{"post_id":"ckexjtz7k00036wo1dye05s8m","tag_id":"ckexjtz7u000c6wo12lku5t98","_id":"ckexjtz7z000i6wo13pgk50m8"},{"post_id":"ckexjtz7o00066wo12yc606x8","tag_id":"ckexjtz7x000g6wo19qii3orx","_id":"ckexjtz82000o6wo1grbf90ip"},{"post_id":"ckexjtz7q00086wo16xyg1bty","tag_id":"ckexjtz81000m6wo1hu764cx2","_id":"ckexjtz86000t6wo17vclhukb"},{"post_id":"ckexjtz7t000b6wo15pls0yb6","tag_id":"ckexjtz85000r6wo1gnz5b1xl","_id":"ckexjtz8a000z6wo18oa6bgqz"},{"post_id":"ckexjtz7v000e6wo18bh7d9m2","tag_id":"ckexjtz89000y6wo15vllbk07","_id":"ckexjtz8i00166wo10l0e1hec"},{"post_id":"ckexjtz7w000f6wo160w610m8","tag_id":"ckexjtz8d00146wo1gmd0a6us","_id":"ckexjtz8l001c6wo1ec5tco0t"},{"post_id":"ckexjtz7x000h6wo15yjwa0sr","tag_id":"ckexjtz8j001a6wo18l2t9u3m","_id":"ckexjtz8o001h6wo17u4n58se"},{"post_id":"ckexjtz7z000k6wo1hdu9awrq","tag_id":"ckexjtz8d00146wo1gmd0a6us","_id":"ckexjtz8q001m6wo151i6cyn5"},{"post_id":"ckexjtz81000n6wo1eznt7v7t","tag_id":"ckexjtz8p001k6wo16m089f5p","_id":"ckexjtz8t001r6wo16xoa700f"},{"post_id":"ckexjtz82000p6wo1ecv1gz9g","tag_id":"ckexjtz8t001q6wo18m7uef4p","_id":"ckexjtz8x001x6wo1c7or8hh3"},{"post_id":"ckexjtz8u001t6wo14e2g2hhn","tag_id":"ckexjtz89000y6wo15vllbk07","_id":"ckexjtz8y00206wo14nupffzb"},{"post_id":"ckexjtz8w001v6wo18a2qd0fw","tag_id":"ckexjtz89000y6wo15vllbk07","_id":"ckexjtz9000246wo1hdkfd7pk"},{"post_id":"ckexjtz85000s6wo1axe475tb","tag_id":"ckexjtz8t001q6wo18m7uef4p","_id":"ckexjtz9100266wo111zn9a50"},{"post_id":"ckexjtz87000u6wo112xace51","tag_id":"ckexjtz8z00216wo12ccogecy","_id":"ckexjtz9200296wo1dcyrgp8g"},{"post_id":"ckexjtz9000256wo177l3bfbs","tag_id":"ckexjtz8t001q6wo18m7uef4p","_id":"ckexjtz93002b6wo10ym09mpc"},{"post_id":"ckexjtz9100286wo136ga2pur","tag_id":"ckexjtz8j001a6wo18l2t9u3m","_id":"ckexjtz94002e6wo18vzj50ro"},{"post_id":"ckexjtz88000x6wo12kww9iqt","tag_id":"ckexjtz9100276wo1bipuac1c","_id":"ckexjtz95002g6wo1esci6h0q"},{"post_id":"ckexjtz92002a6wo1dxque872","tag_id":"ckexjtz9100276wo1bipuac1c","_id":"ckexjtz97002j6wo1fhmqhtak"},{"post_id":"ckexjtz8a00106wo19ylh4c4l","tag_id":"ckexjtz93002c6wo18slu3g88","_id":"ckexjtz98002l6wo1gnz61plm"},{"post_id":"ckexjtz96002h6wo12lqfhd0x","tag_id":"ckexjtz8j001a6wo18l2t9u3m","_id":"ckexjtz99002o6wo10ihm4ibj"},{"post_id":"ckexjtz8c00136wo1ef8vd8zd","tag_id":"ckexjtz93002c6wo18slu3g88","_id":"ckexjtz9a002r6wo16pppbdrc"},{"post_id":"ckexjtz99002p6wo14x5l30fp","tag_id":"ckexjtz8j001a6wo18l2t9u3m","_id":"ckexjtz9h002u6wo14hrobgmk"},{"post_id":"ckexjtz8h00156wo15aex9v3r","tag_id":"ckexjtz98002n6wo18d21b0wy","_id":"ckexjtz9j002w6wo16jw33ngf"},{"post_id":"ckexjtz8j00196wo12ykcfrcj","tag_id":"ckexjtz9g002t6wo155ji99so","_id":"ckexjtz9l00316wo1c3bfdvwr"},{"post_id":"ckexjtz8k001b6wo183cl9fmd","tag_id":"ckexjtz9k002z6wo19dffhryo","_id":"ckexjtz9o00356wo1aitj09du"},{"post_id":"ckexjtz9m00326wo11vi01p67","tag_id":"ckexjtz7m00046wo1eu503gbo","_id":"ckexjtz9p00386wo1075ueiac"},{"post_id":"ckexjtz8l001e6wo1f8zi038a","tag_id":"ckexjtz9k002z6wo19dffhryo","_id":"ckexjtz9r003c6wo1aov4f5zl"},{"post_id":"ckexjtz9r003d6wo13ixw02fy","tag_id":"ckexjtz8j001a6wo18l2t9u3m","_id":"ckexjtz9t003h6wo1h4ek4sv6"},{"post_id":"ckexjtz8o001i6wo12ryydn3f","tag_id":"ckexjtz9p00396wo1h1fq52v0","_id":"ckexjtz9u003j6wo1efbggyvq"},{"post_id":"ckexjtz9t003i6wo157behmtf","tag_id":"ckexjtz8t001q6wo18m7uef4p","_id":"ckexjtz9v003m6wo17jscewql"},{"post_id":"ckexjtz8p001l6wo14qq9bl1u","tag_id":"ckexjtz9s003g6wo145si0sd1","_id":"ckexjtz9w003p6wo1hb3pbibo"},{"post_id":"ckexjtz8r001o6wo14zve6790","tag_id":"ckexjtz9u003l6wo18sjn8wgy","_id":"ckexjtz9z003u6wo1025688aj"},{"post_id":"ckexjtz9x003q6wo17fvs3jnh","tag_id":"ckexjtz8t001q6wo18m7uef4p","_id":"ckexjtza0003x6wo13suoeqnd"},{"post_id":"ckexjtz8s001p6wo1am3m0j02","tag_id":"ckexjtz8t001q6wo18m7uef4p","_id":"ckexjtza200406wo19ed4hitb"},{"post_id":"ckexjtz8u001s6wo1f06wenrl","tag_id":"ckexjtza1003y6wo1eesi4r08","_id":"ckexjtza400456wo10xs1eir2"},{"post_id":"ckexjtza300446wo15hod6vx6","tag_id":"ckexjtz7m00046wo1eu503gbo","_id":"ckexjtza600496wo1h3e4aj0k"},{"post_id":"ckexjtz8x001y6wo1fb88d5pw","tag_id":"ckexjtza300436wo12l340vop","_id":"ckexjtza7004c6wo1f98p08i3"},{"post_id":"ckexjtz8z00226wo1fzipdx2k","tag_id":"ckexjtz9100276wo1bipuac1c","_id":"ckexjtzab004j6wo1geyghrvg"},{"post_id":"ckexjtza9004g6wo16y2lba7x","tag_id":"ckexjtz7u000c6wo12lku5t98","_id":"ckexjtzac004m6wo169kh2k5k"},{"post_id":"ckexjtzab004k6wo1c1ib69tk","tag_id":"ckexjtz7u000c6wo12lku5t98","_id":"ckexjtzad004p6wo13y21bh6b"},{"post_id":"ckexjtz94002d6wo1h70a8ivz","tag_id":"ckexjtzaa004i6wo1dop07s9u","_id":"ckexjtzae004s6wo1dlj66bct"},{"post_id":"ckexjtz95002f6wo1hmeq782v","tag_id":"ckexjtzad004o6wo1a8m72ksd","_id":"ckexjtzag004x6wo1hhuk4fnh"},{"post_id":"ckexjtz97002k6wo1970u80aw","tag_id":"ckexjtzaf004u6wo1ccsb196b","_id":"ckexjtzaj00536wo1ded5cqjw"},{"post_id":"ckexjtz98002m6wo1f3154hqt","tag_id":"ckexjtzai00506wo1aqfi7499","_id":"ckexjtzan00586wo1bebtfv3b"},{"post_id":"ckexjtz9f002s6wo1ey0f8kq6","tag_id":"ckexjtzaa004i6wo1dop07s9u","_id":"ckexjtzap005c6wo1bwlxb8ak"},{"post_id":"ckexjtz9h002v6wo11l1v2ubg","tag_id":"ckexjtzaa004i6wo1dop07s9u","_id":"ckexjtzaq005e6wo1d27i5prf"},{"post_id":"ckexjtz9j002x6wo18obv50uo","tag_id":"ckexjtzap005d6wo18yuabi1g","_id":"ckexjtzaq005g6wo1ceqahpvr"},{"post_id":"ckexjtz9l00306wo1aqo3aac7","tag_id":"ckexjtzaq005f6wo14oz41nli","_id":"ckexjtzar005i6wo1hr17cpyt"},{"post_id":"ckexjtz9n00346wo1boee5bl0","tag_id":"ckexjtzar005h6wo1czi18fjs","_id":"ckexjtzas005k6wo17fd1fyrf"},{"post_id":"ckexjtz9o00366wo10b7gaxpc","tag_id":"ckexjtzar005j6wo1dmqmer66","_id":"ckexjtzas005m6wo1051ldboj"},{"post_id":"ckexjtz9q003a6wo16rza62ug","tag_id":"ckexjtzas005l6wo1b0r2ctlk","_id":"ckexjtzat005o6wo1cen68kte"},{"post_id":"ckexjtz9s003f6wo1a49vgkd3","tag_id":"ckexjtza1003y6wo1eesi4r08","_id":"ckexjtzat005q6wo13267cqgt"},{"post_id":"ckexjtz9u003k6wo1b6ia7wav","tag_id":"ckexjtzat005p6wo106dy7mnf","_id":"ckexjtzau005s6wo17kdn7916"},{"post_id":"ckexjtz9v003n6wo15j6mdbl4","tag_id":"ckexjtzat005r6wo12jld4lru","_id":"ckexjtzau005u6wo189t88ksj"},{"post_id":"ckexjtz9y003t6wo1h2xz359a","tag_id":"ckexjtzau005t6wo158ecbny0","_id":"ckexjtzav005w6wo1009c0nd4"},{"post_id":"ckexjtza0003w6wo16xiwfqm0","tag_id":"ckexjtzau005v6wo11h730n41","_id":"ckexjtzav005y6wo13go91oaa"},{"post_id":"ckexjtza1003z6wo15bgm4yx0","tag_id":"ckexjtzav005x6wo11kvodhs0","_id":"ckexjtzaw00606wo11gsp1qdt"},{"post_id":"ckexjtza200416wo14gzf7kpu","tag_id":"ckexjtzav005z6wo1ahtef327","_id":"ckexjtzaw00626wo1gcpq5h1r"},{"post_id":"ckexjtza400466wo1hcy0finh","tag_id":"ckexjtzat005r6wo12jld4lru","_id":"ckexjtzax00646wo16kj01ivy"},{"post_id":"ckexjtza6004a6wo11yrafezk","tag_id":"ckexjtzat005r6wo12jld4lru","_id":"ckexjtzax00666wo15d6z3go3"},{"post_id":"ckexjtzac004n6wo1g616g8xi","tag_id":"ckexjtzax00656wo1fkge7yat","_id":"ckexjtzay00686wo16ur3d2dm"},{"post_id":"ckexjtzad004q6wo11osc0xo0","tag_id":"ckexjtzax00656wo1fkge7yat","_id":"ckexjtzaz006a6wo12jub5woa"},{"post_id":"ckexjtzaf004t6wo16slj8idy","tag_id":"ckexjtzax00656wo1fkge7yat","_id":"ckexjtzb0006c6wo18zz9cok5"},{"post_id":"ckexjtzag004v6wo1737kfhlg","tag_id":"ckexjtzax00656wo1fkge7yat","_id":"ckexjtzb0006e6wo11jqra5vy"},{"post_id":"ckexjtzah004y6wo1fu7e76y6","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb1006g6wo155i5fy24"},{"post_id":"ckexjtzai00516wo1df1l8kg8","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb1006i6wo1671vhnjq"},{"post_id":"ckexjtzak00546wo15ttkb0ah","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb2006k6wo1ghit23tz"},{"post_id":"ckexjtzak00566wo1ebny5o0v","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb3006m6wo12tsr27s8"},{"post_id":"ckexjtzan00596wo1f4ekd0l5","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb3006o6wo1g60capkg"},{"post_id":"ckexjtzao005a6wo1e20b9wfq","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb3006p6wo16n3ac2f2"},{"post_id":"ckexjtzb7006q6wo1a5tvgov8","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb9006s6wo12mjx7kk5"},{"post_id":"ckexjtzb8006r6wo119w6cm9h","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzb9006u6wo10sfre1pq"},{"post_id":"ckexjtzb9006t6wo16tkadfun","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzba006w6wo183y9hnl0"},{"post_id":"ckexjtzba006v6wo11388drzt","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzbb006y6wo12vpvej70"},{"post_id":"ckexjtzba006x6wo10r7g8h95","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzbc00706wo135pbdza4"},{"post_id":"ckexjtzbb006z6wo1cjycbzqr","tag_id":"ckexjtzb0006d6wo1eg1h5pbx","_id":"ckexjtzbd00726wo13ell2a32"},{"post_id":"ckexjtzbc00716wo1hi7he9t3","tag_id":"ckexjtz8j001a6wo18l2t9u3m","_id":"ckexjtzbe00736wo15fx5csg8"}],"Tag":[{"name":"trivia","_id":"ckexjtz7m00046wo1eu503gbo"},{"name":"xdebug","_id":"ckexjtz7u000c6wo12lku5t98"},{"name":"CGI","_id":"ckexjtz7x000g6wo19qii3orx"},{"name":"crontab","_id":"ckexjtz81000m6wo1hu764cx2"},{"name":"DEDECMS","_id":"ckexjtz85000r6wo1gnz5b1xl"},{"name":"git","_id":"ckexjtz89000y6wo15vllbk07"},{"name":"Laravel","_id":"ckexjtz8d00146wo1gmd0a6us"},{"name":"laravel","_id":"ckexjtz8j001a6wo18l2t9u3m"},{"name":"http2","_id":"ckexjtz8p001k6wo16m089f5p"},{"name":"Linux","_id":"ckexjtz8t001q6wo18m7uef4p"},{"name":"MVC","_id":"ckexjtz8z00216wo12ccogecy"},{"name":"mac","_id":"ckexjtz9100276wo1bipuac1c"},{"name":"Mac","_id":"ckexjtz93002c6wo18slu3g88"},{"name":"Charles","_id":"ckexjtz98002n6wo18d21b0wy"},{"name":"MarkDown","_id":"ckexjtz9g002t6wo155ji99so"},{"name":"MySQL","_id":"ckexjtz9k002z6wo19dffhryo"},{"name":"shadowsocks","_id":"ckexjtz9p00396wo1h1fq52v0"},{"name":"shell","_id":"ckexjtz9s003g6wo145si0sd1"},{"name":"Yii","_id":"ckexjtz9u003l6wo18sjn8wgy"},{"name":"PHP","_id":"ckexjtza1003y6wo1eesi4r08"},{"name":"hexo","_id":"ckexjtza300436wo12l340vop"},{"name":"openssl","_id":"ckexjtzaa004i6wo1dop07s9u"},{"name":"nginx","_id":"ckexjtzad004o6wo1a8m72ksd"},{"name":"docker","_id":"ckexjtzaf004u6wo1ccsb196b"},{"name":"Docker","_id":"ckexjtzai00506wo1aqfi7499"},{"name":"mysql","_id":"ckexjtzap005d6wo18yuabi1g"},{"name":"sed","_id":"ckexjtzaq005f6wo14oz41nli"},{"name":"正则表达式","_id":"ckexjtzar005h6wo1czi18fjs"},{"name":"ubuntu","_id":"ckexjtzar005j6wo1dmqmer66"},{"name":"sublime","_id":"ckexjtzas005l6wo1b0r2ctlk"},{"name":"小程序","_id":"ckexjtzat005p6wo106dy7mnf"},{"name":"算法","_id":"ckexjtzat005r6wo12jld4lru"},{"name":"php","_id":"ckexjtzau005t6wo158ecbny0"},{"name":"wangEditor","_id":"ckexjtzau005v6wo11h730n41"},{"name":"dropzone","_id":"ckexjtzav005x6wo11kvodhs0"},{"name":"晚霞","_id":"ckexjtzav005z6wo1ahtef327"},{"name":"青海湖","_id":"ckexjtzax00656wo1fkge7yat"},{"name":"高并发","_id":"ckexjtzb0006d6wo1eg1h5pbx"}]}}